<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <title>Student Notation Web Applet</title>
    <link rel="icon" href="/Student-Notation/favicon.ico" sizes="any" />
    <link rel="icon" type="image/png" sizes="96x96" href="/Student-Notation/favicon-96x96.png" />
    <link rel="apple-touch-icon" sizes="180x180" href="/Student-Notation/apple-touch-icon.png" />
    <link rel="mask-icon" href="/Student-Notation/favicon.svg" color="#a88cf3" />
    <link rel="manifest" href="/Student-Notation/site.webmanifest" />
    <meta name="theme-color" content="#ffffff" />
    <style id="print-style-rules"></style>
    <script type="module" crossorigin src="/Student-Notation/assets/index-CFDiKHho.js"></script>
    <link rel="stylesheet" crossorigin href="/Student-Notation/assets/index-D4YNnvhr.css">
  </head>
  <body>
    <!-- Sidebar for File/App Actions -->
    <div id="sidebar-overlay"></div>
    <div id="sidebar">
      <div class="sidebar-container">
        <div class="app-title">Student Notation</div>
      </div>
      <div class="sidebar-container">
        <button class="sidebar-button" id="save-as-button">üíæ Save As</button>
        <button class="sidebar-button" id="import-button">üìÅ Open</button>
        <button class="sidebar-button" id="print-button">üñ®Ô∏è Print</button>
        <button class="sidebar-button" id="reset-canvas-button">üîÑ Reset Canvas</button>
      </div>
    </div>

    <div id="app-container">
      <!-- =======================================================
           NEW UNIFIED TOOLBAR
           ======================================================= -->
      <div id="new-toolbar">
        <!-- Container 1: Tools & Actions -->
        <div id="container-1">
            <div class="tool-subcontainer">
                <button class="toolkit-icon-button" id="settings-button" title="Settings">‚öôÔ∏è</button>
                <div id="volume-control-wrapper">
                    <button class="toolkit-icon-button" id="volume-icon-button" aria-label="Volume">üîä</button>
                    <div id="volume-popup">
                        <input type="range" id="vertical-volume-slider" orient="vertical" min="0" max="100" value="75" step="1" />
                    </div>
                </div>
                <button class="toolkit-icon-button" id="grid-zoom-in" title="Zoom In">üîç</button>
                <button class="toolkit-icon-button" id="grid-zoom-out" title="Zoom Out">üîé</button>
            </div>
            <div class="tool-subcontainer" id="note-bank-container">
                <div class="note-bank-row">
                    <div class="note-pair" data-color="#4a90e2"><div class="note circle-note" data-type="circle"></div><div class="note oval-note" data-type="oval"></div></div>
                    <div class="note-pair" data-color="#2d2d2d"><div class="note circle-note" data-type="circle"></div><div class="note oval-note" data-type="oval"></div></div>
                </div>
                <div class="note-bank-row">
                    <div class="note-pair" data-color="#d66573"><div class="note circle-note" data-type="circle"></div><div class="note oval-note" data-type="oval"></div></div>
                    <div class="note-pair" data-color="#68a03f"><div class="note circle-note" data-type="circle"></div><div class="note oval-note" data-type="oval"></div></div>
                </div>
            </div>
            <div class="tool-subcontainer">
                <button class="toolkit-button" id="clear-button">Clear</button>
                <button class="toolkit-button" id="undo-button">Undo</button>
                <button class="toolkit-button" id="redo-button">Redo</button>
                <!-- REVISED ERASER BUTTON -->
                <button class="toolkit-icon-button eraser-button" id="eraser-tool-button" title="Eraser">
                    <img src="/Student-Notation/assets/icons/Eraser.png" alt="Eraser" class="eraser-icon">
                </button>
            </div>
        </div>

        <!-- Container 2: Playback Controls -->
        <div id="container-2">
            <div class="tempo-row">
                <div class="tempo-input-group">
                    <img src="/Student-Notation/assets/icons/8thNote.svg" alt="Eighth Note Tempo" class="tempo-label-icon">
                    <input type="number" class="tempo-input" id="eighth-note-tempo" value="180">
                </div>
                <div class="tempo-input-group">
                    <img src="/Student-Notation/assets/icons/QuarterNote.svg" alt="Quarter Note Tempo" class="tempo-label-icon">
                    <input type="number" class="tempo-input" id="quarter-note-tempo" value="90">
                </div>
                <div class="tempo-input-group">
                    <img src="/Student-Notation/assets/icons/DottedQuarterNote.svg" alt="Dotted Quarter Note Tempo" class="tempo-label-icon">
                    <input type="number" class="tempo-input" id="dotted-quarter-tempo" value="60">
                </div>
            </div>
            <div class="tempo-slider-row">
                <input type="range" id="tempo-slider" min="30" max="240" value="90">
            </div>
            <div class="playback-row">
                <button class="toolkit-button" id="play-button">‚èµ</button>
                <button class="toolkit-button" id="stop-button">‚èπ</button>
                <button class="toolkit-button" id="loop-button">üîÅ</button>
            </div>
        </div>

        <!-- Container 3: Tabbed Interface -->
        <div id="container-3">
            <div class="tab-sidebar">
                <button class="tab-button active" data-tab="timbre">Timbre</button>
                <button class="tab-button" data-tab="pitch">Pitch</button>
                <button class="tab-button" data-tab="rhythm">Rhythm</button>
            </div>
            <div class="tab-content">
                <!-- Timbre Tab -->
                <div class="tab-panel active" id="timbre-panel">
                    <div class="control-section preset-container">
                        <h4>Presets</h4>
                        <div class="preset-grid" id="preset-buttons">
                            <div class="preset-column">
                                <button class="preset-button" id="preset-sine">Sine</button>
                                <button class="preset-button" id="preset-triangle">Triangle</button>
                                <button class="preset-button" id="preset-square">Square</button>
                                <button class="preset-button" id="preset-sawtooth">Sawtooth</button>
                            </div>
                            <div class="preset-column">
                                <button class="preset-button" id="preset-piano">Piano</button>
                                <button class="preset-button" id="preset-marimba">Marimba</button>
                                <button class="preset-button" id="preset-woodwind">Woodwind</button>
                                <button class="preset-button" id="preset-strings">Strings</button>
                            </div>
                        </div>
                    </div>
                    <div class="control-section multislider-container">
                        <h4>Harmonics & Filter</h4>
                        <div class="filter-top-controls"><div id="blend-slider-container"><div class="filter-blend-thumb" id="thumb-b" tabindex="0">B</div></div></div>
                        <div class="filter-main-panel">
                           <div class="buffer-container"><canvas id="harmonic-multislider-canvas"></canvas><canvas id="filter-overlay-canvas"></canvas></div>
                           <div class="filter-button-wrapper"><button id="filter-enable-toggle" class="toolkit-icon-button" aria-label="Toggle Filter"><svg class="filter-icon" viewBox="0 0 48 48" xmlns="http://www.w3.org/2000/svg"><path d="M6 24 H22 L30 16 L40 36" fill="none" stroke="currentColor" stroke-width="6" stroke-linecap="round" stroke-linejoin="round"/></svg></button></div>
                        </div>
                        <div id="cutoff-slider-container"><div class="filter-cutoff-thumb" id="thumb-c" tabindex="0">C</div></div>
                    </div>
                    <div class="control-section adsr-container">
                        <h4>ADSR Envelope</h4>
                        <div class="adsr-main-panel"><div class="adsr-graph-wrapper"><div id="adsr-envelope"></div></div><div class="sustain-slider-wrapper"><div id="sustain-slider-track"><div id="sustain-slider-thumb" tabindex="0">S</div></div></div></div>
                        <div id="multi-thumb-slider-container"><div class="time-slider-thumb" id="thumb-a" tabindex="0">A</div><div class="time-slider-thumb" id="thumb-d" tabindex="0">D</div><div class="time-slider-thumb" id="thumb-r" tabindex="0">R</div></div>
                    </div>
                </div>

                <!-- Pitch Tab -->
                <div class="tab-panel" id="pitch-panel">
                    <div class="control-section tonic-sign-container">
                        <h4>Tonic & Key</h4>
                        <div class="tonic-tools-wrapper">
                           <div id="tonic-dropdown-container" class="dropdown-container">
                               <button id="tonic-dropdown-button" class="toolkit-button tonic-dropdown-toggle"><span id="tonic-dropdown-label">‚ë†</span> <span class="dropdown-arrow">‚ñº</span></button>
                               <div id="tonic-dropdown-menu" class="dropdown-menu"><button class="tonic-sign-button" data-tonic="1">‚ë†</button><button class="tonic-sign-button" data-tonic="2">‚ë°</button><button class="tonic-sign-button" data-tonic="3">‚ë¢</button><button class="tonic-sign-button" data-tonic="4">‚ë£</button><button class="tonic-sign-button" data-tonic="5">‚ë§</button><button class="tonic-sign-button" data-tonic="6">‚ë•</button><button class="tonic-sign-button" data-tonic="7">‚ë¶</button></div>
                           </div>
                           <div id="degree-dropdown-wrapper" class="degree-toggle-container dropdown-container">
                                <button id="degree-dropdown-button" class="toolkit-button degree-dropdown-toggle">Degrees <span class="dropdown-arrow">‚ñº</span></button>
                                <div id="degree-dropdown-menu" class="dropdown-menu"><button id="toggle-diatonic-degrees" class="toolkit-button">Scale</button><button id="toggle-modal-degrees" class="toolkit-button">Mode</button></div>
                            </div>
                        </div>
                    </div>
                    <div class="control-section">
                        <h4>Accidentals</h4>
                        <div id="accidental-controls-container-v2">
                            <button id="flat-toggle-btn" class="accidental-button active" aria-pressed="true">‚ô≠</button>
                            <button id="sharp-toggle-btn" class="accidental-button active" aria-pressed="true">‚ôØ</button>
                        </div>
                    </div>
                    <div class="control-section" id="chordShape-container">
                        <h4>Chord Shape</h4>
                        <div class="harmony-preset-grid">
                            <button class="harmony-preset-button" data-quality="M" data-extension="">X</button>
                            <button class="harmony-preset-button" data-quality="m" data-extension="">x</button>
                            <button class="harmony-preset-button" data-quality="dim" data-extension="">x¬∞</button>
                            <button class="harmony-preset-button" data-quality="aug" data-extension="">X+</button>
                            <button class="harmony-preset-button" data-quality="" data-extension="7">X‚Å∑</button>
                            <button class="harmony-preset-button" data-quality="m" data-extension="7">x‚Å∑</button>
                            <button class="harmony-preset-button" data-quality="" data-extension="m7b5">√∏‚Å∑</button>
                            <button class="harmony-preset-button" data-quality="M" data-extension="add6">X‚Å∂</button>
                            <button class="harmony-preset-button" data-quality="" data-extension="sus4">Xsus</button>
                            <button class="harmony-preset-button" data-quality="" data-extension="sus2">Xsus2</button>
                        </div>
                    </div>
                </div>

                <!-- Rhythm Tab -->
                <div class="tab-panel" id="rhythm-panel">
                    <div class="control-section">
                        <h4>Anacrusis</h4>
                        <div class="toggle-button-group"><button class="sidebar-toggle-button" id="anacrusis-on-btn">On</button><button class="sidebar-toggle-button" id="anacrusis-off-btn">Off</button></div>
                    </div>
                    <div class="control-section">
                        <h4>Macrobeat Structure</h4>
                        <div class="macrobeat-adjust-group"><button class="toolkit-button" id="macrobeat-increase">+</button><button class="toolkit-button" id="macrobeat-decrease">‚Äì</button></div>
                    </div>
                </div>
            </div>
        </div>
      </div>
      <!-- End New Unified Toolbar -->

      <!-- Middle Section (Grid and Canvases) -->
      <div id="middle-section">
        <div id="grid-container-wrapper">
          <div id="time-signature-display"></div>
          <div id="grid-controls-container"><div id="beat-line-controls"></div></div>
          <div id="pitch-grid-container"><div id="grid-container"><div id="pitch-canvas-wrapper"><canvas id="notation-grid"></canvas><canvas id="playhead-canvas"></canvas><canvas id="hover-canvas"></canvas></div></div></div>
        </div>
        <div id="harmony-container"><canvas id="harmony-analysis-canvas"></canvas></div>
        <div id="bottom-content-wrapper">
            <div id="drum-grid-wrapper"><canvas id="drum-grid"></canvas><canvas id="drum-hover-canvas"></canvas></div>
        </div>
      </div>

      <!-- Chord Candidate Drop-up Menu -->
      <div id="chord-candidate-menu" class="hidden">
          <div id="chord-candidate-list"></div>
      </div>
      <div id="chord-candidate-overlay" class="hidden"></div>

    </div>

    <!-- Print Preview Modal and Staging Area (Unchanged) -->
    <div id="print-preview-overlay" class="hidden"><!-- ... --></div>
    <div id="print-staging-area"></div>

    <script>
        document.querySelectorAll('.tab-button').forEach(button => {
            button.addEventListener('click', () => {
                const tabId = button.dataset.tab;
                document.querySelectorAll('.tab-button').forEach(btn => btn.classList.remove('active'));
                button.classList.add('active');
                document.querySelectorAll('.tab-panel').forEach(panel => panel.classList.remove('active'));
                document.getElementById(`${tabId}-panel`).classList.add('active');
            });
        });
    </script>
  </body>
</html>