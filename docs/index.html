<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <title>Student Notation Web Applet</title>
    <link rel="icon" href="/Student-Notation/favicon.ico" sizes="any"><!-- multi-size ICO -->
    <link rel="icon" type="image/png" sizes="96x96" href="/Student-Notation/favicon-96x96.png">
    <link rel="apple-touch-icon" sizes="180x180" href="/Student-Notation/apple-touch-icon.png">
    <link rel="mask-icon" href="/Student-Notation/favicon.svg" color="#a88cf3"><!-- Safari pinned tab -->
    <link rel="manifest" href="/Student-Notation/site.webmanifest">
    <meta name="theme-color" content="#ffffff"> 
    <!-- A dedicated style tag for print rules -->
    <style id="print-style-rules"></style>
    <script type="module" crossorigin src="/Student-Notation/assets/index-CLy39IR0.js"></script>
    <link rel="stylesheet" crossorigin href="/Student-Notation/assets/index-Bg88WQsh.css">
  </head>
  <body>
    <div id="app-container">
      <!-- =======================================================
           Top Toolbar
           ======================================================= -->
      <div id="top-toolbar">
        <!-- Container 1: Export & Import -->
        <div class="top-toolbar-container export-import-container">
            <div class="app-title">Quinn Fleming's<br>Student Notation</div>
            <button class="toolkit-button" id="save-as-button">Save As</button>
            <button class="toolkit-button" id="import-button">Import</button>
            <button class="toolkit-button" id="print-button">Print</button>
        </div>

        <!-- Container 2: Note Tools -->
        <div class="top-toolbar-container note-tools-container">
            <div id="note-bank-container">
                <div class="note-bank-row">
                    <div class="note-pair" data-color="#0000ff">
                        <div class="note circle-note" data-type="circle" aria-label="Blue Circle Note" tabindex="0"></div>
                        <div class="note oval-note"   data-type="oval"   aria-label="Blue Oval Note"   tabindex="0"></div>
                    </div>
                    <div class="note-pair" data-color="#000000">
                        <div class="note circle-note" data-type="circle" aria-label="Black Circle Note" tabindex="0"></div>
                        <div class="note oval-note"   data-type="oval"   aria-label="Black Oval Note"   tabindex="0"></div>
                    </div>
                </div>
                <div class="note-bank-row">
                    <div class="note-pair" data-color="#ff0000">
                        <div class="note circle-note" data-type="circle" aria-label="Red Circle Note" tabindex="0"></div>
                        <div class="note oval-note"   data-type="oval"   aria-label="Red Oval Note"   tabindex="0"></div>
                    </div>
                    <div class="note-pair" data-color="#00ff00">
                        <div class="note circle-note" data-type="circle" aria-label="Green Circle Note" tabindex="0"></div>
                        <div class="note oval-note"   data-type="oval"   aria-label="Green Oval Note"   tabindex="0"></div>
                    </div>
                </div>
            </div>
        </div>
        
        <!-- Container 3: Tonic Sign Tools -->
        <div class="top-toolbar-container tonic-sign-container">
            <button class="tonic-sign-button" data-tonic="1" aria-label="Tonicization 1">‚ë†</button>
            <button class="tonic-sign-button" data-tonic="2" aria-label="Tonicization 2">‚ë°</button>
            <button class="tonic-sign-button" data-tonic="3" aria-label="Tonicization 3">‚ë¢</button>
            <button class="tonic-sign-button" data-tonic="4" aria-label="Tonicization 4">‚ë£</button>
            <button class="tonic-sign-button" data-tonic="5" aria-label="Tonicization 5">‚ë§</button>
            <button class="tonic-sign-button" data-tonic="6" aria-label="Tonicization 6">‚ë•</button>
            <button class="tonic-sign-button" data-tonic="7" aria-label="Tonicization 7">‚ë¶</button>
          <div class="degree-toggle-container" style="grid-column: 1 / -1; margin-top: 5px; width:100%; display: flex; gap: 4px;">
              <button id="toggle-diatonic-degrees" class="toolkit-button" style="flex: 1;">Scale Degrees</button>
              <button id="toggle-modal-degrees" class="toolkit-button" style="flex: 1;">Mode Degrees</button>
          </div>
        </div>

        <!-- Container 4: Waveform Presets -->
        <div class="top-toolbar-container preset-container">
            <div id="preset-buttons">
              <div id="preset-column-1" class="preset-column">
                  <button class="preset-button" id="preset-sine">Sine</button>
                  <button class="preset-button" id="preset-triangle">Triangle</button>
                  <button class="preset-button" id="preset-square">Square</button>
                  <button class="preset-button" id="preset-sawtooth">Sawtooth</button>
              </div>
              <div id="preset-column-2" class="preset-column">
                  <button class="preset-button" id="preset-piano">Piano</button>
                  <button class="preset-button" id="preset-marimba">Marimba</button>
                  <button class="preset-button" id="preset-woodwind">Woodwind</button>
                  <button class="preset-button" id="preset-strings">Strings</button>

                  
              </div>
            </div>
        </div>

        <!-- Container 5: Harmonic Multislider -->
        <div class="top-toolbar-container multislider-container">
          <div class="buffer-container">
            <canvas id="harmonic-multislider-canvas"></canvas>
          </div>
        </div>

        <!-- Container 6: ADSR Visualization -->
        <div class="top-toolbar-container adsr-container">
          <div class="adsr-main-panel">
            <div class="adsr-graph-wrapper">
              <div id="adsr-envelope"></div>
            </div>
            <div class="sustain-slider-wrapper">
              <div id="sustain-slider-track">
                <div id="sustain-slider-thumb" tabindex="0">S</div>
              </div>
            </div>
          </div>
          <div id="multi-thumb-slider-container">
            <div class="time-slider-thumb" id="thumb-a" tabindex="0">A</div>
            <div class="time-slider-thumb" id="thumb-d" tabindex="0">D</div>
            <div class="time-slider-thumb" id="thumb-r" tabindex="0">R</div>
          </div>
        </div>
      </div>
      <!-- End Top Toolbar -->

      <!-- Middle Section -->
      <div id="middle-section">
        <div id="grid-container-wrapper">
          <div id="time-signature-display"></div>
          <div id="grid-controls-container">
            <div id="beat-line-controls"></div>
          </div>
          <div id="pitch-grid-container">
            <div id="grid-container">
              <div id="pitch-canvas-wrapper">
                <canvas id="notation-grid"></canvas>
                <canvas id="playhead-canvas"></canvas>
                <canvas id="hover-canvas"></canvas>
              </div>
            </div>
          </div>
        </div>
        <!-- NEW WRAPPER for Grid Layout -->
        <div id="bottom-content-wrapper">
            <div id="drum-grid-wrapper">
                <canvas id="drum-grid"></canvas>
                <canvas id="drum-hover-canvas"></canvas>
            </div>
            <!-- NEW CONTAINER for the right side -->
            <div id="right-side-container">
                <button class="toolkit-button" id="macrobeat-increase" aria-label="Increase Macrobeat">+</button>
                <button class="toolkit-button" id="macrobeat-decrease" aria-label="Decrease Macrobeat">‚Äì</button>
            </div>
        </div>
      </div>

      <!-- Bottom Toolbar -->
      <div id="bottom-toolbar">
        <div class="bottom-toolbar-container grid-nav-container">
          <div id="grid-nav-keypad">
            <button class="toolkit-button" id="grid-scroll-up" aria-label="Scroll Grid Up">‚ñ≤</button>
            <button class="toolkit-button" id="grid-zoom-in" aria-label="Zoom In">üîç</button>
            <button class="toolkit-button" id="grid-scroll-down" aria-label="Scroll Grid Down">‚ñº</button>
            <button class="toolkit-button" id="grid-zoom-out" aria-label="Zoom Out">üîé</button>
          </div>
        </div>
        <div class="bottom-toolbar-container volume-container">
          <div id="volume-container">
            <input type="range" id="volume-slider" min="0" max="100" value="75" step="1" aria-label="Volume Slider" />
            <div class="slider-label">Volume</div>
          </div>
        </div>
        <div class="bottom-toolbar-container play-controls-container">
          <div id="play-button-group">
            <button class="toolkit-button" id="play-button" aria-label="Play Music">‚èµ</button>
            <button class="toolkit-button" id="stop-button" aria-label="Stop Music">‚èπ</button>
            <button class="toolkit-button" id="loop-button" aria-label="Loop Playback">üîÅ</button>
            <button class="toolkit-button" id="undo-button" aria-label="Undo">Undo</button>
            <button class="toolkit-button" id="redo-button" aria-label="Redo">Redo</button>
            <button class="toolkit-button" id="clear-button" aria-label="Clear Notes">Clear</button>
          </div>
        </div>
        <div class="bottom-toolbar-container tempo-container">
          <div id="tempo-container">
            <div id="tempo-display-container">
                <div class="tempo-input-group">
                    <span class="tempo-label">‚ô™</span>
                    <input type="number" id="eighth-note-tempo" class="tempo-input">
                </div>
                <div class="tempo-input-group">
                    <span class="tempo-label">‚ô©</span>
                    <input type="number" id="quarter-note-tempo" class="tempo-input">
                </div>
                <div class="tempo-input-group">
                    <span class="tempo-label">‚ô©.</span>
                    <input type="number" id="dotted-quarter-tempo" class="tempo-input">
                </div>
            </div>
            <input type="range" id="tempo-slider" min="30" max="240" value="90" step="1" aria-label="Tempo Slider" />
            <div class="slider-label">Tempo</div>
          </div>
        </div>
      </div>
    </div>

    <!-- NEW: Print Preview Modal -->
    <div id="print-preview-overlay" class="hidden">
      <div id="print-preview-modal">
        <div class="print-preview-header">
          <h2>Print Preview & Options</h2>
          <button id="print-close-button" class="close-button">√ó</button>
        </div>
        <div class="print-preview-content">
          <div class="print-preview-canvas-wrapper">
            <canvas id="print-preview-canvas"></canvas>
          </div>
          <div class="print-preview-options">
            <h3>Crop Range</h3>
            <div class="print-option-row">
              <label for="print-top-row-slider">Top Row:</label>
              <span id="print-top-row-label">C8</span>
              <input type="range" id="print-top-row-slider" min="0" max="87" value="0">
            </div>
            <div class="print-option-row">
              <label for="print-bottom-row-slider">Bottom Row:</label>
              <span id="print-bottom-row-label">C1</span>
              <input type="range" id="print-bottom-row-slider" min="0" max="87" value="87">
            </div>
            <h3>Options</h3>
            <div class="print-option-row">
              <label for="print-orientation-toggle">Orientation:</label>
              <button id="print-orientation-toggle" class="toggle-button">Landscape</button>
            </div>
             <div class="print-option-row">
              <label for="print-color-mode-toggle">Color Mode:</label>
              <button id="print-color-mode-toggle" class="toggle-button active">Color</button>
            </div>
            <div class="print-option-row">
              <label for="print-drums-toggle">Include Drums:</label>
              <button id="print-drums-toggle" class="toggle-button active">Yes</button>
            </div>
          </div>
        </div>
        <div class="print-preview-footer">
          <button id="print-confirm-button" class="confirm-button">Print Score</button>
        </div>
      </div>
    </div>

    <!-- NEW: Hidden staging area for the final print image -->
    <div id="print-staging-area"></div>

  </body>
</html>