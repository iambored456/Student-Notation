(function(){const N=document.createElement("link").relList;if(N&&N.supports&&N.supports("modulepreload"))return;for(const m of document.querySelectorAll('link[rel="modulepreload"]'))P(m);new MutationObserver(m=>{for(const C of m)if(C.type==="childList")for(const k of C.addedNodes)k.tagName==="LINK"&&k.rel==="modulepreload"&&P(k)}).observe(document,{childList:!0,subtree:!0});function D(m){const C={};return m.integrity&&(C.integrity=m.integrity),m.referrerPolicy&&(C.referrerPolicy=m.referrerPolicy),m.crossOrigin==="use-credentials"?C.credentials="include":m.crossOrigin==="anonymous"?C.credentials="omit":C.credentials="same-origin",C}function P(m){if(m.ep)return;m.ep=!0;const C=D(m);fetch(m.href,C)}})();function Pl(A){return A&&A.__esModule&&Object.prototype.hasOwnProperty.call(A,"default")?A.default:A}var Fn={exports:{}};/*! For license information please see Tone.js.LICENSE.txt */var ql=Fn.exports,Ua;function Nl(){return Ua||(Ua=1,function(A,N){(function(D,P){A.exports=P()})(typeof self<"u"?self:ql,()=>(()=>{var D={871:function(k,M,I){(function(w,x,y,g){var d=function(rt,ht,ct){return{endTime:ht,insertTime:ct,type:"exponentialRampToValue",value:rt}},c=function(rt,ht,ct){return{endTime:ht,insertTime:ct,type:"linearRampToValue",value:rt}},l=function(rt,ht){return{startTime:ht,type:"setValue",value:rt}},a=function(rt,ht,ct){return{duration:ct,startTime:ht,type:"setValueCurve",values:rt}},h=function(rt,ht,ct){var At=ct.startTime,ut=ct.target,Nt=ct.timeConstant;return ut+(ht-ut)*Math.exp((At-rt)/Nt)},v=function(rt){return rt.type==="exponentialRampToValue"},_=function(rt){return rt.type==="linearRampToValue"},E=function(rt){return v(rt)||_(rt)},V=function(rt){return rt.type==="setValue"},L=function(rt){return rt.type==="setValueCurve"},Q=function rt(ht,ct,At,ut){var Nt=ht[ct];return Nt===void 0?ut:E(Nt)||V(Nt)?Nt.value:L(Nt)?Nt.values[Nt.values.length-1]:h(At,rt(ht,ct-1,Nt.startTime,ut),Nt)},et=function(rt,ht,ct,At,ut){return ct===void 0?[At.insertTime,ut]:E(ct)?[ct.endTime,ct.value]:V(ct)?[ct.startTime,ct.value]:L(ct)?[ct.startTime+ct.duration,ct.values[ct.values.length-1]]:[ct.startTime,Q(rt,ht-1,ct.startTime,ut)]},st=function(rt){return rt.type==="cancelAndHold"},vt=function(rt){return rt.type==="cancelScheduledValues"},St=function(rt){return st(rt)||vt(rt)?rt.cancelTime:v(rt)||_(rt)?rt.endTime:rt.startTime},kt=function(rt,ht,ct,At){var ut=At.endTime,Nt=At.value;return ct===Nt?Nt:0<ct&&0<Nt||ct<0&&Nt<0?ct*Math.pow(Nt/ct,(rt-ht)/(ut-ht)):0},ue=function(rt,ht,ct,At){return ct+(rt-ht)/(At.endTime-ht)*(At.value-ct)},Xe=function(rt,ht){var ct=ht.duration,At=ht.startTime,ut=ht.values;return function(Nt,Xt){var Bt=Math.floor(Xt),de=Math.ceil(Xt);return Bt===de?Nt[Bt]:(1-(Xt-Bt))*Nt[Bt]+(1-(de-Xt))*Nt[de]}(ut,(rt-At)/ct*(ut.length-1))},Be=function(rt){return rt.type==="setTarget"},as=function(){return g(function rt(ht){y(this,rt),this._automationEvents=[],this._currenTime=0,this._defaultValue=ht},[{key:Symbol.iterator,value:function(){return this._automationEvents[Symbol.iterator]()}},{key:"add",value:function(rt){var ht=St(rt);if(st(rt)||vt(rt)){var ct=this._automationEvents.findIndex(function(Ie){return vt(rt)&&L(Ie)?Ie.startTime+Ie.duration>=ht:St(Ie)>=ht}),At=this._automationEvents[ct];if(ct!==-1&&(this._automationEvents=this._automationEvents.slice(0,ct)),st(rt)){var ut=this._automationEvents[this._automationEvents.length-1];if(At!==void 0&&E(At)){if(ut!==void 0&&Be(ut))throw new Error("The internal list is malformed.");var Nt=ut===void 0?At.insertTime:L(ut)?ut.startTime+ut.duration:St(ut),Xt=ut===void 0?this._defaultValue:L(ut)?ut.values[ut.values.length-1]:ut.value,Bt=v(At)?kt(ht,Nt,Xt,At):ue(ht,Nt,Xt,At),de=v(At)?d(Bt,ht,this._currenTime):c(Bt,ht,this._currenTime);this._automationEvents.push(de)}if(ut!==void 0&&Be(ut)&&this._automationEvents.push(l(this.getValue(ht),ht)),ut!==void 0&&L(ut)&&ut.startTime+ut.duration>ht){var Ms=ht-ut.startTime,ee=(ut.values.length-1)/ut.duration,Ye=Math.max(2,1+Math.ceil(Ms*ee)),gs=Ms/(Ye-1)*ee,Ds=ut.values.slice(0,Ye);if(gs<1)for(var He=1;He<Ye;He+=1){var vs=gs*He%1;Ds[He]=ut.values[He-1]*(1-vs)+ut.values[He]*vs}this._automationEvents[this._automationEvents.length-1]=a(Ds,ut.startTime,Ms)}}}else{var De=this._automationEvents.findIndex(function(Ie){return St(Ie)>ht}),Is=De===-1?this._automationEvents[this._automationEvents.length-1]:this._automationEvents[De-1];if(Is!==void 0&&L(Is)&&St(Is)+Is.duration>ht)return!1;var vi=v(rt)?d(rt.value,rt.endTime,this._currenTime):_(rt)?c(rt.value,ht,this._currenTime):rt;if(De===-1)this._automationEvents.push(vi);else{if(L(rt)&&ht+rt.duration>St(this._automationEvents[De]))return!1;this._automationEvents.splice(De,0,vi)}}return!0}},{key:"flush",value:function(rt){var ht=this._automationEvents.findIndex(function(ut){return St(ut)>rt});if(ht>1){var ct=this._automationEvents.slice(ht-1),At=ct[0];Be(At)&&ct.unshift(l(Q(this._automationEvents,ht-2,At.startTime,this._defaultValue),At.startTime)),this._automationEvents=ct}}},{key:"getValue",value:function(rt){if(this._automationEvents.length===0)return this._defaultValue;var ht=this._automationEvents.findIndex(function(Ds){return St(Ds)>rt}),ct=this._automationEvents[ht],At=(ht===-1?this._automationEvents.length:ht)-1,ut=this._automationEvents[At];if(ut!==void 0&&Be(ut)&&(ct===void 0||!E(ct)||ct.insertTime>rt))return h(rt,Q(this._automationEvents,At-1,ut.startTime,this._defaultValue),ut);if(ut!==void 0&&V(ut)&&(ct===void 0||!E(ct)))return ut.value;if(ut!==void 0&&L(ut)&&(ct===void 0||!E(ct)||ut.startTime+ut.duration>rt))return rt<ut.startTime+ut.duration?Xe(rt,ut):ut.values[ut.values.length-1];if(ut!==void 0&&E(ut)&&(ct===void 0||!E(ct)))return ut.value;if(ct!==void 0&&v(ct)){var Nt=et(this._automationEvents,At,ut,ct,this._defaultValue),Xt=x(Nt,2),Bt=Xt[0],de=Xt[1];return kt(rt,Bt,de,ct)}if(ct!==void 0&&_(ct)){var Ms=et(this._automationEvents,At,ut,ct,this._defaultValue),ee=x(Ms,2),Ye=ee[0],gs=ee[1];return ue(rt,Ye,gs,ct)}return this._defaultValue}}])}();w.AutomationEventList=as,w.createCancelAndHoldAutomationEvent=function(rt){return{cancelTime:rt,type:"cancelAndHold"}},w.createCancelScheduledValuesAutomationEvent=function(rt){return{cancelTime:rt,type:"cancelScheduledValues"}},w.createExponentialRampToValueAutomationEvent=function(rt,ht){return{endTime:ht,type:"exponentialRampToValue",value:rt}},w.createLinearRampToValueAutomationEvent=function(rt,ht){return{endTime:ht,type:"linearRampToValue",value:rt}},w.createSetTargetAutomationEvent=function(rt,ht,ct){return{startTime:ht,target:rt,timeConstant:ct,type:"setTarget"}},w.createSetValueAutomationEvent=l,w.createSetValueCurveAutomationEvent=a})(M,I(821),I(805),I(989))},113:k=>{k.exports=function(M,I){(I==null||I>M.length)&&(I=M.length);for(var w=0,x=new Array(I);w<I;w++)x[w]=M[w];return x},k.exports.__esModule=!0,k.exports.default=k.exports},569:k=>{k.exports=function(M){if(Array.isArray(M))return M},k.exports.__esModule=!0,k.exports.default=k.exports},805:k=>{k.exports=function(M,I){if(!(M instanceof I))throw new TypeError("Cannot call a class as a function")},k.exports.__esModule=!0,k.exports.default=k.exports},989:(k,M,I)=>{var w=I(498);function x(y,g){for(var d=0;d<g.length;d++){var c=g[d];c.enumerable=c.enumerable||!1,c.configurable=!0,"value"in c&&(c.writable=!0),Object.defineProperty(y,w(c.key),c)}}k.exports=function(y,g,d){return g&&x(y.prototype,g),d&&x(y,d),Object.defineProperty(y,"prototype",{writable:!1}),y},k.exports.__esModule=!0,k.exports.default=k.exports},474:k=>{k.exports=function(M,I){var w=M==null?null:typeof Symbol<"u"&&M[Symbol.iterator]||M["@@iterator"];if(w!=null){var x,y,g,d,c=[],l=!0,a=!1;try{if(g=(w=w.call(M)).next,I===0){if(Object(w)!==w)return;l=!1}else for(;!(l=(x=g.call(w)).done)&&(c.push(x.value),c.length!==I);l=!0);}catch(h){a=!0,y=h}finally{try{if(!l&&w.return!=null&&(d=w.return(),Object(d)!==d))return}finally{if(a)throw y}}return c}},k.exports.__esModule=!0,k.exports.default=k.exports},18:k=>{k.exports=function(){throw new TypeError(`Invalid attempt to destructure non-iterable instance.
In order to be iterable, non-array objects must have a [Symbol.iterator]() method.`)},k.exports.__esModule=!0,k.exports.default=k.exports},821:(k,M,I)=>{var w=I(569),x=I(474),y=I(744),g=I(18);k.exports=function(d,c){return w(d)||x(d,c)||y(d,c)||g()},k.exports.__esModule=!0,k.exports.default=k.exports},327:(k,M,I)=>{var w=I(564).default;k.exports=function(x,y){if(w(x)!="object"||!x)return x;var g=x[Symbol.toPrimitive];if(g!==void 0){var d=g.call(x,y||"default");if(w(d)!="object")return d;throw new TypeError("@@toPrimitive must return a primitive value.")}return(y==="string"?String:Number)(x)},k.exports.__esModule=!0,k.exports.default=k.exports},498:(k,M,I)=>{var w=I(564).default,x=I(327);k.exports=function(y){var g=x(y,"string");return w(g)=="symbol"?g:g+""},k.exports.__esModule=!0,k.exports.default=k.exports},564:k=>{function M(I){return k.exports=M=typeof Symbol=="function"&&typeof Symbol.iterator=="symbol"?function(w){return typeof w}:function(w){return w&&typeof Symbol=="function"&&w.constructor===Symbol&&w!==Symbol.prototype?"symbol":typeof w},k.exports.__esModule=!0,k.exports.default=k.exports,M(I)}k.exports=M,k.exports.__esModule=!0,k.exports.default=k.exports},744:(k,M,I)=>{var w=I(113);k.exports=function(x,y){if(x){if(typeof x=="string")return w(x,y);var g=Object.prototype.toString.call(x).slice(8,-1);return g==="Object"&&x.constructor&&(g=x.constructor.name),g==="Map"||g==="Set"?Array.from(x):g==="Arguments"||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(g)?w(x,y):void 0}},k.exports.__esModule=!0,k.exports.default=k.exports}},P={};function m(k){var M=P[k];if(M!==void 0)return M.exports;var I=P[k]={exports:{}};return D[k].call(I.exports,I,I.exports,m),I.exports}m.d=(k,M)=>{for(var I in M)m.o(M,I)&&!m.o(k,I)&&Object.defineProperty(k,I,{enumerable:!0,get:M[I]})},m.o=(k,M)=>Object.prototype.hasOwnProperty.call(k,M),m.r=k=>{typeof Symbol<"u"&&Symbol.toStringTag&&Object.defineProperty(k,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(k,"__esModule",{value:!0})};var C={};return(()=>{m.r(C),m.d(C,{AMOscillator:()=>Di,AMSynth:()=>ko,Abs:()=>Ma,Add:()=>Ls,AmplitudeEnvelope:()=>pi,Analyser:()=>Zi,AudioToGain:()=>Tn,AutoFilter:()=>Fo,AutoPanner:()=>Lo,AutoWah:()=>Vo,BaseContext:()=>po,BiquadFilter:()=>qi,BitCrusher:()=>zo,Buffer:()=>Ml,BufferSource:()=>Il,Buffers:()=>Dl,Channel:()=>js,Chebyshev:()=>jo,Chorus:()=>Go,Clock:()=>oi,Compressor:()=>ms,Context:()=>Ks,Convolver:()=>fr,CrossFade:()=>fi,DCMeter:()=>or,Delay:()=>Le,Destination:()=>bl,Distortion:()=>Uo,Draw:()=>Sl,DuoSynth:()=>So,EQ3:()=>pr,Emitter:()=>Js,Envelope:()=>ve,FFT:()=>nr,FMOscillator:()=>li,FMSynth:()=>Co,FatOscillator:()=>Ii,FeedbackCombFilter:()=>Li,FeedbackDelay:()=>Xo,Filter:()=>ze,Follower:()=>Xi,Freeverb:()=>Ho,Frequency:()=>Jc,FrequencyClass:()=>we,FrequencyEnvelope:()=>Ni,FrequencyShifter:()=>Yo,Gain:()=>ft,GainToAudio:()=>Da,Gate:()=>cr,GrainPlayer:()=>To,GreaterThan:()=>Sn,GreaterThanZero:()=>kn,IntervalTimeline:()=>Sa,JCReverb:()=>Zo,LFO:()=>Ae,Limiter:()=>lr,Listener:()=>Al,Loop:()=>ji,LowpassCombFilter:()=>zi,Master:()=>wl,MembraneSynth:()=>Fi,Merge:()=>Cs,MetalSynth:()=>Oo,Meter:()=>ir,MidSideCompressor:()=>ur,MidSideMerge:()=>Hi,MidSideSplit:()=>Yi,Midi:()=>il,MidiClass:()=>ai,Mono:()=>ar,MonoSynth:()=>zs,MultibandCompressor:()=>dr,MultibandSplit:()=>$i,Multiply:()=>$t,Negate:()=>Ao,Noise:()=>ks,NoiseSynth:()=>Eo,Offline:()=>sl,OfflineContext:()=>ti,OmniOscillator:()=>ds,OnePoleFilter:()=>Vi,Oscillator:()=>Zt,PWMOscillator:()=>Ri,PanVol:()=>Dn,Panner:()=>Ui,Panner3D:()=>hr,Param:()=>xt,Part:()=>Wi,Pattern:()=>qo,Phaser:()=>Jo,PingPongDelay:()=>$o,PitchShift:()=>Qo,Player:()=>di,Players:()=>wo,PluckSynth:()=>Ro,PolySynth:()=>Po,Pow:()=>hi,PulseOscillator:()=>ui,Recorder:()=>In,Reverb:()=>Ko,Sampler:()=>Bi,Scale:()=>ps,ScaleExp:()=>Cn,Sequence:()=>No,Signal:()=>_t,Solo:()=>ie,Split:()=>Bs,StateTimeline:()=>ii,StereoWidener:()=>tr,Subtract:()=>Vs,SyncedSignal:()=>hl,Synth:()=>Ss,Ticks:()=>nl,TicksClass:()=>Ht,Time:()=>Zc,TimeClass:()=>Ne,Timeline:()=>qe,ToneAudioBuffer:()=>Mt,ToneAudioBuffers:()=>ri,ToneAudioNode:()=>tt,ToneBufferSource:()=>As,ToneEvent:()=>is,ToneOscillatorNode:()=>Mi,Transport:()=>yl,TransportTime:()=>Kc,TransportTimeClass:()=>oe,Tremolo:()=>er,Unit:()=>M,UserMedia:()=>Ei,Vibrato:()=>sr,Volume:()=>ls,WaveShaper:()=>ts,Waveform:()=>rr,Zero:()=>An,connect:()=>Te,connectSeries:()=>Fe,connectSignal:()=>Oi,context:()=>Ol,dbToGain:()=>ei,debug:()=>k,defaultArg:()=>Ge,disconnect:()=>go,fanIn:()=>tl,ftom:()=>ws,gainToDb:()=>Ci,getContext:()=>Wt,getDestination:()=>Tl,getDraw:()=>Cl,getListener:()=>kl,getTransport:()=>xl,immediate:()=>_l,intervalToFrequencyRatio:()=>si,isArray:()=>fe,isBoolean:()=>ro,isDefined:()=>Tt,isFunction:()=>va,isNote:()=>Ai,isNumber:()=>Re,isObject:()=>hs,isString:()=>Qe,isUndef:()=>Se,loaded:()=>El,mtof:()=>fo,now:()=>vl,optionsFromArguments:()=>Z,setContext:()=>yn,start:()=>Hc,supported:()=>Wc,version:()=>I});var k={};m.r(k),m.d(k,{assert:()=>mt,assertContextRunning:()=>ao,assertRange:()=>me,assertUsedScheduleTime:()=>xa,enterScheduledCallback:()=>ho,log:()=>ba,setLogger:()=>Gc,warn:()=>Zs});var M={};m.r(M);const I="15.0.4";var w=m(871);const x=new WeakSet,y=new WeakMap,g=new WeakMap,d=new WeakMap,c=new WeakMap,l=new WeakMap,a=new WeakMap,h=new WeakMap,v=new WeakMap,_=new WeakMap,E={construct:()=>E},V=/^import(?:(?:[\s]+[\w]+|(?:[\s]+[\w]+[\s]*,)?[\s]*\{[\s]*[\w]+(?:[\s]+as[\s]+[\w]+)?(?:[\s]*,[\s]*[\w]+(?:[\s]+as[\s]+[\w]+)?)*[\s]*}|(?:[\s]+[\w]+[\s]*,)?[\s]*\*[\s]+as[\s]+[\w]+)[\s]+from)?(?:[\s]*)("([^"\\]|\\.)+"|'([^'\\]|\\.)+')(?:[\s]*);?/,L=(n,t)=>{const e=[];let s=n.replace(/^[\s]+/,""),i=s.match(V);for(;i!==null;){const o=i[1].slice(1,-1),r=i[0].replace(/([\s]+)?;?$/,"").replace(o,new URL(o,t).toString());e.push(r),s=s.slice(i[0].length).replace(/^[\s]+/,""),i=s.match(V)}return[e.join(";"),s]},Q=n=>{if(n!==void 0&&!Array.isArray(n))throw new TypeError("The parameterDescriptors property of given value for processorCtor is not an array.")},et=n=>{if(!(t=>{try{new new Proxy(t,E)}catch{return!1}return!0})(n))throw new TypeError("The given value for processorCtor should be a constructor.");if(n.prototype===null||typeof n.prototype!="object")throw new TypeError("The given value for processorCtor should have a prototype.")},st=(n,t)=>{const e=n.get(t);if(e===void 0)throw new Error("A value with the given key could not be found.");return e},vt=(n,t)=>{const e=Array.from(n).filter(t);if(e.length>1)throw Error("More than one element was found.");if(e.length===0)throw Error("No element was found.");const[s]=e;return n.delete(s),s},St=(n,t,e,s)=>{const i=st(n,t),o=vt(i,r=>r[0]===e&&r[1]===s);return i.size===0&&n.delete(t),o},kt=n=>st(a,n),ue=n=>{if(x.has(n))throw new Error("The AudioNode is already stored.");x.add(n),kt(n).forEach(t=>t(!0))},Xe=n=>"port"in n,Be=n=>{if(!x.has(n))throw new Error("The AudioNode is not stored.");x.delete(n),kt(n).forEach(t=>t(!1))},as=(n,t)=>{!Xe(n)&&t.every(e=>e.size===0)&&Be(n)},rt={channelCount:2,channelCountMode:"max",channelInterpretation:"speakers",fftSize:2048,maxDecibels:-30,minDecibels:-100,smoothingTimeConstant:.8},ht=(n,t)=>n.context===t,ct=n=>{try{n.copyToChannel(new Float32Array(1),0,-1)}catch{return!1}return!0},At=()=>new DOMException("","IndexSizeError"),ut=n=>{var t;n.getChannelData=(t=n.getChannelData,e=>{try{return t.call(n,e)}catch(s){throw s.code===12?At():s}})},Nt={numberOfChannels:1},Xt=-34028234663852886e22,Bt=34028234663852886e22,de=n=>x.has(n),Ms={buffer:null,channelCount:2,channelCountMode:"max",channelInterpretation:"speakers",loop:!1,loopEnd:0,loopStart:0,playbackRate:1},ee=n=>st(y,n),Ye=n=>st(d,n),gs=(n,t)=>{const{activeInputs:e}=ee(n);e.forEach(i=>i.forEach(([o])=>{t.includes(n)||gs(o,[...t,n])}));const s=(i=>"playbackRate"in i)(n)?[n.playbackRate]:Xe(n)?Array.from(n.parameters.values()):(i=>"frequency"in i&&"gain"in i)(n)?[n.Q,n.detune,n.frequency,n.gain]:(i=>"offset"in i)(n)?[n.offset]:(i=>!("frequency"in i)&&"gain"in i)(n)?[n.gain]:(i=>"detune"in i&&"frequency"in i)(n)?[n.detune,n.frequency]:(i=>"pan"in i)(n)?[n.pan]:[];for(const i of s){const o=Ye(i);o!==void 0&&o.activeInputs.forEach(([r])=>gs(r,t))}de(n)&&Be(n)},Ds=n=>{gs(n.destination,[])},He=n=>"context"in n,vs=n=>He(n[0]),De=(n,t,e,s)=>{for(const i of n)if(e(i)){if(s)return!1;throw Error("The set contains at least one similar element.")}return n.add(t),!0},Is=(n,t,[e,s],i)=>{De(n,[t,e,s],o=>o[0]===t&&o[1]===e,i)},vi=(n,[t,e,s],i)=>{const o=n.get(t);o===void 0?n.set(t,new Set([[e,s]])):De(o,[e,s],r=>r[0]===e,i)},Ie=n=>"inputs"in n,sn=(n,t,e,s)=>{if(Ie(t)){const i=t.inputs[s];return n.connect(i,e,0),[i,e,0]}return n.connect(t,e,s),[t,e,s]},Cr=(n,t,e)=>{for(const s of n)if(s[0]===t&&s[1]===e)return n.delete(s),s;return null},Or=(n,t)=>{if(!kt(n).delete(t))throw new Error("Missing the expected event listener.")},Er=(n,t,e)=>{const s=st(n,t),i=vt(s,o=>o[0]===e);return s.size===0&&n.delete(t),i},nn=(n,t,e,s)=>{Ie(t)?n.disconnect(t.inputs[s],e,0):n.disconnect(t,e,s)},jt=n=>st(g,n),_i=n=>st(c,n),Rs=n=>h.has(n),on=n=>!x.has(n),Mr=(n,t)=>new Promise(e=>{if(t!==null)e(!0);else{const s=n.createScriptProcessor(256,1,1),i=n.createGain(),o=n.createBuffer(1,2,44100),r=o.getChannelData(0);r[0]=1,r[1]=1;const u=n.createBufferSource();u.buffer=o,u.loop=!0,u.connect(s).connect(n.destination),u.connect(i),u.disconnect(i),s.onaudioprocess=p=>{const f=p.inputBuffer.getChannelData(0);Array.prototype.some.call(f,b=>b===1)?e(!0):e(!1),u.stop(),s.onaudioprocess=null,u.disconnect(s),s.disconnect(n.destination)},u.start()}}),Gn=(n,t)=>{const e=new Map;for(const s of n)for(const i of s){const o=e.get(i);e.set(i,o===void 0?1:o+1)}e.forEach((s,i)=>t(i,s))},rn=n=>"context"in n,ih=n=>{const t=new Map;n.connect=(e=>(s,i=0,o=0)=>{const r=rn(s)?e(s,i,o):e(s,i),u=t.get(s);return u===void 0?t.set(s,[{input:o,output:i}]):u.every(p=>p.input!==o||p.output!==i)&&u.push({input:o,output:i}),r})(n.connect.bind(n)),n.disconnect=(e=>(s,i,o)=>{if(e.apply(n),s===void 0)t.clear();else if(typeof s=="number")for(const[r,u]of t){const p=u.filter(f=>f.output!==s);p.length===0?t.delete(r):t.set(r,p)}else if(t.has(s))if(i===void 0)t.delete(s);else{const r=t.get(s);if(r!==void 0){const u=r.filter(p=>p.output!==i&&(p.input!==o||o===void 0));u.length===0?t.delete(s):t.set(s,u)}}for(const[r,u]of t)u.forEach(p=>{rn(r)?n.connect(r,p.output,p.input):n.connect(r,p.output)})})(n.disconnect)},Un=(n,t,e,s,i)=>{const[o,r]=((u,p,f,b)=>{const{activeInputs:T,passiveInputs:S}=ee(p),O=Cr(T[b],u,f);return O===null?[St(S,u,f,b)[2],!1]:[O[2],!0]})(n,e,s,i);if(o!==null&&(Or(n,o),!r||t||Rs(n)||nn(jt(n),jt(e),s,i)),de(e)){const{activeInputs:u}=ee(e);as(e,u)}},Xn=(n,t,e,s)=>{const[i,o]=((r,u,p)=>{const{activeInputs:f,passiveInputs:b}=Ye(u),T=Cr(f,r,p);return T===null?[Er(b,r,p)[1],!1]:[T[2],!0]})(n,e,s);i!==null&&(Or(n,i),!o||t||Rs(n)||jt(n).disconnect(_i(e),s))};class Dr{constructor(t){this._map=new Map(t)}get size(){return this._map.size}entries(){return this._map.entries()}forEach(t,e=null){return this._map.forEach((s,i)=>t.call(e,s,i,this))}get(t){return this._map.get(t)}has(t){return this._map.has(t)}keys(){return this._map.keys()}values(){return this._map.values()}}const nh={channelCount:2,channelCountMode:"explicit",channelInterpretation:"speakers",numberOfInputs:1,numberOfOutputs:1,parameterData:{},processorOptions:{}};function an(n,t,e,s,i){if(typeof n.copyFromChannel=="function")t[e].byteLength===0&&(t[e]=new Float32Array(128)),n.copyFromChannel(t[e],s,i);else{const o=n.getChannelData(s);if(t[e].byteLength===0)t[e]=o.slice(i,i+128);else{const r=new Float32Array(o.buffer,i*Float32Array.BYTES_PER_ELEMENT,128);t[e].set(r)}}}const Ir=(n,t,e,s,i)=>{typeof n.copyToChannel=="function"?t[e].byteLength!==0&&n.copyToChannel(t[e],s,i):t[e].byteLength!==0&&n.getChannelData(s).set(t[e],i)},hn=(n,t)=>{const e=[];for(let s=0;s<n;s+=1){const i=[],o=typeof t=="number"?t:t[s];for(let r=0;r<o;r+=1)i.push(new Float32Array(128));e.push(i)}return e},oh=async(n,t,e,s,i,o,r)=>{const u=t===null?128*Math.ceil(n.context.length/128):t.length,p=s.channelCount*s.numberOfInputs,f=i.reduce((R,j)=>R+j,0),b=f===0?null:e.createBuffer(f,u,e.sampleRate);if(o===void 0)throw new Error("Missing the processor constructor.");const T=ee(n),S=await((R,j)=>{const B=st(_,R),q=jt(j);return st(B,q)})(e,n),O=hn(s.numberOfInputs,s.channelCount),z=hn(s.numberOfOutputs,i),F=Array.from(n.parameters.keys()).reduce((R,j)=>({...R,[j]:new Float32Array(128)}),{});for(let R=0;R<u;R+=128){if(s.numberOfInputs>0&&t!==null)for(let j=0;j<s.numberOfInputs;j+=1)for(let B=0;B<s.channelCount;B+=1)an(t,O[j],B,B,R);o.parameterDescriptors!==void 0&&t!==null&&o.parameterDescriptors.forEach(({name:j},B)=>{an(t,F,j,p+B,R)});for(let j=0;j<s.numberOfInputs;j+=1)for(let B=0;B<i[j];B+=1)z[j][B].byteLength===0&&(z[j][B]=new Float32Array(128));try{const j=O.map((q,H)=>T.activeInputs[H].size===0?[]:q),B=r(R/e.sampleRate,e.sampleRate,()=>S.process(j,z,F));if(b!==null)for(let q=0,H=0;q<s.numberOfOutputs;q+=1){for(let J=0;J<i[q];J+=1)Ir(b,z[q],J,H+J,R);H+=i[q]}if(!B)break}catch(j){n.dispatchEvent(new ErrorEvent("processorerror",{colno:j.colno,filename:j.filename,lineno:j.lineno,message:j.message}));break}}return b},rh={Q:1,channelCount:2,channelCountMode:"max",channelInterpretation:"speakers",detune:0,frequency:350,gain:0,type:"lowpass"},ah={channelCount:1,channelCountMode:"explicit",channelInterpretation:"speakers",numberOfInputs:6},hh={channelCount:6,channelCountMode:"explicit",channelInterpretation:"discrete",numberOfOutputs:6},ch={channelCount:2,channelCountMode:"max",channelInterpretation:"speakers",offset:1},lh={buffer:null,channelCount:2,channelCountMode:"clamped-max",channelInterpretation:"speakers",disableNormalization:!1},Rr=n=>{const{port1:t,port2:e}=new MessageChannel;return new Promise(s=>{const i=()=>{e.onmessage=null,t.close(),e.close(),s()};e.onmessage=()=>i();try{t.postMessage(n,[n])}catch{}finally{i()}})},uh={channelCount:2,channelCountMode:"max",channelInterpretation:"speakers",delayTime:0,maxDelayTime:1},cn=(n,t,e)=>{const s=t[e];if(s===void 0)throw n();return s},dh={attack:.003,channelCount:2,channelCountMode:"clamped-max",channelInterpretation:"speakers",knee:30,ratio:12,release:.25,threshold:-24},ph={channelCount:2,channelCountMode:"max",channelInterpretation:"speakers",gain:1},he=()=>new DOMException("","InvalidStateError"),ln=()=>new DOMException("","InvalidAccessError"),fh={channelCount:2,channelCountMode:"max",channelInterpretation:"speakers"},Pr=(n,t,e,s,i,o,r,u,p,f,b)=>{const T=f.length;let S=u;for(let O=0;O<T;O+=1){let z=e[0]*f[O];for(let F=1;F<i;F+=1){const R=S-F&p-1;z+=e[F]*o[R],z-=n[F]*r[R]}for(let F=i;F<s;F+=1)z+=e[F]*o[S-F&p-1];for(let F=i;F<t;F+=1)z-=n[F]*r[S-F&p-1];o[S]=f[O],r[S]=z,S=S+1&p-1,b[O]=z}return S},mh={channelCount:2,channelCountMode:"explicit",channelInterpretation:"speakers"},yi=n=>{const t=new Uint32Array([1179011410,40,1163280727,544501094,16,131073,44100,176400,1048580,1635017060,4,0]);try{const e=n.decodeAudioData(t.buffer,()=>{});return e!==void 0&&(e.catch(()=>{}),!0)}catch{}return!1},Yt=(n,t,e)=>{const s=t[e];s!==void 0&&s!==n[e]&&(n[e]=s)},re=(n,t)=>{Yt(n,t,"channelCount"),Yt(n,t,"channelCountMode"),Yt(n,t,"channelInterpretation")},qr=n=>typeof n.getFloatTimeDomainData=="function",Jt=(n,t,e)=>{const s=t[e];s!==void 0&&s!==n[e].value&&(n[e].value=s)},Yn=n=>{n.start=(t=>(e=0,s=0,i)=>{if(typeof i=="number"&&i<0||s<0||e<0)throw new RangeError("The parameters can't be negative.");t.call(n,e,s,i)})(n.start)},Hn=n=>{var t;n.stop=(t=n.stop,(e=0)=>{if(e<0)throw new RangeError("The parameter can't be negative.");t.call(n,e)})},Nr=(n,t)=>n===null?512:Math.max(512,Math.min(16384,Math.pow(2,Math.round(Math.log2(n*t))))),Fr=(n,t)=>{const e=n.createBiquadFilter();return re(e,t),Jt(e,t,"Q"),Jt(e,t,"detune"),Jt(e,t,"frequency"),Jt(e,t,"gain"),Yt(e,t,"type"),e},xi=(n,t)=>{const e=n.createChannelSplitter(t.numberOfOutputs);return re(e,t),(s=>{const i=s.numberOfOutputs;Object.defineProperty(s,"channelCount",{get:()=>i,set:o=>{if(o!==i)throw he()}}),Object.defineProperty(s,"channelCountMode",{get:()=>"explicit",set:o=>{if(o!=="explicit")throw he()}}),Object.defineProperty(s,"channelInterpretation",{get:()=>"discrete",set:o=>{if(o!=="discrete")throw he()}})})(e),e},Gs=(n,t)=>(n.connect=t.connect.bind(t),n.disconnect=t.disconnect.bind(t),n),Lr=(n,t)=>{const e=n.createDelay(t.maxDelayTime);return re(e,t),Jt(e,t,"delayTime"),e},ke=(n,t)=>{const e=n.createGain();return re(e,t),Jt(e,t,"gain"),e};function gh(n,t){const e=t[0]*t[0]+t[1]*t[1];return[(n[0]*t[0]+n[1]*t[1])/e,(n[1]*t[0]-n[0]*t[1])/e]}function Vr(n,t){let e=[0,0];for(let o=n.length-1;o>=0;o-=1)i=t,e=[(s=e)[0]*i[0]-s[1]*i[1],s[0]*i[1]+s[1]*i[0]],e[0]+=n[o];var s,i;return e}const bi=(n,t,e,s)=>n.createScriptProcessor(t,e,s),be=()=>new DOMException("","NotSupportedError"),vh={numberOfChannels:1},_h={channelCount:2,channelCountMode:"max",channelInterpretation:"speakers",detune:0,frequency:440,periodicWave:void 0,type:"sine"},yh={channelCount:2,channelCountMode:"clamped-max",channelInterpretation:"speakers",coneInnerAngle:360,coneOuterAngle:360,coneOuterGain:0,distanceModel:"inverse",maxDistance:1e4,orientationX:1,orientationY:0,orientationZ:0,panningModel:"equalpower",positionX:0,positionY:0,positionZ:0,refDistance:1,rolloffFactor:1},xh={disableNormalization:!1},bh={channelCount:2,channelCountMode:"explicit",channelInterpretation:"speakers",pan:0},wh=()=>new DOMException("","UnknownError"),Th={channelCount:2,channelCountMode:"max",channelInterpretation:"speakers",curve:null,oversample:"none"},zr=(n,t,e)=>n.copyFromChannel===void 0?n.getChannelData(e)[0]:(n.copyFromChannel(t,e),t[0]),Br=n=>{if(n===null)return!1;const t=n.length;return t%2!=0?n[Math.floor(t/2)]!==0:n[t/2-1]+n[t/2]!==0},wi=(n,t,e,s)=>{let i=n;for(;!i.hasOwnProperty(t);)i=Object.getPrototypeOf(i);const{get:o,set:r}=Object.getOwnPropertyDescriptor(i,t);Object.defineProperty(n,t,{get:e(o),set:s(r)})},jr=(n,t,e)=>{try{n.setValueAtTime(t,e)}catch(s){if(s.code!==9)throw s;jr(n,t,e+1e-7)}},Zn=n=>{const t=n.createOscillator();try{t.start(-1)}catch(e){return e instanceof RangeError}return!1},Wr=n=>{const t=n.createBuffer(1,1,44100),e=n.createBufferSource();e.buffer=t,e.start(),e.stop();try{return e.stop(),!0}catch{return!1}},$n=n=>{const t=n.createOscillator();try{t.stop(-1)}catch(e){return e instanceof RangeError}return!1},Ah=()=>{try{new DOMException}catch{return!1}return!0},kh=()=>new Promise(n=>{const t=new ArrayBuffer(0),{port1:e,port2:s}=new MessageChannel;e.onmessage=({data:i})=>n(i!==null),s.postMessage(t,[t])}),Gr=(n,t)=>{const e=t.createGain();n.connect(e);const s=(i=>()=>{i.call(n,e),n.removeEventListener("ended",s)})(n.disconnect);n.addEventListener("ended",s),Gs(n,e),n.stop=(i=>{let o=!1;return(r=0)=>{if(o)try{i.call(n,r)}catch{e.gain.setValueAtTime(0,r)}else i.call(n,r),o=!0}})(n.stop)},Us=(n,t)=>e=>{const s={value:n};return Object.defineProperties(e,{currentTarget:s,target:s}),typeof t=="function"?t.call(n,e):t.handleEvent.call(n,e)},Sh=(n=>(t,e,[s,i,o],r)=>{n(t[i],[e,s,o],u=>u[0]===e&&u[1]===s,r)})(De),Ch=(n=>(t,e,[s,i,o],r)=>{const u=t.get(s);u===void 0?t.set(s,new Set([[i,e,o]])):n(u,[i,e,o],p=>p[0]===i&&p[1]===e,r)})(De),Oh=(n=>(t,e,s,i)=>n(t[i],o=>o[0]===e&&o[1]===s))(vt),Ur=new WeakMap,Eh=(n=>t=>{var e;return(e=n.get(t))!==null&&e!==void 0?e:0})(Ur),je=(un=new Map,Ti=new WeakMap,(n,t)=>{const e=Ti.get(n);if(e!==void 0)return e;const s=un.get(n);if(s!==void 0)return s;try{const i=t();return i instanceof Promise?(un.set(n,i),i.catch(()=>!1).then(o=>(un.delete(n),Ti.set(n,o),o))):(Ti.set(n,i),i)}catch{return Ti.set(n,!1),!1}});var un,Ti;const Ze=typeof window>"u"?null:window,Xr=((n,t)=>(e,s)=>{const i=e.createAnalyser();if(re(i,s),!(s.maxDecibels>s.minDecibels))throw t();return Yt(i,s,"fftSize"),Yt(i,s,"maxDecibels"),Yt(i,s,"minDecibels"),Yt(i,s,"smoothingTimeConstant"),n(qr,()=>qr(i))||(o=>{o.getFloatTimeDomainData=r=>{const u=new Uint8Array(r.length);o.getByteTimeDomainData(u);const p=Math.max(u.length,o.fftSize);for(let f=0;f<p;f+=1)r[f]=.0078125*(u[f]-128);return r}})(i),i})(je,At),Qn=(n=>t=>{const e=n(t);if(e.renderer===null)throw new Error("Missing the renderer of the given AudioNode in the audio graph.");return e.renderer})(ee),pe=((n,t,e)=>async(s,i,o)=>{const r=n(s);await Promise.all(r.activeInputs.map((u,p)=>Array.from(u).map(async([f,b])=>{const T=t(f),S=await T.render(f,i),O=s.context.destination;e(f)||s===O&&e(s)||S.connect(o,b,p)})).reduce((u,p)=>[...u,...p],[]))})(ee,Qn,Rs),Mh=((n,t,e)=>()=>{const s=new WeakMap;return{render(i,o){const r=s.get(o);return r!==void 0?Promise.resolve(r):(async(u,p)=>{let f=t(u);if(!ht(f,p)){const b={channelCount:f.channelCount,channelCountMode:f.channelCountMode,channelInterpretation:f.channelInterpretation,fftSize:f.fftSize,maxDecibels:f.maxDecibels,minDecibels:f.minDecibels,smoothingTimeConstant:f.smoothingTimeConstant};f=n(p,b)}return s.set(p,f),await e(u,p,f),f})(i,o)}}})(Xr,jt,pe),zt=(Yr=l,n=>{const t=Yr.get(n);if(t===void 0)throw he();return t});var Yr;const ce=(n=>n===null?null:n.hasOwnProperty("OfflineAudioContext")?n.OfflineAudioContext:n.hasOwnProperty("webkitOfflineAudioContext")?n.webkitOfflineAudioContext:null)(Ze),Ft=(n=>t=>n!==null&&t instanceof n)(ce),Hr=new WeakMap,Zr=(n=>class{constructor(t){this._nativeEventTarget=t,this._listeners=new WeakMap}addEventListener(t,e,s){if(e!==null){let i=this._listeners.get(e);i===void 0&&(i=n(this,e),typeof e=="function"&&this._listeners.set(e,i)),this._nativeEventTarget.addEventListener(t,i,s)}}dispatchEvent(t){return this._nativeEventTarget.dispatchEvent(t)}removeEventListener(t,e,s){const i=e===null?void 0:this._listeners.get(e);this._nativeEventTarget.removeEventListener(t,i===void 0?null:i,s)}})(Us),_s=(n=>n===null?null:n.hasOwnProperty("AudioContext")?n.AudioContext:n.hasOwnProperty("webkitAudioContext")?n.webkitAudioContext:null)(Ze),Jn=(n=>t=>n!==null&&t instanceof n)(_s),Kn=(n=>t=>n!==null&&typeof n.AudioNode=="function"&&t instanceof n.AudioNode)(Ze),$r=(n=>t=>n!==null&&typeof n.AudioParam=="function"&&t instanceof n.AudioParam)(Ze),Xs=(n=>n===null?null:n.hasOwnProperty("AudioWorkletNode")?n.AudioWorkletNode:null)(Ze),se=((n,t,e,s,i,o,r,u,p,f,b,T,S,O,z,F)=>class extends f{constructor(R,j,B,q){super(B),this._context=R,this._nativeAudioNode=B;const H=b(R);T(H)&&e(Mr,()=>Mr(H,F))!==!0&&ih(B),g.set(this,B),a.set(this,new Set),R.state!=="closed"&&j&&ue(this),n(this,q,B)}get channelCount(){return this._nativeAudioNode.channelCount}set channelCount(R){this._nativeAudioNode.channelCount=R}get channelCountMode(){return this._nativeAudioNode.channelCountMode}set channelCountMode(R){this._nativeAudioNode.channelCountMode=R}get channelInterpretation(){return this._nativeAudioNode.channelInterpretation}set channelInterpretation(R){this._nativeAudioNode.channelInterpretation=R}get context(){return this._context}get numberOfInputs(){return this._nativeAudioNode.numberOfInputs}get numberOfOutputs(){return this._nativeAudioNode.numberOfOutputs}connect(R,j=0,B=0){if(j<0||j>=this._nativeAudioNode.numberOfOutputs)throw i();const q=b(this._context),H=z(q);if(S(R)||O(R))throw o();if(He(R)){const G=jt(R);try{const Y=sn(this._nativeAudioNode,G,j,B),W=on(this);(H||W)&&this._nativeAudioNode.disconnect(...Y),this.context.state!=="closed"&&!W&&on(R)&&ue(R)}catch(Y){throw Y.code===12?o():Y}if(t(this,R,j,B,H)){const Y=p([this],R);Gn(Y,s(H))}return R}const J=_i(R);if(J.name==="playbackRate"&&J.maxValue===1024)throw r();try{this._nativeAudioNode.connect(J,j),(H||on(this))&&this._nativeAudioNode.disconnect(J,j)}catch(G){throw G.code===12?o():G}if(((G,Y,W,K)=>{const{activeInputs:X,passiveInputs:$}=Ye(Y),{outputs:nt}=ee(G),ot=kt(G),yt=pt=>{const dt=jt(G),bt=_i(Y);if(pt){const lt=Er($,G,W);Is(X,G,lt,!1),K||Rs(G)||dt.connect(bt,W)}else{const lt=((wt,Et,It)=>vt(wt,Gt=>Gt[0]===Et&&Gt[1]===It))(X,G,W);vi($,lt,!1),K||Rs(G)||dt.disconnect(bt,W)}};return!!De(nt,[Y,W],pt=>pt[0]===Y&&pt[1]===W,!0)&&(ot.add(yt),de(G)?Is(X,G,[W,yt],!0):vi($,[G,W,yt],!0),!0)})(this,R,j,H)){const G=p([this],R);Gn(G,s(H))}}disconnect(R,j,B){let q;const H=b(this._context),J=z(H);if(R===void 0)q=((G,Y)=>{const W=ee(G),K=[];for(const X of W.outputs)vs(X)?Un(G,Y,...X):Xn(G,Y,...X),K.push(X[0]);return W.outputs.clear(),K})(this,J);else if(typeof R=="number"){if(R<0||R>=this.numberOfOutputs)throw i();q=((G,Y,W)=>{const K=ee(G),X=[];for(const $ of K.outputs)$[1]===W&&(vs($)?Un(G,Y,...$):Xn(G,Y,...$),X.push($[0]),K.outputs.delete($));return X})(this,J,R)}else{if(j!==void 0&&(j<0||j>=this.numberOfOutputs)||He(R)&&B!==void 0&&(B<0||B>=R.numberOfInputs))throw i();if(q=((G,Y,W,K,X)=>{const $=ee(G);return Array.from($.outputs).filter(nt=>!(nt[0]!==W||K!==void 0&&nt[1]!==K||X!==void 0&&nt[2]!==X)).map(nt=>(vs(nt)?Un(G,Y,...nt):Xn(G,Y,...nt),$.outputs.delete(nt),nt[0]))})(this,J,R,j,B),q.length===0)throw o()}for(const G of q){const Y=p([this],G);Gn(Y,u)}}})((Qr=y,(n,t,e)=>{const s=[];for(let i=0;i<e.numberOfInputs;i+=1)s.push(new Set);Qr.set(n,{activeInputs:s,outputs:new Set,passiveInputs:new WeakMap,renderer:t})}),((n,t,e,s,i,o,r,u,p,f,b,T,S)=>{const O=new WeakMap;return(z,F,R,j,B)=>{const{activeInputs:q,passiveInputs:H}=o(F),{outputs:J}=o(z),G=u(z),Y=W=>{const K=p(F),X=p(z);if(W){const $=St(H,z,R,j);n(q,z,$,!1),B||T(z)||e(X,K,R,j),S(F)&&ue(F)}else{const $=s(q,z,R,j);t(H,j,$,!1),B||T(z)||i(X,K,R,j);const nt=r(F);if(nt===0)b(F)&&as(F,q);else{const ot=O.get(F);ot!==void 0&&clearTimeout(ot),O.set(F,setTimeout(()=>{b(F)&&as(F,q)},1e3*nt))}}};return!!f(J,[F,R,j],W=>W[0]===F&&W[1]===R&&W[2]===j,!0)&&(G.add(Y),b(z)?n(q,z,[R,j,Y],!0):t(H,j,[z,R,Y],!0),!0)}})(Sh,Ch,sn,Oh,nn,ee,Eh,kt,jt,De,de,Rs,on),je,((n,t,e,s,i,o)=>r=>(u,p)=>{const f=n.get(u);if(f===void 0){if(!r&&o(u)){const b=s(u),{outputs:T}=e(u);for(const S of T)if(vs(S)){const O=s(S[0]);t(b,O,S[1],S[2])}else{const O=i(S[0]);b.disconnect(O,S[1])}}n.set(u,p)}else n.set(u,f+p)})(h,nn,ee,jt,_i,de),At,ln,be,((n,t,e,s,i,o,r,u)=>(p,f)=>{const b=t.get(p);if(b===void 0)throw new Error("Missing the expected cycle count.");const T=o(p.context),S=u(T);if(b===f){if(t.delete(p),!S&&r(p)){const O=s(p),{outputs:z}=e(p);for(const F of z)if(vs(F)){const R=s(F[0]);n(O,R,F[1],F[2])}else{const R=i(F[0]);O.connect(R,F[1])}}}else t.set(p,b-f)})(sn,h,ee,jt,_i,zt,de,Ft),((n,t,e)=>function s(i,o){const r=He(o)?o:e(n,o);if((p=>"delayTime"in p)(r))return[];if(i[0]===r)return[i];if(i.includes(r))return[];const{outputs:u}=t(r);return Array.from(u).map(p=>s([...i,r],p[0])).reduce((p,f)=>p.concat(f),[])})(Hr,ee,st),Zr,zt,Jn,Kn,$r,Ft,Xs);var Qr;const Dh=((n,t,e,s,i,o)=>class extends n{constructor(r,u){const p=i(r),f={...rt,...u},b=s(p,f);super(r,!1,b,o(p)?t():null),this._nativeAnalyserNode=b}get fftSize(){return this._nativeAnalyserNode.fftSize}set fftSize(r){this._nativeAnalyserNode.fftSize=r}get frequencyBinCount(){return this._nativeAnalyserNode.frequencyBinCount}get maxDecibels(){return this._nativeAnalyserNode.maxDecibels}set maxDecibels(r){const u=this._nativeAnalyserNode.maxDecibels;if(this._nativeAnalyserNode.maxDecibels=r,!(r>this._nativeAnalyserNode.minDecibels))throw this._nativeAnalyserNode.maxDecibels=u,e()}get minDecibels(){return this._nativeAnalyserNode.minDecibels}set minDecibels(r){const u=this._nativeAnalyserNode.minDecibels;if(this._nativeAnalyserNode.minDecibels=r,!(this._nativeAnalyserNode.maxDecibels>r))throw this._nativeAnalyserNode.minDecibels=u,e()}get smoothingTimeConstant(){return this._nativeAnalyserNode.smoothingTimeConstant}set smoothingTimeConstant(r){this._nativeAnalyserNode.smoothingTimeConstant=r}getByteFrequencyData(r){this._nativeAnalyserNode.getByteFrequencyData(r)}getByteTimeDomainData(r){this._nativeAnalyserNode.getByteTimeDomainData(r)}getFloatFrequencyData(r){this._nativeAnalyserNode.getFloatFrequencyData(r)}getFloatTimeDomainData(r){this._nativeAnalyserNode.getFloatTimeDomainData(r)}})(se,Mh,At,Xr,zt,Ft),to=new WeakSet,Jr=(n=>n===null?null:n.hasOwnProperty("AudioBuffer")?n.AudioBuffer:null)(Ze),Kr=(eo=new Uint32Array(1),n=>(eo[0]=n,eo[0]));var eo;const so=((n,t)=>e=>{e.copyFromChannel=(s,i,o=0)=>{const r=n(o),u=n(i);if(u>=e.numberOfChannels)throw t();const p=e.length,f=e.getChannelData(u),b=s.length;for(let T=r<0?-r:0;T+r<p&&T<b;T+=1)s[T]=f[T+r]},e.copyToChannel=(s,i,o=0)=>{const r=n(o),u=n(i);if(u>=e.numberOfChannels)throw t();const p=e.length,f=e.getChannelData(u),b=s.length;for(let T=r<0?-r:0;T+r<p&&T<b;T+=1)f[T+r]=s[T]}})(Kr,At),io=(n=>t=>{t.copyFromChannel=(e=>(s,i,o=0)=>{const r=n(o),u=n(i);if(r<t.length)return e.call(t,s,u,r)})(t.copyFromChannel),t.copyToChannel=(e=>(s,i,o=0)=>{const r=n(o),u=n(i);if(r<t.length)return e.call(t,s,u,r)})(t.copyToChannel)})(Kr),ta=((n,t,e,s,i,o,r,u)=>{let p=null;return class Ja{constructor(b){if(i===null)throw new Error("Missing the native OfflineAudioContext constructor.");const{length:T,numberOfChannels:S,sampleRate:O}={...Nt,...b};p===null&&(p=new i(1,1,44100));const z=s!==null&&t(o,o)?new s({length:T,numberOfChannels:S,sampleRate:O}):p.createBuffer(S,T,O);if(z.numberOfChannels===0)throw e();return typeof z.copyFromChannel!="function"?(r(z),ut(z)):t(ct,()=>ct(z))||u(z),n.add(z),z}static[Symbol.hasInstance](b){return b!==null&&typeof b=="object"&&Object.getPrototypeOf(b)===Ja.prototype||n.has(b)}}})(to,je,be,Jr,ce,(n=>()=>{if(n===null)return!1;try{new n({length:1,sampleRate:44100})}catch{return!1}return!0})(Jr),so,io),dn=(n=>(t,e)=>{const s=n(t,{channelCount:1,channelCountMode:"explicit",channelInterpretation:"discrete",gain:0});e.connect(s).connect(t.destination);const i=()=>{e.removeEventListener("ended",i),e.disconnect(s),s.disconnect()};e.addEventListener("ended",i)})(ke),ea=((n,t,e)=>async(s,i,o)=>{const r=t(s);await Promise.all(Array.from(r.activeInputs).map(async([u,p])=>{const f=n(u),b=await f.render(u,i);e(u)||b.connect(o,p)}))})(Qn,Ye,Rs),es=(n=>(t,e,s)=>n(e,t,s))(ea),Ys=((n,t,e,s,i,o,r,u,p,f,b)=>(T,S)=>{const O=T.createBufferSource();return re(O,S),Jt(O,S,"playbackRate"),Yt(O,S,"buffer"),Yt(O,S,"loop"),Yt(O,S,"loopEnd"),Yt(O,S,"loopStart"),t(e,()=>e(T))||(z=>{z.start=(F=>{let R=!1;return(j=0,B=0,q)=>{if(R)throw he();F.call(z,j,B,q),R=!0}})(z.start)})(O),t(s,()=>s(T))||(z=>{z.start=(F=>(R=0,j=0,B)=>{const q=z.buffer,H=q===null?j:Math.min(q.duration,j);q!==null&&H>q.duration-.5/z.context.sampleRate?F.call(z,R,0,0):F.call(z,R,H,B)})(z.start)})(O),t(i,()=>i(T))||f(O,T),t(o,()=>o(T))||Yn(O),t(r,()=>r(T))||b(O,T),t(u,()=>u(T))||Hn(O),n(T,O),O})(dn,je,n=>{const t=n.createBufferSource();t.start();try{t.start()}catch{return!0}return!1},n=>{const t=n.createBufferSource(),e=n.createBuffer(1,1,44100);t.buffer=e;try{t.start(0,1)}catch{return!1}return!0},n=>{const t=n.createBufferSource();t.start();try{t.stop()}catch{return!1}return!0},Zn,Wr,$n,0,(n=>(t,e)=>{const s=e.createBuffer(1,1,44100);t.buffer===null&&(t.buffer=s),n(t,"buffer",i=>()=>{const o=i.call(t);return o===s?null:o},i=>o=>i.call(t,o===null?s:o))})(wi),Gr),ss=((n,t)=>(e,s,i)=>(n(s).replay(i),t(s,e,i)))((n=>t=>{const e=n(t);if(e.renderer===null)throw new Error("Missing the renderer of the given AudioParam in the audio graph.");return e.renderer})(Ye),ea),Ih=((n,t,e,s,i)=>()=>{const o=new WeakMap;let r=null,u=null;return{set start(p){r=p},set stop(p){u=p},render(p,f){const b=o.get(f);return b!==void 0?Promise.resolve(b):(async(T,S)=>{let O=e(T);const z=ht(O,S);if(!z){const F={buffer:O.buffer,channelCount:O.channelCount,channelCountMode:O.channelCountMode,channelInterpretation:O.channelInterpretation,loop:O.loop,loopEnd:O.loopEnd,loopStart:O.loopStart,playbackRate:O.playbackRate.value};O=t(S,F),r!==null&&O.start(...r),u!==null&&O.stop(u)}return o.set(S,O),z?await n(S,T.playbackRate,O.playbackRate):await s(S,T.playbackRate,O.playbackRate),await i(T,S,O),O})(p,f)}}})(es,Ys,jt,ss,pe),$e=((n,t,e,s,i,o,r,u,p,f,b,T,S)=>(O,z,F,R=null,j=null)=>{const B=F.value,q=new w.AutomationEventList(B),H=z?(G=>({replay(Y){for(const W of G)if(W.type==="exponentialRampToValue"){const{endTime:K,value:X}=W;Y.exponentialRampToValueAtTime(X,K)}else if(W.type==="linearRampToValue"){const{endTime:K,value:X}=W;Y.linearRampToValueAtTime(X,K)}else if(W.type==="setTarget"){const{startTime:K,target:X,timeConstant:$}=W;Y.setTargetAtTime(X,K,$)}else if(W.type==="setValue"){const{startTime:K,value:X}=W;Y.setValueAtTime(X,K)}else{if(W.type!=="setValueCurve")throw new Error("Can't apply an unknown automation.");{const{duration:K,startTime:X,values:$}=W;Y.setValueCurveAtTime($,X,K)}}}}))(q):null,J={get defaultValue(){return B},get maxValue(){return R===null?F.maxValue:R},get minValue(){return j===null?F.minValue:j},get value(){return F.value},set value(G){F.value=G,J.setValueAtTime(G,O.context.currentTime)},cancelAndHoldAtTime(G){if(typeof F.cancelAndHoldAtTime=="function")H===null&&q.flush(O.context.currentTime),q.add(i(G)),F.cancelAndHoldAtTime(G);else{const Y=Array.from(q).pop();H===null&&q.flush(O.context.currentTime),q.add(i(G));const W=Array.from(q).pop();F.cancelScheduledValues(G),Y!==W&&W!==void 0&&(W.type==="exponentialRampToValue"?F.exponentialRampToValueAtTime(W.value,W.endTime):W.type==="linearRampToValue"?F.linearRampToValueAtTime(W.value,W.endTime):W.type==="setValue"?F.setValueAtTime(W.value,W.startTime):W.type==="setValueCurve"&&F.setValueCurveAtTime(W.values,W.startTime,W.duration))}return J},cancelScheduledValues:G=>(H===null&&q.flush(O.context.currentTime),q.add(o(G)),F.cancelScheduledValues(G),J),exponentialRampToValueAtTime(G,Y){if(G===0)throw new RangeError;if(!Number.isFinite(Y)||Y<0)throw new RangeError;const W=O.context.currentTime;return H===null&&q.flush(W),Array.from(q).length===0&&(q.add(f(B,W)),F.setValueAtTime(B,W)),q.add(r(G,Y)),F.exponentialRampToValueAtTime(G,Y),J},linearRampToValueAtTime(G,Y){const W=O.context.currentTime;return H===null&&q.flush(W),Array.from(q).length===0&&(q.add(f(B,W)),F.setValueAtTime(B,W)),q.add(u(G,Y)),F.linearRampToValueAtTime(G,Y),J},setTargetAtTime:(G,Y,W)=>(H===null&&q.flush(O.context.currentTime),q.add(p(G,Y,W)),F.setTargetAtTime(G,Y,W),J),setValueAtTime:(G,Y)=>(H===null&&q.flush(O.context.currentTime),q.add(f(G,Y)),F.setValueAtTime(G,Y),J),setValueCurveAtTime(G,Y,W){const K=G instanceof Float32Array?G:new Float32Array(G);if(T!==null&&T.name==="webkitAudioContext"){const X=Y+W,$=O.context.sampleRate,nt=Math.ceil(Y*$),ot=Math.floor(X*$),yt=ot-nt,pt=new Float32Array(yt);for(let bt=0;bt<yt;bt+=1){const lt=(K.length-1)/W*((nt+bt)/$-Y),wt=Math.floor(lt),Et=Math.ceil(lt);pt[bt]=wt===Et?K[wt]:(1-(lt-wt))*K[wt]+(1-(Et-lt))*K[Et]}H===null&&q.flush(O.context.currentTime),q.add(b(pt,Y,W)),F.setValueCurveAtTime(pt,Y,W);const dt=ot/$;dt<X&&S(J,pt[pt.length-1],dt),S(J,K[K.length-1],X)}else H===null&&q.flush(O.context.currentTime),q.add(b(K,Y,W)),F.setValueCurveAtTime(K,Y,W);return J}};return e.set(J,F),t.set(J,O),n(J,H),J})((sa=d,(n,t)=>{sa.set(n,{activeInputs:new Set,passiveInputs:new WeakMap,renderer:t})}),Hr,c,0,w.createCancelAndHoldAutomationEvent,w.createCancelScheduledValuesAutomationEvent,w.createExponentialRampToValueAutomationEvent,w.createLinearRampToValueAutomationEvent,w.createSetTargetAutomationEvent,w.createSetValueAutomationEvent,w.createSetValueCurveAutomationEvent,_s,jr);var sa;const Rh=((n,t,e,s,i,o,r,u)=>class extends n{constructor(p,f){const b=o(p),T={...Ms,...f},S=i(b,T),O=r(b),z=O?t():null;super(p,!1,S,z),this._audioBufferSourceNodeRenderer=z,this._isBufferNullified=!1,this._isBufferSet=T.buffer!==null,this._nativeAudioBufferSourceNode=S,this._onended=null,this._playbackRate=e(this,O,S.playbackRate,Bt,Xt)}get buffer(){return this._isBufferNullified?null:this._nativeAudioBufferSourceNode.buffer}set buffer(p){if(this._nativeAudioBufferSourceNode.buffer=p,p!==null){if(this._isBufferSet)throw s();this._isBufferSet=!0}}get loop(){return this._nativeAudioBufferSourceNode.loop}set loop(p){this._nativeAudioBufferSourceNode.loop=p}get loopEnd(){return this._nativeAudioBufferSourceNode.loopEnd}set loopEnd(p){this._nativeAudioBufferSourceNode.loopEnd=p}get loopStart(){return this._nativeAudioBufferSourceNode.loopStart}set loopStart(p){this._nativeAudioBufferSourceNode.loopStart=p}get onended(){return this._onended}set onended(p){const f=typeof p=="function"?u(this,p):null;this._nativeAudioBufferSourceNode.onended=f;const b=this._nativeAudioBufferSourceNode.onended;this._onended=b!==null&&b===f?p:b}get playbackRate(){return this._playbackRate}start(p=0,f=0,b){if(this._nativeAudioBufferSourceNode.start(p,f,b),this._audioBufferSourceNodeRenderer!==null&&(this._audioBufferSourceNodeRenderer.start=b===void 0?[p,f]:[p,f,b]),this.context.state!=="closed"){ue(this);const T=()=>{this._nativeAudioBufferSourceNode.removeEventListener("ended",T),de(this)&&Be(this)};this._nativeAudioBufferSourceNode.addEventListener("ended",T)}}stop(p=0){this._nativeAudioBufferSourceNode.stop(p),this._audioBufferSourceNodeRenderer!==null&&(this._audioBufferSourceNodeRenderer.stop=p)}})(se,Ih,$e,he,Ys,zt,Ft,Us),Ph=((n,t,e,s,i,o,r,u)=>class extends n{constructor(p,f){const b=o(p),T=r(b),S=i(b,f,T);super(p,!1,S,T?(O=>{const z=new WeakMap;return{render(F,R){const j=z.get(R);return j!==void 0?Promise.resolve(j):(async(B,q)=>{const H=q.destination;return z.set(q,H),await O(B,q,H),H})(F,R)}}})(u):null),this._isNodeOfNativeOfflineAudioContext=T,this._nativeAudioDestinationNode=S}get channelCount(){return this._nativeAudioDestinationNode.channelCount}set channelCount(p){if(this._isNodeOfNativeOfflineAudioContext)throw s();if(p>this._nativeAudioDestinationNode.maxChannelCount)throw e();this._nativeAudioDestinationNode.channelCount=p}get channelCountMode(){return this._nativeAudioDestinationNode.channelCountMode}set channelCountMode(p){if(this._isNodeOfNativeOfflineAudioContext)throw s();this._nativeAudioDestinationNode.channelCountMode=p}get maxChannelCount(){return this._nativeAudioDestinationNode.maxChannelCount}})(se,0,At,he,((n,t)=>(e,s,i)=>{const o=e.destination;if(o.channelCount!==s)try{o.channelCount=s}catch{}i&&o.channelCountMode!=="explicit"&&(o.channelCountMode="explicit"),o.maxChannelCount===0&&Object.defineProperty(o,"maxChannelCount",{value:s});const r=n(e,{channelCount:s,channelCountMode:o.channelCountMode,channelInterpretation:o.channelInterpretation,gain:1});return t(r,"channelCount",u=>()=>u.call(r),u=>p=>{u.call(r,p);try{o.channelCount=p}catch(f){if(p>o.maxChannelCount)throw f}}),t(r,"channelCountMode",u=>()=>u.call(r),u=>p=>{u.call(r,p),o.channelCountMode=p}),t(r,"channelInterpretation",u=>()=>u.call(r),u=>p=>{u.call(r,p),o.channelInterpretation=p}),Object.defineProperty(r,"maxChannelCount",{get:()=>o.maxChannelCount}),r.connect(o),r})(ke,wi),zt,Ft,pe),qh=((n,t,e,s,i)=>()=>{const o=new WeakMap;return{render(r,u){const p=o.get(u);return p!==void 0?Promise.resolve(p):(async(f,b)=>{let T=e(f);const S=ht(T,b);if(!S){const O={Q:T.Q.value,channelCount:T.channelCount,channelCountMode:T.channelCountMode,channelInterpretation:T.channelInterpretation,detune:T.detune.value,frequency:T.frequency.value,gain:T.gain.value,type:T.type};T=t(b,O)}return o.set(b,T),S?(await n(b,f.Q,T.Q),await n(b,f.detune,T.detune),await n(b,f.frequency,T.frequency),await n(b,f.gain,T.gain)):(await s(b,f.Q,T.Q),await s(b,f.detune,T.detune),await s(b,f.frequency,T.frequency),await s(b,f.gain,T.gain)),await i(f,b,T),T})(r,u)}}})(es,Fr,jt,ss,pe),Ps=(n=>(t,e)=>n.set(t,e))(Ur),Nh=((n,t,e,s,i,o,r,u)=>class extends n{constructor(p,f){const b=o(p),T={...rh,...f},S=i(b,T),O=r(b);super(p,!1,S,O?e():null),this._Q=t(this,O,S.Q,Bt,Xt),this._detune=t(this,O,S.detune,1200*Math.log2(Bt),-1200*Math.log2(Bt)),this._frequency=t(this,O,S.frequency,p.sampleRate/2,0),this._gain=t(this,O,S.gain,40*Math.log10(Bt),Xt),this._nativeBiquadFilterNode=S,u(this,1)}get detune(){return this._detune}get frequency(){return this._frequency}get gain(){return this._gain}get Q(){return this._Q}get type(){return this._nativeBiquadFilterNode.type}set type(p){this._nativeBiquadFilterNode.type=p}getFrequencyResponse(p,f,b){try{this._nativeBiquadFilterNode.getFrequencyResponse(p,f,b)}catch(T){throw T.code===11?s():T}if(p.length!==f.length||f.length!==b.length)throw s()}})(se,$e,qh,ln,Fr,zt,Ft,Ps),ys=((n,t)=>(e,s,i)=>{const o=new Set;return e.connect=(r=>(u,p=0,f=0)=>{const b=o.size===0;if(t(u))return r.call(e,u,p,f),n(o,[u,p,f],T=>T[0]===u&&T[1]===p&&T[2]===f,!0),b&&s(),u;r.call(e,u,p),n(o,[u,p],T=>T[0]===u&&T[1]===p,!0),b&&s()})(e.connect),e.disconnect=(r=>(u,p,f)=>{const b=o.size>0;if(u===void 0)r.apply(e),o.clear();else if(typeof u=="number"){r.call(e,u);for(const S of o)S[1]===u&&o.delete(S)}else{t(u)?r.call(e,u,p,f):r.call(e,u,p);for(const S of o)S[0]!==u||p!==void 0&&S[1]!==p||f!==void 0&&S[2]!==f||o.delete(S)}const T=o.size===0;b&&T&&i()})(e.disconnect),e})(De,Kn),Fh=((n,t)=>(e,s)=>{s.channelCount=1,s.channelCountMode="explicit",Object.defineProperty(s,"channelCount",{get:()=>1,set:()=>{throw n()}}),Object.defineProperty(s,"channelCountMode",{get:()=>"explicit",set:()=>{throw n()}});const i=e.createBufferSource();t(s,()=>{const o=s.numberOfInputs;for(let r=0;r<o;r+=1)i.connect(s,0,r)},()=>i.disconnect(s))})(he,ys),xs=((n,t)=>(e,s)=>{const i=e.createChannelMerger(s.numberOfInputs);return n!==null&&n.name==="webkitAudioContext"&&t(e,i),re(i,s),i})(_s,Fh),Lh=((n,t,e)=>()=>{const s=new WeakMap;return{render(i,o){const r=s.get(o);return r!==void 0?Promise.resolve(r):(async(u,p)=>{let f=t(u);if(!ht(f,p)){const b={channelCount:f.channelCount,channelCountMode:f.channelCountMode,channelInterpretation:f.channelInterpretation,numberOfInputs:f.numberOfInputs};f=n(p,b)}return s.set(p,f),await e(u,p,f),f})(i,o)}}})(xs,jt,pe),Vh=((n,t,e,s,i)=>class extends n{constructor(o,r){const u=s(o),p={...ah,...r};super(o,!1,e(u,p),i(u)?t():null)}})(se,Lh,xs,zt,Ft),zh=((n,t,e)=>()=>{const s=new WeakMap;return{render(i,o){const r=s.get(o);return r!==void 0?Promise.resolve(r):(async(u,p)=>{let f=t(u);if(!ht(f,p)){const b={channelCount:f.channelCount,channelCountMode:f.channelCountMode,channelInterpretation:f.channelInterpretation,numberOfOutputs:f.numberOfOutputs};f=n(p,b)}return s.set(p,f),await e(u,p,f),f})(i,o)}}})(xi,jt,pe),Bh=((n,t,e,s,i,o)=>class extends n{constructor(r,u){const p=s(r),f=(b=>({...b,channelCount:b.numberOfOutputs}))({...hh,...u});super(r,!1,e(p,f),i(p)?t():null)}})(se,zh,xi,zt,Ft),jh=((n,t,e,s)=>(i,{offset:o,...r})=>{const u=i.createBuffer(1,2,44100),p=t(i,{buffer:null,channelCount:2,channelCountMode:"max",channelInterpretation:"speakers",loop:!1,loopEnd:0,loopStart:0,playbackRate:1}),f=e(i,{...r,gain:o}),b=u.getChannelData(0);b[0]=1,b[1]=1,p.buffer=u,p.loop=!0;const T={get bufferSize(){},get channelCount(){return f.channelCount},set channelCount(S){f.channelCount=S},get channelCountMode(){return f.channelCountMode},set channelCountMode(S){f.channelCountMode=S},get channelInterpretation(){return f.channelInterpretation},set channelInterpretation(S){f.channelInterpretation=S},get context(){return f.context},get inputs(){return[]},get numberOfInputs(){return p.numberOfInputs},get numberOfOutputs(){return f.numberOfOutputs},get offset(){return f.gain},get onended(){return p.onended},set onended(S){p.onended=S},addEventListener:(...S)=>p.addEventListener(S[0],S[1],S[2]),dispatchEvent:(...S)=>p.dispatchEvent(S[0]),removeEventListener:(...S)=>p.removeEventListener(S[0],S[1],S[2]),start(S=0){p.start.call(p,S)},stop(S=0){p.stop.call(p,S)}};return n(i,p),s(Gs(T,f),()=>p.connect(f),()=>p.disconnect(f))})(dn,Ys,ke,ys),Hs=((n,t,e,s,i)=>(o,r)=>{if(o.createConstantSource===void 0)return e(o,r);const u=o.createConstantSource();return re(u,r),Jt(u,r,"offset"),t(s,()=>s(o))||Yn(u),t(i,()=>i(o))||Hn(u),n(o,u),u})(dn,je,jh,Zn,$n),Wh=((n,t,e,s,i)=>()=>{const o=new WeakMap;let r=null,u=null;return{set start(p){r=p},set stop(p){u=p},render(p,f){const b=o.get(f);return b!==void 0?Promise.resolve(b):(async(T,S)=>{let O=e(T);const z=ht(O,S);if(!z){const F={channelCount:O.channelCount,channelCountMode:O.channelCountMode,channelInterpretation:O.channelInterpretation,offset:O.offset.value};O=t(S,F),r!==null&&O.start(r),u!==null&&O.stop(u)}return o.set(S,O),z?await n(S,T.offset,O.offset):await s(S,T.offset,O.offset),await i(T,S,O),O})(p,f)}}})(es,Hs,jt,ss,pe),Gh=((n,t,e,s,i,o,r)=>class extends n{constructor(u,p){const f=i(u),b={...ch,...p},T=s(f,b),S=o(f),O=S?e():null;super(u,!1,T,O),this._constantSourceNodeRenderer=O,this._nativeConstantSourceNode=T,this._offset=t(this,S,T.offset,Bt,Xt),this._onended=null}get offset(){return this._offset}get onended(){return this._onended}set onended(u){const p=typeof u=="function"?r(this,u):null;this._nativeConstantSourceNode.onended=p;const f=this._nativeConstantSourceNode.onended;this._onended=f!==null&&f===p?u:f}start(u=0){if(this._nativeConstantSourceNode.start(u),this._constantSourceNodeRenderer!==null&&(this._constantSourceNodeRenderer.start=u),this.context.state!=="closed"){ue(this);const p=()=>{this._nativeConstantSourceNode.removeEventListener("ended",p),de(this)&&Be(this)};this._nativeConstantSourceNode.addEventListener("ended",p)}}stop(u=0){this._nativeConstantSourceNode.stop(u),this._constantSourceNodeRenderer!==null&&(this._constantSourceNodeRenderer.stop=u)}})(se,$e,Wh,Hs,zt,Ft,Us),ia=((n,t)=>(e,s)=>{const i=e.createConvolver();if(re(i,s),s.disableNormalization===i.normalize&&(i.normalize=!s.disableNormalization),Yt(i,s,"buffer"),s.channelCount>2||(t(i,"channelCount",o=>()=>o.call(i),o=>r=>{if(r>2)throw n();return o.call(i,r)}),s.channelCountMode==="max"))throw n();return t(i,"channelCountMode",o=>()=>o.call(i),o=>r=>{if(r==="max")throw n();return o.call(i,r)}),i})(be,wi),Uh=((n,t,e)=>()=>{const s=new WeakMap;return{render(i,o){const r=s.get(o);return r!==void 0?Promise.resolve(r):(async(u,p)=>{let f=t(u);if(!ht(f,p)){const b={buffer:f.buffer,channelCount:f.channelCount,channelCountMode:f.channelCountMode,channelInterpretation:f.channelInterpretation,disableNormalization:!f.normalize};f=n(p,b)}return s.set(p,f),Ie(f)?await e(u,p,f.inputs[0]):await e(u,p,f),f})(i,o)}}})(ia,jt,pe),Xh=((n,t,e,s,i,o)=>class extends n{constructor(r,u){const p=s(r),f={...lh,...u},b=e(p,f);super(r,!1,b,i(p)?t():null),this._isBufferNullified=!1,this._nativeConvolverNode=b,f.buffer!==null&&o(this,f.buffer.duration)}get buffer(){return this._isBufferNullified?null:this._nativeConvolverNode.buffer}set buffer(r){if(this._nativeConvolverNode.buffer=r,r===null&&this._nativeConvolverNode.buffer!==null){const u=this._nativeConvolverNode.context;this._nativeConvolverNode.buffer=u.createBuffer(1,1,u.sampleRate),this._isBufferNullified=!0,o(this,0)}else this._isBufferNullified=!1,o(this,this._nativeConvolverNode.buffer===null?0:this._nativeConvolverNode.buffer.duration)}get normalize(){return this._nativeConvolverNode.normalize}set normalize(r){this._nativeConvolverNode.normalize=r}})(se,Uh,ia,zt,Ft,Ps),Yh=((n,t,e,s,i)=>o=>{const r=new WeakMap;return{render(u,p){const f=r.get(p);return f!==void 0?Promise.resolve(f):(async(b,T)=>{let S=e(b);const O=ht(S,T);if(!O){const z={channelCount:S.channelCount,channelCountMode:S.channelCountMode,channelInterpretation:S.channelInterpretation,delayTime:S.delayTime.value,maxDelayTime:o};S=t(T,z)}return r.set(T,S),O?await n(T,b.delayTime,S.delayTime):await s(T,b.delayTime,S.delayTime),await i(b,T,S),S})(u,p)}}})(es,Lr,jt,ss,pe),Hh=((n,t,e,s,i,o,r)=>class extends n{constructor(u,p){const f=i(u),b={...uh,...p},T=s(f,b),S=o(f);super(u,!1,T,S?e(b.maxDelayTime):null),this._delayTime=t(this,S,T.delayTime),r(this,b.maxDelayTime)}get delayTime(){return this._delayTime}})(se,$e,Yh,Lr,zt,Ft,Ps),na=(n=>(t,e)=>{const s=t.createDynamicsCompressor();if(re(s,e),e.channelCount>2||e.channelCountMode==="max")throw n();return Jt(s,e,"attack"),Jt(s,e,"knee"),Jt(s,e,"ratio"),Jt(s,e,"release"),Jt(s,e,"threshold"),s})(be),Zh=((n,t,e,s,i)=>()=>{const o=new WeakMap;return{render(r,u){const p=o.get(u);return p!==void 0?Promise.resolve(p):(async(f,b)=>{let T=e(f);const S=ht(T,b);if(!S){const O={attack:T.attack.value,channelCount:T.channelCount,channelCountMode:T.channelCountMode,channelInterpretation:T.channelInterpretation,knee:T.knee.value,ratio:T.ratio.value,release:T.release.value,threshold:T.threshold.value};T=t(b,O)}return o.set(b,T),S?(await n(b,f.attack,T.attack),await n(b,f.knee,T.knee),await n(b,f.ratio,T.ratio),await n(b,f.release,T.release),await n(b,f.threshold,T.threshold)):(await s(b,f.attack,T.attack),await s(b,f.knee,T.knee),await s(b,f.ratio,T.ratio),await s(b,f.release,T.release),await s(b,f.threshold,T.threshold)),await i(f,b,T),T})(r,u)}}})(es,na,jt,ss,pe),$h=((n,t,e,s,i,o,r,u)=>class extends n{constructor(p,f){const b=o(p),T={...dh,...f},S=s(b,T),O=r(b);super(p,!1,S,O?e():null),this._attack=t(this,O,S.attack),this._knee=t(this,O,S.knee),this._nativeDynamicsCompressorNode=S,this._ratio=t(this,O,S.ratio),this._release=t(this,O,S.release),this._threshold=t(this,O,S.threshold),u(this,.006)}get attack(){return this._attack}get channelCount(){return this._nativeDynamicsCompressorNode.channelCount}set channelCount(p){const f=this._nativeDynamicsCompressorNode.channelCount;if(this._nativeDynamicsCompressorNode.channelCount=p,p>2)throw this._nativeDynamicsCompressorNode.channelCount=f,i()}get channelCountMode(){return this._nativeDynamicsCompressorNode.channelCountMode}set channelCountMode(p){const f=this._nativeDynamicsCompressorNode.channelCountMode;if(this._nativeDynamicsCompressorNode.channelCountMode=p,p==="max")throw this._nativeDynamicsCompressorNode.channelCountMode=f,i()}get knee(){return this._knee}get ratio(){return this._ratio}get reduction(){return typeof this._nativeDynamicsCompressorNode.reduction.value=="number"?this._nativeDynamicsCompressorNode.reduction.value:this._nativeDynamicsCompressorNode.reduction}get release(){return this._release}get threshold(){return this._threshold}})(se,$e,Zh,na,be,zt,Ft,Ps),Qh=((n,t,e,s,i)=>()=>{const o=new WeakMap;return{render(r,u){const p=o.get(u);return p!==void 0?Promise.resolve(p):(async(f,b)=>{let T=e(f);const S=ht(T,b);if(!S){const O={channelCount:T.channelCount,channelCountMode:T.channelCountMode,channelInterpretation:T.channelInterpretation,gain:T.gain.value};T=t(b,O)}return o.set(b,T),S?await n(b,f.gain,T.gain):await s(b,f.gain,T.gain),await i(f,b,T),T})(r,u)}}})(es,ke,jt,ss,pe),Jh=((n,t,e,s,i,o)=>class extends n{constructor(r,u){const p=i(r),f={...ph,...u},b=s(p,f),T=o(p);super(r,!1,b,T?e():null),this._gain=t(this,T,b.gain,Bt,Xt)}get gain(){return this._gain}})(se,$e,Qh,ke,zt,Ft),Kh=((n,t,e,s)=>(i,o,{channelCount:r,channelCountMode:u,channelInterpretation:p,feedback:f,feedforward:b})=>{const T=Nr(o,i.sampleRate),S=f instanceof Float64Array?f:new Float64Array(f),O=b instanceof Float64Array?b:new Float64Array(b),z=S.length,F=O.length,R=Math.min(z,F);if(z===0||z>20)throw s();if(S[0]===0)throw t();if(F===0||F>20)throw s();if(O[0]===0)throw t();if(S[0]!==1){for(let G=0;G<F;G+=1)O[G]/=S[0];for(let G=1;G<z;G+=1)S[G]/=S[0]}const j=e(i,T,r,r);j.channelCount=r,j.channelCountMode=u,j.channelInterpretation=p;const B=[],q=[],H=[];for(let G=0;G<r;G+=1){B.push(0);const Y=new Float32Array(32),W=new Float32Array(32);Y.fill(0),W.fill(0),q.push(Y),H.push(W)}j.onaudioprocess=G=>{const Y=G.inputBuffer,W=G.outputBuffer,K=Y.numberOfChannels;for(let X=0;X<K;X+=1){const $=Y.getChannelData(X),nt=W.getChannelData(X);B[X]=Pr(S,z,O,F,R,q[X],H[X],B[X],32,$,nt)}};const J=i.sampleRate/2;return Gs({get bufferSize(){return T},get channelCount(){return j.channelCount},set channelCount(G){j.channelCount=G},get channelCountMode(){return j.channelCountMode},set channelCountMode(G){j.channelCountMode=G},get channelInterpretation(){return j.channelInterpretation},set channelInterpretation(G){j.channelInterpretation=G},get context(){return j.context},get inputs(){return[j]},get numberOfInputs(){return j.numberOfInputs},get numberOfOutputs(){return j.numberOfOutputs},addEventListener:(...G)=>j.addEventListener(G[0],G[1],G[2]),dispatchEvent:(...G)=>j.dispatchEvent(G[0]),getFrequencyResponse(G,Y,W){if(G.length!==Y.length||Y.length!==W.length)throw n();const K=G.length;for(let X=0;X<K;X+=1){const $=-Math.PI*(G[X]/J),nt=[Math.cos($),Math.sin($)],ot=gh(Vr(O,nt),Vr(S,nt));Y[X]=Math.sqrt(ot[0]*ot[0]+ot[1]*ot[1]),W[X]=Math.atan2(ot[1],ot[0])}},removeEventListener:(...G)=>j.removeEventListener(G[0],G[1],G[2])},j)})(ln,he,bi,be),pn=((n,t,e,s)=>i=>n(yi,()=>yi(i))?Promise.resolve(n(s,s)).then(o=>{if(!o){const r=e(i,512,0,1);i.oncomplete=()=>{r.onaudioprocess=null,r.disconnect()},r.onaudioprocess=()=>i.currentTime,r.connect(i.destination)}return i.startRendering()}):new Promise(o=>{const r=t(i,{channelCount:1,channelCountMode:"explicit",channelInterpretation:"discrete",gain:0});i.oncomplete=u=>{r.disconnect(),o(u.renderedBuffer)},r.connect(i.destination),i.startRendering()}))(je,ke,bi,((n,t)=>()=>{if(t===null)return Promise.resolve(!1);const e=new t(1,1,44100),s=n(e,{channelCount:1,channelCountMode:"explicit",channelInterpretation:"discrete",gain:0});return new Promise(i=>{e.oncomplete=()=>{s.disconnect(),i(e.currentTime!==0)},e.startRendering()})})(ke,ce)),tc=((n,t,e,s,i)=>(o,r)=>{const u=new WeakMap;let p=null;return{render(f,b){const T=u.get(b);return T!==void 0?Promise.resolve(T):(async(S,O)=>{let z=null,F=t(S);const R=ht(F,O);if(O.createIIRFilter===void 0?z=n(O,{buffer:null,channelCount:2,channelCountMode:"max",channelInterpretation:"speakers",loop:!1,loopEnd:0,loopStart:0,playbackRate:1}):R||(F=O.createIIRFilter(r,o)),u.set(O,z===null?F:z),z!==null){if(p===null){if(e===null)throw new Error("Missing the native OfflineAudioContext constructor.");const B=new e(S.context.destination.channelCount,S.context.length,O.sampleRate);p=(async()=>(await s(S,B,B.destination),((q,H,J,G)=>{const Y=J instanceof Float64Array?J:new Float64Array(J),W=G instanceof Float64Array?G:new Float64Array(G),K=Y.length,X=W.length,$=Math.min(K,X);if(Y[0]!==1){for(let dt=0;dt<K;dt+=1)W[dt]/=Y[0];for(let dt=1;dt<X;dt+=1)Y[dt]/=Y[0]}const nt=new Float32Array(32),ot=new Float32Array(32),yt=H.createBuffer(q.numberOfChannels,q.length,q.sampleRate),pt=q.numberOfChannels;for(let dt=0;dt<pt;dt+=1){const bt=q.getChannelData(dt),lt=yt.getChannelData(dt);nt.fill(0),ot.fill(0),Pr(Y,K,W,X,$,nt,ot,0,32,bt,lt)}return yt})(await i(B),O,o,r)))()}const j=await p;return z.buffer=j,z.start(0),z}return await s(S,O,F),F})(f,b)}}})(Ys,jt,ce,pe,pn),ec=(n=>(t,e,s)=>{if(t.createIIRFilter===void 0)return n(t,e,s);const i=t.createIIRFilter(s.feedforward,s.feedback);return re(i,s),i})(Kh),sc=((n,t,e,s,i,o)=>class extends n{constructor(r,u){const p=s(r),f=i(p),b={...fh,...u},T=t(p,f?null:r.baseLatency,b);super(r,!1,T,f?e(b.feedback,b.feedforward):null),(S=>{var O;S.getFrequencyResponse=(O=S.getFrequencyResponse,(z,F,R)=>{if(z.length!==F.length||F.length!==R.length)throw ln();return O.call(S,z,F,R)})})(T),this._nativeIIRFilterNode=T,o(this,1)}getFrequencyResponse(r,u,p){return this._nativeIIRFilterNode.getFrequencyResponse(r,u,p)}})(se,ec,tc,zt,Ft,Ps),ic=((n,t,e,s,i,o,r,u)=>(p,f)=>{const b=f.listener,{forwardX:T,forwardY:S,forwardZ:O,positionX:z,positionY:F,positionZ:R,upX:j,upY:B,upZ:q}=b.forwardX===void 0?(()=>{const H=new Float32Array(1),J=t(f,{channelCount:1,channelCountMode:"explicit",channelInterpretation:"speakers",numberOfInputs:9}),G=r(f);let Y=!1,W=[0,0,-1,0,1,0],K=[0,0,0];const X=()=>{if(Y)return;Y=!0;const yt=s(f,256,9,0);yt.onaudioprocess=({inputBuffer:pt})=>{const dt=[o(pt,H,0),o(pt,H,1),o(pt,H,2),o(pt,H,3),o(pt,H,4),o(pt,H,5)];dt.some((lt,wt)=>lt!==W[wt])&&(b.setOrientation(...dt),W=dt);const bt=[o(pt,H,6),o(pt,H,7),o(pt,H,8)];bt.some((lt,wt)=>lt!==K[wt])&&(b.setPosition(...bt),K=bt)},J.connect(yt)},$=yt=>pt=>{pt!==W[yt]&&(W[yt]=pt,b.setOrientation(...W))},nt=yt=>pt=>{pt!==K[yt]&&(K[yt]=pt,b.setPosition(...K))},ot=(yt,pt,dt)=>{const bt=e(f,{channelCount:1,channelCountMode:"explicit",channelInterpretation:"discrete",offset:pt});bt.connect(J,0,yt),bt.start(),Object.defineProperty(bt.offset,"defaultValue",{get:()=>pt});const lt=n({context:p},G,bt.offset,Bt,Xt);var wt,Et,It,Gt,te,Ce,Ot;return u(lt,"value",at=>()=>at.call(lt),at=>Vt=>{try{at.call(lt,Vt)}catch(qt){if(qt.code!==9)throw qt}X(),G&&dt(Vt)}),lt.cancelAndHoldAtTime=(wt=lt.cancelAndHoldAtTime,G?()=>{throw i()}:(...at)=>{const Vt=wt.apply(lt,at);return X(),Vt}),lt.cancelScheduledValues=(Et=lt.cancelScheduledValues,G?()=>{throw i()}:(...at)=>{const Vt=Et.apply(lt,at);return X(),Vt}),lt.exponentialRampToValueAtTime=(It=lt.exponentialRampToValueAtTime,G?()=>{throw i()}:(...at)=>{const Vt=It.apply(lt,at);return X(),Vt}),lt.linearRampToValueAtTime=(Gt=lt.linearRampToValueAtTime,G?()=>{throw i()}:(...at)=>{const Vt=Gt.apply(lt,at);return X(),Vt}),lt.setTargetAtTime=(te=lt.setTargetAtTime,G?()=>{throw i()}:(...at)=>{const Vt=te.apply(lt,at);return X(),Vt}),lt.setValueAtTime=(Ce=lt.setValueAtTime,G?()=>{throw i()}:(...at)=>{const Vt=Ce.apply(lt,at);return X(),Vt}),lt.setValueCurveAtTime=(Ot=lt.setValueCurveAtTime,G?()=>{throw i()}:(...at)=>{const Vt=Ot.apply(lt,at);return X(),Vt}),lt};return{forwardX:ot(0,0,$(0)),forwardY:ot(1,0,$(1)),forwardZ:ot(2,-1,$(2)),positionX:ot(6,0,nt(0)),positionY:ot(7,0,nt(1)),positionZ:ot(8,0,nt(2)),upX:ot(3,0,$(3)),upY:ot(4,1,$(4)),upZ:ot(5,0,$(5))}})():b;return{get forwardX(){return T},get forwardY(){return S},get forwardZ(){return O},get positionX(){return z},get positionY(){return F},get positionZ(){return R},get upX(){return j},get upY(){return B},get upZ(){return q}}})($e,xs,Hs,bi,be,zr,Ft,wi),oa=new WeakMap,nc=((n,t,e,s,i,o)=>class extends e{constructor(r,u){super(r),this._nativeContext=r,l.set(this,r),s(r)&&i.set(r,new Set),this._destination=new n(this,u),this._listener=t(this,r),this._onstatechange=null}get currentTime(){return this._nativeContext.currentTime}get destination(){return this._destination}get listener(){return this._listener}get onstatechange(){return this._onstatechange}set onstatechange(r){const u=typeof r=="function"?o(this,r):null;this._nativeContext.onstatechange=u;const p=this._nativeContext.onstatechange;this._onstatechange=p!==null&&p===u?r:p}get sampleRate(){return this._nativeContext.sampleRate}get state(){return this._nativeContext.state}})(Ph,ic,Zr,Ft,oa,Us),ra=((n,t,e,s,i,o)=>(r,u)=>{const p=r.createOscillator();return re(p,u),Jt(p,u,"detune"),Jt(p,u,"frequency"),u.periodicWave!==void 0?p.setPeriodicWave(u.periodicWave):Yt(p,u,"type"),t(e,()=>e(r))||Yn(p),t(s,()=>s(r))||o(p,r),t(i,()=>i(r))||Hn(p),n(r,p),p})(dn,je,Zn,Wr,$n,Gr),oc=((n,t,e,s,i)=>()=>{const o=new WeakMap;let r=null,u=null,p=null;return{set periodicWave(f){r=f},set start(f){u=f},set stop(f){p=f},render(f,b){const T=o.get(b);return T!==void 0?Promise.resolve(T):(async(S,O)=>{let z=e(S);const F=ht(z,O);if(!F){const R={channelCount:z.channelCount,channelCountMode:z.channelCountMode,channelInterpretation:z.channelInterpretation,detune:z.detune.value,frequency:z.frequency.value,periodicWave:r===null?void 0:r,type:z.type};z=t(O,R),u!==null&&z.start(u),p!==null&&z.stop(p)}return o.set(O,z),F?(await n(O,S.detune,z.detune),await n(O,S.frequency,z.frequency)):(await s(O,S.detune,z.detune),await s(O,S.frequency,z.frequency)),await i(S,O,z),z})(f,b)}}})(es,ra,jt,ss,pe),rc=((n,t,e,s,i,o,r)=>class extends n{constructor(u,p){const f=i(u),b={..._h,...p},T=e(f,b),S=o(f),O=S?s():null,z=u.sampleRate/2;super(u,!1,T,O),this._detune=t(this,S,T.detune,153600,-153600),this._frequency=t(this,S,T.frequency,z,-z),this._nativeOscillatorNode=T,this._onended=null,this._oscillatorNodeRenderer=O,this._oscillatorNodeRenderer!==null&&b.periodicWave!==void 0&&(this._oscillatorNodeRenderer.periodicWave=b.periodicWave)}get detune(){return this._detune}get frequency(){return this._frequency}get onended(){return this._onended}set onended(u){const p=typeof u=="function"?r(this,u):null;this._nativeOscillatorNode.onended=p;const f=this._nativeOscillatorNode.onended;this._onended=f!==null&&f===p?u:f}get type(){return this._nativeOscillatorNode.type}set type(u){this._nativeOscillatorNode.type=u,this._oscillatorNodeRenderer!==null&&(this._oscillatorNodeRenderer.periodicWave=null)}setPeriodicWave(u){this._nativeOscillatorNode.setPeriodicWave(u),this._oscillatorNodeRenderer!==null&&(this._oscillatorNodeRenderer.periodicWave=u)}start(u=0){if(this._nativeOscillatorNode.start(u),this._oscillatorNodeRenderer!==null&&(this._oscillatorNodeRenderer.start=u),this.context.state!=="closed"){ue(this);const p=()=>{this._nativeOscillatorNode.removeEventListener("ended",p),de(this)&&Be(this)};this._nativeOscillatorNode.addEventListener("ended",p)}}stop(u=0){this._nativeOscillatorNode.stop(u),this._oscillatorNodeRenderer!==null&&(this._oscillatorNodeRenderer.stop=u)}})(se,$e,ra,oc,zt,Ft,Us),aa=(n=>(t,e)=>{const s=n(t,{buffer:null,channelCount:2,channelCountMode:"max",channelInterpretation:"speakers",loop:!1,loopEnd:0,loopStart:0,playbackRate:1}),i=t.createBuffer(1,2,44100);return s.buffer=i,s.loop=!0,s.connect(e),s.start(),()=>{s.stop(),s.disconnect(e)}})(Ys),ac=((n,t,e,s,i)=>(o,{curve:r,oversample:u,...p})=>{const f=o.createWaveShaper(),b=o.createWaveShaper();re(f,p),re(b,p);const T=e(o,{...p,gain:1}),S=e(o,{...p,gain:-1}),O=e(o,{...p,gain:1}),z=e(o,{...p,gain:-1});let F=null,R=!1,j=null;const B={get bufferSize(){},get channelCount(){return f.channelCount},set channelCount(q){T.channelCount=q,S.channelCount=q,f.channelCount=q,O.channelCount=q,b.channelCount=q,z.channelCount=q},get channelCountMode(){return f.channelCountMode},set channelCountMode(q){T.channelCountMode=q,S.channelCountMode=q,f.channelCountMode=q,O.channelCountMode=q,b.channelCountMode=q,z.channelCountMode=q},get channelInterpretation(){return f.channelInterpretation},set channelInterpretation(q){T.channelInterpretation=q,S.channelInterpretation=q,f.channelInterpretation=q,O.channelInterpretation=q,b.channelInterpretation=q,z.channelInterpretation=q},get context(){return f.context},get curve(){return j},set curve(q){if(q!==null&&q.length<2)throw t();if(q===null)f.curve=q,b.curve=q;else{const H=q.length,J=new Float32Array(H+2-H%2),G=new Float32Array(H+2-H%2);J[0]=q[0],G[0]=-q[H-1];const Y=Math.ceil((H+1)/2),W=(H+1)/2-1;for(let K=1;K<Y;K+=1){const X=K/Y*W,$=Math.floor(X),nt=Math.ceil(X);J[K]=$===nt?q[$]:(1-(X-$))*q[$]+(1-(nt-X))*q[nt],G[K]=$===nt?-q[H-1-$]:-(1-(X-$))*q[H-1-$]-(1-(nt-X))*q[H-1-nt]}J[Y]=H%2==1?q[Y-1]:(q[Y-2]+q[Y-1])/2,f.curve=J,b.curve=G}j=q,R&&(s(j)&&F===null?F=n(o,T):F!==null&&(F(),F=null))},get inputs(){return[T]},get numberOfInputs(){return f.numberOfInputs},get numberOfOutputs(){return f.numberOfOutputs},get oversample(){return f.oversample},set oversample(q){f.oversample=q,b.oversample=q},addEventListener:(...q)=>T.addEventListener(q[0],q[1],q[2]),dispatchEvent:(...q)=>T.dispatchEvent(q[0]),removeEventListener:(...q)=>T.removeEventListener(q[0],q[1],q[2])};return r!==null&&(B.curve=r instanceof Float32Array?r:new Float32Array(r)),u!==B.oversample&&(B.oversample=u),i(Gs(B,O),()=>{T.connect(f).connect(O),T.connect(S).connect(b).connect(z).connect(O),R=!0,s(j)&&(F=n(o,T))},()=>{T.disconnect(f),f.disconnect(O),T.disconnect(S),S.disconnect(b),b.disconnect(z),z.disconnect(O),R=!1,F!==null&&(F(),F=null)})})(aa,he,ke,Br,ys),fn=((n,t,e,s,i,o,r)=>(u,p)=>{const f=u.createWaveShaper();if(o!==null&&o.name==="webkitAudioContext"&&u.createGain().gain.automationRate===void 0)return e(u,p);re(f,p);const b=p.curve===null||p.curve instanceof Float32Array?p.curve:new Float32Array(p.curve);if(b!==null&&b.length<2)throw t();Yt(f,{curve:b},"curve"),Yt(f,p,"oversample");let T=null,S=!1;return r(f,"curve",O=>()=>O.call(f),O=>z=>(O.call(f,z),S&&(s(z)&&T===null?T=n(u,f):s(z)||T===null||(T(),T=null)),z)),i(f,()=>{S=!0,s(f.curve)&&(T=n(u,f))},()=>{S=!1,T!==null&&(T(),T=null)})})(aa,he,ac,Br,ys,_s,wi),hc=((n,t,e,s,i,o,r,u,p,f)=>(b,{coneInnerAngle:T,coneOuterAngle:S,coneOuterGain:O,distanceModel:z,maxDistance:F,orientationX:R,orientationY:j,orientationZ:B,panningModel:q,positionX:H,positionY:J,positionZ:G,refDistance:Y,rolloffFactor:W,...K})=>{const X=b.createPanner();if(K.channelCount>2||K.channelCountMode==="max")throw r();re(X,K);const $={channelCount:1,channelCountMode:"explicit",channelInterpretation:"discrete"},nt=e(b,{...$,channelInterpretation:"speakers",numberOfInputs:6}),ot=s(b,{...K,gain:1}),yt=s(b,{...$,gain:1}),pt=s(b,{...$,gain:0}),dt=s(b,{...$,gain:0}),bt=s(b,{...$,gain:0}),lt=s(b,{...$,gain:0}),wt=s(b,{...$,gain:0}),Et=i(b,256,6,1),It=o(b,{...$,curve:new Float32Array([1,1]),oversample:"none"});let Gt=[R,j,B],te=[H,J,G];const Ce=new Float32Array(1);Et.onaudioprocess=({inputBuffer:at})=>{const Vt=[p(at,Ce,0),p(at,Ce,1),p(at,Ce,2)];Vt.some((ye,Es)=>ye!==Gt[Es])&&(X.setOrientation(...Vt),Gt=Vt);const qt=[p(at,Ce,3),p(at,Ce,4),p(at,Ce,5)];qt.some((ye,Es)=>ye!==te[Es])&&(X.setPosition(...qt),te=qt)},Object.defineProperty(pt.gain,"defaultValue",{get:()=>0}),Object.defineProperty(dt.gain,"defaultValue",{get:()=>0}),Object.defineProperty(bt.gain,"defaultValue",{get:()=>0}),Object.defineProperty(lt.gain,"defaultValue",{get:()=>0}),Object.defineProperty(wt.gain,"defaultValue",{get:()=>0});const Ot={get bufferSize(){},get channelCount(){return X.channelCount},set channelCount(at){if(at>2)throw r();ot.channelCount=at,X.channelCount=at},get channelCountMode(){return X.channelCountMode},set channelCountMode(at){if(at==="max")throw r();ot.channelCountMode=at,X.channelCountMode=at},get channelInterpretation(){return X.channelInterpretation},set channelInterpretation(at){ot.channelInterpretation=at,X.channelInterpretation=at},get coneInnerAngle(){return X.coneInnerAngle},set coneInnerAngle(at){X.coneInnerAngle=at},get coneOuterAngle(){return X.coneOuterAngle},set coneOuterAngle(at){X.coneOuterAngle=at},get coneOuterGain(){return X.coneOuterGain},set coneOuterGain(at){if(at<0||at>1)throw t();X.coneOuterGain=at},get context(){return X.context},get distanceModel(){return X.distanceModel},set distanceModel(at){X.distanceModel=at},get inputs(){return[ot]},get maxDistance(){return X.maxDistance},set maxDistance(at){if(at<0)throw new RangeError;X.maxDistance=at},get numberOfInputs(){return X.numberOfInputs},get numberOfOutputs(){return X.numberOfOutputs},get orientationX(){return yt.gain},get orientationY(){return pt.gain},get orientationZ(){return dt.gain},get panningModel(){return X.panningModel},set panningModel(at){X.panningModel=at},get positionX(){return bt.gain},get positionY(){return lt.gain},get positionZ(){return wt.gain},get refDistance(){return X.refDistance},set refDistance(at){if(at<0)throw new RangeError;X.refDistance=at},get rolloffFactor(){return X.rolloffFactor},set rolloffFactor(at){if(at<0)throw new RangeError;X.rolloffFactor=at},addEventListener:(...at)=>ot.addEventListener(at[0],at[1],at[2]),dispatchEvent:(...at)=>ot.dispatchEvent(at[0]),removeEventListener:(...at)=>ot.removeEventListener(at[0],at[1],at[2])};return T!==Ot.coneInnerAngle&&(Ot.coneInnerAngle=T),S!==Ot.coneOuterAngle&&(Ot.coneOuterAngle=S),O!==Ot.coneOuterGain&&(Ot.coneOuterGain=O),z!==Ot.distanceModel&&(Ot.distanceModel=z),F!==Ot.maxDistance&&(Ot.maxDistance=F),R!==Ot.orientationX.value&&(Ot.orientationX.value=R),j!==Ot.orientationY.value&&(Ot.orientationY.value=j),B!==Ot.orientationZ.value&&(Ot.orientationZ.value=B),q!==Ot.panningModel&&(Ot.panningModel=q),H!==Ot.positionX.value&&(Ot.positionX.value=H),J!==Ot.positionY.value&&(Ot.positionY.value=J),G!==Ot.positionZ.value&&(Ot.positionZ.value=G),Y!==Ot.refDistance&&(Ot.refDistance=Y),W!==Ot.rolloffFactor&&(Ot.rolloffFactor=W),Gt[0]===1&&Gt[1]===0&&Gt[2]===0||X.setOrientation(...Gt),te[0]===0&&te[1]===0&&te[2]===0||X.setPosition(...te),f(Gs(Ot,X),()=>{ot.connect(X),n(ot,It,0,0),It.connect(yt).connect(nt,0,0),It.connect(pt).connect(nt,0,1),It.connect(dt).connect(nt,0,2),It.connect(bt).connect(nt,0,3),It.connect(lt).connect(nt,0,4),It.connect(wt).connect(nt,0,5),nt.connect(Et).connect(b.destination)},()=>{ot.disconnect(X),u(ot,It,0,0),It.disconnect(yt),yt.disconnect(nt),It.disconnect(pt),pt.disconnect(nt),It.disconnect(dt),dt.disconnect(nt),It.disconnect(bt),bt.disconnect(nt),It.disconnect(lt),lt.disconnect(nt),It.disconnect(wt),wt.disconnect(nt),nt.disconnect(Et),Et.disconnect(b.destination)})})(sn,he,xs,ke,bi,fn,be,nn,zr,ys),ha=(n=>(t,e)=>{const s=t.createPanner();return s.orientationX===void 0?n(t,e):(re(s,e),Jt(s,e,"orientationX"),Jt(s,e,"orientationY"),Jt(s,e,"orientationZ"),Jt(s,e,"positionX"),Jt(s,e,"positionY"),Jt(s,e,"positionZ"),Yt(s,e,"coneInnerAngle"),Yt(s,e,"coneOuterAngle"),Yt(s,e,"coneOuterGain"),Yt(s,e,"distanceModel"),Yt(s,e,"maxDistance"),Yt(s,e,"panningModel"),Yt(s,e,"refDistance"),Yt(s,e,"rolloffFactor"),s)})(hc),cc=((n,t,e,s,i,o,r,u,p,f)=>()=>{const b=new WeakMap;let T=null;return{render(S,O){const z=b.get(O);return z!==void 0?Promise.resolve(z):(async(F,R)=>{let j=null,B=o(F);const q={channelCount:B.channelCount,channelCountMode:B.channelCountMode,channelInterpretation:B.channelInterpretation},H={...q,coneInnerAngle:B.coneInnerAngle,coneOuterAngle:B.coneOuterAngle,coneOuterGain:B.coneOuterGain,distanceModel:B.distanceModel,maxDistance:B.maxDistance,panningModel:B.panningModel,refDistance:B.refDistance,rolloffFactor:B.rolloffFactor},J=ht(B,R);if("bufferSize"in B)j=s(R,{...q,gain:1});else if(!J){const G={...H,orientationX:B.orientationX.value,orientationY:B.orientationY.value,orientationZ:B.orientationZ.value,positionX:B.positionX.value,positionY:B.positionY.value,positionZ:B.positionZ.value};B=i(R,G)}if(b.set(R,j===null?B:j),j!==null){if(T===null){if(r===null)throw new Error("Missing the native OfflineAudioContext constructor.");const ot=new r(6,F.context.length,R.sampleRate),yt=t(ot,{channelCount:1,channelCountMode:"explicit",channelInterpretation:"speakers",numberOfInputs:6});yt.connect(ot.destination),T=(async()=>{const pt=await Promise.all([F.orientationX,F.orientationY,F.orientationZ,F.positionX,F.positionY,F.positionZ].map(async(dt,bt)=>{const lt=e(ot,{channelCount:1,channelCountMode:"explicit",channelInterpretation:"discrete",offset:bt===0?1:0});return await u(ot,dt,lt.offset),lt}));for(let dt=0;dt<6;dt+=1)pt[dt].connect(yt,0,dt),pt[dt].start(0);return f(ot)})()}const G=await T,Y=s(R,{...q,gain:1});await p(F,R,Y);const W=[];for(let ot=0;ot<G.numberOfChannels;ot+=1)W.push(G.getChannelData(ot));let K=[W[0][0],W[1][0],W[2][0]],X=[W[3][0],W[4][0],W[5][0]],$=s(R,{...q,gain:1}),nt=i(R,{...H,orientationX:K[0],orientationY:K[1],orientationZ:K[2],positionX:X[0],positionY:X[1],positionZ:X[2]});Y.connect($).connect(nt.inputs[0]),nt.connect(j);for(let ot=128;ot<G.length;ot+=128){const yt=[W[0][ot],W[1][ot],W[2][ot]],pt=[W[3][ot],W[4][ot],W[5][ot]];if(yt.some((dt,bt)=>dt!==K[bt])||pt.some((dt,bt)=>dt!==X[bt])){K=yt,X=pt;const dt=ot/R.sampleRate;$.gain.setValueAtTime(0,dt),$=s(R,{...q,gain:0}),nt=i(R,{...H,orientationX:K[0],orientationY:K[1],orientationZ:K[2],positionX:X[0],positionY:X[1],positionZ:X[2]}),$.gain.setValueAtTime(1,dt),Y.connect($).connect(nt.inputs[0]),nt.connect(j)}}return j}return J?(await n(R,F.orientationX,B.orientationX),await n(R,F.orientationY,B.orientationY),await n(R,F.orientationZ,B.orientationZ),await n(R,F.positionX,B.positionX),await n(R,F.positionY,B.positionY),await n(R,F.positionZ,B.positionZ)):(await u(R,F.orientationX,B.orientationX),await u(R,F.orientationY,B.orientationY),await u(R,F.orientationZ,B.orientationZ),await u(R,F.positionX,B.positionX),await u(R,F.positionY,B.positionY),await u(R,F.positionZ,B.positionZ)),Ie(B)?await p(F,R,B.inputs[0]):await p(F,R,B),B})(S,O)}}})(es,xs,Hs,ke,ha,jt,ce,ss,pe,pn),lc=((n,t,e,s,i,o,r)=>class extends n{constructor(u,p){const f=i(u),b={...yh,...p},T=e(f,b),S=o(f);super(u,!1,T,S?s():null),this._nativePannerNode=T,this._orientationX=t(this,S,T.orientationX,Bt,Xt),this._orientationY=t(this,S,T.orientationY,Bt,Xt),this._orientationZ=t(this,S,T.orientationZ,Bt,Xt),this._positionX=t(this,S,T.positionX,Bt,Xt),this._positionY=t(this,S,T.positionY,Bt,Xt),this._positionZ=t(this,S,T.positionZ,Bt,Xt),r(this,1)}get coneInnerAngle(){return this._nativePannerNode.coneInnerAngle}set coneInnerAngle(u){this._nativePannerNode.coneInnerAngle=u}get coneOuterAngle(){return this._nativePannerNode.coneOuterAngle}set coneOuterAngle(u){this._nativePannerNode.coneOuterAngle=u}get coneOuterGain(){return this._nativePannerNode.coneOuterGain}set coneOuterGain(u){this._nativePannerNode.coneOuterGain=u}get distanceModel(){return this._nativePannerNode.distanceModel}set distanceModel(u){this._nativePannerNode.distanceModel=u}get maxDistance(){return this._nativePannerNode.maxDistance}set maxDistance(u){this._nativePannerNode.maxDistance=u}get orientationX(){return this._orientationX}get orientationY(){return this._orientationY}get orientationZ(){return this._orientationZ}get panningModel(){return this._nativePannerNode.panningModel}set panningModel(u){this._nativePannerNode.panningModel=u}get positionX(){return this._positionX}get positionY(){return this._positionY}get positionZ(){return this._positionZ}get refDistance(){return this._nativePannerNode.refDistance}set refDistance(u){this._nativePannerNode.refDistance=u}get rolloffFactor(){return this._nativePannerNode.rolloffFactor}set rolloffFactor(u){this._nativePannerNode.rolloffFactor=u}})(se,$e,ha,cc,zt,Ft,Ps),uc=(n=>(t,{disableNormalization:e,imag:s,real:i})=>{const o=s instanceof Float32Array?s:new Float32Array(s),r=i instanceof Float32Array?i:new Float32Array(i),u=t.createPeriodicWave(r,o,{disableNormalization:e});if(Array.from(s).length<2)throw n();return u})(At),dc=((n,t,e,s)=>class Ka{constructor(o,r){const u=t(o),p=(b=>{const{imag:T,real:S}=b;return T===void 0?S===void 0?{...b,imag:[0,0],real:[0,0]}:{...b,imag:Array.from(S,()=>0),real:S}:S===void 0?{...b,imag:T,real:Array.from(T,()=>0)}:{...b,imag:T,real:S}})({...xh,...r}),f=n(u,p);return e.add(f),f}static[Symbol.hasInstance](o){return o!==null&&typeof o=="object"&&Object.getPrototypeOf(o)===Ka.prototype||e.has(o)}})(uc,zt,new WeakSet),pc=((n,t,e,s,i,o)=>{const u=new Float32Array([1,1]),p=Math.PI/2,f={channelCount:1,channelCountMode:"explicit",channelInterpretation:"discrete"},b={...f,oversample:"none"},T=(S,O,z,F,R)=>{if(O===1)return((j,B,q,H)=>{const J=new Float32Array(16385),G=new Float32Array(16385);for(let nt=0;nt<16385;nt+=1){const ot=nt/16384*p;J[nt]=Math.cos(ot),G[nt]=Math.sin(ot)}const Y=e(j,{...f,gain:0}),W=s(j,{...b,curve:J}),K=s(j,{...b,curve:u}),X=e(j,{...f,gain:0}),$=s(j,{...b,curve:G});return{connectGraph(){B.connect(Y),B.connect(K.inputs===void 0?K:K.inputs[0]),B.connect(X),K.connect(q),q.connect(W.inputs===void 0?W:W.inputs[0]),q.connect($.inputs===void 0?$:$.inputs[0]),W.connect(Y.gain),$.connect(X.gain),Y.connect(H,0,0),X.connect(H,0,1)},disconnectGraph(){B.disconnect(Y),B.disconnect(K.inputs===void 0?K:K.inputs[0]),B.disconnect(X),K.disconnect(q),q.disconnect(W.inputs===void 0?W:W.inputs[0]),q.disconnect($.inputs===void 0?$:$.inputs[0]),W.disconnect(Y.gain),$.disconnect(X.gain),Y.disconnect(H,0,0),X.disconnect(H,0,1)}}})(S,z,F,R);if(O===2)return((j,B,q,H)=>{const J=new Float32Array(16385),G=new Float32Array(16385),Y=new Float32Array(16385),W=new Float32Array(16385),K=Math.floor(8192.5);for(let Et=0;Et<16385;Et+=1)if(Et>K){const It=(Et-K)/(16384-K)*p;J[Et]=Math.cos(It),G[Et]=Math.sin(It),Y[Et]=0,W[Et]=1}else{const It=Et/(16384-K)*p;J[Et]=1,G[Et]=0,Y[Et]=Math.cos(It),W[Et]=Math.sin(It)}const X=t(j,{channelCount:2,channelCountMode:"explicit",channelInterpretation:"discrete",numberOfOutputs:2}),$=e(j,{...f,gain:0}),nt=s(j,{...b,curve:J}),ot=e(j,{...f,gain:0}),yt=s(j,{...b,curve:G}),pt=s(j,{...b,curve:u}),dt=e(j,{...f,gain:0}),bt=s(j,{...b,curve:Y}),lt=e(j,{...f,gain:0}),wt=s(j,{...b,curve:W});return{connectGraph(){B.connect(X),B.connect(pt.inputs===void 0?pt:pt.inputs[0]),X.connect($,0),X.connect(ot,0),X.connect(dt,1),X.connect(lt,1),pt.connect(q),q.connect(nt.inputs===void 0?nt:nt.inputs[0]),q.connect(yt.inputs===void 0?yt:yt.inputs[0]),q.connect(bt.inputs===void 0?bt:bt.inputs[0]),q.connect(wt.inputs===void 0?wt:wt.inputs[0]),nt.connect($.gain),yt.connect(ot.gain),bt.connect(dt.gain),wt.connect(lt.gain),$.connect(H,0,0),dt.connect(H,0,0),ot.connect(H,0,1),lt.connect(H,0,1)},disconnectGraph(){B.disconnect(X),B.disconnect(pt.inputs===void 0?pt:pt.inputs[0]),X.disconnect($,0),X.disconnect(ot,0),X.disconnect(dt,1),X.disconnect(lt,1),pt.disconnect(q),q.disconnect(nt.inputs===void 0?nt:nt.inputs[0]),q.disconnect(yt.inputs===void 0?yt:yt.inputs[0]),q.disconnect(bt.inputs===void 0?bt:bt.inputs[0]),q.disconnect(wt.inputs===void 0?wt:wt.inputs[0]),nt.disconnect($.gain),yt.disconnect(ot.gain),bt.disconnect(dt.gain),wt.disconnect(lt.gain),$.disconnect(H,0,0),dt.disconnect(H,0,0),ot.disconnect(H,0,1),lt.disconnect(H,0,1)}}})(S,z,F,R);throw i()};return(S,{channelCount:O,channelCountMode:z,pan:F,...R})=>{if(z==="max")throw i();const j=n(S,{...R,channelCount:1,channelCountMode:z,numberOfInputs:2}),B=e(S,{...R,channelCount:O,channelCountMode:z,gain:1}),q=e(S,{channelCount:1,channelCountMode:"explicit",channelInterpretation:"discrete",gain:F});let{connectGraph:H,disconnectGraph:J}=T(S,O,B,q,j);Object.defineProperty(q.gain,"defaultValue",{get:()=>0}),Object.defineProperty(q.gain,"maxValue",{get:()=>1}),Object.defineProperty(q.gain,"minValue",{get:()=>-1});const G={get bufferSize(){},get channelCount(){return B.channelCount},set channelCount(W){B.channelCount!==W&&(Y&&J(),{connectGraph:H,disconnectGraph:J}=T(S,W,B,q,j),Y&&H()),B.channelCount=W},get channelCountMode(){return B.channelCountMode},set channelCountMode(W){if(W==="clamped-max"||W==="max")throw i();B.channelCountMode=W},get channelInterpretation(){return B.channelInterpretation},set channelInterpretation(W){B.channelInterpretation=W},get context(){return B.context},get inputs(){return[B]},get numberOfInputs(){return B.numberOfInputs},get numberOfOutputs(){return B.numberOfOutputs},get pan(){return q.gain},addEventListener:(...W)=>B.addEventListener(W[0],W[1],W[2]),dispatchEvent:(...W)=>B.dispatchEvent(W[0]),removeEventListener:(...W)=>B.removeEventListener(W[0],W[1],W[2])};let Y=!1;return o(Gs(G,j),()=>{H(),Y=!0},()=>{J(),Y=!1})}})(xs,xi,ke,fn,be,ys),ca=((n,t)=>(e,s)=>{const i=s.channelCountMode;if(i==="clamped-max")throw t();if(e.createStereoPanner===void 0)return n(e,s);const o=e.createStereoPanner();return re(o,s),Jt(o,s,"pan"),Object.defineProperty(o,"channelCountMode",{get:()=>i,set:r=>{if(r!==i)throw t()}}),o})(pc,be),fc=((n,t,e,s,i)=>()=>{const o=new WeakMap;return{render(r,u){const p=o.get(u);return p!==void 0?Promise.resolve(p):(async(f,b)=>{let T=e(f);const S=ht(T,b);if(!S){const O={channelCount:T.channelCount,channelCountMode:T.channelCountMode,channelInterpretation:T.channelInterpretation,pan:T.pan.value};T=t(b,O)}return o.set(b,T),S?await n(b,f.pan,T.pan):await s(b,f.pan,T.pan),Ie(T)?await i(f,b,T.inputs[0]):await i(f,b,T),T})(r,u)}}})(es,ca,jt,ss,pe),mc=((n,t,e,s,i,o)=>class extends n{constructor(r,u){const p=i(r),f={...bh,...u},b=e(p,f),T=o(p);super(r,!1,b,T?s():null),this._pan=t(this,T,b.pan)}get pan(){return this._pan}})(se,$e,ca,fc,zt,Ft),gc=((n,t,e)=>()=>{const s=new WeakMap;return{render(i,o){const r=s.get(o);return r!==void 0?Promise.resolve(r):(async(u,p)=>{let f=t(u);if(!ht(f,p)){const b={channelCount:f.channelCount,channelCountMode:f.channelCountMode,channelInterpretation:f.channelInterpretation,curve:f.curve,oversample:f.oversample};f=n(p,b)}return s.set(p,f),Ie(f)?await e(u,p,f.inputs[0]):await e(u,p,f),f})(i,o)}}})(fn,jt,pe),vc=((n,t,e,s,i,o,r)=>class extends n{constructor(u,p){const f=i(u),b={...Th,...p},T=e(f,b);super(u,!0,T,o(f)?s():null),this._isCurveNullified=!1,this._nativeWaveShaperNode=T,r(this,1)}get curve(){return this._isCurveNullified?null:this._nativeWaveShaperNode.curve}set curve(u){if(u===null)this._isCurveNullified=!0,this._nativeWaveShaperNode.curve=new Float32Array([0,0]);else{if(u.length<2)throw t();this._isCurveNullified=!1,this._nativeWaveShaperNode.curve=u}}get oversample(){return this._nativeWaveShaperNode.oversample}set oversample(u){this._nativeWaveShaperNode.oversample=u}})(se,he,fn,gc,zt,Ft,Ps),la=(n=>n!==null&&n.isSecureContext)(Ze),no=(n=>(t,e,s)=>{Object.defineProperties(n,{currentFrame:{configurable:!0,get:()=>Math.round(t*e)},currentTime:{configurable:!0,get:()=>t}});try{return s()}finally{n!==null&&(delete n.currentFrame,delete n.currentTime)}})(Ze),ua=new WeakMap,_c=((n,t)=>e=>{let s=n.get(e);if(s!==void 0)return s;if(t===null)throw new Error("Missing the native OfflineAudioContext constructor.");return s=new t(1,1,44100),n.set(e,s),s})(ua,ce),yc=la?((n,t,e,s,i,o,r,u,p,f,b,T,S)=>{let O=0;return(z,F,R={credentials:"omit"})=>{const j=b.get(z);if(j!==void 0&&j.has(F))return Promise.resolve();const B=f.get(z);if(B!==void 0){const J=B.get(F);if(J!==void 0)return J}const q=o(z),H=q.audioWorklet===void 0?i(F).then(([J,G])=>{const[Y,W]=L(J,G);return e(`${Y};((a,b)=>{(a[b]=a[b]||[]).push((AudioWorkletProcessor,global,registerProcessor,sampleRate,self,window)=>{${W}
})})(window,'_AWGS')`)}).then(()=>{const J=S._AWGS.pop();if(J===void 0)throw new SyntaxError;s(q.currentTime,q.sampleRate,()=>J(class{},void 0,(G,Y)=>{if(G.trim()==="")throw t();const W=v.get(q);if(W!==void 0){if(W.has(G))throw t();et(Y),Q(Y.parameterDescriptors),W.set(G,Y)}else et(Y),Q(Y.parameterDescriptors),v.set(q,new Map([[G,Y]]))},q.sampleRate,void 0,void 0))}):Promise.all([i(F),Promise.resolve(n(T,T))]).then(([[J,G],Y])=>{const W=O+1;O=W;const[K,X]=L(J,G),$=new Blob([`${K};((AudioWorkletProcessor,registerProcessor)=>{${X}
})(${Y?"AudioWorkletProcessor":"class extends AudioWorkletProcessor {__b=new WeakSet();constructor(){super();(p=>p.postMessage=(q=>(m,t)=>q.call(p,m,t?t.filter(u=>!this.__b.has(u)):t))(p.postMessage))(this.port)}}"},(n,p)=>registerProcessor(n,class extends p{${Y?"":"__c = (a) => a.forEach(e=>this.__b.add(e.buffer));"}process(i,o,p){${Y?"":"i.forEach(this.__c);o.forEach(this.__c);this.__c(Object.values(p));"}return super.process(i.map(j=>j.some(k=>k.length===0)?[]:j),o,p)}}));registerProcessor('__sac${W}',class extends AudioWorkletProcessor{process(){return !1}})`],{type:"application/javascript; charset=utf-8"}),nt=URL.createObjectURL($);return q.audioWorklet.addModule(nt,R).then(()=>{if(u(q))return q;const ot=r(q);return ot.audioWorklet.addModule(nt,R).then(()=>ot)}).then(ot=>{if(p===null)throw new SyntaxError;try{new p(ot,`__sac${W}`)}catch{throw new SyntaxError}}).finally(()=>URL.revokeObjectURL(nt))});return B===void 0?f.set(z,new Map([[F,H]])):B.set(F,H),H.then(()=>{const J=b.get(z);J===void 0?b.set(z,new Set([F])):J.add(F)}).finally(()=>{const J=f.get(z);J!==void 0&&J.delete(F)}),H}})(je,be,(n=>t=>new Promise((e,s)=>{if(n===null)return void s(new SyntaxError);const i=n.document.head;if(i===null)s(new SyntaxError);else{const o=n.document.createElement("script"),r=new Blob([t],{type:"application/javascript"}),u=URL.createObjectURL(r),p=n.onerror,f=()=>{n.onerror=p,URL.revokeObjectURL(u)};n.onerror=(b,T,S,O,z)=>T===u||T===n.location.href&&S===1&&O===1?(f(),s(z),!1):p!==null?p(b,T,S,O,z):void 0,o.onerror=()=>{f(),s(new SyntaxError)},o.onload=()=>{f(),e()},o.src=u,o.type="module",i.appendChild(o)}}))(Ze),no,async n=>{try{const t=await fetch(n);if(t.ok)return[await t.text(),t.url]}catch{}throw new DOMException("","AbortError")},zt,_c,Ft,Xs,new WeakMap,new WeakMap,((n,t)=>async()=>{if(n===null)return!0;if(t===null)return!1;const e=new Blob(['class A extends AudioWorkletProcessor{process(i){this.port.postMessage(i,[i[0][0].buffer])}}registerProcessor("a",A)'],{type:"application/javascript; charset=utf-8"}),s=new t(1,128,44100),i=URL.createObjectURL(e);let o=!1,r=!1;try{await s.audioWorklet.addModule(i);const u=new n(s,"a",{numberOfOutputs:0}),p=s.createOscillator();u.port.onmessage=()=>o=!0,u.onprocessorerror=()=>r=!0,p.connect(u),p.start(0),await s.startRendering(),await new Promise(f=>setTimeout(f))}catch{}finally{URL.revokeObjectURL(i)}return o&&!r})(Xs,ce),Ze):void 0,xc=((n,t)=>e=>n(e)||t(e))(Jn,Ft),bc=((n,t,e,s,i,o,r,u,p,f,b)=>(T,S)=>{const O=r(T)?T:o(T);if(i.has(S)){const z=new DOMException("","DataCloneError");return Promise.reject(z)}try{i.add(S)}catch{}return t(p,()=>p(O))?O.decodeAudioData(S).then(z=>(Rr(S).catch(()=>{}),t(u,()=>u(z))||b(z),n.add(z),z)):new Promise((z,F)=>{const R=async()=>{try{await Rr(S)}catch{}},j=B=>{F(B),R()};try{O.decodeAudioData(S,B=>{typeof B.copyFromChannel!="function"&&(f(B),ut(B)),n.add(B),R().then(()=>z(B))},B=>{j(B===null?new DOMException("","EncodingError"):B)})}catch(B){j(B)}})})(to,je,0,0,new WeakSet,zt,xc,ct,yi,so,io),da=((n,t,e,s,i,o,r,u,p,f,b,T,S,O,z,F,R,j,B,q)=>class extends z{constructor(H,J){super(H,J),this._nativeContext=H,this._audioWorklet=n===void 0?void 0:{addModule:(G,Y)=>n(this,G,Y)}}get audioWorklet(){return this._audioWorklet}createAnalyser(){return new t(this)}createBiquadFilter(){return new i(this)}createBuffer(H,J,G){return new e({length:J,numberOfChannels:H,sampleRate:G})}createBufferSource(){return new s(this)}createChannelMerger(H=6){return new o(this,{numberOfInputs:H})}createChannelSplitter(H=6){return new r(this,{numberOfOutputs:H})}createConstantSource(){return new u(this)}createConvolver(){return new p(this)}createDelay(H=1){return new b(this,{maxDelayTime:H})}createDynamicsCompressor(){return new T(this)}createGain(){return new S(this)}createIIRFilter(H,J){return new O(this,{feedback:J,feedforward:H})}createOscillator(){return new F(this)}createPanner(){return new R(this)}createPeriodicWave(H,J,G={disableNormalization:!1}){return new j(this,{...G,imag:J,real:H})}createStereoPanner(){return new B(this)}createWaveShaper(){return new q(this)}decodeAudioData(H,J,G){return f(this._nativeContext,H).then(Y=>(typeof J=="function"&&J(Y),Y),Y=>{throw typeof G=="function"&&G(Y),Y})}})(yc,Dh,ta,Rh,Nh,Vh,Bh,Gh,Xh,bc,Hh,$h,Jh,sc,nc,rc,lc,dc,mc,vc),wc=((n,t,e,s)=>class extends n{constructor(i,o){const r=e(i),u=((p,f)=>p.createMediaElementSource(f.mediaElement))(r,o);if(s(r))throw TypeError();super(i,!0,u,null),this._nativeMediaElementAudioSourceNode=u}get mediaElement(){return this._nativeMediaElementAudioSourceNode.mediaElement}})(se,0,zt,Ft),Tc=((n,t,e,s)=>class extends n{constructor(i,o){const r=e(i);if(s(r))throw new TypeError;const u=((p,f)=>{const b=p.createMediaStreamDestination();return re(b,f),b.numberOfOutputs===1&&Object.defineProperty(b,"numberOfOutputs",{get:()=>0}),b})(r,{...mh,...o});super(i,!1,u,null),this._nativeMediaStreamAudioDestinationNode=u}get stream(){return this._nativeMediaStreamAudioDestinationNode.stream}})(se,0,zt,Ft),Ac=((n,t,e,s)=>class extends n{constructor(i,o){const r=e(i),u=((p,{mediaStream:f})=>{const b=f.getAudioTracks();b.sort((O,z)=>O.id<z.id?-1:O.id>z.id?1:0);const T=b.slice(0,1),S=p.createMediaStreamSource(new MediaStream(T));return Object.defineProperty(S,"mediaStream",{value:f}),S})(r,o);if(s(r))throw new TypeError;super(i,!0,u,null),this._nativeMediaStreamAudioSourceNode=u}get mediaStream(){return this._nativeMediaStreamAudioSourceNode.mediaStream}})(se,0,zt,Ft),kc=((n,t)=>(e,{mediaStreamTrack:s})=>{if(typeof e.createMediaStreamTrackSource=="function")return e.createMediaStreamTrackSource(s);const i=new MediaStream([s]),o=e.createMediaStreamSource(i);if(s.kind!=="audio")throw n();if(t(e))throw new TypeError;return o})(he,Ft),Sc=((n,t,e)=>class extends n{constructor(s,i){const o=e(s);super(s,!0,t(o,i),null)}})(se,kc,zt),Cc=((n,t,e,s,i,o,r,u,p)=>class extends n{constructor(f={}){if(p===null)throw new Error("Missing the native AudioContext constructor.");let b;try{b=new p(f)}catch(O){throw O.code===12&&O.message==="sampleRate is not in range"?e():O}if(b===null)throw s();if(!(O=>O===void 0||typeof O=="number"||typeof O=="string"&&(O==="balanced"||O==="interactive"||O==="playback"))(f.latencyHint))throw new TypeError(`The provided value '${f.latencyHint}' is not a valid enum value of type AudioContextLatencyCategory.`);if(f.sampleRate!==void 0&&b.sampleRate!==f.sampleRate)throw e();super(b,2);const{latencyHint:T}=f,{sampleRate:S}=b;if(this._baseLatency=typeof b.baseLatency=="number"?b.baseLatency:T==="balanced"?512/S:T==="interactive"||T===void 0?256/S:T==="playback"?1024/S:128*Math.max(2,Math.min(128,Math.round(T*S/128)))/S,this._nativeAudioContext=b,p.name==="webkitAudioContext"?(this._nativeGainNode=b.createGain(),this._nativeOscillatorNode=b.createOscillator(),this._nativeGainNode.gain.value=1e-37,this._nativeOscillatorNode.connect(this._nativeGainNode).connect(b.destination),this._nativeOscillatorNode.start()):(this._nativeGainNode=null,this._nativeOscillatorNode=null),this._state=null,b.state==="running"){this._state="suspended";const O=()=>{this._state==="suspended"&&(this._state=null),b.removeEventListener("statechange",O)};b.addEventListener("statechange",O)}}get baseLatency(){return this._baseLatency}get state(){return this._state!==null?this._state:this._nativeAudioContext.state}close(){return this.state==="closed"?this._nativeAudioContext.close().then(()=>{throw t()}):(this._state==="suspended"&&(this._state=null),this._nativeAudioContext.close().then(()=>{this._nativeGainNode!==null&&this._nativeOscillatorNode!==null&&(this._nativeOscillatorNode.stop(),this._nativeGainNode.disconnect(),this._nativeOscillatorNode.disconnect()),Ds(this)}))}createMediaElementSource(f){return new i(this,{mediaElement:f})}createMediaStreamDestination(){return new o(this)}createMediaStreamSource(f){return new r(this,{mediaStream:f})}createMediaStreamTrackSource(f){return new u(this,{mediaStreamTrack:f})}resume(){return this._state==="suspended"?new Promise((f,b)=>{const T=()=>{this._nativeAudioContext.removeEventListener("statechange",T),this._nativeAudioContext.state==="running"?f():this.resume().then(f,b)};this._nativeAudioContext.addEventListener("statechange",T)}):this._nativeAudioContext.resume().catch(f=>{throw f===void 0||f.code===15?t():f})}suspend(){return this._nativeAudioContext.suspend().catch(f=>{throw f===void 0?t():f})}})(da,he,be,wh,wc,Tc,Ac,Sc,_s),oo=(n=>t=>{const e=n.get(t);if(e===void 0)throw new Error("The context has no set of AudioWorkletNodes.");return e})(oa),Oc=(n=>(t,e)=>{n(t).add(e)})(oo),pa=(n=>(t,e,s=0,i=0)=>{const o=t[s];if(o===void 0)throw n();return rn(e)?o.connect(e,0,i):o.connect(e,0)})(At),Ec=(n=>(t,e)=>{n(t).delete(e)})(oo),fa=(n=>(t,e=void 0,s=void 0,i=0)=>e===void 0?t.forEach(o=>o.disconnect()):typeof e=="number"?cn(n,t,e).disconnect():rn(e)?s===void 0?t.forEach(o=>o.disconnect(e)):i===void 0?cn(n,t,s).disconnect(e,0):cn(n,t,s).disconnect(e,0,i):s===void 0?t.forEach(o=>o.disconnect(e)):cn(n,t,s).disconnect(e,0))(At),ma=new WeakMap,Mc=((n,t)=>e=>t(n,e))(ma,st),Dc=((n,t,e,s,i,o,r,u,p,f,b,T,S)=>(O,z,F,R)=>{if(R.numberOfInputs===0&&R.numberOfOutputs===0)throw p();const j=Array.isArray(R.outputChannelCount)?R.outputChannelCount:Array.from(R.outputChannelCount);if(j.some(it=>it<1))throw p();if(j.length!==R.numberOfOutputs)throw t();if(R.channelCountMode!=="explicit")throw p();const B=R.channelCount*R.numberOfInputs,q=j.reduce((it,Rt)=>it+Rt,0),H=F.parameterDescriptors===void 0?0:F.parameterDescriptors.length;if(B+H>6||q>6)throw p();const J=new MessageChannel,G=[],Y=[];for(let it=0;it<R.numberOfInputs;it+=1)G.push(r(O,{channelCount:R.channelCount,channelCountMode:R.channelCountMode,channelInterpretation:R.channelInterpretation,gain:1})),Y.push(i(O,{channelCount:R.channelCount,channelCountMode:"explicit",channelInterpretation:"discrete",numberOfOutputs:R.channelCount}));const W=[];if(F.parameterDescriptors!==void 0)for(const{defaultValue:it,maxValue:Rt,minValue:xe,name:Qt}of F.parameterDescriptors){const Dt=o(O,{channelCount:1,channelCountMode:"explicit",channelInterpretation:"discrete",offset:R.parameterData[Qt]!==void 0?R.parameterData[Qt]:it===void 0?0:it});Object.defineProperties(Dt.offset,{defaultValue:{get:()=>it===void 0?0:it},maxValue:{get:()=>Rt===void 0?Bt:Rt},minValue:{get:()=>xe===void 0?Xt:xe}}),W.push(Dt)}const K=s(O,{channelCount:1,channelCountMode:"explicit",channelInterpretation:"speakers",numberOfInputs:Math.max(1,B+H)}),X=Nr(z,O.sampleRate),$=u(O,X,B+H,Math.max(1,q)),nt=i(O,{channelCount:Math.max(1,q),channelCountMode:"explicit",channelInterpretation:"discrete",numberOfOutputs:Math.max(1,q)}),ot=[];for(let it=0;it<R.numberOfOutputs;it+=1)ot.push(s(O,{channelCount:1,channelCountMode:"explicit",channelInterpretation:"speakers",numberOfInputs:j[it]}));for(let it=0;it<R.numberOfInputs;it+=1){G[it].connect(Y[it]);for(let Rt=0;Rt<R.channelCount;Rt+=1)Y[it].connect(K,Rt,it*R.channelCount+Rt)}const yt=new Dr(F.parameterDescriptors===void 0?[]:F.parameterDescriptors.map(({name:it},Rt)=>{const xe=W[Rt];return xe.connect(K,0,B+Rt),xe.start(0),[it,xe.offset]}));K.connect($);let pt=R.channelInterpretation,dt=null;const bt=R.numberOfOutputs===0?[$]:ot,lt={get bufferSize(){return X},get channelCount(){return R.channelCount},set channelCount(it){throw e()},get channelCountMode(){return R.channelCountMode},set channelCountMode(it){throw e()},get channelInterpretation(){return pt},set channelInterpretation(it){for(const Rt of G)Rt.channelInterpretation=it;pt=it},get context(){return $.context},get inputs(){return G},get numberOfInputs(){return R.numberOfInputs},get numberOfOutputs(){return R.numberOfOutputs},get onprocessorerror(){return dt},set onprocessorerror(it){typeof dt=="function"&&lt.removeEventListener("processorerror",dt),dt=typeof it=="function"?it:null,typeof dt=="function"&&lt.addEventListener("processorerror",dt)},get parameters(){return yt},get port(){return J.port2},addEventListener:(...it)=>$.addEventListener(it[0],it[1],it[2]),connect:n.bind(null,bt),disconnect:f.bind(null,bt),dispatchEvent:(...it)=>$.dispatchEvent(it[0]),removeEventListener:(...it)=>$.removeEventListener(it[0],it[1],it[2])},wt=new Map;var Et,It;J.port1.addEventListener=(Et=J.port1.addEventListener,(...it)=>{if(it[0]==="message"){const Rt=typeof it[1]=="function"?it[1]:typeof it[1]=="object"&&it[1]!==null&&typeof it[1].handleEvent=="function"?it[1].handleEvent:null;if(Rt!==null){const xe=wt.get(it[1]);xe!==void 0?it[1]=xe:(it[1]=Qt=>{b(O.currentTime,O.sampleRate,()=>Rt(Qt))},wt.set(Rt,it[1]))}}return Et.call(J.port1,it[0],it[1],it[2])}),J.port1.removeEventListener=(It=J.port1.removeEventListener,(...it)=>{if(it[0]==="message"){const Rt=wt.get(it[1]);Rt!==void 0&&(wt.delete(it[1]),it[1]=Rt)}return It.call(J.port1,it[0],it[1],it[2])});let Gt=null;Object.defineProperty(J.port1,"onmessage",{get:()=>Gt,set:it=>{typeof Gt=="function"&&J.port1.removeEventListener("message",Gt),Gt=typeof it=="function"?it:null,typeof Gt=="function"&&(J.port1.addEventListener("message",Gt),J.port1.start())}}),F.prototype.port=J.port1;let te=null;((it,Rt,xe,Qt)=>{let Dt=_.get(it);Dt===void 0&&(Dt=new WeakMap,_.set(it,Dt));const Ut=(async(Oe,os)=>{const rs=await(vr=>new Promise((_r,Rl)=>{const{port1:Rn,port2:yr}=new MessageChannel;Rn.onmessage=({data:xr})=>{Rn.close(),yr.close(),_r(xr)},Rn.onmessageerror=({data:xr})=>{Rn.close(),yr.close(),Rl(xr)},yr.postMessage(vr)}))(os);return new Oe(rs)})(xe,Qt);return Dt.set(Rt,Ut),Ut})(O,lt,F,R).then(it=>te=it);const Ot=hn(R.numberOfInputs,R.channelCount),at=hn(R.numberOfOutputs,j),Vt=F.parameterDescriptors===void 0?[]:F.parameterDescriptors.reduce((it,{name:Rt})=>({...it,[Rt]:new Float32Array(128)}),{});let qt=!0;const ye=()=>{R.numberOfOutputs>0&&$.disconnect(nt);for(let it=0,Rt=0;it<R.numberOfOutputs;it+=1){const xe=ot[it];for(let Qt=0;Qt<j[it];Qt+=1)nt.disconnect(xe,Rt+Qt,Qt);Rt+=j[it]}},Es=new Map;$.onaudioprocess=({inputBuffer:it,outputBuffer:Rt})=>{if(te!==null){const xe=T(lt);for(let Qt=0;Qt<X;Qt+=128){for(let Dt=0;Dt<R.numberOfInputs;Dt+=1)for(let Ut=0;Ut<R.channelCount;Ut+=1)an(it,Ot[Dt],Ut,Ut,Qt);F.parameterDescriptors!==void 0&&F.parameterDescriptors.forEach(({name:Dt},Ut)=>{an(it,Vt,Dt,B+Ut,Qt)});for(let Dt=0;Dt<R.numberOfInputs;Dt+=1)for(let Ut=0;Ut<j[Dt];Ut+=1)at[Dt][Ut].byteLength===0&&(at[Dt][Ut]=new Float32Array(128));try{const Dt=Ot.map((Oe,os)=>{if(xe[os].size>0)return Es.set(os,X/128),Oe;const rs=Es.get(os);return rs===void 0?[]:(Oe.every(vr=>vr.every(_r=>_r===0))&&(rs===1?Es.delete(os):Es.set(os,rs-1)),Oe)});qt=b(O.currentTime+Qt/O.sampleRate,O.sampleRate,()=>te.process(Dt,at,Vt));for(let Oe=0,os=0;Oe<R.numberOfOutputs;Oe+=1){for(let rs=0;rs<j[Oe];rs+=1)Ir(Rt,at[Oe],rs,os+rs,Qt);os+=j[Oe]}}catch(Dt){qt=!1,lt.dispatchEvent(new ErrorEvent("processorerror",{colno:Dt.colno,filename:Dt.filename,lineno:Dt.lineno,message:Dt.message}))}if(!qt){for(let Dt=0;Dt<R.numberOfInputs;Dt+=1){G[Dt].disconnect(Y[Dt]);for(let Ut=0;Ut<R.channelCount;Ut+=1)Y[Qt].disconnect(K,Ut,Dt*R.channelCount+Ut)}if(F.parameterDescriptors!==void 0){const Dt=F.parameterDescriptors.length;for(let Ut=0;Ut<Dt;Ut+=1){const Oe=W[Ut];Oe.disconnect(K,0,B+Ut),Oe.stop()}}K.disconnect($),$.onaudioprocess=null,mr?ye():Ga();break}}}};let mr=!1;const gr=r(O,{channelCount:1,channelCountMode:"explicit",channelInterpretation:"discrete",gain:0}),Wa=()=>$.connect(gr).connect(O.destination),Ga=()=>{$.disconnect(gr),gr.disconnect()};return Wa(),S(lt,()=>{if(qt){Ga(),R.numberOfOutputs>0&&$.connect(nt);for(let it=0,Rt=0;it<R.numberOfOutputs;it+=1){const xe=ot[it];for(let Qt=0;Qt<j[it];Qt+=1)nt.connect(xe,Rt+Qt,Qt);Rt+=j[it]}}mr=!0},()=>{qt&&(Wa(),ye()),mr=!1})})(pa,At,he,xs,xi,Hs,ke,bi,be,fa,no,Mc,ys),Ic=((n,t,e,s,i)=>(o,r,u,p,f,b)=>{if(u!==null)try{const O=new u(o,p,b),z=new Map;let F=null;if(Object.defineProperties(O,{channelCount:{get:()=>b.channelCount,set:()=>{throw n()}},channelCountMode:{get:()=>"explicit",set:()=>{throw n()}},onprocessorerror:{get:()=>F,set:R=>{typeof F=="function"&&O.removeEventListener("processorerror",F),F=typeof R=="function"?R:null,typeof F=="function"&&O.addEventListener("processorerror",F)}}}),O.addEventListener=(S=O.addEventListener,(...R)=>{if(R[0]==="processorerror"){const j=typeof R[1]=="function"?R[1]:typeof R[1]=="object"&&R[1]!==null&&typeof R[1].handleEvent=="function"?R[1].handleEvent:null;if(j!==null){const B=z.get(R[1]);B!==void 0?R[1]=B:(R[1]=q=>{q.type==="error"?(Object.defineProperties(q,{type:{value:"processorerror"}}),j(q)):j(new ErrorEvent(R[0],{...q}))},z.set(j,R[1]))}}return S.call(O,"error",R[1],R[2]),S.call(O,...R)}),O.removeEventListener=(T=O.removeEventListener,(...R)=>{if(R[0]==="processorerror"){const j=z.get(R[1]);j!==void 0&&(z.delete(R[1]),R[1]=j)}return T.call(O,"error",R[1],R[2]),T.call(O,R[0],R[1],R[2])}),b.numberOfOutputs!==0){const R=e(o,{channelCount:1,channelCountMode:"explicit",channelInterpretation:"discrete",gain:0});return O.connect(R).connect(o.destination),i(O,()=>R.disconnect(),()=>R.connect(o.destination))}return O}catch(O){throw O.code===11?s():O}var T,S;if(f===void 0)throw s();return(O=>{const{port1:z}=new MessageChannel;try{z.postMessage(O)}finally{z.close()}})(b),t(o,r,f,b)})(he,Dc,ke,be,ys),Rc=((n,t,e,s,i,o,r,u,p,f,b,T,S,O,z,F)=>(R,j,B)=>{const q=new WeakMap;let H=null;return{render(J,G){u(G,J);const Y=q.get(G);return Y!==void 0?Promise.resolve(Y):(async(W,K)=>{let X=b(W),$=null;const nt=ht(X,K),ot=Array.isArray(j.outputChannelCount)?j.outputChannelCount:Array.from(j.outputChannelCount);if(T===null){const yt=ot.reduce((lt,wt)=>lt+wt,0),pt=i(K,{channelCount:Math.max(1,yt),channelCountMode:"explicit",channelInterpretation:"discrete",numberOfOutputs:Math.max(1,yt)}),dt=[];for(let lt=0;lt<W.numberOfOutputs;lt+=1)dt.push(s(K,{channelCount:1,channelCountMode:"explicit",channelInterpretation:"speakers",numberOfInputs:ot[lt]}));const bt=r(K,{channelCount:j.channelCount,channelCountMode:j.channelCountMode,channelInterpretation:j.channelInterpretation,gain:1});bt.connect=t.bind(null,dt),bt.disconnect=p.bind(null,dt),$=[pt,dt,bt]}else nt||(X=new T(K,R));if(q.set(K,$===null?X:$[2]),$!==null){if(H===null){if(B===void 0)throw new Error("Missing the processor constructor.");if(S===null)throw new Error("Missing the native OfflineAudioContext constructor.");const wt=W.channelCount*W.numberOfInputs,Et=B.parameterDescriptors===void 0?0:B.parameterDescriptors.length,It=wt+Et;H=oh(W,It===0?null:await(async()=>{const te=new S(It,128*Math.ceil(W.context.length/128),K.sampleRate),Ce=[],Ot=[];for(let qt=0;qt<j.numberOfInputs;qt+=1)Ce.push(r(te,{channelCount:j.channelCount,channelCountMode:j.channelCountMode,channelInterpretation:j.channelInterpretation,gain:1})),Ot.push(i(te,{channelCount:j.channelCount,channelCountMode:"explicit",channelInterpretation:"discrete",numberOfOutputs:j.channelCount}));const at=await Promise.all(Array.from(W.parameters.values()).map(async qt=>{const ye=o(te,{channelCount:1,channelCountMode:"explicit",channelInterpretation:"discrete",offset:qt.value});return await O(te,qt,ye.offset),ye})),Vt=s(te,{channelCount:1,channelCountMode:"explicit",channelInterpretation:"speakers",numberOfInputs:Math.max(1,wt+Et)});for(let qt=0;qt<j.numberOfInputs;qt+=1){Ce[qt].connect(Ot[qt]);for(let ye=0;ye<j.channelCount;ye+=1)Ot[qt].connect(Vt,ye,qt*j.channelCount+ye)}for(const[qt,ye]of at.entries())ye.connect(Vt,0,wt+qt),ye.start(0);return Vt.connect(te.destination),await Promise.all(Ce.map(qt=>z(W,te,qt))),F(te)})(),K,j,ot,B,f)}const yt=await H,pt=e(K,{buffer:null,channelCount:2,channelCountMode:"max",channelInterpretation:"speakers",loop:!1,loopEnd:0,loopStart:0,playbackRate:1}),[dt,bt,lt]=$;yt!==null&&(pt.buffer=yt,pt.start(0)),pt.connect(dt);for(let wt=0,Et=0;wt<W.numberOfOutputs;wt+=1){const It=bt[wt];for(let Gt=0;Gt<ot[wt];Gt+=1)dt.connect(It,Et+Gt,Gt);Et+=ot[wt]}return lt}if(nt)for(const[yt,pt]of W.parameters.entries())await n(K,pt,X.parameters.get(yt));else for(const[yt,pt]of W.parameters.entries())await O(K,pt,X.parameters.get(yt));return await z(W,K,X),X})(J,G)}}})(es,pa,Ys,xs,xi,Hs,ke,Ec,fa,no,jt,Xs,ce,ss,pe,pn),Pc=(n=>t=>n.get(t))(ua),qc=(n=>(t,e)=>{n.set(t,e)})(ma),ga=la?((n,t,e,s,i,o,r,u,p,f,b,T,S,O)=>class extends t{constructor(z,F,R){var j;const B=u(z),q=p(B),H=($=>({...$,outputChannelCount:$.outputChannelCount!==void 0?$.outputChannelCount:$.numberOfInputs===1&&$.numberOfOutputs===1?[$.channelCount]:Array.from({length:$.numberOfOutputs},()=>1)}))({...nh,...R});($=>{const{port1:nt,port2:ot}=new MessageChannel;try{nt.postMessage($)}finally{nt.close(),ot.close()}})(H);const J=v.get(B),G=J==null?void 0:J.get(F),Y=q||B.state!=="closed"?B:(j=r(B))!==null&&j!==void 0?j:B,W=i(Y,q?null:z.baseLatency,f,F,G,H);super(z,!0,W,q?s(F,H,G):null);const K=[];W.parameters.forEach(($,nt)=>{const ot=e(this,q,$);K.push([nt,ot])}),this._nativeAudioWorkletNode=W,this._onprocessorerror=null,this._parameters=new Dr(K),q&&n(B,this);const{activeInputs:X}=o(this);T(W,X)}get onprocessorerror(){return this._onprocessorerror}set onprocessorerror(z){const F=typeof z=="function"?O(this,z):null;this._nativeAudioWorkletNode.onprocessorerror=F;const R=this._nativeAudioWorkletNode.onprocessorerror;this._onprocessorerror=R!==null&&R===F?z:R}get parameters(){return this._parameters===null?this._nativeAudioWorkletNode.parameters:this._parameters}get port(){return this._nativeAudioWorkletNode.port}})(Oc,se,$e,Rc,Ic,ee,Pc,zt,Ft,Xs,0,qc,0,Us):void 0,Nc=((n,t)=>(e,s,i)=>{if(t===null)throw new Error("Missing the native OfflineAudioContext constructor.");try{return new t(e,s,i)}catch(o){throw o.name==="SyntaxError"?n():o}})(be,ce),Fc=((n,t,e,s,i,o,r,u)=>(p,f)=>e(p).render(p,f).then(()=>Promise.all(Array.from(s(f)).map(b=>e(b).render(b,f)))).then(()=>i(f)).then(b=>(typeof b.copyFromChannel!="function"?(r(b),ut(b)):t(o,()=>o(b))||u(b),n.add(b),b)))(to,je,Qn,oo,pn,ct,so,io),Lc=((n,t,e,s,i)=>class extends n{constructor(o,r,u){let p;if(typeof o=="number"&&r!==void 0&&u!==void 0)p={length:r,numberOfChannels:o,sampleRate:u};else{if(typeof o!="object")throw new Error("The given parameters are not valid.");p=o}const{length:f,numberOfChannels:b,sampleRate:T}={...vh,...p},S=s(b,f,T);t(yi,()=>yi(S))||S.addEventListener("statechange",(()=>{let O=0;const z=F=>{this._state==="running"&&(O>0?(S.removeEventListener("statechange",z),F.stopImmediatePropagation(),this._waitForThePromiseToSettle(F)):O+=1)};return z})()),super(S,b),this._length=f,this._nativeOfflineAudioContext=S,this._state=null}get length(){return this._nativeOfflineAudioContext.length===void 0?this._length:this._nativeOfflineAudioContext.length}get state(){return this._state===null?this._nativeOfflineAudioContext.state:this._state}startRendering(){return this._state==="running"?Promise.reject(e()):(this._state="running",i(this.destination,this._nativeOfflineAudioContext).finally(()=>{this._state=null,Ds(this)}))}_waitForThePromiseToSettle(o){this._state===null?this._nativeOfflineAudioContext.dispatchEvent(o):setTimeout(()=>this._waitForThePromiseToSettle(o))}})(da,je,he,Nc,Fc),Vc=((n,t)=>e=>{const s=n.get(e);return t(s)||t(e)})(l,Jn),zc=((n,t)=>e=>n.has(e)||t(e))(g,Kn),Bc=((n,t)=>e=>n.has(e)||t(e))(c,$r),jc=((n,t)=>e=>{const s=n.get(e);return t(s)||t(e)})(l,Ft),Wc=()=>(async(n,t,e,s,i,o,r,u,p,f,b,T,S,O,z,F)=>!!(n(t,t)&&n(e,e)&&n(i,i)&&n(o,o)&&n(u,u)&&n(p,p)&&n(f,f)&&n(b,b)&&n(T,T)&&n(S,S)&&n(O,O))&&(await Promise.all([n(s,s),n(r,r),n(z,z),n(F,F)])).every(R=>R))(je,(n=>()=>{if(n===null)return!1;const t=new n(1,1,44100).createBuffer(1,1,44100);if(t.copyToChannel===void 0)return!0;const e=new Float32Array(2);try{t.copyFromChannel(e,0,0)}catch{return!1}return!0})(ce),(n=>()=>{if(n===null)return!1;if(n.prototype!==void 0&&n.prototype.close!==void 0)return!0;const t=new n,e=t.close!==void 0;try{t.close()}catch{}return e})(_s),(n=>()=>{if(n===null)return Promise.resolve(!1);const t=new n(1,1,44100);return new Promise(e=>{let s=!0;const i=r=>{s&&(s=!1,t.startRendering(),e(r instanceof TypeError))};let o;try{o=t.decodeAudioData(null,()=>{},i)}catch(r){i(r)}o!==void 0&&o.catch(i)})})(ce),(n=>()=>{if(n===null)return!1;let t;try{t=new n({latencyHint:"balanced"})}catch{return!1}return t.close(),!0})(_s),(n=>()=>{if(n===null)return!1;const t=new n(1,1,44100).createGain(),e=t.connect(t)===t;return t.disconnect(t),e})(ce),((n,t)=>async()=>{if(n===null)return!0;if(t===null)return!1;const e=new Blob(['let c,p;class A extends AudioWorkletProcessor{constructor(){super();this.port.onmessage=(e)=>{p=e.data;p.onmessage=()=>{p.postMessage(c);p.close()};this.port.postMessage(0)}}process(){c=1}}registerProcessor("a",A)'],{type:"application/javascript; charset=utf-8"}),s=new MessageChannel,i=new t(1,128,44100),o=URL.createObjectURL(e);let r=!1;try{await i.audioWorklet.addModule(o);const u=new n(i,"a",{numberOfOutputs:0}),p=i.createOscillator();await new Promise(f=>{u.port.onmessage=()=>f(),u.port.postMessage(s.port2,[s.port2])}),u.port.onmessage=()=>r=!0,p.connect(u),p.start(0),await i.startRendering(),r=await new Promise(f=>{s.port1.onmessage=({data:b})=>f(b===1),s.port1.postMessage(0)})}catch{}finally{s.port1.close(),URL.revokeObjectURL(o)}return r})(Xs,ce),(n=>()=>{if(n===null)return!1;const t=new n(1,1,44100).createChannelMerger();if(t.channelCountMode==="max")return!0;try{t.channelCount=2}catch{return!0}return!1})(ce),(n=>()=>{if(n===null)return!1;const t=new n(1,1,44100);return t.createConstantSource===void 0||t.createConstantSource().offset.maxValue!==Number.POSITIVE_INFINITY})(ce),(n=>()=>{if(n===null)return!1;const t=new n(1,1,44100),e=t.createConvolver();e.buffer=t.createBuffer(1,1,t.sampleRate);try{e.buffer=t.createBuffer(1,1,t.sampleRate)}catch{return!1}return!0})(ce),(n=>()=>{if(n===null)return!1;const t=new n(1,1,44100).createConvolver();try{t.channelCount=1}catch{return!1}return!0})(ce),Ah,(n=>()=>n!==null&&n.hasOwnProperty("isSecureContext"))(Ze),(n=>()=>{if(n===null)return!1;const t=new n;try{return t.createMediaStreamSource(new MediaStream),!1}catch{return!0}finally{t.close()}})(_s),(n=>()=>{if(n===null)return Promise.resolve(!1);const t=new n(1,1,44100);if(t.createStereoPanner===void 0||t.createConstantSource===void 0)return Promise.resolve(!0);const e=t.createConstantSource(),s=t.createStereoPanner();return e.channelCount=1,e.offset.value=1,s.channelCount=1,e.start(),e.connect(s).connect(t.destination),t.startRendering().then(i=>i.getChannelData(0)[0]!==1)})(ce),kh);function Se(n){return n===void 0}function Tt(n){return n!==void 0}function va(n){return typeof n=="function"}function Re(n){return typeof n=="number"}function hs(n){return Object.prototype.toString.call(n)==="[object Object]"&&n.constructor===Object}function ro(n){return typeof n=="boolean"}function fe(n){return Array.isArray(n)}function Qe(n){return typeof n=="string"}function Ai(n){return Qe(n)&&/^([a-g]{1}(?:b|#|x|bb)?)(-?[0-9]+)/i.test(n)}function mt(n,t){if(!n)throw new Error(t)}function me(n,t,e=1/0){if(!(t<=n&&n<=e))throw new RangeError(`Value must be within [${t}, ${e}], got: ${n}`)}function ao(n){n.isOffline||n.state==="running"||Zs('The AudioContext is "suspended". Invoke Tone.start() from a user action to start the audio.')}let _a=!1,ya=!1;function ho(n){_a=n}function xa(n){Se(n)&&_a&&!ya&&(ya=!0,Zs("Events scheduled inside of scheduled callbacks should use the passed in scheduling time. See https://github.com/Tonejs/Tone.js/wiki/Accurate-Timing"))}let co=console;function Gc(n){co=n}function ba(...n){co.log(...n)}function Zs(...n){co.warn(...n)}const Pe=typeof self=="object"?self:null,Uc=Pe&&(Pe.hasOwnProperty("AudioContext")||Pe.hasOwnProperty("webkitAudioContext"));function Je(n,t,e,s){var i,o=arguments.length,r=o<3?t:s;if(typeof Reflect=="object"&&typeof Reflect.decorate=="function")r=Reflect.decorate(n,t,e,s);else for(var u=n.length-1;u>=0;u--)(i=n[u])&&(r=(o<3?i(r):o>3?i(t,e,r):i(t,e))||r);return o>3&&r&&Object.defineProperty(t,e,r),r}function Lt(n,t,e,s){return new(e||(e=Promise))(function(i,o){function r(f){try{p(s.next(f))}catch(b){o(b)}}function u(f){try{p(s.throw(f))}catch(b){o(b)}}function p(f){var b;f.done?i(f.value):(b=f.value,b instanceof e?b:new e(function(T){T(b)})).then(r,u)}p((s=s.apply(n,t||[])).next())})}typeof SuppressedError=="function"&&SuppressedError;class Xc{constructor(t,e,s,i){this._callback=t,this._type=e,this._minimumUpdateInterval=Math.max(128/(i||44100),.001),this.updateInterval=s,this._createClock()}_createWorker(){const t=new Blob([`
			// the initial timeout time
			let timeoutTime =  ${(1e3*this._updateInterval).toFixed(1)};
			// onmessage callback
			self.onmessage = function(msg){
				timeoutTime = parseInt(msg.data);
			};
			// the tick function which posts a message
			// and schedules a new tick
			function tick(){
				setTimeout(tick, timeoutTime);
				self.postMessage('tick');
			}
			// call tick initially
			tick();
			`],{type:"text/javascript"}),e=URL.createObjectURL(t),s=new Worker(e);s.onmessage=this._callback.bind(this),this._worker=s}_createTimeout(){this._timeout=setTimeout(()=>{this._createTimeout(),this._callback()},1e3*this._updateInterval)}_createClock(){if(this._type==="worker")try{this._createWorker()}catch{this._type="timeout",this._createClock()}else this._type==="timeout"&&this._createTimeout()}_disposeClock(){this._timeout&&clearTimeout(this._timeout),this._worker&&(this._worker.terminate(),this._worker.onmessage=null)}get updateInterval(){return this._updateInterval}set updateInterval(t){var e;this._updateInterval=Math.max(t,this._minimumUpdateInterval),this._type==="worker"&&((e=this._worker)===null||e===void 0||e.postMessage(1e3*this._updateInterval))}get type(){return this._type}set type(t){this._disposeClock(),this._type=t,this._createClock()}dispose(){this._disposeClock()}}function qs(n){return Bc(n)}function bs(n){return zc(n)}function mn(n){return jc(n)}function $s(n){return Vc(n)}function Yc(n,t){return n==="value"||qs(t)||bs(t)||function(e){return e instanceof ta}(t)}function We(n,...t){if(!t.length)return n;const e=t.shift();if(hs(n)&&hs(e))for(const s in e)Yc(s,e[s])?n[s]=e[s]:hs(e[s])?(n[s]||Object.assign(n,{[s]:{}}),We(n[s],e[s])):Object.assign(n,{[s]:e[s]});return We(n,...t)}function Z(n,t,e=[],s){const i={},o=Array.from(t);if(hs(o[0])&&s&&!Reflect.has(o[0],s)&&(Object.keys(o[0]).some(r=>Reflect.has(n,r))||(We(i,{[s]:o[0]}),e.splice(e.indexOf(s),1),o.shift())),o.length===1&&hs(o[0]))We(i,o[0]);else for(let r=0;r<e.length;r++)Tt(o[r])&&(i[e[r]]=o[r]);return We(n,i)}function Ge(n,t){return Se(n)?t:n}function ge(n,t){return t.forEach(e=>{Reflect.has(n,e)&&delete n[e]}),n}class cs{constructor(){this.debug=!1,this._wasDisposed=!1}static getDefaults(){return{}}log(...t){(this.debug||Pe&&this.toString()===Pe.TONE_DEBUG_CLASS)&&ba(this,...t)}dispose(){return this._wasDisposed=!0,this}get disposed(){return this._wasDisposed}toString(){return this.name}}cs.version=I;const lo=1e-6;function Qs(n,t){return n>t+lo}function uo(n,t){return Qs(n,t)||Ke(n,t)}function gn(n,t){return n+lo<t}function Ke(n,t){return Math.abs(n-t)<lo}function Ns(n,t,e){return Math.max(Math.min(n,e),t)}class qe extends cs{constructor(){super(),this.name="Timeline",this._timeline=[];const t=Z(qe.getDefaults(),arguments,["memory"]);this.memory=t.memory,this.increasing=t.increasing}static getDefaults(){return{memory:1/0,increasing:!1}}get length(){return this._timeline.length}add(t){if(mt(Reflect.has(t,"time"),"Timeline: events must have a time attribute"),t.time=t.time.valueOf(),this.increasing&&this.length){const e=this._timeline[this.length-1];mt(uo(t.time,e.time),"The time must be greater than or equal to the last scheduled time"),this._timeline.push(t)}else{const e=this._search(t.time);this._timeline.splice(e+1,0,t)}if(this.length>this.memory){const e=this.length-this.memory;this._timeline.splice(0,e)}return this}remove(t){const e=this._timeline.indexOf(t);return e!==-1&&this._timeline.splice(e,1),this}get(t,e="time"){const s=this._search(t,e);return s!==-1?this._timeline[s]:null}peek(){return this._timeline[0]}shift(){return this._timeline.shift()}getAfter(t,e="time"){const s=this._search(t,e);return s+1<this._timeline.length?this._timeline[s+1]:null}getBefore(t){const e=this._timeline.length;if(e>0&&this._timeline[e-1].time<t)return this._timeline[e-1];const s=this._search(t);return s-1>=0?this._timeline[s-1]:null}cancel(t){if(this._timeline.length>1){let e=this._search(t);if(e>=0)if(Ke(this._timeline[e].time,t)){for(let s=e;s>=0&&Ke(this._timeline[s].time,t);s--)e=s;this._timeline=this._timeline.slice(0,e)}else this._timeline=this._timeline.slice(0,e+1);else this._timeline=[]}else this._timeline.length===1&&uo(this._timeline[0].time,t)&&(this._timeline=[]);return this}cancelBefore(t){const e=this._search(t);return e>=0&&(this._timeline=this._timeline.slice(e+1)),this}previousEvent(t){const e=this._timeline.indexOf(t);return e>0?this._timeline[e-1]:null}_search(t,e="time"){if(this._timeline.length===0)return-1;let s=0;const i=this._timeline.length;let o=i;if(i>0&&this._timeline[i-1][e]<=t)return i-1;for(;s<o;){let r=Math.floor(s+(o-s)/2);const u=this._timeline[r],p=this._timeline[r+1];if(Ke(u[e],t)){for(let f=r;f<this._timeline.length&&Ke(this._timeline[f][e],t);f++)r=f;return r}if(gn(u[e],t)&&Qs(p[e],t))return r;Qs(u[e],t)?o=r:s=r+1}return-1}_iterate(t,e=0,s=this._timeline.length-1){this._timeline.slice(e,s+1).forEach(t)}forEach(t){return this._iterate(t),this}forEachBefore(t,e){const s=this._search(t);return s!==-1&&this._iterate(e,0,s),this}forEachAfter(t,e){const s=this._search(t);return this._iterate(e,s+1),this}forEachBetween(t,e,s){let i=this._search(t),o=this._search(e);return i!==-1&&o!==-1?(this._timeline[i].time!==t&&(i+=1),this._timeline[o].time===e&&(o-=1),this._iterate(s,i,o)):i===-1&&this._iterate(s,0,o),this}forEachFrom(t,e){let s=this._search(t);for(;s>=0&&this._timeline[s].time>=t;)s--;return this._iterate(e,s+1),this}forEachAtTime(t,e){const s=this._search(t);if(s!==-1&&Ke(this._timeline[s].time,t)){let i=s;for(let o=s;o>=0&&Ke(this._timeline[o].time,t);o--)i=o;this._iterate(o=>{e(o)},i,s)}return this}dispose(){return super.dispose(),this._timeline=[],this}}const wa=[];function vn(n){wa.push(n)}const Ta=[];function _n(n){Ta.push(n)}class Js extends cs{constructor(){super(...arguments),this.name="Emitter"}on(t,e){return t.split(/\W+/).forEach(s=>{Se(this._events)&&(this._events={}),this._events.hasOwnProperty(s)||(this._events[s]=[]),this._events[s].push(e)}),this}once(t,e){const s=(...i)=>{e(...i),this.off(t,s)};return this.on(t,s),this}off(t,e){return t.split(/\W+/).forEach(s=>{if(Se(this._events)&&(this._events={}),this._events.hasOwnProperty(s))if(Se(e))this._events[s]=[];else{const i=this._events[s];for(let o=i.length-1;o>=0;o--)i[o]===e&&i.splice(o,1)}}),this}emit(t,...e){if(this._events&&this._events.hasOwnProperty(t)){const s=this._events[t].slice(0);for(let i=0,o=s.length;i<o;i++)s[i].apply(this,e)}return this}static mixin(t){["on","once","off","emit"].forEach(e=>{const s=Object.getOwnPropertyDescriptor(Js.prototype,e);Object.defineProperty(t.prototype,e,s)})}dispose(){return super.dispose(),this._events=void 0,this}}class po extends Js{constructor(){super(...arguments),this.isOffline=!1}toJSON(){return{}}}class Ks extends po{constructor(){var t,e;super(),this.name="Context",this._constants=new Map,this._timeouts=new qe,this._timeoutIds=0,this._initialized=!1,this._closeStarted=!1,this.isOffline=!1,this._workletPromise=null;const s=Z(Ks.getDefaults(),arguments,["context"]);s.context?(this._context=s.context,this._latencyHint=((t=arguments[0])===null||t===void 0?void 0:t.latencyHint)||""):(this._context=function(i){return new Cc(i)}({latencyHint:s.latencyHint}),this._latencyHint=s.latencyHint),this._ticker=new Xc(this.emit.bind(this,"tick"),s.clockSource,s.updateInterval,this._context.sampleRate),this.on("tick",this._timeoutLoop.bind(this)),this._context.onstatechange=()=>{this.emit("statechange",this.state)},this[!((e=arguments[0])===null||e===void 0)&&e.hasOwnProperty("updateInterval")?"_lookAhead":"lookAhead"]=s.lookAhead}static getDefaults(){return{clockSource:"worker",latencyHint:"interactive",lookAhead:.1,updateInterval:.05}}initialize(){var t;return this._initialized||(t=this,wa.forEach(e=>e(t)),this._initialized=!0),this}createAnalyser(){return this._context.createAnalyser()}createOscillator(){return this._context.createOscillator()}createBufferSource(){return this._context.createBufferSource()}createBiquadFilter(){return this._context.createBiquadFilter()}createBuffer(t,e,s){return this._context.createBuffer(t,e,s)}createChannelMerger(t){return this._context.createChannelMerger(t)}createChannelSplitter(t){return this._context.createChannelSplitter(t)}createConstantSource(){return this._context.createConstantSource()}createConvolver(){return this._context.createConvolver()}createDelay(t){return this._context.createDelay(t)}createDynamicsCompressor(){return this._context.createDynamicsCompressor()}createGain(){return this._context.createGain()}createIIRFilter(t,e){return this._context.createIIRFilter(t,e)}createPanner(){return this._context.createPanner()}createPeriodicWave(t,e,s){return this._context.createPeriodicWave(t,e,s)}createStereoPanner(){return this._context.createStereoPanner()}createWaveShaper(){return this._context.createWaveShaper()}createMediaStreamSource(t){return mt($s(this._context),"Not available if OfflineAudioContext"),this._context.createMediaStreamSource(t)}createMediaElementSource(t){return mt($s(this._context),"Not available if OfflineAudioContext"),this._context.createMediaElementSource(t)}createMediaStreamDestination(){return mt($s(this._context),"Not available if OfflineAudioContext"),this._context.createMediaStreamDestination()}decodeAudioData(t){return this._context.decodeAudioData(t)}get currentTime(){return this._context.currentTime}get state(){return this._context.state}get sampleRate(){return this._context.sampleRate}get listener(){return this.initialize(),this._listener}set listener(t){mt(!this._initialized,"The listener cannot be set after initialization."),this._listener=t}get transport(){return this.initialize(),this._transport}set transport(t){mt(!this._initialized,"The transport cannot be set after initialization."),this._transport=t}get draw(){return this.initialize(),this._draw}set draw(t){mt(!this._initialized,"Draw cannot be set after initialization."),this._draw=t}get destination(){return this.initialize(),this._destination}set destination(t){mt(!this._initialized,"The destination cannot be set after initialization."),this._destination=t}createAudioWorkletNode(t,e){return function(s,i,o){return mt(Tt(ga),"AudioWorkletNode only works in a secure context (https or localhost)"),new(s instanceof(Pe==null?void 0:Pe.BaseAudioContext)?Pe==null?void 0:Pe.AudioWorkletNode:ga)(s,i,o)}(this.rawContext,t,e)}addAudioWorkletModule(t){return Lt(this,void 0,void 0,function*(){mt(Tt(this.rawContext.audioWorklet),"AudioWorkletNode is only available in a secure context (https or localhost)"),this._workletPromise||(this._workletPromise=this.rawContext.audioWorklet.addModule(t)),yield this._workletPromise})}workletsAreReady(){return Lt(this,void 0,void 0,function*(){(yield this._workletPromise)?this._workletPromise:Promise.resolve()})}get updateInterval(){return this._ticker.updateInterval}set updateInterval(t){this._ticker.updateInterval=t}get clockSource(){return this._ticker.type}set clockSource(t){this._ticker.type=t}get lookAhead(){return this._lookAhead}set lookAhead(t){this._lookAhead=t,this.updateInterval=t?t/2:.01}get latencyHint(){return this._latencyHint}get rawContext(){return this._context}now(){return this._context.currentTime+this._lookAhead}immediate(){return this._context.currentTime}resume(){return $s(this._context)?this._context.resume():Promise.resolve()}close(){return Lt(this,void 0,void 0,function*(){var t;$s(this._context)&&this.state!=="closed"&&!this._closeStarted&&(this._closeStarted=!0,yield this._context.close()),this._initialized&&(t=this,Ta.forEach(e=>e(t)))})}getConstant(t){if(this._constants.has(t))return this._constants.get(t);{const e=this._context.createBuffer(1,128,this._context.sampleRate),s=e.getChannelData(0);for(let o=0;o<s.length;o++)s[o]=t;const i=this._context.createBufferSource();return i.channelCount=1,i.channelCountMode="explicit",i.buffer=e,i.loop=!0,i.start(0),this._constants.set(t,i),i}}dispose(){return super.dispose(),this._ticker.dispose(),this._timeouts.dispose(),Object.keys(this._constants).map(t=>this._constants[t].disconnect()),this.close(),this}_timeoutLoop(){const t=this.now();let e=this._timeouts.peek();for(;this._timeouts.length&&e&&e.time<=t;)e.callback(),this._timeouts.shift(),e=this._timeouts.peek()}setTimeout(t,e){this._timeoutIds++;const s=this.now();return this._timeouts.add({callback:t,id:this._timeoutIds,time:s+e}),this._timeoutIds}clearTimeout(t){return this._timeouts.forEach(e=>{e.id===t&&this._timeouts.remove(e)}),this}clearInterval(t){return this.clearTimeout(t)}setInterval(t,e){const s=++this._timeoutIds,i=()=>{const o=this.now();this._timeouts.add({callback:()=>{t(),i()},id:s,time:o+e})};return i(),s}}function gt(n,t){fe(t)?t.forEach(e=>gt(n,e)):Object.defineProperty(n,t,{enumerable:!0,writable:!1})}function ki(n,t){fe(t)?t.forEach(e=>ki(n,e)):Object.defineProperty(n,t,{writable:!0})}const Ct=()=>{};class Mt extends cs{constructor(){super(),this.name="ToneAudioBuffer",this.onload=Ct;const t=Z(Mt.getDefaults(),arguments,["url","onload","onerror"]);this.reverse=t.reverse,this.onload=t.onload,Qe(t.url)?this.load(t.url).catch(t.onerror):t.url&&this.set(t.url)}static getDefaults(){return{onerror:Ct,onload:Ct,reverse:!1}}get sampleRate(){return this._buffer?this._buffer.sampleRate:Wt().sampleRate}set(t){return t instanceof Mt?t.loaded?this._buffer=t.get():t.onload=()=>{this.set(t),this.onload(this)}:this._buffer=t,this._reversed&&this._reverse(),this}get(){return this._buffer}load(t){return Lt(this,void 0,void 0,function*(){const e=Mt.load(t).then(s=>{this.set(s),this.onload(this)});Mt.downloads.push(e);try{yield e}finally{const s=Mt.downloads.indexOf(e);Mt.downloads.splice(s,1)}return this})}dispose(){return super.dispose(),this._buffer=void 0,this}fromArray(t){const e=fe(t)&&t[0].length>0,s=e?t.length:1,i=e?t[0].length:t.length,o=Wt(),r=o.createBuffer(s,i,o.sampleRate),u=e||s!==1?t:[t];for(let p=0;p<s;p++)r.copyToChannel(u[p],p);return this._buffer=r,this}toMono(t){if(Re(t))this.fromArray(this.toArray(t));else{let e=new Float32Array(this.length);const s=this.numberOfChannels;for(let i=0;i<s;i++){const o=this.toArray(i);for(let r=0;r<o.length;r++)e[r]+=o[r]}e=e.map(i=>i/s),this.fromArray(e)}return this}toArray(t){if(Re(t))return this.getChannelData(t);if(this.numberOfChannels===1)return this.toArray(0);{const e=[];for(let s=0;s<this.numberOfChannels;s++)e[s]=this.getChannelData(s);return e}}getChannelData(t){return this._buffer?this._buffer.getChannelData(t):new Float32Array(0)}slice(t,e=this.duration){mt(this.loaded,"Buffer is not loaded");const s=Math.floor(t*this.sampleRate),i=Math.floor(e*this.sampleRate);mt(s<i,"The start time must be less than the end time");const o=i-s,r=Wt().createBuffer(this.numberOfChannels,o,this.sampleRate);for(let u=0;u<this.numberOfChannels;u++)r.copyToChannel(this.getChannelData(u).subarray(s,i),u);return new Mt(r)}_reverse(){if(this.loaded)for(let t=0;t<this.numberOfChannels;t++)this.getChannelData(t).reverse();return this}get loaded(){return this.length>0}get duration(){return this._buffer?this._buffer.duration:0}get length(){return this._buffer?this._buffer.length:0}get numberOfChannels(){return this._buffer?this._buffer.numberOfChannels:0}get reverse(){return this._reversed}set reverse(t){this._reversed!==t&&(this._reversed=t,this._reverse())}static fromArray(t){return new Mt().fromArray(t)}static fromUrl(t){return Lt(this,void 0,void 0,function*(){return yield new Mt().load(t)})}static load(t){return Lt(this,void 0,void 0,function*(){const e=t.match(/\[([^\]\[]+\|.+)\]$/);if(e){const u=e[1].split("|");let p=u[0];for(const f of u)if(Mt.supportsType(f)){p=f;break}t=t.replace(e[0],p)}const s=Mt.baseUrl===""||Mt.baseUrl.endsWith("/")?Mt.baseUrl:Mt.baseUrl+"/",i=document.createElement("a");i.href=s+t,i.pathname=(i.pathname+i.hash).split("/").map(encodeURIComponent).join("/");const o=yield fetch(i.href);if(!o.ok)throw new Error(`could not load url: ${t}`);const r=yield o.arrayBuffer();return yield Wt().decodeAudioData(r)})}static supportsType(t){const e=t.split("."),s=e[e.length-1];return document.createElement("audio").canPlayType("audio/"+s)!==""}static loaded(){return Lt(this,void 0,void 0,function*(){for(yield Promise.resolve();Mt.downloads.length;)yield Mt.downloads[0]})}}Mt.baseUrl="",Mt.downloads=[];class ti extends Ks{constructor(){var t,e,s;super({clockSource:"offline",context:mn(arguments[0])?arguments[0]:(t=arguments[0],e=arguments[1]*arguments[2],s=arguments[2],new Lc(t,e,s)),lookAhead:0,updateInterval:mn(arguments[0])?128/arguments[0].sampleRate:128/arguments[2]}),this.name="OfflineContext",this._currentTime=0,this.isOffline=!0,this._duration=mn(arguments[0])?arguments[0].length/arguments[0].sampleRate:arguments[1]}now(){return this._currentTime}get currentTime(){return this._currentTime}_renderClock(t){return Lt(this,void 0,void 0,function*(){let e=0;for(;this._duration-this._currentTime>=0;){this.emit("tick"),this._currentTime+=128/this.sampleRate,e++;const s=Math.floor(this.sampleRate/128);t&&e%s==0&&(yield new Promise(i=>setTimeout(i,1)))}})}render(){return Lt(this,arguments,void 0,function*(t=!0){yield this.workletsAreReady(),yield this._renderClock(t);const e=yield this._context.startRendering();return new Mt(e)})}close(){return Promise.resolve()}}const Aa=new class extends po{constructor(){super(...arguments),this.lookAhead=0,this.latencyHint=0,this.isOffline=!1}createAnalyser(){return{}}createOscillator(){return{}}createBufferSource(){return{}}createBiquadFilter(){return{}}createBuffer(n,t,e){return{}}createChannelMerger(n){return{}}createChannelSplitter(n){return{}}createConstantSource(){return{}}createConvolver(){return{}}createDelay(n){return{}}createDynamicsCompressor(){return{}}createGain(){return{}}createIIRFilter(n,t){return{}}createPanner(){return{}}createPeriodicWave(n,t,e){return{}}createStereoPanner(){return{}}createWaveShaper(){return{}}createMediaStreamSource(n){return{}}createMediaElementSource(n){return{}}createMediaStreamDestination(){return{}}decodeAudioData(n){return Promise.resolve({})}createAudioWorkletNode(n,t){return{}}get rawContext(){return{}}addAudioWorkletModule(n){return Lt(this,void 0,void 0,function*(){return Promise.resolve()})}resume(){return Promise.resolve()}setTimeout(n,t){return 0}clearTimeout(n){return this}setInterval(n,t){return 0}clearInterval(n){return this}getConstant(n){return{}}get currentTime(){return 0}get state(){return{}}get sampleRate(){return 0}get listener(){return{}}get transport(){return{}}get draw(){return{}}set draw(n){}get destination(){return{}}set destination(n){}now(){return 0}immediate(){return 0}};let Si=Aa;function Wt(){return Si===Aa&&Uc&&yn(new Ks),Si}function yn(n,t=!1){t&&Si.dispose(),Si=$s(n)?new Ks(n):mn(n)?new ti(n):n}function Hc(){return Si.resume()}if(Pe&&!Pe.TONE_SILENCE_LOGGING){const t=` * Tone.js v${I} * `;console.log(`%c${t}`,"background: #000; color: #fff")}function ei(n){return Math.pow(10,n/20)}function Ci(n){return Math.log(n)/Math.LN10*20}function si(n){return Math.pow(2,n/12)}let xn=440;function ws(n){return Math.round(ka(n))}function ka(n){return 69+12*Math.log2(n/xn)}function fo(n){return xn*Math.pow(2,(n-69)/12)}class mo extends cs{constructor(t,e,s){super(),this.defaultUnits="s",this._val=e,this._units=s,this.context=t,this._expressions=this._getExpressions()}_getExpressions(){return{hz:{method:t=>this._frequencyToUnits(parseFloat(t)),regexp:/^(\d+(?:\.\d+)?)hz$/i},i:{method:t=>this._ticksToUnits(parseInt(t,10)),regexp:/^(\d+)i$/i},m:{method:t=>this._beatsToUnits(parseInt(t,10)*this._getTimeSignature()),regexp:/^(\d+)m$/i},n:{method:(t,e)=>{const s=parseInt(t,10),i=e==="."?1.5:1;return s===1?this._beatsToUnits(this._getTimeSignature())*i:this._beatsToUnits(4/s)*i},regexp:/^(\d+)n(\.?)$/i},number:{method:t=>this._expressions[this.defaultUnits].method.call(this,t),regexp:/^(\d+(?:\.\d+)?)$/},s:{method:t=>this._secondsToUnits(parseFloat(t)),regexp:/^(\d+(?:\.\d+)?)s$/},samples:{method:t=>parseInt(t,10)/this.context.sampleRate,regexp:/^(\d+)samples$/},t:{method:t=>{const e=parseInt(t,10);return this._beatsToUnits(8/(3*Math.floor(e)))},regexp:/^(\d+)t$/i},tr:{method:(t,e,s)=>{let i=0;return t&&t!=="0"&&(i+=this._beatsToUnits(this._getTimeSignature()*parseFloat(t))),e&&e!=="0"&&(i+=this._beatsToUnits(parseFloat(e))),s&&s!=="0"&&(i+=this._beatsToUnits(parseFloat(s)/4)),i},regexp:/^(\d+(?:\.\d+)?):(\d+(?:\.\d+)?):?(\d+(?:\.\d+)?)?$/}}}valueOf(){if(this._val instanceof mo&&this.fromType(this._val),Se(this._val))return this._noArg();if(Qe(this._val)&&Se(this._units)){for(const t in this._expressions)if(this._expressions[t].regexp.test(this._val.trim())){this._units=t;break}}else if(hs(this._val)){let t=0;for(const e in this._val)if(Tt(this._val[e])){const s=this._val[e];t+=new this.constructor(this.context,e).valueOf()*s}return t}if(Tt(this._units)){const t=this._expressions[this._units],e=this._val.toString().trim().match(t.regexp);return e?t.method.apply(this,e.slice(1)):t.method.call(this,this._val)}return Qe(this._val)?parseFloat(this._val):this._val}_frequencyToUnits(t){return 1/t}_beatsToUnits(t){return 60/this._getBpm()*t}_secondsToUnits(t){return t}_ticksToUnits(t){return t*this._beatsToUnits(1)/this._getPPQ()}_noArg(){return this._now()}_getBpm(){return this.context.transport.bpm.value}_getTimeSignature(){return this.context.transport.timeSignature}_getPPQ(){return this.context.transport.PPQ}fromType(t){switch(this._units=void 0,this.defaultUnits){case"s":this._val=t.toSeconds();break;case"i":this._val=t.toTicks();break;case"hz":this._val=t.toFrequency();break;case"midi":this._val=t.toMidi()}return this}toFrequency(){return 1/this.toSeconds()}toSamples(){return this.toSeconds()*this.context.sampleRate}toMilliseconds(){return 1e3*this.toSeconds()}}class Ne extends mo{constructor(){super(...arguments),this.name="TimeClass"}_getExpressions(){return Object.assign(super._getExpressions(),{now:{method:t=>this._now()+new this.constructor(this.context,t).valueOf(),regexp:/^\+(.+)/},quantize:{method:t=>{const e=new Ne(this.context,t).valueOf();return this._secondsToUnits(this.context.transport.nextSubdivision(e))},regexp:/^@(.+)/}})}quantize(t,e=1){const s=new this.constructor(this.context,t).valueOf(),i=this.valueOf();return i+(Math.round(i/s)*s-i)*e}toNotation(){const t=this.toSeconds(),e=["1m"];for(let o=1;o<9;o++){const r=Math.pow(2,o);e.push(r+"n."),e.push(r+"n"),e.push(r+"t")}e.push("0");let s=e[0],i=new Ne(this.context,e[0]).toSeconds();return e.forEach(o=>{const r=new Ne(this.context,o).toSeconds();Math.abs(r-t)<Math.abs(i-t)&&(s=o,i=r)}),s}toBarsBeatsSixteenths(){const t=this._beatsToUnits(1);let e=this.valueOf()/t;e=parseFloat(e.toFixed(4));const s=Math.floor(e/this._getTimeSignature());let i=e%1*4;e=Math.floor(e)%this._getTimeSignature();const o=i.toString();return o.length>3&&(i=parseFloat(parseFloat(o).toFixed(3))),[s,e,i].join(":")}toTicks(){const t=this._beatsToUnits(1);return this.valueOf()/t*this._getPPQ()}toSeconds(){return this.valueOf()}toMidi(){return ws(this.toFrequency())}_now(){return this.context.now()}}function Zc(n,t){return new Ne(Wt(),n,t)}class we extends Ne{constructor(){super(...arguments),this.name="Frequency",this.defaultUnits="hz"}static get A4(){return xn}static set A4(t){(function(e){xn=e})(t)}_getExpressions(){return Object.assign({},super._getExpressions(),{midi:{regexp:/^(\d+(?:\.\d+)?midi)/,method(t){return this.defaultUnits==="midi"?t:we.mtof(t)}},note:{regexp:/^([a-g]{1}(?:b|#|##|x|bb|###|#x|x#|bbb)?)(-?[0-9]+)/i,method(t,e){const s=$c[t.toLowerCase()]+12*(parseInt(e,10)+1);return this.defaultUnits==="midi"?s:we.mtof(s)}},tr:{regexp:/^(\d+(?:\.\d+)?):(\d+(?:\.\d+)?):?(\d+(?:\.\d+)?)?/,method(t,e,s){let i=1;return t&&t!=="0"&&(i*=this._beatsToUnits(this._getTimeSignature()*parseFloat(t))),e&&e!=="0"&&(i*=this._beatsToUnits(parseFloat(e))),s&&s!=="0"&&(i*=this._beatsToUnits(parseFloat(s)/4)),i}}})}transpose(t){return new we(this.context,this.valueOf()*si(t))}harmonize(t){return t.map(e=>this.transpose(e))}toMidi(){return ws(this.valueOf())}toNote(){const t=this.toFrequency(),e=Math.log2(t/we.A4);let s=Math.round(12*e)+57;const i=Math.floor(s/12);return i<0&&(s+=-12*i),Qc[s%12]+i.toString()}toSeconds(){return 1/super.toSeconds()}toTicks(){const t=this._beatsToUnits(1),e=this.valueOf()/t;return Math.floor(e*this._getPPQ())}_noArg(){return 0}_frequencyToUnits(t){return t}_ticksToUnits(t){return 1/(60*t/(this._getBpm()*this._getPPQ()))}_beatsToUnits(t){return 1/super._beatsToUnits(t)}_secondsToUnits(t){return 1/t}static mtof(t){return fo(t)}static ftom(t){return ws(t)}}const $c={cbbb:-3,cbb:-2,cb:-1,c:0,"c#":1,cx:2,"c##":2,"c###":3,"cx#":3,"c#x":3,dbbb:-1,dbb:0,db:1,d:2,"d#":3,dx:4,"d##":4,"d###":5,"dx#":5,"d#x":5,ebbb:1,ebb:2,eb:3,e:4,"e#":5,ex:6,"e##":6,"e###":7,"ex#":7,"e#x":7,fbbb:2,fbb:3,fb:4,f:5,"f#":6,fx:7,"f##":7,"f###":8,"fx#":8,"f#x":8,gbbb:4,gbb:5,gb:6,g:7,"g#":8,gx:9,"g##":9,"g###":10,"gx#":10,"g#x":10,abbb:6,abb:7,ab:8,a:9,"a#":10,ax:11,"a##":11,"a###":12,"ax#":12,"a#x":12,bbbb:8,bbb:9,bb:10,b:11,"b#":12,bx:13,"b##":13,"b###":14,"bx#":14,"b#x":14},Qc=["C","C#","D","D#","E","F","F#","G","G#","A","A#","B"];function Jc(n,t){return new we(Wt(),n,t)}class oe extends Ne{constructor(){super(...arguments),this.name="TransportTime"}_now(){return this.context.transport.seconds}}function Kc(n,t){return new oe(Wt(),n,t)}class le extends cs{constructor(){super();const t=Z(le.getDefaults(),arguments,["context"]);this.defaultContext?this.context=this.defaultContext:this.context=t.context}static getDefaults(){return{context:Wt()}}now(){return this.context.currentTime+this.context.lookAhead}immediate(){return this.context.currentTime}get sampleTime(){return 1/this.context.sampleRate}get blockTime(){return 128/this.context.sampleRate}toSeconds(t){return xa(t),new Ne(this.context,t).toSeconds()}toFrequency(t){return new we(this.context,t).toFrequency()}toTicks(t){return new oe(this.context,t).toTicks()}_getPartialProperties(t){const e=this.get();return Object.keys(e).forEach(s=>{Se(t[s])&&delete e[s]}),e}get(){const t=this.constructor.getDefaults();return Object.keys(t).forEach(e=>{if(Reflect.has(this,e)){const s=this[e];Tt(s)&&Tt(s.value)&&Tt(s.setValueAtTime)?t[e]=s.value:s instanceof le?t[e]=s._getPartialProperties(t[e]):fe(s)||Re(s)||Qe(s)||ro(s)?t[e]=s:delete t[e]}}),t}set(t){return Object.keys(t).forEach(e=>{Reflect.has(this,e)&&Tt(this[e])&&(this[e]&&Tt(this[e].value)&&Tt(this[e].setValueAtTime)?this[e].value!==t[e]&&(this[e].value=t[e]):this[e]instanceof le?this[e].set(t[e]):this[e]=t[e])}),this}}class ii extends qe{constructor(t="stopped"){super(),this.name="StateTimeline",this._initial=t,this.setStateAtTime(this._initial,0)}getValueAtTime(t){const e=this.get(t);return e!==null?e.state:this._initial}setStateAtTime(t,e,s){return me(e,0),this.add(Object.assign({},s,{state:t,time:e})),this}getLastState(t,e){for(let s=this._search(e);s>=0;s--){const i=this._timeline[s];if(i.state===t)return i}}getNextState(t,e){const s=this._search(e);if(s!==-1)for(let i=s;i<this._timeline.length;i++){const o=this._timeline[i];if(o.state===t)return o}}}class xt extends le{constructor(){const t=Z(xt.getDefaults(),arguments,["param","units","convert"]);for(super(t),this.name="Param",this.overridden=!1,this._minOutput=1e-7,mt(Tt(t.param)&&(qs(t.param)||t.param instanceof xt),"param must be an AudioParam");!qs(t.param);)t.param=t.param._param;this._swappable=!!Tt(t.swappable)&&t.swappable,this._swappable?(this.input=this.context.createGain(),this._param=t.param,this.input.connect(this._param)):this._param=this.input=t.param,this._events=new qe(1e3),this._initialValue=this._param.defaultValue,this.units=t.units,this.convert=t.convert,this._minValue=t.minValue,this._maxValue=t.maxValue,Tt(t.value)&&t.value!==this._toType(this._initialValue)&&this.setValueAtTime(t.value,0)}static getDefaults(){return Object.assign(le.getDefaults(),{convert:!0,units:"number"})}get value(){const t=this.now();return this.getValueAtTime(t)}set value(t){this.cancelScheduledValues(this.now()),this.setValueAtTime(t,this.now())}get minValue(){return Tt(this._minValue)?this._minValue:this.units==="time"||this.units==="frequency"||this.units==="normalRange"||this.units==="positive"||this.units==="transportTime"||this.units==="ticks"||this.units==="bpm"||this.units==="hertz"||this.units==="samples"?0:this.units==="audioRange"?-1:this.units==="decibels"?-1/0:this._param.minValue}get maxValue(){return Tt(this._maxValue)?this._maxValue:this.units==="normalRange"||this.units==="audioRange"?1:this._param.maxValue}_is(t,e){return this.units===e}_assertRange(t){return Tt(this.maxValue)&&Tt(this.minValue)&&me(t,this._fromType(this.minValue),this._fromType(this.maxValue)),t}_fromType(t){return this.convert&&!this.overridden?this._is(t,"time")?this.toSeconds(t):this._is(t,"decibels")?ei(t):this._is(t,"frequency")?this.toFrequency(t):t:this.overridden?0:t}_toType(t){return this.convert&&this.units==="decibels"?Ci(t):t}setValueAtTime(t,e){const s=this.toSeconds(e),i=this._fromType(t);return mt(isFinite(i)&&isFinite(s),`Invalid argument(s) to setValueAtTime: ${JSON.stringify(t)}, ${JSON.stringify(e)}`),this._assertRange(i),this.log(this.units,"setValueAtTime",t,s),this._events.add({time:s,type:"setValueAtTime",value:i}),this._param.setValueAtTime(i,s),this}getValueAtTime(t){const e=Math.max(this.toSeconds(t),0),s=this._events.getAfter(e),i=this._events.get(e);let o=this._initialValue;if(i===null)o=this._initialValue;else if(i.type!=="setTargetAtTime"||s!==null&&s.type!=="setValueAtTime")if(s===null)o=i.value;else if(s.type==="linearRampToValueAtTime"||s.type==="exponentialRampToValueAtTime"){let r=i.value;if(i.type==="setTargetAtTime"){const u=this._events.getBefore(i.time);r=u===null?this._initialValue:u.value}o=s.type==="linearRampToValueAtTime"?this._linearInterpolate(i.time,r,s.time,s.value,e):this._exponentialInterpolate(i.time,r,s.time,s.value,e)}else o=i.value;else{const r=this._events.getBefore(i.time);let u;u=r===null?this._initialValue:r.value,i.type==="setTargetAtTime"&&(o=this._exponentialApproach(i.time,u,i.value,i.constant,e))}return this._toType(o)}setRampPoint(t){t=this.toSeconds(t);let e=this.getValueAtTime(t);return this.cancelAndHoldAtTime(t),this._fromType(e)===0&&(e=this._toType(this._minOutput)),this.setValueAtTime(e,t),this}linearRampToValueAtTime(t,e){const s=this._fromType(t),i=this.toSeconds(e);return mt(isFinite(s)&&isFinite(i),`Invalid argument(s) to linearRampToValueAtTime: ${JSON.stringify(t)}, ${JSON.stringify(e)}`),this._assertRange(s),this._events.add({time:i,type:"linearRampToValueAtTime",value:s}),this.log(this.units,"linearRampToValueAtTime",t,i),this._param.linearRampToValueAtTime(s,i),this}exponentialRampToValueAtTime(t,e){let s=this._fromType(t);s=Ke(s,0)?this._minOutput:s,this._assertRange(s);const i=this.toSeconds(e);return mt(isFinite(s)&&isFinite(i),`Invalid argument(s) to exponentialRampToValueAtTime: ${JSON.stringify(t)}, ${JSON.stringify(e)}`),this._events.add({time:i,type:"exponentialRampToValueAtTime",value:s}),this.log(this.units,"exponentialRampToValueAtTime",t,i),this._param.exponentialRampToValueAtTime(s,i),this}exponentialRampTo(t,e,s){return s=this.toSeconds(s),this.setRampPoint(s),this.exponentialRampToValueAtTime(t,s+this.toSeconds(e)),this}linearRampTo(t,e,s){return s=this.toSeconds(s),this.setRampPoint(s),this.linearRampToValueAtTime(t,s+this.toSeconds(e)),this}targetRampTo(t,e,s){return s=this.toSeconds(s),this.setRampPoint(s),this.exponentialApproachValueAtTime(t,s,e),this}exponentialApproachValueAtTime(t,e,s){e=this.toSeconds(e),s=this.toSeconds(s);const i=Math.log(s+1)/Math.log(200);return this.setTargetAtTime(t,e,i),this.cancelAndHoldAtTime(e+.9*s),this.linearRampToValueAtTime(t,e+s),this}setTargetAtTime(t,e,s){const i=this._fromType(t);mt(isFinite(s)&&s>0,"timeConstant must be a number greater than 0");const o=this.toSeconds(e);return this._assertRange(i),mt(isFinite(i)&&isFinite(o),`Invalid argument(s) to setTargetAtTime: ${JSON.stringify(t)}, ${JSON.stringify(e)}`),this._events.add({constant:s,time:o,type:"setTargetAtTime",value:i}),this.log(this.units,"setTargetAtTime",t,o,s),this._param.setTargetAtTime(i,o,s),this}setValueCurveAtTime(t,e,s,i=1){s=this.toSeconds(s),e=this.toSeconds(e);const o=this._fromType(t[0])*i;this.setValueAtTime(this._toType(o),e);const r=s/(t.length-1);for(let u=1;u<t.length;u++){const p=this._fromType(t[u])*i;this.linearRampToValueAtTime(this._toType(p),e+u*r)}return this}cancelScheduledValues(t){const e=this.toSeconds(t);return mt(isFinite(e),`Invalid argument to cancelScheduledValues: ${JSON.stringify(t)}`),this._events.cancel(e),this._param.cancelScheduledValues(e),this.log(this.units,"cancelScheduledValues",e),this}cancelAndHoldAtTime(t){const e=this.toSeconds(t),s=this._fromType(this.getValueAtTime(e));mt(isFinite(e),`Invalid argument to cancelAndHoldAtTime: ${JSON.stringify(t)}`),this.log(this.units,"cancelAndHoldAtTime",e,"value="+s);const i=this._events.get(e),o=this._events.getAfter(e);return i&&Ke(i.time,e)?o?(this._param.cancelScheduledValues(o.time),this._events.cancel(o.time)):(this._param.cancelAndHoldAtTime(e),this._events.cancel(e+this.sampleTime)):o&&(this._param.cancelScheduledValues(o.time),this._events.cancel(o.time),o.type==="linearRampToValueAtTime"?this.linearRampToValueAtTime(this._toType(s),e):o.type==="exponentialRampToValueAtTime"&&this.exponentialRampToValueAtTime(this._toType(s),e)),this._events.add({time:e,type:"setValueAtTime",value:s}),this._param.setValueAtTime(s,e),this}rampTo(t,e=.1,s){return this.units==="frequency"||this.units==="bpm"||this.units==="decibels"?this.exponentialRampTo(t,e,s):this.linearRampTo(t,e,s),this}apply(t){const e=this.context.currentTime;t.setValueAtTime(this.getValueAtTime(e),e);const s=this._events.get(e);if(s&&s.type==="setTargetAtTime"){const i=this._events.getAfter(s.time),o=i?i.time:e+2,r=(o-e)/10;for(let u=e;u<o;u+=r)t.linearRampToValueAtTime(this.getValueAtTime(u),u)}return this._events.forEachAfter(this.context.currentTime,i=>{i.type==="cancelScheduledValues"?t.cancelScheduledValues(i.time):i.type==="setTargetAtTime"?t.setTargetAtTime(i.value,i.time,i.constant):t[i.type](i.value,i.time)}),this}setParam(t){mt(this._swappable,"The Param must be assigned as 'swappable' in the constructor");const e=this.input;return e.disconnect(this._param),this.apply(t),this._param=t,e.connect(this._param),this}dispose(){return super.dispose(),this._events.dispose(),this}get defaultValue(){return this._toType(this._param.defaultValue)}_exponentialApproach(t,e,s,i,o){return s+(e-s)*Math.exp(-(o-t)/i)}_linearInterpolate(t,e,s,i,o){return e+(o-t)/(s-t)*(i-e)}_exponentialInterpolate(t,e,s,i,o){return e*Math.pow(i/e,(o-t)/(s-t))}}class tt extends le{constructor(){super(...arguments),this._internalChannels=[]}get numberOfInputs(){return Tt(this.input)?qs(this.input)||this.input instanceof xt?1:this.input.numberOfInputs:0}get numberOfOutputs(){return Tt(this.output)?this.output.numberOfOutputs:0}_isAudioNode(t){return Tt(t)&&(t instanceof tt||bs(t))}_getInternalNodes(){const t=this._internalChannels.slice(0);return this._isAudioNode(this.input)&&t.push(this.input),this._isAudioNode(this.output)&&this.input!==this.output&&t.push(this.output),t}_setChannelProperties(t){this._getInternalNodes().forEach(e=>{e.channelCount=t.channelCount,e.channelCountMode=t.channelCountMode,e.channelInterpretation=t.channelInterpretation})}_getChannelProperties(){const t=this._getInternalNodes();mt(t.length>0,"ToneAudioNode does not have any internal nodes");const e=t[0];return{channelCount:e.channelCount,channelCountMode:e.channelCountMode,channelInterpretation:e.channelInterpretation}}get channelCount(){return this._getChannelProperties().channelCount}set channelCount(t){const e=this._getChannelProperties();this._setChannelProperties(Object.assign(e,{channelCount:t}))}get channelCountMode(){return this._getChannelProperties().channelCountMode}set channelCountMode(t){const e=this._getChannelProperties();this._setChannelProperties(Object.assign(e,{channelCountMode:t}))}get channelInterpretation(){return this._getChannelProperties().channelInterpretation}set channelInterpretation(t){const e=this._getChannelProperties();this._setChannelProperties(Object.assign(e,{channelInterpretation:t}))}connect(t,e=0,s=0){return Te(this,t,e,s),this}toDestination(){return this.connect(this.context.destination),this}toMaster(){return Zs("toMaster() has been renamed toDestination()"),this.toDestination()}disconnect(t,e=0,s=0){return go(this,t,e,s),this}chain(...t){return Fe(this,...t),this}fan(...t){return t.forEach(e=>this.connect(e)),this}dispose(){return super.dispose(),Tt(this.input)&&(this.input instanceof tt?this.input.dispose():bs(this.input)&&this.input.disconnect()),Tt(this.output)&&(this.output instanceof tt?this.output.dispose():bs(this.output)&&this.output.disconnect()),this._internalChannels=[],this}}function Fe(...n){const t=n.shift();n.reduce((e,s)=>(e instanceof tt?e.connect(s):bs(e)&&Te(e,s),s),t)}function Te(n,t,e=0,s=0){for(mt(Tt(n),"Cannot connect from undefined node"),mt(Tt(t),"Cannot connect to undefined node"),(t instanceof tt||bs(t))&&mt(t.numberOfInputs>0,"Cannot connect to node with no inputs"),mt(n.numberOfOutputs>0,"Cannot connect from node with no outputs");t instanceof tt||t instanceof xt;)Tt(t.input)&&(t=t.input);for(;n instanceof tt;)Tt(n.output)&&(n=n.output);qs(t)?n.connect(t,e):n.connect(t,e,s)}function go(n,t,e=0,s=0){if(Tt(t))for(;t instanceof tt;)t=t.input;for(;!bs(n);)Tt(n.output)&&(n=n.output);qs(t)?n.disconnect(t,e):bs(t)?n.disconnect(t,e,s):n.disconnect()}function tl(...n){const t=n.pop();Tt(t)&&n.forEach(e=>Te(e,t))}class ft extends tt{constructor(){const t=Z(ft.getDefaults(),arguments,["gain","units"]);super(t),this.name="Gain",this._gainNode=this.context.createGain(),this.input=this._gainNode,this.output=this._gainNode,this.gain=new xt({context:this.context,convert:t.convert,param:this._gainNode.gain,units:t.units,value:t.gain,minValue:t.minValue,maxValue:t.maxValue}),gt(this,"gain")}static getDefaults(){return Object.assign(tt.getDefaults(),{convert:!0,gain:1,units:"gain"})}dispose(){return super.dispose(),this._gainNode.disconnect(),this.gain.dispose(),this}}class ni extends tt{constructor(t){super(t),this.onended=Ct,this._startTime=-1,this._stopTime=-1,this._timeout=-1,this.output=new ft({context:this.context,gain:0}),this._gainNode=this.output,this.getStateAtTime=function(e){const s=this.toSeconds(e);return this._startTime!==-1&&s>=this._startTime&&(this._stopTime===-1||s<=this._stopTime)?"started":"stopped"},this._fadeIn=t.fadeIn,this._fadeOut=t.fadeOut,this._curve=t.curve,this.onended=t.onended}static getDefaults(){return Object.assign(tt.getDefaults(),{curve:"linear",fadeIn:0,fadeOut:0,onended:Ct})}_startGain(t,e=1){mt(this._startTime===-1,"Source cannot be started more than once");const s=this.toSeconds(this._fadeIn);return this._startTime=t+s,this._startTime=Math.max(this._startTime,this.context.currentTime),s>0?(this._gainNode.gain.setValueAtTime(0,t),this._curve==="linear"?this._gainNode.gain.linearRampToValueAtTime(e,t+s):this._gainNode.gain.exponentialApproachValueAtTime(e,t,s)):this._gainNode.gain.setValueAtTime(e,t),this}stop(t){return this.log("stop",t),this._stopGain(this.toSeconds(t)),this}_stopGain(t){mt(this._startTime!==-1,"'start' must be called before 'stop'"),this.cancelStop();const e=this.toSeconds(this._fadeOut);return this._stopTime=this.toSeconds(t)+e,this._stopTime=Math.max(this._stopTime,this.now()),e>0?this._curve==="linear"?this._gainNode.gain.linearRampTo(0,e,t):this._gainNode.gain.targetRampTo(0,e,t):(this._gainNode.gain.cancelAndHoldAtTime(t),this._gainNode.gain.setValueAtTime(0,t)),this.context.clearTimeout(this._timeout),this._timeout=this.context.setTimeout(()=>{const s=this._curve==="exponential"?2*e:0;this._stopSource(this.now()+s),this._onended()},this._stopTime-this.context.currentTime),this}_onended(){if(this.onended!==Ct&&(this.onended(this),this.onended=Ct,!this.context.isOffline)){const t=()=>this.dispose();window.requestIdleCallback!==void 0?window.requestIdleCallback(t):setTimeout(t,1e3)}}get state(){return this.getStateAtTime(this.now())}cancelStop(){return this.log("cancelStop"),mt(this._startTime!==-1,"Source is not started"),this._gainNode.gain.cancelScheduledValues(this._startTime+this.sampleTime),this.context.clearTimeout(this._timeout),this._stopTime=-1,this}dispose(){return super.dispose(),this._gainNode.dispose(),this.onended=Ct,this}}class bn extends ni{constructor(){const t=Z(bn.getDefaults(),arguments,["offset"]);super(t),this.name="ToneConstantSource",this._source=this.context.createConstantSource(),Te(this._source,this._gainNode),this.offset=new xt({context:this.context,convert:t.convert,param:this._source.offset,units:t.units,value:t.offset,minValue:t.minValue,maxValue:t.maxValue})}static getDefaults(){return Object.assign(ni.getDefaults(),{convert:!0,offset:1,units:"number"})}start(t){const e=this.toSeconds(t);return this.log("start",e),this._startGain(e),this._source.start(e),this}_stopSource(t){this._source.stop(t)}dispose(){return super.dispose(),this.state==="started"&&this.stop(),this._source.disconnect(),this.offset.dispose(),this}}class _t extends tt{constructor(){const t=Z(_t.getDefaults(),arguments,["value","units"]);super(t),this.name="Signal",this.override=!0,this.output=this._constantSource=new bn({context:this.context,convert:t.convert,offset:t.value,units:t.units,minValue:t.minValue,maxValue:t.maxValue}),this._constantSource.start(0),this.input=this._param=this._constantSource.offset}static getDefaults(){return Object.assign(tt.getDefaults(),{convert:!0,units:"number",value:0})}connect(t,e=0,s=0){return Oi(this,t,e,s),this}dispose(){return super.dispose(),this._param.dispose(),this._constantSource.dispose(),this}setValueAtTime(t,e){return this._param.setValueAtTime(t,e),this}getValueAtTime(t){return this._param.getValueAtTime(t)}setRampPoint(t){return this._param.setRampPoint(t),this}linearRampToValueAtTime(t,e){return this._param.linearRampToValueAtTime(t,e),this}exponentialRampToValueAtTime(t,e){return this._param.exponentialRampToValueAtTime(t,e),this}exponentialRampTo(t,e,s){return this._param.exponentialRampTo(t,e,s),this}linearRampTo(t,e,s){return this._param.linearRampTo(t,e,s),this}targetRampTo(t,e,s){return this._param.targetRampTo(t,e,s),this}exponentialApproachValueAtTime(t,e,s){return this._param.exponentialApproachValueAtTime(t,e,s),this}setTargetAtTime(t,e,s){return this._param.setTargetAtTime(t,e,s),this}setValueCurveAtTime(t,e,s,i){return this._param.setValueCurveAtTime(t,e,s,i),this}cancelScheduledValues(t){return this._param.cancelScheduledValues(t),this}cancelAndHoldAtTime(t){return this._param.cancelAndHoldAtTime(t),this}rampTo(t,e,s){return this._param.rampTo(t,e,s),this}get value(){return this._param.value}set value(t){this._param.value=t}get convert(){return this._param.convert}set convert(t){this._param.convert=t}get units(){return this._param.units}get overridden(){return this._param.overridden}set overridden(t){this._param.overridden=t}get maxValue(){return this._param.maxValue}get minValue(){return this._param.minValue}apply(t){return this._param.apply(t),this}}function Oi(n,t,e,s){(t instanceof xt||qs(t)||t instanceof _t&&t.override)&&(t.cancelScheduledValues(0),t.setValueAtTime(0,0),t instanceof _t&&(t.overridden=!0)),Te(n,t,e,s)}class vo extends xt{constructor(){const t=Z(vo.getDefaults(),arguments,["value"]);super(t),this.name="TickParam",this._events=new qe(1/0),this._multiplier=1,this._multiplier=t.multiplier,this._events.cancel(0),this._events.add({ticks:0,time:0,type:"setValueAtTime",value:this._fromType(t.value)}),this.setValueAtTime(t.value,0)}static getDefaults(){return Object.assign(xt.getDefaults(),{multiplier:1,units:"hertz",value:1})}setTargetAtTime(t,e,s){e=this.toSeconds(e),this.setRampPoint(e);const i=this._fromType(t),o=this._events.get(e),r=Math.round(Math.max(1/s,1));for(let u=0;u<=r;u++){const p=s*u+e,f=this._exponentialApproach(o.time,o.value,i,s,p);this.linearRampToValueAtTime(this._toType(f),p)}return this}setValueAtTime(t,e){const s=this.toSeconds(e);super.setValueAtTime(t,e);const i=this._events.get(s),o=this._events.previousEvent(i),r=this._getTicksUntilEvent(o,s);return i.ticks=Math.max(r,0),this}linearRampToValueAtTime(t,e){const s=this.toSeconds(e);super.linearRampToValueAtTime(t,e);const i=this._events.get(s),o=this._events.previousEvent(i),r=this._getTicksUntilEvent(o,s);return i.ticks=Math.max(r,0),this}exponentialRampToValueAtTime(t,e){e=this.toSeconds(e);const s=this._fromType(t),i=this._events.get(e),o=Math.round(Math.max(10*(e-i.time),1)),r=(e-i.time)/o;for(let u=0;u<=o;u++){const p=r*u+i.time,f=this._exponentialInterpolate(i.time,i.value,e,s,p);this.linearRampToValueAtTime(this._toType(f),p)}return this}_getTicksUntilEvent(t,e){if(t===null)t={ticks:0,time:0,type:"setValueAtTime",value:0};else if(Se(t.ticks)){const r=this._events.previousEvent(t);t.ticks=this._getTicksUntilEvent(r,t.time)}const s=this._fromType(this.getValueAtTime(t.time));let i=this._fromType(this.getValueAtTime(e));const o=this._events.get(e);return o&&o.time===e&&o.type==="setValueAtTime"&&(i=this._fromType(this.getValueAtTime(e-this.sampleTime))),.5*(e-t.time)*(s+i)+t.ticks}getTicksAtTime(t){const e=this.toSeconds(t),s=this._events.get(e);return Math.max(this._getTicksUntilEvent(s,e),0)}getDurationOfTicks(t,e){const s=this.toSeconds(e),i=this.getTicksAtTime(e);return this.getTimeOfTick(i+t)-s}getTimeOfTick(t){const e=this._events.get(t,"ticks"),s=this._events.getAfter(t,"ticks");if(e&&e.ticks===t)return e.time;if(e&&s&&s.type==="linearRampToValueAtTime"&&e.value!==s.value){const i=this._fromType(this.getValueAtTime(e.time)),o=(this._fromType(this.getValueAtTime(s.time))-i)/(s.time-e.time),r=Math.sqrt(Math.pow(i,2)-2*o*(e.ticks-t)),u=(-i+r)/o;return(u>0?u:(-i-r)/o)+e.time}return e?e.value===0?1/0:e.time+(t-e.ticks)/e.value:t/this._initialValue}ticksToTime(t,e){return this.getDurationOfTicks(t,e)}timeToTicks(t,e){const s=this.toSeconds(e),i=this.toSeconds(t),o=this.getTicksAtTime(s);return this.getTicksAtTime(s+i)-o}_fromType(t){return this.units==="bpm"&&this.multiplier?1/(60/t/this.multiplier):super._fromType(t)}_toType(t){return this.units==="bpm"&&this.multiplier?t/this.multiplier*60:super._toType(t)}get multiplier(){return this._multiplier}set multiplier(t){const e=this.value;this._multiplier=t,this.cancelScheduledValues(0),this.setValueAtTime(e,0)}}class _o extends _t{constructor(){const t=Z(_o.getDefaults(),arguments,["value"]);super(t),this.name="TickSignal",this.input=this._param=new vo({context:this.context,convert:t.convert,multiplier:t.multiplier,param:this._constantSource.offset,units:t.units,value:t.value})}static getDefaults(){return Object.assign(_t.getDefaults(),{multiplier:1,units:"hertz",value:1})}ticksToTime(t,e){return this._param.ticksToTime(t,e)}timeToTicks(t,e){return this._param.timeToTicks(t,e)}getTimeOfTick(t){return this._param.getTimeOfTick(t)}getDurationOfTicks(t,e){return this._param.getDurationOfTicks(t,e)}getTicksAtTime(t){return this._param.getTicksAtTime(t)}get multiplier(){return this._param.multiplier}set multiplier(t){this._param.multiplier=t}dispose(){return super.dispose(),this._param.dispose(),this}}class yo extends le{constructor(){const t=Z(yo.getDefaults(),arguments,["frequency"]);super(t),this.name="TickSource",this._state=new ii,this._tickOffset=new qe,this._ticksAtTime=new qe,this._secondsAtTime=new qe,this.frequency=new _o({context:this.context,units:t.units,value:t.frequency}),gt(this,"frequency"),this._state.setStateAtTime("stopped",0),this.setTicksAtTime(0,0)}static getDefaults(){return Object.assign({frequency:1,units:"hertz"},le.getDefaults())}get state(){return this.getStateAtTime(this.now())}start(t,e){const s=this.toSeconds(t);return this._state.getValueAtTime(s)!=="started"&&(this._state.setStateAtTime("started",s),Tt(e)&&this.setTicksAtTime(e,s),this._ticksAtTime.cancel(s),this._secondsAtTime.cancel(s)),this}stop(t){const e=this.toSeconds(t);if(this._state.getValueAtTime(e)==="stopped"){const s=this._state.get(e);s&&s.time>0&&(this._tickOffset.cancel(s.time),this._state.cancel(s.time))}return this._state.cancel(e),this._state.setStateAtTime("stopped",e),this.setTicksAtTime(0,e),this._ticksAtTime.cancel(e),this._secondsAtTime.cancel(e),this}pause(t){const e=this.toSeconds(t);return this._state.getValueAtTime(e)==="started"&&(this._state.setStateAtTime("paused",e),this._ticksAtTime.cancel(e),this._secondsAtTime.cancel(e)),this}cancel(t){return t=this.toSeconds(t),this._state.cancel(t),this._tickOffset.cancel(t),this._ticksAtTime.cancel(t),this._secondsAtTime.cancel(t),this}getTicksAtTime(t){const e=this.toSeconds(t),s=this._state.getLastState("stopped",e),i=this._ticksAtTime.get(e),o={state:"paused",time:e};this._state.add(o);let r=i||s,u=i?i.ticks:0,p=null;return this._state.forEachBetween(r.time,e+this.sampleTime,f=>{let b=r.time;const T=this._tickOffset.get(f.time);T&&T.time>=r.time&&(u=T.ticks,b=T.time),r.state==="started"&&f.state!=="started"&&(u+=this.frequency.getTicksAtTime(f.time)-this.frequency.getTicksAtTime(b),f.time!==o.time&&(p={state:f.state,time:f.time,ticks:u})),r=f}),this._state.remove(o),p&&this._ticksAtTime.add(p),u}get ticks(){return this.getTicksAtTime(this.now())}set ticks(t){this.setTicksAtTime(t,this.now())}get seconds(){return this.getSecondsAtTime(this.now())}set seconds(t){const e=this.now(),s=this.frequency.timeToTicks(t,e);this.setTicksAtTime(s,e)}getSecondsAtTime(t){t=this.toSeconds(t);const e=this._state.getLastState("stopped",t),s={state:"paused",time:t};this._state.add(s);const i=this._secondsAtTime.get(t);let o=i||e,r=i?i.seconds:0,u=null;return this._state.forEachBetween(o.time,t+this.sampleTime,p=>{let f=o.time;const b=this._tickOffset.get(p.time);b&&b.time>=o.time&&(r=b.seconds,f=b.time),o.state==="started"&&p.state!=="started"&&(r+=p.time-f,p.time!==s.time&&(u={state:p.state,time:p.time,seconds:r})),o=p}),this._state.remove(s),u&&this._secondsAtTime.add(u),r}setTicksAtTime(t,e){return e=this.toSeconds(e),this._tickOffset.cancel(e),this._tickOffset.add({seconds:this.frequency.getDurationOfTicks(t,e),ticks:t,time:e}),this._ticksAtTime.cancel(e),this._secondsAtTime.cancel(e),this}getStateAtTime(t){return t=this.toSeconds(t),this._state.getValueAtTime(t)}getTimeOfTick(t,e=this.now()){const s=this._tickOffset.get(e),i=this._state.get(e),o=Math.max(s.time,i.time),r=this.frequency.getTicksAtTime(o)+t-s.ticks;return this.frequency.getTimeOfTick(r)}forEachTickBetween(t,e,s){let i=this._state.get(t);this._state.forEachBetween(t,e,r=>{i&&i.state==="started"&&r.state!=="started"&&this.forEachTickBetween(Math.max(i.time,t),r.time-this.sampleTime,s),i=r});let o=null;if(i&&i.state==="started"){const r=Math.max(i.time,t),u=this.frequency.getTicksAtTime(r),p=u-this.frequency.getTicksAtTime(i.time);let f=Math.ceil(p)-p;f=Ke(f,1)?0:f;let b=this.frequency.getTimeOfTick(u+f);for(;b<e;){try{s(b,Math.round(this.getTicksAtTime(b)))}catch(T){o=T;break}b+=this.frequency.getDurationOfTicks(1,b)}}if(o)throw o;return this}dispose(){return super.dispose(),this._state.dispose(),this._tickOffset.dispose(),this._ticksAtTime.dispose(),this._secondsAtTime.dispose(),this.frequency.dispose(),this}}class oi extends le{constructor(){const t=Z(oi.getDefaults(),arguments,["callback","frequency"]);super(t),this.name="Clock",this.callback=Ct,this._lastUpdate=0,this._state=new ii("stopped"),this._boundLoop=this._loop.bind(this),this.callback=t.callback,this._tickSource=new yo({context:this.context,frequency:t.frequency,units:t.units}),this._lastUpdate=0,this.frequency=this._tickSource.frequency,gt(this,"frequency"),this._state.setStateAtTime("stopped",0),this.context.on("tick",this._boundLoop)}static getDefaults(){return Object.assign(le.getDefaults(),{callback:Ct,frequency:1,units:"hertz"})}get state(){return this._state.getValueAtTime(this.now())}start(t,e){ao(this.context);const s=this.toSeconds(t);return this.log("start",s),this._state.getValueAtTime(s)!=="started"&&(this._state.setStateAtTime("started",s),this._tickSource.start(s,e),s<this._lastUpdate&&this.emit("start",s,e)),this}stop(t){const e=this.toSeconds(t);return this.log("stop",e),this._state.cancel(e),this._state.setStateAtTime("stopped",e),this._tickSource.stop(e),e<this._lastUpdate&&this.emit("stop",e),this}pause(t){const e=this.toSeconds(t);return this._state.getValueAtTime(e)==="started"&&(this._state.setStateAtTime("paused",e),this._tickSource.pause(e),e<this._lastUpdate&&this.emit("pause",e)),this}get ticks(){return Math.ceil(this.getTicksAtTime(this.now()))}set ticks(t){this._tickSource.ticks=t}get seconds(){return this._tickSource.seconds}set seconds(t){this._tickSource.seconds=t}getSecondsAtTime(t){return this._tickSource.getSecondsAtTime(t)}setTicksAtTime(t,e){return this._tickSource.setTicksAtTime(t,e),this}getTimeOfTick(t,e=this.now()){return this._tickSource.getTimeOfTick(t,e)}getTicksAtTime(t){return this._tickSource.getTicksAtTime(t)}nextTickTime(t,e){const s=this.toSeconds(e),i=this.getTicksAtTime(s);return this._tickSource.getTimeOfTick(i+t,s)}_loop(){const t=this._lastUpdate,e=this.now();this._lastUpdate=e,this.log("loop",t,e),t!==e&&(this._state.forEachBetween(t,e,s=>{switch(s.state){case"started":const i=this._tickSource.getTicksAtTime(s.time);this.emit("start",s.time,i);break;case"stopped":s.time!==0&&this.emit("stop",s.time);break;case"paused":this.emit("pause",s.time)}}),this._tickSource.forEachTickBetween(t,e,(s,i)=>{this.callback(s,i)}))}getStateAtTime(t){const e=this.toSeconds(t);return this._state.getValueAtTime(e)}dispose(){return super.dispose(),this.context.off("tick",this._boundLoop),this._tickSource.dispose(),this._state.dispose(),this}}Js.mixin(oi);class Le extends tt{constructor(){const t=Z(Le.getDefaults(),arguments,["delayTime","maxDelay"]);super(t),this.name="Delay";const e=this.toSeconds(t.maxDelay);this._maxDelay=Math.max(e,this.toSeconds(t.delayTime)),this._delayNode=this.input=this.output=this.context.createDelay(e),this.delayTime=new xt({context:this.context,param:this._delayNode.delayTime,units:"time",value:t.delayTime,minValue:0,maxValue:this.maxDelay}),gt(this,"delayTime")}static getDefaults(){return Object.assign(tt.getDefaults(),{delayTime:0,maxDelay:1})}get maxDelay(){return this._maxDelay}dispose(){return super.dispose(),this._delayNode.disconnect(),this.delayTime.dispose(),this}}class ls extends tt{constructor(){const t=Z(ls.getDefaults(),arguments,["volume"]);super(t),this.name="Volume",this.input=this.output=new ft({context:this.context,gain:t.volume,units:"decibels"}),this.volume=this.output.gain,gt(this,"volume"),this._unmutedVolume=t.volume,this.mute=t.mute}static getDefaults(){return Object.assign(tt.getDefaults(),{mute:!1,volume:0})}get mute(){return this.volume.value===-1/0}set mute(t){!this.mute&&t?(this._unmutedVolume=this.volume.value,this.volume.value=-1/0):this.mute&&!t&&(this.volume.value=this._unmutedVolume)}dispose(){return super.dispose(),this.input.dispose(),this.volume.dispose(),this}}class xo extends tt{constructor(){const t=Z(xo.getDefaults(),arguments);super(t),this.name="Destination",this.input=new ls({context:this.context}),this.output=new ft({context:this.context}),this.volume=this.input.volume,Fe(this.input,this.output,this.context.rawContext.destination),this.mute=t.mute,this._internalChannels=[this.input,this.context.rawContext.destination,this.output]}static getDefaults(){return Object.assign(tt.getDefaults(),{mute:!1,volume:0})}get mute(){return this.input.mute}set mute(t){this.input.mute=t}chain(...t){return this.input.disconnect(),t.unshift(this.input),t.push(this.output),Fe(...t),this}get maxChannelCount(){return this.context.rawContext.destination.maxChannelCount}dispose(){return super.dispose(),this.volume.dispose(),this}}vn(n=>{n.destination=new xo({context:n})}),_n(n=>{n.destination.dispose()});class el extends tt{constructor(){super(...arguments),this.name="Listener",this.positionX=new xt({context:this.context,param:this.context.rawContext.listener.positionX}),this.positionY=new xt({context:this.context,param:this.context.rawContext.listener.positionY}),this.positionZ=new xt({context:this.context,param:this.context.rawContext.listener.positionZ}),this.forwardX=new xt({context:this.context,param:this.context.rawContext.listener.forwardX}),this.forwardY=new xt({context:this.context,param:this.context.rawContext.listener.forwardY}),this.forwardZ=new xt({context:this.context,param:this.context.rawContext.listener.forwardZ}),this.upX=new xt({context:this.context,param:this.context.rawContext.listener.upX}),this.upY=new xt({context:this.context,param:this.context.rawContext.listener.upY}),this.upZ=new xt({context:this.context,param:this.context.rawContext.listener.upZ})}static getDefaults(){return Object.assign(tt.getDefaults(),{positionX:0,positionY:0,positionZ:0,forwardX:0,forwardY:0,forwardZ:-1,upX:0,upY:1,upZ:0})}dispose(){return super.dispose(),this.positionX.dispose(),this.positionY.dispose(),this.positionZ.dispose(),this.forwardX.dispose(),this.forwardY.dispose(),this.forwardZ.dispose(),this.upX.dispose(),this.upY.dispose(),this.upZ.dispose(),this}}function sl(n,t){return Lt(this,arguments,void 0,function*(e,s,i=2,o=Wt().sampleRate){const r=Wt(),u=new ti(i,s,o);yn(u),yield e(u);const p=u.render();yn(r);const f=yield p;return new Mt(f)})}vn(n=>{n.listener=new el({context:n})}),_n(n=>{n.listener.dispose()});class ri extends cs{constructor(){super(),this.name="ToneAudioBuffers",this._buffers=new Map,this._loadingCount=0;const t=Z(ri.getDefaults(),arguments,["urls","onload","baseUrl"],"urls");this.baseUrl=t.baseUrl,Object.keys(t.urls).forEach(e=>{this._loadingCount++;const s=t.urls[e];this.add(e,s,this._bufferLoaded.bind(this,t.onload),t.onerror)})}static getDefaults(){return{baseUrl:"",onerror:Ct,onload:Ct,urls:{}}}has(t){return this._buffers.has(t.toString())}get(t){return mt(this.has(t),`ToneAudioBuffers has no buffer named: ${t}`),this._buffers.get(t.toString())}_bufferLoaded(t){this._loadingCount--,this._loadingCount===0&&t&&t()}get loaded(){return Array.from(this._buffers).every(([t,e])=>e.loaded)}add(t,e,s=Ct,i=Ct){return Qe(e)?(this.baseUrl&&e.trim().substring(0,11).toLowerCase()==="data:audio/"&&(this.baseUrl=""),this._buffers.set(t.toString(),new Mt(this.baseUrl+e,s,i))):this._buffers.set(t.toString(),new Mt(e,s,i)),this}dispose(){return super.dispose(),this._buffers.forEach(t=>t.dispose()),this._buffers.clear(),this}}class ai extends we{constructor(){super(...arguments),this.name="MidiClass",this.defaultUnits="midi"}_frequencyToUnits(t){return ws(super._frequencyToUnits(t))}_ticksToUnits(t){return ws(super._ticksToUnits(t))}_beatsToUnits(t){return ws(super._beatsToUnits(t))}_secondsToUnits(t){return ws(super._secondsToUnits(t))}toMidi(){return this.valueOf()}toFrequency(){return fo(this.toMidi())}transpose(t){return new ai(this.context,this.toMidi()+t)}}function il(n,t){return new ai(Wt(),n,t)}class Ht extends oe{constructor(){super(...arguments),this.name="Ticks",this.defaultUnits="i"}_now(){return this.context.transport.ticks}_beatsToUnits(t){return this._getPPQ()*t}_secondsToUnits(t){return Math.floor(t/(60/this._getBpm())*this._getPPQ())}_ticksToUnits(t){return t}toTicks(){return this.valueOf()}toSeconds(){return this.valueOf()/this._getPPQ()*(60/this._getBpm())}}function nl(n,t){return new Ht(Wt(),n,t)}class ol extends le{constructor(){super(...arguments),this.name="Draw",this.expiration=.25,this.anticipation=.008,this._events=new qe,this._boundDrawLoop=this._drawLoop.bind(this),this._animationFrame=-1}schedule(t,e){return this._events.add({callback:t,time:this.toSeconds(e)}),this._events.length===1&&(this._animationFrame=requestAnimationFrame(this._boundDrawLoop)),this}cancel(t){return this._events.cancel(this.toSeconds(t)),this}_drawLoop(){const t=this.context.currentTime;for(;this._events.length&&this._events.peek().time-this.anticipation<=t;){const e=this._events.shift();e&&t-e.time<=this.expiration&&e.callback()}this._events.length>0&&(this._animationFrame=requestAnimationFrame(this._boundDrawLoop))}dispose(){return super.dispose(),this._events.dispose(),cancelAnimationFrame(this._animationFrame),this}}vn(n=>{n.draw=new ol({context:n})}),_n(n=>{n.draw.dispose()});class Sa extends cs{constructor(){super(...arguments),this.name="IntervalTimeline",this._root=null,this._length=0}add(t){mt(Tt(t.time),"Events must have a time property"),mt(Tt(t.duration),"Events must have a duration parameter"),t.time=t.time.valueOf();let e=new rl(t.time,t.time+t.duration,t);for(this._root===null?this._root=e:this._root.insert(e),this._length++;e!==null;)e.updateHeight(),e.updateMax(),this._rebalance(e),e=e.parent;return this}remove(t){if(this._root!==null){const e=[];this._root.search(t.time,e);for(const s of e)if(s.event===t){this._removeNode(s),this._length--;break}}return this}get length(){return this._length}cancel(t){return this.forEachFrom(t,e=>this.remove(e)),this}_setRoot(t){this._root=t,this._root!==null&&(this._root.parent=null)}_replaceNodeInParent(t,e){t.parent!==null?(t.isLeftChild()?t.parent.left=e:t.parent.right=e,this._rebalance(t.parent)):this._setRoot(e)}_removeNode(t){if(t.left===null&&t.right===null)this._replaceNodeInParent(t,null);else if(t.right===null)this._replaceNodeInParent(t,t.left);else if(t.left===null)this._replaceNodeInParent(t,t.right);else{let e,s=null;if(t.getBalance()>0)if(t.left.right===null)e=t.left,e.right=t.right,s=e;else{for(e=t.left.right;e.right!==null;)e=e.right;e.parent&&(e.parent.right=e.left,s=e.parent,e.left=t.left,e.right=t.right)}else if(t.right.left===null)e=t.right,e.left=t.left,s=e;else{for(e=t.right.left;e.left!==null;)e=e.left;e.parent&&(e.parent.left=e.right,s=e.parent,e.left=t.left,e.right=t.right)}t.parent!==null?t.isLeftChild()?t.parent.left=e:t.parent.right=e:this._setRoot(e),s&&this._rebalance(s)}t.dispose()}_rotateLeft(t){const e=t.parent,s=t.isLeftChild(),i=t.right;i&&(t.right=i.left,i.left=t),e!==null?s?e.left=i:e.right=i:this._setRoot(i)}_rotateRight(t){const e=t.parent,s=t.isLeftChild(),i=t.left;i&&(t.left=i.right,i.right=t),e!==null?s?e.left=i:e.right=i:this._setRoot(i)}_rebalance(t){const e=t.getBalance();e>1&&t.left?t.left.getBalance()<0?this._rotateLeft(t.left):this._rotateRight(t):e<-1&&t.right&&(t.right.getBalance()>0?this._rotateRight(t.right):this._rotateLeft(t))}get(t){if(this._root!==null){const e=[];if(this._root.search(t,e),e.length>0){let s=e[0];for(let i=1;i<e.length;i++)e[i].low>s.low&&(s=e[i]);return s.event}}return null}forEach(t){if(this._root!==null){const e=[];this._root.traverse(s=>e.push(s)),e.forEach(s=>{s.event&&t(s.event)})}return this}forEachAtTime(t,e){if(this._root!==null){const s=[];this._root.search(t,s),s.forEach(i=>{i.event&&e(i.event)})}return this}forEachFrom(t,e){if(this._root!==null){const s=[];this._root.searchAfter(t,s),s.forEach(i=>{i.event&&e(i.event)})}return this}dispose(){return super.dispose(),this._root!==null&&this._root.traverse(t=>t.dispose()),this._root=null,this}}class rl{constructor(t,e,s){this._left=null,this._right=null,this.parent=null,this.height=0,this.event=s,this.low=t,this.high=e,this.max=this.high}insert(t){t.low<=this.low?this.left===null?this.left=t:this.left.insert(t):this.right===null?this.right=t:this.right.insert(t)}search(t,e){t>this.max||(this.left!==null&&this.left.search(t,e),this.low<=t&&this.high>t&&e.push(this),this.low>t||this.right!==null&&this.right.search(t,e))}searchAfter(t,e){this.low>=t&&(e.push(this),this.left!==null&&this.left.searchAfter(t,e)),this.right!==null&&this.right.searchAfter(t,e)}traverse(t){t(this),this.left!==null&&this.left.traverse(t),this.right!==null&&this.right.traverse(t)}updateHeight(){this.left!==null&&this.right!==null?this.height=Math.max(this.left.height,this.right.height)+1:this.right!==null?this.height=this.right.height+1:this.left!==null?this.height=this.left.height+1:this.height=0}updateMax(){this.max=this.high,this.left!==null&&(this.max=Math.max(this.max,this.left.max)),this.right!==null&&(this.max=Math.max(this.max,this.right.max))}getBalance(){let t=0;return this.left!==null&&this.right!==null?t=this.left.height-this.right.height:this.left!==null?t=this.left.height+1:this.right!==null&&(t=-(this.right.height+1)),t}isLeftChild(){return this.parent!==null&&this.parent.left===this}get left(){return this._left}set left(t){this._left=t,t!==null&&(t.parent=this),this.updateHeight(),this.updateMax()}get right(){return this._right}set right(t){this._right=t,t!==null&&(t.parent=this),this.updateHeight(),this.updateMax()}dispose(){this.parent=null,this._left=null,this._right=null,this.event=null}}class al extends cs{constructor(t){super(),this.name="TimelineValue",this._timeline=new qe({memory:10}),this._initialValue=t}set(t,e){return this._timeline.add({value:t,time:e}),this}get(t){const e=this._timeline.get(t);return e?e.value:this._initialValue}}class Ve extends tt{constructor(){super(Z(Ve.getDefaults(),arguments,["context"]))}connect(t,e=0,s=0){return Oi(this,t,e,s),this}}class ts extends Ve{constructor(){const t=Z(ts.getDefaults(),arguments,["mapping","length"]);super(t),this.name="WaveShaper",this._shaper=this.context.createWaveShaper(),this.input=this._shaper,this.output=this._shaper,fe(t.mapping)||t.mapping instanceof Float32Array?this.curve=Float32Array.from(t.mapping):va(t.mapping)&&this.setMap(t.mapping,t.length)}static getDefaults(){return Object.assign(_t.getDefaults(),{length:1024})}setMap(t,e=1024){const s=new Float32Array(e);for(let i=0,o=e;i<o;i++){const r=i/(o-1)*2-1;s[i]=t(r,i)}return this.curve=s,this}get curve(){return this._shaper.curve}set curve(t){this._shaper.curve=t}get oversample(){return this._shaper.oversample}set oversample(t){mt(["none","2x","4x"].some(e=>e.includes(t)),"oversampling must be either 'none', '2x', or '4x'"),this._shaper.oversample=t}dispose(){return super.dispose(),this._shaper.disconnect(),this}}class hi extends Ve{constructor(){const t=Z(hi.getDefaults(),arguments,["value"]);super(t),this.name="Pow",this._exponentScaler=this.input=this.output=new ts({context:this.context,mapping:this._expFunc(t.value),length:8192}),this._exponent=t.value}static getDefaults(){return Object.assign(Ve.getDefaults(),{value:1})}_expFunc(t){return e=>Math.pow(Math.abs(e),t)}get value(){return this._exponent}set value(t){this._exponent=t,this._exponentScaler.setMap(this._expFunc(this._exponent))}dispose(){return super.dispose(),this._exponentScaler.dispose(),this}}class Ts{constructor(t,e){this.id=Ts._eventId++,this._remainderTime=0;const s=Object.assign(Ts.getDefaults(),e);this.transport=t,this.callback=s.callback,this._once=s.once,this.time=Math.floor(s.time),this._remainderTime=s.time-this.time}static getDefaults(){return{callback:Ct,once:!1,time:0}}get floatTime(){return this.time+this._remainderTime}invoke(t){if(this.callback){const e=this.transport.bpm.getDurationOfTicks(1,t);this.callback(t+this._remainderTime*e),this._once&&this.transport.clear(this.id)}}dispose(){return this.callback=void 0,this}}Ts._eventId=0;class bo extends Ts{constructor(t,e){super(t,e),this._currentId=-1,this._nextId=-1,this._nextTick=this.time,this._boundRestart=this._restart.bind(this);const s=Object.assign(bo.getDefaults(),e);this.duration=s.duration,this._interval=s.interval,this._nextTick=s.time,this.transport.on("start",this._boundRestart),this.transport.on("loopStart",this._boundRestart),this.transport.on("ticks",this._boundRestart),this.context=this.transport.context,this._restart()}static getDefaults(){return Object.assign({},Ts.getDefaults(),{duration:1/0,interval:1,once:!1})}invoke(t){this._createEvents(t),super.invoke(t)}_createEvent(){return gn(this._nextTick,this.floatTime+this.duration)?this.transport.scheduleOnce(this.invoke.bind(this),new Ht(this.context,this._nextTick).toSeconds()):-1}_createEvents(t){gn(this._nextTick+this._interval,this.floatTime+this.duration)&&(this._nextTick+=this._interval,this._currentId=this._nextId,this._nextId=this.transport.scheduleOnce(this.invoke.bind(this),new Ht(this.context,this._nextTick).toSeconds()))}_restart(t){this.transport.clear(this._currentId),this.transport.clear(this._nextId),this._nextTick=this.floatTime;const e=this.transport.getTicksAtTime(t);Qs(e,this.time)&&(this._nextTick=this.floatTime+Math.ceil((e-this.floatTime)/this._interval)*this._interval),this._currentId=this._createEvent(),this._nextTick+=this._interval,this._nextId=this._createEvent()}dispose(){return super.dispose(),this.transport.clear(this._currentId),this.transport.clear(this._nextId),this.transport.off("start",this._boundRestart),this.transport.off("loopStart",this._boundRestart),this.transport.off("ticks",this._boundRestart),this}}class wn extends le{constructor(){const t=Z(wn.getDefaults(),arguments);super(t),this.name="Transport",this._loop=new al(!1),this._loopStart=0,this._loopEnd=0,this._scheduledEvents={},this._timeline=new qe,this._repeatedEvents=new Sa,this._syncedSignals=[],this._swingAmount=0,this._ppq=t.ppq,this._clock=new oi({callback:this._processTick.bind(this),context:this.context,frequency:0,units:"bpm"}),this._bindClockEvents(),this.bpm=this._clock.frequency,this._clock.frequency.multiplier=t.ppq,this.bpm.setValueAtTime(t.bpm,0),gt(this,"bpm"),this._timeSignature=t.timeSignature,this._swingTicks=t.ppq/2}static getDefaults(){return Object.assign(le.getDefaults(),{bpm:120,loopEnd:"4m",loopStart:0,ppq:192,swing:0,swingSubdivision:"8n",timeSignature:4})}_processTick(t,e){if(this._loop.get(t)&&e>=this._loopEnd&&(this.emit("loopEnd",t),this._clock.setTicksAtTime(this._loopStart,t),e=this._loopStart,this.emit("loopStart",t,this._clock.getSecondsAtTime(t)),this.emit("loop",t)),this._swingAmount>0&&e%this._ppq!=0&&e%(2*this._swingTicks)!=0){const s=e%(2*this._swingTicks)/(2*this._swingTicks),i=Math.sin(s*Math.PI)*this._swingAmount;t+=new Ht(this.context,2*this._swingTicks/3).toSeconds()*i}ho(!0),this._timeline.forEachAtTime(e,s=>s.invoke(t)),ho(!1)}schedule(t,e){const s=new Ts(this,{callback:t,time:new oe(this.context,e).toTicks()});return this._addEvent(s,this._timeline)}scheduleRepeat(t,e,s,i=1/0){const o=new bo(this,{callback:t,duration:new Ne(this.context,i).toTicks(),interval:new Ne(this.context,e).toTicks(),time:new oe(this.context,s).toTicks()});return this._addEvent(o,this._repeatedEvents)}scheduleOnce(t,e){const s=new Ts(this,{callback:t,once:!0,time:new oe(this.context,e).toTicks()});return this._addEvent(s,this._timeline)}clear(t){if(this._scheduledEvents.hasOwnProperty(t)){const e=this._scheduledEvents[t.toString()];e.timeline.remove(e.event),e.event.dispose(),delete this._scheduledEvents[t.toString()]}return this}_addEvent(t,e){return this._scheduledEvents[t.id.toString()]={event:t,timeline:e},e.add(t),t.id}cancel(t=0){const e=this.toTicks(t);return this._timeline.forEachFrom(e,s=>this.clear(s.id)),this._repeatedEvents.forEachFrom(e,s=>this.clear(s.id)),this}_bindClockEvents(){this._clock.on("start",(t,e)=>{e=new Ht(this.context,e).toSeconds(),this.emit("start",t,e)}),this._clock.on("stop",t=>{this.emit("stop",t)}),this._clock.on("pause",t=>{this.emit("pause",t)})}get state(){return this._clock.getStateAtTime(this.now())}start(t,e){let s;return this.context.resume(),Tt(e)&&(s=this.toTicks(e)),this._clock.start(t,s),this}stop(t){return this._clock.stop(t),this}pause(t){return this._clock.pause(t),this}toggle(t){return t=this.toSeconds(t),this._clock.getStateAtTime(t)!=="started"?this.start(t):this.stop(t),this}get timeSignature(){return this._timeSignature}set timeSignature(t){fe(t)&&(t=t[0]/t[1]*4),this._timeSignature=t}get loopStart(){return new Ne(this.context,this._loopStart,"i").toSeconds()}set loopStart(t){this._loopStart=this.toTicks(t)}get loopEnd(){return new Ne(this.context,this._loopEnd,"i").toSeconds()}set loopEnd(t){this._loopEnd=this.toTicks(t)}get loop(){return this._loop.get(this.now())}set loop(t){this._loop.set(t,this.now())}setLoopPoints(t,e){return this.loopStart=t,this.loopEnd=e,this}get swing(){return this._swingAmount}set swing(t){this._swingAmount=t}get swingSubdivision(){return new Ht(this.context,this._swingTicks).toNotation()}set swingSubdivision(t){this._swingTicks=this.toTicks(t)}get position(){const t=this.now(),e=this._clock.getTicksAtTime(t);return new Ht(this.context,e).toBarsBeatsSixteenths()}set position(t){const e=this.toTicks(t);this.ticks=e}get seconds(){return this._clock.seconds}set seconds(t){const e=this.now(),s=this._clock.frequency.timeToTicks(t,e);this.ticks=s}get progress(){if(this.loop){const t=this.now();return(this._clock.getTicksAtTime(t)-this._loopStart)/(this._loopEnd-this._loopStart)}return 0}get ticks(){return this._clock.ticks}set ticks(t){if(this._clock.ticks!==t){const e=this.now();if(this.state==="started"){const s=this._clock.getTicksAtTime(e),i=e+this._clock.frequency.getDurationOfTicks(Math.ceil(s)-s,e);this.emit("stop",i),this._clock.setTicksAtTime(t,i),this.emit("start",i,this._clock.getSecondsAtTime(i))}else this.emit("ticks",e),this._clock.setTicksAtTime(t,e)}}getTicksAtTime(t){return this._clock.getTicksAtTime(t)}getSecondsAtTime(t){return this._clock.getSecondsAtTime(t)}get PPQ(){return this._clock.frequency.multiplier}set PPQ(t){this._clock.frequency.multiplier=t}nextSubdivision(t){if(t=this.toTicks(t),this.state!=="started")return 0;{const e=this.now(),s=t-this.getTicksAtTime(e)%t;return this._clock.nextTickTime(s,e)}}syncSignal(t,e){const s=this.now();let i=this.bpm,o=1/(60/i.getValueAtTime(s)/this.PPQ),r=[];if(t.units==="time"){const p=.015625/o,f=new ft(p),b=new hi(-1),T=new ft(p);i.chain(f,b,T),i=T,o=1/o,r=[f,b,T]}e||(e=t.getValueAtTime(s)!==0?t.getValueAtTime(s)/o:0);const u=new ft(e);return i.connect(u),u.connect(t._param),r.push(u),this._syncedSignals.push({initial:t.value,nodes:r,signal:t}),t.value=0,this}unsyncSignal(t){for(let e=this._syncedSignals.length-1;e>=0;e--){const s=this._syncedSignals[e];s.signal===t&&(s.nodes.forEach(i=>i.dispose()),s.signal.value=s.initial,this._syncedSignals.splice(e,1))}return this}dispose(){return super.dispose(),this._clock.dispose(),ki(this,"bpm"),this._timeline.dispose(),this._repeatedEvents.dispose(),this}}Js.mixin(wn),vn(n=>{n.transport=new wn({context:n})}),_n(n=>{n.transport.dispose()});class Kt extends tt{constructor(t){super(t),this.input=void 0,this._state=new ii("stopped"),this._synced=!1,this._scheduled=[],this._syncedStart=Ct,this._syncedStop=Ct,this._state.memory=100,this._state.increasing=!0,this._volume=this.output=new ls({context:this.context,mute:t.mute,volume:t.volume}),this.volume=this._volume.volume,gt(this,"volume"),this.onstop=t.onstop}static getDefaults(){return Object.assign(tt.getDefaults(),{mute:!1,onstop:Ct,volume:0})}get state(){return this._synced?this.context.transport.state==="started"?this._state.getValueAtTime(this.context.transport.seconds):"stopped":this._state.getValueAtTime(this.now())}get mute(){return this._volume.mute}set mute(t){this._volume.mute=t}_clampToCurrentTime(t){return this._synced?t:Math.max(t,this.context.currentTime)}start(t,e,s){let i=Se(t)&&this._synced?this.context.transport.seconds:this.toSeconds(t);if(i=this._clampToCurrentTime(i),this._synced||this._state.getValueAtTime(i)!=="started")if(this.log("start",i),this._state.setStateAtTime("started",i),this._synced){const o=this._state.get(i);o&&(o.offset=this.toSeconds(Ge(e,0)),o.duration=s?this.toSeconds(s):void 0);const r=this.context.transport.schedule(u=>{this._start(u,e,s)},i);this._scheduled.push(r),this.context.transport.state==="started"&&this.context.transport.getSecondsAtTime(this.immediate())>i&&this._syncedStart(this.now(),this.context.transport.seconds)}else ao(this.context),this._start(i,e,s);else mt(Qs(i,this._state.get(i).time),"Start time must be strictly greater than previous start time"),this._state.cancel(i),this._state.setStateAtTime("started",i),this.log("restart",i),this.restart(i,e,s);return this}stop(t){let e=Se(t)&&this._synced?this.context.transport.seconds:this.toSeconds(t);if(e=this._clampToCurrentTime(e),this._state.getValueAtTime(e)==="started"||Tt(this._state.getNextState("started",e))){if(this.log("stop",e),this._synced){const s=this.context.transport.schedule(this._stop.bind(this),e);this._scheduled.push(s)}else this._stop(e);this._state.cancel(e),this._state.setStateAtTime("stopped",e)}return this}restart(t,e,s){return t=this.toSeconds(t),this._state.getValueAtTime(t)==="started"&&(this._state.cancel(t),this._restart(t,e,s)),this}sync(){return this._synced||(this._synced=!0,this._syncedStart=(t,e)=>{if(Qs(e,0)){const s=this._state.get(e);if(s&&s.state==="started"&&s.time!==e){const i=e-this.toSeconds(s.time);let o;s.duration&&(o=this.toSeconds(s.duration)-i),this._start(t,this.toSeconds(s.offset)+i,o)}}},this._syncedStop=t=>{const e=this.context.transport.getSecondsAtTime(Math.max(t-this.sampleTime,0));this._state.getValueAtTime(e)==="started"&&this._stop(t)},this.context.transport.on("start",this._syncedStart),this.context.transport.on("loopStart",this._syncedStart),this.context.transport.on("stop",this._syncedStop),this.context.transport.on("pause",this._syncedStop),this.context.transport.on("loopEnd",this._syncedStop)),this}unsync(){return this._synced&&(this.context.transport.off("stop",this._syncedStop),this.context.transport.off("pause",this._syncedStop),this.context.transport.off("loopEnd",this._syncedStop),this.context.transport.off("start",this._syncedStart),this.context.transport.off("loopStart",this._syncedStart)),this._synced=!1,this._scheduled.forEach(t=>this.context.transport.clear(t)),this._scheduled=[],this._state.cancel(0),this._stop(0),this}dispose(){return super.dispose(),this.onstop=Ct,this.unsync(),this._volume.dispose(),this._state.dispose(),this}}class As extends ni{constructor(){const t=Z(As.getDefaults(),arguments,["url","onload"]);super(t),this.name="ToneBufferSource",this._source=this.context.createBufferSource(),this._internalChannels=[this._source],this._sourceStarted=!1,this._sourceStopped=!1,Te(this._source,this._gainNode),this._source.onended=()=>this._stopSource(),this.playbackRate=new xt({context:this.context,param:this._source.playbackRate,units:"positive",value:t.playbackRate}),this.loop=t.loop,this.loopStart=t.loopStart,this.loopEnd=t.loopEnd,this._buffer=new Mt(t.url,t.onload,t.onerror),this._internalChannels.push(this._source)}static getDefaults(){return Object.assign(ni.getDefaults(),{url:new Mt,loop:!1,loopEnd:0,loopStart:0,onload:Ct,onerror:Ct,playbackRate:1})}get fadeIn(){return this._fadeIn}set fadeIn(t){this._fadeIn=t}get fadeOut(){return this._fadeOut}set fadeOut(t){this._fadeOut=t}get curve(){return this._curve}set curve(t){this._curve=t}start(t,e,s,i=1){mt(this.buffer.loaded,"buffer is either not set or not loaded");const o=this.toSeconds(t);this._startGain(o,i),e=this.loop?Ge(e,this.loopStart):Ge(e,0);let r=Math.max(this.toSeconds(e),0);if(this.loop){const u=this.toSeconds(this.loopEnd)||this.buffer.duration,p=this.toSeconds(this.loopStart),f=u-p;uo(r,u)&&(r=(r-p)%f+p),Ke(r,this.buffer.duration)&&(r=0)}if(this._source.buffer=this.buffer.get(),this._source.loopEnd=this.toSeconds(this.loopEnd)||this.buffer.duration,gn(r,this.buffer.duration)&&(this._sourceStarted=!0,this._source.start(o,r)),Tt(s)){let u=this.toSeconds(s);u=Math.max(u,0),this.stop(o+u)}return this}_stopSource(t){!this._sourceStopped&&this._sourceStarted&&(this._sourceStopped=!0,this._source.stop(this.toSeconds(t)),this._onended())}get loopStart(){return this._source.loopStart}set loopStart(t){this._source.loopStart=this.toSeconds(t)}get loopEnd(){return this._source.loopEnd}set loopEnd(t){this._source.loopEnd=this.toSeconds(t)}get buffer(){return this._buffer}set buffer(t){this._buffer.set(t)}get loop(){return this._source.loop}set loop(t){this._source.loop=t,this._sourceStarted&&this.cancelStop()}dispose(){return super.dispose(),this._source.onended=null,this._source.disconnect(),this._buffer.dispose(),this.playbackRate.dispose(),this}}class ks extends Kt{constructor(){const t=Z(ks.getDefaults(),arguments,["type"]);super(t),this.name="Noise",this._source=null,this._playbackRate=t.playbackRate,this.type=t.type,this._fadeIn=t.fadeIn,this._fadeOut=t.fadeOut}static getDefaults(){return Object.assign(Kt.getDefaults(),{fadeIn:0,fadeOut:0,playbackRate:1,type:"white"})}get type(){return this._type}set type(t){if(mt(t in Ca,"Noise: invalid type: "+t),this._type!==t&&(this._type=t,this.state==="started")){const e=this.now();this._stop(e),this._start(e)}}get playbackRate(){return this._playbackRate}set playbackRate(t){this._playbackRate=t,this._source&&(this._source.playbackRate.value=t)}_start(t){const e=Ca[this._type];this._source=new As({url:e,context:this.context,fadeIn:this._fadeIn,fadeOut:this._fadeOut,loop:!0,onended:()=>this.onstop(this),playbackRate:this._playbackRate}).connect(this.output),this._source.start(this.toSeconds(t),Math.random()*(e.duration-.001))}_stop(t){this._source&&(this._source.stop(this.toSeconds(t)),this._source=null)}get fadeIn(){return this._fadeIn}set fadeIn(t){this._fadeIn=t,this._source&&(this._source.fadeIn=this._fadeIn)}get fadeOut(){return this._fadeOut}set fadeOut(t){this._fadeOut=t,this._source&&(this._source.fadeOut=this._fadeOut)}_restart(t){this._stop(t),this._start(t)}dispose(){return super.dispose(),this._source&&this._source.disconnect(),this}}const ci=220500,us={brown:null,pink:null,white:null},Ca={get brown(){if(!us.brown){const n=[];for(let t=0;t<2;t++){const e=new Float32Array(ci);n[t]=e;let s=0;for(let i=0;i<ci;i++){const o=2*Math.random()-1;e[i]=(s+.02*o)/1.02,s=e[i],e[i]*=3.5}}us.brown=new Mt().fromArray(n)}return us.brown},get pink(){if(!us.pink){const n=[];for(let t=0;t<2;t++){const e=new Float32Array(ci);let s,i,o,r,u,p,f;n[t]=e,s=i=o=r=u=p=f=0;for(let b=0;b<ci;b++){const T=2*Math.random()-1;s=.99886*s+.0555179*T,i=.99332*i+.0750759*T,o=.969*o+.153852*T,r=.8665*r+.3104856*T,u=.55*u+.5329522*T,p=-.7616*p-.016898*T,e[b]=s+i+o+r+u+p+f+.5362*T,e[b]*=.11,f=.115926*T}}us.pink=new Mt().fromArray(n)}return us.pink},get white(){if(!us.white){const n=[];for(let t=0;t<2;t++){const e=new Float32Array(ci);n[t]=e;for(let s=0;s<ci;s++)e[s]=2*Math.random()-1}us.white=new Mt().fromArray(n)}return us.white}};class Ei extends tt{constructor(){const t=Z(Ei.getDefaults(),arguments,["volume"]);super(t),this.name="UserMedia",this._volume=this.output=new ls({context:this.context,volume:t.volume}),this.volume=this._volume.volume,gt(this,"volume"),this.mute=t.mute}static getDefaults(){return Object.assign(tt.getDefaults(),{mute:!1,volume:0})}open(t){return Lt(this,void 0,void 0,function*(){mt(Ei.supported,"UserMedia is not supported"),this.state==="started"&&this.close();const e=yield Ei.enumerateDevices();Re(t)?this._device=e[t]:(this._device=e.find(o=>o.label===t||o.deviceId===t),!this._device&&e.length>0&&(this._device=e[0]),mt(Tt(this._device),`No matching device ${t}`));const s={audio:{echoCancellation:!1,sampleRate:this.context.sampleRate,noiseSuppression:!1,mozNoiseSuppression:!1}};this._device&&(s.audio.deviceId=this._device.deviceId);const i=yield navigator.mediaDevices.getUserMedia(s);if(!this._stream){this._stream=i;const o=this.context.createMediaStreamSource(i);Te(o,this.output),this._mediaStream=o}return this})}close(){return this._stream&&this._mediaStream&&(this._stream.getAudioTracks().forEach(t=>{t.stop()}),this._stream=void 0,this._mediaStream.disconnect(),this._mediaStream=void 0),this._device=void 0,this}static enumerateDevices(){return Lt(this,void 0,void 0,function*(){return(yield navigator.mediaDevices.enumerateDevices()).filter(t=>t.kind==="audioinput")})}get state(){return this._stream&&this._stream.active?"started":"stopped"}get deviceId(){return this._device?this._device.deviceId:void 0}get groupId(){return this._device?this._device.groupId:void 0}get label(){return this._device?this._device.label:void 0}get mute(){return this._volume.mute}set mute(t){this._volume.mute=t}dispose(){return super.dispose(),this.close(),this._volume.dispose(),this.volume.dispose(),this}static get supported(){return Tt(navigator.mediaDevices)&&Tt(navigator.mediaDevices.getUserMedia)}}function Fs(n,t){return Lt(this,void 0,void 0,function*(){const e=t/n.context.sampleRate,s=new ti(1,e,n.context.sampleRate);return new n.constructor(Object.assign(n.get(),{frequency:2/e,detune:0,context:s})).toDestination().start(0),(yield s.render()).getChannelData(0)})}class Mi extends ni{constructor(){const t=Z(Mi.getDefaults(),arguments,["frequency","type"]);super(t),this.name="ToneOscillatorNode",this._oscillator=this.context.createOscillator(),this._internalChannels=[this._oscillator],Te(this._oscillator,this._gainNode),this.type=t.type,this.frequency=new xt({context:this.context,param:this._oscillator.frequency,units:"frequency",value:t.frequency}),this.detune=new xt({context:this.context,param:this._oscillator.detune,units:"cents",value:t.detune}),gt(this,["frequency","detune"])}static getDefaults(){return Object.assign(ni.getDefaults(),{detune:0,frequency:440,type:"sine"})}start(t){const e=this.toSeconds(t);return this.log("start",e),this._startGain(e),this._oscillator.start(e),this}_stopSource(t){this._oscillator.stop(t)}setPeriodicWave(t){return this._oscillator.setPeriodicWave(t),this}get type(){return this._oscillator.type}set type(t){this._oscillator.type=t}dispose(){return super.dispose(),this.state==="started"&&this.stop(),this._oscillator.disconnect(),this.frequency.dispose(),this.detune.dispose(),this}}class Zt extends Kt{constructor(){const t=Z(Zt.getDefaults(),arguments,["frequency","type"]);super(t),this.name="Oscillator",this._oscillator=null,this.frequency=new _t({context:this.context,units:"frequency",value:t.frequency}),gt(this,"frequency"),this.detune=new _t({context:this.context,units:"cents",value:t.detune}),gt(this,"detune"),this._partials=t.partials,this._partialCount=t.partialCount,this._type=t.type,t.partialCount&&t.type!=="custom"&&(this._type=this.baseType+t.partialCount.toString()),this.phase=t.phase}static getDefaults(){return Object.assign(Kt.getDefaults(),{detune:0,frequency:440,partialCount:0,partials:[],phase:0,type:"sine"})}_start(t){const e=this.toSeconds(t),s=new Mi({context:this.context,onended:()=>this.onstop(this)});this._oscillator=s,this._wave?this._oscillator.setPeriodicWave(this._wave):this._oscillator.type=this._type,this._oscillator.connect(this.output),this.frequency.connect(this._oscillator.frequency),this.detune.connect(this._oscillator.detune),this._oscillator.start(e)}_stop(t){const e=this.toSeconds(t);this._oscillator&&this._oscillator.stop(e)}_restart(t){const e=this.toSeconds(t);return this.log("restart",e),this._oscillator&&this._oscillator.cancelStop(),this._state.cancel(e),this}syncFrequency(){return this.context.transport.syncSignal(this.frequency),this}unsyncFrequency(){return this.context.transport.unsyncSignal(this.frequency),this}_getCachedPeriodicWave(){if(this._type==="custom")return Zt._periodicWaveCache.find(t=>{return t.phase===this._phase&&(e=t.partials,s=this._partials,e.length===s.length&&e.every((i,o)=>s[o]===i));var e,s});{const t=Zt._periodicWaveCache.find(e=>e.type===this._type&&e.phase===this._phase);return this._partialCount=t?t.partialCount:this._partialCount,t}}get type(){return this._type}set type(t){this._type=t;const e=["sine","square","sawtooth","triangle"].indexOf(t)!==-1;if(this._phase===0&&e)this._wave=void 0,this._partialCount=0,this._oscillator!==null&&(this._oscillator.type=t);else{const s=this._getCachedPeriodicWave();if(Tt(s)){const{partials:i,wave:o}=s;this._wave=o,this._partials=i,this._oscillator!==null&&this._oscillator.setPeriodicWave(this._wave)}else{const[i,o]=this._getRealImaginary(t,this._phase),r=this.context.createPeriodicWave(i,o);this._wave=r,this._oscillator!==null&&this._oscillator.setPeriodicWave(this._wave),Zt._periodicWaveCache.push({imag:o,partialCount:this._partialCount,partials:this._partials,phase:this._phase,real:i,type:this._type,wave:this._wave}),Zt._periodicWaveCache.length>100&&Zt._periodicWaveCache.shift()}}}get baseType(){return this._type.replace(this.partialCount.toString(),"")}set baseType(t){this.partialCount&&this._type!=="custom"&&t!=="custom"?this.type=t+this.partialCount:this.type=t}get partialCount(){return this._partialCount}set partialCount(t){me(t,0);let e=this._type;const s=/^(sine|triangle|square|sawtooth)(\d+)$/.exec(this._type);if(s&&(e=s[1]),this._type!=="custom")this.type=t===0?e:e+t.toString();else{const i=new Float32Array(t);this._partials.forEach((o,r)=>i[r]=o),this._partials=Array.from(i),this.type=this._type}}_getRealImaginary(t,e){let s=2048;const i=new Float32Array(s),o=new Float32Array(s);let r=1;if(t==="custom"){if(r=this._partials.length+1,this._partialCount=this._partials.length,s=r,this._partials.length===0)return[i,o]}else{const u=/^(sine|triangle|square|sawtooth)(\d+)$/.exec(t);u?(r=parseInt(u[2],10)+1,this._partialCount=parseInt(u[2],10),t=u[1],r=Math.max(r,2),s=r):this._partialCount=0,this._partials=[]}for(let u=1;u<s;++u){const p=2/(u*Math.PI);let f;switch(t){case"sine":f=u<=r?1:0,this._partials[u-1]=f;break;case"square":f=1&u?2*p:0,this._partials[u-1]=f;break;case"sawtooth":f=p*(1&u?1:-1),this._partials[u-1]=f;break;case"triangle":f=1&u?p*p*2*(u-1>>1&1?-1:1):0,this._partials[u-1]=f;break;case"custom":f=this._partials[u-1];break;default:throw new TypeError("Oscillator: invalid type: "+t)}f!==0?(i[u]=-f*Math.sin(e*u),o[u]=f*Math.cos(e*u)):(i[u]=0,o[u]=0)}return[i,o]}_inverseFFT(t,e,s){let i=0;const o=t.length;for(let r=0;r<o;r++)i+=t[r]*Math.cos(r*s)+e[r]*Math.sin(r*s);return i}getInitialValue(){const[t,e]=this._getRealImaginary(this._type,0);let s=0;const i=2*Math.PI;for(let o=0;o<32;o++)s=Math.max(this._inverseFFT(t,e,o/32*i),s);return Ns(-this._inverseFFT(t,e,this._phase)/s,-1,1)}get partials(){return this._partials.slice(0,this.partialCount)}set partials(t){this._partials=t,this._partialCount=this._partials.length,t.length&&(this.type="custom")}get phase(){return this._phase*(180/Math.PI)}set phase(t){this._phase=t*Math.PI/180,this.type=this._type}asArray(){return Lt(this,arguments,void 0,function*(t=1024){return Fs(this,t)})}dispose(){return super.dispose(),this._oscillator!==null&&this._oscillator.dispose(),this._wave=void 0,this.frequency.dispose(),this.detune.dispose(),this}}Zt._periodicWaveCache=[];class Tn extends Ve{constructor(){super(...arguments),this.name="AudioToGain",this._norm=new ts({context:this.context,mapping:t=>(t+1)/2}),this.input=this._norm,this.output=this._norm}dispose(){return super.dispose(),this._norm.dispose(),this}}class $t extends _t{constructor(){const t=Z($t.getDefaults(),arguments,["value"]);super(t),this.name="Multiply",this.override=!1,this._mult=this.input=this.output=new ft({context:this.context,minValue:t.minValue,maxValue:t.maxValue}),this.factor=this._param=this._mult.gain,this.factor.setValueAtTime(t.value,0)}static getDefaults(){return Object.assign(_t.getDefaults(),{value:0})}dispose(){return super.dispose(),this._mult.dispose(),this}}class Di extends Kt{constructor(){const t=Z(Di.getDefaults(),arguments,["frequency","type","modulationType"]);super(t),this.name="AMOscillator",this._modulationScale=new Tn({context:this.context}),this._modulationNode=new ft({context:this.context}),this._carrier=new Zt({context:this.context,detune:t.detune,frequency:t.frequency,onstop:()=>this.onstop(this),phase:t.phase,type:t.type}),this.frequency=this._carrier.frequency,this.detune=this._carrier.detune,this._modulator=new Zt({context:this.context,phase:t.phase,type:t.modulationType}),this.harmonicity=new $t({context:this.context,units:"positive",value:t.harmonicity}),this.frequency.chain(this.harmonicity,this._modulator.frequency),this._modulator.chain(this._modulationScale,this._modulationNode.gain),this._carrier.chain(this._modulationNode,this.output),gt(this,["frequency","detune","harmonicity"])}static getDefaults(){return Object.assign(Zt.getDefaults(),{harmonicity:1,modulationType:"square"})}_start(t){this._modulator.start(t),this._carrier.start(t)}_stop(t){this._modulator.stop(t),this._carrier.stop(t)}_restart(t){this._modulator.restart(t),this._carrier.restart(t)}get type(){return this._carrier.type}set type(t){this._carrier.type=t}get baseType(){return this._carrier.baseType}set baseType(t){this._carrier.baseType=t}get partialCount(){return this._carrier.partialCount}set partialCount(t){this._carrier.partialCount=t}get modulationType(){return this._modulator.type}set modulationType(t){this._modulator.type=t}get phase(){return this._carrier.phase}set phase(t){this._carrier.phase=t,this._modulator.phase=t}get partials(){return this._carrier.partials}set partials(t){this._carrier.partials=t}asArray(){return Lt(this,arguments,void 0,function*(t=1024){return Fs(this,t)})}dispose(){return super.dispose(),this.frequency.dispose(),this.detune.dispose(),this.harmonicity.dispose(),this._carrier.dispose(),this._modulator.dispose(),this._modulationNode.dispose(),this._modulationScale.dispose(),this}}class li extends Kt{constructor(){const t=Z(li.getDefaults(),arguments,["frequency","type","modulationType"]);super(t),this.name="FMOscillator",this._modulationNode=new ft({context:this.context,gain:0}),this._carrier=new Zt({context:this.context,detune:t.detune,frequency:0,onstop:()=>this.onstop(this),phase:t.phase,type:t.type}),this.detune=this._carrier.detune,this.frequency=new _t({context:this.context,units:"frequency",value:t.frequency}),this._modulator=new Zt({context:this.context,phase:t.phase,type:t.modulationType}),this.harmonicity=new $t({context:this.context,units:"positive",value:t.harmonicity}),this.modulationIndex=new $t({context:this.context,units:"positive",value:t.modulationIndex}),this.frequency.connect(this._carrier.frequency),this.frequency.chain(this.harmonicity,this._modulator.frequency),this.frequency.chain(this.modulationIndex,this._modulationNode),this._modulator.connect(this._modulationNode.gain),this._modulationNode.connect(this._carrier.frequency),this._carrier.connect(this.output),this.detune.connect(this._modulator.detune),gt(this,["modulationIndex","frequency","detune","harmonicity"])}static getDefaults(){return Object.assign(Zt.getDefaults(),{harmonicity:1,modulationIndex:2,modulationType:"square"})}_start(t){this._modulator.start(t),this._carrier.start(t)}_stop(t){this._modulator.stop(t),this._carrier.stop(t)}_restart(t){return this._modulator.restart(t),this._carrier.restart(t),this}get type(){return this._carrier.type}set type(t){this._carrier.type=t}get baseType(){return this._carrier.baseType}set baseType(t){this._carrier.baseType=t}get partialCount(){return this._carrier.partialCount}set partialCount(t){this._carrier.partialCount=t}get modulationType(){return this._modulator.type}set modulationType(t){this._modulator.type=t}get phase(){return this._carrier.phase}set phase(t){this._carrier.phase=t,this._modulator.phase=t}get partials(){return this._carrier.partials}set partials(t){this._carrier.partials=t}asArray(){return Lt(this,arguments,void 0,function*(t=1024){return Fs(this,t)})}dispose(){return super.dispose(),this.frequency.dispose(),this.harmonicity.dispose(),this._carrier.dispose(),this._modulator.dispose(),this._modulationNode.dispose(),this.modulationIndex.dispose(),this}}class ui extends Kt{constructor(){const t=Z(ui.getDefaults(),arguments,["frequency","width"]);super(t),this.name="PulseOscillator",this._widthGate=new ft({context:this.context,gain:0}),this._thresh=new ts({context:this.context,mapping:e=>e<=0?-1:1}),this.width=new _t({context:this.context,units:"audioRange",value:t.width}),this._triangle=new Zt({context:this.context,detune:t.detune,frequency:t.frequency,onstop:()=>this.onstop(this),phase:t.phase,type:"triangle"}),this.frequency=this._triangle.frequency,this.detune=this._triangle.detune,this._triangle.chain(this._thresh,this.output),this.width.chain(this._widthGate,this._thresh),gt(this,["width","frequency","detune"])}static getDefaults(){return Object.assign(Kt.getDefaults(),{detune:0,frequency:440,phase:0,type:"pulse",width:.2})}_start(t){t=this.toSeconds(t),this._triangle.start(t),this._widthGate.gain.setValueAtTime(1,t)}_stop(t){t=this.toSeconds(t),this._triangle.stop(t),this._widthGate.gain.cancelScheduledValues(t),this._widthGate.gain.setValueAtTime(0,t)}_restart(t){this._triangle.restart(t),this._widthGate.gain.cancelScheduledValues(t),this._widthGate.gain.setValueAtTime(1,t)}get phase(){return this._triangle.phase}set phase(t){this._triangle.phase=t}get type(){return"pulse"}get baseType(){return"pulse"}get partials(){return[]}get partialCount(){return 0}set carrierType(t){this._triangle.type=t}asArray(){return Lt(this,arguments,void 0,function*(t=1024){return Fs(this,t)})}dispose(){return super.dispose(),this._triangle.dispose(),this.width.dispose(),this._widthGate.dispose(),this._thresh.dispose(),this}}class Ii extends Kt{constructor(){const t=Z(Ii.getDefaults(),arguments,["frequency","type","spread"]);super(t),this.name="FatOscillator",this._oscillators=[],this.frequency=new _t({context:this.context,units:"frequency",value:t.frequency}),this.detune=new _t({context:this.context,units:"cents",value:t.detune}),this._spread=t.spread,this._type=t.type,this._phase=t.phase,this._partials=t.partials,this._partialCount=t.partialCount,this.count=t.count,gt(this,["frequency","detune"])}static getDefaults(){return Object.assign(Zt.getDefaults(),{count:3,spread:20,type:"sawtooth"})}_start(t){t=this.toSeconds(t),this._forEach(e=>e.start(t))}_stop(t){t=this.toSeconds(t),this._forEach(e=>e.stop(t))}_restart(t){this._forEach(e=>e.restart(t))}_forEach(t){for(let e=0;e<this._oscillators.length;e++)t(this._oscillators[e],e)}get type(){return this._type}set type(t){this._type=t,this._forEach(e=>e.type=t)}get spread(){return this._spread}set spread(t){if(this._spread=t,this._oscillators.length>1){const e=-t/2,s=t/(this._oscillators.length-1);this._forEach((i,o)=>i.detune.value=e+s*o)}}get count(){return this._oscillators.length}set count(t){if(me(t,1),this._oscillators.length!==t){this._forEach(e=>e.dispose()),this._oscillators=[];for(let e=0;e<t;e++){const s=new Zt({context:this.context,volume:-6-1.1*t,type:this._type,phase:this._phase+e/t*360,partialCount:this._partialCount,onstop:e===0?()=>this.onstop(this):Ct});this.type==="custom"&&(s.partials=this._partials),this.frequency.connect(s.frequency),this.detune.connect(s.detune),s.detune.overridden=!1,s.connect(this.output),this._oscillators[e]=s}this.spread=this._spread,this.state==="started"&&this._forEach(e=>e.start())}}get phase(){return this._phase}set phase(t){this._phase=t,this._forEach((e,s)=>e.phase=this._phase+s/this.count*360)}get baseType(){return this._oscillators[0].baseType}set baseType(t){this._forEach(e=>e.baseType=t),this._type=this._oscillators[0].type}get partials(){return this._oscillators[0].partials}set partials(t){this._partials=t,this._partialCount=this._partials.length,t.length&&(this._type="custom",this._forEach(e=>e.partials=t))}get partialCount(){return this._oscillators[0].partialCount}set partialCount(t){this._partialCount=t,this._forEach(e=>e.partialCount=t),this._type=this._oscillators[0].type}asArray(){return Lt(this,arguments,void 0,function*(t=1024){return Fs(this,t)})}dispose(){return super.dispose(),this.frequency.dispose(),this.detune.dispose(),this._forEach(t=>t.dispose()),this}}class Ri extends Kt{constructor(){const t=Z(Ri.getDefaults(),arguments,["frequency","modulationFrequency"]);super(t),this.name="PWMOscillator",this.sourceType="pwm",this._scale=new $t({context:this.context,value:2}),this._pulse=new ui({context:this.context,frequency:t.modulationFrequency}),this._pulse.carrierType="sine",this.modulationFrequency=this._pulse.frequency,this._modulator=new Zt({context:this.context,detune:t.detune,frequency:t.frequency,onstop:()=>this.onstop(this),phase:t.phase}),this.frequency=this._modulator.frequency,this.detune=this._modulator.detune,this._modulator.chain(this._scale,this._pulse.width),this._pulse.connect(this.output),gt(this,["modulationFrequency","frequency","detune"])}static getDefaults(){return Object.assign(Kt.getDefaults(),{detune:0,frequency:440,modulationFrequency:.4,phase:0,type:"pwm"})}_start(t){t=this.toSeconds(t),this._modulator.start(t),this._pulse.start(t)}_stop(t){t=this.toSeconds(t),this._modulator.stop(t),this._pulse.stop(t)}_restart(t){this._modulator.restart(t),this._pulse.restart(t)}get type(){return"pwm"}get baseType(){return"pwm"}get partials(){return[]}get partialCount(){return 0}get phase(){return this._modulator.phase}set phase(t){this._modulator.phase=t}asArray(){return Lt(this,arguments,void 0,function*(t=1024){return Fs(this,t)})}dispose(){return super.dispose(),this._pulse.dispose(),this._scale.dispose(),this._modulator.dispose(),this}}const Oa={am:Di,fat:Ii,fm:li,oscillator:Zt,pulse:ui,pwm:Ri};class ds extends Kt{constructor(){const t=Z(ds.getDefaults(),arguments,["frequency","type"]);super(t),this.name="OmniOscillator",this.frequency=new _t({context:this.context,units:"frequency",value:t.frequency}),this.detune=new _t({context:this.context,units:"cents",value:t.detune}),gt(this,["frequency","detune"]),this.set(t)}static getDefaults(){return Object.assign(Zt.getDefaults(),li.getDefaults(),Di.getDefaults(),Ii.getDefaults(),ui.getDefaults(),Ri.getDefaults())}_start(t){this._oscillator.start(t)}_stop(t){this._oscillator.stop(t)}_restart(t){return this._oscillator.restart(t),this}get type(){let t="";return["am","fm","fat"].some(e=>this._sourceType===e)&&(t=this._sourceType),t+this._oscillator.type}set type(t){t.substr(0,2)==="fm"?(this._createNewOscillator("fm"),this._oscillator=this._oscillator,this._oscillator.type=t.substr(2)):t.substr(0,2)==="am"?(this._createNewOscillator("am"),this._oscillator=this._oscillator,this._oscillator.type=t.substr(2)):t.substr(0,3)==="fat"?(this._createNewOscillator("fat"),this._oscillator=this._oscillator,this._oscillator.type=t.substr(3)):t==="pwm"?(this._createNewOscillator("pwm"),this._oscillator=this._oscillator):t==="pulse"?this._createNewOscillator("pulse"):(this._createNewOscillator("oscillator"),this._oscillator=this._oscillator,this._oscillator.type=t)}get partials(){return this._oscillator.partials}set partials(t){this._getOscType(this._oscillator,"pulse")||this._getOscType(this._oscillator,"pwm")||(this._oscillator.partials=t)}get partialCount(){return this._oscillator.partialCount}set partialCount(t){this._getOscType(this._oscillator,"pulse")||this._getOscType(this._oscillator,"pwm")||(this._oscillator.partialCount=t)}set(t){return Reflect.has(t,"type")&&t.type&&(this.type=t.type),super.set(t),this}_createNewOscillator(t){if(t!==this._sourceType){this._sourceType=t;const e=Oa[t],s=this.now();if(this._oscillator){const i=this._oscillator;i.stop(s),this.context.setTimeout(()=>i.dispose(),this.blockTime)}this._oscillator=new e({context:this.context}),this.frequency.connect(this._oscillator.frequency),this.detune.connect(this._oscillator.detune),this._oscillator.connect(this.output),this._oscillator.onstop=()=>this.onstop(this),this.state==="started"&&this._oscillator.start(s)}}get phase(){return this._oscillator.phase}set phase(t){this._oscillator.phase=t}get sourceType(){return this._sourceType}set sourceType(t){let e="sine";this._oscillator.type!=="pwm"&&this._oscillator.type!=="pulse"&&(e=this._oscillator.type),t==="fm"?this.type="fm"+e:t==="am"?this.type="am"+e:t==="fat"?this.type="fat"+e:t==="oscillator"?this.type=e:t==="pulse"?this.type="pulse":t==="pwm"&&(this.type="pwm")}_getOscType(t,e){return t instanceof Oa[e]}get baseType(){return this._oscillator.baseType}set baseType(t){this._getOscType(this._oscillator,"pulse")||this._getOscType(this._oscillator,"pwm")||t==="pulse"||t==="pwm"||(this._oscillator.baseType=t)}get width(){return this._getOscType(this._oscillator,"pulse")?this._oscillator.width:void 0}get count(){return this._getOscType(this._oscillator,"fat")?this._oscillator.count:void 0}set count(t){this._getOscType(this._oscillator,"fat")&&Re(t)&&(this._oscillator.count=t)}get spread(){return this._getOscType(this._oscillator,"fat")?this._oscillator.spread:void 0}set spread(t){this._getOscType(this._oscillator,"fat")&&Re(t)&&(this._oscillator.spread=t)}get modulationType(){return this._getOscType(this._oscillator,"fm")||this._getOscType(this._oscillator,"am")?this._oscillator.modulationType:void 0}set modulationType(t){(this._getOscType(this._oscillator,"fm")||this._getOscType(this._oscillator,"am"))&&Qe(t)&&(this._oscillator.modulationType=t)}get modulationIndex(){return this._getOscType(this._oscillator,"fm")?this._oscillator.modulationIndex:void 0}get harmonicity(){return this._getOscType(this._oscillator,"fm")||this._getOscType(this._oscillator,"am")?this._oscillator.harmonicity:void 0}get modulationFrequency(){return this._getOscType(this._oscillator,"pwm")?this._oscillator.modulationFrequency:void 0}asArray(){return Lt(this,arguments,void 0,function*(t=1024){return Fs(this,t)})}dispose(){return super.dispose(),this.detune.dispose(),this.frequency.dispose(),this._oscillator.dispose(),this}}class Ls extends _t{constructor(){super(Z(Ls.getDefaults(),arguments,["value"])),this.override=!1,this.name="Add",this._sum=new ft({context:this.context}),this.input=this._sum,this.output=this._sum,this.addend=this._param,Fe(this._constantSource,this._sum)}static getDefaults(){return Object.assign(_t.getDefaults(),{value:0})}dispose(){return super.dispose(),this._sum.dispose(),this}}class ps extends Ve{constructor(){const t=Z(ps.getDefaults(),arguments,["min","max"]);super(t),this.name="Scale",this._mult=this.input=new $t({context:this.context,value:t.max-t.min}),this._add=this.output=new Ls({context:this.context,value:t.min}),this._min=t.min,this._max=t.max,this.input.connect(this.output)}static getDefaults(){return Object.assign(Ve.getDefaults(),{max:1,min:0})}get min(){return this._min}set min(t){this._min=t,this._setRange()}get max(){return this._max}set max(t){this._max=t,this._setRange()}_setRange(){this._add.value=this._min,this._mult.value=this._max-this._min}dispose(){return super.dispose(),this._add.dispose(),this._mult.dispose(),this}}class An extends Ve{constructor(){super(Z(An.getDefaults(),arguments)),this.name="Zero",this._gain=new ft({context:this.context}),this.output=this._gain,this.input=void 0,Te(this.context.getConstant(0),this._gain)}dispose(){return super.dispose(),go(this.context.getConstant(0),this._gain),this}}class Ae extends tt{constructor(){const t=Z(Ae.getDefaults(),arguments,["frequency","min","max"]);super(t),this.name="LFO",this._stoppedValue=0,this._units="number",this.convert=!0,this._fromType=xt.prototype._fromType,this._toType=xt.prototype._toType,this._is=xt.prototype._is,this._clampValue=xt.prototype._clampValue,this._oscillator=new Zt(t),this.frequency=this._oscillator.frequency,this._amplitudeGain=new ft({context:this.context,gain:t.amplitude,units:"normalRange"}),this.amplitude=this._amplitudeGain.gain,this._stoppedSignal=new _t({context:this.context,units:"audioRange",value:0}),this._zeros=new An({context:this.context}),this._a2g=new Tn({context:this.context}),this._scaler=this.output=new ps({context:this.context,max:t.max,min:t.min}),this.units=t.units,this.min=t.min,this.max=t.max,this._oscillator.chain(this._amplitudeGain,this._a2g,this._scaler),this._zeros.connect(this._a2g),this._stoppedSignal.connect(this._a2g),gt(this,["amplitude","frequency"]),this.phase=t.phase}static getDefaults(){return Object.assign(Zt.getDefaults(),{amplitude:1,frequency:"4n",max:1,min:0,type:"sine",units:"number"})}start(t){return t=this.toSeconds(t),this._stoppedSignal.setValueAtTime(0,t),this._oscillator.start(t),this}stop(t){return t=this.toSeconds(t),this._stoppedSignal.setValueAtTime(this._stoppedValue,t),this._oscillator.stop(t),this}sync(){return this._oscillator.sync(),this._oscillator.syncFrequency(),this}unsync(){return this._oscillator.unsync(),this._oscillator.unsyncFrequency(),this}_setStoppedValue(){this._stoppedValue=this._oscillator.getInitialValue(),this._stoppedSignal.value=this._stoppedValue}get min(){return this._toType(this._scaler.min)}set min(t){t=this._fromType(t),this._scaler.min=t}get max(){return this._toType(this._scaler.max)}set max(t){t=this._fromType(t),this._scaler.max=t}get type(){return this._oscillator.type}set type(t){this._oscillator.type=t,this._setStoppedValue()}get partials(){return this._oscillator.partials}set partials(t){this._oscillator.partials=t,this._setStoppedValue()}get phase(){return this._oscillator.phase}set phase(t){this._oscillator.phase=t,this._setStoppedValue()}get units(){return this._units}set units(t){const e=this.min,s=this.max;this._units=t,this.min=e,this.max=s}get state(){return this._oscillator.state}connect(t,e,s){return(t instanceof xt||t instanceof _t)&&(this.convert=t.convert,this.units=t.units),Oi(this,t,e,s),this}dispose(){return super.dispose(),this._oscillator.dispose(),this._stoppedSignal.dispose(),this._zeros.dispose(),this._scaler.dispose(),this._a2g.dispose(),this._amplitudeGain.dispose(),this.amplitude.dispose(),this}}function Ea(n,t=1/0){const e=new WeakMap;return function(s,i){Reflect.defineProperty(s,i,{configurable:!0,enumerable:!0,get:function(){return e.get(this)},set:function(o){me(o,n,t),e.set(this,o)}})}}function fs(n,t=1/0){const e=new WeakMap;return function(s,i){Reflect.defineProperty(s,i,{configurable:!0,enumerable:!0,get:function(){return e.get(this)},set:function(o){me(this.toSeconds(o),n,t),e.set(this,o)}})}}class di extends Kt{constructor(){const t=Z(di.getDefaults(),arguments,["url","onload"]);super(t),this.name="Player",this._activeSources=new Set,this._buffer=new Mt({onload:this._onload.bind(this,t.onload),onerror:t.onerror,reverse:t.reverse,url:t.url}),this.autostart=t.autostart,this._loop=t.loop,this._loopStart=t.loopStart,this._loopEnd=t.loopEnd,this._playbackRate=t.playbackRate,this.fadeIn=t.fadeIn,this.fadeOut=t.fadeOut}static getDefaults(){return Object.assign(Kt.getDefaults(),{autostart:!1,fadeIn:0,fadeOut:0,loop:!1,loopEnd:0,loopStart:0,onload:Ct,onerror:Ct,playbackRate:1,reverse:!1})}load(t){return Lt(this,void 0,void 0,function*(){return yield this._buffer.load(t),this._onload(),this})}_onload(t=Ct){t(),this.autostart&&this.start()}_onSourceEnd(t){this.onstop(this),this._activeSources.delete(t),this._activeSources.size!==0||this._synced||this._state.getValueAtTime(this.now())!=="started"||(this._state.cancel(this.now()),this._state.setStateAtTime("stopped",this.now()))}start(t,e,s){return super.start(t,e,s),this}_start(t,e,s){e=this._loop?Ge(e,this._loopStart):Ge(e,0);const i=this.toSeconds(e),o=s;s=Ge(s,Math.max(this._buffer.duration-i,0));let r=this.toSeconds(s);r/=this._playbackRate,t=this.toSeconds(t);const u=new As({url:this._buffer,context:this.context,fadeIn:this.fadeIn,fadeOut:this.fadeOut,loop:this._loop,loopEnd:this._loopEnd,loopStart:this._loopStart,onended:this._onSourceEnd.bind(this),playbackRate:this._playbackRate}).connect(this.output);this._loop||this._synced||(this._state.cancel(t+r),this._state.setStateAtTime("stopped",t+r,{implicitEnd:!0})),this._activeSources.add(u),this._loop&&Se(o)?u.start(t,i):u.start(t,i,r-this.toSeconds(this.fadeOut))}_stop(t){const e=this.toSeconds(t);this._activeSources.forEach(s=>s.stop(e))}restart(t,e,s){return super.restart(t,e,s),this}_restart(t,e,s){var i;(i=[...this._activeSources].pop())===null||i===void 0||i.stop(t),this._start(t,e,s)}seek(t,e){const s=this.toSeconds(e);if(this._state.getValueAtTime(s)==="started"){const i=this.toSeconds(t);this._stop(s),this._start(s,i)}return this}setLoopPoints(t,e){return this.loopStart=t,this.loopEnd=e,this}get loopStart(){return this._loopStart}set loopStart(t){this._loopStart=t,this.buffer.loaded&&me(this.toSeconds(t),0,this.buffer.duration),this._activeSources.forEach(e=>{e.loopStart=t})}get loopEnd(){return this._loopEnd}set loopEnd(t){this._loopEnd=t,this.buffer.loaded&&me(this.toSeconds(t),0,this.buffer.duration),this._activeSources.forEach(e=>{e.loopEnd=t})}get buffer(){return this._buffer}set buffer(t){this._buffer.set(t)}get loop(){return this._loop}set loop(t){if(this._loop!==t&&(this._loop=t,this._activeSources.forEach(e=>{e.loop=t}),t)){const e=this._state.getNextState("stopped",this.now());e&&this._state.cancel(e.time)}}get playbackRate(){return this._playbackRate}set playbackRate(t){this._playbackRate=t;const e=this.now(),s=this._state.getNextState("stopped",e);s&&s.implicitEnd&&(this._state.cancel(s.time),this._activeSources.forEach(i=>i.cancelStop())),this._activeSources.forEach(i=>{i.playbackRate.setValueAtTime(t,e)})}get reverse(){return this._buffer.reverse}set reverse(t){this._buffer.reverse=t}get loaded(){return this._buffer.loaded}dispose(){return super.dispose(),this._activeSources.forEach(t=>t.dispose()),this._activeSources.clear(),this._buffer.dispose(),this}}Je([fs(0)],di.prototype,"fadeIn",void 0),Je([fs(0)],di.prototype,"fadeOut",void 0);class wo extends tt{constructor(){const t=Z(wo.getDefaults(),arguments,["urls","onload"],"urls");super(t),this.name="Players",this.input=void 0,this._players=new Map,this._volume=this.output=new ls({context:this.context,volume:t.volume}),this.volume=this._volume.volume,gt(this,"volume"),this._buffers=new ri({urls:t.urls,onload:t.onload,baseUrl:t.baseUrl,onerror:t.onerror}),this.mute=t.mute,this._fadeIn=t.fadeIn,this._fadeOut=t.fadeOut}static getDefaults(){return Object.assign(Kt.getDefaults(),{baseUrl:"",fadeIn:0,fadeOut:0,mute:!1,onload:Ct,onerror:Ct,urls:{},volume:0})}get mute(){return this._volume.mute}set mute(t){this._volume.mute=t}get fadeIn(){return this._fadeIn}set fadeIn(t){this._fadeIn=t,this._players.forEach(e=>{e.fadeIn=t})}get fadeOut(){return this._fadeOut}set fadeOut(t){this._fadeOut=t,this._players.forEach(e=>{e.fadeOut=t})}get state(){return Array.from(this._players).some(([t,e])=>e.state==="started")?"started":"stopped"}has(t){return this._buffers.has(t)}player(t){if(mt(this.has(t),`No Player with the name ${t} exists on this object`),!this._players.has(t)){const e=new di({context:this.context,fadeIn:this._fadeIn,fadeOut:this._fadeOut,url:this._buffers.get(t)}).connect(this.output);this._players.set(t,e)}return this._players.get(t)}get loaded(){return this._buffers.loaded}add(t,e,s){return mt(!this._buffers.has(t),"A buffer with that name already exists on this object"),this._buffers.add(t,e,s),this}stopAll(t){return this._players.forEach(e=>e.stop(t)),this}dispose(){return super.dispose(),this._volume.dispose(),this.volume.dispose(),this._players.forEach(t=>t.dispose()),this._buffers.dispose(),this}}class To extends Kt{constructor(){const t=Z(To.getDefaults(),arguments,["url","onload"]);super(t),this.name="GrainPlayer",this._loopStart=0,this._loopEnd=0,this._activeSources=[],this.buffer=new Mt({onload:t.onload,onerror:t.onerror,reverse:t.reverse,url:t.url}),this._clock=new oi({context:this.context,callback:this._tick.bind(this),frequency:1/t.grainSize}),this._playbackRate=t.playbackRate,this._grainSize=t.grainSize,this._overlap=t.overlap,this.detune=t.detune,this.overlap=t.overlap,this.loop=t.loop,this.playbackRate=t.playbackRate,this.grainSize=t.grainSize,this.loopStart=t.loopStart,this.loopEnd=t.loopEnd,this.reverse=t.reverse,this._clock.on("stop",this._onstop.bind(this))}static getDefaults(){return Object.assign(Kt.getDefaults(),{onload:Ct,onerror:Ct,overlap:.1,grainSize:.2,playbackRate:1,detune:0,loop:!1,loopStart:0,loopEnd:0,reverse:!1})}_start(t,e,s){e=Ge(e,0),e=this.toSeconds(e),t=this.toSeconds(t);const i=1/this._clock.frequency.getValueAtTime(t);this._clock.start(t,e/i),s&&this.stop(t+this.toSeconds(s))}restart(t,e,s){return super.restart(t,e,s),this}_restart(t,e,s){this._stop(t),this._start(t,e,s)}_stop(t){this._clock.stop(t)}_onstop(t){this._activeSources.forEach(e=>{e.fadeOut=0,e.stop(t)}),this.onstop(this)}_tick(t){const e=this._clock.getTicksAtTime(t),s=e*this._grainSize;if(this.log("offset",s),!this.loop&&s>this.buffer.duration)return void this.stop(t);const i=s<this._overlap?0:this._overlap,o=new As({context:this.context,url:this.buffer,fadeIn:i,fadeOut:this._overlap,loop:this.loop,loopStart:this._loopStart,loopEnd:this._loopEnd,playbackRate:si(this.detune/100)}).connect(this.output);o.start(t,this._grainSize*e),o.stop(t+this._grainSize/this.playbackRate),this._activeSources.push(o),o.onended=()=>{const r=this._activeSources.indexOf(o);r!==-1&&this._activeSources.splice(r,1)}}get playbackRate(){return this._playbackRate}set playbackRate(t){me(t,.001),this._playbackRate=t,this.grainSize=this._grainSize}get loopStart(){return this._loopStart}set loopStart(t){this.buffer.loaded&&me(this.toSeconds(t),0,this.buffer.duration),this._loopStart=this.toSeconds(t)}get loopEnd(){return this._loopEnd}set loopEnd(t){this.buffer.loaded&&me(this.toSeconds(t),0,this.buffer.duration),this._loopEnd=this.toSeconds(t)}get reverse(){return this.buffer.reverse}set reverse(t){this.buffer.reverse=t}get grainSize(){return this._grainSize}set grainSize(t){this._grainSize=this.toSeconds(t),this._clock.frequency.setValueAtTime(this._playbackRate/this._grainSize,this.now())}get overlap(){return this._overlap}set overlap(t){const e=this.toSeconds(t);me(e,0),this._overlap=e}get loaded(){return this.buffer.loaded}dispose(){return super.dispose(),this.buffer.dispose(),this._clock.dispose(),this._activeSources.forEach(t=>t.dispose()),this}}class Ma extends Ve{constructor(){super(...arguments),this.name="Abs",this._abs=new ts({context:this.context,mapping:t=>Math.abs(t)<.001?0:Math.abs(t)}),this.input=this._abs,this.output=this._abs}dispose(){return super.dispose(),this._abs.dispose(),this}}class Da extends Ve{constructor(){super(...arguments),this.name="GainToAudio",this._norm=new ts({context:this.context,mapping:t=>2*Math.abs(t)-1}),this.input=this._norm,this.output=this._norm}dispose(){return super.dispose(),this._norm.dispose(),this}}class Ao extends Ve{constructor(){super(...arguments),this.name="Negate",this._multiply=new $t({context:this.context,value:-1}),this.input=this._multiply,this.output=this._multiply}dispose(){return super.dispose(),this._multiply.dispose(),this}}class Vs extends _t{constructor(){super(Z(Vs.getDefaults(),arguments,["value"])),this.override=!1,this.name="Subtract",this._sum=new ft({context:this.context}),this.input=this._sum,this.output=this._sum,this._neg=new Ao({context:this.context}),this.subtrahend=this._param,Fe(this._constantSource,this._neg,this._sum)}static getDefaults(){return Object.assign(_t.getDefaults(),{value:0})}dispose(){return super.dispose(),this._neg.dispose(),this._sum.dispose(),this}}class kn extends Ve{constructor(){super(Z(kn.getDefaults(),arguments)),this.name="GreaterThanZero",this._thresh=this.output=new ts({context:this.context,length:127,mapping:t=>t<=0?0:1}),this._scale=this.input=new $t({context:this.context,value:1e4}),this._scale.connect(this._thresh)}dispose(){return super.dispose(),this._scale.dispose(),this._thresh.dispose(),this}}class Sn extends _t{constructor(){const t=Z(Sn.getDefaults(),arguments,["value"]);super(t),this.name="GreaterThan",this.override=!1,this._subtract=this.input=new Vs({context:this.context,value:t.value}),this._gtz=this.output=new kn({context:this.context}),this.comparator=this._param=this._subtract.subtrahend,gt(this,"comparator"),this._subtract.connect(this._gtz)}static getDefaults(){return Object.assign(_t.getDefaults(),{value:0})}dispose(){return super.dispose(),this._gtz.dispose(),this._subtract.dispose(),this.comparator.dispose(),this}}class Cn extends ps{constructor(){const t=Z(Cn.getDefaults(),arguments,["min","max","exponent"]);super(t),this.name="ScaleExp",this.input=this._exp=new hi({context:this.context,value:t.exponent}),this._exp.connect(this._mult)}static getDefaults(){return Object.assign(ps.getDefaults(),{exponent:1})}get exponent(){return this._exp.value}set exponent(t){this._exp.value=t}dispose(){return super.dispose(),this._exp.dispose(),this}}class hl extends _t{constructor(){const t=Z(_t.getDefaults(),arguments,["value","units"]);super(t),this.name="SyncedSignal",this.override=!1,this._lastVal=t.value,this._synced=this.context.transport.scheduleRepeat(this._onTick.bind(this),"1i"),this._syncedCallback=this._anchorValue.bind(this),this.context.transport.on("start",this._syncedCallback),this.context.transport.on("pause",this._syncedCallback),this.context.transport.on("stop",this._syncedCallback),this._constantSource.disconnect(),this._constantSource.stop(0),this._constantSource=this.output=new bn({context:this.context,offset:t.value,units:t.units}).start(0),this.setValueAtTime(t.value,0)}_onTick(t){const e=super.getValueAtTime(this.context.transport.seconds);this._lastVal!==e&&(this._lastVal=e,this._constantSource.offset.setValueAtTime(e,t))}_anchorValue(t){const e=super.getValueAtTime(this.context.transport.seconds);this._lastVal=e,this._constantSource.offset.cancelAndHoldAtTime(t),this._constantSource.offset.setValueAtTime(e,t)}getValueAtTime(t){const e=new oe(this.context,t).toSeconds();return super.getValueAtTime(e)}setValueAtTime(t,e){const s=new oe(this.context,e).toSeconds();return super.setValueAtTime(t,s),this}linearRampToValueAtTime(t,e){const s=new oe(this.context,e).toSeconds();return super.linearRampToValueAtTime(t,s),this}exponentialRampToValueAtTime(t,e){const s=new oe(this.context,e).toSeconds();return super.exponentialRampToValueAtTime(t,s),this}setTargetAtTime(t,e,s){const i=new oe(this.context,e).toSeconds();return super.setTargetAtTime(t,i,s),this}cancelScheduledValues(t){const e=new oe(this.context,t).toSeconds();return super.cancelScheduledValues(e),this}setValueCurveAtTime(t,e,s,i){const o=new oe(this.context,e).toSeconds();return s=this.toSeconds(s),super.setValueCurveAtTime(t,o,s,i),this}cancelAndHoldAtTime(t){const e=new oe(this.context,t).toSeconds();return super.cancelAndHoldAtTime(e),this}setRampPoint(t){const e=new oe(this.context,t).toSeconds();return super.setRampPoint(e),this}exponentialRampTo(t,e,s){const i=new oe(this.context,s).toSeconds();return super.exponentialRampTo(t,e,i),this}linearRampTo(t,e,s){const i=new oe(this.context,s).toSeconds();return super.linearRampTo(t,e,i),this}targetRampTo(t,e,s){const i=new oe(this.context,s).toSeconds();return super.targetRampTo(t,e,i),this}dispose(){return super.dispose(),this.context.transport.clear(this._synced),this.context.transport.off("start",this._syncedCallback),this.context.transport.off("pause",this._syncedCallback),this.context.transport.off("stop",this._syncedCallback),this._constantSource.dispose(),this}}class ve extends tt{constructor(){const t=Z(ve.getDefaults(),arguments,["attack","decay","sustain","release"]);super(t),this.name="Envelope",this._sig=new _t({context:this.context,value:0}),this.output=this._sig,this.input=void 0,this.attack=t.attack,this.decay=t.decay,this.sustain=t.sustain,this.release=t.release,this.attackCurve=t.attackCurve,this.releaseCurve=t.releaseCurve,this.decayCurve=t.decayCurve}static getDefaults(){return Object.assign(tt.getDefaults(),{attack:.01,attackCurve:"linear",decay:.1,decayCurve:"exponential",release:1,releaseCurve:"exponential",sustain:.5})}get value(){return this.getValueAtTime(this.now())}_getCurve(t,e){if(Qe(t))return t;{let s;for(s in On)if(On[s][e]===t)return s;return t}}_setCurve(t,e,s){if(Qe(s)&&Reflect.has(On,s)){const i=On[s];hs(i)?t!=="_decayCurve"&&(this[t]=i[e]):this[t]=i}else{if(!fe(s)||t==="_decayCurve")throw new Error("Envelope: invalid curve: "+s);this[t]=s}}get attackCurve(){return this._getCurve(this._attackCurve,"In")}set attackCurve(t){this._setCurve("_attackCurve","In",t)}get releaseCurve(){return this._getCurve(this._releaseCurve,"Out")}set releaseCurve(t){this._setCurve("_releaseCurve","Out",t)}get decayCurve(){return this._getCurve(this._decayCurve,"Out")}set decayCurve(t){this._setCurve("_decayCurve","Out",t)}triggerAttack(t,e=1){this.log("triggerAttack",t,e),t=this.toSeconds(t);let s=this.toSeconds(this.attack);const i=this.toSeconds(this.decay),o=this.getValueAtTime(t);if(o>0&&(s=(1-o)/(1/s)),s<this.sampleTime)this._sig.cancelScheduledValues(t),this._sig.setValueAtTime(e,t);else if(this._attackCurve==="linear")this._sig.linearRampTo(e,s,t);else if(this._attackCurve==="exponential")this._sig.targetRampTo(e,s,t);else{this._sig.cancelAndHoldAtTime(t);let r=this._attackCurve;for(let u=1;u<r.length;u++)if(r[u-1]<=o&&o<=r[u]){r=this._attackCurve.slice(u),r[0]=o;break}this._sig.setValueCurveAtTime(r,t,s,e)}if(i&&this.sustain<1){const r=e*this.sustain,u=t+s;this.log("decay",u),this._decayCurve==="linear"?this._sig.linearRampToValueAtTime(r,i+u):this._sig.exponentialApproachValueAtTime(r,u,i)}return this}triggerRelease(t){this.log("triggerRelease",t),t=this.toSeconds(t);const e=this.getValueAtTime(t);if(e>0){const s=this.toSeconds(this.release);s<this.sampleTime?this._sig.setValueAtTime(0,t):this._releaseCurve==="linear"?this._sig.linearRampTo(0,s,t):this._releaseCurve==="exponential"?this._sig.targetRampTo(0,s,t):(mt(fe(this._releaseCurve),"releaseCurve must be either 'linear', 'exponential' or an array"),this._sig.cancelAndHoldAtTime(t),this._sig.setValueCurveAtTime(this._releaseCurve,t,s,e))}return this}getValueAtTime(t){return this._sig.getValueAtTime(t)}triggerAttackRelease(t,e,s=1){return e=this.toSeconds(e),this.triggerAttack(e,s),this.triggerRelease(e+this.toSeconds(t)),this}cancel(t){return this._sig.cancelScheduledValues(this.toSeconds(t)),this}connect(t,e=0,s=0){return Oi(this,t,e,s),this}asArray(){return Lt(this,arguments,void 0,function*(t=1024){const e=t/this.context.sampleRate,s=new ti(1,e,this.context.sampleRate),i=this.toSeconds(this.attack)+this.toSeconds(this.decay),o=i+this.toSeconds(this.release),r=.1*o,u=o+r,p=new this.constructor(Object.assign(this.get(),{attack:e*this.toSeconds(this.attack)/u,decay:e*this.toSeconds(this.decay)/u,release:e*this.toSeconds(this.release)/u,context:s}));return p._sig.toDestination(),p.triggerAttackRelease(e*(i+r)/u,0),(yield s.render()).getChannelData(0)})}dispose(){return super.dispose(),this._sig.dispose(),this}}Je([fs(0)],ve.prototype,"attack",void 0),Je([fs(0)],ve.prototype,"decay",void 0),Je([Ea(0,1)],ve.prototype,"sustain",void 0),Je([fs(0)],ve.prototype,"release",void 0);const On=(()=>{let t,e;const s=[];for(t=0;t<128;t++)s[t]=Math.sin(t/127*(Math.PI/2));const i=[];for(t=0;t<127;t++){e=t/127;const b=Math.sin(e*(2*Math.PI)*6.4-Math.PI/2)+1;i[t]=b/10+.83*e}i[127]=1;const o=[];for(t=0;t<128;t++)o[t]=Math.ceil(t/127*5)/5;const r=[];for(t=0;t<128;t++)e=t/127,r[t]=.5*(1-Math.cos(Math.PI*e));const u=[];for(t=0;t<128;t++){e=t/127;const b=4*Math.pow(e,3)+.2,T=Math.cos(b*Math.PI*2*e);u[t]=Math.abs(T*(1-e))}function p(b){const T=new Array(b.length);for(let S=0;S<b.length;S++)T[S]=1-b[S];return T}return{bounce:{In:p(u),Out:u},cosine:{In:s,Out:(f=s,f.slice(0).reverse())},exponential:"exponential",linear:"linear",ripple:{In:i,Out:p(i)},sine:{In:r,Out:p(r)},step:{In:o,Out:p(o)}};var f})();class Ue extends tt{constructor(){const t=Z(Ue.getDefaults(),arguments);super(t),this._scheduledEvents=[],this._synced=!1,this._original_triggerAttack=this.triggerAttack,this._original_triggerRelease=this.triggerRelease,this._syncedRelease=e=>this._original_triggerRelease(e),this._volume=this.output=new ls({context:this.context,volume:t.volume}),this.volume=this._volume.volume,gt(this,"volume")}static getDefaults(){return Object.assign(tt.getDefaults(),{volume:0})}sync(){return this._syncState()&&(this._syncMethod("triggerAttack",1),this._syncMethod("triggerRelease",0),this.context.transport.on("stop",this._syncedRelease),this.context.transport.on("pause",this._syncedRelease),this.context.transport.on("loopEnd",this._syncedRelease)),this}_syncState(){let t=!1;return this._synced||(this._synced=!0,t=!0),t}_syncMethod(t,e){const s=this["_original_"+t]=this[t];this[t]=(...i)=>{const o=i[e],r=this.context.transport.schedule(u=>{i[e]=u,s.apply(this,i)},o);this._scheduledEvents.push(r)}}unsync(){return this._scheduledEvents.forEach(t=>this.context.transport.clear(t)),this._scheduledEvents=[],this._synced&&(this._synced=!1,this.triggerAttack=this._original_triggerAttack,this.triggerRelease=this._original_triggerRelease,this.context.transport.off("stop",this._syncedRelease),this.context.transport.off("pause",this._syncedRelease),this.context.transport.off("loopEnd",this._syncedRelease)),this}triggerAttackRelease(t,e,s,i){const o=this.toSeconds(s),r=this.toSeconds(e);return this.triggerAttack(t,o,i),this.triggerRelease(o+r),this}dispose(){return super.dispose(),this._volume.dispose(),this.unsync(),this._scheduledEvents=[],this}}class _e extends Ue{constructor(){const t=Z(_e.getDefaults(),arguments);super(t),this.portamento=t.portamento,this.onsilence=t.onsilence}static getDefaults(){return Object.assign(Ue.getDefaults(),{detune:0,onsilence:Ct,portamento:0})}triggerAttack(t,e,s=1){this.log("triggerAttack",t,e,s);const i=this.toSeconds(e);return this._triggerEnvelopeAttack(i,s),this.setNote(t,i),this}triggerRelease(t){this.log("triggerRelease",t);const e=this.toSeconds(t);return this._triggerEnvelopeRelease(e),this}setNote(t,e){const s=this.toSeconds(e),i=t instanceof we?t.toFrequency():t;if(this.portamento>0&&this.getLevelAtTime(s)>.05){const o=this.toSeconds(this.portamento);this.frequency.exponentialRampTo(i,o,s)}else this.frequency.setValueAtTime(i,s);return this}}Je([fs(0)],_e.prototype,"portamento",void 0);class pi extends ve{constructor(){super(Z(pi.getDefaults(),arguments,["attack","decay","sustain","release"])),this.name="AmplitudeEnvelope",this._gainNode=new ft({context:this.context,gain:0}),this.output=this._gainNode,this.input=this._gainNode,this._sig.connect(this._gainNode.gain),this.output=this._gainNode,this.input=this._gainNode}dispose(){return super.dispose(),this._gainNode.dispose(),this}}class Ss extends _e{constructor(){const t=Z(Ss.getDefaults(),arguments);super(t),this.name="Synth",this.oscillator=new ds(Object.assign({context:this.context,detune:t.detune,onstop:()=>this.onsilence(this)},t.oscillator)),this.frequency=this.oscillator.frequency,this.detune=this.oscillator.detune,this.envelope=new pi(Object.assign({context:this.context},t.envelope)),this.oscillator.chain(this.envelope,this.output),gt(this,["oscillator","frequency","detune","envelope"])}static getDefaults(){return Object.assign(_e.getDefaults(),{envelope:Object.assign(ge(ve.getDefaults(),Object.keys(tt.getDefaults())),{attack:.005,decay:.1,release:1,sustain:.3}),oscillator:Object.assign(ge(ds.getDefaults(),[...Object.keys(Kt.getDefaults()),"frequency","detune"]),{type:"triangle"})})}_triggerEnvelopeAttack(t,e){if(this.envelope.triggerAttack(t,e),this.oscillator.start(t),this.envelope.sustain===0){const s=this.toSeconds(this.envelope.attack),i=this.toSeconds(this.envelope.decay);this.oscillator.stop(t+s+i)}}_triggerEnvelopeRelease(t){this.envelope.triggerRelease(t),this.oscillator.stop(t+this.toSeconds(this.envelope.release))}getLevelAtTime(t){return t=this.toSeconds(t),this.envelope.getValueAtTime(t)}dispose(){return super.dispose(),this.oscillator.dispose(),this.envelope.dispose(),this}}class Pi extends _e{constructor(){const t=Z(Pi.getDefaults(),arguments);super(t),this.name="ModulationSynth",this._carrier=new Ss({context:this.context,oscillator:t.oscillator,envelope:t.envelope,onsilence:()=>this.onsilence(this),volume:-10}),this._modulator=new Ss({context:this.context,oscillator:t.modulation,envelope:t.modulationEnvelope,volume:-10}),this.oscillator=this._carrier.oscillator,this.envelope=this._carrier.envelope,this.modulation=this._modulator.oscillator,this.modulationEnvelope=this._modulator.envelope,this.frequency=new _t({context:this.context,units:"frequency"}),this.detune=new _t({context:this.context,value:t.detune,units:"cents"}),this.harmonicity=new $t({context:this.context,value:t.harmonicity,minValue:0}),this._modulationNode=new ft({context:this.context,gain:0}),gt(this,["frequency","harmonicity","oscillator","envelope","modulation","modulationEnvelope","detune"])}static getDefaults(){return Object.assign(_e.getDefaults(),{harmonicity:3,oscillator:Object.assign(ge(ds.getDefaults(),[...Object.keys(Kt.getDefaults()),"frequency","detune"]),{type:"sine"}),envelope:Object.assign(ge(ve.getDefaults(),Object.keys(tt.getDefaults())),{attack:.01,decay:.01,sustain:1,release:.5}),modulation:Object.assign(ge(ds.getDefaults(),[...Object.keys(Kt.getDefaults()),"frequency","detune"]),{type:"square"}),modulationEnvelope:Object.assign(ge(ve.getDefaults(),Object.keys(tt.getDefaults())),{attack:.5,decay:0,sustain:1,release:.5})})}_triggerEnvelopeAttack(t,e){this._carrier._triggerEnvelopeAttack(t,e),this._modulator._triggerEnvelopeAttack(t,e)}_triggerEnvelopeRelease(t){return this._carrier._triggerEnvelopeRelease(t),this._modulator._triggerEnvelopeRelease(t),this}getLevelAtTime(t){return t=this.toSeconds(t),this.envelope.getValueAtTime(t)}dispose(){return super.dispose(),this._carrier.dispose(),this._modulator.dispose(),this.frequency.dispose(),this.detune.dispose(),this.harmonicity.dispose(),this._modulationNode.dispose(),this}}class ko extends Pi{constructor(){super(Z(ko.getDefaults(),arguments)),this.name="AMSynth",this._modulationScale=new Tn({context:this.context}),this.frequency.connect(this._carrier.frequency),this.frequency.chain(this.harmonicity,this._modulator.frequency),this.detune.fan(this._carrier.detune,this._modulator.detune),this._modulator.chain(this._modulationScale,this._modulationNode.gain),this._carrier.chain(this._modulationNode,this.output)}dispose(){return super.dispose(),this._modulationScale.dispose(),this}}class qi extends tt{constructor(){const t=Z(qi.getDefaults(),arguments,["frequency","type"]);super(t),this.name="BiquadFilter",this._filter=this.context.createBiquadFilter(),this.input=this.output=this._filter,this.Q=new xt({context:this.context,units:"number",value:t.Q,param:this._filter.Q}),this.frequency=new xt({context:this.context,units:"frequency",value:t.frequency,param:this._filter.frequency}),this.detune=new xt({context:this.context,units:"cents",value:t.detune,param:this._filter.detune}),this.gain=new xt({context:this.context,units:"decibels",convert:!1,value:t.gain,param:this._filter.gain}),this.type=t.type}static getDefaults(){return Object.assign(tt.getDefaults(),{Q:1,type:"lowpass",frequency:350,detune:0,gain:0})}get type(){return this._filter.type}set type(t){mt(["lowpass","highpass","bandpass","lowshelf","highshelf","notch","allpass","peaking"].indexOf(t)!==-1,`Invalid filter type: ${t}`),this._filter.type=t}getFrequencyResponse(t=128){const e=new Float32Array(t);for(let r=0;r<t;r++){const u=19980*Math.pow(r/t,2)+20;e[r]=u}const s=new Float32Array(t),i=new Float32Array(t),o=this.context.createBiquadFilter();return o.type=this.type,o.Q.value=this.Q.value,o.frequency.value=this.frequency.value,o.gain.value=this.gain.value,o.getFrequencyResponse(e,s,i),s}dispose(){return super.dispose(),this._filter.disconnect(),this.Q.dispose(),this.frequency.dispose(),this.gain.dispose(),this.detune.dispose(),this}}class ze extends tt{constructor(){const t=Z(ze.getDefaults(),arguments,["frequency","type","rolloff"]);super(t),this.name="Filter",this.input=new ft({context:this.context}),this.output=new ft({context:this.context}),this._filters=[],this._filters=[],this.Q=new _t({context:this.context,units:"positive",value:t.Q}),this.frequency=new _t({context:this.context,units:"frequency",value:t.frequency}),this.detune=new _t({context:this.context,units:"cents",value:t.detune}),this.gain=new _t({context:this.context,units:"decibels",convert:!1,value:t.gain}),this._type=t.type,this.rolloff=t.rolloff,gt(this,["detune","frequency","gain","Q"])}static getDefaults(){return Object.assign(tt.getDefaults(),{Q:1,detune:0,frequency:350,gain:0,rolloff:-12,type:"lowpass"})}get type(){return this._type}set type(t){mt(["lowpass","highpass","bandpass","lowshelf","highshelf","notch","allpass","peaking"].indexOf(t)!==-1,`Invalid filter type: ${t}`),this._type=t,this._filters.forEach(e=>e.type=t)}get rolloff(){return this._rolloff}set rolloff(t){const e=Re(t)?t:parseInt(t,10),s=[-12,-24,-48,-96];let i=s.indexOf(e);mt(i!==-1,`rolloff can only be ${s.join(", ")}`),i+=1,this._rolloff=e,this.input.disconnect(),this._filters.forEach(o=>o.disconnect()),this._filters=new Array(i);for(let o=0;o<i;o++){const r=new qi({context:this.context});r.type=this._type,this.frequency.connect(r.frequency),this.detune.connect(r.detune),this.Q.connect(r.Q),this.gain.connect(r.gain),this._filters[o]=r}this._internalChannels=this._filters,Fe(this.input,...this._internalChannels,this.output)}getFrequencyResponse(t=128){const e=new qi({frequency:this.frequency.value,gain:this.gain.value,Q:this.Q.value,type:this._type,detune:this.detune.value}),s=new Float32Array(t).map(()=>1);return this._filters.forEach(()=>{e.getFrequencyResponse(t).forEach((i,o)=>s[o]*=i)}),e.dispose(),s}dispose(){return super.dispose(),this._filters.forEach(t=>{t.dispose()}),ki(this,["detune","frequency","gain","Q"]),this.frequency.dispose(),this.Q.dispose(),this.detune.dispose(),this.gain.dispose(),this}}class Ni extends ve{constructor(){const t=Z(Ni.getDefaults(),arguments,["attack","decay","sustain","release"]);super(t),this.name="FrequencyEnvelope",this._octaves=t.octaves,this._baseFrequency=this.toFrequency(t.baseFrequency),this._exponent=this.input=new hi({context:this.context,value:t.exponent}),this._scale=this.output=new ps({context:this.context,min:this._baseFrequency,max:this._baseFrequency*Math.pow(2,this._octaves)}),this._sig.chain(this._exponent,this._scale)}static getDefaults(){return Object.assign(ve.getDefaults(),{baseFrequency:200,exponent:1,octaves:4})}get baseFrequency(){return this._baseFrequency}set baseFrequency(t){const e=this.toFrequency(t);me(e,0),this._baseFrequency=e,this._scale.min=this._baseFrequency,this.octaves=this._octaves}get octaves(){return this._octaves}set octaves(t){this._octaves=t,this._scale.max=this._baseFrequency*Math.pow(2,t)}get exponent(){return this._exponent.value}set exponent(t){this._exponent.value=t}dispose(){return super.dispose(),this._exponent.dispose(),this._scale.dispose(),this}}class zs extends _e{constructor(){const t=Z(zs.getDefaults(),arguments);super(t),this.name="MonoSynth",this.oscillator=new ds(Object.assign(t.oscillator,{context:this.context,detune:t.detune,onstop:()=>this.onsilence(this)})),this.frequency=this.oscillator.frequency,this.detune=this.oscillator.detune,this.filter=new ze(Object.assign(t.filter,{context:this.context})),this.filterEnvelope=new Ni(Object.assign(t.filterEnvelope,{context:this.context})),this.envelope=new pi(Object.assign(t.envelope,{context:this.context})),this.oscillator.chain(this.filter,this.envelope,this.output),this.filterEnvelope.connect(this.filter.frequency),gt(this,["oscillator","frequency","detune","filter","filterEnvelope","envelope"])}static getDefaults(){return Object.assign(_e.getDefaults(),{envelope:Object.assign(ge(ve.getDefaults(),Object.keys(tt.getDefaults())),{attack:.005,decay:.1,release:1,sustain:.9}),filter:Object.assign(ge(ze.getDefaults(),Object.keys(tt.getDefaults())),{Q:1,rolloff:-12,type:"lowpass"}),filterEnvelope:Object.assign(ge(Ni.getDefaults(),Object.keys(tt.getDefaults())),{attack:.6,baseFrequency:200,decay:.2,exponent:2,octaves:3,release:2,sustain:.5}),oscillator:Object.assign(ge(ds.getDefaults(),Object.keys(Kt.getDefaults())),{type:"sawtooth"})})}_triggerEnvelopeAttack(t,e=1){if(this.envelope.triggerAttack(t,e),this.filterEnvelope.triggerAttack(t),this.oscillator.start(t),this.envelope.sustain===0){const s=this.toSeconds(this.envelope.attack),i=this.toSeconds(this.envelope.decay);this.oscillator.stop(t+s+i)}}_triggerEnvelopeRelease(t){this.envelope.triggerRelease(t),this.filterEnvelope.triggerRelease(t),this.oscillator.stop(t+this.toSeconds(this.envelope.release))}getLevelAtTime(t){return t=this.toSeconds(t),this.envelope.getValueAtTime(t)}dispose(){return super.dispose(),this.oscillator.dispose(),this.envelope.dispose(),this.filterEnvelope.dispose(),this.filter.dispose(),this}}class So extends _e{constructor(){const t=Z(So.getDefaults(),arguments);super(t),this.name="DuoSynth",this.voice0=new zs(Object.assign(t.voice0,{context:this.context,onsilence:()=>this.onsilence(this)})),this.voice1=new zs(Object.assign(t.voice1,{context:this.context})),this.harmonicity=new $t({context:this.context,units:"positive",value:t.harmonicity}),this._vibrato=new Ae({frequency:t.vibratoRate,context:this.context,min:-50,max:50}),this._vibrato.start(),this.vibratoRate=this._vibrato.frequency,this._vibratoGain=new ft({context:this.context,units:"normalRange",gain:t.vibratoAmount}),this.vibratoAmount=this._vibratoGain.gain,this.frequency=new _t({context:this.context,units:"frequency",value:440}),this.detune=new _t({context:this.context,units:"cents",value:t.detune}),this.frequency.connect(this.voice0.frequency),this.frequency.chain(this.harmonicity,this.voice1.frequency),this._vibrato.connect(this._vibratoGain),this._vibratoGain.fan(this.voice0.detune,this.voice1.detune),this.detune.fan(this.voice0.detune,this.voice1.detune),this.voice0.connect(this.output),this.voice1.connect(this.output),gt(this,["voice0","voice1","frequency","vibratoAmount","vibratoRate"])}getLevelAtTime(t){return t=this.toSeconds(t),this.voice0.envelope.getValueAtTime(t)+this.voice1.envelope.getValueAtTime(t)}static getDefaults(){return We(_e.getDefaults(),{vibratoAmount:.5,vibratoRate:5,harmonicity:1.5,voice0:We(ge(zs.getDefaults(),Object.keys(_e.getDefaults())),{filterEnvelope:{attack:.01,decay:0,sustain:1,release:.5},envelope:{attack:.01,decay:0,sustain:1,release:.5}}),voice1:We(ge(zs.getDefaults(),Object.keys(_e.getDefaults())),{filterEnvelope:{attack:.01,decay:0,sustain:1,release:.5},envelope:{attack:.01,decay:0,sustain:1,release:.5}})})}_triggerEnvelopeAttack(t,e){this.voice0._triggerEnvelopeAttack(t,e),this.voice1._triggerEnvelopeAttack(t,e)}_triggerEnvelopeRelease(t){return this.voice0._triggerEnvelopeRelease(t),this.voice1._triggerEnvelopeRelease(t),this}dispose(){return super.dispose(),this.voice0.dispose(),this.voice1.dispose(),this.frequency.dispose(),this.detune.dispose(),this._vibrato.dispose(),this.vibratoRate.dispose(),this._vibratoGain.dispose(),this.harmonicity.dispose(),this}}class Co extends Pi{constructor(){const t=Z(Co.getDefaults(),arguments);super(t),this.name="FMSynth",this.modulationIndex=new $t({context:this.context,value:t.modulationIndex}),this.frequency.connect(this._carrier.frequency),this.frequency.chain(this.harmonicity,this._modulator.frequency),this.frequency.chain(this.modulationIndex,this._modulationNode),this.detune.fan(this._carrier.detune,this._modulator.detune),this._modulator.connect(this._modulationNode.gain),this._modulationNode.connect(this._carrier.frequency),this._carrier.connect(this.output)}static getDefaults(){return Object.assign(Pi.getDefaults(),{modulationIndex:10})}dispose(){return super.dispose(),this.modulationIndex.dispose(),this}}const Ia=[1,1.483,1.932,2.546,2.63,3.897];class Oo extends _e{constructor(){const t=Z(Oo.getDefaults(),arguments);super(t),this.name="MetalSynth",this._oscillators=[],this._freqMultipliers=[],this.detune=new _t({context:this.context,units:"cents",value:t.detune}),this.frequency=new _t({context:this.context,units:"frequency"}),this._amplitude=new ft({context:this.context,gain:0}).connect(this.output),this._highpass=new ze({Q:0,context:this.context,type:"highpass"}).connect(this._amplitude);for(let e=0;e<Ia.length;e++){const s=new li({context:this.context,harmonicity:t.harmonicity,modulationIndex:t.modulationIndex,modulationType:"square",onstop:e===0?()=>this.onsilence(this):Ct,type:"square"});s.connect(this._highpass),this._oscillators[e]=s;const i=new $t({context:this.context,value:Ia[e]});this._freqMultipliers[e]=i,this.frequency.chain(i,s.frequency),this.detune.connect(s.detune)}this._filterFreqScaler=new ps({context:this.context,max:7e3,min:this.toFrequency(t.resonance)}),this.envelope=new ve({attack:t.envelope.attack,attackCurve:"linear",context:this.context,decay:t.envelope.decay,release:t.envelope.release,sustain:0}),this.envelope.chain(this._filterFreqScaler,this._highpass.frequency),this.envelope.connect(this._amplitude.gain),this._octaves=t.octaves,this.octaves=t.octaves}static getDefaults(){return We(_e.getDefaults(),{envelope:Object.assign(ge(ve.getDefaults(),Object.keys(tt.getDefaults())),{attack:.001,decay:1.4,release:.2}),harmonicity:5.1,modulationIndex:32,octaves:1.5,resonance:4e3})}_triggerEnvelopeAttack(t,e=1){return this.envelope.triggerAttack(t,e),this._oscillators.forEach(s=>s.start(t)),this.envelope.sustain===0&&this._oscillators.forEach(s=>{s.stop(t+this.toSeconds(this.envelope.attack)+this.toSeconds(this.envelope.decay))}),this}_triggerEnvelopeRelease(t){return this.envelope.triggerRelease(t),this._oscillators.forEach(e=>e.stop(t+this.toSeconds(this.envelope.release))),this}getLevelAtTime(t){return t=this.toSeconds(t),this.envelope.getValueAtTime(t)}get modulationIndex(){return this._oscillators[0].modulationIndex.value}set modulationIndex(t){this._oscillators.forEach(e=>e.modulationIndex.value=t)}get harmonicity(){return this._oscillators[0].harmonicity.value}set harmonicity(t){this._oscillators.forEach(e=>e.harmonicity.value=t)}get resonance(){return this._filterFreqScaler.min}set resonance(t){this._filterFreqScaler.min=this.toFrequency(t),this.octaves=this._octaves}get octaves(){return this._octaves}set octaves(t){this._octaves=t,this._filterFreqScaler.max=this._filterFreqScaler.min*Math.pow(2,t)}dispose(){return super.dispose(),this._oscillators.forEach(t=>t.dispose()),this._freqMultipliers.forEach(t=>t.dispose()),this.frequency.dispose(),this.detune.dispose(),this._filterFreqScaler.dispose(),this._amplitude.dispose(),this.envelope.dispose(),this._highpass.dispose(),this}}class Fi extends Ss{constructor(){const t=Z(Fi.getDefaults(),arguments);super(t),this.name="MembraneSynth",this.portamento=0,this.pitchDecay=t.pitchDecay,this.octaves=t.octaves,gt(this,["oscillator","envelope"])}static getDefaults(){return We(_e.getDefaults(),Ss.getDefaults(),{envelope:{attack:.001,attackCurve:"exponential",decay:.4,release:1.4,sustain:.01},octaves:10,oscillator:{type:"sine"},pitchDecay:.05})}setNote(t,e){const s=this.toSeconds(e),i=this.toFrequency(t instanceof we?t.toFrequency():t),o=i*this.octaves;return this.oscillator.frequency.setValueAtTime(o,s),this.oscillator.frequency.exponentialRampToValueAtTime(i,s+this.toSeconds(this.pitchDecay)),this}dispose(){return super.dispose(),this}}Je([Ea(0)],Fi.prototype,"octaves",void 0),Je([fs(0)],Fi.prototype,"pitchDecay",void 0);class Eo extends Ue{constructor(){const t=Z(Eo.getDefaults(),arguments);super(t),this.name="NoiseSynth",this.noise=new ks(Object.assign({context:this.context},t.noise)),this.envelope=new pi(Object.assign({context:this.context},t.envelope)),this.noise.chain(this.envelope,this.output)}static getDefaults(){return Object.assign(Ue.getDefaults(),{envelope:Object.assign(ge(ve.getDefaults(),Object.keys(tt.getDefaults())),{decay:.1,sustain:0}),noise:Object.assign(ge(ks.getDefaults(),Object.keys(Kt.getDefaults())),{type:"white"})})}triggerAttack(t,e=1){return t=this.toSeconds(t),this.envelope.triggerAttack(t,e),this.noise.start(t),this.envelope.sustain===0&&this.noise.stop(t+this.toSeconds(this.envelope.attack)+this.toSeconds(this.envelope.decay)),this}triggerRelease(t){return t=this.toSeconds(t),this.envelope.triggerRelease(t),this.noise.stop(t+this.toSeconds(this.envelope.release)),this}sync(){return this._syncState()&&(this._syncMethod("triggerAttack",0),this._syncMethod("triggerRelease",0)),this}triggerAttackRelease(t,e,s=1){return e=this.toSeconds(e),t=this.toSeconds(t),this.triggerAttack(e,s),this.triggerRelease(e+t),this}dispose(){return super.dispose(),this.noise.dispose(),this.envelope.dispose(),this}}const Mo=new Set;function Do(n){Mo.add(n)}function Ra(n,t){const e=`registerProcessor("${n}", ${t})`;Mo.add(e)}class Io extends tt{constructor(t){super(t),this.name="ToneAudioWorklet",this.workletOptions={},this.onprocessorerror=Ct;const e=URL.createObjectURL(new Blob([Array.from(Mo).join(`
`)],{type:"text/javascript"})),s=this._audioWorkletName();this._dummyGain=this.context.createGain(),this._dummyParam=this._dummyGain.gain,this.context.addAudioWorkletModule(e).then(()=>{this.disposed||(this._worklet=this.context.createAudioWorkletNode(s,this.workletOptions),this._worklet.onprocessorerror=this.onprocessorerror.bind(this),this.onReady(this._worklet))})}dispose(){return super.dispose(),this._dummyGain.disconnect(),this._worklet&&(this._worklet.port.postMessage("dispose"),this._worklet.disconnect()),this}}Do(`
	/**
	 * The base AudioWorkletProcessor for use in Tone.js. Works with the {@link ToneAudioWorklet}. 
	 */
	class ToneAudioWorkletProcessor extends AudioWorkletProcessor {

		constructor(options) {
			
			super(options);
			/**
			 * If the processor was disposed or not. Keep alive until it's disposed.
			 */
			this.disposed = false;
		   	/** 
			 * The number of samples in the processing block
			 */
			this.blockSize = 128;
			/**
			 * the sample rate
			 */
			this.sampleRate = sampleRate;

			this.port.onmessage = (event) => {
				// when it receives a dispose 
				if (event.data === "dispose") {
					this.disposed = true;
				}
			};
		}
	}
`),Do(`
	/**
	 * Abstract class for a single input/output processor. 
	 * has a 'generate' function which processes one sample at a time
	 */
	class SingleIOProcessor extends ToneAudioWorkletProcessor {

		constructor(options) {
			super(Object.assign(options, {
				numberOfInputs: 1,
				numberOfOutputs: 1
			}));
			/**
			 * Holds the name of the parameter and a single value of that
			 * parameter at the current sample
			 * @type { [name: string]: number }
			 */
			this.params = {}
		}

		/**
		 * Generate an output sample from the input sample and parameters
		 * @abstract
		 * @param input number
		 * @param channel number
		 * @param parameters { [name: string]: number }
		 * @returns number
		 */
		generate(){}

		/**
		 * Update the private params object with the 
		 * values of the parameters at the given index
		 * @param parameters { [name: string]: Float32Array },
		 * @param index number
		 */
		updateParams(parameters, index) {
			for (const paramName in parameters) {
				const param = parameters[paramName];
				if (param.length > 1) {
					this.params[paramName] = parameters[paramName][index];
				} else {
					this.params[paramName] = parameters[paramName][0];
				}
			}
		}

		/**
		 * Process a single frame of the audio
		 * @param inputs Float32Array[][]
		 * @param outputs Float32Array[][]
		 */
		process(inputs, outputs, parameters) {
			const input = inputs[0];
			const output = outputs[0];
			// get the parameter values
			const channelCount = Math.max(input && input.length || 0, output.length);
			for (let sample = 0; sample < this.blockSize; sample++) {
				this.updateParams(parameters, sample);
				for (let channel = 0; channel < channelCount; channel++) {
					const inputSample = input && input.length ? input[channel][sample] : 0;
					output[channel][sample] = this.generate(inputSample, channel, this.params);
				}
			}
			return !this.disposed;
		}
	};
`),Do(`
	/**
	 * A multichannel buffer for use within an AudioWorkletProcessor as a delay line
	 */
	class DelayLine {
		
		constructor(size, channels) {
			this.buffer = [];
			this.writeHead = []
			this.size = size;

			// create the empty channels
			for (let i = 0; i < channels; i++) {
				this.buffer[i] = new Float32Array(this.size);
				this.writeHead[i] = 0;
			}
		}

		/**
		 * Push a value onto the end
		 * @param channel number
		 * @param value number
		 */
		push(channel, value) {
			this.writeHead[channel] += 1;
			if (this.writeHead[channel] > this.size) {
				this.writeHead[channel] = 0;
			}
			this.buffer[channel][this.writeHead[channel]] = value;
		}

		/**
		 * Get the recorded value of the channel given the delay
		 * @param channel number
		 * @param delay number delay samples
		 */
		get(channel, delay) {
			let readHead = this.writeHead[channel] - Math.floor(delay);
			if (readHead < 0) {
				readHead += this.size;
			}
			return this.buffer[channel][readHead];
		}
	}
`);const Pa="feedback-comb-filter";Ra(Pa,`
	class FeedbackCombFilterWorklet extends SingleIOProcessor {

		constructor(options) {
			super(options);
			this.delayLine = new DelayLine(this.sampleRate, options.channelCount || 2);
		}

		static get parameterDescriptors() {
			return [{
				name: "delayTime",
				defaultValue: 0.1,
				minValue: 0,
				maxValue: 1,
				automationRate: "k-rate"
			}, {
				name: "feedback",
				defaultValue: 0.5,
				minValue: 0,
				maxValue: 0.9999,
				automationRate: "k-rate"
			}];
		}

		generate(input, channel, parameters) {
			const delayedSample = this.delayLine.get(channel, parameters.delayTime * this.sampleRate);
			this.delayLine.push(channel, input + delayedSample * parameters.feedback);
			return delayedSample;
		}
	}
`);class Li extends Io{constructor(){const t=Z(Li.getDefaults(),arguments,["delayTime","resonance"]);super(t),this.name="FeedbackCombFilter",this.input=new ft({context:this.context}),this.output=new ft({context:this.context}),this.delayTime=new xt({context:this.context,value:t.delayTime,units:"time",minValue:0,maxValue:1,param:this._dummyParam,swappable:!0}),this.resonance=new xt({context:this.context,value:t.resonance,units:"normalRange",param:this._dummyParam,swappable:!0}),gt(this,["resonance","delayTime"])}_audioWorkletName(){return Pa}static getDefaults(){return Object.assign(tt.getDefaults(),{delayTime:.1,resonance:.5})}onReady(t){Fe(this.input,t,this.output);const e=t.parameters.get("delayTime");this.delayTime.setParam(e);const s=t.parameters.get("feedback");this.resonance.setParam(s)}dispose(){return super.dispose(),this.input.dispose(),this.output.dispose(),this.delayTime.dispose(),this.resonance.dispose(),this}}class Vi extends tt{constructor(){const t=Z(Vi.getDefaults(),arguments,["frequency","type"]);super(t),this.name="OnePoleFilter",this._frequency=t.frequency,this._type=t.type,this.input=new ft({context:this.context}),this.output=new ft({context:this.context}),this._createFilter()}static getDefaults(){return Object.assign(tt.getDefaults(),{frequency:880,type:"lowpass"})}_createFilter(){const t=this._filter,e=this.toFrequency(this._frequency),s=1/(2*Math.PI*e);if(this._type==="lowpass"){const i=1/(s*this.context.sampleRate),o=i-1;this._filter=this.context.createIIRFilter([i,0],[1,o])}else{const i=1/(s*this.context.sampleRate)-1;this._filter=this.context.createIIRFilter([1,-1],[1,i])}this.input.chain(this._filter,this.output),t&&this.context.setTimeout(()=>{this.disposed||(this.input.disconnect(t),t.disconnect())},this.blockTime)}get frequency(){return this._frequency}set frequency(t){this._frequency=t,this._createFilter()}get type(){return this._type}set type(t){this._type=t,this._createFilter()}getFrequencyResponse(t=128){const e=new Float32Array(t);for(let o=0;o<t;o++){const r=19980*Math.pow(o/t,2)+20;e[o]=r}const s=new Float32Array(t),i=new Float32Array(t);return this._filter.getFrequencyResponse(e,s,i),s}dispose(){return super.dispose(),this.input.dispose(),this.output.dispose(),this._filter.disconnect(),this}}class zi extends tt{constructor(){const t=Z(zi.getDefaults(),arguments,["delayTime","resonance","dampening"]);super(t),this.name="LowpassCombFilter",this._combFilter=this.output=new Li({context:this.context,delayTime:t.delayTime,resonance:t.resonance}),this.delayTime=this._combFilter.delayTime,this.resonance=this._combFilter.resonance,this._lowpass=this.input=new Vi({context:this.context,frequency:t.dampening,type:"lowpass"}),this._lowpass.connect(this._combFilter)}static getDefaults(){return Object.assign(tt.getDefaults(),{dampening:3e3,delayTime:.1,resonance:.5})}get dampening(){return this._lowpass.frequency}set dampening(t){this._lowpass.frequency=t}dispose(){return super.dispose(),this._combFilter.dispose(),this._lowpass.dispose(),this}}class Ro extends Ue{constructor(){const t=Z(Ro.getDefaults(),arguments);super(t),this.name="PluckSynth",this._noise=new ks({context:this.context,type:"pink"}),this.attackNoise=t.attackNoise,this._lfcf=new zi({context:this.context,dampening:t.dampening,resonance:t.resonance}),this.resonance=t.resonance,this.release=t.release,this._noise.connect(this._lfcf),this._lfcf.connect(this.output)}static getDefaults(){return We(Ue.getDefaults(),{attackNoise:1,dampening:4e3,resonance:.7,release:1})}get dampening(){return this._lfcf.dampening}set dampening(t){this._lfcf.dampening=t}triggerAttack(t,e){const s=this.toFrequency(t);e=this.toSeconds(e);const i=1/s;return this._lfcf.delayTime.setValueAtTime(i,e),this._noise.start(e),this._noise.stop(e+i*this.attackNoise),this._lfcf.resonance.cancelScheduledValues(e),this._lfcf.resonance.setValueAtTime(this.resonance,e),this}triggerRelease(t){return this._lfcf.resonance.linearRampTo(0,this.release,t),this}dispose(){return super.dispose(),this._noise.dispose(),this._lfcf.dispose(),this}}class Po extends Ue{constructor(){const t=Z(Po.getDefaults(),arguments,["voice","options"]);super(t),this.name="PolySynth",this._availableVoices=[],this._activeVoices=[],this._voices=[],this._gcTimeout=-1,this._averageActiveVoices=0,this._syncedRelease=i=>this.releaseAll(i),mt(!Re(t.voice),"DEPRECATED: The polyphony count is no longer the first argument.");const e=t.voice.getDefaults();this.options=Object.assign(e,t.options),this.voice=t.voice,this.maxPolyphony=t.maxPolyphony,this._dummyVoice=this._getNextAvailableVoice();const s=this._voices.indexOf(this._dummyVoice);this._voices.splice(s,1),this._gcTimeout=this.context.setInterval(this._collectGarbage.bind(this),1)}static getDefaults(){return Object.assign(Ue.getDefaults(),{maxPolyphony:32,options:{},voice:Ss})}get activeVoices(){return this._activeVoices.length}_makeVoiceAvailable(t){this._availableVoices.push(t);const e=this._activeVoices.findIndex(s=>s.voice===t);this._activeVoices.splice(e,1)}_getNextAvailableVoice(){if(this._availableVoices.length)return this._availableVoices.shift();if(this._voices.length<this.maxPolyphony){const t=new this.voice(Object.assign(this.options,{context:this.context,onsilence:this._makeVoiceAvailable.bind(this)}));return mt(t instanceof _e,"Voice must extend Monophonic class"),t.connect(this.output),this._voices.push(t),t}Zs("Max polyphony exceeded. Note dropped.")}_collectGarbage(){if(this._averageActiveVoices=Math.max(.95*this._averageActiveVoices,this.activeVoices),this._availableVoices.length&&this._voices.length>Math.ceil(this._averageActiveVoices+1)){const t=this._availableVoices.shift(),e=this._voices.indexOf(t);this._voices.splice(e,1),this.context.isOffline||t.dispose()}}_triggerAttack(t,e,s){t.forEach(i=>{const o=new ai(this.context,i).toMidi(),r=this._getNextAvailableVoice();r&&(r.triggerAttack(i,e,s),this._activeVoices.push({midi:o,voice:r,released:!1}),this.log("triggerAttack",i,e))})}_triggerRelease(t,e){t.forEach(s=>{const i=new ai(this.context,s).toMidi(),o=this._activeVoices.find(({midi:r,released:u})=>r===i&&!u);o&&(o.voice.triggerRelease(e),o.released=!0,this.log("triggerRelease",s,e))})}_scheduleEvent(t,e,s,i){mt(!this.disposed,"Synth was already disposed"),s<=this.now()?t==="attack"?this._triggerAttack(e,s,i):this._triggerRelease(e,s):this.context.setTimeout(()=>{this.disposed||this._scheduleEvent(t,e,s,i)},s-this.now())}triggerAttack(t,e,s){Array.isArray(t)||(t=[t]);const i=this.toSeconds(e);return this._scheduleEvent("attack",t,i,s),this}triggerRelease(t,e){Array.isArray(t)||(t=[t]);const s=this.toSeconds(e);return this._scheduleEvent("release",t,s),this}triggerAttackRelease(t,e,s,i){const o=this.toSeconds(s);if(this.triggerAttack(t,o,i),fe(e)){mt(fe(t),"If the duration is an array, the notes must also be an array");for(let r=0;r<t.length;r++){const u=e[Math.min(r,e.length-1)],p=this.toSeconds(u);mt(p>0,"The duration must be greater than 0"),this.triggerRelease(t[r],o+p)}}else{const r=this.toSeconds(e);mt(r>0,"The duration must be greater than 0"),this.triggerRelease(t,o+r)}return this}sync(){return this._syncState()&&(this._syncMethod("triggerAttack",1),this._syncMethod("triggerRelease",1),this.context.transport.on("stop",this._syncedRelease),this.context.transport.on("pause",this._syncedRelease),this.context.transport.on("loopEnd",this._syncedRelease)),this}set(t){const e=ge(t,["onsilence","context"]);return this.options=We(this.options,e),this._voices.forEach(s=>s.set(e)),this._dummyVoice.set(e),this}get(){return this._dummyVoice.get()}releaseAll(t){const e=this.toSeconds(t);return this._activeVoices.forEach(({voice:s})=>{s.triggerRelease(e)}),this}dispose(){return super.dispose(),this._dummyVoice.dispose(),this._voices.forEach(t=>t.dispose()),this._activeVoices=[],this._availableVoices=[],this.context.clearInterval(this._gcTimeout),this}}class Bi extends Ue{constructor(){const t=Z(Bi.getDefaults(),arguments,["urls","onload","baseUrl"],"urls");super(t),this.name="Sampler",this._activeSources=new Map;const e={};Object.keys(t.urls).forEach(s=>{const i=parseInt(s,10);if(mt(Ai(s)||Re(i)&&isFinite(i),`url key is neither a note or midi pitch: ${s}`),Ai(s)){const o=new we(this.context,s).toMidi();e[o]=t.urls[s]}else Re(i)&&isFinite(i)&&(e[i]=t.urls[i])}),this._buffers=new ri({urls:e,onload:t.onload,baseUrl:t.baseUrl,onerror:t.onerror}),this.attack=t.attack,this.release=t.release,this.curve=t.curve,this._buffers.loaded&&Promise.resolve().then(t.onload)}static getDefaults(){return Object.assign(Ue.getDefaults(),{attack:0,baseUrl:"",curve:"exponential",onload:Ct,onerror:Ct,release:.1,urls:{}})}_findClosest(t){let e=0;for(;e<96;){if(this._buffers.has(t+e))return-e;if(this._buffers.has(t-e))return e;e++}throw new Error(`No available buffers for note: ${t}`)}triggerAttack(t,e,s=1){return this.log("triggerAttack",t,e,s),Array.isArray(t)||(t=[t]),t.forEach(i=>{const o=ka(new we(this.context,i).toFrequency()),r=Math.round(o),u=o-r,p=this._findClosest(r),f=r-p,b=this._buffers.get(f),T=si(p+u),S=new As({url:b,context:this.context,curve:this.curve,fadeIn:this.attack,fadeOut:this.release,playbackRate:T}).connect(this.output);S.start(e,0,b.duration/T,s),fe(this._activeSources.get(r))||this._activeSources.set(r,[]),this._activeSources.get(r).push(S),S.onended=()=>{if(this._activeSources&&this._activeSources.has(r)){const O=this._activeSources.get(r),z=O.indexOf(S);z!==-1&&O.splice(z,1)}}}),this}triggerRelease(t,e){return this.log("triggerRelease",t,e),Array.isArray(t)||(t=[t]),t.forEach(s=>{const i=new we(this.context,s).toMidi();if(this._activeSources.has(i)&&this._activeSources.get(i).length){const o=this._activeSources.get(i);e=this.toSeconds(e),o.forEach(r=>{r.stop(e)}),this._activeSources.set(i,[])}}),this}releaseAll(t){const e=this.toSeconds(t);return this._activeSources.forEach(s=>{for(;s.length;)s.shift().stop(e)}),this}sync(){return this._syncState()&&(this._syncMethod("triggerAttack",1),this._syncMethod("triggerRelease",1)),this}triggerAttackRelease(t,e,s,i=1){const o=this.toSeconds(s);return this.triggerAttack(t,o,i),fe(e)?(mt(fe(t),"notes must be an array when duration is array"),t.forEach((r,u)=>{const p=e[Math.min(u,e.length-1)];this.triggerRelease(r,o+this.toSeconds(p))})):this.triggerRelease(t,o+this.toSeconds(e)),this}add(t,e,s){if(mt(Ai(t)||isFinite(t),`note must be a pitch or midi: ${t}`),Ai(t)){const i=new we(this.context,t).toMidi();this._buffers.add(i,e,s)}else this._buffers.add(t,e,s);return this}get loaded(){return this._buffers.loaded}dispose(){return super.dispose(),this._buffers.dispose(),this._activeSources.forEach(t=>{t.forEach(e=>e.dispose())}),this._activeSources.clear(),this}}Je([fs(0)],Bi.prototype,"attack",void 0),Je([fs(0)],Bi.prototype,"release",void 0);class is extends le{constructor(){const t=Z(is.getDefaults(),arguments,["callback","value"]);super(t),this.name="ToneEvent",this._state=new ii("stopped"),this._startOffset=0,this._loop=t.loop,this.callback=t.callback,this.value=t.value,this._loopStart=this.toTicks(t.loopStart),this._loopEnd=this.toTicks(t.loopEnd),this._playbackRate=t.playbackRate,this._probability=t.probability,this._humanize=t.humanize,this.mute=t.mute,this._playbackRate=t.playbackRate,this._state.increasing=!0,this._rescheduleEvents()}static getDefaults(){return Object.assign(le.getDefaults(),{callback:Ct,humanize:!1,loop:!1,loopEnd:"1m",loopStart:0,mute:!1,playbackRate:1,probability:1,value:null})}_rescheduleEvents(t=-1){this._state.forEachFrom(t,e=>{let s;if(e.state==="started"){e.id!==-1&&this.context.transport.clear(e.id);const i=e.time+Math.round(this.startOffset/this._playbackRate);if(this._loop===!0||Re(this._loop)&&this._loop>1){s=1/0,Re(this._loop)&&(s=this._loop*this._getLoopDuration());const o=this._state.getAfter(i);o!==null&&(s=Math.min(s,o.time-i)),s!==1/0&&(s=new Ht(this.context,s));const r=new Ht(this.context,this._getLoopDuration());e.id=this.context.transport.scheduleRepeat(this._tick.bind(this),r,new Ht(this.context,i),s)}else e.id=this.context.transport.schedule(this._tick.bind(this),new Ht(this.context,i))}})}get state(){return this._state.getValueAtTime(this.context.transport.ticks)}get startOffset(){return this._startOffset}set startOffset(t){this._startOffset=t}get probability(){return this._probability}set probability(t){this._probability=t}get humanize(){return this._humanize}set humanize(t){this._humanize=t}start(t){const e=this.toTicks(t);return this._state.getValueAtTime(e)==="stopped"&&(this._state.add({id:-1,state:"started",time:e}),this._rescheduleEvents(e)),this}stop(t){this.cancel(t);const e=this.toTicks(t);if(this._state.getValueAtTime(e)==="started"){this._state.setStateAtTime("stopped",e,{id:-1});const s=this._state.getBefore(e);let i=e;s!==null&&(i=s.time),this._rescheduleEvents(i)}return this}cancel(t){t=Ge(t,-1/0);const e=this.toTicks(t);return this._state.forEachFrom(e,s=>{this.context.transport.clear(s.id)}),this._state.cancel(e),this}_tick(t){const e=this.context.transport.getTicksAtTime(t);if(!this.mute&&this._state.getValueAtTime(e)==="started"){if(this.probability<1&&Math.random()>this.probability)return;if(this.humanize){let s=.02;ro(this.humanize)||(s=this.toSeconds(this.humanize)),t+=(2*Math.random()-1)*s}this.callback(t,this.value)}}_getLoopDuration(){return(this._loopEnd-this._loopStart)/this._playbackRate}get loop(){return this._loop}set loop(t){this._loop=t,this._rescheduleEvents()}get playbackRate(){return this._playbackRate}set playbackRate(t){this._playbackRate=t,this._rescheduleEvents()}get loopEnd(){return new Ht(this.context,this._loopEnd).toSeconds()}set loopEnd(t){this._loopEnd=this.toTicks(t),this._loop&&this._rescheduleEvents()}get loopStart(){return new Ht(this.context,this._loopStart).toSeconds()}set loopStart(t){this._loopStart=this.toTicks(t),this._loop&&this._rescheduleEvents()}get progress(){if(this._loop){const t=this.context.transport.ticks,e=this._state.get(t);if(e!==null&&e.state==="started"){const s=this._getLoopDuration();return(t-e.time)%s/s}return 0}return 0}dispose(){return super.dispose(),this.cancel(),this._state.dispose(),this}}class ji extends le{constructor(){const t=Z(ji.getDefaults(),arguments,["callback","interval"]);super(t),this.name="Loop",this._event=new is({context:this.context,callback:this._tick.bind(this),loop:!0,loopEnd:t.interval,playbackRate:t.playbackRate,probability:t.probability,humanize:t.humanize}),this.callback=t.callback,this.iterations=t.iterations}static getDefaults(){return Object.assign(le.getDefaults(),{interval:"4n",callback:Ct,playbackRate:1,iterations:1/0,probability:1,mute:!1,humanize:!1})}start(t){return this._event.start(t),this}stop(t){return this._event.stop(t),this}cancel(t){return this._event.cancel(t),this}_tick(t){this.callback(t)}get state(){return this._event.state}get progress(){return this._event.progress}get interval(){return this._event.loopEnd}set interval(t){this._event.loopEnd=t}get playbackRate(){return this._event.playbackRate}set playbackRate(t){this._event.playbackRate=t}get humanize(){return this._event.humanize}set humanize(t){this._event.humanize=t}get probability(){return this._event.probability}set probability(t){this._event.probability=t}get mute(){return this._event.mute}set mute(t){this._event.mute=t}get iterations(){return this._event.loop===!0?1/0:this._event.loop}set iterations(t){this._event.loop=t===1/0||t}dispose(){return super.dispose(),this._event.dispose(),this}}class Wi extends is{constructor(){const t=Z(Wi.getDefaults(),arguments,["callback","events"]);super(t),this.name="Part",this._state=new ii("stopped"),this._events=new Set,this._state.increasing=!0,t.events.forEach(e=>{fe(e)?this.add(e[0],e[1]):this.add(e)})}static getDefaults(){return Object.assign(is.getDefaults(),{events:[]})}start(t,e){const s=this.toTicks(t);if(this._state.getValueAtTime(s)!=="started"){e=Ge(e,this._loop?this._loopStart:0),e=this._loop?Ge(e,this._loopStart):Ge(e,0);const i=this.toTicks(e);this._state.add({id:-1,offset:i,state:"started",time:s}),this._forEach(o=>{this._startNote(o,s,i)})}return this}_startNote(t,e,s){e-=s,this._loop?t.startOffset>=this._loopStart&&t.startOffset<this._loopEnd?(t.startOffset<s&&(e+=this._getLoopDuration()),t.start(new Ht(this.context,e))):t.startOffset<this._loopStart&&t.startOffset>=s&&(t.loop=!1,t.start(new Ht(this.context,e))):t.startOffset>=s&&t.start(new Ht(this.context,e))}get startOffset(){return this._startOffset}set startOffset(t){this._startOffset=t,this._forEach(e=>{e.startOffset+=this._startOffset})}stop(t){const e=this.toTicks(t);return this._state.cancel(e),this._state.setStateAtTime("stopped",e),this._forEach(s=>{s.stop(t)}),this}at(t,e){const s=new oe(this.context,t).toTicks(),i=new Ht(this.context,1).toSeconds(),o=this._events.values();let r=o.next();for(;!r.done;){const u=r.value;if(Math.abs(s-u.startOffset)<i)return Tt(e)&&(u.value=e),u;r=o.next()}return Tt(e)?(this.add(t,e),this.at(t)):null}add(t,e){t instanceof Object&&Reflect.has(t,"time")&&(t=(e=t).time);const s=this.toTicks(t);let i;return e instanceof is?(i=e,i.callback=this._tick.bind(this)):i=new is({callback:this._tick.bind(this),context:this.context,value:e}),i.startOffset=s,i.set({humanize:this.humanize,loop:this.loop,loopEnd:this.loopEnd,loopStart:this.loopStart,playbackRate:this.playbackRate,probability:this.probability}),this._events.add(i),this._restartEvent(i),this}_restartEvent(t){this._state.forEach(e=>{e.state==="started"?this._startNote(t,e.time,e.offset):t.stop(new Ht(this.context,e.time))})}remove(t,e){return hs(t)&&t.hasOwnProperty("time")&&(t=(e=t).time),t=this.toTicks(t),this._events.forEach(s=>{s.startOffset===t&&(Se(e)||Tt(e)&&s.value===e)&&(this._events.delete(s),s.dispose())}),this}clear(){return this._forEach(t=>t.dispose()),this._events.clear(),this}cancel(t){return this._forEach(e=>e.cancel(t)),this._state.cancel(this.toTicks(t)),this}_forEach(t){return this._events&&this._events.forEach(e=>{e instanceof Wi?e._forEach(t):t(e)}),this}_setAll(t,e){this._forEach(s=>{s[t]=e})}_tick(t,e){this.mute||this.callback(t,e)}_testLoopBoundries(t){this._loop&&(t.startOffset<this._loopStart||t.startOffset>=this._loopEnd)?t.cancel(0):t.state==="stopped"&&this._restartEvent(t)}get probability(){return this._probability}set probability(t){this._probability=t,this._setAll("probability",t)}get humanize(){return this._humanize}set humanize(t){this._humanize=t,this._setAll("humanize",t)}get loop(){return this._loop}set loop(t){this._loop=t,this._forEach(e=>{e.loopStart=this.loopStart,e.loopEnd=this.loopEnd,e.loop=t,this._testLoopBoundries(e)})}get loopEnd(){return new Ht(this.context,this._loopEnd).toSeconds()}set loopEnd(t){this._loopEnd=this.toTicks(t),this._loop&&this._forEach(e=>{e.loopEnd=t,this._testLoopBoundries(e)})}get loopStart(){return new Ht(this.context,this._loopStart).toSeconds()}set loopStart(t){this._loopStart=this.toTicks(t),this._loop&&this._forEach(e=>{e.loopStart=this.loopStart,this._testLoopBoundries(e)})}get playbackRate(){return this._playbackRate}set playbackRate(t){this._playbackRate=t,this._setAll("playbackRate",t)}get length(){return this._events.size}dispose(){return super.dispose(),this.clear(),this}}function*cl(n){let t=0;for(;t<n;)t=Ns(t,0,n-1),yield t,t++}function*ll(n){let t=n-1;for(;t>=0;)t=Ns(t,0,n-1),yield t,t--}function*Gi(n,t){for(;;)yield*t(n)}function*qa(n,t){let e=t?0:n-1;for(;;)e=Ns(e,0,n-1),yield e,t?(e++,e>=n-1&&(t=!1)):(e--,e<=0&&(t=!0))}function*ul(n){let t=0,e=0;for(;t<n;)t=Ns(t,0,n-1),yield t,e++,t+=e%2?2:-1}function*dl(n){let t=n-1,e=0;for(;t>=0;)t=Ns(t,0,n-1),yield t,e++,t+=e%2?-2:1}function*pl(n){const t=[];for(let e=0;e<n;e++)t.push(e);for(;t.length>0;)yield Ns(t.splice(Math.floor(t.length*Math.random()),1)[0],0,n-1)}function*Na(n,t="up",e=0){switch(mt(n>=1,"The number of values must be at least one"),t){case"up":yield*Gi(n,cl);case"down":yield*Gi(n,ll);case"upDown":yield*qa(n,!0);case"downUp":yield*qa(n,!1);case"alternateUp":yield*Gi(n,ul);case"alternateDown":yield*Gi(n,dl);case"random":yield*function*(s){for(;;)yield Math.floor(Math.random()*s)}(n);case"randomOnce":yield*Gi(n,pl);case"randomWalk":yield*function*(s){let i=Math.floor(Math.random()*s);for(;;)i===0?i++:i===s-1||Math.random()<.5?i--:i++,yield i}(n)}}class qo extends ji{constructor(){const t=Z(qo.getDefaults(),arguments,["callback","values","pattern"]);super(t),this.name="Pattern",this.callback=t.callback,this._values=t.values,this._pattern=Na(t.values.length,t.pattern),this._type=t.pattern}static getDefaults(){return Object.assign(ji.getDefaults(),{pattern:"up",values:[],callback:Ct})}_tick(t){const e=this._pattern.next();this._index=e.value,this._value=this._values[e.value],this.callback(t,this._value)}get values(){return this._values}set values(t){this._values=t,this.pattern=this._type}get value(){return this._value}get index(){return this._index}get pattern(){return this._type}set pattern(t){this._type=t,this._pattern=Na(this._values.length,this._type)}}class No extends is{constructor(){const t=Z(No.getDefaults(),arguments,["callback","events","subdivision"]);super(t),this.name="Sequence",this._part=new Wi({callback:this._seqCallback.bind(this),context:this.context}),this._events=[],this._eventsArray=[],this._subdivision=this.toTicks(t.subdivision),this.events=t.events,this.loop=t.loop,this.loopStart=t.loopStart,this.loopEnd=t.loopEnd,this.playbackRate=t.playbackRate,this.probability=t.probability,this.humanize=t.humanize,this.mute=t.mute,this.playbackRate=t.playbackRate}static getDefaults(){return Object.assign(ge(is.getDefaults(),["value"]),{events:[],loop:!0,loopEnd:0,loopStart:0,subdivision:"8n"})}_seqCallback(t,e){e===null||this.mute||this.callback(t,e)}get events(){return this._events}set events(t){this.clear(),this._eventsArray=t,this._events=this._createSequence(this._eventsArray),this._eventsUpdated()}start(t,e){return this._part.start(t,e&&this._indexTime(e)),this}stop(t){return this._part.stop(t),this}get subdivision(){return new Ht(this.context,this._subdivision).toSeconds()}_createSequence(t){return new Proxy(t,{get:(e,s)=>e[s],set:(e,s,i)=>(Qe(s)&&isFinite(parseInt(s,10))&&fe(i)?e[s]=this._createSequence(i):e[s]=i,this._eventsUpdated(),!0)})}_eventsUpdated(){this._part.clear(),this._rescheduleSequence(this._eventsArray,this._subdivision,this.startOffset),this.loopEnd=this.loopEnd}_rescheduleSequence(t,e,s){t.forEach((i,o)=>{const r=o*e+s;if(fe(i))this._rescheduleSequence(i,e/i.length,r);else{const u=new Ht(this.context,r,"i").toSeconds();this._part.add(u,i)}})}_indexTime(t){return new Ht(this.context,t*this._subdivision+this.startOffset).toSeconds()}clear(){return this._part.clear(),this}dispose(){return super.dispose(),this._part.dispose(),this}get loop(){return this._part.loop}set loop(t){this._part.loop=t}get loopStart(){return this._loopStart}set loopStart(t){this._loopStart=t,this._part.loopStart=this._indexTime(t)}get loopEnd(){return this._loopEnd}set loopEnd(t){this._loopEnd=t,this._part.loopEnd=t===0?this._indexTime(this._eventsArray.length):this._indexTime(t)}get startOffset(){return this._part.startOffset}set startOffset(t){this._part.startOffset=t}get playbackRate(){return this._part.playbackRate}set playbackRate(t){this._part.playbackRate=t}get probability(){return this._part.probability}set probability(t){this._part.probability=t}get progress(){return this._part.progress}get humanize(){return this._part.humanize}set humanize(t){this._part.humanize=t}get length(){return this._part.length}}class fi extends tt{constructor(){const t=Z(fi.getDefaults(),arguments,["fade"]);super(t),this.name="CrossFade",this._panner=this.context.createStereoPanner(),this._split=this.context.createChannelSplitter(2),this._g2a=new Da({context:this.context}),this.a=new ft({context:this.context,gain:0}),this.b=new ft({context:this.context,gain:0}),this.output=new ft({context:this.context}),this._internalChannels=[this.a,this.b],this.fade=new _t({context:this.context,units:"normalRange",value:t.fade}),gt(this,"fade"),this.context.getConstant(1).connect(this._panner),this._panner.connect(this._split),this._panner.channelCount=1,this._panner.channelCountMode="explicit",Te(this._split,this.a.gain,0),Te(this._split,this.b.gain,1),this.fade.chain(this._g2a,this._panner.pan),this.a.connect(this.output),this.b.connect(this.output)}static getDefaults(){return Object.assign(tt.getDefaults(),{fade:.5})}dispose(){return super.dispose(),this.a.dispose(),this.b.dispose(),this.output.dispose(),this.fade.dispose(),this._g2a.dispose(),this._panner.disconnect(),this._split.disconnect(),this}}class ae extends tt{constructor(t){super(t),this.name="Effect",this._dryWet=new fi({context:this.context}),this.wet=this._dryWet.fade,this.effectSend=new ft({context:this.context}),this.effectReturn=new ft({context:this.context}),this.input=new ft({context:this.context}),this.output=this._dryWet,this.input.fan(this._dryWet.a,this.effectSend),this.effectReturn.connect(this._dryWet.b),this.wet.setValueAtTime(t.wet,0),this._internalChannels=[this.effectReturn,this.effectSend],gt(this,"wet")}static getDefaults(){return Object.assign(tt.getDefaults(),{wet:1})}connectEffect(t){return this._internalChannels.push(t),this.effectSend.chain(t,this.effectReturn),this}dispose(){return super.dispose(),this._dryWet.dispose(),this.effectSend.dispose(),this.effectReturn.dispose(),this.wet.dispose(),this}}class En extends ae{constructor(t){super(t),this.name="LFOEffect",this._lfo=new Ae({context:this.context,frequency:t.frequency,amplitude:t.depth}),this.depth=this._lfo.amplitude,this.frequency=this._lfo.frequency,this.type=t.type,gt(this,["frequency","depth"])}static getDefaults(){return Object.assign(ae.getDefaults(),{frequency:1,type:"sine",depth:1})}start(t){return this._lfo.start(t),this}stop(t){return this._lfo.stop(t),this}sync(){return this._lfo.sync(),this}unsync(){return this._lfo.unsync(),this}get type(){return this._lfo.type}set type(t){this._lfo.type=t}dispose(){return super.dispose(),this._lfo.dispose(),this.frequency.dispose(),this.depth.dispose(),this}}class Fo extends En{constructor(){const t=Z(Fo.getDefaults(),arguments,["frequency","baseFrequency","octaves"]);super(t),this.name="AutoFilter",this.filter=new ze(Object.assign(t.filter,{context:this.context})),this.connectEffect(this.filter),this._lfo.connect(this.filter.frequency),this.octaves=t.octaves,this.baseFrequency=t.baseFrequency}static getDefaults(){return Object.assign(En.getDefaults(),{baseFrequency:200,octaves:2.6,filter:{type:"lowpass",rolloff:-12,Q:1}})}get baseFrequency(){return this._lfo.min}set baseFrequency(t){this._lfo.min=this.toFrequency(t),this.octaves=this._octaves}get octaves(){return this._octaves}set octaves(t){this._octaves=t,this._lfo.max=this._lfo.min*Math.pow(2,t)}dispose(){return super.dispose(),this.filter.dispose(),this}}class Ui extends tt{constructor(){const t=Z(Ui.getDefaults(),arguments,["pan"]);super(t),this.name="Panner",this._panner=this.context.createStereoPanner(),this.input=this._panner,this.output=this._panner,this.pan=new xt({context:this.context,param:this._panner.pan,value:t.pan,minValue:-1,maxValue:1}),this._panner.channelCount=t.channelCount,this._panner.channelCountMode="explicit",gt(this,"pan")}static getDefaults(){return Object.assign(tt.getDefaults(),{pan:0,channelCount:1})}dispose(){return super.dispose(),this._panner.disconnect(),this.pan.dispose(),this}}class Lo extends En{constructor(){const t=Z(Lo.getDefaults(),arguments,["frequency"]);super(t),this.name="AutoPanner",this._panner=new Ui({context:this.context,channelCount:t.channelCount}),this.connectEffect(this._panner),this._lfo.connect(this._panner.pan),this._lfo.min=-1,this._lfo.max=1}static getDefaults(){return Object.assign(En.getDefaults(),{channelCount:1})}dispose(){return super.dispose(),this._panner.dispose(),this}}class Xi extends tt{constructor(){const t=Z(Xi.getDefaults(),arguments,["smoothing"]);super(t),this.name="Follower",this._abs=this.input=new Ma({context:this.context}),this._lowpass=this.output=new Vi({context:this.context,frequency:1/this.toSeconds(t.smoothing),type:"lowpass"}),this._abs.connect(this._lowpass),this._smoothing=t.smoothing}static getDefaults(){return Object.assign(tt.getDefaults(),{smoothing:.05})}get smoothing(){return this._smoothing}set smoothing(t){this._smoothing=t,this._lowpass.frequency=1/this.toSeconds(this.smoothing)}dispose(){return super.dispose(),this._abs.dispose(),this._lowpass.dispose(),this}}class Vo extends ae{constructor(){const t=Z(Vo.getDefaults(),arguments,["baseFrequency","octaves","sensitivity"]);super(t),this.name="AutoWah",this._follower=new Xi({context:this.context,smoothing:t.follower}),this._sweepRange=new Cn({context:this.context,min:0,max:1,exponent:.5}),this._baseFrequency=this.toFrequency(t.baseFrequency),this._octaves=t.octaves,this._inputBoost=new ft({context:this.context}),this._bandpass=new ze({context:this.context,rolloff:-48,frequency:0,Q:t.Q}),this._peaking=new ze({context:this.context,type:"peaking"}),this._peaking.gain.value=t.gain,this.gain=this._peaking.gain,this.Q=this._bandpass.Q,this.effectSend.chain(this._inputBoost,this._follower,this._sweepRange),this._sweepRange.connect(this._bandpass.frequency),this._sweepRange.connect(this._peaking.frequency),this.effectSend.chain(this._bandpass,this._peaking,this.effectReturn),this._setSweepRange(),this.sensitivity=t.sensitivity,gt(this,["gain","Q"])}static getDefaults(){return Object.assign(ae.getDefaults(),{baseFrequency:100,octaves:6,sensitivity:0,Q:2,gain:2,follower:.2})}get octaves(){return this._octaves}set octaves(t){this._octaves=t,this._setSweepRange()}get follower(){return this._follower.smoothing}set follower(t){this._follower.smoothing=t}get baseFrequency(){return this._baseFrequency}set baseFrequency(t){this._baseFrequency=this.toFrequency(t),this._setSweepRange()}get sensitivity(){return Ci(1/this._inputBoost.gain.value)}set sensitivity(t){this._inputBoost.gain.value=1/ei(t)}_setSweepRange(){this._sweepRange.min=this._baseFrequency,this._sweepRange.max=Math.min(this._baseFrequency*Math.pow(2,this._octaves),this.context.sampleRate/2)}dispose(){return super.dispose(),this._follower.dispose(),this._sweepRange.dispose(),this._bandpass.dispose(),this._peaking.dispose(),this._inputBoost.dispose(),this}}const Fa="bit-crusher";Ra(Fa,`
	class BitCrusherWorklet extends SingleIOProcessor {

		static get parameterDescriptors() {
			return [{
				name: "bits",
				defaultValue: 12,
				minValue: 1,
				maxValue: 16,
				automationRate: 'k-rate'
			}];
		}

		generate(input, _channel, parameters) {
			const step = Math.pow(0.5, parameters.bits - 1);
			const val = step * Math.floor(input / step + 0.5);
			return val;
		}
	}
`);class zo extends ae{constructor(){const t=Z(zo.getDefaults(),arguments,["bits"]);super(t),this.name="BitCrusher",this._bitCrusherWorklet=new Bo({context:this.context,bits:t.bits}),this.connectEffect(this._bitCrusherWorklet),this.bits=this._bitCrusherWorklet.bits}static getDefaults(){return Object.assign(ae.getDefaults(),{bits:4})}dispose(){return super.dispose(),this._bitCrusherWorklet.dispose(),this}}class Bo extends Io{constructor(){const t=Z(Bo.getDefaults(),arguments);super(t),this.name="BitCrusherWorklet",this.input=new ft({context:this.context}),this.output=new ft({context:this.context}),this.bits=new xt({context:this.context,value:t.bits,units:"positive",minValue:1,maxValue:16,param:this._dummyParam,swappable:!0})}static getDefaults(){return Object.assign(Io.getDefaults(),{bits:12})}_audioWorkletName(){return Fa}onReady(t){Fe(this.input,t,this.output);const e=t.parameters.get("bits");this.bits.setParam(e)}dispose(){return super.dispose(),this.input.dispose(),this.output.dispose(),this.bits.dispose(),this}}class jo extends ae{constructor(){const t=Z(jo.getDefaults(),arguments,["order"]);super(t),this.name="Chebyshev",this._shaper=new ts({context:this.context,length:4096}),this._order=t.order,this.connectEffect(this._shaper),this.order=t.order,this.oversample=t.oversample}static getDefaults(){return Object.assign(ae.getDefaults(),{order:1,oversample:"none"})}_getCoefficient(t,e,s){return s.has(e)||(e===0?s.set(e,0):e===1?s.set(e,t):s.set(e,2*t*this._getCoefficient(t,e-1,s)-this._getCoefficient(t,e-2,s))),s.get(e)}get order(){return this._order}set order(t){mt(Number.isInteger(t),"'order' must be an integer"),this._order=t,this._shaper.setMap(e=>this._getCoefficient(e,t,new Map))}get oversample(){return this._shaper.oversample}set oversample(t){this._shaper.oversample=t}dispose(){return super.dispose(),this._shaper.dispose(),this}}class Bs extends tt{constructor(){const t=Z(Bs.getDefaults(),arguments,["channels"]);super(t),this.name="Split",this._splitter=this.input=this.output=this.context.createChannelSplitter(t.channels),this._internalChannels=[this._splitter]}static getDefaults(){return Object.assign(tt.getDefaults(),{channels:2})}dispose(){return super.dispose(),this._splitter.disconnect(),this}}class Cs extends tt{constructor(){const t=Z(Cs.getDefaults(),arguments,["channels"]);super(t),this.name="Merge",this._merger=this.output=this.input=this.context.createChannelMerger(t.channels)}static getDefaults(){return Object.assign(tt.getDefaults(),{channels:2})}dispose(){return super.dispose(),this._merger.disconnect(),this}}class ns extends tt{constructor(t){super(t),this.name="StereoEffect",this.input=new ft({context:this.context}),this.input.channelCount=2,this.input.channelCountMode="explicit",this._dryWet=this.output=new fi({context:this.context,fade:t.wet}),this.wet=this._dryWet.fade,this._split=new Bs({context:this.context,channels:2}),this._merge=new Cs({context:this.context,channels:2}),this.input.connect(this._split),this.input.connect(this._dryWet.a),this._merge.connect(this._dryWet.b),gt(this,["wet"])}connectEffectLeft(...t){this._split.connect(t[0],0,0),Fe(...t),Te(t[t.length-1],this._merge,0,0)}connectEffectRight(...t){this._split.connect(t[0],1,0),Fe(...t),Te(t[t.length-1],this._merge,0,1)}static getDefaults(){return Object.assign(tt.getDefaults(),{wet:1})}dispose(){return super.dispose(),this._dryWet.dispose(),this._split.dispose(),this._merge.dispose(),this}}class Wo extends ns{constructor(t){super(t),this.feedback=new _t({context:this.context,value:t.feedback,units:"normalRange"}),this._feedbackL=new ft({context:this.context}),this._feedbackR=new ft({context:this.context}),this._feedbackSplit=new Bs({context:this.context,channels:2}),this._feedbackMerge=new Cs({context:this.context,channels:2}),this._merge.connect(this._feedbackSplit),this._feedbackMerge.connect(this._split),this._feedbackSplit.connect(this._feedbackL,0,0),this._feedbackL.connect(this._feedbackMerge,0,0),this._feedbackSplit.connect(this._feedbackR,1,0),this._feedbackR.connect(this._feedbackMerge,0,1),this.feedback.fan(this._feedbackL.gain,this._feedbackR.gain),gt(this,["feedback"])}static getDefaults(){return Object.assign(ns.getDefaults(),{feedback:.5})}dispose(){return super.dispose(),this.feedback.dispose(),this._feedbackL.dispose(),this._feedbackR.dispose(),this._feedbackSplit.dispose(),this._feedbackMerge.dispose(),this}}class Go extends Wo{constructor(){const t=Z(Go.getDefaults(),arguments,["frequency","delayTime","depth"]);super(t),this.name="Chorus",this._depth=t.depth,this._delayTime=t.delayTime/1e3,this._lfoL=new Ae({context:this.context,frequency:t.frequency,min:0,max:1}),this._lfoR=new Ae({context:this.context,frequency:t.frequency,min:0,max:1,phase:180}),this._delayNodeL=new Le({context:this.context}),this._delayNodeR=new Le({context:this.context}),this.frequency=this._lfoL.frequency,gt(this,["frequency"]),this._lfoL.frequency.connect(this._lfoR.frequency),this.connectEffectLeft(this._delayNodeL),this.connectEffectRight(this._delayNodeR),this._lfoL.connect(this._delayNodeL.delayTime),this._lfoR.connect(this._delayNodeR.delayTime),this.depth=this._depth,this.type=t.type,this.spread=t.spread}static getDefaults(){return Object.assign(Wo.getDefaults(),{frequency:1.5,delayTime:3.5,depth:.7,type:"sine",spread:180,feedback:0,wet:.5})}get depth(){return this._depth}set depth(t){this._depth=t;const e=this._delayTime*t;this._lfoL.min=Math.max(this._delayTime-e,0),this._lfoL.max=this._delayTime+e,this._lfoR.min=Math.max(this._delayTime-e,0),this._lfoR.max=this._delayTime+e}get delayTime(){return 1e3*this._delayTime}set delayTime(t){this._delayTime=t/1e3,this.depth=this._depth}get type(){return this._lfoL.type}set type(t){this._lfoL.type=t,this._lfoR.type=t}get spread(){return this._lfoR.phase-this._lfoL.phase}set spread(t){this._lfoL.phase=90-t/2,this._lfoR.phase=t/2+90}start(t){return this._lfoL.start(t),this._lfoR.start(t),this}stop(t){return this._lfoL.stop(t),this._lfoR.stop(t),this}sync(){return this._lfoL.sync(),this._lfoR.sync(),this}unsync(){return this._lfoL.unsync(),this._lfoR.unsync(),this}dispose(){return super.dispose(),this._lfoL.dispose(),this._lfoR.dispose(),this._delayNodeL.dispose(),this._delayNodeR.dispose(),this.frequency.dispose(),this}}class Uo extends ae{constructor(){const t=Z(Uo.getDefaults(),arguments,["distortion"]);super(t),this.name="Distortion",this._shaper=new ts({context:this.context,length:4096}),this._distortion=t.distortion,this.connectEffect(this._shaper),this.distortion=t.distortion,this.oversample=t.oversample}static getDefaults(){return Object.assign(ae.getDefaults(),{distortion:.4,oversample:"none"})}get distortion(){return this._distortion}set distortion(t){this._distortion=t;const e=100*t,s=Math.PI/180;this._shaper.setMap(i=>Math.abs(i)<.001?0:(3+e)*i*20*s/(Math.PI+e*Math.abs(i)))}get oversample(){return this._shaper.oversample}set oversample(t){this._shaper.oversample=t}dispose(){return super.dispose(),this._shaper.dispose(),this}}class Mn extends ae{constructor(t){super(t),this.name="FeedbackEffect",this._feedbackGain=new ft({context:this.context,gain:t.feedback,units:"normalRange"}),this.feedback=this._feedbackGain.gain,gt(this,"feedback"),this.effectReturn.chain(this._feedbackGain,this.effectSend)}static getDefaults(){return Object.assign(ae.getDefaults(),{feedback:.125})}dispose(){return super.dispose(),this._feedbackGain.dispose(),this.feedback.dispose(),this}}class Xo extends Mn{constructor(){const t=Z(Xo.getDefaults(),arguments,["delayTime","feedback"]);super(t),this.name="FeedbackDelay",this._delayNode=new Le({context:this.context,delayTime:t.delayTime,maxDelay:t.maxDelay}),this.delayTime=this._delayNode.delayTime,this.connectEffect(this._delayNode),gt(this,"delayTime")}static getDefaults(){return Object.assign(Mn.getDefaults(),{delayTime:.25,maxDelay:1})}dispose(){return super.dispose(),this._delayNode.dispose(),this.delayTime.dispose(),this}}class fl extends tt{constructor(t){super(t),this.name="PhaseShiftAllpass",this.input=new ft({context:this.context}),this.output=new ft({context:this.context}),this.offset90=new ft({context:this.context}),this._bank0=this._createAllPassFilterBank([.6923878,.9360654322959,.988229522686,.9987488452737]),this._bank1=this._createAllPassFilterBank([.4021921162426,.856171088242,.9722909545651,.9952884791278]),this._oneSampleDelay=this.context.createIIRFilter([0,1],[1,0]),Fe(this.input,...this._bank0,this._oneSampleDelay,this.output),Fe(this.input,...this._bank1,this.offset90)}_createAllPassFilterBank(t){return t.map(e=>{const s=[[e*e,0,-1],[1,0,-e*e]];return this.context.createIIRFilter(s[0],s[1])})}dispose(){return super.dispose(),this.input.dispose(),this.output.dispose(),this.offset90.dispose(),this._bank0.forEach(t=>t.disconnect()),this._bank1.forEach(t=>t.disconnect()),this._oneSampleDelay.disconnect(),this}}class Yo extends ae{constructor(){const t=Z(Yo.getDefaults(),arguments,["frequency"]);super(t),this.name="FrequencyShifter",this.frequency=new _t({context:this.context,units:"frequency",value:t.frequency,minValue:-this.context.sampleRate/2,maxValue:this.context.sampleRate/2}),this._sine=new Mi({context:this.context,type:"sine"}),this._cosine=new Zt({context:this.context,phase:-90,type:"sine"}),this._sineMultiply=new $t({context:this.context}),this._cosineMultiply=new $t({context:this.context}),this._negate=new Ao({context:this.context}),this._add=new Ls({context:this.context}),this._phaseShifter=new fl({context:this.context}),this.effectSend.connect(this._phaseShifter),this.frequency.fan(this._sine.frequency,this._cosine.frequency),this._phaseShifter.offset90.connect(this._cosineMultiply),this._cosine.connect(this._cosineMultiply.factor),this._phaseShifter.connect(this._sineMultiply),this._sine.connect(this._sineMultiply.factor),this._sineMultiply.connect(this._negate),this._cosineMultiply.connect(this._add),this._negate.connect(this._add.addend),this._add.connect(this.effectReturn);const e=this.immediate();this._sine.start(e),this._cosine.start(e)}static getDefaults(){return Object.assign(ae.getDefaults(),{frequency:0})}dispose(){return super.dispose(),this.frequency.dispose(),this._add.dispose(),this._cosine.dispose(),this._cosineMultiply.dispose(),this._negate.dispose(),this._phaseShifter.dispose(),this._sine.dispose(),this._sineMultiply.dispose(),this}}const La=[1557/44100,1617/44100,1491/44100,1422/44100,1277/44100,1356/44100,1188/44100,1116/44100],Va=[225,556,441,341];class Ho extends ns{constructor(){const t=Z(Ho.getDefaults(),arguments,["roomSize","dampening"]);super(t),this.name="Freeverb",this._combFilters=[],this._allpassFiltersL=[],this._allpassFiltersR=[],this.roomSize=new _t({context:this.context,value:t.roomSize,units:"normalRange"}),this._allpassFiltersL=Va.map(e=>{const s=this.context.createBiquadFilter();return s.type="allpass",s.frequency.value=e,s}),this._allpassFiltersR=Va.map(e=>{const s=this.context.createBiquadFilter();return s.type="allpass",s.frequency.value=e,s}),this._combFilters=La.map((e,s)=>{const i=new zi({context:this.context,dampening:t.dampening,delayTime:e});return s<La.length/2?this.connectEffectLeft(i,...this._allpassFiltersL):this.connectEffectRight(i,...this._allpassFiltersR),this.roomSize.connect(i.resonance),i}),gt(this,["roomSize"])}static getDefaults(){return Object.assign(ns.getDefaults(),{roomSize:.7,dampening:3e3})}get dampening(){return this._combFilters[0].dampening}set dampening(t){this._combFilters.forEach(e=>e.dampening=t)}dispose(){return super.dispose(),this._allpassFiltersL.forEach(t=>t.disconnect()),this._allpassFiltersR.forEach(t=>t.disconnect()),this._combFilters.forEach(t=>t.dispose()),this.roomSize.dispose(),this}}const za=[.06748,.06404,.08212,.09004],ml=[.773,.802,.753,.733],gl=[347,113,37];class Zo extends ns{constructor(){const t=Z(Zo.getDefaults(),arguments,["roomSize"]);super(t),this.name="JCReverb",this._allpassFilters=[],this._feedbackCombFilters=[],this.roomSize=new _t({context:this.context,value:t.roomSize,units:"normalRange"}),this._scaleRoomSize=new ps({context:this.context,min:-.733,max:.197}),this._allpassFilters=gl.map(e=>{const s=this.context.createBiquadFilter();return s.type="allpass",s.frequency.value=e,s}),this._feedbackCombFilters=za.map((e,s)=>{const i=new Li({context:this.context,delayTime:e});return this._scaleRoomSize.connect(i.resonance),i.resonance.value=ml[s],s<za.length/2?this.connectEffectLeft(...this._allpassFilters,i):this.connectEffectRight(...this._allpassFilters,i),i}),this.roomSize.connect(this._scaleRoomSize),gt(this,["roomSize"])}static getDefaults(){return Object.assign(ns.getDefaults(),{roomSize:.5})}dispose(){return super.dispose(),this._allpassFilters.forEach(t=>t.disconnect()),this._feedbackCombFilters.forEach(t=>t.dispose()),this.roomSize.dispose(),this._scaleRoomSize.dispose(),this}}class Ba extends Wo{constructor(t){super(t),this._feedbackL.disconnect(),this._feedbackL.connect(this._feedbackMerge,0,1),this._feedbackR.disconnect(),this._feedbackR.connect(this._feedbackMerge,0,0),gt(this,["feedback"])}}class $o extends Ba{constructor(){const t=Z($o.getDefaults(),arguments,["delayTime","feedback"]);super(t),this.name="PingPongDelay",this._leftDelay=new Le({context:this.context,maxDelay:t.maxDelay}),this._rightDelay=new Le({context:this.context,maxDelay:t.maxDelay}),this._rightPreDelay=new Le({context:this.context,maxDelay:t.maxDelay}),this.delayTime=new _t({context:this.context,units:"time",value:t.delayTime}),this.connectEffectLeft(this._leftDelay),this.connectEffectRight(this._rightPreDelay,this._rightDelay),this.delayTime.fan(this._leftDelay.delayTime,this._rightDelay.delayTime,this._rightPreDelay.delayTime),this._feedbackL.disconnect(),this._feedbackL.connect(this._rightDelay),gt(this,["delayTime"])}static getDefaults(){return Object.assign(Ba.getDefaults(),{delayTime:.25,maxDelay:1})}dispose(){return super.dispose(),this._leftDelay.dispose(),this._rightDelay.dispose(),this._rightPreDelay.dispose(),this.delayTime.dispose(),this}}class Qo extends Mn{constructor(){const t=Z(Qo.getDefaults(),arguments,["pitch"]);super(t),this.name="PitchShift",this._frequency=new _t({context:this.context}),this._delayA=new Le({maxDelay:1,context:this.context}),this._lfoA=new Ae({context:this.context,min:0,max:.1,type:"sawtooth"}).connect(this._delayA.delayTime),this._delayB=new Le({maxDelay:1,context:this.context}),this._lfoB=new Ae({context:this.context,min:0,max:.1,type:"sawtooth",phase:180}).connect(this._delayB.delayTime),this._crossFade=new fi({context:this.context}),this._crossFadeLFO=new Ae({context:this.context,min:0,max:1,type:"triangle",phase:90}).connect(this._crossFade.fade),this._feedbackDelay=new Le({delayTime:t.delayTime,context:this.context}),this.delayTime=this._feedbackDelay.delayTime,gt(this,"delayTime"),this._pitch=t.pitch,this._windowSize=t.windowSize,this._delayA.connect(this._crossFade.a),this._delayB.connect(this._crossFade.b),this._frequency.fan(this._lfoA.frequency,this._lfoB.frequency,this._crossFadeLFO.frequency),this.effectSend.fan(this._delayA,this._delayB),this._crossFade.chain(this._feedbackDelay,this.effectReturn);const e=this.now();this._lfoA.start(e),this._lfoB.start(e),this._crossFadeLFO.start(e),this.windowSize=this._windowSize}static getDefaults(){return Object.assign(Mn.getDefaults(),{pitch:0,windowSize:.1,delayTime:0,feedback:0})}get pitch(){return this._pitch}set pitch(t){this._pitch=t;let e=0;t<0?(this._lfoA.min=0,this._lfoA.max=this._windowSize,this._lfoB.min=0,this._lfoB.max=this._windowSize,e=si(t-1)+1):(this._lfoA.min=this._windowSize,this._lfoA.max=0,this._lfoB.min=this._windowSize,this._lfoB.max=0,e=si(t)-1),this._frequency.value=e*(1.2/this._windowSize)}get windowSize(){return this._windowSize}set windowSize(t){this._windowSize=this.toSeconds(t),this.pitch=this._pitch}dispose(){return super.dispose(),this._frequency.dispose(),this._delayA.dispose(),this._delayB.dispose(),this._lfoA.dispose(),this._lfoB.dispose(),this._crossFade.dispose(),this._crossFadeLFO.dispose(),this._feedbackDelay.dispose(),this}}class Jo extends ns{constructor(){const t=Z(Jo.getDefaults(),arguments,["frequency","octaves","baseFrequency"]);super(t),this.name="Phaser",this._lfoL=new Ae({context:this.context,frequency:t.frequency,min:0,max:1}),this._lfoR=new Ae({context:this.context,frequency:t.frequency,min:0,max:1,phase:180}),this._baseFrequency=this.toFrequency(t.baseFrequency),this._octaves=t.octaves,this.Q=new _t({context:this.context,value:t.Q,units:"positive"}),this._filtersL=this._makeFilters(t.stages,this._lfoL),this._filtersR=this._makeFilters(t.stages,this._lfoR),this.frequency=this._lfoL.frequency,this.frequency.value=t.frequency,this.connectEffectLeft(...this._filtersL),this.connectEffectRight(...this._filtersR),this._lfoL.frequency.connect(this._lfoR.frequency),this.baseFrequency=t.baseFrequency,this.octaves=t.octaves,this._lfoL.start(),this._lfoR.start(),gt(this,["frequency","Q"])}static getDefaults(){return Object.assign(ns.getDefaults(),{frequency:.5,octaves:3,stages:10,Q:10,baseFrequency:350})}_makeFilters(t,e){const s=[];for(let i=0;i<t;i++){const o=this.context.createBiquadFilter();o.type="allpass",this.Q.connect(o.Q),e.connect(o.frequency),s.push(o)}return s}get octaves(){return this._octaves}set octaves(t){this._octaves=t;const e=this._baseFrequency*Math.pow(2,t);this._lfoL.max=e,this._lfoR.max=e}get baseFrequency(){return this._baseFrequency}set baseFrequency(t){this._baseFrequency=this.toFrequency(t),this._lfoL.min=this._baseFrequency,this._lfoR.min=this._baseFrequency,this.octaves=this._octaves}dispose(){return super.dispose(),this.Q.dispose(),this._lfoL.dispose(),this._lfoR.dispose(),this._filtersL.forEach(t=>t.disconnect()),this._filtersR.forEach(t=>t.disconnect()),this.frequency.dispose(),this}}class Ko extends ae{constructor(){const t=Z(Ko.getDefaults(),arguments,["decay"]);super(t),this.name="Reverb",this._convolver=this.context.createConvolver(),this.ready=Promise.resolve(),this._decay=t.decay,this._preDelay=t.preDelay,this.generate(),this.connectEffect(this._convolver)}static getDefaults(){return Object.assign(ae.getDefaults(),{decay:1.5,preDelay:.01})}get decay(){return this._decay}set decay(t){me(t=this.toSeconds(t),.001),this._decay=t,this.generate()}get preDelay(){return this._preDelay}set preDelay(t){me(t=this.toSeconds(t),0),this._preDelay=t,this.generate()}generate(){return Lt(this,void 0,void 0,function*(){const t=this.ready,e=new ti(2,this._decay+this._preDelay,this.context.sampleRate),s=new ks({context:e}),i=new ks({context:e}),o=new Cs({context:e});s.connect(o,0,0),i.connect(o,0,1);const r=new ft({context:e}).toDestination();o.connect(r),s.start(0),i.start(0),r.gain.setValueAtTime(0,0),r.gain.setValueAtTime(1,this._preDelay),r.gain.exponentialApproachValueAtTime(0,this._preDelay,this.decay);const u=e.render();return this.ready=u.then(Ct),yield t,this._convolver.buffer=(yield u).get(),this})}dispose(){return super.dispose(),this._convolver.disconnect(),this}}class Yi extends tt{constructor(){super(Z(Yi.getDefaults(),arguments)),this.name="MidSideSplit",this._split=this.input=new Bs({channels:2,context:this.context}),this._midAdd=new Ls({context:this.context}),this.mid=new $t({context:this.context,value:Math.SQRT1_2}),this._sideSubtract=new Vs({context:this.context}),this.side=new $t({context:this.context,value:Math.SQRT1_2}),this._split.connect(this._midAdd,0),this._split.connect(this._midAdd.addend,1),this._split.connect(this._sideSubtract,0),this._split.connect(this._sideSubtract.subtrahend,1),this._midAdd.connect(this.mid),this._sideSubtract.connect(this.side)}dispose(){return super.dispose(),this.mid.dispose(),this.side.dispose(),this._midAdd.dispose(),this._sideSubtract.dispose(),this._split.dispose(),this}}class Hi extends tt{constructor(){super(Z(Hi.getDefaults(),arguments)),this.name="MidSideMerge",this.mid=new ft({context:this.context}),this.side=new ft({context:this.context}),this._left=new Ls({context:this.context}),this._leftMult=new $t({context:this.context,value:Math.SQRT1_2}),this._right=new Vs({context:this.context}),this._rightMult=new $t({context:this.context,value:Math.SQRT1_2}),this._merge=this.output=new Cs({context:this.context}),this.mid.fan(this._left),this.side.connect(this._left.addend),this.mid.connect(this._right),this.side.connect(this._right.subtrahend),this._left.connect(this._leftMult),this._right.connect(this._rightMult),this._leftMult.connect(this._merge,0,0),this._rightMult.connect(this._merge,0,1)}dispose(){return super.dispose(),this.mid.dispose(),this.side.dispose(),this._leftMult.dispose(),this._rightMult.dispose(),this._left.dispose(),this._right.dispose(),this}}class ja extends ae{constructor(t){super(t),this.name="MidSideEffect",this._midSideMerge=new Hi({context:this.context}),this._midSideSplit=new Yi({context:this.context}),this._midSend=this._midSideSplit.mid,this._sideSend=this._midSideSplit.side,this._midReturn=this._midSideMerge.mid,this._sideReturn=this._midSideMerge.side,this.effectSend.connect(this._midSideSplit),this._midSideMerge.connect(this.effectReturn)}connectEffectMid(...t){this._midSend.chain(...t,this._midReturn)}connectEffectSide(...t){this._sideSend.chain(...t,this._sideReturn)}dispose(){return super.dispose(),this._midSideSplit.dispose(),this._midSideMerge.dispose(),this._midSend.dispose(),this._sideSend.dispose(),this._midReturn.dispose(),this._sideReturn.dispose(),this}}class tr extends ja{constructor(){const t=Z(tr.getDefaults(),arguments,["width"]);super(t),this.name="StereoWidener",this.width=new _t({context:this.context,value:t.width,units:"normalRange"}),gt(this,["width"]),this._twoTimesWidthMid=new $t({context:this.context,value:2}),this._twoTimesWidthSide=new $t({context:this.context,value:2}),this._midMult=new $t({context:this.context}),this._twoTimesWidthMid.connect(this._midMult.factor),this.connectEffectMid(this._midMult),this._oneMinusWidth=new Vs({context:this.context}),this._oneMinusWidth.connect(this._twoTimesWidthMid),Te(this.context.getConstant(1),this._oneMinusWidth),this.width.connect(this._oneMinusWidth.subtrahend),this._sideMult=new $t({context:this.context}),this.width.connect(this._twoTimesWidthSide),this._twoTimesWidthSide.connect(this._sideMult.factor),this.connectEffectSide(this._sideMult)}static getDefaults(){return Object.assign(ja.getDefaults(),{width:.5})}dispose(){return super.dispose(),this.width.dispose(),this._midMult.dispose(),this._sideMult.dispose(),this._twoTimesWidthMid.dispose(),this._twoTimesWidthSide.dispose(),this._oneMinusWidth.dispose(),this}}class er extends ns{constructor(){const t=Z(er.getDefaults(),arguments,["frequency","depth"]);super(t),this.name="Tremolo",this._lfoL=new Ae({context:this.context,type:t.type,min:1,max:0}),this._lfoR=new Ae({context:this.context,type:t.type,min:1,max:0}),this._amplitudeL=new ft({context:this.context}),this._amplitudeR=new ft({context:this.context}),this.frequency=new _t({context:this.context,value:t.frequency,units:"frequency"}),this.depth=new _t({context:this.context,value:t.depth,units:"normalRange"}),gt(this,["frequency","depth"]),this.connectEffectLeft(this._amplitudeL),this.connectEffectRight(this._amplitudeR),this._lfoL.connect(this._amplitudeL.gain),this._lfoR.connect(this._amplitudeR.gain),this.frequency.fan(this._lfoL.frequency,this._lfoR.frequency),this.depth.fan(this._lfoR.amplitude,this._lfoL.amplitude),this.spread=t.spread}static getDefaults(){return Object.assign(ns.getDefaults(),{frequency:10,type:"sine",depth:.5,spread:180})}start(t){return this._lfoL.start(t),this._lfoR.start(t),this}stop(t){return this._lfoL.stop(t),this._lfoR.stop(t),this}sync(){return this._lfoL.sync(),this._lfoR.sync(),this.context.transport.syncSignal(this.frequency),this}unsync(){return this._lfoL.unsync(),this._lfoR.unsync(),this.context.transport.unsyncSignal(this.frequency),this}get type(){return this._lfoL.type}set type(t){this._lfoL.type=t,this._lfoR.type=t}get spread(){return this._lfoR.phase-this._lfoL.phase}set spread(t){this._lfoL.phase=90-t/2,this._lfoR.phase=t/2+90}dispose(){return super.dispose(),this._lfoL.dispose(),this._lfoR.dispose(),this._amplitudeL.dispose(),this._amplitudeR.dispose(),this.frequency.dispose(),this.depth.dispose(),this}}class sr extends ae{constructor(){const t=Z(sr.getDefaults(),arguments,["frequency","depth"]);super(t),this.name="Vibrato",this._delayNode=new Le({context:this.context,delayTime:0,maxDelay:t.maxDelay}),this._lfo=new Ae({context:this.context,type:t.type,min:0,max:t.maxDelay,frequency:t.frequency,phase:-90}).start().connect(this._delayNode.delayTime),this.frequency=this._lfo.frequency,this.depth=this._lfo.amplitude,this.depth.value=t.depth,gt(this,["frequency","depth"]),this.effectSend.chain(this._delayNode,this.effectReturn)}static getDefaults(){return Object.assign(ae.getDefaults(),{maxDelay:.005,frequency:5,depth:.1,type:"sine"})}get type(){return this._lfo.type}set type(t){this._lfo.type=t}dispose(){return super.dispose(),this._delayNode.dispose(),this._lfo.dispose(),this.frequency.dispose(),this.depth.dispose(),this}}class Zi extends tt{constructor(){const t=Z(Zi.getDefaults(),arguments,["type","size"]);super(t),this.name="Analyser",this._analysers=[],this._buffers=[],this.input=this.output=this._gain=new ft({context:this.context}),this._split=new Bs({context:this.context,channels:t.channels}),this.input.connect(this._split),me(t.channels,1);for(let e=0;e<t.channels;e++)this._analysers[e]=this.context.createAnalyser(),this._split.connect(this._analysers[e],e,0);this.size=t.size,this.type=t.type,this.smoothing=t.smoothing}static getDefaults(){return Object.assign(tt.getDefaults(),{size:1024,smoothing:.8,type:"fft",channels:1})}getValue(){return this._analysers.forEach((t,e)=>{const s=this._buffers[e];this._type==="fft"?t.getFloatFrequencyData(s):this._type==="waveform"&&t.getFloatTimeDomainData(s)}),this.channels===1?this._buffers[0]:this._buffers}get size(){return this._analysers[0].frequencyBinCount}set size(t){this._analysers.forEach((e,s)=>{e.fftSize=2*t,this._buffers[s]=new Float32Array(t)})}get channels(){return this._analysers.length}get type(){return this._type}set type(t){mt(t==="waveform"||t==="fft",`Analyser: invalid type: ${t}`),this._type=t}get smoothing(){return this._analysers[0].smoothingTimeConstant}set smoothing(t){this._analysers.forEach(e=>e.smoothingTimeConstant=t)}dispose(){return super.dispose(),this._analysers.forEach(t=>t.disconnect()),this._split.dispose(),this._gain.dispose(),this}}class Os extends tt{constructor(){super(Z(Os.getDefaults(),arguments)),this.name="MeterBase",this.input=this.output=this._analyser=new Zi({context:this.context,size:256,type:"waveform"})}dispose(){return super.dispose(),this._analyser.dispose(),this}}class ir extends Os{constructor(){const t=Z(ir.getDefaults(),arguments,["smoothing"]);super(t),this.name="Meter",this.input=this.output=this._analyser=new Zi({context:this.context,size:256,type:"waveform",channels:t.channelCount}),this.smoothing=t.smoothing,this.normalRange=t.normalRange,this._rms=new Array(t.channelCount),this._rms.fill(0)}static getDefaults(){return Object.assign(Os.getDefaults(),{smoothing:.8,normalRange:!1,channelCount:1})}getLevel(){return Zs("'getLevel' has been changed to 'getValue'"),this.getValue()}getValue(){const t=this._analyser.getValue(),e=(this.channels===1?[t]:t).map((s,i)=>{const o=s.reduce((u,p)=>u+p*p,0),r=Math.sqrt(o/s.length);return this._rms[i]=Math.max(r,this._rms[i]*this.smoothing),this.normalRange?this._rms[i]:Ci(this._rms[i])});return this.channels===1?e[0]:e}get channels(){return this._analyser.channels}dispose(){return super.dispose(),this._analyser.dispose(),this}}class nr extends Os{constructor(){const t=Z(nr.getDefaults(),arguments,["size"]);super(t),this.name="FFT",this.normalRange=t.normalRange,this._analyser.type="fft",this.size=t.size}static getDefaults(){return Object.assign(tt.getDefaults(),{normalRange:!1,size:1024,smoothing:.8})}getValue(){return this._analyser.getValue().map(t=>this.normalRange?ei(t):t)}get size(){return this._analyser.size}set size(t){this._analyser.size=t}get smoothing(){return this._analyser.smoothing}set smoothing(t){this._analyser.smoothing=t}getFrequencyOfIndex(t){return mt(0<=t&&t<this.size,`index must be greater than or equal to 0 and less than ${this.size}`),t*this.context.sampleRate/(2*this.size)}}class or extends Os{constructor(){super(Z(or.getDefaults(),arguments)),this.name="DCMeter",this._analyser.type="waveform",this._analyser.size=256}getValue(){return this._analyser.getValue()[0]}}class rr extends Os{constructor(){const t=Z(rr.getDefaults(),arguments,["size"]);super(t),this.name="Waveform",this._analyser.type="waveform",this.size=t.size}static getDefaults(){return Object.assign(Os.getDefaults(),{size:1024})}getValue(){return this._analyser.getValue()}get size(){return this._analyser.size}set size(t){this._analyser.size=t}}class ie extends tt{constructor(){const t=Z(ie.getDefaults(),arguments,["solo"]);super(t),this.name="Solo",this.input=this.output=new ft({context:this.context}),ie._allSolos.has(this.context)||ie._allSolos.set(this.context,new Set),ie._allSolos.get(this.context).add(this),this.solo=t.solo}static getDefaults(){return Object.assign(tt.getDefaults(),{solo:!1})}get solo(){return this._isSoloed()}set solo(t){t?this._addSolo():this._removeSolo(),ie._allSolos.get(this.context).forEach(e=>e._updateSolo())}get muted(){return this.input.gain.value===0}_addSolo(){ie._soloed.has(this.context)||ie._soloed.set(this.context,new Set),ie._soloed.get(this.context).add(this)}_removeSolo(){ie._soloed.has(this.context)&&ie._soloed.get(this.context).delete(this)}_isSoloed(){return ie._soloed.has(this.context)&&ie._soloed.get(this.context).has(this)}_noSolos(){return!ie._soloed.has(this.context)||ie._soloed.has(this.context)&&ie._soloed.get(this.context).size===0}_updateSolo(){this._isSoloed()||this._noSolos()?this.input.gain.value=1:this.input.gain.value=0}dispose(){return super.dispose(),ie._allSolos.get(this.context).delete(this),this._removeSolo(),this}}ie._allSolos=new Map,ie._soloed=new Map;class Dn extends tt{constructor(){const t=Z(Dn.getDefaults(),arguments,["pan","volume"]);super(t),this.name="PanVol",this._panner=this.input=new Ui({context:this.context,pan:t.pan,channelCount:t.channelCount}),this.pan=this._panner.pan,this._volume=this.output=new ls({context:this.context,volume:t.volume}),this.volume=this._volume.volume,this._panner.connect(this._volume),this.mute=t.mute,gt(this,["pan","volume"])}static getDefaults(){return Object.assign(tt.getDefaults(),{mute:!1,pan:0,volume:0,channelCount:1})}get mute(){return this._volume.mute}set mute(t){this._volume.mute=t}dispose(){return super.dispose(),this._panner.dispose(),this.pan.dispose(),this._volume.dispose(),this.volume.dispose(),this}}class js extends tt{constructor(){const t=Z(js.getDefaults(),arguments,["volume","pan"]);super(t),this.name="Channel",this._solo=this.input=new ie({solo:t.solo,context:this.context}),this._panVol=this.output=new Dn({context:this.context,pan:t.pan,volume:t.volume,mute:t.mute,channelCount:t.channelCount}),this.pan=this._panVol.pan,this.volume=this._panVol.volume,this._solo.connect(this._panVol),gt(this,["pan","volume"])}static getDefaults(){return Object.assign(tt.getDefaults(),{pan:0,volume:0,mute:!1,solo:!1,channelCount:1})}get solo(){return this._solo.solo}set solo(t){this._solo.solo=t}get muted(){return this._solo.muted||this.mute}get mute(){return this._panVol.mute}set mute(t){this._panVol.mute=t}_getBus(t){return js.buses.has(t)||js.buses.set(t,new ft({context:this.context})),js.buses.get(t)}send(t,e=0){const s=this._getBus(t),i=new ft({context:this.context,units:"decibels",gain:e});return this.connect(i),i.connect(s),i}receive(t){return this._getBus(t).connect(this),this}dispose(){return super.dispose(),this._panVol.dispose(),this.pan.dispose(),this.volume.dispose(),this._solo.dispose(),this}}js.buses=new Map;class ar extends tt{constructor(){super(Z(ar.getDefaults(),arguments)),this.name="Mono",this.input=new ft({context:this.context}),this._merge=this.output=new Cs({channels:2,context:this.context}),this.input.connect(this._merge,0,0),this.input.connect(this._merge,0,1)}dispose(){return super.dispose(),this._merge.dispose(),this.input.dispose(),this}}class $i extends tt{constructor(){const t=Z($i.getDefaults(),arguments,["lowFrequency","highFrequency"]);super(t),this.name="MultibandSplit",this.input=new ft({context:this.context}),this.output=void 0,this.low=new ze({context:this.context,frequency:0,type:"lowpass"}),this._lowMidFilter=new ze({context:this.context,frequency:0,type:"highpass"}),this.mid=new ze({context:this.context,frequency:0,type:"lowpass"}),this.high=new ze({context:this.context,frequency:0,type:"highpass"}),this._internalChannels=[this.low,this.mid,this.high],this.lowFrequency=new _t({context:this.context,units:"frequency",value:t.lowFrequency}),this.highFrequency=new _t({context:this.context,units:"frequency",value:t.highFrequency}),this.Q=new _t({context:this.context,units:"positive",value:t.Q}),this.input.fan(this.low,this.high),this.input.chain(this._lowMidFilter,this.mid),this.lowFrequency.fan(this.low.frequency,this._lowMidFilter.frequency),this.highFrequency.fan(this.mid.frequency,this.high.frequency),this.Q.connect(this.low.Q),this.Q.connect(this._lowMidFilter.Q),this.Q.connect(this.mid.Q),this.Q.connect(this.high.Q),gt(this,["high","mid","low","highFrequency","lowFrequency"])}static getDefaults(){return Object.assign(tt.getDefaults(),{Q:1,highFrequency:2500,lowFrequency:400})}dispose(){return super.dispose(),ki(this,["high","mid","low","highFrequency","lowFrequency"]),this.low.dispose(),this._lowMidFilter.dispose(),this.mid.dispose(),this.high.dispose(),this.lowFrequency.dispose(),this.highFrequency.dispose(),this.Q.dispose(),this}}class hr extends tt{constructor(){const t=Z(hr.getDefaults(),arguments,["positionX","positionY","positionZ"]);super(t),this.name="Panner3D",this._panner=this.input=this.output=this.context.createPanner(),this.panningModel=t.panningModel,this.maxDistance=t.maxDistance,this.distanceModel=t.distanceModel,this.coneOuterGain=t.coneOuterGain,this.coneOuterAngle=t.coneOuterAngle,this.coneInnerAngle=t.coneInnerAngle,this.refDistance=t.refDistance,this.rolloffFactor=t.rolloffFactor,this.positionX=new xt({context:this.context,param:this._panner.positionX,value:t.positionX}),this.positionY=new xt({context:this.context,param:this._panner.positionY,value:t.positionY}),this.positionZ=new xt({context:this.context,param:this._panner.positionZ,value:t.positionZ}),this.orientationX=new xt({context:this.context,param:this._panner.orientationX,value:t.orientationX}),this.orientationY=new xt({context:this.context,param:this._panner.orientationY,value:t.orientationY}),this.orientationZ=new xt({context:this.context,param:this._panner.orientationZ,value:t.orientationZ})}static getDefaults(){return Object.assign(tt.getDefaults(),{coneInnerAngle:360,coneOuterAngle:360,coneOuterGain:0,distanceModel:"inverse",maxDistance:1e4,orientationX:0,orientationY:0,orientationZ:0,panningModel:"equalpower",positionX:0,positionY:0,positionZ:0,refDistance:1,rolloffFactor:1})}setPosition(t,e,s){return this.positionX.value=t,this.positionY.value=e,this.positionZ.value=s,this}setOrientation(t,e,s){return this.orientationX.value=t,this.orientationY.value=e,this.orientationZ.value=s,this}get panningModel(){return this._panner.panningModel}set panningModel(t){this._panner.panningModel=t}get refDistance(){return this._panner.refDistance}set refDistance(t){this._panner.refDistance=t}get rolloffFactor(){return this._panner.rolloffFactor}set rolloffFactor(t){this._panner.rolloffFactor=t}get distanceModel(){return this._panner.distanceModel}set distanceModel(t){this._panner.distanceModel=t}get coneInnerAngle(){return this._panner.coneInnerAngle}set coneInnerAngle(t){this._panner.coneInnerAngle=t}get coneOuterAngle(){return this._panner.coneOuterAngle}set coneOuterAngle(t){this._panner.coneOuterAngle=t}get coneOuterGain(){return this._panner.coneOuterGain}set coneOuterGain(t){this._panner.coneOuterGain=t}get maxDistance(){return this._panner.maxDistance}set maxDistance(t){this._panner.maxDistance=t}dispose(){return super.dispose(),this._panner.disconnect(),this.orientationX.dispose(),this.orientationY.dispose(),this.orientationZ.dispose(),this.positionX.dispose(),this.positionY.dispose(),this.positionZ.dispose(),this}}class In extends tt{constructor(){const t=Z(In.getDefaults(),arguments);super(t),this.name="Recorder",this.input=new ft({context:this.context}),mt(In.supported,"Media Recorder API is not available"),this._stream=this.context.createMediaStreamDestination(),this.input.connect(this._stream),this._recorder=new MediaRecorder(this._stream.stream,{mimeType:t.mimeType})}static getDefaults(){return tt.getDefaults()}get mimeType(){return this._recorder.mimeType}static get supported(){return Pe!==null&&Reflect.has(Pe,"MediaRecorder")}get state(){return this._recorder.state==="inactive"?"stopped":this._recorder.state==="paused"?"paused":"started"}start(){return Lt(this,void 0,void 0,function*(){mt(this.state!=="started","Recorder is already started");const t=new Promise(e=>{const s=()=>{this._recorder.removeEventListener("start",s,!1),e()};this._recorder.addEventListener("start",s,!1)});return this._recorder.start(),yield t})}stop(){return Lt(this,void 0,void 0,function*(){mt(this.state!=="stopped","Recorder is not started");const t=new Promise(e=>{const s=i=>{this._recorder.removeEventListener("dataavailable",s,!1),e(i.data)};this._recorder.addEventListener("dataavailable",s,!1)});return this._recorder.stop(),yield t})}pause(){return mt(this.state==="started","Recorder must be started"),this._recorder.pause(),this}dispose(){return super.dispose(),this.input.dispose(),this._stream.disconnect(),this}}class ms extends tt{constructor(){const t=Z(ms.getDefaults(),arguments,["threshold","ratio"]);super(t),this.name="Compressor",this._compressor=this.context.createDynamicsCompressor(),this.input=this._compressor,this.output=this._compressor,this.threshold=new xt({minValue:this._compressor.threshold.minValue,maxValue:this._compressor.threshold.maxValue,context:this.context,convert:!1,param:this._compressor.threshold,units:"decibels",value:t.threshold}),this.attack=new xt({minValue:this._compressor.attack.minValue,maxValue:this._compressor.attack.maxValue,context:this.context,param:this._compressor.attack,units:"time",value:t.attack}),this.release=new xt({minValue:this._compressor.release.minValue,maxValue:this._compressor.release.maxValue,context:this.context,param:this._compressor.release,units:"time",value:t.release}),this.knee=new xt({minValue:this._compressor.knee.minValue,maxValue:this._compressor.knee.maxValue,context:this.context,convert:!1,param:this._compressor.knee,units:"decibels",value:t.knee}),this.ratio=new xt({minValue:this._compressor.ratio.minValue,maxValue:this._compressor.ratio.maxValue,context:this.context,convert:!1,param:this._compressor.ratio,units:"positive",value:t.ratio}),gt(this,["knee","release","attack","ratio","threshold"])}static getDefaults(){return Object.assign(tt.getDefaults(),{attack:.003,knee:30,ratio:12,release:.25,threshold:-24})}get reduction(){return this._compressor.reduction}dispose(){return super.dispose(),this._compressor.disconnect(),this.attack.dispose(),this.release.dispose(),this.threshold.dispose(),this.ratio.dispose(),this.knee.dispose(),this}}class cr extends tt{constructor(){const t=Z(cr.getDefaults(),arguments,["threshold","smoothing"]);super(t),this.name="Gate",this._follower=new Xi({context:this.context,smoothing:t.smoothing}),this._gt=new Sn({context:this.context,value:ei(t.threshold)}),this.input=new ft({context:this.context}),this._gate=this.output=new ft({context:this.context}),this.input.connect(this._gate),this.input.chain(this._follower,this._gt,this._gate.gain)}static getDefaults(){return Object.assign(tt.getDefaults(),{smoothing:.1,threshold:-40})}get threshold(){return Ci(this._gt.value)}set threshold(t){this._gt.value=ei(t)}get smoothing(){return this._follower.smoothing}set smoothing(t){this._follower.smoothing=t}dispose(){return super.dispose(),this.input.dispose(),this._follower.dispose(),this._gt.dispose(),this._gate.dispose(),this}}class lr extends tt{constructor(){const t=Z(lr.getDefaults(),arguments,["threshold"]);super(t),this.name="Limiter",this._compressor=this.input=this.output=new ms({context:this.context,ratio:20,attack:.003,release:.01,threshold:t.threshold}),this.threshold=this._compressor.threshold,gt(this,"threshold")}static getDefaults(){return Object.assign(tt.getDefaults(),{threshold:-12})}get reduction(){return this._compressor.reduction}dispose(){return super.dispose(),this._compressor.dispose(),this.threshold.dispose(),this}}class ur extends tt{constructor(){const t=Z(ur.getDefaults(),arguments);super(t),this.name="MidSideCompressor",this._midSideSplit=this.input=new Yi({context:this.context}),this._midSideMerge=this.output=new Hi({context:this.context}),this.mid=new ms(Object.assign(t.mid,{context:this.context})),this.side=new ms(Object.assign(t.side,{context:this.context})),this._midSideSplit.mid.chain(this.mid,this._midSideMerge.mid),this._midSideSplit.side.chain(this.side,this._midSideMerge.side),gt(this,["mid","side"])}static getDefaults(){return Object.assign(tt.getDefaults(),{mid:{ratio:3,threshold:-24,release:.03,attack:.02,knee:16},side:{ratio:6,threshold:-30,release:.25,attack:.03,knee:10}})}dispose(){return super.dispose(),this.mid.dispose(),this.side.dispose(),this._midSideSplit.dispose(),this._midSideMerge.dispose(),this}}class dr extends tt{constructor(){const t=Z(dr.getDefaults(),arguments);super(t),this.name="MultibandCompressor",this._splitter=this.input=new $i({context:this.context,lowFrequency:t.lowFrequency,highFrequency:t.highFrequency}),this.lowFrequency=this._splitter.lowFrequency,this.highFrequency=this._splitter.highFrequency,this.output=new ft({context:this.context}),this.low=new ms(Object.assign(t.low,{context:this.context})),this.mid=new ms(Object.assign(t.mid,{context:this.context})),this.high=new ms(Object.assign(t.high,{context:this.context})),this._splitter.low.chain(this.low,this.output),this._splitter.mid.chain(this.mid,this.output),this._splitter.high.chain(this.high,this.output),gt(this,["high","mid","low","highFrequency","lowFrequency"])}static getDefaults(){return Object.assign(tt.getDefaults(),{lowFrequency:250,highFrequency:2e3,low:{ratio:6,threshold:-30,release:.25,attack:.03,knee:10},mid:{ratio:3,threshold:-24,release:.03,attack:.02,knee:16},high:{ratio:3,threshold:-24,release:.03,attack:.02,knee:16}})}dispose(){return super.dispose(),this._splitter.dispose(),this.low.dispose(),this.mid.dispose(),this.high.dispose(),this.output.dispose(),this}}class pr extends tt{constructor(){const t=Z(pr.getDefaults(),arguments,["low","mid","high"]);super(t),this.name="EQ3",this.output=new ft({context:this.context}),this._internalChannels=[],this.input=this._multibandSplit=new $i({context:this.context,highFrequency:t.highFrequency,lowFrequency:t.lowFrequency}),this._lowGain=new ft({context:this.context,gain:t.low,units:"decibels"}),this._midGain=new ft({context:this.context,gain:t.mid,units:"decibels"}),this._highGain=new ft({context:this.context,gain:t.high,units:"decibels"}),this.low=this._lowGain.gain,this.mid=this._midGain.gain,this.high=this._highGain.gain,this.Q=this._multibandSplit.Q,this.lowFrequency=this._multibandSplit.lowFrequency,this.highFrequency=this._multibandSplit.highFrequency,this._multibandSplit.low.chain(this._lowGain,this.output),this._multibandSplit.mid.chain(this._midGain,this.output),this._multibandSplit.high.chain(this._highGain,this.output),gt(this,["low","mid","high","lowFrequency","highFrequency"]),this._internalChannels=[this._multibandSplit]}static getDefaults(){return Object.assign(tt.getDefaults(),{high:0,highFrequency:2500,low:0,lowFrequency:400,mid:0})}dispose(){return super.dispose(),ki(this,["low","mid","high","lowFrequency","highFrequency"]),this._multibandSplit.dispose(),this.lowFrequency.dispose(),this.highFrequency.dispose(),this._lowGain.dispose(),this._midGain.dispose(),this._highGain.dispose(),this.low.dispose(),this.mid.dispose(),this.high.dispose(),this.Q.dispose(),this}}class fr extends tt{constructor(){const t=Z(fr.getDefaults(),arguments,["url","onload"]);super(t),this.name="Convolver",this._convolver=this.context.createConvolver(),this._buffer=new Mt(t.url,e=>{this.buffer=e,t.onload()}),this.input=new ft({context:this.context}),this.output=new ft({context:this.context}),this._buffer.loaded&&(this.buffer=this._buffer),this.normalize=t.normalize,this.input.chain(this._convolver,this.output)}static getDefaults(){return Object.assign(tt.getDefaults(),{normalize:!0,onload:Ct})}load(t){return Lt(this,void 0,void 0,function*(){this.buffer=yield this._buffer.load(t)})}get buffer(){return this._buffer.length?this._buffer:null}set buffer(t){t&&this._buffer.set(t),this._convolver.buffer&&(this.input.disconnect(),this._convolver.disconnect(),this._convolver=this.context.createConvolver(),this.input.chain(this._convolver,this.output));const e=this._buffer.get();this._convolver.buffer=e||null}get normalize(){return this._convolver.normalize}set normalize(t){this._convolver.normalize=t}dispose(){return super.dispose(),this._buffer.dispose(),this._convolver.disconnect(),this}}function vl(){return Wt().now()}function _l(){return Wt().immediate()}const yl=Wt().transport;function xl(){return Wt().transport}const bl=Wt().destination,wl=Wt().destination;function Tl(){return Wt().destination}const Al=Wt().listener;function kl(){return Wt().listener}const Sl=Wt().draw;function Cl(){return Wt().draw}const Ol=Wt();function El(){return Mt.loaded()}const Ml=Mt,Dl=ri,Il=As})(),C})())}(Fn)),Fn.exports}var Pt=Nl();console.log("Store: Module loaded");const Qi={},U={state:{placedNotes:[],macrobeatGroupings:Array(19).fill(2),macrobeatBoundaryStyles:Array(19).fill(!1),timeSignatureToggleStates:{},fullRowData:[],selectedTool:{type:"circle",color:"#000000",tonicNumber:null},gridPosition:34,visualRows:10,logicRows:20,cellWidth:0,cellHeight:0,columnWidths:[],isPlaying:!1,isPaused:!1,isLooping:!1,tempo:120,harmonicLevels:[1,.5,.333,.25,.2,.167,.143,.125,.111,.1,.1],adsr:{attack:.1,decay:.2,sustain:.8,release:.3}},addNote(A){console.log("Store: addNote action called",A),this.state.placedNotes.push(A),this.emit("notesChanged")},updateNoteTail(A,N){console.log(`Store: updateNoteTail action called for note, new end: ${N}`),A.endColumnIndex=N,this.emit("notesChanged")},eraseNoteAt(A,N){console.log(`Store: eraseNoteAt action called for col:${A}, row:${N}`);const D=this.state.placedNotes.length;this.state.placedNotes=this.state.placedNotes.filter(P=>!(!P.isDrum&&P.row===N&&A>=P.startColumnIndex&&A<=P.endColumnIndex)),this.state.placedNotes.length<D&&this.emit("notesChanged")},toggleDrumNote(A){console.log("Store: toggleDrumNote action called",A);const N=this.state.placedNotes.findIndex(D=>D.isDrum&&D.drumTrack===A.drumTrack&&D.startColumnIndex===A.startColumnIndex);N>=0?this.state.placedNotes.splice(N,1):this.state.placedNotes.push(A),this.emit("notesChanged")},clearAllNotes(){console.log("Store: clearAllNotes action called"),this.state.placedNotes=[],this.emit("notesChanged")},loadNotes(A){console.log("Store: loadNotes action called"),this.state.placedNotes=A,this.emit("notesChanged")},setSelectedTool(A,N=null,D=null){console.log(`Store: setSelectedTool action called - Type: ${A}, Color: ${N}`),this.state.selectedTool.type=A,this.state.selectedTool.color=N,this.state.selectedTool.tonicNumber=D,this.emit("toolChanged",this.state.selectedTool)},setTempo(A){console.log(`Store: setTempo action called - Tempo: ${A}`),this.state.tempo=A,this.emit("tempoChanged",A)},setLooping(A){console.log(`Store: setLooping action called - Looping: ${A}`),this.state.isLooping=A,this.emit("loopingChanged",A)},setPlaybackState(A,N=!1){console.log(`Store: setPlaybackState action called - Playing: ${A}, Paused: ${N}`),this.state.isPlaying=A,this.state.isPaused=N,this.emit("playbackStateChanged",{isPlaying:A,isPaused:N})},shiftGridUp(){this.state.gridPosition>0&&(this.state.gridPosition--,console.log(`Store: shiftGridUp action called. New position: ${this.state.gridPosition}`),this.emit("gridChanged"))},shiftGridDown(){this.state.gridPosition+this.state.logicRows<this.state.fullRowData.length&&(this.state.gridPosition++,console.log(`Store: shiftGridDown action called. New position: ${this.state.gridPosition}`),this.emit("gridChanged"))},toggleMacrobeatGrouping(A){const N=this.state.macrobeatGroupings[A];this.state.macrobeatGroupings[A]=N===2?3:2,console.log(`Store: Toggled macrobeat grouping at index ${A} to ${this.state.macrobeatGroupings[A]}`),this.emit("rhythmChanged")},toggleMacrobeatBoundaryStyle(A){this.state.macrobeatBoundaryStyles[A]=!this.state.macrobeatBoundaryStyles[A],console.log(`Store: Toggled macrobeat boundary style at index ${A}`),this.emit("rhythmChanged")},increaseMacrobeatCount(){this.state.macrobeatGroupings.push(2),console.log("Store: Increased macrobeat count."),this.emit("rhythmChanged")},decreaseMacrobeatCount(){this.state.macrobeatGroupings.length>1&&(this.state.macrobeatGroupings.pop(),console.log("Store: Decreased macrobeat count."),this.emit("rhythmChanged"))},on(A,N){Qi[A]||(Qi[A]=[]),Qi[A].push(N)},emit(A,N){console.log(`Store: Emitting event -> ${A}`,N||""),Qi[A]&&Qi[A].forEach(D=>D(N))}};console.log("PitchData: Module loaded with hex color data.");const Fl=[{pitch:"C8",toneNote:"C8",frequency:4186.01,column:"A",hex:"#fef1f5"},{pitch:"B7",toneNote:"B7",frequency:3951.07,column:"B",hex:"#fbf2fa"},{pitch:"B♭/A♯7",toneNote:"Bb7",frequency:3729.31,column:"A",hex:"#f6f3fd"},{pitch:"A7",toneNote:"A7",frequency:3520,column:"B",hex:"#f1f5ff"},{pitch:"A♭/G♯7",toneNote:"Ab7",frequency:3322.44,column:"A",hex:"#edf7fe"},{pitch:"G7",toneNote:"G7",frequency:3135.96,column:"B",hex:"#ebf8fa"},{pitch:"G♭/F♯7",toneNote:"Gb7",frequency:2959.96,column:"A",hex:"#ecf8f5"},{pitch:"F7",toneNote:"F7",frequency:2793.83,column:"B",hex:"#eff8f0"},{pitch:"E7",toneNote:"E7",frequency:2637.02,column:"A",hex:"#f4f7ec"},{pitch:"E♭/D♯7",toneNote:"Eb7",frequency:2489.02,column:"B",hex:"#f9f5eb"},{pitch:"D7",toneNote:"D7",frequency:2349.32,column:"A",hex:"#fdf3ec"},{pitch:"D♭/C♯7",toneNote:"Db7",frequency:2217.46,column:"B",hex:"#fef2f0"},{pitch:"C7",toneNote:"C7",frequency:2093,column:"A",hex:"#fef1f5"},{pitch:"B6",toneNote:"B6",frequency:1975.53,column:"B",hex:"#f0d1ec"},{pitch:"B♭/A♯6",toneNote:"Bb6",frequency:1864.66,column:"A",hex:"#e1d6f9"},{pitch:"A6",toneNote:"A6",frequency:1760,column:"B",hex:"#cfdcff"},{pitch:"A♭/G♯6",toneNote:"Ab6",frequency:1661.22,column:"A",hex:"#bfe2fb"},{pitch:"G6",toneNote:"G6",frequency:1567.94,column:"B",hex:"#b7e6ef"},{pitch:"G♭/F♯6",toneNote:"Gb6",frequency:1479.98,column:"A",hex:"#b9e8dd"},{pitch:"F6",toneNote:"F6",frequency:1396.91,column:"B",hex:"#c6e6cb"},{pitch:"E6",toneNote:"E6",frequency:1318.51,column:"A",hex:"#d8e2bd"},{pitch:"E♭/D♯6",toneNote:"Eb6",frequency:1244.51,column:"B",hex:"#e9dcb7"},{pitch:"D6",toneNote:"D6",frequency:1174.66,column:"A",hex:"#f6d5bc"},{pitch:"D♭/C♯6",toneNote:"Db6",frequency:1108.73,column:"B",hex:"#fcd1c9"},{pitch:"C6",toneNote:"C6",frequency:1046.5,column:"A",hex:"#facfdb"},{pitch:"B5",toneNote:"B5",frequency:987.77,column:"B",hex:"#e6b2e1"},{pitch:"B♭/A♯5",toneNote:"Bb5",frequency:932.33,column:"A",hex:"#cebaf6"},{pitch:"A5",toneNote:"A5",frequency:880,column:"B",hex:"#b0c4fe"},{pitch:"A♭/G♯5",toneNote:"Ab5",frequency:830.61,column:"A",hex:"#92cef8"},{pitch:"G5",toneNote:"G5",frequency:783.99,column:"B",hex:"#7fd5e5"},{pitch:"G♭/F♯5",toneNote:"Gb5",frequency:739.99,column:"A",hex:"#84d8c8"},{pitch:"F5",toneNote:"F5",frequency:698.46,column:"B",hex:"#9ed6a8"},{pitch:"E5",toneNote:"E5",frequency:659.25,column:"A",hex:"#bece8f"},{pitch:"E♭/D♯5",toneNote:"Eb5",frequency:622.25,column:"B",hex:"#dbc484"},{pitch:"D5",toneNote:"D5",frequency:587.33,column:"A",hex:"#f0b98d"},{pitch:"D♭/C♯5",toneNote:"Db5",frequency:554.37,column:"B",hex:"#f9b1a5"},{pitch:"C5",toneNote:"C5",frequency:523.25,column:"A",hex:"#f5afc3"},{pitch:"B4",toneNote:"B4",frequency:493.88,column:"B",hex:"#db8fd4"},{pitch:"B♭/A♯4",toneNote:"Bb4",frequency:466.16,column:"A",hex:"#ba9bf2"},{pitch:"A4",toneNote:"A4",frequency:440,column:"B",hex:"#8fa9ff"},{pitch:"A♭/G♯4",toneNote:"Ab4",frequency:415.3,column:"A",hex:"#58b8f6"},{pitch:"G4",toneNote:"G4",frequency:392,column:"B",hex:"#16c3da"},{pitch:"G♭/F♯4",toneNote:"Gb4",frequency:369.99,column:"A",hex:"#2dc8b1"},{pitch:"F4",toneNote:"F4",frequency:349.23,column:"B",hex:"#6ec482"},{pitch:"E4",toneNote:"E4",frequency:329.63,column:"A",hex:"#a4ba57"},{pitch:"E♭/D♯4",toneNote:"Eb4",frequency:311.13,column:"B",hex:"#cdaa42"},{pitch:"D4",toneNote:"D4",frequency:293.66,column:"A",hex:"#e89955"},{pitch:"D♭/C♯4",toneNote:"Db4",frequency:277.18,column:"B",hex:"#f48e7d"},{pitch:"C4",toneNote:"C4",frequency:261.63,column:"A",hex:"#ef8aab"},{pitch:"B3",toneNote:"B3",frequency:246.94,column:"B",hex:"#be7cb8"},{pitch:"B♭/A♯3",toneNote:"Bb3",frequency:233.08,column:"A",hex:"#a286d2"},{pitch:"A3",toneNote:"A3",frequency:220,column:"B",hex:"#7b93dd"},{pitch:"A♭/G♯3",toneNote:"Ab3",frequency:207.65,column:"A",hex:"#4c9fd6"},{pitch:"G3",toneNote:"G3",frequency:196,column:"B",hex:"#13a9bd"},{pitch:"G♭/F♯3",toneNote:"Gb3",frequency:185,column:"A",hex:"#27ad99"},{pitch:"F3",toneNote:"F3",frequency:174.61,column:"B",hex:"#5faa71"},{pitch:"E3",toneNote:"E3",frequency:164.81,column:"A",hex:"#8ea14b"},{pitch:"E♭/D♯3",toneNote:"Eb3",frequency:155.56,column:"B",hex:"#b29338"},{pitch:"D3",toneNote:"D3",frequency:146.83,column:"A",hex:"#ca8549"},{pitch:"D♭/C♯3",toneNote:"Db3",frequency:138.59,column:"B",hex:"#d47a6c"},{pitch:"C3",toneNote:"C3",frequency:130.81,column:"A",hex:"#cf7894"},{pitch:"B2",toneNote:"B2",frequency:123.47,column:"B",hex:"#a46b9f"},{pitch:"B♭/A♯2",toneNote:"Bb2",frequency:116.54,column:"A",hex:"#8b73b6"},{pitch:"A2",toneNote:"A2",frequency:110,column:"B",hex:"#6a7ebf"},{pitch:"A♭/G♯2",toneNote:"Ab2",frequency:103.83,column:"A",hex:"#4189b8"},{pitch:"G2",toneNote:"G2",frequency:98,column:"B",hex:"#1092a3"},{pitch:"G♭/F♯2",toneNote:"Gb2",frequency:92.5,column:"A",hex:"#219584"},{pitch:"F2",toneNote:"F2",frequency:87.31,column:"B",hex:"#519360"},{pitch:"E2",toneNote:"E2",frequency:82.41,column:"A",hex:"#7a8b40"},{pitch:"E♭/D♯2",toneNote:"Eb2",frequency:77.78,column:"B",hex:"#997f30"},{pitch:"D2",toneNote:"D2",frequency:73.42,column:"A",hex:"#ae723e"},{pitch:"D♭/C♯2",toneNote:"Db2",frequency:69.3,column:"B",hex:"#b7695d"},{pitch:"C2",toneNote:"C2",frequency:65.41,column:"A",hex:"#b3677f"},{pitch:"B1",toneNote:"B1",frequency:61.74,column:"B",hex:"#6f466b"},{pitch:"B♭/A♯1",toneNote:"Bb1",frequency:58.27,column:"A",hex:"#5d4c7b"},{pitch:"A1",toneNote:"A1",frequency:55,column:"B",hex:"#465482"},{pitch:"A♭/G♯1",toneNote:"Ab1",frequency:51.91,column:"A",hex:"#295c7d"},{pitch:"G1",toneNote:"G1",frequency:49,column:"B",hex:"#06626e"},{pitch:"G♭/F♯1",toneNote:"Gb1",frequency:46.25,column:"A",hex:"#126458"},{pitch:"F1",toneNote:"F1",frequency:43.65,column:"B",hex:"#34633f"},{pitch:"E1",toneNote:"E1",frequency:41.2,column:"A",hex:"#515d28"},{pitch:"E♭/D♯1",toneNote:"Eb1",frequency:38.89,column:"B",hex:"#67541d"},{pitch:"D1",toneNote:"D1",frequency:36.71,column:"A",hex:"#764c27"},{pitch:"D♭/C♯1",toneNote:"Db1",frequency:34.65,column:"B",hex:"#7c453d"},{pitch:"C1",toneNote:"C1",frequency:32.7,column:"A",hex:"#794455"}];console.log("ConfigService: Module loaded.");let Tr;const Ll=50;let th,Ki,Xa,tn,Ya,zn;function Vl(){if(th=document.getElementById("grid-container"),Ki=document.getElementById("notation-grid"),tn=document.getElementById("drum-grid"),zn=document.getElementById("playhead-canvas"),!Ki||!tn||!zn){console.error("ConfigService: A required canvas element was not found in the DOM.");return}Xa=Ki.getContext("2d"),Ya=tn.getContext("2d"),window.pitchGridCtx=Xa,window.drumGridCtx=Ya,console.log("ConfigService: DOM elements and drawing contexts initialized.")}function Ha(){const A=U.state.macrobeatGroupings.flatMap(N=>Array(N).fill(1));U.state.columnWidths=[3,3,...A,3,3],console.log("ConfigService: Recalculated column widths based on macrobeat groupings.")}function eh(){console.log("ConfigService: Performing resize calculations.");const A=document.getElementById("grid-container-wrapper");if(!A)return;const D=A.offsetHeight/U.state.visualRows,P=D/2;U.state.cellWidth=P,U.state.cellHeight=D;const m=U.state.columnWidths.reduce((I,w)=>I+w,0),C=P*m,k=D*U.state.visualRows;Ki.width=C,Ki.height=k,zn.width=C,zn.height=k,th.style.width=`${C}px`;const M=.5*U.state.cellHeight;tn.width=C,tn.height=3*M,U.emit("gridResized")}function Za(){clearTimeout(Tr),Tr=setTimeout(eh,Ll)}function mi(){clearTimeout(Tr),eh()}const ne={init(){Vl(),Ha(),mi(),window.addEventListener("resize",Za),window.addEventListener("orientationchange",Za),U.on("rhythmChanged",()=>{console.log("ConfigService: Detected rhythmChanged event, recalculating columns and resizing."),Ha(),mi()}),console.log("ConfigService: Initialized and event listeners attached.")},getColumnX(A){let N=0;for(let D=0;D<A;D++){const P=U.state.columnWidths[D]||0;N+=P*U.state.cellWidth}return N},fitToWidth(){console.log("ConfigService: Action -> fitToWidth");const A=document.getElementById("grid-container-wrapper");if(!A)return;const N=A.offsetWidth,D=U.state.columnWidths.reduce((P,m)=>P+m,0);U.state.cellWidth=N/D,U.state.cellHeight=U.state.cellWidth*2,mi()},fitToHeight(){console.log("ConfigService: Action -> fitToHeight");const A=document.getElementById("grid-container-wrapper");if(!A)return;const N=A.offsetHeight,D=U.state.fullRowData.length;U.state.cellHeight=N/D,U.state.cellWidth=U.state.cellHeight/2,U.state.visualRows=D,U.state.logicRows=D,U.state.gridPosition=0,mi()},zoomIn(){U.state.visualRows>5&&(U.state.visualRows--,U.state.logicRows=U.state.visualRows*2,mi(),console.log("ConfigService: Action -> zoomIn."))},zoomOut(){const A=Math.floor(U.state.fullRowData.length/2);U.state.visualRows<A&&(U.state.visualRows++,U.state.logicRows=U.state.visualRows*2,U.state.gridPosition+U.state.logicRows>U.state.fullRowData.length&&(U.state.gridPosition=U.state.fullRowData.length-U.state.logicRows),mi(),console.log("ConfigService: Action -> zoomOut."))}};console.log("SynthEngine: Module loaded");let Ee,Pn,Ji;const Me={init(){Pn=new Pt.Volume(-15).toDestination(),Ee=new Pt.PolySynth(Pt.Synth,{maxPolyphony:8,oscillator:{type:"sine"},envelope:U.state.adsr}).connect(Pn),U.on("adsrChanged",A=>this.updateEnvelope(A)),U.on("harmonicLevelsChanged",()=>this.updateOscillatorPartialsDefault()),console.log("SynthEngine: Initialized with Tone.js"),window.synthEngine=this},setOscillatorType(A){Ee&&(["sine","triangle","square","sawtooth"].includes(A)?Ee.set({oscillator:{type:A}}):(Ee.set({oscillator:{type:"custom"}}),this.updateOscillatorPartialsDefault()),console.log(`SynthEngine: Oscillator type set to ${A}`))},updateOscillatorPartialsDefault(){const A=U.state.harmonicLevels;Ee&&Ee.get().oscillator.type==="custom"&&(Ee.set({oscillator:{partials:A}}),console.log("SynthEngine: Partials updated for custom waveform."))},updateEnvelope(A){Ee&&(Ee.set({envelope:A}),console.log("SynthEngine: Envelope updated",A))},setVolume(A){Pn&&(Pn.volume.value=A,console.log(`SynthEngine: Volume set to ${A} dB`))},async playNote(A,N,D=Pt.now()){await Pt.start(),Ee.triggerAttackRelease(A,N,D),console.log(`SynthEngine: Playing note ${A}`)},triggerAttack(A){Ji&&Ji.triggerPlayhead(A,"attack"),Ee.triggerAttack(A)},triggerRelease(A){Ji&&Ji.triggerPlayhead(A,"release"),Ee.triggerRelease(A)},releaseAll(){Ee&&Ee.releaseAll()},setCustomEnvelope(A){Ji=A}};console.log("TransportService: Module loaded.");let Bn,en;function Ar(){return 60/(U.state.tempo*2)}function zl(A){const N=U.state.fullRowData;return N&&N[A.row]?N[A.row].toneNote.replace("♭","b").replace("♯","#"):(console.warn(`TransportService: Could not find pitch for note at row ${A.row}. Defaulting to C4.`),"C4")}function $a(){Pt.Transport.cancel();const A=Ar();U.state.placedNotes.forEach(N=>{if(N.shape==="tonicization")return;const D=(N.startColumnIndex-2)*A;if(N.isDrum)Pt.Transport.schedule(P=>{var m;U.state.isPaused||(m=en==null?void 0:en.player(N.drumTrack))==null||m.start(P)},D);else{const P=(N.endColumnIndex-N.startColumnIndex+1)*A,m=zl(N);Pt.Transport.schedule(C=>{U.state.isPaused||Me.triggerAttack(m,C)},D),Pt.Transport.schedule(C=>{Me.triggerRelease(m,C)},D+P)}}),console.log(`TransportService: Scheduled ${U.state.placedNotes.length} notes.`)}function Bl(){const A=document.getElementById("playhead-canvas"),N=A.getContext("2d");function D(){if(U.state.isPaused)return;N.clearRect(0,0,A.width,A.height);let P=Pt.Transport.seconds;if(Pt.Transport.loop){const I=Pt.Transport.loopEnd-Pt.Transport.loopStart;I>0&&(P=(Pt.Transport.seconds-Pt.Transport.loopStart)%I+Pt.Transport.loopStart)}const m=Ar(),C=P/m,k=ne.getColumnX(2),M=C*U.state.cellWidth+k;N.strokeStyle="rgba(255,0,0,0.8)",N.lineWidth=2,N.beginPath(),N.moveTo(M,0),N.lineTo(M,A.height),N.stroke(),Pt.Transport.state==="started"&&(Bn=requestAnimationFrame(D))}Bn=requestAnimationFrame(D)}const Ln={init(){en=new Pt.Players({H:"https://tonejs.github.io/audio/drum-samples/CR78/hihat.mp3",M:"https://tonejs.github.io/audio/drum-samples/CR78/snare.mp3",L:"https://tonejs.github.io/audio/drum-samples/CR78/kick.mp3"}).toDestination(),window.transportService={drumPlayers:en},U.on("notesChanged",()=>this.handleStateChange()),U.on("rhythmChanged",()=>this.handleStateChange()),U.on("tempoChanged",A=>Pt.Transport.bpm.value=A*2),U.on("loopingChanged",A=>Pt.Transport.loop=A),console.log("TransportService: Initialized.")},handleStateChange(){U.state.isPlaying&&!U.state.isPaused&&(console.log("TransportService: Live re-scheduling notes due to state change."),$a())},start(){console.log("TransportService: Starting playback."),Pt.start().then(()=>{const A=Ar(),D=(U.state.columnWidths.length-4)*A;Pt.Transport.loopStart=0,Pt.Transport.loopEnd=D,Pt.Transport.loop=U.state.isLooping,Pt.Transport.bpm.value=U.state.tempo*2,$a(),Pt.Transport.start(),Bl()})},pause(){console.log("TransportService: Pausing playback."),Pt.Transport.pause(),Me.releaseAll(),cancelAnimationFrame(Bn)},stop(){console.log("TransportService: Stopping playback."),Pt.Transport.stop(),Pt.Transport.cancel(),Me.releaseAll(),cancelAnimationFrame(Bn);const A=document.getElementById("playhead-canvas");A&&A.getContext("2d").clearRect(0,0,A.width,A.height)}};console.log("SpacebarHandler: Module loaded.");let qn=!1,Ws=null;function jl(A){const N=U.state.fullRowData[A.row];return N?N.toneNote:"C4"}function Wl(){document.addEventListener("keydown",A=>{if(A.code!=="Space"||qn)return;const N=document.activeElement.tagName.toLowerCase();if(["input","textarea"].includes(N))return;A.preventDefault(),qn=!0;const D=U.state.placedNotes.length>0?U.state.placedNotes[U.state.placedNotes.length-1]:null;Ws=D&&!D.isDrum?jl(D):"C4",Me.triggerAttack(Ws),console.log(`Spacebar: Attack ${Ws}`)}),document.addEventListener("keyup",A=>{A.code!=="Space"||!qn||(A.preventDefault(),qn=!1,Ws&&(Me.triggerRelease(Ws),console.log(`Spacebar: Release ${Ws}`),Ws=null))}),console.log("SpacebarHandler: Initialized.")}console.log("RhythmUIComponent: Module loaded.");function Gl(){const A=document.getElementById("beat-line-controls");if(!A)return;A.innerHTML="";const N=document.getElementById("notation-grid");if(!N)return;const D=N.getBoundingClientRect(),P=A.getBoundingClientRect(),m=D.left-P.left;let C=2;U.state.macrobeatGroupings.forEach((k,M)=>{const I=ne.getColumnX(C),w=ne.getColumnX(C+k),x=(I+w)/2,y=document.createElement("button");y.textContent=k,y.className="rhythm-ui-button",y.style.position="absolute",y.style.left=`${m+x}px`,y.style.top="0px",y.style.transform="translateX(-50%)",y.addEventListener("click",()=>U.toggleMacrobeatGrouping(M)),A.appendChild(y);const g=document.createElement("button");g.textContent=U.state.macrobeatBoundaryStyles[M]?"●":"○",g.className="rhythm-ui-button",g.style.position="absolute",g.style.left=`${m+w}px`,g.style.top="0px",g.style.transform="translateX(-50%)",g.addEventListener("click",()=>U.toggleMacrobeatBoundaryStyle(M)),A.appendChild(g),C+=k})}console.log("TimeSignatureDisplay: Module loaded.");function Ul(){const A=[];let N=0,D=2;return U.state.macrobeatGroupings.forEach((P,m)=>{if(N+=P,D+=P,U.state.macrobeatBoundaryStyles[m]===!0||m===U.state.macrobeatGroupings.length-1){const C=ne.getColumnX(D-N),k=ne.getColumnX(D);A.push({label:`${N/2}/4`,centerX:(C+k)/2}),N=0}}),A}function Xl(){const A=document.getElementById("time-signature-display");if(!A)return;A.innerHTML="";const N=document.getElementById("notation-grid");if(!N)return;const D=N.getBoundingClientRect(),P=A.getBoundingClientRect(),m=D.left-P.left;Ul().forEach(k=>{const M=document.createElement("div");M.className="time-signature-label",M.textContent=k.label,M.style.position="absolute",M.style.left=`${m+k.centerX}px`,M.style.transform="translateX(-50%)",A.appendChild(M)})}console.log("ToolbarComponent: Module loaded.");function Yl(){document.getElementById("export-button").addEventListener("click",()=>{const A=U.state.placedNotes.map(m=>[m.row,m.startColumnIndex,m.endColumnIndex,m.color,m.shape,m.tonicNumber||"",m.isDrum,m.drumTrack||""].join(",")).join(`
`),N=new Blob([A],{type:"text/csv;charset=utf-8;"}),D=document.createElement("a"),P=URL.createObjectURL(N);D.setAttribute("href",P),D.setAttribute("download","student-notation-export.csv"),D.style.visibility="hidden",document.body.appendChild(D),D.click(),document.body.removeChild(D)}),document.getElementById("import-button").addEventListener("click",()=>{const A=document.createElement("input");A.type="file",A.accept=".csv,.txt",A.onchange=N=>{const D=N.target.files[0],P=new FileReader;P.onload=m=>{const M=m.target.result.split(`
`).filter(I=>I.trim()!=="").map(I=>{const w=I.split(",");return{row:parseInt(w[0]),startColumnIndex:parseInt(w[1]),endColumnIndex:parseInt(w[2]),color:w[3],shape:w[4],tonicNumber:w[5]||null,isDrum:w[6]==="true",drumTrack:w[7]||null}});U.loadNotes(M),console.log(`Toolbar: Imported ${M.length} notes.`)},P.readAsText(D)},A.click()})}function Hl(){const A=document.querySelectorAll(".note-bank-container .note"),N=document.getElementById("eraser-tool"),D=document.querySelectorAll(".tonicization-container .tonicization-button");A.forEach(P=>{P.addEventListener("click",()=>{const m=P.getAttribute("data-color"),C=P.getAttribute("data-type");U.setSelectedTool(C,m)})}),N.addEventListener("click",()=>U.setSelectedTool("eraser")),D.forEach(P=>{P.addEventListener("click",()=>{const m=P.getAttribute("data-tonic");U.setSelectedTool("tonicization","#000000",m)})}),U.on("toolChanged",P=>{var m,C;document.querySelectorAll(".note, .eraser, .tonicization-button").forEach(k=>k.classList.remove("selected","active-eraser")),P.type==="eraser"?N.classList.add("active-eraser"):P.type==="tonicization"?(m=document.querySelector(`.tonicization-button[data-tonic='${P.tonicNumber}']`))==null||m.classList.add("selected"):(C=document.querySelector(`.note[data-type='${P.type}'][data-color='${P.color}']`))==null||C.classList.add("selected")})}function Zl(){const A=document.getElementById("play-button"),N=document.getElementById("stop-button"),D=document.getElementById("clear-button"),P=document.getElementById("loop-button");A.addEventListener("click",()=>{!U.state.isPlaying||U.state.isPaused?(U.setPlaybackState(!0,!1),Ln.start()):(U.setPlaybackState(!0,!0),Ln.pause())}),N.addEventListener("click",()=>{U.setPlaybackState(!1,!1),Ln.stop()}),D.addEventListener("click",()=>U.clearAllNotes()),P.addEventListener("click",()=>U.setLooping(!U.state.isLooping)),U.on("playbackStateChanged",({isPlaying:m,isPaused:C})=>{m&&!C?(A.textContent="⏸",A.classList.add("active")):(A.textContent="⏵",A.classList.remove("active"))}),U.on("loopingChanged",m=>{P.classList.toggle("active",m)})}function $l(){document.getElementById("volume-slider").addEventListener("input",function(){const A=parseInt(this.value,10)/100*40-40;Me.setVolume(A)}),document.getElementById("tempo-slider").addEventListener("input",function(){U.setTempo(parseInt(this.value,10))}),document.getElementById("preset-sine").addEventListener("click",()=>Me.setOscillatorType("sine")),document.getElementById("preset-triangle").addEventListener("click",()=>Me.setOscillatorType("triangle")),document.getElementById("preset-square").addEventListener("click",()=>Me.setOscillatorType("square")),document.getElementById("preset-sawtooth").addEventListener("click",()=>{Me.setOscillatorType("custom")})}function Ql(){document.getElementById("grid-expand-button").addEventListener("click",()=>ne.zoomIn()),document.getElementById("grid-shrink-button").addEventListener("click",()=>ne.zoomOut()),document.getElementById("fit-to-width").addEventListener("click",()=>ne.fitToWidth()),document.getElementById("fit-to-height").addEventListener("click",()=>ne.fitToHeight()),document.getElementById("shift-up-button").addEventListener("click",()=>U.shiftGridUp()),document.getElementById("shift-down-button").addEventListener("click",()=>U.shiftGridDown()),document.getElementById("macrobeat-increase").addEventListener("click",()=>U.increaseMacrobeatCount()),document.getElementById("macrobeat-decrease").addEventListener("click",()=>U.decreaseMacrobeatCount())}const br={init(){Hl(),Zl(),$l(),Ql(),Yl(),console.log("ToolbarComponent: All controls initialized.")},renderRhythmUI(){Gl(),Xl()}};console.log("GridComponent: Module loaded.");function sh(){return U.state.fullRowData.slice(U.state.gridPosition,U.state.gridPosition+U.state.logicRows)}function Wn(A){return A*.5*U.state.cellHeight}function Jl(){const A=window.pitchGridCtx,N=sh();function D(P,m){const C=ne.getColumnX(P),k=U.state.columnWidths.slice(P,P+2).map(I=>I*U.state.cellWidth);let M=C;m.forEach((I,w)=>{const x=k[w];N.forEach((y,g)=>{if(y.column===I){const d=Wn(g);A.fillStyle=y.hex||"#fff",A.fillRect(M,d-U.state.cellHeight/2,x,U.state.cellHeight),A.fillStyle="#000";const c=Math.max(12,Math.min(U.state.cellWidth*.8,U.state.cellHeight*.8));A.font=`${c}px sans-serif`,A.textAlign="center",A.textBaseline="middle",A.fillText(y.pitch,M+x/2,d)}}),M+=x})}D(0,["B","A"]),D(U.state.columnWidths.length-2,["A","B"])}function Kl(A){let N=(A||"").replace(/\d/g,"").trim();return N=N.replace(/b/g,"♭").replace(/#/g,"♯"),N}function tu(A){switch(A){case"C":return{lineWidth:3,dash:[],color:"#000"};case"E":return{lineWidth:1,dash:[5,5],color:"#000"};case"G":return{lineWidth:1,dash:[],color:"rgba(128,128,128,0.5)"};case"D♭/C♯":case"E♭/D♯":case"F":case"A":case"B":return null;default:return{lineWidth:1,dash:[],color:"#000"}}}function eu(){const A=window.pitchGridCtx,N=sh(),D=U.state.columnWidths.length;N.forEach((P,m)=>{const C=Wn(m),k=Kl(P.pitch),M=tu(k);M&&(A.beginPath(),A.moveTo(ne.getColumnX(2),C),A.lineTo(ne.getColumnX(D-2),C),A.lineWidth=M.lineWidth,A.strokeStyle=M.color,A.setLineDash(M.dash),A.stroke(),A.setLineDash([]))})}function su(){const A=window.pitchGridCtx,N=U.state.columnWidths.length;let D=[],P=2;U.state.macrobeatGroupings.forEach(m=>{P+=m,D.push(P)});for(let m=0;m<=N;m++){const C=ne.getColumnX(m);let k=m===2||m===N-2,M=D.includes(m);if(k)A.lineWidth=2,A.strokeStyle="#000",A.setLineDash([]);else if(M){const I=D.indexOf(m);A.lineWidth=1,A.strokeStyle="#000",A.setLineDash(U.state.macrobeatBoundaryStyles[I]?[]:[4,2])}else continue;A.beginPath(),A.moveTo(C,0),A.lineTo(C,A.canvas.height),A.stroke()}A.setLineDash([])}function iu(A,N){const D=window.pitchGridCtx,P=Wn(N),m=ne.getColumnX(A.startColumnIndex);ne.getColumnX(A.endColumnIndex+1)-m;const C=m+(ne.getColumnX(A.startColumnIndex+1)-m)/2,k=U.state.cellHeight*.45;if(A.endColumnIndex>A.startColumnIndex){const M=ne.getColumnX(A.endColumnIndex)+U.state.columnWidths[A.endColumnIndex]*U.state.cellWidth/2;D.beginPath(),D.moveTo(C,P),D.lineTo(M,P),D.strokeStyle=A.color,D.lineWidth=U.state.cellWidth*.2,D.stroke()}D.beginPath(),D.arc(C,P,k,0,2*Math.PI),D.strokeStyle=A.color,D.lineWidth=6,D.fillStyle="white",D.fill(),D.stroke()}function nu(A,N){const D=window.pitchGridCtx,P=Wn(N),m=ne.getColumnX(A.startColumnIndex),C=U.state.columnWidths[A.startColumnIndex]*U.state.cellWidth,k=m+C/2,M=C*.45,I=U.state.cellHeight*.45;D.beginPath(),D.ellipse(k,P,M,I,0,0,2*Math.PI),D.strokeStyle=A.color,D.lineWidth=6,D.fillStyle="white",D.fill(),D.stroke()}function ou(){const A=window.pitchGridCtx;!A||!A.canvas||(A.clearRect(0,0,A.canvas.width,A.canvas.height),eu(),su(),Jl(),U.state.placedNotes.forEach(N=>{if(N.isDrum)return;const D=N.row-U.state.gridPosition;D>=0&&D<U.state.logicRows&&(N.shape==="oval"?nu(N,D):iu(N,D))}))}const Nn={render(){console.log("GridComponent: Render triggered."),ou()}};console.log("DrumGridComponent: Module loaded.");function ru(A,N,D,P,m,C){const k=D+m/2,M=P+C/2,I=Math.min(m,C)*.4;if(A.beginPath(),N===0)A.moveTo(k,M-I),A.lineTo(k-I,M+I),A.lineTo(k+I,M+I),A.closePath();else if(N===1)A.rect(k-I,M-I,2*I,2*I);else{for(let x=0;x<5;x++){const y=2*Math.PI/5*x-Math.PI/2,g=k+I*Math.cos(y),d=M+I*Math.sin(y);x===0?A.moveTo(g,d):A.lineTo(g,d)}A.closePath()}A.fill()}function au(){const A=window.drumGridCtx;if(!A||!A.canvas){console.error("DrumGridComponent: Drum grid context not available for rendering.");return}A.clearRect(0,0,A.canvas.width,A.canvas.height);const N=.5*U.state.cellHeight,D=U.state.columnWidths.length,P=["H","M","L"];A.font=`${Math.floor(N*.7)}px sans-serif`,A.textAlign="center",A.textBaseline="middle",A.fillStyle="#333";const m=ne.getColumnX(1);P.forEach((C,k)=>{A.fillText(C,m,k*N+N/2)});for(let C=0;C<4;C++){const k=C*N;A.beginPath(),A.moveTo(0,k),A.lineTo(A.canvas.width,k),A.strokeStyle="#ccc",A.lineWidth=.5,A.stroke()}for(let C=2;C<D-2;C++){const k=ne.getColumnX(C),M=U.state.columnWidths[C]*U.state.cellWidth;for(let I=0;I<3;I++){const w=I*N,x=P[I];U.state.placedNotes.find(g=>g.isDrum&&g.drumTrack===x&&g.startColumnIndex===C)?(A.fillStyle="#000",ru(A,I,k,w,M,N)):(A.fillStyle="#ddd",A.beginPath(),A.arc(k+M/2,w+N/2,2,0,Math.PI*2),A.fill())}}}const wr={render(){console.log("DrumGridComponent: Render triggered."),au()}};console.log("GridEvents: Module loaded.");let kr=!1,gi=null,Sr=!1;function jn(A){let N=0;for(let D=0;D<U.state.columnWidths.length;D++)if(N+=U.state.columnWidths[D]*U.state.cellWidth,A<N)return D;return U.state.columnWidths.length-1}function hu(A){const N=U.state.gridPosition+A,D=U.state.fullRowData[N];return D?D.toneNote:null}function cu(A){const N=A.target.getBoundingClientRect(),D=A.clientX-N.left,P=A.clientY-N.top,m=jn(D);if(m<2||m>=U.state.columnWidths.length-2)return;const C=Math.floor(P/(U.state.cellHeight*.5)),k=U.state.gridPosition+C;if(A.button===2||U.state.selectedTool.type==="eraser"){A.preventDefault(),Sr=!0,U.eraseNoteAt(m,k);return}if(A.button===0){const{type:M,color:I}=U.state.selectedTool,w={row:k,startColumnIndex:m,endColumnIndex:M==="oval"?m:m+1,color:I,shape:M,isDrum:!1};U.addNote(w),kr=M==="circle",gi=w;const x=hu(C);x&&Me.playNote(x,"8n")}}function lu(A){if(Sr){const N=A.target.getBoundingClientRect(),D=A.clientX-N.left,P=A.clientY-N.top,m=jn(D),C=Math.floor(P/(U.state.cellHeight*.5)),k=U.state.gridPosition+C;U.eraseNoteAt(m,k)}if(kr&&gi){const N=A.target.getBoundingClientRect(),D=A.clientX-N.left,P=jn(D),m=Math.max(gi.startColumnIndex,P);m!==gi.endColumnIndex&&U.updateNoteTail(gi,m)}}function uu(A){A.preventDefault();const N=A.target.getBoundingClientRect(),D=A.clientX-N.left,P=A.clientY-N.top,m=jn(D);if(m<2||m>=U.state.columnWidths.length-2)return;const C=.5*U.state.cellHeight,k=Math.floor(P/C);if(k<0||k>2)return;const M=["H","M","L"][k],I={isDrum:!0,drumTrack:M,startColumnIndex:m,endColumnIndex:m,color:"#000",shape:M==="H"?"triangle":M==="M"?"square":"pentagon"};U.toggleDrumNote(I),window.transportService&&window.transportService.drumPlayers&&window.transportService.drumPlayers.player(M).start()}function du(){const A=document.getElementById("notation-grid"),N=document.getElementById("drum-grid");A.addEventListener("mousedown",cu),A.addEventListener("mousemove",lu),A.addEventListener("contextmenu",D=>D.preventDefault()),N.addEventListener("mousedown",uu),N.addEventListener("contextmenu",D=>D.preventDefault()),window.addEventListener("mouseup",()=>{kr=!1,gi=null,Sr=!1}),console.log("GridEvents: All canvas event listeners attached.")}var Vn={exports:{}},pu=Vn.exports,Qa;function fu(){return Qa||(Qa=1,function(A,N){(function(P,m){A.exports=m()})(pu,function(){return function(D){var P={};function m(C){if(P[C])return P[C].exports;var k=P[C]={exports:{},id:C,loaded:!1};return D[C].call(k.exports,k,k.exports,m),k.loaded=!0,k.exports}return m.m=D,m.c=P,m.p="",m(0)}([function(D,P,m){var C=function(M){return M&&M.__esModule?M.default:M},k=C(m(1));D.exports=k},function(D,P,m){var C=function(vt){return vt&&vt.__esModule?vt:{default:vt}},k=function(vt){return vt&&vt.__esModule?vt.default:vt},M=function(){function vt(St,kt){for(var ue in kt){var Xe=kt[ue];Xe.configurable=!0,Xe.value&&(Xe.writable=!0)}Object.defineProperties(St,kt)}return function(St,kt,ue){return kt&&vt(St.prototype,kt),ue&&vt(St,ue),St}}(),I=function(vt,St){if(!(vt instanceof St))throw new TypeError("Cannot call a class as a function")};P.colors=Q,P.context=et,P.clock=st,Object.defineProperty(P,"__esModule",{value:!0});var w=k(m(2)),x=k(m(5)),y=k(m(38)),g=k(m(40)),d=C(m(39)),c=m(28),l=m(41),a=m(27),h=m(26),v=m(25),_=k(m(42)),E=k(m(29)),V=function(){function vt(St){I(this,vt);for(var kt in w)this[kt]=w[kt];for(var kt in x)this[kt]=x[kt];var ue={Rack:y},Xe={Counter:c,Radio:l,Drunk:a,Sequence:h,Matrix:v};for(var kt in Xe)this[kt]=Xe[kt];for(var kt in ue)this[kt]=ue[kt];var Be=window.AudioContext||window.webkitAudioContext;this._context=St||new Be,this.tune=new g,this.note=this.tune.note.bind(this.tune),this.clock=new _(this._context),this.clock.start(),this.Interval=E,this.colors={accent:"#2bb",fill:"#eee",light:"#fff",dark:"#333",mediumLight:"#ccc",mediumDark:"#666"},this.transform=d,this.add=d.add,this.Add={};for(var kt in w)this.Add[kt]=d.add.bind(this,kt);var as=document.createElement("style");as.type="text/css",as.innerHTML="[nexus-ui]{height:5000px;width:5000px}";var rt=document.head;rt.insertBefore(as,rt.firstElementChild)}return M(vt,{context:{get:function(){return this._context},set:function(St){this.clock.stop(),this._context=St,this.clock=new _(this.context),this.clock.start()}}}),vt}(),L=new V;function Q(){return L.colors}function et(){return L.context}function st(){return L.clock}P.default=L},function(D,P,m){D.exports={Position:m(3),Slider:m(14),Toggle:m(15),Button:m(16),TextButton:m(18),RadioButton:m(19),Number:m(20),Select:m(21),Dial:m(22),Piano:m(23),Sequencer:m(24),Pan2D:m(30),Tilt:m(31),Multislider:m(32),Pan:m(33),Envelope:m(34),Spectrogram:m(35),Meter:m(36),Oscilloscope:m(37)}},function(D,P,m){var C=function(l){return l&&l.__esModule?l:{default:l}},k=function(){function l(a,h){for(var v in h){var _=h[v];_.configurable=!0,_.value&&(_.writable=!0)}Object.defineProperties(a,h)}return function(a,h,v){return h&&l(a.prototype,h),v&&l(a,v),a}}(),M=function l(a,h,v){var _=Object.getOwnPropertyDescriptor(a,h);if(_===void 0){var E=Object.getPrototypeOf(a);return E===null?void 0:l(E,h,v)}else{if("value"in _&&_.writable)return _.value;var V=_.get;return V===void 0?void 0:V.call(v)}},I=function(l,a){if(typeof a!="function"&&a!==null)throw new TypeError("Super expression must either be null or a function, not "+typeof a);l.prototype=Object.create(a&&a.prototype,{constructor:{value:l,enumerable:!1,writable:!0,configurable:!0}}),a&&(l.__proto__=a)},w=function(l,a){if(!(l instanceof a))throw new TypeError("Cannot call a class as a function")},x=m(4),y=m(6),g=m(11),d=C(m(12)),c=function(l){function a(){w(this,a);var h=["value"],v={size:[200,200],mode:"absolute",minX:0,maxX:1,stepX:0,x:.5,minY:0,maxY:1,stepY:0,y:.5};M(Object.getPrototypeOf(a.prototype),"constructor",this).call(this,arguments,h,v),this._x=new g(this.settings.minX,this.settings.maxX,this.settings.stepX,this.settings.x),this._y=new g(this.settings.minY,this.settings.maxY,this.settings.stepY,this.settings.y),this.position={x:new d.Handle(this.settings.mode,"horizontal",[0,this.width],[this.height,0]),y:new d.Handle(this.settings.mode,"vertical",[0,this.width],[this.height,0])},this.position.x.value=this._x.normalized,this.position.y.value=this._y.normalized,this.init(),this.render()}return I(a,l),k(a,{buildInterface:{value:function(){this.knob=x.create("circle"),this.element.appendChild(this.knob)}},sizeInterface:{value:function(){this.position.x.resize([0,this.width],[this.height,0]),this.position.y.resize([0,this.width],[this.height,0]),this._minDimension=Math.min(this.width,this.height),this.knobRadius={off:~~(this._minDimension/100)*5+5},this.knobRadius.on=this.knobRadius.off*2,this.knob.setAttribute("cx",this.width/2),this.knob.setAttribute("cy",this.height/2),this.knob.setAttribute("r",this.knobRadius.off)}},colorInterface:{value:function(){this.element.style.backgroundColor=this.colors.fill,this.knob.setAttribute("fill",this.colors.accent)}},render:{value:function(){this.clicked?this.knob.setAttribute("r",this.knobRadius.on):this.knob.setAttribute("r",this.knobRadius.off),this.knobCoordinates={x:this._x.normalized*this.width,y:this.height-this._y.normalized*this.height},this.knob.setAttribute("cx",this.knobCoordinates.x),this.knob.setAttribute("cy",this.knobCoordinates.y)}},click:{value:function(){this.position.x.anchor=this.mouse,this.position.y.anchor=this.mouse,this.move()}},move:{value:function(){this.clicked&&(this.position.x.update(this.mouse),this.position.y.update(this.mouse),this._x.updateNormal(this.position.x.value),this._y.updateNormal(this.position.y.value),this.emit("change",{x:this._x.value,y:this._y.value}),this.render())}},release:{value:function(){this.render()}},x:{get:function(){return this._x.value},set:function(h){this._x.update(h),this.emit("change",{x:this._x.value,y:this._y.value}),this.render()}},y:{get:function(){return this._y.value},set:function(h){this._y.update(h),this.emit("change",{x:this._x.value,y:this._y.value}),this.render()}},normalized:{get:function(){return{x:this._x.normalized,y:this._y.normalized}}},minX:{get:function(){return this._x.min},set:function(h){this._x.min=h,this.render()}},minY:{get:function(){return this._y.min},set:function(h){this._y.min=h,this.render()}},maxX:{get:function(){return this._x.max},set:function(h){this._x.max=h,this.render()}},maxY:{get:function(){return this._y.max},set:function(h){this._y.max=h,this.render()}},stepX:{get:function(){return this._x.step},set:function(h){this._x.step=h,this.render()}},stepY:{get:function(){return this._y.step},set:function(h){this._y.step=h,this.render()}},mode:{get:function(){return this.position.x.mode},set:function(h){this.position.x.mode=h,this.position.y.mode=h}}}),a}(y);D.exports=c},function(D,P,m){var C=m(5);D.exports={create:function(k){return document.createElementNS("http://www.w3.org/2000/svg",k)},arc:function(k,M,I,w,x){var y=C.toCartesian(I,x),g=C.toCartesian(I,w),d=x-w<=180?"0":"1",c=["M",y.x+k,y.y+M,"A",I,I,0,d,0,g.x+k,g.y+M].join(" ");return c},radialGradient:function(k,M){var I="gradient"+C.ri(1e11),w=[],x=document.createElementNS("http://www.w3.org/2000/svg","radialGradient");x.setAttribute("id",I),x.setAttribute("cx","50%"),x.setAttribute("cy","50%"),x.setAttribute("r","50%"),k.appendChild(x);for(var y=0;y<M;y++){var g=document.createElementNS("http://www.w3.org/2000/svg","stop");g.setAttribute("id","stop"+y),x.appendChild(g),w.push(g)}return{id:I,stops:w,element:x}}}},function(D,P){P.clip=function(m,C,k){return Math.min(Math.max(m,C),k)},P.normalize=function(m,C,k){return(m-C)/(k-C)},P.scale=function(m,C,k,M,I){return C===k?M:(m-C)*(I-M)/(k-C)+M},P.toPolar=function(m,C){var k=Math.sqrt(m*m+C*C),M=Math.atan2(C,m);return M<0&&(M=M+2*Math.PI),{radius:k,angle:M}},P.toCartesian=function(m,C){var k=Math.cos(C),M=Math.sin(C);return{x:m*k,y:m*M*-1}},P.prune=function(m,C){return parseFloat(m.toFixed(C))},P.invert=function(m){return P.scale(m,1,0,0,1)},P.mtof=function(m){return Math.pow(2,(m-69)/12)*440},P.interp=function(m,C,k){return m*(k-C)+C},P.pick=function(){return arguments[~~(Math.random()*arguments.length)]},P.octave=function(m){return Math.pow(2,m)},P.ri=function(m,C){C||(C=m,m=0);var k=Math.min(m,C),M=Math.max(m,C);return Math.floor(Math.random()*(M-k)+k)},P.rf=function(m,C){C||(C=m,m=0);var k=Math.min(m,C),M=Math.max(m,C);return Math.random()*(M-k)+k},P.cycle=function(m,C,k){return m++,m>=k&&(m=C),m},P.average=function(m){for(var C=0,k=0;k<m.length;k++)C+=m[k];return C/m.length},P.distance=function(m,C,k,M){var I=m-k,w=C-M;return Math.sqrt(I*I+w*w)},P.gainToDB=function(m){return 20*Math.log10(m)},P.coin=function(){var m=arguments[0]===void 0?.5:arguments[0];return P.rf(0,1)<m?1:0}},function(D,P,m){var C=function(){function a(h,v){for(var _ in v){var E=v[_];E.configurable=!0,E.value&&(E.writable=!0)}Object.defineProperties(h,v)}return function(h,v,_){return v&&a(h.prototype,v),_&&a(h,_),h}}(),k=function a(h,v,_){var E=Object.getOwnPropertyDescriptor(h,v);if(E===void 0){var V=Object.getPrototypeOf(h);return V===null?void 0:a(V,v,_)}else{if("value"in E&&E.writable)return E.value;var L=E.get;return L===void 0?void 0:L.call(_)}},M=function(a,h){if(typeof h!="function"&&h!==null)throw new TypeError("Super expression must either be null or a function, not "+typeof h);a.prototype=Object.create(h&&h.prototype,{constructor:{value:a,enumerable:!1,writable:!0,configurable:!0}}),h&&(a.__proto__=h)},I=function(a,h){if(!(a instanceof h))throw new TypeError("Cannot call a class as a function")},w=m(4),x=m(7),y=m(8),g=m(9),d=m(10),c=m(1).colors,l=function(a){function h(v,_,E){I(this,h),k(Object.getPrototypeOf(h.prototype),"constructor",this).call(this),this.type=this.constructor.name,this.settings=this.parseSettings(v,_,E),this.mouse={},this.wait=!1,this.colors={};var V=c();this.colors.accent=V.accent,this.colors.fill=V.fill,this.colors.light=V.light,this.colors.dark=V.dark,this.colors.mediumLight=V.mediumLight,this.colors.mediumDark=V.mediumDark}return M(h,a),C(h,{parseSettings:{value:function(_,E,V){E.unshift("target"),V.defaultSize=V.size.splice(0,2),V.size=!1;var L={target:document.body,colors:{},snapWithParent:!0,event:function(){},component:!1};for(var Q in V)L[Q]=V[Q];for(var et=0;et<_.length;et++){var st=_[et];if(y.isObject(st))for(var Q in st)L[Q]=st[Q];else if(typeof st=="function")L.event=st;else if(E.length>=1){var Q=E.splice(0,1)[0];L[Q]=st}}return this.parent=x.parseElement(L.target),this.parent&&this.parent instanceof HTMLElement&&!L.component&&(this.parent.hasAttribute("nexus-ui")||this.parent.setAttribute("nexus-ui","")),L.size&&Array.isArray(L.size)&&L.snapWithParent?(this.width=L.size[0],this.height=L.size[1],this.parent.style.width=this.width+"px",this.parent.style.height=this.height+"px"):L.snapWithParent&&!L.component?(this.width=parseFloat(window.getComputedStyle(this.parent,null).getPropertyValue("width").replace("px","")),this.height=parseFloat(window.getComputedStyle(this.parent,null).getPropertyValue("height").replace("px","")),this.width==5e3&&(this.width=L.defaultSize[0],this.parent.style.width=this.parent.width=this.width+"px"),this.height==5e3&&(this.height=L.defaultSize[1],this.parent.style.height=this.parent.height=this.height+"px")):(L.size=L.defaultSize,this.width=L.size[0],this.height=L.size[1]),L.event?this.event=this.on("change",L.event):this.event=!1,L}},init:{value:function(){this.buildFrame(),this.buildInterface(),this.sizeInterface(),this.attachListeners(),this.colorInterface(),this.finalTouches()}},buildFrame:{value:function(){this.element=w.create("svg"),this.element.setAttribute("width",this.width),this.element.setAttribute("height",this.height),this.parent.appendChild(this.element)}},buildInterface:{value:function(){}},sizeInterface:{value:function(){}},colorInterface:{value:function(){}},attachListeners:{value:function(){var _=this;this.interactionTarget=this.interactionTarget||this.element,g.exists&&(this.interactionTarget.addEventListener("touchstart",function(E){return _.preTouch(E)}),this.interactionTarget.addEventListener("touchmove",function(E){return _.preTouchMove(E)}),this.interactionTarget.addEventListener("touchend",function(E){return _.preTouchRelease(E)})),this.boundPreMove=function(E){return _.preMove(E)},this.boundPreRelease=function(E){return _.preRelease(E)},this.interactionTarget.addEventListener("mousedown",function(E){return _.preClick(E)})}},finalTouches:{value:function(){this.element.style.cursor="pointer"}},preClick:{value:function(_){this.element instanceof HTMLElement&&(this.width=window.getComputedStyle(this.element,null).getPropertyValue("width").replace("px","")),this.offset=x.findPosition(this.element),this.mouse=x.locateMouse(_,this.offset),this.clicked=!0,this.click(),this.moveEvent=document.addEventListener("mousemove",this.boundPreMove),this.releaseEvent=document.addEventListener("mouseup",this.boundPreRelease),this.emit("click"),_.preventDefault(),_.stopPropagation()}},preMove:{value:function(_){var E=this;this.wait||(this.mouse=x.locateMouse(_,this.offset),this.move(),this.wait=!0,setTimeout(function(){E.wait=!1},25)),_.preventDefault(),_.stopPropagation()}},preRelease:{value:function(_){this.mouse=x.locateMouse(_,this.offset),this.clicked=!1,this.release(),this.emit("release"),document.removeEventListener("mousemove",this.boundPreMove),document.removeEventListener("mouseup",this.boundPreRelease),_.preventDefault(),_.stopPropagation()}},click:{value:function(){}},move:{value:function(){}},release:{value:function(){}},preTouch:{value:function(_){this.element instanceof HTMLElement&&(this.width=window.getComputedStyle(this.element,null).getPropertyValue("width").replace("px","")),this.offset=x.findPosition(this.element),this.mouse=x.locateTouch(_,this.offset),this.clicked=!0,this.touch(_),this.emit("click"),_.preventDefault(),_.stopPropagation()}},preTouchMove:{value:function(_){this.clicked&&(this.mouse=x.locateTouch(_,this.offset),this.touchMove(),_.preventDefault(),_.stopPropagation())}},preTouchRelease:{value:function(_){this.mouse=x.locateTouch(_,this.offset),this.clicked=!1,this.touchRelease(),this.emit("release"),_.preventDefault(),_.stopPropagation()}},touch:{value:function(){this.click()}},touchMove:{value:function(){this.move()}},touchRelease:{value:function(){this.release()}},resize:{value:function(_,E){this.width=_,this.height=E,this.parent.style.width=this.width+"px",this.parent.style.height=this.height+"px",this.element.setAttribute("width",this.width),this.element.setAttribute("height",this.height),this.sizeInterface()}},empty:{value:function(){for(;this.element.lastChild;)this.element.removeChild(this.element.lastChild)}},destroy:{value:function(){this.empty(),this.parent.removeChild(this.element),this.removeAllListeners(),this.instrument&&delete this.instrument[this.id],this.customDestroy()}},customDestroy:{value:function(){}},colorize:{value:function(_,E){this.colors[_]=E,this.colorInterface()}}}),h}(d);D.exports=l},function(D,P){P.findPosition=function(m){var C=m.getBoundingClientRect(),k=C.top+window.scrollY,M=C.left+window.scrollX;return{top:k,left:M}},P.parseElement=function(m){return typeof m=="string"&&(m=document.getElementById(m.replace("#",""))),m instanceof HTMLElement||m instanceof SVGElement?m:"No valid parent argument"},P.locateMouse=function(m,C){return{x:m.pageX-C.left,y:m.pageY-C.top}},P.locateTouch=function(m,C){return{x:m.targetTouches.length?m.targetTouches[0].pageX-C.left:!1,y:m.targetTouches.length?m.targetTouches[0].pageY-C.top:!1}},P.SmartCanvas=function(m){var C=this;this.element=document.createElement("canvas"),this.context=this.element.getContext("2d"),m.appendChild(this.element),this.resize=function(k,M){C.element.width=k*2,C.element.height=M*2,C.element.style.width=k+"px",C.element.style.height=M+"px"}}},function(D,P){P.isObject=function(m){return typeof m=="object"&&!Array.isArray(m)&&m!==null&&!(m instanceof SVGElement)&&!(m instanceof HTMLElement)},P.setInputFilter=function(m,C){["input","keydown","keyup","mousedown","mouseup","select","contextmenu","drop"].forEach(function(k){m.addEventListener(k,function(){C(this.value)?(this.oldValue=this.value,this.oldSelectionStart=this.selectionStart,this.oldSelectionEnd=this.selectionEnd):this.hasOwnProperty("oldValue")?(this.value=this.oldValue,this.setSelectionRange(this.oldSelectionStart,this.oldSelectionEnd)):this.value=""})})}},function(D,P){P.exists="ontouchstart"in document.documentElement},function(D,P){function m(){this._events=this._events||{},this._maxListeners=this._maxListeners||void 0}D.exports=m,m.EventEmitter=m,m.prototype._events=void 0,m.prototype._maxListeners=void 0,m.defaultMaxListeners=10,m.prototype.setMaxListeners=function(w){if(!k(w)||w<0||isNaN(w))throw TypeError("n must be a positive number");return this._maxListeners=w,this},m.prototype.emit=function(w){var x,y,g,d,c,l;if(this._events||(this._events={}),w==="error"&&(!this._events.error||M(this._events.error)&&!this._events.error.length)){if(x=arguments[1],x instanceof Error)throw x;var a=new Error('Uncaught, unspecified "error" event. ('+x+")");throw a.context=x,a}if(y=this._events[w],I(y))return!1;if(C(y))switch(arguments.length){case 1:y.call(this);break;case 2:y.call(this,arguments[1]);break;case 3:y.call(this,arguments[1],arguments[2]);break;default:d=Array.prototype.slice.call(arguments,1),y.apply(this,d)}else if(M(y))for(d=Array.prototype.slice.call(arguments,1),l=y.slice(),g=l.length,c=0;c<g;c++)l[c].apply(this,d);return!0},m.prototype.addListener=function(w,x){var y;if(!C(x))throw TypeError("listener must be a function");return this._events||(this._events={}),this._events.newListener&&this.emit("newListener",w,C(x.listener)?x.listener:x),this._events[w]?M(this._events[w])?this._events[w].push(x):this._events[w]=[this._events[w],x]:this._events[w]=x,M(this._events[w])&&!this._events[w].warned&&(I(this._maxListeners)?y=m.defaultMaxListeners:y=this._maxListeners,y&&y>0&&this._events[w].length>y&&(this._events[w].warned=!0,console.error("(node) warning: possible EventEmitter memory leak detected. %d listeners added. Use emitter.setMaxListeners() to increase limit.",this._events[w].length),typeof console.trace=="function"&&console.trace())),this},m.prototype.on=m.prototype.addListener,m.prototype.once=function(w,x){if(!C(x))throw TypeError("listener must be a function");var y=!1;function g(){this.removeListener(w,g),y||(y=!0,x.apply(this,arguments))}return g.listener=x,this.on(w,g),this},m.prototype.removeListener=function(w,x){var y,g,d,c;if(!C(x))throw TypeError("listener must be a function");if(!this._events||!this._events[w])return this;if(y=this._events[w],d=y.length,g=-1,y===x||C(y.listener)&&y.listener===x)delete this._events[w],this._events.removeListener&&this.emit("removeListener",w,x);else if(M(y)){for(c=d;c-- >0;)if(y[c]===x||y[c].listener&&y[c].listener===x){g=c;break}if(g<0)return this;y.length===1?(y.length=0,delete this._events[w]):y.splice(g,1),this._events.removeListener&&this.emit("removeListener",w,x)}return this},m.prototype.removeAllListeners=function(w){var x,y;if(!this._events)return this;if(!this._events.removeListener)return arguments.length===0?this._events={}:this._events[w]&&delete this._events[w],this;if(arguments.length===0){for(x in this._events)x!=="removeListener"&&this.removeAllListeners(x);return this.removeAllListeners("removeListener"),this._events={},this}if(y=this._events[w],C(y))this.removeListener(w,y);else if(y)for(;y.length;)this.removeListener(w,y[y.length-1]);return delete this._events[w],this},m.prototype.listeners=function(w){var x;return!this._events||!this._events[w]?x=[]:C(this._events[w])?x=[this._events[w]]:x=this._events[w].slice(),x},m.prototype.listenerCount=function(w){if(this._events){var x=this._events[w];if(C(x))return 1;if(x)return x.length}return 0},m.listenerCount=function(w,x){return w.listenerCount(x)};function C(w){return typeof w=="function"}function k(w){return typeof w=="number"}function M(w){return typeof w=="object"&&w!==null}function I(w){return w===void 0}},function(D,P,m){var C=function(){function w(x,y){for(var g in y){var d=y[g];d.configurable=!0,d.value&&(d.writable=!0)}Object.defineProperties(x,y)}return function(x,y,g){return y&&w(x.prototype,y),g&&w(x,g),x}}(),k=function(w,x){if(!(w instanceof x))throw new TypeError("Cannot call a class as a function")},M=m(5),I=function(){function w(){var x=arguments[0]===void 0?0:arguments[0],y=arguments[1]===void 0?1:arguments[1],g=arguments[2]===void 0?0:arguments[2],d=arguments[3]===void 0?0:arguments[3];k(this,w),this.min=x,this.max=y,this.step=g,this.value=d,this.changed=!1,this.oldValue=!1,this.update(this.value)}return C(w,{update:{value:function(y){return this.step?this.value=M.clip(Math.round((y-this.min)/this.step)*this.step+this.min,this.min,this.max):this.value=M.clip(y,this.min,this.max),this.oldValue!==this.value?(this.oldValue=this.value,this.changed=!0):this.changed=!1,this.value}},updateNormal:{value:function(y){return this.value=M.scale(y,0,1,this.min,this.max),this.update(this.value)}},normalized:{get:function(){return M.normalize(this.value,this.min,this.max)}}}),w}();D.exports=I},function(D,P,m){var C=function(x){return x&&x.__esModule?x.default:x},k=function(){function x(y,g){for(var d in g){var c=g[d];c.configurable=!0,c.value&&(c.writable=!0)}Object.defineProperties(y,g)}return function(y,g,d){return g&&x(y.prototype,g),d&&x(y,d),y}}(),M=function(x,y){if(!(x instanceof y))throw new TypeError("Cannot call a class as a function")};Object.defineProperty(P,"__esModule",{value:!0});var I=C(m(5)),w=C(m(13));P.Handle=function(){function x(){var y=arguments[0]===void 0?"absolute":arguments[0],g=arguments[1]===void 0?"vertical":arguments[1],d=arguments[2]===void 0?[0,100]:arguments[2],c=arguments[3]===void 0?[0,100]:arguments[3];M(this,x),this.mode=y,this.direction=g,this.previous=0,this.value=0,this.sensitivity=1,this.resize(d,c)}return k(x,{resize:{value:function(g,d){this.boundary={min:{x:g[0],y:d[0]},max:{x:g[1],y:d[1]},center:{x:(g[1]-g[0])/2+g[0],y:(d[1]-d[0])/2+d[0]}}}},anchor:{set:function(y){this._anchor=this.convertPositionToValue(y)},get:function(){return this._anchor}},update:{value:function(g){if(this.mode==="relative"){var d=this.convertPositionToValue(g)-this.anchor;Math.abs(d)>.5&&(d=0),this.anchor=g,this.value=this.value+d*this.sensitivity}else this.value=this.convertPositionToValue(g);this.value=I.clip(this.value,0,1)}},convertPositionToValue:{value:function(g){switch(this.direction){case"radial":var d=I.toPolar(g.x-this.boundary.center.x,g.y-this.boundary.center.y);return d=d.angle/(Math.PI*2),d=(d-.25+1)%1,d;case"vertical":return I.scale(g.y,this.boundary.min.y,this.boundary.max.y,0,1);case"horizontal":return I.scale(g.x,this.boundary.min.x,this.boundary.max.x,0,1)}}}}),x}(),P.Button=function(){function x(){var y=arguments[0]===void 0?"button":arguments[0];M(this,x),this.mode=y,this.state=new w,this.paintbrush=!1}return k(x,{click:{value:function(){switch(this.mode){case"impulse":this.state.on(),this.timeout&&clearTimeout(this.timeout),this.timeout=setTimeout(this.state.off.bind(this),30),this.emit("change",this.state);break;case"button":this.turnOn(),this.emit("change",this.state);break;case"aftertouch":this.position={x:I.clip(this.mouse.x/this.width,0,1),y:I.clip(1-this.mouse.y/this.height,0,1)},this.turnOn(),this.emit("change",{state:this.state,x:this.position.x,y:this.position.y});break;case"toggle":this.flip(),this.emit("change",this.state);break}}},move:{value:function(){this.mode==="aftertouch"&&(this.position={x:I.clip(this.mouse.x/this.width,0,1),y:I.clip(1-this.mouse.y/this.height,0,1)},this.emit("change",{state:this.state,x:this.position.x,y:this.position.y}),this.render())}},release:{value:function(){switch(this.mode){case"button":this.turnOff(),this.emit("change",this.state);break;case"aftertouch":this.turnOff(),this.position={x:this.mouse.x/this.width,y:1-this.mouse.y/this.height},this.emit("change",{state:this.state,x:this.position.x,y:this.position.y});break}}}}),x}()},function(D,P){var m=function(){function M(I,w){for(var x in w){var y=w[x];y.configurable=!0,y.value&&(y.writable=!0)}Object.defineProperties(I,w)}return function(I,w,x){return w&&M(I.prototype,w),x&&M(I,x),I}}(),C=function(M,I){if(!(M instanceof I))throw new TypeError("Cannot call a class as a function")},k=function(){function M(I){C(this,M),this.state=I||!1}return m(M,{flip:{value:function(w){w||w===!1?this.state=w:this.state=!this.state}},on:{value:function(){this.state=!0}},off:{value:function(){this.state=!1}}}),M}();D.exports=k},function(D,P,m){var C=function(l){return l&&l.__esModule?l:{default:l}},k=function(){function l(a,h){for(var v in h){var _=h[v];_.configurable=!0,_.value&&(_.writable=!0)}Object.defineProperties(a,h)}return function(a,h,v){return h&&l(a.prototype,h),v&&l(a,v),a}}(),M=function l(a,h,v){var _=Object.getOwnPropertyDescriptor(a,h);if(_===void 0){var E=Object.getPrototypeOf(a);return E===null?void 0:l(E,h,v)}else{if("value"in _&&_.writable)return _.value;var V=_.get;return V===void 0?void 0:V.call(v)}},I=function(l,a){if(typeof a!="function"&&a!==null)throw new TypeError("Super expression must either be null or a function, not "+typeof a);l.prototype=Object.create(a&&a.prototype,{constructor:{value:l,enumerable:!1,writable:!0,configurable:!0}}),a&&(l.__proto__=a)},w=function(l,a){if(!(l instanceof a))throw new TypeError("Cannot call a class as a function")},x=m(4),y=m(6),g=m(11),d=C(m(12)),c=function(l){function a(){w(this,a);var h=["min","max","value"],v={size:[120,20],mode:"relative",min:0,max:1,step:0,value:0};M(Object.getPrototypeOf(a.prototype),"constructor",this).call(this,arguments,h,v),this.orientation="vertical",this._value=new g(this.settings.min,this.settings.max,this.settings.step,this.settings.value),this.position=new d.Handle(this.settings.mode,this.orientation,[0,this.width],[this.height,0]),this.position.value=this._value.normalized,this.init(),this.position.direction=this.orientation,this.emit("change",this.value)}return I(a,l),k(a,{buildInterface:{value:function(){this.bar=x.create("rect"),this.fillbar=x.create("rect"),this.knob=x.create("circle"),this.element.appendChild(this.bar),this.element.appendChild(this.fillbar),this.element.appendChild(this.knob)}},sizeInterface:{value:function(){this.width<this.height?(this.orientation="vertical",this.position.direction="vertical"):(this.orientation="horizontal",this.position.direction="horizontal"),this.position&&this.position.resize([0,this.width],[this.height,0]);var v=void 0,_=void 0,E=void 0,V=void 0,L=void 0,Q=void 0;this.knobData={level:0,r:0},this.orientation==="vertical"?(this.thickness=this.width/2,v=this.width/2,_=0,E=this.thickness,V=this.height,this.knobData.r=this.thickness*.8,this.knobData.level=V-this.knobData.r-this.normalized*(V-this.knobData.r*2),L="translate("+this.thickness*-1/2+",0)",Q=E/2):(this.thickness=this.height/2,v=0,_=this.height/2,E=this.width,V=this.thickness,this.knobData.r=this.thickness*.8,this.knobData.level=this.normalized*(E-this.knobData.r*2)+this.knobData.r,L="translate(0,"+this.thickness*-1/2+")",Q=V/2),this.bar.setAttribute("x",v),this.bar.setAttribute("y",_),this.bar.setAttribute("transform",L),this.bar.setAttribute("rx",Q),this.bar.setAttribute("ry",Q),this.bar.setAttribute("width",E),this.bar.setAttribute("height",V),this.orientation==="vertical"?(this.fillbar.setAttribute("x",v),this.fillbar.setAttribute("y",this.knobData.level),this.fillbar.setAttribute("width",E),this.fillbar.setAttribute("height",V-this.knobData.level)):(this.fillbar.setAttribute("x",0),this.fillbar.setAttribute("y",_),this.fillbar.setAttribute("width",this.knobData.level),this.fillbar.setAttribute("height",V)),this.fillbar.setAttribute("transform",L),this.fillbar.setAttribute("rx",Q),this.fillbar.setAttribute("ry",Q),this.orientation==="vertical"?(this.knob.setAttribute("cx",v),this.knob.setAttribute("cy",this.knobData.level)):(this.knob.setAttribute("cx",this.knobData.level),this.knob.setAttribute("cy",_)),this.knob.setAttribute("r",this.knobData.r)}},colorInterface:{value:function(){this.bar.setAttribute("fill",this.colors.fill),this.fillbar.setAttribute("fill",this.colors.accent),this.knob.setAttribute("fill",this.colors.accent)}},render:{value:function(){this.clicked||(this.knobData.r=this.thickness*.75),this.knob.setAttribute("r",this.knobData.r),this.orientation==="vertical"?(this.knobData.level=this.knobData.r+this._value.normalized*(this.height-this.knobData.r*2),this.knob.setAttribute("cy",this.height-this.knobData.level),this.fillbar.setAttribute("y",this.height-this.knobData.level),this.fillbar.setAttribute("height",this.knobData.level)):(this.knobData.level=this._value.normalized*(this.width-this.knobData.r*2)+this.knobData.r,this.knob.setAttribute("cx",this.knobData.level),this.fillbar.setAttribute("x",0),this.fillbar.setAttribute("width",this.knobData.level))}},click:{value:function(){this.knobData.r=this.thickness*.9,this.position.anchor=this.mouse,this.move()}},move:{value:function(){this.clicked&&(this.position.update(this.mouse),this._value.updateNormal(this.position.value),this.emit("change",this._value.value),this.render())}},release:{value:function(){this.render()}},normalized:{get:function(){return this._value.normalized}},value:{get:function(){return this._value.value},set:function(h){this._value.update(h),this.position.value=this._value.normalized,this.emit("change",this._value.value),this.render()}},min:{get:function(){return this._value.min},set:function(h){this._value.min=h}},max:{get:function(){return this._value.max},set:function(h){this._value.max=h}},step:{get:function(){return this._value.step},set:function(h){this._value.step=h}},mode:{get:function(){return this.position.mode},set:function(h){this.position.mode=h}}}),a}(y);D.exports=c},function(D,P,m){var C=function(){function d(c,l){for(var a in l){var h=l[a];h.configurable=!0,h.value&&(h.writable=!0)}Object.defineProperties(c,l)}return function(c,l,a){return l&&d(c.prototype,l),a&&d(c,a),c}}(),k=function d(c,l,a){var h=Object.getOwnPropertyDescriptor(c,l);if(h===void 0){var v=Object.getPrototypeOf(c);return v===null?void 0:d(v,l,a)}else{if("value"in h&&h.writable)return h.value;var _=h.get;return _===void 0?void 0:_.call(a)}},M=function(d,c){if(typeof c!="function"&&c!==null)throw new TypeError("Super expression must either be null or a function, not "+typeof c);d.prototype=Object.create(c&&c.prototype,{constructor:{value:d,enumerable:!1,writable:!0,configurable:!0}}),c&&(d.__proto__=c)},I=function(d,c){if(!(d instanceof c))throw new TypeError("Cannot call a class as a function")},w=m(4),x=m(13),y=m(6),g=function(d){function c(){I(this,c);var l=["value"],a={size:[40,20],target:!1,state:!1};k(Object.getPrototypeOf(c.prototype),"constructor",this).call(this,arguments,l,a),this._state=new x(this.settings.state),this.init()}return M(c,d),C(c,{buildInterface:{value:function(){this.bar=w.create("rect"),this.knob=w.create("circle"),this.element.appendChild(this.bar),this.element.appendChild(this.knob)}},sizeInterface:{value:function(){this.height<this.width/2?this.knobSize=this.height/2:this.knobSize=this.width/4,this.bar.setAttribute("x",this.width/2-this.knobSize*1.5),this.bar.setAttribute("y",this.height/2-this.knobSize/2),this.bar.setAttribute("rx",this.knobSize/2),this.bar.setAttribute("ry",this.knobSize/2),this.bar.setAttribute("width",this.knobSize*3),this.bar.setAttribute("height",this.knobSize),this.knob.setAttribute("cx",this.width/2-this.knobSize),this.knob.setAttribute("cy",this.height/2),this.knob.setAttribute("r",this.knobSize)}},colorInterface:{value:function(){this.knob.setAttribute("fill",this.colors.accent),this.render()}},render:{value:function(){this.state?(this.knob.setAttribute("cx",this.width/2+this.knobSize),this.bar.setAttribute("fill",this.colors.accent)):(this.knob.setAttribute("cx",this.width/2-this.knobSize),this.bar.setAttribute("fill",this.colors.fill))}},click:{value:function(){this.flip(),this.render(),this.emit("change",this.state)}},state:{get:function(){return this._state.state},set:function(l){this._state.flip(l),this.emit("change",this.state),this.render()}},flip:{value:function(){this._state.flip(),this.render()}}}),c}(y);D.exports=g},function(D,P,m){var C=function(){function g(d,c){for(var l in c){var a=c[l];a.configurable=!0,a.value&&(a.writable=!0)}Object.defineProperties(d,c)}return function(d,c,l){return c&&g(d.prototype,c),l&&g(d,l),d}}(),k=function g(d,c,l){var a=Object.getOwnPropertyDescriptor(d,c);if(a===void 0){var h=Object.getPrototypeOf(d);return h===null?void 0:g(h,c,l)}else{if("value"in a&&a.writable)return a.value;var v=a.get;return v===void 0?void 0:v.call(l)}},M=function(g,d){if(typeof d!="function"&&d!==null)throw new TypeError("Super expression must either be null or a function, not "+typeof d);g.prototype=Object.create(d&&d.prototype,{constructor:{value:g,enumerable:!1,writable:!0,configurable:!0}}),d&&(g.__proto__=d)},I=function(g,d){if(!(g instanceof d))throw new TypeError("Cannot call a class as a function")},w=m(4),x=m(17),y=function(g){function d(){I(this,d);var c=["mode"],l={size:[80,80],mode:"aftertouch",state:!1};k(Object.getPrototypeOf(d.prototype),"constructor",this).call(this,arguments,c,l),this.mode=this.settings.mode,this.init(),this.render()}return M(d,g),C(d,{buildInterface:{value:function(){this.pad=w.create("circle"),this.element.appendChild(this.pad),this.interactionTarget=this.pad,this.defs=w.create("defs"),this.element.appendChild(this.defs),this.gradient=w.radialGradient(this.defs,2),this.gradient.stops[0].setAttribute("offset","30%"),this.gradient.stops[1].setAttribute("offset","100%")}},sizeInterface:{value:function(){this.pad.setAttribute("cx",this.width/2),this.pad.setAttribute("cy",this.height/2),this.pad.setAttribute("r",Math.min(this.width,this.height)/2-this.width/40),this.pad.setAttribute("stroke-width",this.width/20)}},colorInterface:{value:function(){this.gradient.stops[0].setAttribute("stop-color",this.colors.accent),this.gradient.stops[1].setAttribute("stop-color",this.colors.fill),this.render()}},render:{value:function(){this.state?(this.mode==="aftertouch"?(this.pad.setAttribute("stroke","url(#"+this.gradient.id+")"),this.gradient.element.setAttribute("cx",this.position.x*100+"%"),this.gradient.element.setAttribute("cy",(1-this.position.y)*100+"%")):this.pad.setAttribute("stroke",this.colors.accent),this.pad.setAttribute("fill",this.colors.accent)):(this.pad.setAttribute("fill",this.colors.fill),this.pad.setAttribute("stroke",this.colors.mediumLight))}}}),d}(x);D.exports=y},function(D,P,m){var C=function(){function c(l,a){for(var h in a){var v=a[h];v.configurable=!0,v.value&&(v.writable=!0)}Object.defineProperties(l,a)}return function(l,a,h){return a&&c(l.prototype,a),h&&c(l,h),l}}(),k=function c(l,a,h){var v=Object.getOwnPropertyDescriptor(l,a);if(v===void 0){var _=Object.getPrototypeOf(l);return _===null?void 0:c(_,a,h)}else{if("value"in v&&v.writable)return v.value;var E=v.get;return E===void 0?void 0:E.call(h)}},M=function(c,l){if(typeof l!="function"&&l!==null)throw new TypeError("Super expression must either be null or a function, not "+typeof l);c.prototype=Object.create(l&&l.prototype,{constructor:{value:c,enumerable:!1,writable:!0,configurable:!0}}),l&&(c.__proto__=l)},I=function(c,l){if(!(c instanceof l))throw new TypeError("Cannot call a class as a function")},w=m(4),x=m(5),y=m(13),g=m(6),d=function(c){function l(a,h,v){I(this,l),k(Object.getPrototypeOf(l.prototype),"constructor",this).call(this,a,h,v),this.mode=this.settings.mode||"button",this.position={x:0,y:0},this._state=new y(this.settings.state)}return M(l,c),C(l,{buildInterface:{value:function(){this.pad=w.create("circle"),this.pad.setAttribute("fill","#d18"),this.pad.setAttribute("stroke","#d18"),this.pad.setAttribute("stroke-width",4),this.element.appendChild(this.pad),this.interactionTarget=this.pad,this.sizeInterface()}},sizeInterface:{value:function(){this.pad.setAttribute("cx",this.width/2),this.pad.setAttribute("cy",this.height/2),this.pad.setAttribute("r",Math.min(this.width,this.height)/2-2)}},render:{value:function(){this.state?(this.pad.setAttribute("fill",this.colors.accent),this.pad.setAttribute("stroke",this.colors.accent)):(this.pad.setAttribute("fill",this.colors.fill),this.pad.setAttribute("stroke",this.colors.mediumLight))}},down:{value:function(h){switch(this.mode){case"impulse":this.turnOn(),this.timeout&&clearTimeout(this.timeout),this.timeout=setTimeout(this.turnOff.bind(this),30);break;case"button":this.turnOn();break;case"aftertouch":this.position={x:x.clip(this.mouse.x/this.width,0,1),y:x.clip(1-this.mouse.y/this.height,0,1)},this.turnOn();break;case"toggle":this.flip(h);break}}},bend:{value:function(h){this.mode==="aftertouch"&&(this.mouse=h||this.mouse,this.position={x:x.clip(this.mouse.x/this.width,0,1),y:x.clip(1-this.mouse.y/this.height,0,1)},this.emit("change",{state:this.state,x:this.position.x,y:this.position.y}),this.render())}},up:{value:function(){switch(this.mode){case"button":this.turnOff();break;case"aftertouch":this.turnOff(),this.position={x:x.clip(this.mouse.x/this.width,0,1),y:x.clip(1-this.mouse.y/this.height,0,1)};break}}},click:{value:function(){this.down()}},move:{value:function(){this.bend()}},release:{value:function(){this.up()}},state:{get:function(){return this._state.state},set:function(a){this._state.flip(a),this.mode==="aftertouch"?this.emit("change",{state:this.state,x:this.position.x,y:this.position.y}):this.emit("change",this.state),this.render()}},flip:{value:function(h){this._state.flip(h),this.mode==="aftertouch"?this.emit("change",{state:this.state,x:this.position.x,y:this.position.y}):this.emit("change",this.state),this.render()}},turnOn:{value:function(h){this._state.on(),h!==!1&&(this.mode==="aftertouch"?this.emit("change",{state:this.state,x:this.position.x,y:this.position.y}):this.emit("change",this.state)),this.render()}},turnOff:{value:function(h){this._state.off(),h!==!1&&(this.mode==="aftertouch"?this.emit("change",{state:this.state,x:this.position.x,y:this.position.y}):this.emit("change",this.state)),this.render()}}}),l}(g);D.exports=d},function(D,P,m){var C=function(){function y(g,d){for(var c in d){var l=d[c];l.configurable=!0,l.value&&(l.writable=!0)}Object.defineProperties(g,d)}return function(g,d,c){return d&&y(g.prototype,d),c&&y(g,c),g}}(),k=function y(g,d,c){var l=Object.getOwnPropertyDescriptor(g,d);if(l===void 0){var a=Object.getPrototypeOf(g);return a===null?void 0:y(a,d,c)}else{if("value"in l&&l.writable)return l.value;var h=l.get;return h===void 0?void 0:h.call(c)}},M=function(y,g){if(typeof g!="function"&&g!==null)throw new TypeError("Super expression must either be null or a function, not "+typeof g);y.prototype=Object.create(g&&g.prototype,{constructor:{value:y,enumerable:!1,writable:!0,configurable:!0}}),g&&(y.__proto__=g)},I=function(y,g){if(!(y instanceof g))throw new TypeError("Cannot call a class as a function")},w=m(17),x=function(y){function g(){I(this,g);var d=["value"],c={size:[150,50],state:!1,text:"Play"};k(Object.getPrototypeOf(g.prototype),"constructor",this).call(this,arguments,d,c),this._text=this.settings.text,this.settings.alternate&&(this.settings.alternateText=this.settings.alternate,console.warn("'alternate' initiator is deprecated. Use 'alternateText' instead.")),this._alternateText=this.settings.alternateText,this.mode=this.settings.alternateText?"toggle":"button",this.init(),this.render(),this.state=this.settings.state}return M(g,y),C(g,{buildFrame:{value:function(){this.element=document.createElement("div"),this.parent.appendChild(this.element),this.textElement=document.createElement("div"),this.textElement.innerHTML=this._text,this.element.appendChild(this.textElement)}},buildInterface:{value:function(){}},colorInterface:{value:function(){this.element.style.color=this.colors.dark,this.render()}},sizeInterface:{value:function(){var c=this.height/3,l=this.width/(this._text.length+2);if(c=Math.min(c,l),this.alternateText){var a=this.width/(this.alternateText.length+2);c=Math.min(c,a)}var h="width: "+this.width+"px;";h+="height: "+this.height+"px;",h+="padding: "+(this.height-c)/2+"px 0px;",h+="box-sizing: border-box;",h+="text-align: center;",h+="font-family: inherit;",h+="font-weight: 700;",h+="opacity: 1;",h+="font-size:"+c+"px;",this.textElement.style.cssText=h,this.render()}},render:{value:function(){this.state?(this.element.style.backgroundColor=this.colors.accent,this.textElement.style.color=this.colors.fill,this.alternateText?this.textElement.innerHTML=this._alternateText:this.textElement.innerHTML=this._text):(this.element.style.backgroundColor=this.colors.fill,this.textElement.style.color=this.colors.dark,this.textElement.innerHTML=this._text)}},alternateText:{get:function(){return this._alternateText},set:function(d){d?this.mode="toggle":this.mode="button",this._alternateText=d,this.render()}},text:{get:function(){return this._text},set:function(d){this._text=d,this.sizeInterface(),this.render()}}}),g}(w);D.exports=x},function(D,P,m){var C=function(){function g(d,c){for(var l in c){var a=c[l];a.configurable=!0,a.value&&(a.writable=!0)}Object.defineProperties(d,c)}return function(d,c,l){return c&&g(d.prototype,c),l&&g(d,l),d}}(),k=function g(d,c,l){var a=Object.getOwnPropertyDescriptor(d,c);if(a===void 0){var h=Object.getPrototypeOf(d);return h===null?void 0:g(h,c,l)}else{if("value"in a&&a.writable)return a.value;var v=a.get;return v===void 0?void 0:v.call(l)}},M=function(g,d){if(typeof d!="function"&&d!==null)throw new TypeError("Super expression must either be null or a function, not "+typeof d);g.prototype=Object.create(d&&d.prototype,{constructor:{value:g,enumerable:!1,writable:!0,configurable:!0}}),d&&(g.__proto__=d)},I=function(g,d){if(!(g instanceof d))throw new TypeError("Cannot call a class as a function")},w=m(6),x=m(16),y=function(g){function d(){I(this,d);var c=["value"],l={size:[120,25],numberOfButtons:4,active:-1};k(Object.getPrototypeOf(d.prototype),"constructor",this).call(this,arguments,c,l),this.buttons=[],this._numberOfButtons=this.settings.numberOfButtons,this.active=this.settings.active,this.init(),this.render()}return M(d,g),C(d,{buildFrame:{value:function(){this.element=document.createElement("div"),this.parent.appendChild(this.element)}},buildInterface:{value:function(){for(var l=0;l<this._numberOfButtons;l++){var a=document.createElement("span"),h=new x(a,{mode:"toggle",component:!0},this.update.bind(this,l));this.buttons.push(h),this.element.appendChild(a)}}},sizeInterface:{value:function(){var l=void 0;this.width>this.height?l="horizontal":l="vertical";for(var a=this.width/(l==="vertical"?1:this._numberOfButtons),h=this.height/(l==="vertical"?this._numberOfButtons:1),v=0;v<this._numberOfButtons;v++)this.buttons[v].resize(a,h)}},colorInterface:{value:function(){for(var l=0;l<this._numberOfButtons;l++)this.buttons[l].colors=this.colors,this.buttons[l].render()}},update:{value:function(l){this.buttons[l].state?this.select(l):this.deselect()}},render:{value:function(){for(var l=0;l<this.buttons.length;l++)l===this.active?this.buttons[l].turnOn(!1):this.buttons[l].turnOff(!1)}},select:{value:function(l){l>=0&&l<this.buttons.length&&(this.active=l,this.emit("change",this.active),this.render())}},deselect:{value:function(){this.active=-1,this.emit("change",this.active),this.render()}},numberOfButtons:{get:function(){return this._numberOfButtons},set:function(c){this._numberOfButtons=c;for(var l=0;l<this.buttons.length;l++)this.buttons[l].destroy();this.buttons=[],this.empty(),this.buildInterface()}}}),d}(w);D.exports=y},function(D,P,m){var C=function(){function c(l,a){for(var h in a){var v=a[h];v.configurable=!0,v.value&&(v.writable=!0)}Object.defineProperties(l,a)}return function(l,a,h){return a&&c(l.prototype,a),h&&c(l,h),l}}(),k=function c(l,a,h){var v=Object.getOwnPropertyDescriptor(l,a);if(v===void 0){var _=Object.getPrototypeOf(l);return _===null?void 0:c(_,a,h)}else{if("value"in v&&v.writable)return v.value;var E=v.get;return E===void 0?void 0:E.call(h)}},M=function(c,l){if(typeof l!="function"&&l!==null)throw new TypeError("Super expression must either be null or a function, not "+typeof l);c.prototype=Object.create(l&&l.prototype,{constructor:{value:c,enumerable:!1,writable:!0,configurable:!0}}),l&&(c.__proto__=l)},I=function(c,l){if(!(c instanceof l))throw new TypeError("Cannot call a class as a function")},w=m(6),x=m(11),y=m(5),g=m(8),d=function(c){function l(){I(this,l);var a=["value"],h={size:[60,30],value:0,min:0,max:2e4,step:1};k(Object.getPrototypeOf(l.prototype),"constructor",this).call(this,arguments,a,h),this._value=new x(this.settings.min,this.settings.max,this.settings.step,this.settings.value),this.decimalPlaces=2,this.actual=0,this.max=this._value.max,this.min=this._value.min,this.step=this._value.step,this.init(),this.render()}return M(l,c),C(l,{buildFrame:{value:function(){this.element=document.createElement("input"),this.element.type="text",this.element.addEventListener("blur",(function(){this.element.style.backgroundColor=this.colors.fill,this.element.style.color=this.colors.dark,this.element.value!==this.value&&(this.value=parseFloat(this.element.value),this.render())}).bind(this)),g.setInputFilter(this.element,function(h){return/^-?\d*\.?\d*$/.test(h)}),this.element.addEventListener("keydown",(function(h){h.which===13&&(this.element.blur(),this.value=this.element.value,this.emit("change",this.value),this.render())}).bind(this),!0),this.parent.appendChild(this.element)}},sizeInterface:{value:function(){this._minDimension=Math.min(this.width,this.height);var h="width: "+this.width+"px;";h+="height: "+this.height+"px;",h+="background-color: #e7e7e7;",h+="color: #333;",h+="font-family: arial;",h+="font-weight: 500;",h+="font-size:"+this._minDimension/2+"px;",h+="border: none;",h+="outline: none;",h+="padding: "+this._minDimension/4+"px "+this._minDimension/4+"px;",h+="box-sizing: border-box;",h+="userSelect: text;",h+="mozUserSelect: text;",h+="webkitUserSelect: text;",this.element.style.cssText+=h,this.element.value=this.value}},colorInterface:{value:function(){this.element.style.backgroundColor=this.colors.fill,this.element.style.color=this.colors.dark}},render:{value:function(){this.element.value=y.prune(this.value,this.decimalPlaces)}},click:{value:function(){this.hasMoved=!1,this.element.readOnly=!0,this.actual=this.value,this.initial={y:this.mouse.y},this.changeFactor=y.invert(this.mouse.x/this.width)}},move:{value:function(){if(this.hasMoved=!0,this.clicked){var h=this.actual-(this.mouse.y-this.initial.y)*(y.clip(this.max-this.min,0,1e3)/200)*Math.pow(this.changeFactor,2);this.value=h,this.render(),this._value.changed&&this.emit("change",this.value)}}},release:{value:function(){this.hasMoved?document.body.focus():(this.element.readOnly=!1,this.element.focus(),this.element.setSelectionRange(0,this.element.value.length),this.element.style.backgroundColor=this.colors.accent,this.element.style.color=this.colors.light)}},link:{value:function(h){var v=this;this.min=h.min,this.max=h.max,this.step=h.step,h.on("change",function(_){v.passiveUpdate(_)}),this.on("change",function(_){h.value=_}),this.value=h.value}},passiveUpdate:{value:function(h){this._value.update(h),this.render()}},value:{get:function(){return this._value.value},set:function(a){this._value.update(a),this.emit("change",this.value),this.render()}},min:{get:function(){return this._value.min},set:function(a){this._value.min=a}},max:{get:function(){return this._value.max},set:function(a){this._value.max=a}},step:{get:function(){return this._value.step},set:function(a){this._value.step=a}}}),l}(w);D.exports=d},function(D,P,m){var C=function(){function y(g,d){for(var c in d){var l=d[c];l.configurable=!0,l.value&&(l.writable=!0)}Object.defineProperties(g,d)}return function(g,d,c){return d&&y(g.prototype,d),c&&y(g,c),g}}(),k=function y(g,d,c){var l=Object.getOwnPropertyDescriptor(g,d);if(l===void 0){var a=Object.getPrototypeOf(g);return a===null?void 0:y(a,d,c)}else{if("value"in l&&l.writable)return l.value;var h=l.get;return h===void 0?void 0:h.call(c)}},M=function(y,g){if(typeof g!="function"&&g!==null)throw new TypeError("Super expression must either be null or a function, not "+typeof g);y.prototype=Object.create(g&&g.prototype,{constructor:{value:y,enumerable:!1,writable:!0,configurable:!0}}),g&&(y.__proto__=g)},I=function(y,g){if(!(y instanceof g))throw new TypeError("Cannot call a class as a function")},w=m(6),x=function(y){function g(){I(this,g);var d=["value"],c={size:[100,30],options:["default","options"]};k(Object.getPrototypeOf(g.prototype),"constructor",this).call(this,arguments,d,c),this._selectedIndex=-1,this._value=!1,this._options=this.settings.options,this.init(),this.render()}return M(g,y),C(g,{buildFrame:{value:function(){this.element=document.createElement("select"),this.element.style.fontSize=this.height/2+"px",this.element.style.outline="none",this.element.style.highlight="none",this.element.style.width=this.width+"px",this.element.style.height=this.height+"px",this.boundRender=this.render.bind(this),this.element.addEventListener("change",this.boundRender),this.parent.appendChild(this.element)}},attachListeners:{value:function(){}},buildInterface:{value:function(){this.defineOptions()}},colorInterface:{value:function(){this.element.style.backgroundColor=this.colors.fill,this.element.style.color=this.colors.dark,this.element.style.border="solid 0px "+this.colors.mediumLight}},render:{value:function(){this._value=this.element.options[this.element.selectedIndex].text,this._selectedIndex=this.element.selectedIndex,this.emit("change",{value:this._value,index:this._selectedIndex})}},click:{value:function(){}},move:{value:function(){}},release:{value:function(){}},defineOptions:{value:function(c){c&&(this._options=c);for(var l=this.element.options.length-1;l>=0;l--)this.element.remove(l);for(var l=0;l<this._options.length;l++)this.element.options.add(new Option(this._options[l],l))}},value:{get:function(){return this._value},set:function(d){this._value=d;for(var c=0;c<this.element.options.length;c++)if(d===this.element.options[c].text){this.selectedIndex=c;break}}},selectedIndex:{get:function(){return this._selectedIndex},set:function(d){this._selectedIndex=d,this.element.selectedIndex=d,this.render()}},customDestroy:{value:function(){this.element.removeEventListener("change",this.boundRender)}}}),g}(w);D.exports=x},function(D,P,m){var C=function(a){return a&&a.__esModule?a:{default:a}},k=function(){function a(h,v){for(var _ in v){var E=v[_];E.configurable=!0,E.value&&(E.writable=!0)}Object.defineProperties(h,v)}return function(h,v,_){return v&&a(h.prototype,v),_&&a(h,_),h}}(),M=function a(h,v,_){var E=Object.getOwnPropertyDescriptor(h,v);if(E===void 0){var V=Object.getPrototypeOf(h);return V===null?void 0:a(V,v,_)}else{if("value"in E&&E.writable)return E.value;var L=E.get;return L===void 0?void 0:L.call(_)}},I=function(a,h){if(typeof h!="function"&&h!==null)throw new TypeError("Super expression must either be null or a function, not "+typeof h);a.prototype=Object.create(h&&h.prototype,{constructor:{value:a,enumerable:!1,writable:!0,configurable:!0}}),h&&(a.__proto__=h)},w=function(a,h){if(!(a instanceof h))throw new TypeError("Cannot call a class as a function")},x=m(4),y=m(5),g=m(6),d=m(11),c=C(m(12)),l=function(a){function h(){w(this,h);var v=["min","max","value"],_={size:[75,75],interaction:"radial",mode:"relative",min:0,max:1,step:0,value:0};M(Object.getPrototypeOf(h.prototype),"constructor",this).call(this,arguments,v,_),this.interaction=this.settings.interaction,this._value=new d(this.settings.min,this.settings.max,this.settings.step,this.settings.value),this.position=new c.Handle(this.settings.mode,this.interaction,[0,this.width],[this.height,0]),this.init(),this.value=this._value.value,this.position.value=this._value.normalized,this.previousAngle=!1,this.emit("change",this.value)}return I(h,a),k(h,{buildInterface:{value:function(){this.background=x.create("circle"),this.screw=x.create("circle"),this.handle=x.create("path"),this.handle2=x.create("path"),this.handleFill=x.create("path"),this.handle2Fill=x.create("path"),this.handleLine=x.create("path"),this.element.appendChild(this.background),this.element.appendChild(this.handle),this.element.appendChild(this.handle2),this.element.appendChild(this.handleFill),this.element.appendChild(this.handle2Fill),this.element.appendChild(this.handleLine),this.element.appendChild(this.screw)}},sizeInterface:{value:function(){this.position.resize([0,this.width],[this.height,0]);var _={x:this.width/2,y:this.height/2},E=Math.min(this.width,this.height);this.background.setAttribute("cx",_.x),this.background.setAttribute("cy",_.y),this.background.setAttribute("r",E/2-E/40),this.screw.setAttribute("cx",_.x),this.screw.setAttribute("cy",_.y),this.screw.setAttribute("r",E/12);var V=this.value,L={start:Math.PI*1.5,end:y.clip(y.scale(V,0,.5,Math.PI*1.5,Math.PI*.5),Math.PI*.5,Math.PI*1.5)},Q={start:Math.PI*2.5,end:y.clip(y.scale(V,.5,1,Math.PI*2.5,Math.PI*1.5),Math.PI*1.5,Math.PI*2.5)},et=x.arc(_.x,_.y,E/2-E/40,L.start,L.end),st=x.arc(_.x,_.y,E/2-E/40,Q.start,Q.end);this.handle.setAttribute("d",et),this.handle.setAttribute("stroke-width",E/20),this.handle.setAttribute("fill","none"),this.handle2.setAttribute("d",st),this.handle2.setAttribute("stroke-width",E/20),this.handle2.setAttribute("fill","none"),et+=" L "+_.x+" "+_.y,this.handleFill.setAttribute("d",et),this.handleFill.setAttribute("fill-opacity","0.3"),st+=" L "+_.x+" "+_.y,this.handle2Fill.setAttribute("d",st),this.handle2Fill.setAttribute("fill-opacity","0.3");var vt=void 0;V<.5?vt=L.end:vt=Q.end;var St=_.x+Math.cos(vt)*(E/2),kt=_.y+Math.sin(vt)*(E/2)*-1;this.handleLine.setAttribute("d","M "+_.x+" "+_.y+" L "+St+" "+kt),this.handleLine.setAttribute("stroke-width",E/20)}},colorInterface:{value:function(){this.background.setAttribute("fill",this.colors.fill),this.screw.setAttribute("fill",this.colors.accent),this.handle.setAttribute("stroke",this.colors.accent),this.handle2.setAttribute("stroke",this.colors.accent),this.handleFill.setAttribute("fill",this.colors.accent),this.handle2Fill.setAttribute("fill",this.colors.accent),this.handleLine.setAttribute("stroke",this.colors.accent)}},render:{value:function(){var _=this._value.normalized,E={x:this.width/2,y:this.height/2},V=Math.min(this.width,this.height),L={start:Math.PI*1.5,end:y.clip(y.scale(_,0,.5,Math.PI*1.5,Math.PI*.5),Math.PI*.5,Math.PI*1.5)},Q={start:Math.PI*2.5,end:y.clip(y.scale(_,.5,1,Math.PI*2.5,Math.PI*1.5),Math.PI*1.5,Math.PI*2.5)},et=x.arc(E.x,E.y,V/2-V/40,L.start,L.end),st=x.arc(E.x,E.y,V/2-V/40,Q.start,Q.end);this.handle.setAttribute("d",et),this.handle2.setAttribute("d",st),et+=" L "+E.x+" "+E.y,this.handleFill.setAttribute("d",et),st+=" L "+E.x+" "+E.y,this.handle2Fill.setAttribute("d",st);var vt=void 0;_<=.5?vt=L.end:vt=Q.end;var St=E.x+Math.cos(vt)*(V/2),kt=E.y+Math.sin(vt)*(V/2)*-1;this.handleLine.setAttribute("d","M "+E.x+" "+E.y+" L "+St+" "+kt)}},click:{value:function(){this.mode==="relative"&&(this.previousAngle=!1),this.position.anchor=this.mouse,this.position.value=this._value.normalized,this.move()}},move:{value:function(){if(this.clicked){this.position.update(this.mouse);var _=this.position.value*Math.PI*2;_<0&&(_+=Math.PI*2),this.mode==="relative"&&this.previousAngle!==!1&&Math.abs(this.previousAngle-_)>2&&(this.previousAngle>3?_=Math.PI*2:_=0),this.previousAngle=_;var E=_/(Math.PI*2);this.value=this._value.updateNormal(E),this.mode==="relative"&&(this.position.value=E),this.emit("change",this._value.value),this.render()}}},release:{value:function(){}},value:{get:function(){return this._value.value},set:function(v){this._value.update(v),this.position.value=this._value.normalized,this.emit("change",this._value.value),this.render()}},min:{get:function(){return this._value.min},set:function(v){this._value.min=v}},max:{get:function(){return this._value.max},set:function(v){this._value.max=v}},step:{get:function(){return this._value.step},set:function(v){this._value.step=v}},mode:{get:function(){return this.position.mode},set:function(v){this.position.mode=v}},normalized:{get:function(){return this._value.normalized},set:function(v){this._value.updateNormal(v),this.emit("change",this.value)}}}),h}(g);D.exports=l},function(D,P,m){var C=function(){function l(a,h){for(var v in h){var _=h[v];_.configurable=!0,_.value&&(_.writable=!0)}Object.defineProperties(a,h)}return function(a,h,v){return h&&l(a.prototype,h),v&&l(a,v),a}}(),k=function l(a,h,v){var _=Object.getOwnPropertyDescriptor(a,h);if(_===void 0){var E=Object.getPrototypeOf(a);return E===null?void 0:l(E,h,v)}else{if("value"in _&&_.writable)return _.value;var V=_.get;return V===void 0?void 0:V.call(v)}},M=function(l,a){if(typeof a!="function"&&a!==null)throw new TypeError("Super expression must either be null or a function, not "+typeof a);l.prototype=Object.create(a&&a.prototype,{constructor:{value:l,enumerable:!1,writable:!0,configurable:!0}}),a&&(l.__proto__=a)},I=function(l,a){if(!(l instanceof a))throw new TypeError("Cannot call a class as a function")},w=m(4),x=m(6),y=m(17),g=m(9),d=function(l){function a(){I(this,a);var h=["value","note","color"],v={size:[80,80],target:!1,mode:"button",value:0};k(Object.getPrototypeOf(a.prototype),"constructor",this).call(this,arguments,h,v),this.note=this.settings.note,this.color=this.settings.color,this.colors={w:"#fff",b:"#666"},this.init(),this.render()}return M(a,l),C(a,{buildFrame:{value:function(){this.element=w.create("svg"),this.element.setAttribute("width",this.width),this.element.setAttribute("height",this.height),this.parent.appendChild(this.element)}},buildInterface:{value:function(){var v=this;this.pad=w.create("rect"),this.element.appendChild(this.pad),this.interactionTarget=this.pad,g.exists||(this.click=function(){v.piano.interacting=!0,v.piano.paintbrush=!v.state,v.down(v.piano.paintbrush)},this.pad.addEventListener("mouseover",function(){v.piano.interacting&&v.down(v.piano.paintbrush)}),this.move=function(){v.piano.interacting&&v.bend()},this.release=function(){v.piano.interacting=!1},this.pad.addEventListener("mouseup",function(){v.piano.interacting&&v.up()}),this.pad.addEventListener("mouseout",function(){v.piano.interacting&&v.up()}))}},sizeInterface:{value:function(){var v=0;this.pad.setAttribute("x",.5),this.pad.setAttribute("y",.5),this.width>2?this.pad.setAttribute("width",this.width-1):this.pad.setAttribute("width",this.width),this.height>2?this.pad.setAttribute("height",this.height):this.pad.setAttribute("height",this.height),this.pad.setAttribute("rx",v),this.pad.setAttribute("ry",v)}},render:{value:function(){this.state?this.pad.setAttribute("fill",this.colors.accent):this.pad.setAttribute("fill",this.colors[this.color])}}}),a}(y),c=function(l){function a(){I(this,a);var h=["value"],v={size:[500,125],lowNote:24,highNote:60,mode:"button"};k(Object.getPrototypeOf(a.prototype),"constructor",this).call(this,arguments,h,v),this.keyPattern=["w","b","w","b","w","w","b","w","b","w","b","w"],this.paintbrush=!1,this.mode=this.settings.mode,this.range={low:this.settings.lowNote,high:this.settings.highNote},this.range.size=this.range.high-this.range.low+1,this.keys=[],this.toggleTo=!1,this.init(),this.render()}return M(a,l),C(a,{buildFrame:{value:function(){this.element=document.createElement("div"),this.element.style.position="relative",this.element.style.borderRadius="0px",this.element.style.display="block",this.element.style.width="100%",this.element.style.height="100%",this.parent.appendChild(this.element)}},buildInterface:{value:function(){this.keys=[];for(var v=0;v<this.range.size;v++){var _=document.createElement("span"),E=(v+this.range.low)%this.keyPattern.length,V=new d(_,{component:!0,note:v+this.range.low,color:this.keyPattern[E],mode:this.mode},this.keyChange.bind(this,v+this.range.low));V.piano=this,g.exists&&(V.pad.index=v,V.preClick=V.preMove=V.preRelease=function(){},V.click=V.move=V.release=function(){},V.preTouch=V.preTouchMove=V.preTouchRelease=function(){},V.touch=V.touchMove=V.touchRelease=function(){}),this.keys.push(V),this.element.appendChild(_)}g.exists&&this.addTouchListeners()}},sizeInterface:{value:function(){for(var v=0,_=[],E=0;E<this.range.size;E++){_.push(v);var V=(E+this.range.low)%this.keyPattern.length,L=(E+1+this.range.low)%this.keyPattern.length;E+1+this.range.low>=this.range.high||this.keyPattern[V]==="w"&&this.keyPattern[L]==="w"?v+=1:v+=.5}for(var Q=v,et=1,st=(this.width-et*2)/Q,vt=(this.height-et*2)/2,E=0;E<this.keys.length;E++){var St=this.keys[E].parent;St.style.position="absolute",St.style.left=_[E]*st+et+"px",this.keys[E].color==="w"?(St.style.top=et+"px",this.keys[E].resize(st,vt*2)):(St.style.zIndex=1,St.style.top=et+"px",this.keys[E].resize(st,vt*1.1))}}},colorInterface:{value:function(){this.element.style.backgroundColor=this.colors.mediumLight;for(var v=0;v<this.keys.length;v++)this.keys[v].colors={w:this.colors.light,b:this.colors.dark,accent:this.colors.accent,border:this.colors.mediumLight},this.keys[v].colorInterface(),this.keys[v].render()}},keyChange:{value:function(v,_){var E={note:v};typeof _=="object"?E.state=_.state:E.state=_,this.emit("change",E)}},render:{value:function(){}},addTouchListeners:{value:function(){this.preClick=this.preMove=this.preRelease=function(){},this.click=this.move=this.release=function(){},this.preTouch=this.preTouchMove=this.preTouchRelease=function(){},this.touch=this.touchMove=this.touchRelease=function(){};var v={},_=this.keys;function E(et){return{identifier:et.identifier,clientX:et.clientX,clientY:et.clientY}}function V(){var et={};Object.keys(v).forEach(function(st){var vt=v[st],St=document.elementFromPoint(vt.clientX,vt.clientY),kt=St?_[St.index]:null;kt?(et[St.index]=st,kt.state||kt.down()):delete v[st]}),_.forEach(function(st){st.state&&!et[st.pad.index]&&st.up()})}function L(et){et.preventDefault(),et.stopPropagation();for(var st=0;st<et.changedTouches.length;st++){var vt=et.changedTouches[st];v[vt.identifier]=E(vt)}V()}function Q(et){et.preventDefault(),et.stopPropagation();for(var st=0;st<et.changedTouches.length;st++){var vt=et.changedTouches[st];delete v[vt.identifier]}V()}this.element.addEventListener("touchstart",L),this.element.addEventListener("touchmove",L),this.element.addEventListener("touchend",Q)}},setRange:{value:function(v,_){this.range.low=v,this.range.high=_,this.empty(),this.buildInterface()}},toggleKey:{value:function(v,_){this.keys[v-this.range.low].flip(_)}},toggleIndex:{value:function(v,_){this.keys[v].flip(_)}}}),a}(x);D.exports=c},function(D,P,m){var C=function(){function _(E,V){for(var L in V){var Q=V[L];Q.configurable=!0,Q.value&&(Q.writable=!0)}Object.defineProperties(E,V)}return function(E,V,L){return V&&_(E.prototype,V),L&&_(E,L),E}}(),k=function _(E,V,L){var Q=Object.getOwnPropertyDescriptor(E,V);if(Q===void 0){var et=Object.getPrototypeOf(E);return et===null?void 0:_(et,V,L)}else{if("value"in Q&&Q.writable)return Q.value;var st=Q.get;return st===void 0?void 0:st.call(L)}},M=function(_,E){if(typeof E!="function"&&E!==null)throw new TypeError("Super expression must either be null or a function, not "+typeof E);_.prototype=Object.create(E&&E.prototype,{constructor:{value:_,enumerable:!1,writable:!0,configurable:!0}}),E&&(_.__proto__=E)},I=function(_,E){if(!(_ instanceof E))throw new TypeError("Cannot call a class as a function")},w=m(4),x=m(7),y=m(6),g=m(17),d=m(25),c=m(28),l=m(29),a=m(9),h=function(_){function E(){I(this,E);var V=["value"],L={size:[80,80],target:!1,mode:"toggle",value:0,paddingRow:2,paddingColumn:2};k(Object.getPrototypeOf(E.prototype),"constructor",this).call(this,arguments,V,L),this.index=this.settings.index,this.row=this.settings.row,this.column=this.settings.column,this.matrix=this.settings.matrix,this.paddingRow=this.settings.paddingRow||L.paddingRow,this.paddingColumn=this.settings.paddingColumn||L.paddingColumn,this.interacting=!1,this.paintbrush=!1,this.init(),this.render()}return M(E,_),C(E,{buildFrame:{value:function(){this.element=w.create("svg"),this.element.setAttribute("width",this.width),this.element.setAttribute("height",this.height),this.element.style.top="0px",this.element.style.left="0px",this.element.style.position="absolute",this.parent.appendChild(this.element)}},buildInterface:{value:function(){var L=this;this.pad=w.create("rect"),this.element.appendChild(this.pad),this.interactionTarget=this.pad,a.exists||(this.click=function(){L.matrix.interacting=!0,L.matrix.paintbrush=!L.state,L.down(L.matrix.paintbrush)},this.pad.addEventListener("mouseover",function(){L.matrix.interacting&&L.down(L.matrix.paintbrush)}),this.move=function(){},this.pad.addEventListener("mousemove",function(Q){L.matrix.interacting&&(L.offset||(L.offset=x.findPosition(L.element)),L.mouse=x.locateMouse(Q,L.offset),L.bend())}),this.release=function(){L.matrix.interacting=!1},this.pad.addEventListener("mouseup",function(){L.matrix.interacting&&L.up()}),this.pad.addEventListener("mouseout",function(){L.matrix.interacting&&L.up()}))}},sizeInterface:{value:function(){this.pad.setAttribute("x",this.paddingColumn/2),this.pad.setAttribute("y",this.paddingRow/2),this.width>2?this.pad.setAttribute("width",this.width-this.paddingColumn):this.pad.setAttribute("width",this.width),this.height>2?this.pad.setAttribute("height",this.height-this.paddingRow):this.pad.setAttribute("height",this.height),this.pad.setAttribute("fill",this.matrix.colors.fill)}},render:{value:function(){this.state?this.pad.setAttribute("fill",this.matrix.colors.accent):this.pad.setAttribute("fill",this.matrix.colors.fill)}}}),E}(g),v=function(_){function E(){I(this,E);var V=["value"],L={size:[400,200],mode:"toggle",rows:5,columns:10};k(Object.getPrototypeOf(E.prototype),"constructor",this).call(this,arguments,V,L),this.active=-1,this.mode=this.settings.mode,this.interval=new l(200,function(){},!1),this.matrix=new d(this.settings.rows,this.settings.columns),this.matrix.ui=this,this.stepper=new c(0,this.columns),this.paddingRow=this.settings.paddingRow,this.paddingColumn=this.settings.paddingColumn,this.init()}return M(E,_),C(E,{buildFrame:{value:function(){this.element=document.createElement("div"),this.element.style.position="relative",this.element.style.display="block",this.element.style.width="100%",this.element.style.height="100%",this.parent.appendChild(this.element),a.exists&&this.addTouchListeners()}},buildInterface:{value:function(){this.cells=[];for(var L=0;L<this.matrix.length;L++){var Q=this.matrix.locate(L),et=document.createElement("span");et.style.position="absolute";var st=new h(et,{component:!0,index:L,row:Q.row,column:Q.column,mode:this.mode,matrix:this,paddingRow:this.paddingRow,paddingColumn:this.paddingColumn},this.keyChange.bind(this,L));a.exists&&(st.pad.index=L,st.preClick=st.preMove=st.preRelease=function(){},st.click=st.move=st.release=function(){},st.preTouch=st.preTouchMove=st.preTouchRelease=function(){},st.touch=st.touchMove=st.touchRelease=function(){}),this.cells.push(st),this.element.appendChild(et)}this.sizeInterface()}},sizeInterface:{value:function(){for(var L=this.width/this.columns,Q=this.height/this.rows,et=0;et<this.cells.length;et++){var st=this.cells[et].parent;st.style.left=this.cells[et].column*L+"px",st.style.top=this.cells[et].row*Q+"px",this.cells[et].resize(L,Q)}}},colorInterface:{value:function(){for(var L=0;L<this.cells.length;L++)this.cells[L].render()}},update:{value:function(){var L=this;this.matrix.iterate(function(Q,et,st){L.matrix.pattern[Q][et]!==L.cells[st].state&&(L.matrix.pattern[Q][et]>0?L.cells[st].turnOn():L.cells[st].turnOff())})}},keyChange:{value:function(L,Q){var et=this.matrix.locate(L);this.matrix.pattern[et.row][et.column]=Q;var st={row:et.row,column:et.column,state:Q};this.emit("change",st)}},render:{value:function(){var L=this;this.stepper.value>=0&&this.matrix.iterate(function(Q,et,st){et===L.stepper.value?(L.cells[st].pad.setAttribute("stroke",L.colors.mediumLight),L.cells[st].pad.setAttribute("stroke-width","1"),L.cells[st].pad.setAttribute("stroke-opacity","1")):L.cells[st].pad.setAttribute("stroke","none")})}},start:{value:function(L){this.interval.event=this.next.bind(this),L&&this.interval.ms(L),this.interval.start()}},stop:{value:function(){this.interval.stop()}},next:{value:function(){this.stepper.next(),this.emit("step",this.matrix.column(this.stepper.value).reverse()),this.render()}},addTouchListeners:{value:function(){var L=this;this.preClick=this.preMove=this.preRelease=function(){},this.click=this.move=this.release=function(){},this.preTouch=this.preTouchMove=this.preTouchRelease=function(){},this.touch=this.touchMove=this.touchRelease=function(){},this.currentElement=!1,this.element.addEventListener("touchstart",function(Q){var et=document.elementFromPoint(Q.targetTouches[0].clientX,Q.targetTouches[0].clientY),st=L.cells[et.index];L.paintbrush=!st.state,st.down(L.paintbrush),L.currentElement=et.index,Q.preventDefault(),Q.stopPropagation()}),this.element.addEventListener("touchmove",function(Q){var et=document.elementFromPoint(Q.targetTouches[0].clientX,Q.targetTouches[0].clientY),st=L.cells[et.index];if(et.index!==L.currentElement){if(L.currentElement>=0){var vt=L.cells[L.currentElement];vt.up()}st.down(L.paintbrush)}else st.bend();L.currentElement=et.index,Q.preventDefault(),Q.stopPropagation()}),this.element.addEventListener("touchend",function(Q){var et=L.cells[L.currentElement];et.up(),L.interacting=!1,L.currentElement=!1,Q.preventDefault(),Q.stopPropagation()})}},rows:{get:function(){return this.matrix.rows},set:function(V){this.matrix.rows=V,this.empty(),this.buildInterface(),this.update()}},columns:{get:function(){return this.matrix.columns},set:function(V){this.matrix.columns=V,this.stepper.max=V,this.empty(),this.buildInterface(),this.update()}}}),E}(y);D.exports=v},function(D,P,m){var C=function(y){return y&&y.__esModule?y.default:y},k=function(){function y(g,d){for(var c in d){var l=d[c];l.configurable=!0,l.value&&(l.writable=!0)}Object.defineProperties(g,d)}return function(g,d,c){return d&&y(g.prototype,d),c&&y(g,c),g}}(),M=function(y,g){if(!(y instanceof g))throw new TypeError("Cannot call a class as a function")},I=C(m(5)),w=C(m(26)),x=function(){function y(g,d){var c=this;M(this,y),this.pattern=[],this.create(g,d),this.toggle={cell:function(l,a){return c.pattern[a][l]=!c.pattern[a][l],c.ui&&c.ui.update(),c.pattern[a][l]},all:function(){c.iterate(function(l,a){c.toggle.cell(a,l)}),c.ui&&c.ui.update()},row:function(l){for(var a=0;a<c.columns;a++)c.toggle.cell(a,l);c.ui&&c.ui.update()},column:function(l){for(var a=0;a<c.rows;a++)c.toggle.cell(l,a);c.ui&&c.ui.update()}},this.set={cell:function(l,a,h){c.pattern[a][l]=h,c.ui&&c.ui.update()},all:function(l){c.pattern=l,c.ui&&c.ui.update()},row:function(l,a){c.pattern[l]=a,c.ui&&c.ui.update()},column:function(l,a){c.pattern.forEach(function(h,v){c.pattern[v][l]=a[v]}),c.ui&&c.ui.update()}},this.rotate={all:function(l){!l&&l!==0&&(l=1),l%=c.pattern[0].length,l<0&&(l=c.pattern[0].length+l);for(var a=0;a<c.rows;a++){var h=c.pattern[a].splice(c.pattern[a].length-l,l);c.pattern[a]=h.concat(c.pattern[a])}c.ui&&c.ui.update()},row:function(l,a){!a&&a!==0&&(a=1),a%=c.pattern[0].length,a<0&&(a=c.pattern[0].length+a);var h=c.pattern[l].splice(c.pattern[l].length-a,a);c.pattern[l]=h.concat(c.pattern[l]),c.ui&&c.ui.update()},column:function(l,a){!a&&a!==0&&(a=1),a%=c.pattern.length,a<0&&(a=c.pattern.length+a);var h=[];c.pattern.forEach(function(_){h.push(_[l])});var v=h.splice(h.length-a,a);h=v.concat(h),c.pattern.forEach(function(_,E){_[l]=h[E]}),c.ui&&c.ui.update()}},this.populate={all:function(l){var a=new w(l);c.iterate(function(h,v){c.pattern[h][v]=I.coin(a.next())}),c.ui&&c.ui.update()},row:function(){var l=arguments[0]===void 0?0:arguments[0],a=arguments[1]===void 0?1:arguments[1],h=new w(a);c.pattern[l].forEach(function(v,_){c.pattern[l][_]=I.coin(h.next())}),c.ui&&c.ui.update()},column:function(){var l=arguments[0]===void 0?0:arguments[0],a=arguments[1]===void 0?1:arguments[1],h=new w(a);c.pattern.forEach(function(v,_){c.pattern[_][l]=I.coin(h.next())}),c.ui&&c.ui.update()}},this.erase={all:function(){c.set.all(0)},row:function(l){c.set.row(l,0)},column:function(l){c.set.column(l,0)}}}return k(y,{create:{value:function(d,c){var l=this;this.pattern=[];for(var a=0;a<d;a++){var h=new Array(c);this.pattern.push(h)}this.iterate(function(v,_){l.pattern[v][_]=!1})}},iterate:{value:function(d,c){for(var l=0,a=0;a<this.rows;a++){c&&c(a);for(var h=0;h<this.columns;h++)d(a,h,l),l++}}},formatAsText:{value:function(){var d=this,c="";return this.iterate(function(l,a){c+=(d.pattern[l][a]?1:0)+" "},function(){c+=`
`}),c}},log:{value:function(){console.log(this.formatAsText())}},update:{value:function(d){this.pattern=d||this.pattern}},length:{get:function(){return this.rows*this.columns}},locate:{value:function(d){return{row:~~(d/this.columns),column:d%this.columns}}},indexOf:{value:function(d,c){return c+d*this.columns}},row:{value:function(g){var d=function(l){return g.apply(this,arguments)};return d.toString=function(){return g.toString()},d}(function(g){for(var d=[],c=0;c<this.columns;c++)d.push(this.pattern[g]?1:0);return d})},column:{value:function(g){var d=function(l){return g.apply(this,arguments)};return d.toString=function(){return g.toString()},d}(function(g){for(var d=[],c=0;c<this.rows;c++)d.push(this.pattern[c][g]?1:0);return d})},rows:{get:function(){return this.pattern.length},set:function(g){var d=this,c=this.pattern.slice(0);this.create(g,this.columns),this.iterate(function(l,a){c[l]&&c[l][a]&&(d.pattern[l][a]=c[l][a])})}},columns:{get:function(){return this.pattern[0].length},set:function(g){var d=this,c=this.pattern.slice(0);this.create(this.rows,g),this.iterate(function(l,a){c[l]&&c[l][a]&&(d.pattern[l][a]=c[l][a])})}}}),y}();D.exports=x},function(D,P,m){var C=function(y){return y&&y.__esModule?y.default:y},k=function(){function y(g,d){for(var c in d){var l=d[c];l.configurable=!0,l.value&&(l.writable=!0)}Object.defineProperties(g,d)}return function(g,d,c){return d&&y(g.prototype,d),c&&y(g,c),g}}(),M=function(y,g){if(!(y instanceof g))throw new TypeError("Cannot call a class as a function")},I=C(m(5)),w=C(m(27)),x=function(){function y(){var g=arguments[0]===void 0?[0,10,20,30]:arguments[0],d=arguments[1]===void 0?"up":arguments[1],c=arguments[2]===void 0?!1:arguments[2];M(this,y),this.values=g,Array.isArray(this.values)||(this.values=[this.values]),this._mode=d,this.position=c,this.drunkWalk=new w(0,this.values.length-1),this.startValues={up:0,down:this.values.length-1,drunk:~~(this.values.length/2),random:I.ri(this.values.length)},this.position!==!1?this.next=this[this._mode]:this.next=this.first}return k(y,{mode:{get:function(){return this._mode},set:function(g){if(!(g==="up"||g==="down"||g==="random"||g==="drunk")){console.error("The only modes currently allowed are: up, down, random, drunk");return}this._mode=g,this.position&&(this.next=this[this._mode])}},value:{get:function(){return this.values[this.position]},set:function(g){this.position=this.values.indexOf(g)}},first:{value:function(){return this.position!==!1?(this.next=this[this._mode],this.next()):(this.position=this.startValues[this._mode],this.next=this[this._mode],this.value)}},up:{value:function(){return this.position++,this.position%=this.values.length,this.value}},down:{value:function(){return this.position--,this.position<0&&(this.position=(this.position+this.values.length)%this.values.length),this.value}},random:{value:function(){return this.position=I.ri(0,this.values.length),this.value}},drunk:{value:function(){return this.drunkWalk.max=this.values.length,this.drunkWalk.value=this.position,this.position=this.drunkWalk.next(),this.value}}}),y}();D.exports=x},function(D,P,m){var C=function(x){return x&&x.__esModule?x.default:x},k=function(){function x(y,g){for(var d in g){var c=g[d];c.configurable=!0,c.value&&(c.writable=!0)}Object.defineProperties(y,g)}return function(y,g,d){return g&&x(y.prototype,g),d&&x(y,d),y}}(),M=function(x,y){if(!(x instanceof y))throw new TypeError("Cannot call a class as a function")},I=C(m(5)),w=function(){function x(){var y=arguments[0]===void 0?0:arguments[0],g=arguments[1]===void 0?9:arguments[1],d=arguments[2]===void 0?0:arguments[2],c=arguments[3]===void 0?1:arguments[3],l=arguments[4]===void 0?!1:arguments[4];M(this,x),this.min=y,this.max=g,this.value=d,this.increment=c,this.loop=l}return k(x,{next:{value:function(){return this.value+=I.pick(-1*this.increment,this.increment),this.value>this.max&&(this.loop?this.value=this.min:this.value=this.max-this.increment),this.value<this.min&&(this.loop?this.value=this.max:this.value=this.min+this.increment),this.value}}}),x}();D.exports=w},function(D,P,m){var C=function(y){return y&&y.__esModule?y.default:y},k=function(){function y(g,d){for(var c in d){var l=d[c];l.configurable=!0,l.value&&(l.writable=!0)}Object.defineProperties(g,d)}return function(g,d,c){return d&&y(g.prototype,d),c&&y(g,c),g}}(),M=function(y,g){if(!(y instanceof g))throw new TypeError("Cannot call a class as a function")},I=C(m(5)),w=C(m(27)),x=function(){function y(){var g=arguments[0]===void 0?0:arguments[0],d=arguments[1]===void 0?10:arguments[1],c=arguments[2]===void 0?"up":arguments[2],l=arguments[3]===void 0?!1:arguments[3];M(this,y),this.min=g,this.max=d,this.value=l,this.mode=c,this.drunkWalk=new w(this.min,this.max),this.value!==!1?this.next=this[this._mode]:this.next=this.first}return k(y,{mode:{set:function(g){if(!(g==="up"||g==="down"||g==="random"||g==="drunk")){console.error("The only modes currently allowed are: up, down, random, drunk");return}this._mode=g,this.value&&(this.next=this[this._mode])},get:function(){return this._mode}},first:{value:function(){return this.value!==!1?(this.next=this[this._mode],this.next()):(this.startValues={up:this.min,down:this.max,drunk:~~I.average(this.min,this.max),random:I.ri(this.min,this.max)},this.value=this.startValues[this._mode],this.next=this[this._mode],this.value)}},up:{value:function(){return this.value++,this.value>=this.max&&(this.value=this.min),this.value}},down:{value:function(){return this.value--,this.value<this.min&&(this.value=this.max),this.value}},random:{value:function(){return this.value=I.ri(this.min,this.max),this.value}},drunk:{value:function(){return this.drunkWalk.min=this.min,this.drunkWalk.max=this.max,this.drunkWalk.value=this.value,this.value=this.drunkWalk.next(),this.value}}}),y}();D.exports=x},function(D,P,m){var C=function(){function w(x,y){for(var g in y){var d=y[g];d.configurable=!0,d.value&&(d.writable=!0)}Object.defineProperties(x,y)}return function(x,y,g){return y&&w(x.prototype,y),g&&w(x,g),x}}(),k=function(w,x){if(!(w instanceof x))throw new TypeError("Cannot call a class as a function")},M=m(1).clock,I=function(){function w(x,y,g){k(this,w),this.rate=x,this.on=g,this.clock=M(),this.pattern=[1],this.index=0,this.event=y||function(){},this.on&&this.start()}return C(w,{_event:{value:function(y){this.event(y),this.index++}},stop:{value:function(){this.on=!1,this.interval.clear()}},start:{value:function(){this.on=!0,this.interval=this.clock.callbackAtTime(this._event.bind(this),this.clock.context.currentTime).repeat(this.rate/1e3).tolerance({early:.1,late:1})}},ms:{value:function(y){if(this.on){var g=y/this.rate;this.rate=y,this.clock.timeStretch(this.clock.context.currentTime,[this.interval],g)}else this.rate=y}}}),w}();D.exports=I},function(D,P,m){var C=function(a){return a&&a.__esModule?a:{default:a}},k=function(){function a(h,v){for(var _ in v){var E=v[_];E.configurable=!0,E.value&&(E.writable=!0)}Object.defineProperties(h,v)}return function(h,v,_){return v&&a(h.prototype,v),_&&a(h,_),h}}(),M=function a(h,v,_){var E=Object.getOwnPropertyDescriptor(h,v);if(E===void 0){var V=Object.getPrototypeOf(h);return V===null?void 0:a(V,v,_)}else{if("value"in E&&E.writable)return E.value;var L=E.get;return L===void 0?void 0:L.call(_)}},I=function(a,h){if(typeof h!="function"&&h!==null)throw new TypeError("Super expression must either be null or a function, not "+typeof h);a.prototype=Object.create(h&&h.prototype,{constructor:{value:a,enumerable:!1,writable:!0,configurable:!0}}),h&&(a.__proto__=h)},w=function(a,h){if(!(a instanceof h))throw new TypeError("Cannot call a class as a function")},x=m(4),y=m(5),g=m(6),d=m(11),c=C(m(12)),l=function(a){function h(){w(this,h);var v=["range"],_={size:[200,200],range:.5,mode:"absolute",speakers:[[.5,.2],[.75,.25],[.8,.5],[.75,.75],[.5,.8],[.25,.75],[.2,.5],[.25,.25]]};M(Object.getPrototypeOf(h.prototype),"constructor",this).call(this,arguments,v,_),this.value={x:new d(0,1,0,.5),y:new d(0,1,0,.5)},this.mode=this.settings.mode,this.position={x:new c.Handle(this.mode,"horizontal",[0,this.width],[this.height,0]),y:new c.Handle(this.mode,"vertical",[0,this.width],[this.height,0])},this.position.x.value=this.value.x.normalized,this.position.y.value=this.value.y.normalized,this.speakers=this.settings.speakers,this.range=this.settings.range,this.levels=[],this.init(),this.calculateLevels(),this.render()}return I(h,a),k(h,{buildInterface:{value:function(){this.knob=x.create("circle"),this.element.appendChild(this.knob),this.speakerElements=[];for(var _=0;_<this.speakers.length;_++){var E=x.create("circle");this.element.appendChild(E),this.speakerElements.push(E)}}},sizeInterface:{value:function(){this._minDimension=Math.min(this.width,this.height),this.knobRadius={off:~~(this._minDimension/100)*3+5},this.knobRadius.on=this.knobRadius.off*2,this.knob.setAttribute("cx",this.width/2),this.knob.setAttribute("cy",this.height/2),this.knob.setAttribute("r",this.knobRadius.off);for(var _=0;_<this.speakers.length;_++){var E=this.speakerElements[_],V=this.speakers[_];E.setAttribute("cx",V[0]*this.width),E.setAttribute("cy",V[1]*this.height),E.setAttribute("r",this._minDimension/20+5),E.setAttribute("fill-opacity","0")}this.position.x.resize([0,this.width],[this.height,0]),this.position.y.resize([0,this.width],[this.height,0]),this.calculateLevels(),this.render()}},colorInterface:{value:function(){this.element.style.backgroundColor=this.colors.fill,this.knob.setAttribute("fill",this.colors.mediumLight);for(var _=0;_<this.speakers.length;_++){var E=this.speakerElements[_];E.setAttribute("fill",this.colors.accent),E.setAttribute("stroke",this.colors.accent)}}},render:{value:function(){this.knobCoordinates={x:this.value.x.normalized*this.width,y:this.height-this.value.y.normalized*this.height},this.knob.setAttribute("cx",this.knobCoordinates.x),this.knob.setAttribute("cy",this.knobCoordinates.y)}},click:{value:function(){this.position.x.anchor=this.mouse,this.position.y.anchor=this.mouse,this.move()}},move:{value:function(){this.clicked&&(this.position.x.update(this.mouse),this.position.y.update(this.mouse),this.calculateLevels(),this.emit("change",this.levels),this.render())}},release:{value:function(){this.render()}},normalized:{get:function(){return{x:this.value.x.normalized,y:this.value.y.normalized}}},calculateLevels:{value:function(){var _=this;this.value.x.updateNormal(this.position.x.value),this.value.y.updateNormal(this.position.y.value),this.levels=[],this.speakers.forEach(function(E,V){var L=y.distance(E[0]*_.width,E[1]*_.height,_.position.x.value*_.width,(1-_.position.y.value)*_.height),Q=y.clip(1-L/(_.range*_.width),0,1);_.levels.push(Q),_.speakerElements[V].setAttribute("fill-opacity",Q)})}},moveSource:{value:function(_,E){var V={x:_*this.width,y:E*this.height};this.position.x.update(V),this.position.y.update(V),this.calculateLevels(),this.emit("change",this.levels),this.render()}},moveSpeaker:{value:function(_,E,V){this.speakers[_]=[E,V],this.speakerElements[_].setAttribute("cx",E*this.width),this.speakerElements[_].setAttribute("cy",V*this.height),this.calculateLevels(),this.emit("change",this.levels),this.render()}}}),h}(g);D.exports=l},function(D,P,m){var C=function(){function d(c,l){for(var a in l){var h=l[a];h.configurable=!0,h.value&&(h.writable=!0)}Object.defineProperties(c,l)}return function(c,l,a){return l&&d(c.prototype,l),a&&d(c,a),c}}(),k=function d(c,l,a){var h=Object.getOwnPropertyDescriptor(c,l);if(h===void 0){var v=Object.getPrototypeOf(c);return v===null?void 0:d(v,l,a)}else{if("value"in h&&h.writable)return h.value;var _=h.get;return _===void 0?void 0:_.call(a)}},M=function(d,c){if(typeof c!="function"&&c!==null)throw new TypeError("Super expression must either be null or a function, not "+typeof c);d.prototype=Object.create(c&&c.prototype,{constructor:{value:d,enumerable:!1,writable:!0,configurable:!0}}),c&&(d.__proto__=c)},I=function(d,c){if(!(d instanceof c))throw new TypeError("Cannot call a class as a function")},w=m(5),x=m(4),y=m(6),g=function(d){function c(){I(this,c);var l=["value"],a={size:[80,80]};k(Object.getPrototypeOf(c.prototype),"constructor",this).call(this,arguments,l,a),this._active=!0,this.init(),this.boundUpdate=this.update.bind(this),window.DeviceOrientationEvent?this.orientationListener=window.addEventListener("deviceorientation",this.boundUpdate,!1):(this._active=!1,this.colorInterface())}return M(c,d),C(c,{buildInterface:{value:function(){this.title=x.create("text"),this.circleX=x.create("circle"),this.circleY=x.create("circle"),this.circleZ=x.create("circle"),this.barX=x.create("path"),this.barY=x.create("path"),this.barZ=x.create("path"),this.barX2=x.create("path"),this.barY2=x.create("path"),this.barZ2=x.create("path"),this.barX.setAttribute("opacity","0.8"),this.barY.setAttribute("opacity","0.8"),this.barZ.setAttribute("opacity","0.8"),this.barX2.setAttribute("opacity","0.8"),this.barY2.setAttribute("opacity","0.8"),this.barZ2.setAttribute("opacity","0.8"),this.circleX.setAttribute("cx",this.width*3/12),this.circleX.setAttribute("cy",this.height*3/4),this.circleX.setAttribute("r",this.height/10),this.circleX.setAttribute("opacity","0.4"),this.circleY.setAttribute("cx",this.width*6/12),this.circleY.setAttribute("cy",this.height*3/4),this.circleY.setAttribute("r",this.height/10),this.circleY.setAttribute("opacity","0.4"),this.circleZ.setAttribute("cx",this.width*9/12),this.circleZ.setAttribute("cy",this.height*3/4),this.circleZ.setAttribute("r",this.height/10),this.circleZ.setAttribute("opacity","0.4"),this.barX.setAttribute("stroke-width",Math.round(this.height/30)),this.barY.setAttribute("stroke-width",Math.round(this.height/30)),this.barZ.setAttribute("stroke-width",Math.round(this.height/30)),this.barX.setAttribute("fill","none"),this.barY.setAttribute("fill","none"),this.barZ.setAttribute("fill","none"),this.barX2.setAttribute("stroke-width",Math.round(this.height/30)),this.barY2.setAttribute("stroke-width",Math.round(this.height/30)),this.barZ2.setAttribute("stroke-width",Math.round(this.height/30)),this.barX2.setAttribute("fill","none"),this.barY2.setAttribute("fill","none"),this.barZ2.setAttribute("fill","none"),this.title.setAttribute("x",this.width/2),this.title.setAttribute("y",this.height/3+7),this.title.setAttribute("font-size","15px"),this.title.setAttribute("font-weight","bold"),this.title.setAttribute("letter-spacing","2px"),this.title.setAttribute("opacity","0.7"),this.title.setAttribute("text-anchor","middle"),this.title.textContent="TILT",this.element.appendChild(this.circleX),this.element.appendChild(this.circleY),this.element.appendChild(this.circleZ),this.element.appendChild(this.barX),this.element.appendChild(this.barY),this.element.appendChild(this.barZ),this.element.appendChild(this.barX2),this.element.appendChild(this.barY2),this.element.appendChild(this.barZ2),this.element.appendChild(this.title)}},colorInterface:{value:function(){this._active?(this.element.style.backgroundColor=this.colors.accent,this.circleX.setAttribute("fill",this.colors.light),this.circleY.setAttribute("fill",this.colors.light),this.circleZ.setAttribute("fill",this.colors.light),this.circleX.setAttribute("stroke",this.colors.light),this.circleY.setAttribute("stroke",this.colors.light),this.circleZ.setAttribute("stroke",this.colors.light),this.barX.setAttribute("stroke",this.colors.light),this.barY.setAttribute("stroke",this.colors.light),this.barZ.setAttribute("stroke",this.colors.light),this.barX2.setAttribute("stroke",this.colors.light),this.barY2.setAttribute("stroke",this.colors.light),this.barZ2.setAttribute("stroke",this.colors.light),this.title.setAttribute("fill",this.colors.light)):(this.element.style.backgroundColor=this.colors.fill,this.circleX.setAttribute("fill",this.colors.mediumLight),this.circleY.setAttribute("fill",this.colors.mediumLight),this.circleZ.setAttribute("fill",this.colors.mediumLight),this.circleX.setAttribute("stroke",this.colors.mediumLight),this.circleY.setAttribute("stroke",this.colors.mediumLight),this.circleZ.setAttribute("stroke",this.colors.mediumLight),this.barX.setAttribute("stroke",this.colors.mediumLight),this.barY.setAttribute("stroke",this.colors.mediumLight),this.barZ.setAttribute("stroke",this.colors.mediumLight),this.barX2.setAttribute("stroke",this.colors.mediumLight),this.barY2.setAttribute("stroke",this.colors.mediumLight),this.barZ2.setAttribute("stroke",this.colors.mediumLight),this.title.setAttribute("fill",this.colors.mediumLight))}},update:{value:function(a){if(this._active){var h=a.beta,v=a.gamma,_=a.alpha;v=w.scale(v,-90,90,0,1),h=w.scale(h,-90,90,0,1),_=w.scale(_,0,360,0,1);var E={start:Math.PI*1.5,end:w.clip(w.scale(v,0,.5,Math.PI*1.5,Math.PI*.5),Math.PI*.5,Math.PI*1.5)},V={start:Math.PI*2.5,end:w.clip(w.scale(v,.5,1,Math.PI*2.5,Math.PI*1.5),Math.PI*1.5,Math.PI*2.5)},L=x.arc(this.circleX.cx.baseVal.value,this.circleX.cy.baseVal.value,this.circleX.r.baseVal.value,E.start,E.end),Q=x.arc(this.circleX.cx.baseVal.value,this.circleX.cy.baseVal.value,this.circleX.r.baseVal.value,V.start,V.end);this.barX.setAttribute("d",L),this.barX2.setAttribute("d",Q),E={start:Math.PI*1.5,end:w.clip(w.scale(h,0,.5,Math.PI*1.5,Math.PI*.5),Math.PI*.5,Math.PI*1.5)},V={start:Math.PI*2.5,end:w.clip(w.scale(h,.5,1,Math.PI*2.5,Math.PI*1.5),Math.PI*1.5,Math.PI*2.5)},L=x.arc(this.circleY.cx.baseVal.value,this.circleY.cy.baseVal.value,this.circleY.r.baseVal.value,E.start,E.end),Q=x.arc(this.circleY.cx.baseVal.value,this.circleY.cy.baseVal.value,this.circleY.r.baseVal.value,V.start,V.end),this.barY.setAttribute("d",L),this.barY2.setAttribute("d",Q),E={start:Math.PI*1.5,end:w.clip(w.scale(_,0,.5,Math.PI*1.5,Math.PI*.5),Math.PI*.5,Math.PI*1.5)},V={start:Math.PI*2.5,end:w.clip(w.scale(_,.5,1,Math.PI*2.5,Math.PI*1.5),Math.PI*1.5,Math.PI*2.5)},L=x.arc(this.circleZ.cx.baseVal.value,this.circleZ.cy.baseVal.value,this.circleZ.r.baseVal.value,E.start,E.end),Q=x.arc(this.circleZ.cx.baseVal.value,this.circleZ.cy.baseVal.value,this.circleZ.r.baseVal.value,V.start,V.end),this.barZ.setAttribute("d",L),this.barZ2.setAttribute("d",Q),this.emit("change",{x:v,y:h,z:_})}}},click:{value:function(){window.DeviceOrientationEvent&&(this.active=!this.active)}},active:{get:function(){return this._active},set:function(l){this._active=l,this.colorInterface()}},customDestroy:{value:function(){window.removeEventListener("deviceorientation",this.boundUpdate,!1)}}}),c}(y);D.exports=g},function(D,P,m){var C=function(){function d(c,l){for(var a in l){var h=l[a];h.configurable=!0,h.value&&(h.writable=!0)}Object.defineProperties(c,l)}return function(c,l,a){return l&&d(c.prototype,l),a&&d(c,a),c}}(),k=function d(c,l,a){var h=Object.getOwnPropertyDescriptor(c,l);if(h===void 0){var v=Object.getPrototypeOf(c);return v===null?void 0:d(v,l,a)}else{if("value"in h&&h.writable)return h.value;var _=h.get;return _===void 0?void 0:_.call(a)}},M=function(d,c){if(typeof c!="function"&&c!==null)throw new TypeError("Super expression must either be null or a function, not "+typeof c);d.prototype=Object.create(c&&c.prototype,{constructor:{value:d,enumerable:!1,writable:!0,configurable:!0}}),c&&(d.__proto__=c)},I=function(d,c){if(!(d instanceof c))throw new TypeError("Cannot call a class as a function")},w=m(5),x=m(4),y=m(6),g=function(d){function c(){I(this,c);var l=["value"],a={size:[200,100],numberOfSliders:5,min:0,max:1,step:0,candycane:3,values:[.9,.8,.7,.6,.5,.4,.3,.2,.1],smoothing:0,mode:"bar"};k(Object.getPrototypeOf(c.prototype),"constructor",this).call(this,arguments,l,a),this._numberOfSliders=this.settings.numberOfSliders,this._min=this.settings.min,this._max=this.settings.max,this._step=this.settings.step,this._mode=this.settings.mode;var h=this.settings.values;this.values=h.length>this._numberOfSliders?h.slice(0,this._numberOfSliders):h.concat(Array(this._numberOfSliders-h.length).fill(0)),this.candycane=this.settings.candycane,this.sliderWidth=this.width/this.values.length,this.smoothing=this.settings.smoothing,this.init(),this.render()}return M(c,d),C(c,{buildInterface:{value:function(){this._mode=="line"?(this.line=x.create("polyline"),this.line.setAttribute("stroke-width",2),this.line.setAttribute("fill","none"),this.element.appendChild(this.line),this.fill=x.create("polyline"),this.fill.setAttribute("fill-opacity","0.2"),this.element.appendChild(this.fill),this.nodes=[],this.values.forEach((function(a,h){var v=x.create("circle");v.setAttribute("cx",this.getX(h)),v.setAttribute("cy",this.getY(a)),this.element.appendChild(v),this.nodes.push(v)}).bind(this))):(this.bars=[],this.caps=[],this.values.forEach((function(a,h){var v=x.create("rect"),_=this.getBarX(h),E=this.getY(a);v.setAttribute("x",_-.1),v.setAttribute("y",E),v.setAttribute("width",this.sliderWidth+.2),v.setAttribute("height",this.height),v.setAttribute("opacity",1-(h%this.candycane+1)/(this.candycane+1)),this.element.appendChild(v),this.bars.push(v);var V=x.create("rect");V.setAttribute("x",_-.1),V.setAttribute("y",E),V.setAttribute("width",this.sliderWidth+.2),V.setAttribute("height",5),this.element.appendChild(V),this.caps.push(V)}).bind(this)))}},getBarX:{value:function(a){return this.getX(a)-this.sliderWidth/2}},getX:{value:function(a){return a*this.sliderWidth+this.sliderWidth/2}},getY:{value:function(a){return w.scale(a,this._min,this._max,this.height,0)}},getValueFromY:{value:function(a){var h=w.scale(a,this.height,0,this._min,this._max);return this.adjustValueToStep(h)}},getIndexFromX:{value:function(a){return w.clip(Math.floor(a/this.width*this.values.length),0,this.values.length-1)}},adjustValueToStep:{value:function(a){if(!this._step)return a;var h=a%this._step;return a=a-a%this._step,h>this._step/2&&(a+=this._step),a}},adjustAllValues:{value:function(){this.values.forEach((function(a,h){a=this.adjustValueToStep(a),this.values[h]=w.clip(a,this._min,this._max)}).bind(this))}},getNormalizedValues:{value:function(){this.normalizedValues=[],this.values.forEach((function(a){this.normalizedValues.push(w.scale(a,this._min,this._max,0,1))}).bind(this))}},colorInterface:{value:function(){var a=this;this.element.style.backgroundColor=this.colors.fill,this._mode=="line"?(this.line.setAttribute("stroke",this.colors.accent),this.fill.setAttribute("fill",this.colors.accent),this.nodes.forEach(function(h){h.setAttribute("fill",a.colors.accent)})):(this.bars.forEach(function(h){h.setAttribute("fill",a.colors.accent)}),this.caps.forEach(function(h){h.setAttribute("fill",a.colors.accent)}))}},sizeInterface:{value:function(){this.sliderWidth=this.width/this.values.length,this._mode=="line"&&this.nodes.forEach((function(a){var h=~~(Math.min(this.width,this.height)/50)+2;h=Math.min(this.sliderWidth,h),a.setAttribute("r",h)}).bind(this)),this.render()}},render:{value:function(){var a=this;this._mode=="line"?function(){var h="0 "+a.getY(a.values[0])+", ";a.values.forEach(function(v,_){var E=a.getX(_),V=a.getY(v);h+=E+" "+V+", ",a.nodes[_].setAttribute("cx",a.getX(_)),a.nodes[_].setAttribute("cy",a.getY(v))}),h+=a.width+" "+a.getY(a.values[a.values.length-1]),a.line.setAttribute("points",h),h+=", "+a.width+" "+a.height+", ",h+="0 "+a.height,a.fill.setAttribute("points",h)}():this.values.forEach(function(h,v){a.bars[v].setAttribute("y",a.getY(h)),a.caps[v].setAttribute("y",a.getY(h))})}},click:{value:function(){this.hasMoved=!1,this.previousSlider=!1,this.move()}},move:{value:function(){if(this.clicked){if(this.mouse.x=w.clip(this.mouse.x,0,this.width),this.mouse.y=w.clip(this.mouse.y,0,this.height),this.hasMoved=!0,this.selectedSlider=this.getIndexFromX(this.mouse.x),this.values[this.selectedSlider]=this.getValueFromY(this.mouse.y),this.previousSlider!==!1){var a=Math.abs(this.previousSlider-this.selectedSlider);if(a>1)for(var h=Math.min(this.previousSlider,this.selectedSlider),v=Math.max(this.previousSlider,this.selectedSlider),_=this.values[h],E=this.values[v],V=h;V<v;V++)this.values[V]=w.interp((V-h)/a,_,E),this.values[V]=this.adjustValueToStep(this.values[V])}if(this.smoothing>0)for(var L=1;L<=this.smoothing;L++){var Q=this.selectedSlider-L,et=this.selectedSlider+L;if(Q>=1){var st=Q-1>=0?Q-1:0,vt=Q+1;this.values[Q]=(this.values[st]+this.values[vt])/2,this.values[Q]=this.adjustValueToStep(this.values[Q])}if(et<this.values.length-1){var St=et-1,kt=et+1<this.values.length?et+1:this.values.length-1;this.values[et]=(this.values[St]+this.values[kt])/2,this.values[et]=this.adjustValueToStep(this.values[et])}}this.previousSlider=this.selectedSlider,this.emit("change",this.values),this.render()}}},scan:{value:function(){}},update:{value:function(a,h){this.values[a]=this.adjustValueToStep(h),this.emit("change",{index:a,value:h})}},numberOfSliders:{get:function(){return this.values.length}},min:{get:function(){return this._min},set:function(l){this._min=l,this.adjustAllValues(),this.render()}},max:{get:function(){return this._max},set:function(l){this._max=l,this.adjustAllValues(),this.render()}},step:{get:function(){return this._step},set:function(l){this._step=l,this.adjustAllValues(),this.render()}},setSlider:{value:function(a,h){this.values[a]=this.adjustValueToStep(h),this.values[a]=w.clip(this.values[a],this._min,this._max),this.emit("change",{index:a,value:h})}},setAllSliders:{value:function(a){var h=this.values.length,v=a.length;this.values=a,this.adjustAllValues(),h!=v&&(this.empty(),this.buildInterface(),this.colorInterface()),this.sizeInterface()}}}),c}(y);D.exports=g},function(D,P,m){var C=function(a){return a&&a.__esModule?a:{default:a}},k=function(){function a(h,v){for(var _ in v){var E=v[_];E.configurable=!0,E.value&&(E.writable=!0)}Object.defineProperties(h,v)}return function(h,v,_){return v&&a(h.prototype,v),_&&a(h,_),h}}(),M=function a(h,v,_){var E=Object.getOwnPropertyDescriptor(h,v);if(E===void 0){var V=Object.getPrototypeOf(h);return V===null?void 0:a(V,v,_)}else{if("value"in E&&E.writable)return E.value;var L=E.get;return L===void 0?void 0:L.call(_)}},I=function(a,h){if(typeof h!="function"&&h!==null)throw new TypeError("Super expression must either be null or a function, not "+typeof h);a.prototype=Object.create(h&&h.prototype,{constructor:{value:a,enumerable:!1,writable:!0,configurable:!0}}),h&&(a.__proto__=h)},w=function(a,h){if(!(a instanceof h))throw new TypeError("Cannot call a class as a function")},x=m(4),y=m(5),g=m(6),d=m(11),c=C(m(12)),l=function(a){function h(){w(this,h);var v=["scale","value"],_={size:[120,20],orientation:"horizontal",mode:"relative",scale:[-1,1],step:0,value:0,hasKnob:!0};M(Object.getPrototypeOf(h.prototype),"constructor",this).call(this,arguments,v,_),this.orientation=this.settings.orientation,this.mode=this.settings.mode,this.hasKnob=this.settings.hasKnob,this.step=this.settings.step,this._value=new d(this.settings.scale[0],this.settings.scale[1],this.settings.step,this.settings.value),this.init(),this.position=new c.Handle(this.mode,this.orientation,[0,this.width],[this.height,0]),this.position.value=this._value.normalized,this.value=this._value.value,this.emit("change",this.value)}return I(h,a),k(h,{buildInterface:{value:function(){this.bar=x.create("rect"),this.knob=x.create("circle"),this.element.appendChild(this.bar),this.element.appendChild(this.knob)}},sizeInterface:{value:function(){this.position&&this.position.resize([0,this.width],[this.height,0]),this.width<this.height?this.orientation="vertical":this.orientation="horizontal";var _=void 0,E=void 0,V=void 0,L=void 0,Q=void 0,et=void 0;this.knobData={level:0,r:0},this.orientation==="vertical"?(this.thickness=this.width/2,_=this.width/2,E=0,V=this.thickness,L=this.height,this.knobData.r=this.thickness*.8,this.knobData.level=L-this.knobData.r-this.normalized*(L-this.knobData.r*2),Q="translate("+this.thickness*-1/2+",0)",et=V/2):(this.thickness=this.height/2,_=0,E=this.height/2,V=this.width,L=this.thickness,this.knobData.r=this.thickness*.8,this.knobData.level=this.normalized*(V-this.knobData.r*2)+this.knobData.r,Q="translate(0,"+this.thickness*-1/2+")",et=L/2),this.bar.setAttribute("x",_),this.bar.setAttribute("y",E),this.bar.setAttribute("transform",Q),this.bar.setAttribute("rx",et),this.bar.setAttribute("ry",et),this.bar.setAttribute("width",V),this.bar.setAttribute("height",L),this.orientation==="vertical"?(this.knob.setAttribute("cx",_),this.knob.setAttribute("cy",this.knobData.level)):(this.knob.setAttribute("cx",this.knobData.level),this.knob.setAttribute("cy",E)),this.knob.setAttribute("r",this.knobData.r)}},colorInterface:{value:function(){this.bar.setAttribute("fill",this.colors.fill),this.knob.setAttribute("fill",this.colors.accent),this.hasKnob||this.knob.setAttribute("fill","transparent")}},render:{value:function(){this.clicked||(this.knobData.r=this.thickness*.75),this.knob.setAttribute("r",this.knobData.r),this.orientation==="vertical"?(this.knobData.level=this.knobData.r+this._value.normalized*(this.height-this.knobData.r*2),this.knob.setAttribute("cy",this.height-this.knobData.level)):(this.knobData.level=this._value.normalized*(this.width-this.knobData.r*2)+this.knobData.r,this.knob.setAttribute("cx",this.knobData.level))}},click:{value:function(){this.knobData.r=this.thickness*.9,this.position.anchor=this.mouse,this.move()}},move:{value:function(){this.clicked&&(this.position.update(this.mouse),this.value=this._value.updateNormal(this.position.value),this.emit("change",{value:this.value,L:Math.pow(y.scale(this.value,-1,1,1,0),2),R:Math.pow(y.scale(this.value,-1,1,0,1),2)}))}},release:{value:function(){this.render()}},value:{get:function(){return this._value.value},set:function(v){this._value.update(v),this.position.value=this._value.normalized,this.emit("change",{value:this.value,L:Math.pow(y.scale(this.value,-1,1,1,0),2),R:Math.pow(y.scale(this.value,-1,1,0,1),2)}),this.render()}},normalized:{get:function(){return this._value.normalized}}}),h}(g);D.exports=l},function(D,P,m){var C=function(){function c(l,a){for(var h in a){var v=a[h];v.configurable=!0,v.value&&(v.writable=!0)}Object.defineProperties(l,a)}return function(l,a,h){return a&&c(l.prototype,a),h&&c(l,h),l}}(),k=function c(l,a,h){var v=Object.getOwnPropertyDescriptor(l,a);if(v===void 0){var _=Object.getPrototypeOf(l);return _===null?void 0:c(_,a,h)}else{if("value"in v&&v.writable)return v.value;var E=v.get;return E===void 0?void 0:E.call(h)}},M=function(c,l){if(typeof l!="function"&&l!==null)throw new TypeError("Super expression must either be null or a function, not "+typeof l);c.prototype=Object.create(l&&l.prototype,{constructor:{value:c,enumerable:!1,writable:!0,configurable:!0}}),l&&(c.__proto__=l)},I=function(c,l){if(!(c instanceof l))throw new TypeError("Cannot call a class as a function")},w=m(5),x=m(4),y=m(6),g=function(l,a){this.x=l.x,this.y=l.y,this.xMin=l.xMin||0,this.xMax=l.xMax||1,this.yMin=l.yMin||0,this.yMax=l.yMax||1,this.envelope=a,this.element=x.create("circle"),this.element.setAttribute("fill",this.envelope.colors.accent),this.envelope.element.appendChild(this.element),this.resize=function(){var h=~~(Math.min(this.envelope.width,this.envelope.height)/50)+2;this.element.setAttribute("r",h)},this.move=function(h,v){if(this.x=h||h===0?h:this.x,this.y=v||v===0?v:this.y,this.envelope.nodes.indexOf(this)>=0){var _=this.envelope.nodes.indexOf(this)-1,E=this.envelope.nodes.indexOf(this)+1,V=this.envelope.nodes[_],L=this.envelope.nodes[E],Q=_>=0?V.x:0;Q=Q<this.xMin?this.xMin:Q;var et=E<this.envelope.nodes.length?L.x:1;et=et>this.xMax?this.xMax:et,this.x<Q&&(this.x=Q),this.x>et&&(this.x=et),this.y<this.yMin&&(this.y=this.yMin),this.y>this.yMax&&(this.y=this.yMax)}this.location=this.getCoordinates(),this.element.setAttribute("cx",this.location.x),this.element.setAttribute("cy",this.location.y)},this.getCoordinates=function(){return{x:this.x*this.envelope.width,y:(1-this.y)*this.envelope.height}},this.move(this.x,this.y,!0),this.resize(),this.destroy=function(){this.envelope.element.removeChild(this.element),this.envelope.nodes.splice(this.envelope.nodes.indexOf(this),1)}},d=function(c){function l(){I(this,l);var a=["value"],h={size:[300,150],noNewPoints:!1,points:[{x:.1,y:.4},{x:.35,y:.6},{x:.65,y:.2},{x:.9,y:.4}]};k(Object.getPrototypeOf(l.prototype),"constructor",this).call(this,arguments,a,h),this.points=this.settings.points,this.nodes=[],this.selected=!1,this.init()}return M(l,c),C(l,{buildInterface:{value:function(){var h=this;this.points.forEach(function(v){var _=new g(v,h);h.nodes.push(_)}),this.sortPoints(),this.line=x.create("polyline"),this.line.setAttribute("stroke-width",2),this.line.setAttribute("fill","none"),this.element.appendChild(this.line),this.fill=x.create("polyline"),this.fill.setAttribute("fill-opacity","0.2"),this.element.appendChild(this.fill)}},sizeInterface:{value:function(){for(var h=0;h<this.nodes.length;h++)this.nodes[h].resize(),this.nodes[h].move();this.render()}},colorInterface:{value:function(){var h=this;this.element.style.backgroundColor=this.colors.fill,this.line.setAttribute("stroke",this.colors.accent),this.fill.setAttribute("fill",this.colors.accent),this.nodes.forEach(function(v){v.element.setAttribute("fill",h.colors.accent)})}},render:{value:function(){this.calculatePath()}},calculatePoints:{value:function(){var h=this;this.points=[],this.nodes.forEach(function(v){h.points.push({x:v.x,y:v.y})})}},calculatePath:{value:function(){var h="0 "+this.nodes[0].location.y+", ";this.nodes.forEach(function(v){h+=v.location.x+" "+v.location.y+", "}),h+=this.width+" "+this.nodes[this.nodes.length-1].location.y,this.line.setAttribute("points",h),h+=", "+this.width+" "+this.height+", ",h+="0 "+this.height,this.fill.setAttribute("points",h)}},click:{value:function(){this.hasMoved=!1,this.selected=this.findNearestNode(),this.nodes[this.selected].move(this.mouse.x/this.width,1-this.mouse.y/this.height),this.scaleNode(this.selected),this.calculatePoints(),this.emit("change",this.points),this.render()}},move:{value:function(){this.clicked&&(this.mouse.x=w.clip(this.mouse.x,0,this.width),this.hasMoved=!0,this.nodes[this.selected].move(this.mouse.x/this.width,1-this.mouse.y/this.height),this.scaleNode(this.selected),this.calculatePoints(),this.emit("change",this.points),this.render())}},release:{value:function(){this.hasMoved||this.nodes[this.selected].destroy(),this.calculatePoints(),this.emit("change",this.points),this.render(),this.selected=null}},findNearestNode:{value:function(){for(var h=null,v=1e4,_=this.mouse.x/this.width,E=1-this.mouse.y/this.height,V=this.nodes,L=0;L<V.length;L++){var Q=Math.sqrt(Math.pow(V[L].x-_,2)+Math.pow(V[L].y-E,2));Q<v&&(v=Q,h=L,_>V[L].x)}return!this.settings.noNewPoints&&v>.07&&(h=this.getIndexFromX(this.mouse.x/this.width),this.nodes.splice(h,0,new g({x:this.mouse.x/this.width,y:1-this.mouse.y/this.height},this)),this.hasMoved=!0),h}},getIndexFromX:{value:function(h){var v=this,_=0;return this.nodes.forEach(function(E,V){v.nodes[V].x<=h&&(_=V+1)}),_}},scaleNode:{value:function(h){var v=w.clip(this.nodes[h].x,0,1),_=w.clip(this.nodes[h].y,0,1);this.nodes[h].move(v,_)}},sortPoints:{value:function(){this.nodes.sort(function(h,v){return h.x>v.x})}},addPoint:{value:function(h,v){var _=this.nodes.length;this.sortPoints();for(var E=0;E<this.nodes.length;E++)if(h<this.nodes[E].x){_=E;break}this.nodes.splice(_,0,new g({x:h,y:v},this)),this.scaleNode(_),this.calculatePoints(),this.emit("change",this.points),this.render()}},scan:{value:function(h){var v=this.getIndexFromX(h),_=v-1;_<0&&(_=0),v>=this.nodes.length&&(v=this.nodes.length-1);var E=this.nodes[_],V=this.nodes[v],L=w.scale(h,E.x,V.x,0,1),Q=w.interp(L,E.y,V.y);return this.emit("scan",Q),Q}},movePoint:{value:function(h,v,_){this.nodes[h].move(v,_),this.scaleNode(h),this.calculatePoints(),this.emit("change",this.points),this.render()}},adjustPoint:{value:function(h,v,_){this.nodes[h].move(this.nodes[h].x+v,this.nodes[h].y+_),this.scaleNode(h),this.calculatePoints(),this.emit("change",this.points),this.render()}},destroyPoint:{value:function(h){this.nodes[h].destroy(),this.calculatePoints(),this.emit("change",this.points),this.render()}},setPoints:{value:function(h){for(var v=this;this.nodes.length;)this.nodes[0].destroy();h.forEach(function(_){v.addPoint(_.x,_.y)}),this.calculatePoints(),this.emit("change",this.points),this.render()}}}),l}(y);D.exports=d},function(D,P,m){var C=function(){function g(d,c){for(var l in c){var a=c[l];a.configurable=!0,a.value&&(a.writable=!0)}Object.defineProperties(d,c)}return function(d,c,l){return c&&g(d.prototype,c),l&&g(d,l),d}}(),k=function g(d,c,l){var a=Object.getOwnPropertyDescriptor(d,c);if(a===void 0){var h=Object.getPrototypeOf(d);return h===null?void 0:g(h,c,l)}else{if("value"in a&&a.writable)return a.value;var v=a.get;return v===void 0?void 0:v.call(l)}},M=function(g,d){if(typeof d!="function"&&d!==null)throw new TypeError("Super expression must either be null or a function, not "+typeof d);g.prototype=Object.create(d&&d.prototype,{constructor:{value:g,enumerable:!1,writable:!0,configurable:!0}}),d&&(g.__proto__=d)},I=function(g,d){if(!(g instanceof d))throw new TypeError("Cannot call a class as a function")},w=m(7),x=m(6),y=function(g){function d(){I(this,d);var c=[],l={size:[300,150]};k(Object.getPrototypeOf(d.prototype),"constructor",this).call(this,arguments,c,l),this.analyser=null,this.bufferLength=0,this.dataArray=null,this.active=!1,this.source=null,this.init()}return M(d,g),C(d,{buildFrame:{value:function(){this.canvas=new w.SmartCanvas(this.parent),this.element=this.canvas.element}},sizeInterface:{value:function(){this.canvas.resize(this.width,this.height)}},colorInterface:{value:function(){this.canvas.element.style.backgroundColor=this.colors.fill}},render:{value:function(){if(this.active&&requestAnimationFrame(this.render.bind(this)),this.analyser&&this.analyser.getByteFrequencyData(this.dataArray),this.canvas.context.fillStyle=this.colors.fill,this.canvas.context.fillRect(0,0,this.canvas.element.width,this.canvas.element.height),this.source&&this.dataArray)for(var l=this.canvas.element.width/this.bufferLength,a=void 0,h=0,v=this.canvas.element.width/50,_=0;_<this.bufferLength;_=_+v)a=Math.max.apply(null,this.dataArray.subarray(_,_+v)),a/=255,a*=this.canvas.element.height,this.canvas.context.fillStyle=this.colors.accent,this.canvas.context.fillRect(h,this.canvas.element.height-a,l*v,a),h+=l*v}},connect:{value:function(l){this.source&&this.disconnect(),this.analyser=l.context.createAnalyser(),this.analyser.fftSize=2048,this.bufferLength=this.analyser.frequencyBinCount,this.dataArray=new Uint8Array(this.bufferLength),this.active=!0,this.source=l,this.source.connect(this.analyser),this.render()}},disconnect:{value:function(){this.source&&this.source.disconnect(this.analyser),this.analyser=null,this.bufferLength=0,this.dataArray=null,this.active=!1,this.source=null}},click:{value:function(){this.active=!this.active&&this.source,this.render()}},customDestroy:{value:function(){this.active=!1}}}),d}(x);D.exports=y},function(D,P,m){var C=function(){function d(c,l){for(var a in l){var h=l[a];h.configurable=!0,h.value&&(h.writable=!0)}Object.defineProperties(c,l)}return function(c,l,a){return l&&d(c.prototype,l),a&&d(c,a),c}}(),k=function d(c,l,a){var h=Object.getOwnPropertyDescriptor(c,l);if(h===void 0){var v=Object.getPrototypeOf(c);return v===null?void 0:d(v,l,a)}else{if("value"in h&&h.writable)return h.value;var _=h.get;return _===void 0?void 0:_.call(a)}},M=function(d,c){if(typeof c!="function"&&c!==null)throw new TypeError("Super expression must either be null or a function, not "+typeof c);d.prototype=Object.create(c&&c.prototype,{constructor:{value:d,enumerable:!1,writable:!0,configurable:!0}}),c&&(d.__proto__=c)},I=function(d,c){if(!(d instanceof c))throw new TypeError("Cannot call a class as a function")},w=m(7),x=m(5),y=m(6),g=function(d){function c(){I(this,c);var l=[],a={size:[30,100]};k(Object.getPrototypeOf(c.prototype),"constructor",this).call(this,arguments,l,a),this.channels=2,this.splitter=null,this.analysers=[],this.bufferLength=0,this.dataArray=null,this.active=!1,this.source=null,this.db=-1/0,this.init(),this.meterWidth=this.canvas.element.width/this.channels,this.render()}return M(c,d),C(c,{buildFrame:{value:function(){this.canvas=new w.SmartCanvas(this.parent),this.element=this.canvas.element}},sizeInterface:{value:function(){this.canvas.resize(this.width,this.height)}},colorInterface:{value:function(){this.canvas.element.style.backgroundColor=this.colors.fill}},render:{value:function(){this.active&&requestAnimationFrame(this.render.bind(this)),this.canvas.context.fillStyle=this.colors.fill,this.canvas.context.fillRect(0,0,this.canvas.element.width,this.canvas.element.height);for(var a=0;a<this.analysers.length;a++){if(this.source){this.analysers[a].getFloatTimeDomainData(this.dataArray);for(var h=0,v=0;v<this.dataArray.length;v++)h+=this.dataArray[v]*this.dataArray[v];h=Math.sqrt(h/this.dataArray.length),this.db=20*Math.log10(h)}else this.db>-200&&this.db!==-1/0?this.db-=1:this.db=-1/0;if(this.db>-70){var _=x.normalize(this.db,-70,5),E=_*_,V=x.scale(E,0,1,this.element.height,0);this.canvas.context.fillStyle=this.colors.accent,this.canvas.context.fillRect(this.meterWidth*a,V,this.meterWidth,this.canvas.element.height-V)}}}},connect:{value:function(a,h){this.source&&this.disconnect(),this.channels=h||a.channelCount||2,this.splitter=a.context.createChannelSplitter(this.channels),this.analysers=[];for(var v=0;v<this.channels;v++){var _=a.context.createAnalyser();_.fftSize=1024,_.smoothingTimeConstant=1,this.splitter.connect(_,v),this.analysers.push(_)}this.bufferLength=this.analysers[0].frequencyBinCount,this.dataArray=new Float32Array(this.bufferLength),this.active=!0,this.meterWidth=this.canvas.element.width/this.channels,this.source=a,this.source.connect(this.splitter),this.render()}},disconnect:{value:function(){this.source&&this.source.disconnect(this.splitter),this.splitter=null,this.analysers=[],this.bufferLength=0,this.dataArray=null,this.active=!1,this.source=null}},click:{value:function(){this.active=!this.active&&this.source,this.render()}},customDestroy:{value:function(){this.active=!1}}}),c}(y);D.exports=g},function(D,P,m){var C=function(){function g(d,c){for(var l in c){var a=c[l];a.configurable=!0,a.value&&(a.writable=!0)}Object.defineProperties(d,c)}return function(d,c,l){return c&&g(d.prototype,c),l&&g(d,l),d}}(),k=function g(d,c,l){var a=Object.getOwnPropertyDescriptor(d,c);if(a===void 0){var h=Object.getPrototypeOf(d);return h===null?void 0:g(h,c,l)}else{if("value"in a&&a.writable)return a.value;var v=a.get;return v===void 0?void 0:v.call(l)}},M=function(g,d){if(typeof d!="function"&&d!==null)throw new TypeError("Super expression must either be null or a function, not "+typeof d);g.prototype=Object.create(d&&d.prototype,{constructor:{value:g,enumerable:!1,writable:!0,configurable:!0}}),d&&(g.__proto__=d)},I=function(g,d){if(!(g instanceof d))throw new TypeError("Cannot call a class as a function")},w=m(7),x=m(6),y=function(g){function d(){I(this,d);var c=[],l={size:[300,150]};k(Object.getPrototypeOf(d.prototype),"constructor",this).call(this,arguments,c,l),this.analyser=null,this.bufferLength=0,this.dataArray=null,this.active=!1,this.source=null,this.init(),this.render()}return M(d,g),C(d,{buildFrame:{value:function(){this.canvas=new w.SmartCanvas(this.parent),this.element=this.canvas.element}},sizeInterface:{value:function(){this.canvas.resize(this.width,this.height)}},colorInterface:{value:function(){this.canvas.element.style.backgroundColor=this.colors.fill}},render:{value:function(){if(this.active&&requestAnimationFrame(this.render.bind(this)),this.analyser&&this.analyser.getByteTimeDomainData(this.dataArray),this.canvas.context.fillStyle=this.colors.fill,this.canvas.context.fillRect(0,0,this.canvas.element.width,this.canvas.element.height),this.canvas.context.lineWidth=~~(this.height/100+2),this.canvas.context.strokeStyle=this.colors.accent,this.canvas.context.beginPath(),this.source)for(var l=this.canvas.element.width*1/this.bufferLength,a=0,h=0;h<this.bufferLength;h++){var v=this.dataArray[h]/128,_=v*this.canvas.element.height/2;h===0?this.canvas.context.moveTo(a,_):this.canvas.context.lineTo(a,_),a+=l}else this.canvas.context.moveTo(0,this.canvas.element.height/2),this.canvas.context.lineTo(this.canvas.element.width,this.canvas.element.height/2);this.canvas.context.stroke()}},connect:{value:function(l){this.source&&this.disconnect(),this.analyser=l.context.createAnalyser(),this.analyser.fftSize=2048,this.bufferLength=this.analyser.frequencyBinCount,this.dataArray=new Uint8Array(this.bufferLength),this.analyser.getByteTimeDomainData(this.dataArray),this.active=!0,this.source=l,this.source.connect(this.analyser),this.render()}},disconnect:{value:function(){this.source&&this.source.disconnect(this.analyser),this.analyser=null,this.bufferLength=0,this.dataArray=null,this.active=!1,this.source=null}},click:{value:function(){this.active=!this.active&&this.source,this.render()}},customDestroy:{value:function(){this.active=!1}}}),d}(x);D.exports=y},function(D,P,m){var C=function(d){return d&&d.__esModule?d.default:d},k=function(d){return d&&d.__esModule?d:{default:d}},M=function(){function d(c,l){for(var a in l){var h=l[a];h.configurable=!0,h.value&&(h.writable=!0)}Object.defineProperties(c,l)}return function(c,l,a){return l&&d(c.prototype,l),a&&d(c,a),c}}(),I=function(d,c){if(!(d instanceof c))throw new TypeError("Cannot call a class as a function")},w=k(m(39)),x=C(m(7)),y=m(1).colors,g=function(){function d(c,l){I(this,d),this.meta={},this.meta.target=c,this.meta.parent=x.parseElement(c),this.meta.colors={},l?(this.meta.attribute=l.attribute||"nexus-ui",this.meta.title=l.name||!1,this.meta.open=l.open||!1):(this.meta.attribute="nexus-ui",this.meta.title=!1,this.meta.open=!1);var a=y();this.meta.colors.accent=a.accent,this.meta.colors.fill=a.fill,this.meta.colors.light=a.light,this.meta.colors.dark=a.dark,this.meta.colors.mediumLight=a.mediumLight,this.meta.colors.mediumDark=a.mediumDark,this.buildInterface(),this.colorInterface()}return M(d,{buildInterface:{value:function(){var l=this;for(this.meta.parent.style.boxSizing="border-box",this.meta.parent.style.userSelect="none",this.meta.parent.style.mozUserSelect="none",this.meta.parent.style.webkitUserSelect="none",this.meta.contents=document.createElement("div");this.meta.parent.childNodes.length>0;)this.meta.contents.appendChild(this.meta.parent.childNodes[0]);this.meta.contents.style.padding="0px",this.meta.contents.style.boxSizing="border-box",this.meta.title&&(this.meta.titleBar=document.createElement("div"),this.meta.titleBar.innerHTML=this.meta.title,this.meta.titleBar.style.fontFamily="arial",this.meta.titleBar.style.position="relative",this.meta.titleBar.style.color="#888",this.meta.titleBar.style.padding="7px",this.meta.titleBar.style.fontSize="12px",this.meta.button=document.createElement("div"),this.meta.button.style.position="absolute",this.meta.button.style.top="5px",this.meta.button.style.right="5px",this.meta.button.innerHTML="-",this.meta.button.style.padding="0px 5px 2px",this.meta.button.style.lineHeight="12px",this.meta.button.style.fontSize="15px",this.meta.button.style.cursor="pointer",this.meta.button.addEventListener("mouseover",function(){l.meta.button.style.backgroundColor=l.meta.colors.mediumDark}),this.meta.button.addEventListener("mouseleave",function(){l.meta.button.style.backgroundColor=l.meta.colors.mediumLight}),this.meta.button.addEventListener("click",function(){l.meta.open?l.hide():l.show()}),this.meta.titleBar.appendChild(this.meta.button),this.meta.parent.appendChild(this.meta.titleBar)),this.meta.parent.appendChild(this.meta.contents);var a=w.section(this.meta.target,this.meta.attribute);for(var h in a)this[h]=a[h]}},colorInterface:{value:function(){this.meta.title&&(this.meta.button.style.backgroundColor=this.meta.colors.mediumLight,this.meta.button.style.border="solid 0px "+this.meta.colors.fill,this.meta.parent.style.border="solid 1px "+this.meta.colors.mediumLight,this.meta.parent.style.backgroundColor=this.meta.colors.light,this.meta.titleBar.style.backgroundColor=this.meta.colors.fill)}},show:{value:function(){this.meta.contents.style.display="block",this.meta.open=!0}},hide:{value:function(){this.meta.contents.style.display="none",this.meta.open=!1}},colorize:{value:function(l,a){for(var h in this)this[h].colorize&&this[h].colorize(l,a);this.meta.colors[l]=a,this.colorInterface()}},empty:{value:function(){for(var l in this)this[l].destroy&&this[l].destroy()}}}),d}();D.exports=g},function(D,P,m){var C=function(g){return g&&g.__esModule?g.default:g};Object.defineProperty(P,"__esModule",{value:!0});var k=C(m(7)),M=C(m(2)),I=function(g,d){var c=g.type;return d[c]?d[c]++:d[c]=1,c+d[c]},w=function(g,d,c){c=c||{};for(var l=0;l<g.attributes.length;l++){var a=g.attributes[l];c[a.nodeName]=a.nodeValue}d=d[0].toUpperCase()+d.slice(1);var h=new M[d](g,c);return h.id=g.id,h},x=function(g,d){d=d||"nexus-ui";for(var c={},l=k.parseElement(g),a={},h=l.getElementsByTagName("*"),v=[],_=0;_<h.length;_++)v.push(h[_]);for(var _=0;_<v.length;_++){var E=v[_].getAttribute(d);if(E){var V=!1;for(var L in M)E.toLowerCase()===L.toLowerCase()&&(V=L);console.log(V);var Q=w(v[_],V);if(Q.id)a[Q.id]=Q;else{var et=I(Q,c);a[et]=Q}}}return a},y=function(g,d,c){var l=document.createElement("div");return c=c||{},d?d=k.parseElement(d):d=document.body,d.appendChild(l),c.target=l,c.size&&(l.style.width=c.size[0]+"px",l.style.height=c.size[1]+"px"),w(l,g,c)};P.element=w,P.section=x,P.add=y},function(D,P,m){var C=function(x){return x&&x.__esModule?x.default:x},k=function(){function x(y,g){for(var d in g){var c=g[d];c.configurable=!0,c.value&&(c.writable=!0)}Object.defineProperties(y,g)}return function(y,g,d){return g&&x(y.prototype,g),d&&x(y,d),y}}(),M=function(x,y){if(!(x instanceof y))throw new TypeError("Cannot call a class as a function")},I=C(m(5)),w=function(){function x(){M(this,x),this.scale=[],this.mode={output:"frequency",input:"step"},this.etmajor=[261.62558,293.664764,329.627563,349.228241,391.995422,440,493.883301,523.25116],this.root=I.mtof(60),this.createScale(0,2,4,5,7,9,11)}return k(x,{note:{value:function(g,d){var c=void 0;return this.mode.output==="frequency"?c=this.frequency(g,d):this.mode.output==="ratio"?c=this.ratio(g,d):this.mode.output==="MIDI"?c=this.MIDI(g,d):c=this.frequency(g,d),c}},frequency:{value:function(g,d){(this.mode.input==="midi"||this.mode.input==="MIDI")&&(this.stepIn+=60);var c=Math.floor(g/this.scale.length);d&&(c+=d);for(var l=g%this.scale.length;l<0;)l+=this.scale.length;var a=this.scale[l],h=this.root*a;return h=h*Math.pow(2,c),h=Math.floor(h*1e11)/1e11,h}},ratio:{value:function(g,d){(this.mode.input==="midi"||this.mode.input==="MIDI")&&(this.stepIn+=60);var c=Math.floor(g/this.scale.length);d&&(c+=d);var l=g%this.scale.length,a=Math.pow(2,c)*this.scale[l];return a=Math.floor(a*1e11)/1e11,a}},MIDI:{value:function(g,d){var c=this.frequency(g,d),l=69+12*Math.log(c/440)/Math.log(2);return l=Math.floor(l*1e9)/1e9,l}},createScale:{value:function(){for(var g=[],d=0;d<arguments.length;d++)g.push(I.mtof(60+arguments[d]));this.loadScaleFromFrequencies(g)}},createJIScale:{value:function(){this.scale=[];for(var g=0;g<arguments.length;g++)this.scale.push(arguments[g])}},loadScaleFromFrequencies:{value:function(g){this.scale=[];for(var d=0;d<g.length;d++)this.scale.push(g[d]/g[0])}},loadScale:{value:function(g){var d=this.scales[g].frequencies;this.loadScaleFromFrequencies(d)}},search:{value:function(g){var d=[];for(var c in this.scales)c.toLowerCase().indexOf(g.toLowerCase())!==-1&&d.push(c);return d}},chord:{value:function(g){for(var d=[],c=0;c<g.length;c++)d.push(this.note(g[c]));return d}}}),x}();D.exports=w},function(D,P){var m=function(){function M(I,w){for(var x in w){var y=w[x];y.configurable=!0,y.value&&(y.writable=!0)}Object.defineProperties(I,w)}return function(I,w,x){return w&&M(I.prototype,w),x&&M(I,x),I}}(),C=function(M,I){if(!(M instanceof I))throw new TypeError("Cannot call a class as a function")},k=function(){function M(){for(var I=arguments.length,w=Array(I>1?I-1:0),x=1;x<I;x++)w[x-1]=arguments[x];var y=arguments[0]===void 0?3:arguments[0];C(this,M),y<0&&(y=1),this.length=y,this.onVals=w,this.array=new Array(y).fill(0),w.length>0&&this.on.apply(this,w)}return m(M,{select:{value:function(w){return this.array.fill(0),this.array[w]=1,this.array}},flip:{value:function(){for(var w=arguments.length,x=Array(w),y=0;y<w;y++)x[y]=arguments[y];var g=this.array;return x.length>0?x.forEach(function(d){d>g.length-1?console.warn("Warning: AnonRadio["+d+"] does not exist"):g[d]=g[d]?0:1}):g.forEach(function(d,c,l){l[c]=d?0:1}),g}},on:{value:function(){for(var w=arguments.length,x=Array(w),y=0;y<w;y++)x[y]=arguments[y];var g=this.array;return x.length>0?x.forEach(function(d){d>g.length-1?console.warn("Warning: AnonRadio["+d+"] exceeds size of object"):(g[d]===1&&console.warn("Warning: AnonRadio["+d+"] was already on."),g[d]=1)}):g.fill(1),g}},off:{value:function(){for(var w=arguments.length,x=Array(w),y=0;y<w;y++)x[y]=arguments[y];var g=this.array;return x.length>0?x.forEach(function(d){g[d]=0}):g.fill(0),g}}}),M}();D.exports=k},function(D,P,m){var C=m(43);D.exports=C,typeof window<"u"&&(window.WAAClock=C)},function(D,P,m){(function(C){var k={toleranceLate:.1,toleranceEarly:.001},M=function(w,x,y){this.clock=w,this.func=y,this._cleared=!1,this.toleranceLate=w.toleranceLate,this.toleranceEarly=w.toleranceEarly,this._latestTime=null,this._earliestTime=null,this.deadline=null,this.repeatTime=null,this.schedule(x)};M.prototype.clear=function(){return this.clock._removeEvent(this),this._cleared=!0,this},M.prototype.repeat=function(w){if(w===0)throw new Error("delay cannot be 0");return this.repeatTime=w,this.clock._hasEvent(this)||this.schedule(this.deadline+this.repeatTime),this},M.prototype.tolerance=function(w){return typeof w.late=="number"&&(this.toleranceLate=w.late),typeof w.early=="number"&&(this.toleranceEarly=w.early),this._refreshEarlyLateDates(),this.clock._hasEvent(this)&&(this.clock._removeEvent(this),this.clock._insertEvent(this)),this},M.prototype.isRepeated=function(){return this.repeatTime!==null},M.prototype.schedule=function(w){this._cleared=!1,this.deadline=w,this._refreshEarlyLateDates(),this.clock.context.currentTime>=this._earliestTime?this._execute():this.clock._hasEvent(this)?(this.clock._removeEvent(this),this.clock._insertEvent(this)):this.clock._insertEvent(this)},M.prototype.timeStretch=function(w,x){this.isRepeated()&&(this.repeatTime=this.repeatTime*x);var y=w+x*(this.deadline-w);if(this.isRepeated())for(;this.clock.context.currentTime>=y-this.toleranceEarly;)y+=this.repeatTime;this.schedule(y)},M.prototype._execute=function(){this.clock._started!==!1&&(this.clock._removeEvent(this),this.clock.context.currentTime<this._latestTime?this.func(this):(this.onexpired&&this.onexpired(this),console.warn("event expired")),!this.clock._hasEvent(this)&&this.isRepeated()&&!this._cleared&&this.schedule(this.deadline+this.repeatTime))},M.prototype._refreshEarlyLateDates=function(){this._latestTime=this.deadline+this.toleranceLate,this._earliestTime=this.deadline-this.toleranceEarly};var I=D.exports=function(w,x){x=x||{},this.tickMethod=x.tickMethod||"ScriptProcessorNode",this.toleranceEarly=x.toleranceEarly||k.toleranceEarly,this.toleranceLate=x.toleranceLate||k.toleranceLate,this.context=w,this._events=[],this._started=!1};I.prototype.setTimeout=function(w,x){return this._createEvent(w,this._absTime(x))},I.prototype.callbackAtTime=function(w,x){return this._createEvent(w,x)},I.prototype.timeStretch=function(w,x,y){return x.forEach(function(g){g.timeStretch(w,y)}),x},I.prototype.start=function(){if(this._started===!1){var w=this;if(this._started=!0,this._events=[],this.tickMethod==="ScriptProcessorNode"){var x=256;this._clockNode=this.context.createScriptProcessor(x,1,1),this._clockNode.connect(this.context.destination),this._clockNode.onaudioprocess=function(){C.nextTick(function(){w._tick()})}}else if(this.tickMethod!=="manual")throw new Error("invalid tickMethod "+this.tickMethod)}},I.prototype.stop=function(){this._started===!0&&(this._started=!1,this._clockNode.disconnect())},I.prototype._tick=function(){for(var w=this._events.shift();w&&w._earliestTime<=this.context.currentTime;)w._execute(),w=this._events.shift();w&&this._events.unshift(w)},I.prototype._createEvent=function(w,x){return new M(this,x,w)},I.prototype._insertEvent=function(w){this._events.splice(this._indexByTime(w._earliestTime),0,w)},I.prototype._removeEvent=function(w){var x=this._events.indexOf(w);x!==-1&&this._events.splice(x,1)},I.prototype._hasEvent=function(w){return this._events.indexOf(w)!==-1},I.prototype._indexByTime=function(w){for(var x=0,y=this._events.length,g;x<y;)g=Math.floor((x+y)/2),this._events[g]._earliestTime<w?x=g+1:y=g;return x},I.prototype._absTime=function(w){return w+this.context.currentTime},I.prototype._relTime=function(w){return w-this.context.currentTime}}).call(P,m(44))},function(D,P){var m=D.exports={},C,k;function M(){throw new Error("setTimeout has not been defined")}function I(){throw new Error("clearTimeout has not been defined")}(function(){try{typeof setTimeout=="function"?C=setTimeout:C=M}catch{C=M}try{typeof clearTimeout=="function"?k=clearTimeout:k=I}catch{k=I}})();function w(_){if(C===setTimeout)return setTimeout(_,0);if((C===M||!C)&&setTimeout)return C=setTimeout,setTimeout(_,0);try{return C(_,0)}catch{try{return C.call(null,_,0)}catch{return C.call(this,_,0)}}}function x(_){if(k===clearTimeout)return clearTimeout(_);if((k===I||!k)&&clearTimeout)return k=clearTimeout,clearTimeout(_);try{return k(_)}catch{try{return k.call(null,_)}catch{return k.call(this,_)}}}var y=[],g=!1,d,c=-1;function l(){!g||!d||(g=!1,d.length?y=d.concat(y):c=-1,y.length&&a())}function a(){if(!g){var _=w(l);g=!0;for(var E=y.length;E;){for(d=y,y=[];++c<E;)d&&d[c].run();c=-1,E=y.length}d=null,g=!1,x(_)}}m.nextTick=function(_){var E=new Array(arguments.length-1);if(arguments.length>1)for(var V=1;V<arguments.length;V++)E[V-1]=arguments[V];y.push(new h(_,E)),y.length===1&&!g&&w(a)};function h(_,E){this.fun=_,this.array=E}h.prototype.run=function(){this.fun.apply(null,this.array)},m.title="browser",m.browser=!0,m.env={},m.argv=[],m.version="",m.versions={};function v(){}m.on=v,m.addListener=v,m.once=v,m.off=v,m.removeListener=v,m.removeAllListeners=v,m.emit=v,m.prependListener=v,m.prependOnceListener=v,m.listeners=function(_){return[]},m.binding=function(_){throw new Error("process.binding is not supported")},m.cwd=function(){return"/"},m.chdir=function(_){throw new Error("process.chdir is not supported")},m.umask=function(){return 0}}])})}(Vn)),Vn.exports}var mu=fu();const gu=Pl(mu);console.log("HarmonicMultislider: Module loaded.");function vu(){const A=new gu.Multislider("#harmonic-multislider",{size:[400,150],numberOfSliders:11,min:0,max:1,step:.001,values:U.state.harmonicLevels});A.on("change",N=>{U.state.harmonicLevels=N,U.emit("harmonicLevelsChanged",N)}),U.on("harmonicPresetChanged",N=>{Array.isArray(N)&&N.length===11&&(A.setAllSliders(N),U.state.harmonicLevels=N,console.log("HarmonicMultislider: UI updated from preset."))}),console.log("HarmonicMultislider: Initialized.")}console.log("CustomEnvelope: Module loaded.");const _u={C:"#f090ae","D♭/C♯":"#f59383",D:"#ea9e5e","E♭/D♯":"#d0ae4e",E:"#a8bd61",F:"#76c788","G♭/F♯":"#41cbb5",G:"#33c6dc","A♭/G♯":"#62bbf7",A:"#94adff","B♭/A♯":"#bea0f3",B:"#dd95d6"};function yu(A){if(!A)return"C";let N=A.replace(/\d/g,"").trim();return{Ab:"A♭/G♯","G#":"A♭/G♯",Db:"D♭/C♯","C#":"D♭/C♯",Eb:"E♭/D♯","D#":"E♭/D♯",Gb:"G♭/F♯","F#":"G♭/F♯",Bb:"B♭/A♯","A#":"B♭/A♯"}[N]||N}class xu{constructor(N){this.container=document.querySelector(N.container),this.width=N.width||400,this.height=N.height||150,this.totalTime=8.5,this.attack=U.state.adsr.attack,this.decay=U.state.adsr.decay,this.sustain=U.state.adsr.sustain,this.release=U.state.adsr.release,this.tempo=U.state.tempo,this.isPaused=U.state.isPaused,this.playheads={},this.createSVGLayers(),this.drawGridlines(),this.updateEnvelopeDrawing(),this.initInteraction(),this.listenForStoreChanges()}listenForStoreChanges(){U.on("tempoChanged",N=>{this.tempo=N,this.drawGridlines()}),U.on("playbackStateChanged",({isPlaying:N,isPaused:D})=>{this.isPaused=D,!N&&!D&&this.clearPlayheads()})}createSVGLayers(){this.svgContainer=document.createElementNS("http://www.w3.org/2000/svg","svg"),this.svgContainer.setAttribute("width",this.width),this.svgContainer.setAttribute("height",this.height),this.svgContainer.style.backgroundColor="#fff",this.svgContainer.style.border="1px solid #ccc",this.svgContainer.style.borderRadius="4px",this.gridLayer=document.createElementNS("http://www.w3.org/2000/svg","g"),this.envelopeLayer=document.createElementNS("http://www.w3.org/2000/svg","g"),this.playheadLayer=document.createElementNS("http://www.w3.org/2000/svg","g"),this.svgContainer.appendChild(this.gridLayer),this.svgContainer.appendChild(this.envelopeLayer),this.svgContainer.appendChild(this.playheadLayer),this.container.appendChild(this.svgContainer)}drawGridlines(){for(;this.gridLayer.firstChild;)this.gridLayer.removeChild(this.gridLayer.firstChild);const N=60/(this.tempo*2),D=Math.floor(this.totalTime/N);for(let P=0;P<=D;P++){if(P%2!==0)continue;const C=P*N/this.totalTime*this.width,k=document.createElementNS("http://www.w3.org/2000/svg","line");k.setAttribute("x1",C),k.setAttribute("y1",0),k.setAttribute("x2",C),k.setAttribute("y2",this.height),k.setAttribute("stroke","#ddd"),k.setAttribute("stroke-width",1),this.gridLayer.appendChild(k)}}calculateEnvelopePoints(){const N={x:0,y:this.height},D={x:this.attack/this.totalTime*this.width,y:0},P={x:(this.attack+this.decay)/this.totalTime*this.width,y:this.height*(1-this.sustain)},m={x:(this.attack+this.decay+this.release)/this.totalTime*this.width,y:this.height},C={x:this.width,y:this.height};return[N,D,P,m,C]}updateEnvelopeDrawing(){for(;this.envelopeLayer.firstChild;)this.envelopeLayer.removeChild(this.envelopeLayer.firstChild);this.points=this.calculateEnvelopePoints();const N=document.createElementNS("http://www.w3.org/2000/svg","polygon");N.setAttribute("points",this.points.map(P=>`${P.x},${P.y}`).join(" ")),N.setAttribute("fill","rgba(0,0,0,0.2)"),this.envelopeLayer.appendChild(N);const D=document.createElementNS("http://www.w3.org/2000/svg","polyline");D.setAttribute("points",this.points.slice(0,4).map(P=>`${P.x},${P.y}`).join(" ")),D.setAttribute("stroke","#000"),D.setAttribute("stroke-width",2),D.setAttribute("fill","none"),this.envelopeLayer.appendChild(D),this.controlPoints=[];for(let P=1;P<=3;P++){const m=document.createElementNS("http://www.w3.org/2000/svg","circle");m.setAttribute("cx",this.points[P].x),m.setAttribute("cy",this.points[P].y),m.setAttribute("r",6),m.setAttribute("fill","white"),m.setAttribute("stroke","#000"),m.style.cursor="pointer",m.dataset.index=P,this.envelopeLayer.appendChild(m),this.controlPoints.push(m)}}initInteraction(){let N=null;const D=()=>{this.updateEnvelopeDrawing();const P={attack:this.attack,decay:this.decay,sustain:this.sustain,release:this.release};U.state.adsr=P,U.emit("adsrChanged",P)};this.svgContainer.addEventListener("mousedown",P=>{P.target.tagName.toLowerCase()==="circle"&&(N=P.target)}),this.svgContainer.addEventListener("mousemove",P=>{if(!N)return;const m=this.getSVGPoint(P),C=parseInt(N.dataset.index);C===1?this.attack=Math.max(0,m.x/this.width*this.totalTime):C===2?(this.decay=Math.max(0,m.x/this.width*this.totalTime-this.attack),this.sustain=Math.max(0,Math.min(1,1-m.y/this.height))):C===3&&(this.release=Math.max(0,m.x/this.width*this.totalTime-this.attack-this.decay)),D()}),window.addEventListener("mouseup",()=>{N=null})}getSVGPoint(N){const D=this.svgContainer.createSVGPoint();return D.x=N.clientX,D.y=N.clientY,D.matrixTransform(this.svgContainer.getScreenCTM().inverse())}clearPlayheads(){Object.values(this.playheads).forEach(N=>{N.requestId&&cancelAnimationFrame(N.requestId),N.group.remove()}),this.playheads={}}triggerPlayhead(N,D){const P=yu(N),m=_u[P]||"#f00";this.playheads[N]&&(cancelAnimationFrame(this.playheads[N].requestId),this.playheads[N].group.remove(),delete this.playheads[N]);const C=document.createElementNS("http://www.w3.org/2000/svg","g"),k=document.createElementNS("http://www.w3.org/2000/svg","line"),M=document.createElementNS("http://www.w3.org/2000/svg","circle");k.setAttribute("stroke",m),k.setAttribute("stroke-width",2),k.setAttribute("stroke-dasharray","2,4"),M.setAttribute("r",4),M.setAttribute("fill",m),C.append(k,M),this.playheadLayer.appendChild(C);const I={group:C,requestId:null,startTime:Pt.now()};this.playheads[N]=I;const[w,x,y,g]=this.calculateEnvelopePoints(),d=()=>{if(this.isPaused){I.requestId=requestAnimationFrame(d);return}const c=Pt.now()-I.startTime;let l,a,h,v=!1;if(D==="attack"){if(h=this.attack+this.decay,c<=this.attack){const _=c/this.attack;l=w.x+_*(x.x-w.x),a=w.y+_*(x.y-w.y)}else{const _=(c-this.attack)/this.decay;l=x.x+_*(y.x-x.x),a=x.y+_*(y.y-x.y)}c>=h&&(l=y.x,a=y.y)}else{h=this.release;const _=c/h;l=y.x+_*(g.x-y.x),a=y.y+_*(g.y-y.y),c>=h&&(v=!0)}k.setAttribute("x1",l),k.setAttribute("y1",0),k.setAttribute("x2",l),k.setAttribute("y2",this.height),M.setAttribute("cx",l),M.setAttribute("cy",a),v?(C.remove(),delete this.playheads[N]):I.requestId=requestAnimationFrame(d)};d()}}function bu(){const A=document.getElementById("adsr-envelope");if(!A)return console.error("ADSR container element not found."),null;const N=new xu({container:"#adsr-envelope",width:A.clientWidth,height:A.clientHeight});return console.log("CustomEnvelope: Initialized."),N}console.log("Main.js: Application starting...");document.addEventListener("DOMContentLoaded",()=>{console.log("Main.js: DOMContentLoaded event fired."),U.state.fullRowData=Fl,ne.init(),Me.init(),Ln.init(),br.init(),du(),Wl();const A=bu();Me.setCustomEnvelope(A),vu(),console.log("Main.js: Setting up state subscriptions."),U.on("notesChanged",()=>{Nn.render(),wr.render()}),U.on("gridChanged",Nn.render),U.on("gridResized",()=>{Nn.render(),wr.render(),br.renderRhythmUI()}),U.on("rhythmChanged",()=>{}),console.log("Main.js: Performing initial render."),br.renderRhythmUI(),Nn.render(),wr.render(),console.log("Main.js: Application initialization complete.")});
