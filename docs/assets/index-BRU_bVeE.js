var TC=Object.defineProperty;var IC=(e,t,s)=>t in e?TC(e,t,{enumerable:!0,configurable:!0,writable:!0,value:s}):e[t]=s;var Ys=(e,t,s)=>IC(e,typeof t!="symbol"?t+"":t,s);function QC(e,t){for(var s=0;s<t.length;s++){const i=t[s];if(typeof i!="string"&&!Array.isArray(i)){for(const A in i)if(A!=="default"&&!(A in e)){const r=Object.getOwnPropertyDescriptor(i,A);r&&Object.defineProperty(e,A,r.get?r:{enumerable:!0,get:()=>i[A]})}}}return Object.freeze(Object.defineProperty(e,Symbol.toStringTag,{value:"Module"}))}(function(){const t=document.createElement("link").relList;if(t&&t.supports&&t.supports("modulepreload"))return;for(const A of document.querySelectorAll('link[rel="modulepreload"]'))i(A);new MutationObserver(A=>{for(const r of A)if(r.type==="childList")for(const a of r.addedNodes)a.tagName==="LINK"&&a.rel==="modulepreload"&&i(a)}).observe(document,{childList:!0,subtree:!0});function s(A){const r={};return A.integrity&&(r.integrity=A.integrity),A.referrerPolicy&&(r.referrerPolicy=A.referrerPolicy),A.crossOrigin==="use-credentials"?r.credentials="include":A.crossOrigin==="anonymous"?r.credentials="omit":r.credentials="same-origin",r}function i(A){if(A.ep)return;A.ep=!0;const r=s(A);fetch(A.href,r)}})();function uw(e){return e&&e.__esModule&&Object.prototype.hasOwnProperty.call(e,"default")?e.default:e}var Fl={exports:{}};/*! For license information please see Tone.js.LICENSE.txt */var MC=Fl.exports,im;function UC(){return im||(im=1,(function(e,t){(function(s,i){e.exports=i()})(typeof self<"u"?self:MC,(()=>(()=>{var s={871:function(a,l,h){(function(u,m,g,v){var y=function(tt,ct,lt){return{endTime:ct,insertTime:lt,type:"exponentialRampToValue",value:tt}},C=function(tt,ct,lt){return{endTime:ct,insertTime:lt,type:"linearRampToValue",value:tt}},x=function(tt,ct){return{startTime:ct,type:"setValue",value:tt}},F=function(tt,ct,lt){return{duration:lt,startTime:ct,type:"setValueCurve",values:tt}},I=function(tt,ct,lt){var mt=lt.startTime,At=lt.target,St=lt.timeConstant;return At+(ct-At)*Math.exp((mt-tt)/St)},T=function(tt){return tt.type==="exponentialRampToValue"},U=function(tt){return tt.type==="linearRampToValue"},D=function(tt){return T(tt)||U(tt)},O=function(tt){return tt.type==="setValue"},R=function(tt){return tt.type==="setValueCurve"},st=function tt(ct,lt,mt,At){var St=ct[lt];return St===void 0?At:D(St)||O(St)?St.value:R(St)?St.values[St.values.length-1]:I(mt,tt(ct,lt-1,St.startTime,At),St)},Y=function(tt,ct,lt,mt,At){return lt===void 0?[mt.insertTime,At]:D(lt)?[lt.endTime,lt.value]:O(lt)?[lt.startTime,lt.value]:R(lt)?[lt.startTime+lt.duration,lt.values[lt.values.length-1]]:[lt.startTime,st(tt,ct-1,lt.startTime,At)]},L=function(tt){return tt.type==="cancelAndHold"},J=function(tt){return tt.type==="cancelScheduledValues"},dt=function(tt){return L(tt)||J(tt)?tt.cancelTime:T(tt)||U(tt)?tt.endTime:tt.startTime},ht=function(tt,ct,lt,mt){var At=mt.endTime,St=mt.value;return lt===St?St:0<lt&&0<St||lt<0&&St<0?lt*Math.pow(St/lt,(tt-ct)/(At-ct)):0},rt=function(tt,ct,lt,mt){return lt+(tt-ct)/(mt.endTime-ct)*(mt.value-lt)},Tt=function(tt,ct){var lt=ct.duration,mt=ct.startTime,At=ct.values;return(function(St,Qt){var Pt=Math.floor(Qt),Vt=Math.ceil(Qt);return Pt===Vt?St[Pt]:(1-(Qt-Pt))*St[Pt]+(1-(Vt-Qt))*St[Vt]})(At,(tt-mt)/lt*(At.length-1))},It=function(tt){return tt.type==="setTarget"},Ht=(function(){return v((function tt(ct){g(this,tt),this._automationEvents=[],this._currenTime=0,this._defaultValue=ct}),[{key:Symbol.iterator,value:function(){return this._automationEvents[Symbol.iterator]()}},{key:"add",value:function(tt){var ct=dt(tt);if(L(tt)||J(tt)){var lt=this._automationEvents.findIndex((function(is){return J(tt)&&R(is)?is.startTime+is.duration>=ct:dt(is)>=ct})),mt=this._automationEvents[lt];if(lt!==-1&&(this._automationEvents=this._automationEvents.slice(0,lt)),L(tt)){var At=this._automationEvents[this._automationEvents.length-1];if(mt!==void 0&&D(mt)){if(At!==void 0&&It(At))throw new Error("The internal list is malformed.");var St=At===void 0?mt.insertTime:R(At)?At.startTime+At.duration:dt(At),Qt=At===void 0?this._defaultValue:R(At)?At.values[At.values.length-1]:At.value,Pt=T(mt)?ht(ct,St,Qt,mt):rt(ct,St,Qt,mt),Vt=T(mt)?y(Pt,ct,this._currenTime):C(Pt,ct,this._currenTime);this._automationEvents.push(Vt)}if(At!==void 0&&It(At)&&this._automationEvents.push(x(this.getValue(ct),ct)),At!==void 0&&R(At)&&At.startTime+At.duration>ct){var he=ct-At.startTime,Lt=(At.values.length-1)/At.duration,Te=Math.max(2,1+Math.ceil(he*Lt)),ns=he/(Te-1)*Lt,qt=At.values.slice(0,Te);if(ns<1)for(var se=1;se<Te;se+=1){var Ie=ns*se%1;qt[se]=At.values[se-1]*(1-Ie)+At.values[se]*Ie}this._automationEvents[this._automationEvents.length-1]=F(qt,At.startTime,he)}}}else{var ie=this._automationEvents.findIndex((function(is){return dt(is)>ct})),Ks=ie===-1?this._automationEvents[this._automationEvents.length-1]:this._automationEvents[ie-1];if(Ks!==void 0&&R(Ks)&&dt(Ks)+Ks.duration>ct)return!1;var Hn=T(tt)?y(tt.value,tt.endTime,this._currenTime):U(tt)?C(tt.value,ct,this._currenTime):tt;if(ie===-1)this._automationEvents.push(Hn);else{if(R(tt)&&ct+tt.duration>dt(this._automationEvents[ie]))return!1;this._automationEvents.splice(ie,0,Hn)}}return!0}},{key:"flush",value:function(tt){var ct=this._automationEvents.findIndex((function(At){return dt(At)>tt}));if(ct>1){var lt=this._automationEvents.slice(ct-1),mt=lt[0];It(mt)&&lt.unshift(x(st(this._automationEvents,ct-2,mt.startTime,this._defaultValue),mt.startTime)),this._automationEvents=lt}}},{key:"getValue",value:function(tt){if(this._automationEvents.length===0)return this._defaultValue;var ct=this._automationEvents.findIndex((function(qt){return dt(qt)>tt})),lt=this._automationEvents[ct],mt=(ct===-1?this._automationEvents.length:ct)-1,At=this._automationEvents[mt];if(At!==void 0&&It(At)&&(lt===void 0||!D(lt)||lt.insertTime>tt))return I(tt,st(this._automationEvents,mt-1,At.startTime,this._defaultValue),At);if(At!==void 0&&O(At)&&(lt===void 0||!D(lt)))return At.value;if(At!==void 0&&R(At)&&(lt===void 0||!D(lt)||At.startTime+At.duration>tt))return tt<At.startTime+At.duration?Tt(tt,At):At.values[At.values.length-1];if(At!==void 0&&D(At)&&(lt===void 0||!D(lt)))return At.value;if(lt!==void 0&&T(lt)){var St=Y(this._automationEvents,mt,At,lt,this._defaultValue),Qt=m(St,2),Pt=Qt[0],Vt=Qt[1];return ht(tt,Pt,Vt,lt)}if(lt!==void 0&&U(lt)){var he=Y(this._automationEvents,mt,At,lt,this._defaultValue),Lt=m(he,2),Te=Lt[0],ns=Lt[1];return rt(tt,Te,ns,lt)}return this._defaultValue}}])})();u.AutomationEventList=Ht,u.createCancelAndHoldAutomationEvent=function(tt){return{cancelTime:tt,type:"cancelAndHold"}},u.createCancelScheduledValuesAutomationEvent=function(tt){return{cancelTime:tt,type:"cancelScheduledValues"}},u.createExponentialRampToValueAutomationEvent=function(tt,ct){return{endTime:ct,type:"exponentialRampToValue",value:tt}},u.createLinearRampToValueAutomationEvent=function(tt,ct){return{endTime:ct,type:"linearRampToValue",value:tt}},u.createSetTargetAutomationEvent=function(tt,ct,lt){return{startTime:ct,target:tt,timeConstant:lt,type:"setTarget"}},u.createSetValueAutomationEvent=x,u.createSetValueCurveAutomationEvent=F})(l,h(821),h(805),h(989))},113:a=>{a.exports=function(l,h){(h==null||h>l.length)&&(h=l.length);for(var u=0,m=new Array(h);u<h;u++)m[u]=l[u];return m},a.exports.__esModule=!0,a.exports.default=a.exports},569:a=>{a.exports=function(l){if(Array.isArray(l))return l},a.exports.__esModule=!0,a.exports.default=a.exports},805:a=>{a.exports=function(l,h){if(!(l instanceof h))throw new TypeError("Cannot call a class as a function")},a.exports.__esModule=!0,a.exports.default=a.exports},989:(a,l,h)=>{var u=h(498);function m(g,v){for(var y=0;y<v.length;y++){var C=v[y];C.enumerable=C.enumerable||!1,C.configurable=!0,"value"in C&&(C.writable=!0),Object.defineProperty(g,u(C.key),C)}}a.exports=function(g,v,y){return v&&m(g.prototype,v),y&&m(g,y),Object.defineProperty(g,"prototype",{writable:!1}),g},a.exports.__esModule=!0,a.exports.default=a.exports},474:a=>{a.exports=function(l,h){var u=l==null?null:typeof Symbol<"u"&&l[Symbol.iterator]||l["@@iterator"];if(u!=null){var m,g,v,y,C=[],x=!0,F=!1;try{if(v=(u=u.call(l)).next,h===0){if(Object(u)!==u)return;x=!1}else for(;!(x=(m=v.call(u)).done)&&(C.push(m.value),C.length!==h);x=!0);}catch(I){F=!0,g=I}finally{try{if(!x&&u.return!=null&&(y=u.return(),Object(y)!==y))return}finally{if(F)throw g}}return C}},a.exports.__esModule=!0,a.exports.default=a.exports},18:a=>{a.exports=function(){throw new TypeError(`Invalid attempt to destructure non-iterable instance.
In order to be iterable, non-array objects must have a [Symbol.iterator]() method.`)},a.exports.__esModule=!0,a.exports.default=a.exports},821:(a,l,h)=>{var u=h(569),m=h(474),g=h(744),v=h(18);a.exports=function(y,C){return u(y)||m(y,C)||g(y,C)||v()},a.exports.__esModule=!0,a.exports.default=a.exports},327:(a,l,h)=>{var u=h(564).default;a.exports=function(m,g){if(u(m)!="object"||!m)return m;var v=m[Symbol.toPrimitive];if(v!==void 0){var y=v.call(m,g||"default");if(u(y)!="object")return y;throw new TypeError("@@toPrimitive must return a primitive value.")}return(g==="string"?String:Number)(m)},a.exports.__esModule=!0,a.exports.default=a.exports},498:(a,l,h)=>{var u=h(564).default,m=h(327);a.exports=function(g){var v=m(g,"string");return u(v)=="symbol"?v:v+""},a.exports.__esModule=!0,a.exports.default=a.exports},564:a=>{function l(h){return a.exports=l=typeof Symbol=="function"&&typeof Symbol.iterator=="symbol"?function(u){return typeof u}:function(u){return u&&typeof Symbol=="function"&&u.constructor===Symbol&&u!==Symbol.prototype?"symbol":typeof u},a.exports.__esModule=!0,a.exports.default=a.exports,l(h)}a.exports=l,a.exports.__esModule=!0,a.exports.default=a.exports},744:(a,l,h)=>{var u=h(113);a.exports=function(m,g){if(m){if(typeof m=="string")return u(m,g);var v=Object.prototype.toString.call(m).slice(8,-1);return v==="Object"&&m.constructor&&(v=m.constructor.name),v==="Map"||v==="Set"?Array.from(m):v==="Arguments"||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(v)?u(m,g):void 0}},a.exports.__esModule=!0,a.exports.default=a.exports}},i={};function A(a){var l=i[a];if(l!==void 0)return l.exports;var h=i[a]={exports:{}};return s[a].call(h.exports,h,h.exports,A),h.exports}A.d=(a,l)=>{for(var h in l)A.o(l,h)&&!A.o(a,h)&&Object.defineProperty(a,h,{enumerable:!0,get:l[h]})},A.o=(a,l)=>Object.prototype.hasOwnProperty.call(a,l),A.r=a=>{typeof Symbol<"u"&&Symbol.toStringTag&&Object.defineProperty(a,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(a,"__esModule",{value:!0})};var r={};return(()=>{A.r(r),A.d(r,{AMOscillator:()=>Gr,AMSynth:()=>ph,Abs:()=>Wp,Add:()=>$i,AmplitudeEnvelope:()=>GA,Analyser:()=>ao,AudioToGain:()=>Ua,AutoFilter:()=>Sh,AutoPanner:()=>Fh,AutoWah:()=>Th,BaseContext:()=>nh,BiquadFilter:()=>$r,BitCrusher:()=>Ih,Buffer:()=>xC,BufferSource:()=>SC,Buffers:()=>EC,Channel:()=>Ji,Chebyshev:()=>Mh,Chorus:()=>Ph,Clock:()=>DA,Compressor:()=>zn,Context:()=>IA,Convolver:()=>iu,CrossFade:()=>KA,DCMeter:()=>Xh,Delay:()=>Hs,Destination:()=>mC,Distortion:()=>kh,Draw:()=>yC,DuoSynth:()=>mh,EQ3:()=>nu,Emitter:()=>TA,Envelope:()=>ls,FFT:()=>$h,FMOscillator:()=>NA,FMSynth:()=>gh,FatOscillator:()=>Kr,FeedbackCombFilter:()=>jr,FeedbackDelay:()=>Dh,Filter:()=>Os,Follower:()=>Ao,Freeverb:()=>Hh,Frequency:()=>zy,FrequencyClass:()=>Bs,FrequencyEnvelope:()=>Xr,FrequencyShifter:()=>Lh,Gain:()=>xt,GainToAudio:()=>Gp,Gate:()=>Zh,GrainPlayer:()=>dh,GreaterThan:()=>Da,GreaterThanZero:()=>ka,IntervalTimeline:()=>Rp,JCReverb:()=>Rh,LFO:()=>Cs,Limiter:()=>tu,Listener:()=>vC,Loop:()=>eo,LowpassCombFilter:()=>Zr,Master:()=>gC,MembraneSynth:()=>Yr,Merge:()=>gi,MetalSynth:()=>wh,Meter:()=>zh,MidSideCompressor:()=>eu,MidSideMerge:()=>oo,MidSideSplit:()=>ro,Midi:()=>Jy,MidiClass:()=>HA,Mono:()=>jh,MonoSynth:()=>Yi,MultibandCompressor:()=>su,MultibandSplit:()=>lo,Multiply:()=>_e,Negate:()=>fh,Noise:()=>pi,NoiseSynth:()=>vh,Offline:()=>jy,OfflineContext:()=>QA,OmniOscillator:()=>Gn,OnePoleFilter:()=>Jr,Oscillator:()=>be,PWMOscillator:()=>qr,PanVol:()=>Na,Panner:()=>io,Panner3D:()=>Jh,Param:()=>kt,Part:()=>so,Pattern:()=>xh,Phaser:()=>Vh,PingPongDelay:()=>Oh,PitchShift:()=>Nh,Player:()=>WA,Players:()=>uh,PluckSynth:()=>bh,PolySynth:()=>_h,Pow:()=>RA,PulseOscillator:()=>VA,Recorder:()=>Va,Reverb:()=>Wh,Sampler:()=>to,Scale:()=>Kn,ScaleExp:()=>La,Sequence:()=>Eh,Signal:()=>Mt,Solo:()=>Le,Split:()=>ji,StateTimeline:()=>PA,StereoWidener:()=>Gh,Subtract:()=>Xi,SyncedSignal:()=>nC,Synth:()=>mi,Ticks:()=>Zy,TicksClass:()=>Ce,Time:()=>Gy,TimeClass:()=>Ds,Timeline:()=>ks,ToneAudioBuffer:()=>Jt,ToneAudioBuffers:()=>LA,ToneAudioNode:()=>at,ToneBufferSource:()=>fi,ToneEvent:()=>En,ToneOscillatorNode:()=>Wr,Transport:()=>fC,TransportTime:()=>$y,TransportTimeClass:()=>Ve,Tremolo:()=>Kh,Unit:()=>l,UserMedia:()=>Vr,Vibrato:()=>qh,Volume:()=>Vn,WaveShaper:()=>dn,Waveform:()=>Yh,Zero:()=>Pa,connect:()=>ys,connectSeries:()=>Ls,connectSignal:()=>Nr,context:()=>bC,dbToGain:()=>MA,debug:()=>a,defaultArg:()=>$s,disconnect:()=>rh,fanIn:()=>Xy,ftom:()=>ui,gainToDb:()=>Or,getContext:()=>we,getDestination:()=>wC,getDraw:()=>CC,getListener:()=>BC,getTransport:()=>pC,immediate:()=>dC,intervalToFrequencyRatio:()=>UA,isArray:()=>rs,isBoolean:()=>jc,isDefined:()=>Ot,isFunction:()=>Ip,isNote:()=>Lr,isNumber:()=>Us,isObject:()=>On,isString:()=>cn,isUndef:()=>Ss,loaded:()=>_C,mtof:()=>ih,now:()=>uC,optionsFromArguments:()=>et,setContext:()=>Ta,start:()=>Wy,supported:()=>Hy,version:()=>h});var a={};A.r(a),A.d(a,{assert:()=>Et,assertContextRunning:()=>Jc,assertRange:()=>os,assertUsedScheduleTime:()=>Up,enterScheduledCallback:()=>Zc,log:()=>Pp,setLogger:()=>Ry,warn:()=>EA});var l={};A.r(l);const h="15.0.4";var u=A(871);const m=new WeakSet,g=new WeakMap,v=new WeakMap,y=new WeakMap,C=new WeakMap,x=new WeakMap,F=new WeakMap,I=new WeakMap,T=new WeakMap,U=new WeakMap,D={construct:()=>D},O=/^import(?:(?:[\s]+[\w]+|(?:[\s]+[\w]+[\s]*,)?[\s]*\{[\s]*[\w]+(?:[\s]+as[\s]+[\w]+)?(?:[\s]*,[\s]*[\w]+(?:[\s]+as[\s]+[\w]+)?)*[\s]*}|(?:[\s]+[\w]+[\s]*,)?[\s]*\*[\s]+as[\s]+[\w]+)[\s]+from)?(?:[\s]*)("([^"\\]|\\.)+"|'([^'\\]|\\.)+')(?:[\s]*);?/,R=(p,n)=>{const o=[];let c=p.replace(/^[\s]+/,""),f=c.match(O);for(;f!==null;){const w=f[1].slice(1,-1),B=f[0].replace(/([\s]+)?;?$/,"").replace(w,new URL(w,n).toString());o.push(B),c=c.slice(f[0].length).replace(/^[\s]+/,""),f=c.match(O)}return[o.join(";"),c]},st=p=>{if(p!==void 0&&!Array.isArray(p))throw new TypeError("The parameterDescriptors property of given value for processorCtor is not an array.")},Y=p=>{if(!(n=>{try{new new Proxy(n,D)}catch{return!1}return!0})(p))throw new TypeError("The given value for processorCtor should be a constructor.");if(p.prototype===null||typeof p.prototype!="object")throw new TypeError("The given value for processorCtor should have a prototype.")},L=(p,n)=>{const o=p.get(n);if(o===void 0)throw new Error("A value with the given key could not be found.");return o},J=(p,n)=>{const o=Array.from(p).filter(n);if(o.length>1)throw Error("More than one element was found.");if(o.length===0)throw Error("No element was found.");const[c]=o;return p.delete(c),c},dt=(p,n,o,c)=>{const f=L(p,n),w=J(f,(B=>B[0]===o&&B[1]===c));return f.size===0&&p.delete(n),w},ht=p=>L(F,p),rt=p=>{if(m.has(p))throw new Error("The AudioNode is already stored.");m.add(p),ht(p).forEach((n=>n(!0)))},Tt=p=>"port"in p,It=p=>{if(!m.has(p))throw new Error("The AudioNode is not stored.");m.delete(p),ht(p).forEach((n=>n(!1)))},Ht=(p,n)=>{!Tt(p)&&n.every((o=>o.size===0))&&It(p)},tt={channelCount:2,channelCountMode:"max",channelInterpretation:"speakers",fftSize:2048,maxDecibels:-30,minDecibels:-100,smoothingTimeConstant:.8},ct=(p,n)=>p.context===n,lt=p=>{try{p.copyToChannel(new Float32Array(1),0,-1)}catch{return!1}return!0},mt=()=>new DOMException("","IndexSizeError"),At=p=>{var n;p.getChannelData=(n=p.getChannelData,o=>{try{return n.call(p,o)}catch(c){throw c.code===12?mt():c}})},St={numberOfChannels:1},Qt=-34028234663852886e22,Pt=-Qt,Vt=p=>m.has(p),he={buffer:null,channelCount:2,channelCountMode:"max",channelInterpretation:"speakers",loop:!1,loopEnd:0,loopStart:0,playbackRate:1},Lt=p=>L(g,p),Te=p=>L(y,p),ns=(p,n)=>{const{activeInputs:o}=Lt(p);o.forEach((f=>f.forEach((([w])=>{n.includes(p)||ns(w,[...n,p])}))));const c=(f=>"playbackRate"in f)(p)?[p.playbackRate]:Tt(p)?Array.from(p.parameters.values()):(f=>"frequency"in f&&"gain"in f)(p)?[p.Q,p.detune,p.frequency,p.gain]:(f=>"offset"in f)(p)?[p.offset]:(f=>!("frequency"in f)&&"gain"in f)(p)?[p.gain]:(f=>"detune"in f&&"frequency"in f)(p)?[p.detune,p.frequency]:(f=>"pan"in f)(p)?[p.pan]:[];for(const f of c){const w=Te(f);w!==void 0&&w.activeInputs.forEach((([B])=>ns(B,n)))}Vt(p)&&It(p)},qt=p=>{ns(p.destination,[])},se=p=>"context"in p,Ie=p=>se(p[0]),ie=(p,n,o,c)=>{for(const f of p)if(o(f)){if(c)return!1;throw Error("The set contains at least one similar element.")}return p.add(n),!0},Ks=(p,n,[o,c],f)=>{ie(p,[n,o,c],(w=>w[0]===n&&w[1]===o),f)},Hn=(p,[n,o,c],f)=>{const w=p.get(n);w===void 0?p.set(n,new Set([[o,c]])):ie(w,[o,c],(B=>B[0]===o),f)},is=p=>"inputs"in p,ri=(p,n,o,c)=>{if(is(n)){const f=n.inputs[c];return p.connect(f,o,0),[f,o,0]}return p.connect(n,o,c),[n,o,c]},pA=(p,n,o)=>{for(const c of p)if(c[0]===n&&c[1]===o)return p.delete(c),c;return null},mA=(p,n)=>{if(!ht(p).delete(n))throw new Error("Missing the expected event listener.")},gA=(p,n,o)=>{const c=L(p,n),f=J(c,(w=>w[0]===o));return c.size===0&&p.delete(n),f},oi=(p,n,o,c)=>{is(n)?p.disconnect(n.inputs[c],o,0):p.disconnect(n,o,c)},ue=p=>L(v,p),Vi=p=>L(C,p),Rn=p=>I.has(p),wA=p=>!m.has(p),pa=(p,n)=>new Promise((o=>{if(n!==null)o(!0);else{const c=p.createScriptProcessor(256,1,1),f=p.createGain(),w=p.createBuffer(1,2,44100),B=w.getChannelData(0);B[0]=1,B[1]=1;const b=p.createBufferSource();b.buffer=w,b.loop=!0,b.connect(c).connect(p.destination),b.connect(f),b.disconnect(f),c.onaudioprocess=E=>{const S=E.inputBuffer.getChannelData(0);Array.prototype.some.call(S,(Q=>Q===1))?o(!0):o(!1),b.stop(),c.onaudioprocess=null,b.disconnect(c),c.disconnect(p.destination)},b.start()}})),Tr=(p,n)=>{const o=new Map;for(const c of p)for(const f of c){const w=o.get(f);o.set(f,w===void 0?1:w+1)}o.forEach(((c,f)=>n(f,c)))},vA=p=>"context"in p,Lc=p=>{const n=new Map;p.connect=(o=>(c,f=0,w=0)=>{const B=vA(c)?o(c,f,w):o(c,f),b=n.get(c);return b===void 0?n.set(c,[{input:w,output:f}]):b.every((E=>E.input!==w||E.output!==f))&&b.push({input:w,output:f}),B})(p.connect.bind(p)),p.disconnect=(o=>(c,f,w)=>{if(o.apply(p),c===void 0)n.clear();else if(typeof c=="number")for(const[B,b]of n){const E=b.filter((S=>S.output!==c));E.length===0?n.delete(B):n.set(B,E)}else if(n.has(c))if(f===void 0)n.delete(c);else{const B=n.get(c);if(B!==void 0){const b=B.filter((E=>E.output!==f&&(E.input!==w||w===void 0)));b.length===0?n.delete(c):n.set(c,b)}}for(const[B,b]of n)b.forEach((E=>{vA(B)?p.connect(B,E.output,E.input):p.connect(B,E.output)}))})(p.disconnect)},Ir=(p,n,o,c,f)=>{const[w,B]=((b,E,S,Q)=>{const{activeInputs:M,passiveInputs:P}=Lt(E),k=pA(M[Q],b,S);return k===null?[dt(P,b,S,Q)[2],!1]:[k[2],!0]})(p,o,c,f);if(w!==null&&(mA(p,w),!B||n||Rn(p)||oi(ue(p),ue(o),c,f)),Vt(o)){const{activeInputs:b}=Lt(o);Ht(o,b)}},Qr=(p,n,o,c)=>{const[f,w]=((B,b,E)=>{const{activeInputs:S,passiveInputs:Q}=Te(b),M=pA(S,B,E);return M===null?[gA(Q,B,E)[1],!1]:[M[2],!0]})(p,o,c);f!==null&&(mA(p,f),!w||n||Rn(p)||ue(p).disconnect(Vi(o),c))};class ma{constructor(n){this._map=new Map(n)}get size(){return this._map.size}entries(){return this._map.entries()}forEach(n,o=null){return this._map.forEach(((c,f)=>n.call(o,c,f,this)))}get(n){return this._map.get(n)}has(n){return this._map.has(n)}keys(){return this._map.keys()}values(){return this._map.values()}}const ga={channelCount:2,channelCountMode:"explicit",channelInterpretation:"speakers",numberOfInputs:1,numberOfOutputs:1,parameterData:{},processorOptions:{}};function Wi(p,n,o,c,f){if(typeof p.copyFromChannel=="function")n[o].byteLength===0&&(n[o]=new Float32Array(128)),p.copyFromChannel(n[o],c,f);else{const w=p.getChannelData(c);if(n[o].byteLength===0)n[o]=w.slice(f,f+128);else{const B=new Float32Array(w.buffer,f*Float32Array.BYTES_PER_ELEMENT,128);n[o].set(B)}}}const BA=(p,n,o,c,f)=>{typeof p.copyToChannel=="function"?n[o].byteLength!==0&&p.copyToChannel(n[o],c,f):n[o].byteLength!==0&&p.getChannelData(c).set(n[o],f)},wa=(p,n)=>{const o=[];for(let c=0;c<p;c+=1){const f=[],w=typeof n=="number"?n:n[c];for(let B=0;B<w;B+=1)f.push(new Float32Array(128));o.push(f)}return o},tB=async(p,n,o,c,f,w,B)=>{const b=n===null?128*Math.ceil(p.context.length/128):n.length,E=c.channelCount*c.numberOfInputs,S=f.reduce(((H,K)=>H+K),0),Q=S===0?null:o.createBuffer(S,b,o.sampleRate);if(w===void 0)throw new Error("Missing the processor constructor.");const M=Lt(p),P=await((H,K)=>{const G=L(U,H),N=ue(K);return L(G,N)})(o,p),k=wa(c.numberOfInputs,c.channelCount),W=wa(c.numberOfOutputs,f),V=Array.from(p.parameters.keys()).reduce(((H,K)=>({...H,[K]:new Float32Array(128)})),{});for(let H=0;H<b;H+=128){if(c.numberOfInputs>0&&n!==null)for(let K=0;K<c.numberOfInputs;K+=1)for(let G=0;G<c.channelCount;G+=1)Wi(n,k[K],G,G,H);w.parameterDescriptors!==void 0&&n!==null&&w.parameterDescriptors.forEach((({name:K},G)=>{Wi(n,V,K,E+G,H)}));for(let K=0;K<c.numberOfInputs;K+=1)for(let G=0;G<f[K];G+=1)W[K][G].byteLength===0&&(W[K][G]=new Float32Array(128));try{const K=k.map(((N,Z)=>M.activeInputs[Z].size===0?[]:N)),G=B(H/o.sampleRate,o.sampleRate,(()=>P.process(K,W,V)));if(Q!==null)for(let N=0,Z=0;N<c.numberOfOutputs;N+=1){for(let it=0;it<f[N];it+=1)BA(Q,W[N],it,Z+it,H);Z+=f[N]}if(!G)break}catch(K){p.dispatchEvent(new ErrorEvent("processorerror",{colno:K.colno,filename:K.filename,lineno:K.lineno,message:K.message}));break}}return Q},eB={Q:1,channelCount:2,channelCountMode:"max",channelInterpretation:"speakers",detune:0,frequency:350,gain:0,type:"lowpass"},sB={channelCount:1,channelCountMode:"explicit",channelInterpretation:"speakers",numberOfInputs:6},nB={channelCount:6,channelCountMode:"explicit",channelInterpretation:"discrete",numberOfOutputs:6},iB={channelCount:2,channelCountMode:"max",channelInterpretation:"speakers",offset:1},AB={buffer:null,channelCount:2,channelCountMode:"clamped-max",channelInterpretation:"speakers",disableNormalization:!1},qf=p=>{const{port1:n,port2:o}=new MessageChannel;return new Promise((c=>{const f=()=>{o.onmessage=null,n.close(),o.close(),c()};o.onmessage=()=>f();try{n.postMessage(p,[p])}catch{}finally{f()}}))},rB={channelCount:2,channelCountMode:"max",channelInterpretation:"speakers",delayTime:0,maxDelayTime:1},va=(p,n,o)=>{const c=n[o];if(c===void 0)throw p();return c},oB={attack:.003,channelCount:2,channelCountMode:"clamped-max",channelInterpretation:"speakers",knee:30,ratio:12,release:.25,threshold:-24},aB={channelCount:2,channelCountMode:"max",channelInterpretation:"speakers",gain:1},Je=()=>new DOMException("","InvalidStateError"),Ba=()=>new DOMException("","InvalidAccessError"),lB={channelCount:2,channelCountMode:"max",channelInterpretation:"speakers"},zf=(p,n,o,c,f,w,B,b,E,S,Q)=>{const M=S.length;let P=b;for(let k=0;k<M;k+=1){let W=o[0]*S[k];for(let V=1;V<f;V+=1){const H=P-V&E-1;W+=o[V]*w[H],W-=p[V]*B[H]}for(let V=f;V<c;V+=1)W+=o[V]*w[P-V&E-1];for(let V=f;V<n;V+=1)W-=p[V]*B[P-V&E-1];w[P]=S[k],B[P]=W,P=P+1&E-1,Q[k]=W}return P},cB={channelCount:2,channelCountMode:"explicit",channelInterpretation:"speakers"},Mr=p=>{const n=new Uint32Array([1179011410,40,1163280727,544501094,16,131073,44100,176400,1048580,1635017060,4,0]);try{const o=p.decodeAudioData(n.buffer,(()=>{}));return o!==void 0&&(o.catch((()=>{})),!0)}catch{}return!1},ye=(p,n,o)=>{const c=n[o];c!==void 0&&c!==p[o]&&(p[o]=c)},Ke=(p,n)=>{ye(p,n,"channelCount"),ye(p,n,"channelCountMode"),ye(p,n,"channelInterpretation")},$f=p=>typeof p.getFloatTimeDomainData=="function",Qe=(p,n,o)=>{const c=n[o];c!==void 0&&c!==p[o].value&&(p[o].value=c)},Hc=p=>{p.start=(n=>(o=0,c=0,f)=>{if(typeof f=="number"&&f<0||c<0||o<0)throw new RangeError("The parameters can't be negative.");n.call(p,o,c,f)})(p.start)},Rc=p=>{var n;p.stop=(n=p.stop,(o=0)=>{if(o<0)throw new RangeError("The parameter can't be negative.");n.call(p,o)})},Xf=(p,n)=>p===null?512:Math.max(512,Math.min(16384,Math.pow(2,Math.round(Math.log2(p*n))))),Yf=(p,n)=>{const o=p.createBiquadFilter();return Ke(o,n),Qe(o,n,"Q"),Qe(o,n,"detune"),Qe(o,n,"frequency"),Qe(o,n,"gain"),ye(o,n,"type"),o},Ur=(p,n)=>{const o=p.createChannelSplitter(n.numberOfOutputs);return Ke(o,n),(c=>{const f=c.numberOfOutputs;Object.defineProperty(c,"channelCount",{get:()=>f,set:w=>{if(w!==f)throw Je()}}),Object.defineProperty(c,"channelCountMode",{get:()=>"explicit",set:w=>{if(w!=="explicit")throw Je()}}),Object.defineProperty(c,"channelInterpretation",{get:()=>"discrete",set:w=>{if(w!=="discrete")throw Je()}})})(o),o},yA=(p,n)=>(p.connect=n.connect.bind(n),p.disconnect=n.disconnect.bind(n),p),jf=(p,n)=>{const o=p.createDelay(n.maxDelayTime);return Ke(o,n),Qe(o,n,"delayTime"),o},Es=(p,n)=>{const o=p.createGain();return Ke(o,n),Qe(o,n,"gain"),o};function hB(p,n){const o=n[0]*n[0]+n[1]*n[1];return[(p[0]*n[0]+p[1]*n[1])/o,(p[1]*n[0]-p[0]*n[1])/o]}function Jf(p,n){let o=[0,0];for(let w=p.length-1;w>=0;w-=1)f=n,o=[(c=o)[0]*f[0]-c[1]*f[1],c[0]*f[1]+c[1]*f[0]],o[0]+=p[w];var c,f;return o}const Pr=(p,n,o,c)=>p.createScriptProcessor(n,o,c),vs=()=>new DOMException("","NotSupportedError"),uB={numberOfChannels:1},dB={channelCount:2,channelCountMode:"max",channelInterpretation:"speakers",detune:0,frequency:440,periodicWave:void 0,type:"sine"},fB={channelCount:2,channelCountMode:"clamped-max",channelInterpretation:"speakers",coneInnerAngle:360,coneOuterAngle:360,coneOuterGain:0,distanceModel:"inverse",maxDistance:1e4,orientationX:1,orientationY:0,orientationZ:0,panningModel:"equalpower",positionX:0,positionY:0,positionZ:0,refDistance:1,rolloffFactor:1},pB={disableNormalization:!1},mB={channelCount:2,channelCountMode:"explicit",channelInterpretation:"speakers",pan:0},gB=()=>new DOMException("","UnknownError"),wB={channelCount:2,channelCountMode:"max",channelInterpretation:"speakers",curve:null,oversample:"none"},Zf=(p,n,o)=>p.copyFromChannel===void 0?p.getChannelData(o)[0]:(p.copyFromChannel(n,o),n[0]),tp=p=>{if(p===null)return!1;const n=p.length;return n%2!=0?p[Math.floor(n/2)]!==0:p[n/2-1]+p[n/2]!==0},kr=(p,n,o,c)=>{let f=p;for(;!f.hasOwnProperty(n);)f=Object.getPrototypeOf(f);const{get:w,set:B}=Object.getOwnPropertyDescriptor(f,n);Object.defineProperty(p,n,{get:o(w),set:c(B)})},ep=(p,n,o)=>{try{p.setValueAtTime(n,o)}catch(c){if(c.code!==9)throw c;ep(p,n,o+1e-7)}},Oc=p=>{const n=p.createOscillator();try{n.start(-1)}catch(o){return o instanceof RangeError}return!1},sp=p=>{const n=p.createBuffer(1,1,44100),o=p.createBufferSource();o.buffer=n,o.start(),o.stop();try{return o.stop(),!0}catch{return!1}},Nc=p=>{const n=p.createOscillator();try{n.stop(-1)}catch(o){return o instanceof RangeError}return!1},vB=()=>{try{new DOMException}catch{return!1}return!0},BB=()=>new Promise((p=>{const n=new ArrayBuffer(0),{port1:o,port2:c}=new MessageChannel;o.onmessage=({data:f})=>p(f!==null),c.postMessage(n,[n])})),np=(p,n)=>{const o=n.createGain();p.connect(o);const c=(f=>()=>{f.call(p,o),p.removeEventListener("ended",c)})(p.disconnect);p.addEventListener("ended",c),yA(p,o),p.stop=(f=>{let w=!1;return(B=0)=>{if(w)try{f.call(p,B)}catch{o.gain.setValueAtTime(0,B)}else f.call(p,B),w=!0}})(p.stop)},CA=(p,n)=>o=>{const c={value:p};return Object.defineProperties(o,{currentTarget:c,target:c}),typeof n=="function"?n.call(p,o):n.handleEvent.call(p,o)},yB=(p=>(n,o,[c,f,w],B)=>{p(n[f],[o,c,w],(b=>b[0]===o&&b[1]===c),B)})(ie),CB=(p=>(n,o,[c,f,w],B)=>{const b=n.get(c);b===void 0?n.set(c,new Set([[f,o,w]])):p(b,[f,o,w],(E=>E[0]===f&&E[1]===o),B)})(ie),bB=(p=>(n,o,c,f)=>p(n[f],(w=>w[0]===o&&w[1]===c)))(J),ip=new WeakMap,_B=(p=>n=>{var o;return(o=p.get(n))!==null&&o!==void 0?o:0})(ip),qs=(ya=new Map,Dr=new WeakMap,(p,n)=>{const o=Dr.get(p);if(o!==void 0)return o;const c=ya.get(p);if(c!==void 0)return c;try{const f=n();return f instanceof Promise?(ya.set(p,f),f.catch((()=>!1)).then((w=>(ya.delete(p),Dr.set(p,w),w)))):(Dr.set(p,f),f)}catch{return Dr.set(p,!1),!1}});var ya,Dr;const an=typeof window>"u"?null:window,Ap=((p,n)=>(o,c)=>{const f=o.createAnalyser();if(Ke(f,c),!(c.maxDecibels>c.minDecibels))throw n();return ye(f,c,"fftSize"),ye(f,c,"maxDecibels"),ye(f,c,"minDecibels"),ye(f,c,"smoothingTimeConstant"),p($f,(()=>$f(f)))||(w=>{w.getFloatTimeDomainData=B=>{const b=new Uint8Array(B.length);w.getByteTimeDomainData(b);const E=Math.max(b.length,w.fftSize);for(let S=0;S<E;S+=1)B[S]=.0078125*(b[S]-128);return B}})(f),f})(qs,mt),Vc=(p=>n=>{const o=p(n);if(o.renderer===null)throw new Error("Missing the renderer of the given AudioNode in the audio graph.");return o.renderer})(Lt),As=((p,n,o)=>async(c,f,w)=>{const B=p(c);await Promise.all(B.activeInputs.map(((b,E)=>Array.from(b).map((async([S,Q])=>{const M=n(S),P=await M.render(S,f),k=c.context.destination;o(S)||c===k&&o(c)||P.connect(w,Q,E)})))).reduce(((b,E)=>[...b,...E]),[]))})(Lt,Vc,Rn),xB=((p,n,o)=>()=>{const c=new WeakMap;return{render(f,w){const B=c.get(w);return B!==void 0?Promise.resolve(B):(async(b,E)=>{let S=n(b);if(!ct(S,E)){const Q={channelCount:S.channelCount,channelCountMode:S.channelCountMode,channelInterpretation:S.channelInterpretation,fftSize:S.fftSize,maxDecibels:S.maxDecibels,minDecibels:S.minDecibels,smoothingTimeConstant:S.smoothingTimeConstant};S=p(E,Q)}return c.set(E,S),await o(b,E,S),S})(f,w)}}})(Ap,ue,As),me=(rp=x,p=>{const n=rp.get(p);if(n===void 0)throw Je();return n});var rp;const Ze=(p=>p===null?null:p.hasOwnProperty("OfflineAudioContext")?p.OfflineAudioContext:p.hasOwnProperty("webkitOfflineAudioContext")?p.webkitOfflineAudioContext:null)(an),ae=(p=>n=>p!==null&&n instanceof p)(Ze),op=new WeakMap,ap=(p=>class{constructor(n){this._nativeEventTarget=n,this._listeners=new WeakMap}addEventListener(n,o,c){if(o!==null){let f=this._listeners.get(o);f===void 0&&(f=p(this,o),typeof o=="function"&&this._listeners.set(o,f)),this._nativeEventTarget.addEventListener(n,f,c)}}dispatchEvent(n){return this._nativeEventTarget.dispatchEvent(n)}removeEventListener(n,o,c){const f=o===null?void 0:this._listeners.get(o);this._nativeEventTarget.removeEventListener(n,f===void 0?null:f,c)}})(CA),ai=(p=>p===null?null:p.hasOwnProperty("AudioContext")?p.AudioContext:p.hasOwnProperty("webkitAudioContext")?p.webkitAudioContext:null)(an),Wc=(p=>n=>p!==null&&n instanceof p)(ai),Gc=(p=>n=>p!==null&&typeof p.AudioNode=="function"&&n instanceof p.AudioNode)(an),lp=(p=>n=>p!==null&&typeof p.AudioParam=="function"&&n instanceof p.AudioParam)(an),bA=(p=>p===null?null:p.hasOwnProperty("AudioWorkletNode")?p.AudioWorkletNode:null)(an),De=((p,n,o,c,f,w,B,b,E,S,Q,M,P,k,W,V)=>class extends S{constructor(H,K,G,N){super(G),this._context=H,this._nativeAudioNode=G;const Z=Q(H);M(Z)&&o(pa,(()=>pa(Z,V)))!==!0&&Lc(G),v.set(this,G),F.set(this,new Set),H.state!=="closed"&&K&&rt(this),p(this,N,G)}get channelCount(){return this._nativeAudioNode.channelCount}set channelCount(H){this._nativeAudioNode.channelCount=H}get channelCountMode(){return this._nativeAudioNode.channelCountMode}set channelCountMode(H){this._nativeAudioNode.channelCountMode=H}get channelInterpretation(){return this._nativeAudioNode.channelInterpretation}set channelInterpretation(H){this._nativeAudioNode.channelInterpretation=H}get context(){return this._context}get numberOfInputs(){return this._nativeAudioNode.numberOfInputs}get numberOfOutputs(){return this._nativeAudioNode.numberOfOutputs}connect(H,K=0,G=0){if(K<0||K>=this._nativeAudioNode.numberOfOutputs)throw f();const N=Q(this._context),Z=W(N);if(P(H)||k(H))throw w();if(se(H)){const z=ue(H);try{const j=ri(this._nativeAudioNode,z,K,G),q=wA(this);(Z||q)&&this._nativeAudioNode.disconnect(...j),this.context.state!=="closed"&&!q&&wA(H)&&rt(H)}catch(j){throw j.code===12?w():j}if(n(this,H,K,G,Z)){const j=E([this],H);Tr(j,c(Z))}return H}const it=Vi(H);if(it.name==="playbackRate"&&it.maxValue===1024)throw B();try{this._nativeAudioNode.connect(it,K),(Z||wA(this))&&this._nativeAudioNode.disconnect(it,K)}catch(z){throw z.code===12?w():z}if(((z,j,q,ot)=>{const{activeInputs:X,passiveInputs:nt}=Te(j),{outputs:ft}=Lt(z),pt=ht(z),Ut=_t=>{const bt=ue(z),Dt=Vi(j);if(_t){const vt=gA(nt,z,q);Ks(X,z,vt,!1),ot||Rn(z)||bt.connect(Dt,q)}else{const vt=((Rt,$t,te)=>J(Rt,(ve=>ve[0]===$t&&ve[1]===te)))(X,z,q);Hn(nt,vt,!1),ot||Rn(z)||bt.disconnect(Dt,q)}};return!!ie(ft,[j,q],(_t=>_t[0]===j&&_t[1]===q),!0)&&(pt.add(Ut),Vt(z)?Ks(X,z,[q,Ut],!0):Hn(nt,[z,q,Ut],!0),!0)})(this,H,K,Z)){const z=E([this],H);Tr(z,c(Z))}}disconnect(H,K,G){let N;const Z=Q(this._context),it=W(Z);if(H===void 0)N=((z,j)=>{const q=Lt(z),ot=[];for(const X of q.outputs)Ie(X)?Ir(z,j,...X):Qr(z,j,...X),ot.push(X[0]);return q.outputs.clear(),ot})(this,it);else if(typeof H=="number"){if(H<0||H>=this.numberOfOutputs)throw f();N=((z,j,q)=>{const ot=Lt(z),X=[];for(const nt of ot.outputs)nt[1]===q&&(Ie(nt)?Ir(z,j,...nt):Qr(z,j,...nt),X.push(nt[0]),ot.outputs.delete(nt));return X})(this,it,H)}else{if(K!==void 0&&(K<0||K>=this.numberOfOutputs)||se(H)&&G!==void 0&&(G<0||G>=H.numberOfInputs))throw f();if(N=((z,j,q,ot,X)=>{const nt=Lt(z);return Array.from(nt.outputs).filter((ft=>!(ft[0]!==q||ot!==void 0&&ft[1]!==ot||X!==void 0&&ft[2]!==X))).map((ft=>(Ie(ft)?Ir(z,j,...ft):Qr(z,j,...ft),nt.outputs.delete(ft),ft[0])))})(this,it,H,K,G),N.length===0)throw w()}for(const z of N){const j=E([this],z);Tr(j,b)}}})((cp=g,(p,n,o)=>{const c=[];for(let f=0;f<o.numberOfInputs;f+=1)c.push(new Set);cp.set(p,{activeInputs:c,outputs:new Set,passiveInputs:new WeakMap,renderer:n})}),((p,n,o,c,f,w,B,b,E,S,Q,M,P)=>{const k=new WeakMap;return(W,V,H,K,G)=>{const{activeInputs:N,passiveInputs:Z}=w(V),{outputs:it}=w(W),z=b(W),j=q=>{const ot=E(V),X=E(W);if(q){const nt=dt(Z,W,H,K);p(N,W,nt,!1),G||M(W)||o(X,ot,H,K),P(V)&&rt(V)}else{const nt=c(N,W,H,K);n(Z,K,nt,!1),G||M(W)||f(X,ot,H,K);const ft=B(V);if(ft===0)Q(V)&&Ht(V,N);else{const pt=k.get(V);pt!==void 0&&clearTimeout(pt),k.set(V,setTimeout((()=>{Q(V)&&Ht(V,N)}),1e3*ft))}}};return!!S(it,[V,H,K],(q=>q[0]===V&&q[1]===H&&q[2]===K),!0)&&(z.add(j),Q(W)?p(N,W,[H,K,j],!0):n(Z,K,[W,H,j],!0),!0)}})(yB,CB,ri,bB,oi,Lt,_B,ht,ue,ie,Vt,Rn,wA),qs,((p,n,o,c,f,w)=>B=>(b,E)=>{const S=p.get(b);if(S===void 0){if(!B&&w(b)){const Q=c(b),{outputs:M}=o(b);for(const P of M)if(Ie(P)){const k=c(P[0]);n(Q,k,P[1],P[2])}else{const k=f(P[0]);Q.disconnect(k,P[1])}}p.set(b,E)}else p.set(b,S+E)})(I,oi,Lt,ue,Vi,Vt),mt,Ba,vs,((p,n,o,c,f,w,B,b)=>(E,S)=>{const Q=n.get(E);if(Q===void 0)throw new Error("Missing the expected cycle count.");const M=w(E.context),P=b(M);if(Q===S){if(n.delete(E),!P&&B(E)){const k=c(E),{outputs:W}=o(E);for(const V of W)if(Ie(V)){const H=c(V[0]);p(k,H,V[1],V[2])}else{const H=f(V[0]);k.connect(H,V[1])}}}else n.set(E,Q-S)})(ri,I,Lt,ue,Vi,me,Vt,ae),((p,n,o)=>function c(f,w){const B=se(w)?w:o(p,w);if((E=>"delayTime"in E)(B))return[];if(f[0]===B)return[f];if(f.includes(B))return[];const{outputs:b}=n(B);return Array.from(b).map((E=>c([...f,B],E[0]))).reduce(((E,S)=>E.concat(S)),[])})(op,Lt,L),ap,me,Wc,Gc,lp,ae,bA);var cp;const EB=((p,n,o,c,f,w)=>class extends p{constructor(B,b){const E=f(B),S={...tt,...b},Q=c(E,S);super(B,!1,Q,w(E)?n():null),this._nativeAnalyserNode=Q}get fftSize(){return this._nativeAnalyserNode.fftSize}set fftSize(B){this._nativeAnalyserNode.fftSize=B}get frequencyBinCount(){return this._nativeAnalyserNode.frequencyBinCount}get maxDecibels(){return this._nativeAnalyserNode.maxDecibels}set maxDecibels(B){const b=this._nativeAnalyserNode.maxDecibels;if(this._nativeAnalyserNode.maxDecibels=B,!(B>this._nativeAnalyserNode.minDecibels))throw this._nativeAnalyserNode.maxDecibels=b,o()}get minDecibels(){return this._nativeAnalyserNode.minDecibels}set minDecibels(B){const b=this._nativeAnalyserNode.minDecibels;if(this._nativeAnalyserNode.minDecibels=B,!(this._nativeAnalyserNode.maxDecibels>B))throw this._nativeAnalyserNode.minDecibels=b,o()}get smoothingTimeConstant(){return this._nativeAnalyserNode.smoothingTimeConstant}set smoothingTimeConstant(B){this._nativeAnalyserNode.smoothingTimeConstant=B}getByteFrequencyData(B){this._nativeAnalyserNode.getByteFrequencyData(B)}getByteTimeDomainData(B){this._nativeAnalyserNode.getByteTimeDomainData(B)}getFloatFrequencyData(B){this._nativeAnalyserNode.getFloatFrequencyData(B)}getFloatTimeDomainData(B){this._nativeAnalyserNode.getFloatTimeDomainData(B)}})(De,xB,mt,Ap,me,ae),Kc=new WeakSet,hp=(p=>p===null?null:p.hasOwnProperty("AudioBuffer")?p.AudioBuffer:null)(an),up=(qc=new Uint32Array(1),p=>(qc[0]=p,qc[0]));var qc;const zc=((p,n)=>o=>{o.copyFromChannel=(c,f,w=0)=>{const B=p(w),b=p(f);if(b>=o.numberOfChannels)throw n();const E=o.length,S=o.getChannelData(b),Q=c.length;for(let M=B<0?-B:0;M+B<E&&M<Q;M+=1)c[M]=S[M+B]},o.copyToChannel=(c,f,w=0)=>{const B=p(w),b=p(f);if(b>=o.numberOfChannels)throw n();const E=o.length,S=o.getChannelData(b),Q=c.length;for(let M=B<0?-B:0;M+B<E&&M<Q;M+=1)S[M+B]=c[M]}})(up,mt),$c=(p=>n=>{n.copyFromChannel=(o=>(c,f,w=0)=>{const B=p(w),b=p(f);if(B<n.length)return o.call(n,c,b,B)})(n.copyFromChannel),n.copyToChannel=(o=>(c,f,w=0)=>{const B=p(w),b=p(f);if(B<n.length)return o.call(n,c,b,B)})(n.copyToChannel)})(up),dp=((p,n,o,c,f,w,B,b)=>{let E=null;return class dw{constructor(Q){if(f===null)throw new Error("Missing the native OfflineAudioContext constructor.");const{length:M,numberOfChannels:P,sampleRate:k}={...St,...Q};E===null&&(E=new f(1,1,44100));const W=c!==null&&n(w,w)?new c({length:M,numberOfChannels:P,sampleRate:k}):E.createBuffer(P,M,k);if(W.numberOfChannels===0)throw o();return typeof W.copyFromChannel!="function"?(B(W),At(W)):n(lt,(()=>lt(W)))||b(W),p.add(W),W}static[Symbol.hasInstance](Q){return Q!==null&&typeof Q=="object"&&Object.getPrototypeOf(Q)===dw.prototype||p.has(Q)}}})(Kc,qs,vs,hp,Ze,(p=>()=>{if(p===null)return!1;try{new p({length:1,sampleRate:44100})}catch{return!1}return!0})(hp),zc,$c),Ca=(p=>(n,o)=>{const c=p(n,{channelCount:1,channelCountMode:"explicit",channelInterpretation:"discrete",gain:0});o.connect(c).connect(n.destination);const f=()=>{o.removeEventListener("ended",f),o.disconnect(c),c.disconnect()};o.addEventListener("ended",f)})(Es),fp=((p,n,o)=>async(c,f,w)=>{const B=n(c);await Promise.all(Array.from(B.activeInputs).map((async([b,E])=>{const S=p(b),Q=await S.render(b,f);o(b)||Q.connect(w,E)})))})(Vc,Te,Rn),_n=(p=>(n,o,c)=>p(o,n,c))(fp),_A=((p,n,o,c,f,w,B,b,E,S,Q)=>(M,P)=>{const k=M.createBufferSource();return Ke(k,P),Qe(k,P,"playbackRate"),ye(k,P,"buffer"),ye(k,P,"loop"),ye(k,P,"loopEnd"),ye(k,P,"loopStart"),n(o,(()=>o(M)))||(W=>{W.start=(V=>{let H=!1;return(K=0,G=0,N)=>{if(H)throw Je();V.call(W,K,G,N),H=!0}})(W.start)})(k),n(c,(()=>c(M)))||(W=>{W.start=(V=>(H=0,K=0,G)=>{const N=W.buffer,Z=N===null?K:Math.min(N.duration,K);N!==null&&Z>N.duration-.5/W.context.sampleRate?V.call(W,H,0,0):V.call(W,H,Z,G)})(W.start)})(k),n(f,(()=>f(M)))||S(k,M),n(w,(()=>w(M)))||Hc(k),n(B,(()=>B(M)))||Q(k,M),n(b,(()=>b(M)))||Rc(k),p(M,k),k})(Ca,qs,(p=>{const n=p.createBufferSource();n.start();try{n.start()}catch{return!0}return!1}),(p=>{const n=p.createBufferSource(),o=p.createBuffer(1,1,44100);n.buffer=o;try{n.start(0,1)}catch{return!1}return!0}),(p=>{const n=p.createBufferSource();n.start();try{n.stop()}catch{return!1}return!0}),Oc,sp,Nc,0,(p=>(n,o)=>{const c=o.createBuffer(1,1,44100);n.buffer===null&&(n.buffer=c),p(n,"buffer",(f=>()=>{const w=f.call(n);return w===c?null:w}),(f=>w=>f.call(n,w===null?c:w)))})(kr),np),xn=((p,n)=>(o,c,f)=>(p(c).replay(f),n(c,o,f)))((p=>n=>{const o=p(n);if(o.renderer===null)throw new Error("Missing the renderer of the given AudioParam in the audio graph.");return o.renderer})(Te),fp),SB=((p,n,o,c,f)=>()=>{const w=new WeakMap;let B=null,b=null;return{set start(E){B=E},set stop(E){b=E},render(E,S){const Q=w.get(S);return Q!==void 0?Promise.resolve(Q):(async(M,P)=>{let k=o(M);const W=ct(k,P);if(!W){const V={buffer:k.buffer,channelCount:k.channelCount,channelCountMode:k.channelCountMode,channelInterpretation:k.channelInterpretation,loop:k.loop,loopEnd:k.loopEnd,loopStart:k.loopStart,playbackRate:k.playbackRate.value};k=n(P,V),B!==null&&k.start(...B),b!==null&&k.stop(b)}return w.set(P,k),W?await p(P,M.playbackRate,k.playbackRate):await c(P,M.playbackRate,k.playbackRate),await f(M,P,k),k})(E,S)}}})(_n,_A,ue,xn,As),ln=((p,n,o,c,f,w,B,b,E,S,Q,M,P)=>(k,W,V,H=null,K=null)=>{const G=V.value,N=new u.AutomationEventList(G),Z=W?(z=>({replay(j){for(const q of z)if(q.type==="exponentialRampToValue"){const{endTime:ot,value:X}=q;j.exponentialRampToValueAtTime(X,ot)}else if(q.type==="linearRampToValue"){const{endTime:ot,value:X}=q;j.linearRampToValueAtTime(X,ot)}else if(q.type==="setTarget"){const{startTime:ot,target:X,timeConstant:nt}=q;j.setTargetAtTime(X,ot,nt)}else if(q.type==="setValue"){const{startTime:ot,value:X}=q;j.setValueAtTime(X,ot)}else{if(q.type!=="setValueCurve")throw new Error("Can't apply an unknown automation.");{const{duration:ot,startTime:X,values:nt}=q;j.setValueCurveAtTime(nt,X,ot)}}}}))(N):null,it={get defaultValue(){return G},get maxValue(){return H===null?V.maxValue:H},get minValue(){return K===null?V.minValue:K},get value(){return V.value},set value(z){V.value=z,it.setValueAtTime(z,k.context.currentTime)},cancelAndHoldAtTime(z){if(typeof V.cancelAndHoldAtTime=="function")Z===null&&N.flush(k.context.currentTime),N.add(f(z)),V.cancelAndHoldAtTime(z);else{const j=Array.from(N).pop();Z===null&&N.flush(k.context.currentTime),N.add(f(z));const q=Array.from(N).pop();V.cancelScheduledValues(z),j!==q&&q!==void 0&&(q.type==="exponentialRampToValue"?V.exponentialRampToValueAtTime(q.value,q.endTime):q.type==="linearRampToValue"?V.linearRampToValueAtTime(q.value,q.endTime):q.type==="setValue"?V.setValueAtTime(q.value,q.startTime):q.type==="setValueCurve"&&V.setValueCurveAtTime(q.values,q.startTime,q.duration))}return it},cancelScheduledValues:z=>(Z===null&&N.flush(k.context.currentTime),N.add(w(z)),V.cancelScheduledValues(z),it),exponentialRampToValueAtTime(z,j){if(z===0)throw new RangeError;if(!Number.isFinite(j)||j<0)throw new RangeError;const q=k.context.currentTime;return Z===null&&N.flush(q),Array.from(N).length===0&&(N.add(S(G,q)),V.setValueAtTime(G,q)),N.add(B(z,j)),V.exponentialRampToValueAtTime(z,j),it},linearRampToValueAtTime(z,j){const q=k.context.currentTime;return Z===null&&N.flush(q),Array.from(N).length===0&&(N.add(S(G,q)),V.setValueAtTime(G,q)),N.add(b(z,j)),V.linearRampToValueAtTime(z,j),it},setTargetAtTime:(z,j,q)=>(Z===null&&N.flush(k.context.currentTime),N.add(E(z,j,q)),V.setTargetAtTime(z,j,q),it),setValueAtTime:(z,j)=>(Z===null&&N.flush(k.context.currentTime),N.add(S(z,j)),V.setValueAtTime(z,j),it),setValueCurveAtTime(z,j,q){const ot=z instanceof Float32Array?z:new Float32Array(z);if(M!==null&&M.name==="webkitAudioContext"){const X=j+q,nt=k.context.sampleRate,ft=Math.ceil(j*nt),pt=Math.floor(X*nt),Ut=pt-ft,_t=new Float32Array(Ut);for(let Dt=0;Dt<Ut;Dt+=1){const vt=(ot.length-1)/q*((ft+Dt)/nt-j),Rt=Math.floor(vt),$t=Math.ceil(vt);_t[Dt]=Rt===$t?ot[Rt]:(1-(vt-Rt))*ot[Rt]+(1-($t-vt))*ot[$t]}Z===null&&N.flush(k.context.currentTime),N.add(Q(_t,j,q)),V.setValueCurveAtTime(_t,j,q);const bt=pt/nt;bt<X&&P(it,_t[_t.length-1],bt),P(it,ot[ot.length-1],X)}else Z===null&&N.flush(k.context.currentTime),N.add(Q(ot,j,q)),V.setValueCurveAtTime(ot,j,q);return it}};return o.set(it,V),n.set(it,k),p(it,Z),it})((pp=y,(p,n)=>{pp.set(p,{activeInputs:new Set,passiveInputs:new WeakMap,renderer:n})}),op,C,0,u.createCancelAndHoldAutomationEvent,u.createCancelScheduledValuesAutomationEvent,u.createExponentialRampToValueAutomationEvent,u.createLinearRampToValueAutomationEvent,u.createSetTargetAutomationEvent,u.createSetValueAutomationEvent,u.createSetValueCurveAutomationEvent,ai,ep);var pp;const FB=((p,n,o,c,f,w,B,b)=>class extends p{constructor(E,S){const Q=w(E),M={...he,...S},P=f(Q,M),k=B(Q),W=k?n():null;super(E,!1,P,W),this._audioBufferSourceNodeRenderer=W,this._isBufferNullified=!1,this._isBufferSet=M.buffer!==null,this._nativeAudioBufferSourceNode=P,this._onended=null,this._playbackRate=o(this,k,P.playbackRate,Pt,Qt)}get buffer(){return this._isBufferNullified?null:this._nativeAudioBufferSourceNode.buffer}set buffer(E){if(this._nativeAudioBufferSourceNode.buffer=E,E!==null){if(this._isBufferSet)throw c();this._isBufferSet=!0}}get loop(){return this._nativeAudioBufferSourceNode.loop}set loop(E){this._nativeAudioBufferSourceNode.loop=E}get loopEnd(){return this._nativeAudioBufferSourceNode.loopEnd}set loopEnd(E){this._nativeAudioBufferSourceNode.loopEnd=E}get loopStart(){return this._nativeAudioBufferSourceNode.loopStart}set loopStart(E){this._nativeAudioBufferSourceNode.loopStart=E}get onended(){return this._onended}set onended(E){const S=typeof E=="function"?b(this,E):null;this._nativeAudioBufferSourceNode.onended=S;const Q=this._nativeAudioBufferSourceNode.onended;this._onended=Q!==null&&Q===S?E:Q}get playbackRate(){return this._playbackRate}start(E=0,S=0,Q){if(this._nativeAudioBufferSourceNode.start(E,S,Q),this._audioBufferSourceNodeRenderer!==null&&(this._audioBufferSourceNodeRenderer.start=Q===void 0?[E,S]:[E,S,Q]),this.context.state!=="closed"){rt(this);const M=()=>{this._nativeAudioBufferSourceNode.removeEventListener("ended",M),Vt(this)&&It(this)};this._nativeAudioBufferSourceNode.addEventListener("ended",M)}}stop(E=0){this._nativeAudioBufferSourceNode.stop(E),this._audioBufferSourceNodeRenderer!==null&&(this._audioBufferSourceNodeRenderer.stop=E)}})(De,SB,ln,Je,_A,me,ae,CA),TB=((p,n,o,c,f,w,B,b)=>class extends p{constructor(E,S){const Q=w(E),M=B(Q),P=f(Q,S,M);super(E,!1,P,M?(k=>{const W=new WeakMap;return{render(V,H){const K=W.get(H);return K!==void 0?Promise.resolve(K):(async(G,N)=>{const Z=N.destination;return W.set(N,Z),await k(G,N,Z),Z})(V,H)}}})(b):null),this._isNodeOfNativeOfflineAudioContext=M,this._nativeAudioDestinationNode=P}get channelCount(){return this._nativeAudioDestinationNode.channelCount}set channelCount(E){if(this._isNodeOfNativeOfflineAudioContext)throw c();if(E>this._nativeAudioDestinationNode.maxChannelCount)throw o();this._nativeAudioDestinationNode.channelCount=E}get channelCountMode(){return this._nativeAudioDestinationNode.channelCountMode}set channelCountMode(E){if(this._isNodeOfNativeOfflineAudioContext)throw c();this._nativeAudioDestinationNode.channelCountMode=E}get maxChannelCount(){return this._nativeAudioDestinationNode.maxChannelCount}})(De,0,mt,Je,((p,n)=>(o,c,f)=>{const w=o.destination;if(w.channelCount!==c)try{w.channelCount=c}catch{}f&&w.channelCountMode!=="explicit"&&(w.channelCountMode="explicit"),w.maxChannelCount===0&&Object.defineProperty(w,"maxChannelCount",{value:c});const B=p(o,{channelCount:c,channelCountMode:w.channelCountMode,channelInterpretation:w.channelInterpretation,gain:1});return n(B,"channelCount",(b=>()=>b.call(B)),(b=>E=>{b.call(B,E);try{w.channelCount=E}catch(S){if(E>w.maxChannelCount)throw S}})),n(B,"channelCountMode",(b=>()=>b.call(B)),(b=>E=>{b.call(B,E),w.channelCountMode=E})),n(B,"channelInterpretation",(b=>()=>b.call(B)),(b=>E=>{b.call(B,E),w.channelInterpretation=E})),Object.defineProperty(B,"maxChannelCount",{get:()=>w.maxChannelCount}),B.connect(w),B})(Es,kr),me,ae,As),IB=((p,n,o,c,f)=>()=>{const w=new WeakMap;return{render(B,b){const E=w.get(b);return E!==void 0?Promise.resolve(E):(async(S,Q)=>{let M=o(S);const P=ct(M,Q);if(!P){const k={Q:M.Q.value,channelCount:M.channelCount,channelCountMode:M.channelCountMode,channelInterpretation:M.channelInterpretation,detune:M.detune.value,frequency:M.frequency.value,gain:M.gain.value,type:M.type};M=n(Q,k)}return w.set(Q,M),P?(await p(Q,S.Q,M.Q),await p(Q,S.detune,M.detune),await p(Q,S.frequency,M.frequency),await p(Q,S.gain,M.gain)):(await c(Q,S.Q,M.Q),await c(Q,S.detune,M.detune),await c(Q,S.frequency,M.frequency),await c(Q,S.gain,M.gain)),await f(S,Q,M),M})(B,b)}}})(_n,Yf,ue,xn,As),Gi=(p=>(n,o)=>p.set(n,o))(ip),QB=((p,n,o,c,f,w,B,b)=>class extends p{constructor(E,S){const Q=w(E),M={...eB,...S},P=f(Q,M),k=B(Q);super(E,!1,P,k?o():null),this._Q=n(this,k,P.Q,Pt,Qt),this._detune=n(this,k,P.detune,1200*Math.log2(Pt),-1200*Math.log2(Pt)),this._frequency=n(this,k,P.frequency,E.sampleRate/2,0),this._gain=n(this,k,P.gain,40*Math.log10(Pt),Qt),this._nativeBiquadFilterNode=P,b(this,1)}get detune(){return this._detune}get frequency(){return this._frequency}get gain(){return this._gain}get Q(){return this._Q}get type(){return this._nativeBiquadFilterNode.type}set type(E){this._nativeBiquadFilterNode.type=E}getFrequencyResponse(E,S,Q){try{this._nativeBiquadFilterNode.getFrequencyResponse(E,S,Q)}catch(M){throw M.code===11?c():M}if(E.length!==S.length||S.length!==Q.length)throw c()}})(De,ln,IB,Ba,Yf,me,ae,Gi),li=((p,n)=>(o,c,f)=>{const w=new Set;return o.connect=(B=>(b,E=0,S=0)=>{const Q=w.size===0;if(n(b))return B.call(o,b,E,S),p(w,[b,E,S],(M=>M[0]===b&&M[1]===E&&M[2]===S),!0),Q&&c(),b;B.call(o,b,E),p(w,[b,E],(M=>M[0]===b&&M[1]===E),!0),Q&&c()})(o.connect),o.disconnect=(B=>(b,E,S)=>{const Q=w.size>0;if(b===void 0)B.apply(o),w.clear();else if(typeof b=="number"){B.call(o,b);for(const P of w)P[1]===b&&w.delete(P)}else{n(b)?B.call(o,b,E,S):B.call(o,b,E);for(const P of w)P[0]!==b||E!==void 0&&P[1]!==E||S!==void 0&&P[2]!==S||w.delete(P)}const M=w.size===0;Q&&M&&f()})(o.disconnect),o})(ie,Gc),MB=((p,n)=>(o,c)=>{c.channelCount=1,c.channelCountMode="explicit",Object.defineProperty(c,"channelCount",{get:()=>1,set:()=>{throw p()}}),Object.defineProperty(c,"channelCountMode",{get:()=>"explicit",set:()=>{throw p()}});const f=o.createBufferSource();n(c,(()=>{const w=c.numberOfInputs;for(let B=0;B<w;B+=1)f.connect(c,0,B)}),(()=>f.disconnect(c)))})(Je,li),ci=((p,n)=>(o,c)=>{const f=o.createChannelMerger(c.numberOfInputs);return p!==null&&p.name==="webkitAudioContext"&&n(o,f),Ke(f,c),f})(ai,MB),UB=((p,n,o)=>()=>{const c=new WeakMap;return{render(f,w){const B=c.get(w);return B!==void 0?Promise.resolve(B):(async(b,E)=>{let S=n(b);if(!ct(S,E)){const Q={channelCount:S.channelCount,channelCountMode:S.channelCountMode,channelInterpretation:S.channelInterpretation,numberOfInputs:S.numberOfInputs};S=p(E,Q)}return c.set(E,S),await o(b,E,S),S})(f,w)}}})(ci,ue,As),PB=((p,n,o,c,f)=>class extends p{constructor(w,B){const b=c(w),E={...sB,...B};super(w,!1,o(b,E),f(b)?n():null)}})(De,UB,ci,me,ae),kB=((p,n,o)=>()=>{const c=new WeakMap;return{render(f,w){const B=c.get(w);return B!==void 0?Promise.resolve(B):(async(b,E)=>{let S=n(b);if(!ct(S,E)){const Q={channelCount:S.channelCount,channelCountMode:S.channelCountMode,channelInterpretation:S.channelInterpretation,numberOfOutputs:S.numberOfOutputs};S=p(E,Q)}return c.set(E,S),await o(b,E,S),S})(f,w)}}})(Ur,ue,As),DB=((p,n,o,c,f,w)=>class extends p{constructor(B,b){const E=c(B),S=(Q=>({...Q,channelCount:Q.numberOfOutputs}))({...nB,...b});super(B,!1,o(E,S),f(E)?n():null)}})(De,kB,Ur,me,ae),LB=((p,n,o,c)=>(f,{offset:w,...B})=>{const b=f.createBuffer(1,2,44100),E=n(f,{buffer:null,channelCount:2,channelCountMode:"max",channelInterpretation:"speakers",loop:!1,loopEnd:0,loopStart:0,playbackRate:1}),S=o(f,{...B,gain:w}),Q=b.getChannelData(0);Q[0]=1,Q[1]=1,E.buffer=b,E.loop=!0;const M={get bufferSize(){},get channelCount(){return S.channelCount},set channelCount(P){S.channelCount=P},get channelCountMode(){return S.channelCountMode},set channelCountMode(P){S.channelCountMode=P},get channelInterpretation(){return S.channelInterpretation},set channelInterpretation(P){S.channelInterpretation=P},get context(){return S.context},get inputs(){return[]},get numberOfInputs(){return E.numberOfInputs},get numberOfOutputs(){return S.numberOfOutputs},get offset(){return S.gain},get onended(){return E.onended},set onended(P){E.onended=P},addEventListener:(...P)=>E.addEventListener(P[0],P[1],P[2]),dispatchEvent:(...P)=>E.dispatchEvent(P[0]),removeEventListener:(...P)=>E.removeEventListener(P[0],P[1],P[2]),start(P=0){E.start.call(E,P)},stop(P=0){E.stop.call(E,P)}};return p(f,E),c(yA(M,S),(()=>E.connect(S)),(()=>E.disconnect(S)))})(Ca,_A,Es,li),xA=((p,n,o,c,f)=>(w,B)=>{if(w.createConstantSource===void 0)return o(w,B);const b=w.createConstantSource();return Ke(b,B),Qe(b,B,"offset"),n(c,(()=>c(w)))||Hc(b),n(f,(()=>f(w)))||Rc(b),p(w,b),b})(Ca,qs,LB,Oc,Nc),HB=((p,n,o,c,f)=>()=>{const w=new WeakMap;let B=null,b=null;return{set start(E){B=E},set stop(E){b=E},render(E,S){const Q=w.get(S);return Q!==void 0?Promise.resolve(Q):(async(M,P)=>{let k=o(M);const W=ct(k,P);if(!W){const V={channelCount:k.channelCount,channelCountMode:k.channelCountMode,channelInterpretation:k.channelInterpretation,offset:k.offset.value};k=n(P,V),B!==null&&k.start(B),b!==null&&k.stop(b)}return w.set(P,k),W?await p(P,M.offset,k.offset):await c(P,M.offset,k.offset),await f(M,P,k),k})(E,S)}}})(_n,xA,ue,xn,As),RB=((p,n,o,c,f,w,B)=>class extends p{constructor(b,E){const S=f(b),Q={...iB,...E},M=c(S,Q),P=w(S),k=P?o():null;super(b,!1,M,k),this._constantSourceNodeRenderer=k,this._nativeConstantSourceNode=M,this._offset=n(this,P,M.offset,Pt,Qt),this._onended=null}get offset(){return this._offset}get onended(){return this._onended}set onended(b){const E=typeof b=="function"?B(this,b):null;this._nativeConstantSourceNode.onended=E;const S=this._nativeConstantSourceNode.onended;this._onended=S!==null&&S===E?b:S}start(b=0){if(this._nativeConstantSourceNode.start(b),this._constantSourceNodeRenderer!==null&&(this._constantSourceNodeRenderer.start=b),this.context.state!=="closed"){rt(this);const E=()=>{this._nativeConstantSourceNode.removeEventListener("ended",E),Vt(this)&&It(this)};this._nativeConstantSourceNode.addEventListener("ended",E)}}stop(b=0){this._nativeConstantSourceNode.stop(b),this._constantSourceNodeRenderer!==null&&(this._constantSourceNodeRenderer.stop=b)}})(De,ln,HB,xA,me,ae,CA),mp=((p,n)=>(o,c)=>{const f=o.createConvolver();if(Ke(f,c),c.disableNormalization===f.normalize&&(f.normalize=!c.disableNormalization),ye(f,c,"buffer"),c.channelCount>2||(n(f,"channelCount",(w=>()=>w.call(f)),(w=>B=>{if(B>2)throw p();return w.call(f,B)})),c.channelCountMode==="max"))throw p();return n(f,"channelCountMode",(w=>()=>w.call(f)),(w=>B=>{if(B==="max")throw p();return w.call(f,B)})),f})(vs,kr),OB=((p,n,o)=>()=>{const c=new WeakMap;return{render(f,w){const B=c.get(w);return B!==void 0?Promise.resolve(B):(async(b,E)=>{let S=n(b);if(!ct(S,E)){const Q={buffer:S.buffer,channelCount:S.channelCount,channelCountMode:S.channelCountMode,channelInterpretation:S.channelInterpretation,disableNormalization:!S.normalize};S=p(E,Q)}return c.set(E,S),is(S)?await o(b,E,S.inputs[0]):await o(b,E,S),S})(f,w)}}})(mp,ue,As),NB=((p,n,o,c,f,w)=>class extends p{constructor(B,b){const E=c(B),S={...AB,...b},Q=o(E,S);super(B,!1,Q,f(E)?n():null),this._isBufferNullified=!1,this._nativeConvolverNode=Q,S.buffer!==null&&w(this,S.buffer.duration)}get buffer(){return this._isBufferNullified?null:this._nativeConvolverNode.buffer}set buffer(B){if(this._nativeConvolverNode.buffer=B,B===null&&this._nativeConvolverNode.buffer!==null){const b=this._nativeConvolverNode.context;this._nativeConvolverNode.buffer=b.createBuffer(1,1,b.sampleRate),this._isBufferNullified=!0,w(this,0)}else this._isBufferNullified=!1,w(this,this._nativeConvolverNode.buffer===null?0:this._nativeConvolverNode.buffer.duration)}get normalize(){return this._nativeConvolverNode.normalize}set normalize(B){this._nativeConvolverNode.normalize=B}})(De,OB,mp,me,ae,Gi),VB=((p,n,o,c,f)=>w=>{const B=new WeakMap;return{render(b,E){const S=B.get(E);return S!==void 0?Promise.resolve(S):(async(Q,M)=>{let P=o(Q);const k=ct(P,M);if(!k){const W={channelCount:P.channelCount,channelCountMode:P.channelCountMode,channelInterpretation:P.channelInterpretation,delayTime:P.delayTime.value,maxDelayTime:w};P=n(M,W)}return B.set(M,P),k?await p(M,Q.delayTime,P.delayTime):await c(M,Q.delayTime,P.delayTime),await f(Q,M,P),P})(b,E)}}})(_n,jf,ue,xn,As),WB=((p,n,o,c,f,w,B)=>class extends p{constructor(b,E){const S=f(b),Q={...rB,...E},M=c(S,Q),P=w(S);super(b,!1,M,P?o(Q.maxDelayTime):null),this._delayTime=n(this,P,M.delayTime),B(this,Q.maxDelayTime)}get delayTime(){return this._delayTime}})(De,ln,VB,jf,me,ae,Gi),gp=(p=>(n,o)=>{const c=n.createDynamicsCompressor();if(Ke(c,o),o.channelCount>2||o.channelCountMode==="max")throw p();return Qe(c,o,"attack"),Qe(c,o,"knee"),Qe(c,o,"ratio"),Qe(c,o,"release"),Qe(c,o,"threshold"),c})(vs),GB=((p,n,o,c,f)=>()=>{const w=new WeakMap;return{render(B,b){const E=w.get(b);return E!==void 0?Promise.resolve(E):(async(S,Q)=>{let M=o(S);const P=ct(M,Q);if(!P){const k={attack:M.attack.value,channelCount:M.channelCount,channelCountMode:M.channelCountMode,channelInterpretation:M.channelInterpretation,knee:M.knee.value,ratio:M.ratio.value,release:M.release.value,threshold:M.threshold.value};M=n(Q,k)}return w.set(Q,M),P?(await p(Q,S.attack,M.attack),await p(Q,S.knee,M.knee),await p(Q,S.ratio,M.ratio),await p(Q,S.release,M.release),await p(Q,S.threshold,M.threshold)):(await c(Q,S.attack,M.attack),await c(Q,S.knee,M.knee),await c(Q,S.ratio,M.ratio),await c(Q,S.release,M.release),await c(Q,S.threshold,M.threshold)),await f(S,Q,M),M})(B,b)}}})(_n,gp,ue,xn,As),KB=((p,n,o,c,f,w,B,b)=>class extends p{constructor(E,S){const Q=w(E),M={...oB,...S},P=c(Q,M),k=B(Q);super(E,!1,P,k?o():null),this._attack=n(this,k,P.attack),this._knee=n(this,k,P.knee),this._nativeDynamicsCompressorNode=P,this._ratio=n(this,k,P.ratio),this._release=n(this,k,P.release),this._threshold=n(this,k,P.threshold),b(this,.006)}get attack(){return this._attack}get channelCount(){return this._nativeDynamicsCompressorNode.channelCount}set channelCount(E){const S=this._nativeDynamicsCompressorNode.channelCount;if(this._nativeDynamicsCompressorNode.channelCount=E,E>2)throw this._nativeDynamicsCompressorNode.channelCount=S,f()}get channelCountMode(){return this._nativeDynamicsCompressorNode.channelCountMode}set channelCountMode(E){const S=this._nativeDynamicsCompressorNode.channelCountMode;if(this._nativeDynamicsCompressorNode.channelCountMode=E,E==="max")throw this._nativeDynamicsCompressorNode.channelCountMode=S,f()}get knee(){return this._knee}get ratio(){return this._ratio}get reduction(){return typeof this._nativeDynamicsCompressorNode.reduction.value=="number"?this._nativeDynamicsCompressorNode.reduction.value:this._nativeDynamicsCompressorNode.reduction}get release(){return this._release}get threshold(){return this._threshold}})(De,ln,GB,gp,vs,me,ae,Gi),qB=((p,n,o,c,f)=>()=>{const w=new WeakMap;return{render(B,b){const E=w.get(b);return E!==void 0?Promise.resolve(E):(async(S,Q)=>{let M=o(S);const P=ct(M,Q);if(!P){const k={channelCount:M.channelCount,channelCountMode:M.channelCountMode,channelInterpretation:M.channelInterpretation,gain:M.gain.value};M=n(Q,k)}return w.set(Q,M),P?await p(Q,S.gain,M.gain):await c(Q,S.gain,M.gain),await f(S,Q,M),M})(B,b)}}})(_n,Es,ue,xn,As),zB=((p,n,o,c,f,w)=>class extends p{constructor(B,b){const E=f(B),S={...aB,...b},Q=c(E,S),M=w(E);super(B,!1,Q,M?o():null),this._gain=n(this,M,Q.gain,Pt,Qt)}get gain(){return this._gain}})(De,ln,qB,Es,me,ae),$B=((p,n,o,c)=>(f,w,{channelCount:B,channelCountMode:b,channelInterpretation:E,feedback:S,feedforward:Q})=>{const M=Xf(w,f.sampleRate),P=S instanceof Float64Array?S:new Float64Array(S),k=Q instanceof Float64Array?Q:new Float64Array(Q),W=P.length,V=k.length,H=Math.min(W,V);if(W===0||W>20)throw c();if(P[0]===0)throw n();if(V===0||V>20)throw c();if(k[0]===0)throw n();if(P[0]!==1){for(let z=0;z<V;z+=1)k[z]/=P[0];for(let z=1;z<W;z+=1)P[z]/=P[0]}const K=o(f,M,B,B);K.channelCount=B,K.channelCountMode=b,K.channelInterpretation=E;const G=[],N=[],Z=[];for(let z=0;z<B;z+=1){G.push(0);const j=new Float32Array(32),q=new Float32Array(32);j.fill(0),q.fill(0),N.push(j),Z.push(q)}K.onaudioprocess=z=>{const j=z.inputBuffer,q=z.outputBuffer,ot=j.numberOfChannels;for(let X=0;X<ot;X+=1){const nt=j.getChannelData(X),ft=q.getChannelData(X);G[X]=zf(P,W,k,V,H,N[X],Z[X],G[X],32,nt,ft)}};const it=f.sampleRate/2;return yA({get bufferSize(){return M},get channelCount(){return K.channelCount},set channelCount(z){K.channelCount=z},get channelCountMode(){return K.channelCountMode},set channelCountMode(z){K.channelCountMode=z},get channelInterpretation(){return K.channelInterpretation},set channelInterpretation(z){K.channelInterpretation=z},get context(){return K.context},get inputs(){return[K]},get numberOfInputs(){return K.numberOfInputs},get numberOfOutputs(){return K.numberOfOutputs},addEventListener:(...z)=>K.addEventListener(z[0],z[1],z[2]),dispatchEvent:(...z)=>K.dispatchEvent(z[0]),getFrequencyResponse(z,j,q){if(z.length!==j.length||j.length!==q.length)throw p();const ot=z.length;for(let X=0;X<ot;X+=1){const nt=-Math.PI*(z[X]/it),ft=[Math.cos(nt),Math.sin(nt)],pt=hB(Jf(k,ft),Jf(P,ft));j[X]=Math.sqrt(pt[0]*pt[0]+pt[1]*pt[1]),q[X]=Math.atan2(pt[1],pt[0])}},removeEventListener:(...z)=>K.removeEventListener(z[0],z[1],z[2])},K)})(Ba,Je,Pr,vs),ba=((p,n,o,c)=>f=>p(Mr,(()=>Mr(f)))?Promise.resolve(p(c,c)).then((w=>{if(!w){const B=o(f,512,0,1);f.oncomplete=()=>{B.onaudioprocess=null,B.disconnect()},B.onaudioprocess=()=>f.currentTime,B.connect(f.destination)}return f.startRendering()})):new Promise((w=>{const B=n(f,{channelCount:1,channelCountMode:"explicit",channelInterpretation:"discrete",gain:0});f.oncomplete=b=>{B.disconnect(),w(b.renderedBuffer)},B.connect(f.destination),f.startRendering()})))(qs,Es,Pr,((p,n)=>()=>{if(n===null)return Promise.resolve(!1);const o=new n(1,1,44100),c=p(o,{channelCount:1,channelCountMode:"explicit",channelInterpretation:"discrete",gain:0});return new Promise((f=>{o.oncomplete=()=>{c.disconnect(),f(o.currentTime!==0)},o.startRendering()}))})(Es,Ze)),XB=((p,n,o,c,f)=>(w,B)=>{const b=new WeakMap;let E=null;return{render(S,Q){const M=b.get(Q);return M!==void 0?Promise.resolve(M):(async(P,k)=>{let W=null,V=n(P);const H=ct(V,k);if(k.createIIRFilter===void 0?W=p(k,{buffer:null,channelCount:2,channelCountMode:"max",channelInterpretation:"speakers",loop:!1,loopEnd:0,loopStart:0,playbackRate:1}):H||(V=k.createIIRFilter(B,w)),b.set(k,W===null?V:W),W!==null){if(E===null){if(o===null)throw new Error("Missing the native OfflineAudioContext constructor.");const G=new o(P.context.destination.channelCount,P.context.length,k.sampleRate);E=(async()=>(await c(P,G,G.destination),((N,Z,it,z)=>{const j=it instanceof Float64Array?it:new Float64Array(it),q=z instanceof Float64Array?z:new Float64Array(z),ot=j.length,X=q.length,nt=Math.min(ot,X);if(j[0]!==1){for(let bt=0;bt<ot;bt+=1)q[bt]/=j[0];for(let bt=1;bt<X;bt+=1)j[bt]/=j[0]}const ft=new Float32Array(32),pt=new Float32Array(32),Ut=Z.createBuffer(N.numberOfChannels,N.length,N.sampleRate),_t=N.numberOfChannels;for(let bt=0;bt<_t;bt+=1){const Dt=N.getChannelData(bt),vt=Ut.getChannelData(bt);ft.fill(0),pt.fill(0),zf(j,ot,q,X,nt,ft,pt,0,32,Dt,vt)}return Ut})(await f(G),k,w,B)))()}const K=await E;return W.buffer=K,W.start(0),W}return await c(P,k,V),V})(S,Q)}}})(_A,ue,Ze,As,ba),YB=(p=>(n,o,c)=>{if(n.createIIRFilter===void 0)return p(n,o,c);const f=n.createIIRFilter(c.feedforward,c.feedback);return Ke(f,c),f})($B),jB=((p,n,o,c,f,w)=>class extends p{constructor(B,b){const E=c(B),S=f(E),Q={...lB,...b},M=n(E,S?null:B.baseLatency,Q);super(B,!1,M,S?o(Q.feedback,Q.feedforward):null),(P=>{var k;P.getFrequencyResponse=(k=P.getFrequencyResponse,(W,V,H)=>{if(W.length!==V.length||V.length!==H.length)throw Ba();return k.call(P,W,V,H)})})(M),this._nativeIIRFilterNode=M,w(this,1)}getFrequencyResponse(B,b,E){return this._nativeIIRFilterNode.getFrequencyResponse(B,b,E)}})(De,YB,XB,me,ae,Gi),JB=((p,n,o,c,f,w,B,b)=>(E,S)=>{const Q=S.listener,{forwardX:M,forwardY:P,forwardZ:k,positionX:W,positionY:V,positionZ:H,upX:K,upY:G,upZ:N}=Q.forwardX===void 0?(()=>{const Z=new Float32Array(1),it=n(S,{channelCount:1,channelCountMode:"explicit",channelInterpretation:"speakers",numberOfInputs:9}),z=B(S);let j=!1,q=[0,0,-1,0,1,0],ot=[0,0,0];const X=()=>{if(j)return;j=!0;const Ut=c(S,256,9,0);Ut.onaudioprocess=({inputBuffer:_t})=>{const bt=[w(_t,Z,0),w(_t,Z,1),w(_t,Z,2),w(_t,Z,3),w(_t,Z,4),w(_t,Z,5)];bt.some(((vt,Rt)=>vt!==q[Rt]))&&(Q.setOrientation(...bt),q=bt);const Dt=[w(_t,Z,6),w(_t,Z,7),w(_t,Z,8)];Dt.some(((vt,Rt)=>vt!==ot[Rt]))&&(Q.setPosition(...Dt),ot=Dt)},it.connect(Ut)},nt=Ut=>_t=>{_t!==q[Ut]&&(q[Ut]=_t,Q.setOrientation(...q))},ft=Ut=>_t=>{_t!==ot[Ut]&&(ot[Ut]=_t,Q.setPosition(...ot))},pt=(Ut,_t,bt)=>{const Dt=o(S,{channelCount:1,channelCountMode:"explicit",channelInterpretation:"discrete",offset:_t});Dt.connect(it,0,Ut),Dt.start(),Object.defineProperty(Dt.offset,"defaultValue",{get:()=>_t});const vt=p({context:E},z,Dt.offset,Pt,Qt);var Rt,$t,te,ve,Ue,Fs,Gt;return b(vt,"value",(gt=>()=>gt.call(vt)),(gt=>fe=>{try{gt.call(vt,fe)}catch(oe){if(oe.code!==9)throw oe}X(),z&&bt(fe)})),vt.cancelAndHoldAtTime=(Rt=vt.cancelAndHoldAtTime,z?()=>{throw f()}:(...gt)=>{const fe=Rt.apply(vt,gt);return X(),fe}),vt.cancelScheduledValues=($t=vt.cancelScheduledValues,z?()=>{throw f()}:(...gt)=>{const fe=$t.apply(vt,gt);return X(),fe}),vt.exponentialRampToValueAtTime=(te=vt.exponentialRampToValueAtTime,z?()=>{throw f()}:(...gt)=>{const fe=te.apply(vt,gt);return X(),fe}),vt.linearRampToValueAtTime=(ve=vt.linearRampToValueAtTime,z?()=>{throw f()}:(...gt)=>{const fe=ve.apply(vt,gt);return X(),fe}),vt.setTargetAtTime=(Ue=vt.setTargetAtTime,z?()=>{throw f()}:(...gt)=>{const fe=Ue.apply(vt,gt);return X(),fe}),vt.setValueAtTime=(Fs=vt.setValueAtTime,z?()=>{throw f()}:(...gt)=>{const fe=Fs.apply(vt,gt);return X(),fe}),vt.setValueCurveAtTime=(Gt=vt.setValueCurveAtTime,z?()=>{throw f()}:(...gt)=>{const fe=Gt.apply(vt,gt);return X(),fe}),vt};return{forwardX:pt(0,0,nt(0)),forwardY:pt(1,0,nt(1)),forwardZ:pt(2,-1,nt(2)),positionX:pt(6,0,ft(0)),positionY:pt(7,0,ft(1)),positionZ:pt(8,0,ft(2)),upX:pt(3,0,nt(3)),upY:pt(4,1,nt(4)),upZ:pt(5,0,nt(5))}})():Q;return{get forwardX(){return M},get forwardY(){return P},get forwardZ(){return k},get positionX(){return W},get positionY(){return V},get positionZ(){return H},get upX(){return K},get upY(){return G},get upZ(){return N}}})(ln,ci,xA,Pr,vs,Zf,ae,kr),wp=new WeakMap,ZB=((p,n,o,c,f,w)=>class extends o{constructor(B,b){super(B),this._nativeContext=B,x.set(this,B),c(B)&&f.set(B,new Set),this._destination=new p(this,b),this._listener=n(this,B),this._onstatechange=null}get currentTime(){return this._nativeContext.currentTime}get destination(){return this._destination}get listener(){return this._listener}get onstatechange(){return this._onstatechange}set onstatechange(B){const b=typeof B=="function"?w(this,B):null;this._nativeContext.onstatechange=b;const E=this._nativeContext.onstatechange;this._onstatechange=E!==null&&E===b?B:E}get sampleRate(){return this._nativeContext.sampleRate}get state(){return this._nativeContext.state}})(TB,JB,ap,ae,wp,CA),vp=((p,n,o,c,f,w)=>(B,b)=>{const E=B.createOscillator();return Ke(E,b),Qe(E,b,"detune"),Qe(E,b,"frequency"),b.periodicWave!==void 0?E.setPeriodicWave(b.periodicWave):ye(E,b,"type"),n(o,(()=>o(B)))||Hc(E),n(c,(()=>c(B)))||w(E,B),n(f,(()=>f(B)))||Rc(E),p(B,E),E})(Ca,qs,Oc,sp,Nc,np),ty=((p,n,o,c,f)=>()=>{const w=new WeakMap;let B=null,b=null,E=null;return{set periodicWave(S){B=S},set start(S){b=S},set stop(S){E=S},render(S,Q){const M=w.get(Q);return M!==void 0?Promise.resolve(M):(async(P,k)=>{let W=o(P);const V=ct(W,k);if(!V){const H={channelCount:W.channelCount,channelCountMode:W.channelCountMode,channelInterpretation:W.channelInterpretation,detune:W.detune.value,frequency:W.frequency.value,periodicWave:B===null?void 0:B,type:W.type};W=n(k,H),b!==null&&W.start(b),E!==null&&W.stop(E)}return w.set(k,W),V?(await p(k,P.detune,W.detune),await p(k,P.frequency,W.frequency)):(await c(k,P.detune,W.detune),await c(k,P.frequency,W.frequency)),await f(P,k,W),W})(S,Q)}}})(_n,vp,ue,xn,As),ey=((p,n,o,c,f,w,B)=>class extends p{constructor(b,E){const S=f(b),Q={...dB,...E},M=o(S,Q),P=w(S),k=P?c():null,W=b.sampleRate/2;super(b,!1,M,k),this._detune=n(this,P,M.detune,153600,-153600),this._frequency=n(this,P,M.frequency,W,-W),this._nativeOscillatorNode=M,this._onended=null,this._oscillatorNodeRenderer=k,this._oscillatorNodeRenderer!==null&&Q.periodicWave!==void 0&&(this._oscillatorNodeRenderer.periodicWave=Q.periodicWave)}get detune(){return this._detune}get frequency(){return this._frequency}get onended(){return this._onended}set onended(b){const E=typeof b=="function"?B(this,b):null;this._nativeOscillatorNode.onended=E;const S=this._nativeOscillatorNode.onended;this._onended=S!==null&&S===E?b:S}get type(){return this._nativeOscillatorNode.type}set type(b){this._nativeOscillatorNode.type=b,this._oscillatorNodeRenderer!==null&&(this._oscillatorNodeRenderer.periodicWave=null)}setPeriodicWave(b){this._nativeOscillatorNode.setPeriodicWave(b),this._oscillatorNodeRenderer!==null&&(this._oscillatorNodeRenderer.periodicWave=b)}start(b=0){if(this._nativeOscillatorNode.start(b),this._oscillatorNodeRenderer!==null&&(this._oscillatorNodeRenderer.start=b),this.context.state!=="closed"){rt(this);const E=()=>{this._nativeOscillatorNode.removeEventListener("ended",E),Vt(this)&&It(this)};this._nativeOscillatorNode.addEventListener("ended",E)}}stop(b=0){this._nativeOscillatorNode.stop(b),this._oscillatorNodeRenderer!==null&&(this._oscillatorNodeRenderer.stop=b)}})(De,ln,vp,ty,me,ae,CA),Bp=(p=>(n,o)=>{const c=p(n,{buffer:null,channelCount:2,channelCountMode:"max",channelInterpretation:"speakers",loop:!1,loopEnd:0,loopStart:0,playbackRate:1}),f=n.createBuffer(1,2,44100);return c.buffer=f,c.loop=!0,c.connect(o),c.start(),()=>{c.stop(),c.disconnect(o)}})(_A),sy=((p,n,o,c,f)=>(w,{curve:B,oversample:b,...E})=>{const S=w.createWaveShaper(),Q=w.createWaveShaper();Ke(S,E),Ke(Q,E);const M=o(w,{...E,gain:1}),P=o(w,{...E,gain:-1}),k=o(w,{...E,gain:1}),W=o(w,{...E,gain:-1});let V=null,H=!1,K=null;const G={get bufferSize(){},get channelCount(){return S.channelCount},set channelCount(N){M.channelCount=N,P.channelCount=N,S.channelCount=N,k.channelCount=N,Q.channelCount=N,W.channelCount=N},get channelCountMode(){return S.channelCountMode},set channelCountMode(N){M.channelCountMode=N,P.channelCountMode=N,S.channelCountMode=N,k.channelCountMode=N,Q.channelCountMode=N,W.channelCountMode=N},get channelInterpretation(){return S.channelInterpretation},set channelInterpretation(N){M.channelInterpretation=N,P.channelInterpretation=N,S.channelInterpretation=N,k.channelInterpretation=N,Q.channelInterpretation=N,W.channelInterpretation=N},get context(){return S.context},get curve(){return K},set curve(N){if(N!==null&&N.length<2)throw n();if(N===null)S.curve=N,Q.curve=N;else{const Z=N.length,it=new Float32Array(Z+2-Z%2),z=new Float32Array(Z+2-Z%2);it[0]=N[0],z[0]=-N[Z-1];const j=Math.ceil((Z+1)/2),q=(Z+1)/2-1;for(let ot=1;ot<j;ot+=1){const X=ot/j*q,nt=Math.floor(X),ft=Math.ceil(X);it[ot]=nt===ft?N[nt]:(1-(X-nt))*N[nt]+(1-(ft-X))*N[ft],z[ot]=nt===ft?-N[Z-1-nt]:-(1-(X-nt))*N[Z-1-nt]-(1-(ft-X))*N[Z-1-ft]}it[j]=Z%2==1?N[j-1]:(N[j-2]+N[j-1])/2,S.curve=it,Q.curve=z}K=N,H&&(c(K)&&V===null?V=p(w,M):V!==null&&(V(),V=null))},get inputs(){return[M]},get numberOfInputs(){return S.numberOfInputs},get numberOfOutputs(){return S.numberOfOutputs},get oversample(){return S.oversample},set oversample(N){S.oversample=N,Q.oversample=N},addEventListener:(...N)=>M.addEventListener(N[0],N[1],N[2]),dispatchEvent:(...N)=>M.dispatchEvent(N[0]),removeEventListener:(...N)=>M.removeEventListener(N[0],N[1],N[2])};return B!==null&&(G.curve=B instanceof Float32Array?B:new Float32Array(B)),b!==G.oversample&&(G.oversample=b),f(yA(G,k),(()=>{M.connect(S).connect(k),M.connect(P).connect(Q).connect(W).connect(k),H=!0,c(K)&&(V=p(w,M))}),(()=>{M.disconnect(S),S.disconnect(k),M.disconnect(P),P.disconnect(Q),Q.disconnect(W),W.disconnect(k),H=!1,V!==null&&(V(),V=null)}))})(Bp,Je,Es,tp,li),_a=((p,n,o,c,f,w,B)=>(b,E)=>{const S=b.createWaveShaper();if(w!==null&&w.name==="webkitAudioContext"&&b.createGain().gain.automationRate===void 0)return o(b,E);Ke(S,E);const Q=E.curve===null||E.curve instanceof Float32Array?E.curve:new Float32Array(E.curve);if(Q!==null&&Q.length<2)throw n();ye(S,{curve:Q},"curve"),ye(S,E,"oversample");let M=null,P=!1;return B(S,"curve",(k=>()=>k.call(S)),(k=>W=>(k.call(S,W),P&&(c(W)&&M===null?M=p(b,S):c(W)||M===null||(M(),M=null)),W))),f(S,(()=>{P=!0,c(S.curve)&&(M=p(b,S))}),(()=>{P=!1,M!==null&&(M(),M=null)}))})(Bp,Je,sy,tp,li,ai,kr),ny=((p,n,o,c,f,w,B,b,E,S)=>(Q,{coneInnerAngle:M,coneOuterAngle:P,coneOuterGain:k,distanceModel:W,maxDistance:V,orientationX:H,orientationY:K,orientationZ:G,panningModel:N,positionX:Z,positionY:it,positionZ:z,refDistance:j,rolloffFactor:q,...ot})=>{const X=Q.createPanner();if(ot.channelCount>2||ot.channelCountMode==="max")throw B();Ke(X,ot);const nt={channelCount:1,channelCountMode:"explicit",channelInterpretation:"discrete"},ft=o(Q,{...nt,channelInterpretation:"speakers",numberOfInputs:6}),pt=c(Q,{...ot,gain:1}),Ut=c(Q,{...nt,gain:1}),_t=c(Q,{...nt,gain:0}),bt=c(Q,{...nt,gain:0}),Dt=c(Q,{...nt,gain:0}),vt=c(Q,{...nt,gain:0}),Rt=c(Q,{...nt,gain:0}),$t=f(Q,256,6,1),te=w(Q,{...nt,curve:new Float32Array([1,1]),oversample:"none"});let ve=[H,K,G],Ue=[Z,it,z];const Fs=new Float32Array(1);$t.onaudioprocess=({inputBuffer:gt})=>{const fe=[E(gt,Fs,0),E(gt,Fs,1),E(gt,Fs,2)];fe.some(((hs,vi)=>hs!==ve[vi]))&&(X.setOrientation(...fe),ve=fe);const oe=[E(gt,Fs,3),E(gt,Fs,4),E(gt,Fs,5)];oe.some(((hs,vi)=>hs!==Ue[vi]))&&(X.setPosition(...oe),Ue=oe)},Object.defineProperty(_t.gain,"defaultValue",{get:()=>0}),Object.defineProperty(bt.gain,"defaultValue",{get:()=>0}),Object.defineProperty(Dt.gain,"defaultValue",{get:()=>0}),Object.defineProperty(vt.gain,"defaultValue",{get:()=>0}),Object.defineProperty(Rt.gain,"defaultValue",{get:()=>0});const Gt={get bufferSize(){},get channelCount(){return X.channelCount},set channelCount(gt){if(gt>2)throw B();pt.channelCount=gt,X.channelCount=gt},get channelCountMode(){return X.channelCountMode},set channelCountMode(gt){if(gt==="max")throw B();pt.channelCountMode=gt,X.channelCountMode=gt},get channelInterpretation(){return X.channelInterpretation},set channelInterpretation(gt){pt.channelInterpretation=gt,X.channelInterpretation=gt},get coneInnerAngle(){return X.coneInnerAngle},set coneInnerAngle(gt){X.coneInnerAngle=gt},get coneOuterAngle(){return X.coneOuterAngle},set coneOuterAngle(gt){X.coneOuterAngle=gt},get coneOuterGain(){return X.coneOuterGain},set coneOuterGain(gt){if(gt<0||gt>1)throw n();X.coneOuterGain=gt},get context(){return X.context},get distanceModel(){return X.distanceModel},set distanceModel(gt){X.distanceModel=gt},get inputs(){return[pt]},get maxDistance(){return X.maxDistance},set maxDistance(gt){if(gt<0)throw new RangeError;X.maxDistance=gt},get numberOfInputs(){return X.numberOfInputs},get numberOfOutputs(){return X.numberOfOutputs},get orientationX(){return Ut.gain},get orientationY(){return _t.gain},get orientationZ(){return bt.gain},get panningModel(){return X.panningModel},set panningModel(gt){X.panningModel=gt},get positionX(){return Dt.gain},get positionY(){return vt.gain},get positionZ(){return Rt.gain},get refDistance(){return X.refDistance},set refDistance(gt){if(gt<0)throw new RangeError;X.refDistance=gt},get rolloffFactor(){return X.rolloffFactor},set rolloffFactor(gt){if(gt<0)throw new RangeError;X.rolloffFactor=gt},addEventListener:(...gt)=>pt.addEventListener(gt[0],gt[1],gt[2]),dispatchEvent:(...gt)=>pt.dispatchEvent(gt[0]),removeEventListener:(...gt)=>pt.removeEventListener(gt[0],gt[1],gt[2])};return M!==Gt.coneInnerAngle&&(Gt.coneInnerAngle=M),P!==Gt.coneOuterAngle&&(Gt.coneOuterAngle=P),k!==Gt.coneOuterGain&&(Gt.coneOuterGain=k),W!==Gt.distanceModel&&(Gt.distanceModel=W),V!==Gt.maxDistance&&(Gt.maxDistance=V),H!==Gt.orientationX.value&&(Gt.orientationX.value=H),K!==Gt.orientationY.value&&(Gt.orientationY.value=K),G!==Gt.orientationZ.value&&(Gt.orientationZ.value=G),N!==Gt.panningModel&&(Gt.panningModel=N),Z!==Gt.positionX.value&&(Gt.positionX.value=Z),it!==Gt.positionY.value&&(Gt.positionY.value=it),z!==Gt.positionZ.value&&(Gt.positionZ.value=z),j!==Gt.refDistance&&(Gt.refDistance=j),q!==Gt.rolloffFactor&&(Gt.rolloffFactor=q),ve[0]===1&&ve[1]===0&&ve[2]===0||X.setOrientation(...ve),Ue[0]===0&&Ue[1]===0&&Ue[2]===0||X.setPosition(...Ue),S(yA(Gt,X),(()=>{pt.connect(X),p(pt,te,0,0),te.connect(Ut).connect(ft,0,0),te.connect(_t).connect(ft,0,1),te.connect(bt).connect(ft,0,2),te.connect(Dt).connect(ft,0,3),te.connect(vt).connect(ft,0,4),te.connect(Rt).connect(ft,0,5),ft.connect($t).connect(Q.destination)}),(()=>{pt.disconnect(X),b(pt,te,0,0),te.disconnect(Ut),Ut.disconnect(ft),te.disconnect(_t),_t.disconnect(ft),te.disconnect(bt),bt.disconnect(ft),te.disconnect(Dt),Dt.disconnect(ft),te.disconnect(vt),vt.disconnect(ft),te.disconnect(Rt),Rt.disconnect(ft),ft.disconnect($t),$t.disconnect(Q.destination)}))})(ri,Je,ci,Es,Pr,_a,vs,oi,Zf,li),yp=(p=>(n,o)=>{const c=n.createPanner();return c.orientationX===void 0?p(n,o):(Ke(c,o),Qe(c,o,"orientationX"),Qe(c,o,"orientationY"),Qe(c,o,"orientationZ"),Qe(c,o,"positionX"),Qe(c,o,"positionY"),Qe(c,o,"positionZ"),ye(c,o,"coneInnerAngle"),ye(c,o,"coneOuterAngle"),ye(c,o,"coneOuterGain"),ye(c,o,"distanceModel"),ye(c,o,"maxDistance"),ye(c,o,"panningModel"),ye(c,o,"refDistance"),ye(c,o,"rolloffFactor"),c)})(ny),iy=((p,n,o,c,f,w,B,b,E,S)=>()=>{const Q=new WeakMap;let M=null;return{render(P,k){const W=Q.get(k);return W!==void 0?Promise.resolve(W):(async(V,H)=>{let K=null,G=w(V);const N={channelCount:G.channelCount,channelCountMode:G.channelCountMode,channelInterpretation:G.channelInterpretation},Z={...N,coneInnerAngle:G.coneInnerAngle,coneOuterAngle:G.coneOuterAngle,coneOuterGain:G.coneOuterGain,distanceModel:G.distanceModel,maxDistance:G.maxDistance,panningModel:G.panningModel,refDistance:G.refDistance,rolloffFactor:G.rolloffFactor},it=ct(G,H);if("bufferSize"in G)K=c(H,{...N,gain:1});else if(!it){const z={...Z,orientationX:G.orientationX.value,orientationY:G.orientationY.value,orientationZ:G.orientationZ.value,positionX:G.positionX.value,positionY:G.positionY.value,positionZ:G.positionZ.value};G=f(H,z)}if(Q.set(H,K===null?G:K),K!==null){if(M===null){if(B===null)throw new Error("Missing the native OfflineAudioContext constructor.");const pt=new B(6,V.context.length,H.sampleRate),Ut=n(pt,{channelCount:1,channelCountMode:"explicit",channelInterpretation:"speakers",numberOfInputs:6});Ut.connect(pt.destination),M=(async()=>{const _t=await Promise.all([V.orientationX,V.orientationY,V.orientationZ,V.positionX,V.positionY,V.positionZ].map((async(bt,Dt)=>{const vt=o(pt,{channelCount:1,channelCountMode:"explicit",channelInterpretation:"discrete",offset:Dt===0?1:0});return await b(pt,bt,vt.offset),vt})));for(let bt=0;bt<6;bt+=1)_t[bt].connect(Ut,0,bt),_t[bt].start(0);return S(pt)})()}const z=await M,j=c(H,{...N,gain:1});await E(V,H,j);const q=[];for(let pt=0;pt<z.numberOfChannels;pt+=1)q.push(z.getChannelData(pt));let ot=[q[0][0],q[1][0],q[2][0]],X=[q[3][0],q[4][0],q[5][0]],nt=c(H,{...N,gain:1}),ft=f(H,{...Z,orientationX:ot[0],orientationY:ot[1],orientationZ:ot[2],positionX:X[0],positionY:X[1],positionZ:X[2]});j.connect(nt).connect(ft.inputs[0]),ft.connect(K);for(let pt=128;pt<z.length;pt+=128){const Ut=[q[0][pt],q[1][pt],q[2][pt]],_t=[q[3][pt],q[4][pt],q[5][pt]];if(Ut.some(((bt,Dt)=>bt!==ot[Dt]))||_t.some(((bt,Dt)=>bt!==X[Dt]))){ot=Ut,X=_t;const bt=pt/H.sampleRate;nt.gain.setValueAtTime(0,bt),nt=c(H,{...N,gain:0}),ft=f(H,{...Z,orientationX:ot[0],orientationY:ot[1],orientationZ:ot[2],positionX:X[0],positionY:X[1],positionZ:X[2]}),nt.gain.setValueAtTime(1,bt),j.connect(nt).connect(ft.inputs[0]),ft.connect(K)}}return K}return it?(await p(H,V.orientationX,G.orientationX),await p(H,V.orientationY,G.orientationY),await p(H,V.orientationZ,G.orientationZ),await p(H,V.positionX,G.positionX),await p(H,V.positionY,G.positionY),await p(H,V.positionZ,G.positionZ)):(await b(H,V.orientationX,G.orientationX),await b(H,V.orientationY,G.orientationY),await b(H,V.orientationZ,G.orientationZ),await b(H,V.positionX,G.positionX),await b(H,V.positionY,G.positionY),await b(H,V.positionZ,G.positionZ)),is(G)?await E(V,H,G.inputs[0]):await E(V,H,G),G})(P,k)}}})(_n,ci,xA,Es,yp,ue,Ze,xn,As,ba),Ay=((p,n,o,c,f,w,B)=>class extends p{constructor(b,E){const S=f(b),Q={...fB,...E},M=o(S,Q),P=w(S);super(b,!1,M,P?c():null),this._nativePannerNode=M,this._orientationX=n(this,P,M.orientationX,Pt,Qt),this._orientationY=n(this,P,M.orientationY,Pt,Qt),this._orientationZ=n(this,P,M.orientationZ,Pt,Qt),this._positionX=n(this,P,M.positionX,Pt,Qt),this._positionY=n(this,P,M.positionY,Pt,Qt),this._positionZ=n(this,P,M.positionZ,Pt,Qt),B(this,1)}get coneInnerAngle(){return this._nativePannerNode.coneInnerAngle}set coneInnerAngle(b){this._nativePannerNode.coneInnerAngle=b}get coneOuterAngle(){return this._nativePannerNode.coneOuterAngle}set coneOuterAngle(b){this._nativePannerNode.coneOuterAngle=b}get coneOuterGain(){return this._nativePannerNode.coneOuterGain}set coneOuterGain(b){this._nativePannerNode.coneOuterGain=b}get distanceModel(){return this._nativePannerNode.distanceModel}set distanceModel(b){this._nativePannerNode.distanceModel=b}get maxDistance(){return this._nativePannerNode.maxDistance}set maxDistance(b){this._nativePannerNode.maxDistance=b}get orientationX(){return this._orientationX}get orientationY(){return this._orientationY}get orientationZ(){return this._orientationZ}get panningModel(){return this._nativePannerNode.panningModel}set panningModel(b){this._nativePannerNode.panningModel=b}get positionX(){return this._positionX}get positionY(){return this._positionY}get positionZ(){return this._positionZ}get refDistance(){return this._nativePannerNode.refDistance}set refDistance(b){this._nativePannerNode.refDistance=b}get rolloffFactor(){return this._nativePannerNode.rolloffFactor}set rolloffFactor(b){this._nativePannerNode.rolloffFactor=b}})(De,ln,yp,iy,me,ae,Gi),ry=(p=>(n,{disableNormalization:o,imag:c,real:f})=>{const w=c instanceof Float32Array?c:new Float32Array(c),B=f instanceof Float32Array?f:new Float32Array(f),b=n.createPeriodicWave(B,w,{disableNormalization:o});if(Array.from(c).length<2)throw p();return b})(mt),oy=((p,n,o,c)=>class fw{constructor(w,B){const b=n(w),E=(Q=>{const{imag:M,real:P}=Q;return M===void 0?P===void 0?{...Q,imag:[0,0],real:[0,0]}:{...Q,imag:Array.from(P,(()=>0)),real:P}:P===void 0?{...Q,imag:M,real:Array.from(M,(()=>0))}:{...Q,imag:M,real:P}})({...pB,...B}),S=p(b,E);return o.add(S),S}static[Symbol.hasInstance](w){return w!==null&&typeof w=="object"&&Object.getPrototypeOf(w)===fw.prototype||o.has(w)}})(ry,me,new WeakSet),ay=((p,n,o,c,f,w)=>{const b=new Float32Array([1,1]),E=Math.PI/2,S={channelCount:1,channelCountMode:"explicit",channelInterpretation:"discrete"},Q={...S,oversample:"none"},M=(P,k,W,V,H)=>{if(k===1)return((K,G,N,Z)=>{const it=new Float32Array(16385),z=new Float32Array(16385);for(let ft=0;ft<16385;ft+=1){const pt=ft/16384*E;it[ft]=Math.cos(pt),z[ft]=Math.sin(pt)}const j=o(K,{...S,gain:0}),q=c(K,{...Q,curve:it}),ot=c(K,{...Q,curve:b}),X=o(K,{...S,gain:0}),nt=c(K,{...Q,curve:z});return{connectGraph(){G.connect(j),G.connect(ot.inputs===void 0?ot:ot.inputs[0]),G.connect(X),ot.connect(N),N.connect(q.inputs===void 0?q:q.inputs[0]),N.connect(nt.inputs===void 0?nt:nt.inputs[0]),q.connect(j.gain),nt.connect(X.gain),j.connect(Z,0,0),X.connect(Z,0,1)},disconnectGraph(){G.disconnect(j),G.disconnect(ot.inputs===void 0?ot:ot.inputs[0]),G.disconnect(X),ot.disconnect(N),N.disconnect(q.inputs===void 0?q:q.inputs[0]),N.disconnect(nt.inputs===void 0?nt:nt.inputs[0]),q.disconnect(j.gain),nt.disconnect(X.gain),j.disconnect(Z,0,0),X.disconnect(Z,0,1)}}})(P,W,V,H);if(k===2)return((K,G,N,Z)=>{const it=new Float32Array(16385),z=new Float32Array(16385),j=new Float32Array(16385),q=new Float32Array(16385),ot=Math.floor(8192.5);for(let $t=0;$t<16385;$t+=1)if($t>ot){const te=($t-ot)/(16384-ot)*E;it[$t]=Math.cos(te),z[$t]=Math.sin(te),j[$t]=0,q[$t]=1}else{const te=$t/(16384-ot)*E;it[$t]=1,z[$t]=0,j[$t]=Math.cos(te),q[$t]=Math.sin(te)}const X=n(K,{channelCount:2,channelCountMode:"explicit",channelInterpretation:"discrete",numberOfOutputs:2}),nt=o(K,{...S,gain:0}),ft=c(K,{...Q,curve:it}),pt=o(K,{...S,gain:0}),Ut=c(K,{...Q,curve:z}),_t=c(K,{...Q,curve:b}),bt=o(K,{...S,gain:0}),Dt=c(K,{...Q,curve:j}),vt=o(K,{...S,gain:0}),Rt=c(K,{...Q,curve:q});return{connectGraph(){G.connect(X),G.connect(_t.inputs===void 0?_t:_t.inputs[0]),X.connect(nt,0),X.connect(pt,0),X.connect(bt,1),X.connect(vt,1),_t.connect(N),N.connect(ft.inputs===void 0?ft:ft.inputs[0]),N.connect(Ut.inputs===void 0?Ut:Ut.inputs[0]),N.connect(Dt.inputs===void 0?Dt:Dt.inputs[0]),N.connect(Rt.inputs===void 0?Rt:Rt.inputs[0]),ft.connect(nt.gain),Ut.connect(pt.gain),Dt.connect(bt.gain),Rt.connect(vt.gain),nt.connect(Z,0,0),bt.connect(Z,0,0),pt.connect(Z,0,1),vt.connect(Z,0,1)},disconnectGraph(){G.disconnect(X),G.disconnect(_t.inputs===void 0?_t:_t.inputs[0]),X.disconnect(nt,0),X.disconnect(pt,0),X.disconnect(bt,1),X.disconnect(vt,1),_t.disconnect(N),N.disconnect(ft.inputs===void 0?ft:ft.inputs[0]),N.disconnect(Ut.inputs===void 0?Ut:Ut.inputs[0]),N.disconnect(Dt.inputs===void 0?Dt:Dt.inputs[0]),N.disconnect(Rt.inputs===void 0?Rt:Rt.inputs[0]),ft.disconnect(nt.gain),Ut.disconnect(pt.gain),Dt.disconnect(bt.gain),Rt.disconnect(vt.gain),nt.disconnect(Z,0,0),bt.disconnect(Z,0,0),pt.disconnect(Z,0,1),vt.disconnect(Z,0,1)}}})(P,W,V,H);throw f()};return(P,{channelCount:k,channelCountMode:W,pan:V,...H})=>{if(W==="max")throw f();const K=p(P,{...H,channelCount:1,channelCountMode:W,numberOfInputs:2}),G=o(P,{...H,channelCount:k,channelCountMode:W,gain:1}),N=o(P,{channelCount:1,channelCountMode:"explicit",channelInterpretation:"discrete",gain:V});let{connectGraph:Z,disconnectGraph:it}=M(P,k,G,N,K);Object.defineProperty(N.gain,"defaultValue",{get:()=>0}),Object.defineProperty(N.gain,"maxValue",{get:()=>1}),Object.defineProperty(N.gain,"minValue",{get:()=>-1});const z={get bufferSize(){},get channelCount(){return G.channelCount},set channelCount(q){G.channelCount!==q&&(j&&it(),{connectGraph:Z,disconnectGraph:it}=M(P,q,G,N,K),j&&Z()),G.channelCount=q},get channelCountMode(){return G.channelCountMode},set channelCountMode(q){if(q==="clamped-max"||q==="max")throw f();G.channelCountMode=q},get channelInterpretation(){return G.channelInterpretation},set channelInterpretation(q){G.channelInterpretation=q},get context(){return G.context},get inputs(){return[G]},get numberOfInputs(){return G.numberOfInputs},get numberOfOutputs(){return G.numberOfOutputs},get pan(){return N.gain},addEventListener:(...q)=>G.addEventListener(q[0],q[1],q[2]),dispatchEvent:(...q)=>G.dispatchEvent(q[0]),removeEventListener:(...q)=>G.removeEventListener(q[0],q[1],q[2])};let j=!1;return w(yA(z,K),(()=>{Z(),j=!0}),(()=>{it(),j=!1}))}})(ci,Ur,Es,_a,vs,li),Cp=((p,n)=>(o,c)=>{const f=c.channelCountMode;if(f==="clamped-max")throw n();if(o.createStereoPanner===void 0)return p(o,c);const w=o.createStereoPanner();return Ke(w,c),Qe(w,c,"pan"),Object.defineProperty(w,"channelCountMode",{get:()=>f,set:B=>{if(B!==f)throw n()}}),w})(ay,vs),ly=((p,n,o,c,f)=>()=>{const w=new WeakMap;return{render(B,b){const E=w.get(b);return E!==void 0?Promise.resolve(E):(async(S,Q)=>{let M=o(S);const P=ct(M,Q);if(!P){const k={channelCount:M.channelCount,channelCountMode:M.channelCountMode,channelInterpretation:M.channelInterpretation,pan:M.pan.value};M=n(Q,k)}return w.set(Q,M),P?await p(Q,S.pan,M.pan):await c(Q,S.pan,M.pan),is(M)?await f(S,Q,M.inputs[0]):await f(S,Q,M),M})(B,b)}}})(_n,Cp,ue,xn,As),cy=((p,n,o,c,f,w)=>class extends p{constructor(B,b){const E=f(B),S={...mB,...b},Q=o(E,S),M=w(E);super(B,!1,Q,M?c():null),this._pan=n(this,M,Q.pan)}get pan(){return this._pan}})(De,ln,Cp,ly,me,ae),hy=((p,n,o)=>()=>{const c=new WeakMap;return{render(f,w){const B=c.get(w);return B!==void 0?Promise.resolve(B):(async(b,E)=>{let S=n(b);if(!ct(S,E)){const Q={channelCount:S.channelCount,channelCountMode:S.channelCountMode,channelInterpretation:S.channelInterpretation,curve:S.curve,oversample:S.oversample};S=p(E,Q)}return c.set(E,S),is(S)?await o(b,E,S.inputs[0]):await o(b,E,S),S})(f,w)}}})(_a,ue,As),uy=((p,n,o,c,f,w,B)=>class extends p{constructor(b,E){const S=f(b),Q={...wB,...E},M=o(S,Q);super(b,!0,M,w(S)?c():null),this._isCurveNullified=!1,this._nativeWaveShaperNode=M,B(this,1)}get curve(){return this._isCurveNullified?null:this._nativeWaveShaperNode.curve}set curve(b){if(b===null)this._isCurveNullified=!0,this._nativeWaveShaperNode.curve=new Float32Array([0,0]);else{if(b.length<2)throw n();this._isCurveNullified=!1,this._nativeWaveShaperNode.curve=b}}get oversample(){return this._nativeWaveShaperNode.oversample}set oversample(b){this._nativeWaveShaperNode.oversample=b}})(De,Je,_a,hy,me,ae,Gi),bp=(p=>p!==null&&p.isSecureContext)(an),Xc=(p=>(n,o,c)=>{Object.defineProperties(p,{currentFrame:{configurable:!0,get:()=>Math.round(n*o)},currentTime:{configurable:!0,get:()=>n}});try{return c()}finally{p!==null&&(delete p.currentFrame,delete p.currentTime)}})(an),_p=new WeakMap,dy=((p,n)=>o=>{let c=p.get(o);if(c!==void 0)return c;if(n===null)throw new Error("Missing the native OfflineAudioContext constructor.");return c=new n(1,1,44100),p.set(o,c),c})(_p,Ze),fy=bp?((p,n,o,c,f,w,B,b,E,S,Q,M,P)=>{let k=0;return(W,V,H={credentials:"omit"})=>{const K=Q.get(W);if(K!==void 0&&K.has(V))return Promise.resolve();const G=S.get(W);if(G!==void 0){const it=G.get(V);if(it!==void 0)return it}const N=w(W),Z=N.audioWorklet===void 0?f(V).then((([it,z])=>{const[j,q]=R(it,z);return o(`${j};((a,b)=>{(a[b]=a[b]||[]).push((AudioWorkletProcessor,global,registerProcessor,sampleRate,self,window)=>{${q}
})})(window,'_AWGS')`)})).then((()=>{const it=P._AWGS.pop();if(it===void 0)throw new SyntaxError;c(N.currentTime,N.sampleRate,(()=>it(class{},void 0,((z,j)=>{if(z.trim()==="")throw n();const q=T.get(N);if(q!==void 0){if(q.has(z))throw n();Y(j),st(j.parameterDescriptors),q.set(z,j)}else Y(j),st(j.parameterDescriptors),T.set(N,new Map([[z,j]]))}),N.sampleRate,void 0,void 0)))})):Promise.all([f(V),Promise.resolve(p(M,M))]).then((([[it,z],j])=>{const q=k+1;k=q;const[ot,X]=R(it,z),nt=new Blob([`${ot};((AudioWorkletProcessor,registerProcessor)=>{${X}
})(${j?"AudioWorkletProcessor":"class extends AudioWorkletProcessor {__b=new WeakSet();constructor(){super();(p=>p.postMessage=(q=>(m,t)=>q.call(p,m,t?t.filter(u=>!this.__b.has(u)):t))(p.postMessage))(this.port)}}"},(n,p)=>registerProcessor(n,class extends p{${j?"":"__c = (a) => a.forEach(e=>this.__b.add(e.buffer));"}process(i,o,p){${j?"":"i.forEach(this.__c);o.forEach(this.__c);this.__c(Object.values(p));"}return super.process(i.map(j=>j.some(k=>k.length===0)?[]:j),o,p)}}));registerProcessor('__sac${q}',class extends AudioWorkletProcessor{process(){return !1}})`],{type:"application/javascript; charset=utf-8"}),ft=URL.createObjectURL(nt);return N.audioWorklet.addModule(ft,H).then((()=>{if(b(N))return N;const pt=B(N);return pt.audioWorklet.addModule(ft,H).then((()=>pt))})).then((pt=>{if(E===null)throw new SyntaxError;try{new E(pt,`__sac${q}`)}catch{throw new SyntaxError}})).finally((()=>URL.revokeObjectURL(ft)))}));return G===void 0?S.set(W,new Map([[V,Z]])):G.set(V,Z),Z.then((()=>{const it=Q.get(W);it===void 0?Q.set(W,new Set([V])):it.add(V)})).finally((()=>{const it=S.get(W);it!==void 0&&it.delete(V)})),Z}})(qs,vs,(p=>n=>new Promise(((o,c)=>{if(p===null)return void c(new SyntaxError);const f=p.document.head;if(f===null)c(new SyntaxError);else{const w=p.document.createElement("script"),B=new Blob([n],{type:"application/javascript"}),b=URL.createObjectURL(B),E=p.onerror,S=()=>{p.onerror=E,URL.revokeObjectURL(b)};p.onerror=(Q,M,P,k,W)=>M===b||M===p.location.href&&P===1&&k===1?(S(),c(W),!1):E!==null?E(Q,M,P,k,W):void 0,w.onerror=()=>{S(),c(new SyntaxError)},w.onload=()=>{S(),o()},w.src=b,w.type="module",f.appendChild(w)}})))(an),Xc,(async p=>{try{const n=await fetch(p);if(n.ok)return[await n.text(),n.url]}catch{}throw new DOMException("","AbortError")}),me,dy,ae,bA,new WeakMap,new WeakMap,((p,n)=>async()=>{if(p===null)return!0;if(n===null)return!1;const o=new Blob(['class A extends AudioWorkletProcessor{process(i){this.port.postMessage(i,[i[0][0].buffer])}}registerProcessor("a",A)'],{type:"application/javascript; charset=utf-8"}),c=new n(1,128,44100),f=URL.createObjectURL(o);let w=!1,B=!1;try{await c.audioWorklet.addModule(f);const b=new p(c,"a",{numberOfOutputs:0}),E=c.createOscillator();b.port.onmessage=()=>w=!0,b.onprocessorerror=()=>B=!0,E.connect(b),E.start(0),await c.startRendering(),await new Promise((S=>setTimeout(S)))}catch{}finally{URL.revokeObjectURL(f)}return w&&!B})(bA,Ze),an):void 0,py=((p,n)=>o=>p(o)||n(o))(Wc,ae),my=((p,n,o,c,f,w,B,b,E,S,Q)=>(M,P)=>{const k=B(M)?M:w(M);if(f.has(P)){const W=new DOMException("","DataCloneError");return Promise.reject(W)}try{f.add(P)}catch{}return n(E,(()=>E(k)))?k.decodeAudioData(P).then((W=>(qf(P).catch((()=>{})),n(b,(()=>b(W)))||Q(W),p.add(W),W))):new Promise(((W,V)=>{const H=async()=>{try{await qf(P)}catch{}},K=G=>{V(G),H()};try{k.decodeAudioData(P,(G=>{typeof G.copyFromChannel!="function"&&(S(G),At(G)),p.add(G),H().then((()=>W(G)))}),(G=>{K(G===null?new DOMException("","EncodingError"):G)}))}catch(G){K(G)}}))})(Kc,qs,0,0,new WeakSet,me,py,lt,Mr,zc,$c),xp=((p,n,o,c,f,w,B,b,E,S,Q,M,P,k,W,V,H,K,G,N)=>class extends W{constructor(Z,it){super(Z,it),this._nativeContext=Z,this._audioWorklet=p===void 0?void 0:{addModule:(z,j)=>p(this,z,j)}}get audioWorklet(){return this._audioWorklet}createAnalyser(){return new n(this)}createBiquadFilter(){return new f(this)}createBuffer(Z,it,z){return new o({length:it,numberOfChannels:Z,sampleRate:z})}createBufferSource(){return new c(this)}createChannelMerger(Z=6){return new w(this,{numberOfInputs:Z})}createChannelSplitter(Z=6){return new B(this,{numberOfOutputs:Z})}createConstantSource(){return new b(this)}createConvolver(){return new E(this)}createDelay(Z=1){return new Q(this,{maxDelayTime:Z})}createDynamicsCompressor(){return new M(this)}createGain(){return new P(this)}createIIRFilter(Z,it){return new k(this,{feedback:it,feedforward:Z})}createOscillator(){return new V(this)}createPanner(){return new H(this)}createPeriodicWave(Z,it,z={disableNormalization:!1}){return new K(this,{...z,imag:it,real:Z})}createStereoPanner(){return new G(this)}createWaveShaper(){return new N(this)}decodeAudioData(Z,it,z){return S(this._nativeContext,Z).then((j=>(typeof it=="function"&&it(j),j)),(j=>{throw typeof z=="function"&&z(j),j}))}})(fy,EB,dp,FB,QB,PB,DB,RB,NB,my,WB,KB,zB,jB,ZB,ey,Ay,oy,cy,uy),gy=((p,n,o,c)=>class extends p{constructor(f,w){const B=o(f),b=((E,S)=>E.createMediaElementSource(S.mediaElement))(B,w);if(c(B))throw TypeError();super(f,!0,b,null),this._nativeMediaElementAudioSourceNode=b}get mediaElement(){return this._nativeMediaElementAudioSourceNode.mediaElement}})(De,0,me,ae),wy=((p,n,o,c)=>class extends p{constructor(f,w){const B=o(f);if(c(B))throw new TypeError;const b=((E,S)=>{const Q=E.createMediaStreamDestination();return Ke(Q,S),Q.numberOfOutputs===1&&Object.defineProperty(Q,"numberOfOutputs",{get:()=>0}),Q})(B,{...cB,...w});super(f,!1,b,null),this._nativeMediaStreamAudioDestinationNode=b}get stream(){return this._nativeMediaStreamAudioDestinationNode.stream}})(De,0,me,ae),vy=((p,n,o,c)=>class extends p{constructor(f,w){const B=o(f),b=((E,{mediaStream:S})=>{const Q=S.getAudioTracks();Q.sort(((k,W)=>k.id<W.id?-1:k.id>W.id?1:0));const M=Q.slice(0,1),P=E.createMediaStreamSource(new MediaStream(M));return Object.defineProperty(P,"mediaStream",{value:S}),P})(B,w);if(c(B))throw new TypeError;super(f,!0,b,null),this._nativeMediaStreamAudioSourceNode=b}get mediaStream(){return this._nativeMediaStreamAudioSourceNode.mediaStream}})(De,0,me,ae),By=((p,n)=>(o,{mediaStreamTrack:c})=>{if(typeof o.createMediaStreamTrackSource=="function")return o.createMediaStreamTrackSource(c);const f=new MediaStream([c]),w=o.createMediaStreamSource(f);if(c.kind!=="audio")throw p();if(n(o))throw new TypeError;return w})(Je,ae),yy=((p,n,o)=>class extends p{constructor(c,f){const w=o(c);super(c,!0,n(w,f),null)}})(De,By,me),Cy=((p,n,o,c,f,w,B,b,E)=>class extends p{constructor(S={}){if(E===null)throw new Error("Missing the native AudioContext constructor.");let Q;try{Q=new E(S)}catch(k){throw k.code===12&&k.message==="sampleRate is not in range"?o():k}if(Q===null)throw c();if(!(k=>k===void 0||typeof k=="number"||typeof k=="string"&&(k==="balanced"||k==="interactive"||k==="playback"))(S.latencyHint))throw new TypeError(`The provided value '${S.latencyHint}' is not a valid enum value of type AudioContextLatencyCategory.`);if(S.sampleRate!==void 0&&Q.sampleRate!==S.sampleRate)throw o();super(Q,2);const{latencyHint:M}=S,{sampleRate:P}=Q;if(this._baseLatency=typeof Q.baseLatency=="number"?Q.baseLatency:M==="balanced"?512/P:M==="interactive"||M===void 0?256/P:M==="playback"?1024/P:128*Math.max(2,Math.min(128,Math.round(M*P/128)))/P,this._nativeAudioContext=Q,E.name==="webkitAudioContext"?(this._nativeGainNode=Q.createGain(),this._nativeOscillatorNode=Q.createOscillator(),this._nativeGainNode.gain.value=1e-37,this._nativeOscillatorNode.connect(this._nativeGainNode).connect(Q.destination),this._nativeOscillatorNode.start()):(this._nativeGainNode=null,this._nativeOscillatorNode=null),this._state=null,Q.state==="running"){this._state="suspended";const k=()=>{this._state==="suspended"&&(this._state=null),Q.removeEventListener("statechange",k)};Q.addEventListener("statechange",k)}}get baseLatency(){return this._baseLatency}get state(){return this._state!==null?this._state:this._nativeAudioContext.state}close(){return this.state==="closed"?this._nativeAudioContext.close().then((()=>{throw n()})):(this._state==="suspended"&&(this._state=null),this._nativeAudioContext.close().then((()=>{this._nativeGainNode!==null&&this._nativeOscillatorNode!==null&&(this._nativeOscillatorNode.stop(),this._nativeGainNode.disconnect(),this._nativeOscillatorNode.disconnect()),qt(this)})))}createMediaElementSource(S){return new f(this,{mediaElement:S})}createMediaStreamDestination(){return new w(this)}createMediaStreamSource(S){return new B(this,{mediaStream:S})}createMediaStreamTrackSource(S){return new b(this,{mediaStreamTrack:S})}resume(){return this._state==="suspended"?new Promise(((S,Q)=>{const M=()=>{this._nativeAudioContext.removeEventListener("statechange",M),this._nativeAudioContext.state==="running"?S():this.resume().then(S,Q)};this._nativeAudioContext.addEventListener("statechange",M)})):this._nativeAudioContext.resume().catch((S=>{throw S===void 0||S.code===15?n():S}))}suspend(){return this._nativeAudioContext.suspend().catch((S=>{throw S===void 0?n():S}))}})(xp,Je,vs,gB,gy,wy,vy,yy,ai),Yc=(p=>n=>{const o=p.get(n);if(o===void 0)throw new Error("The context has no set of AudioWorkletNodes.");return o})(wp),by=(p=>(n,o)=>{p(n).add(o)})(Yc),Ep=(p=>(n,o,c=0,f=0)=>{const w=n[c];if(w===void 0)throw p();return vA(o)?w.connect(o,0,f):w.connect(o,0)})(mt),_y=(p=>(n,o)=>{p(n).delete(o)})(Yc),Sp=(p=>(n,o=void 0,c=void 0,f=0)=>o===void 0?n.forEach((w=>w.disconnect())):typeof o=="number"?va(p,n,o).disconnect():vA(o)?c===void 0?n.forEach((w=>w.disconnect(o))):f===void 0?va(p,n,c).disconnect(o,0):va(p,n,c).disconnect(o,0,f):c===void 0?n.forEach((w=>w.disconnect(o))):va(p,n,c).disconnect(o,0))(mt),Fp=new WeakMap,xy=((p,n)=>o=>n(p,o))(Fp,L),Ey=((p,n,o,c,f,w,B,b,E,S,Q,M,P)=>(k,W,V,H)=>{if(H.numberOfInputs===0&&H.numberOfOutputs===0)throw E();const K=Array.isArray(H.outputChannelCount)?H.outputChannelCount:Array.from(H.outputChannelCount);if(K.some((ut=>ut<1)))throw E();if(K.length!==H.numberOfOutputs)throw n();if(H.channelCountMode!=="explicit")throw E();const G=H.channelCount*H.numberOfInputs,N=K.reduce(((ut,ee)=>ut+ee),0),Z=V.parameterDescriptors===void 0?0:V.parameterDescriptors.length;if(G+Z>6||N>6)throw E();const it=new MessageChannel,z=[],j=[];for(let ut=0;ut<H.numberOfInputs;ut+=1)z.push(B(k,{channelCount:H.channelCount,channelCountMode:H.channelCountMode,channelInterpretation:H.channelInterpretation,gain:1})),j.push(f(k,{channelCount:H.channelCount,channelCountMode:"explicit",channelInterpretation:"discrete",numberOfOutputs:H.channelCount}));const q=[];if(V.parameterDescriptors!==void 0)for(const{defaultValue:ut,maxValue:ee,minValue:us,name:xe}of V.parameterDescriptors){const Zt=w(k,{channelCount:1,channelCountMode:"explicit",channelInterpretation:"discrete",offset:H.parameterData[xe]!==void 0?H.parameterData[xe]:ut===void 0?0:ut});Object.defineProperties(Zt.offset,{defaultValue:{get:()=>ut===void 0?0:ut},maxValue:{get:()=>ee===void 0?Pt:ee},minValue:{get:()=>us===void 0?Qt:us}}),q.push(Zt)}const ot=c(k,{channelCount:1,channelCountMode:"explicit",channelInterpretation:"speakers",numberOfInputs:Math.max(1,G+Z)}),X=Xf(W,k.sampleRate),nt=b(k,X,G+Z,Math.max(1,N)),ft=f(k,{channelCount:Math.max(1,N),channelCountMode:"explicit",channelInterpretation:"discrete",numberOfOutputs:Math.max(1,N)}),pt=[];for(let ut=0;ut<H.numberOfOutputs;ut+=1)pt.push(c(k,{channelCount:1,channelCountMode:"explicit",channelInterpretation:"speakers",numberOfInputs:K[ut]}));for(let ut=0;ut<H.numberOfInputs;ut+=1){z[ut].connect(j[ut]);for(let ee=0;ee<H.channelCount;ee+=1)j[ut].connect(ot,ee,ut*H.channelCount+ee)}const Ut=new ma(V.parameterDescriptors===void 0?[]:V.parameterDescriptors.map((({name:ut},ee)=>{const us=q[ee];return us.connect(ot,0,G+ee),us.start(0),[ut,us.offset]})));ot.connect(nt);let _t=H.channelInterpretation,bt=null;const Dt=H.numberOfOutputs===0?[nt]:pt,vt={get bufferSize(){return X},get channelCount(){return H.channelCount},set channelCount(ut){throw o()},get channelCountMode(){return H.channelCountMode},set channelCountMode(ut){throw o()},get channelInterpretation(){return _t},set channelInterpretation(ut){for(const ee of z)ee.channelInterpretation=ut;_t=ut},get context(){return nt.context},get inputs(){return z},get numberOfInputs(){return H.numberOfInputs},get numberOfOutputs(){return H.numberOfOutputs},get onprocessorerror(){return bt},set onprocessorerror(ut){typeof bt=="function"&&vt.removeEventListener("processorerror",bt),bt=typeof ut=="function"?ut:null,typeof bt=="function"&&vt.addEventListener("processorerror",bt)},get parameters(){return Ut},get port(){return it.port2},addEventListener:(...ut)=>nt.addEventListener(ut[0],ut[1],ut[2]),connect:p.bind(null,Dt),disconnect:S.bind(null,Dt),dispatchEvent:(...ut)=>nt.dispatchEvent(ut[0]),removeEventListener:(...ut)=>nt.removeEventListener(ut[0],ut[1],ut[2])},Rt=new Map;var $t,te;it.port1.addEventListener=($t=it.port1.addEventListener,(...ut)=>{if(ut[0]==="message"){const ee=typeof ut[1]=="function"?ut[1]:typeof ut[1]=="object"&&ut[1]!==null&&typeof ut[1].handleEvent=="function"?ut[1].handleEvent:null;if(ee!==null){const us=Rt.get(ut[1]);us!==void 0?ut[1]=us:(ut[1]=xe=>{Q(k.currentTime,k.sampleRate,(()=>ee(xe)))},Rt.set(ee,ut[1]))}}return $t.call(it.port1,ut[0],ut[1],ut[2])}),it.port1.removeEventListener=(te=it.port1.removeEventListener,(...ut)=>{if(ut[0]==="message"){const ee=Rt.get(ut[1]);ee!==void 0&&(Rt.delete(ut[1]),ut[1]=ee)}return te.call(it.port1,ut[0],ut[1],ut[2])});let ve=null;Object.defineProperty(it.port1,"onmessage",{get:()=>ve,set:ut=>{typeof ve=="function"&&it.port1.removeEventListener("message",ve),ve=typeof ut=="function"?ut:null,typeof ve=="function"&&(it.port1.addEventListener("message",ve),it.port1.start())}}),V.prototype.port=it.port1;let Ue=null;((ut,ee,us,xe)=>{let Zt=U.get(ut);Zt===void 0&&(Zt=new WeakMap,U.set(ut,Zt));const Be=(async(Ts,Fn)=>{const Tn=await(ou=>new Promise(((au,FC)=>{const{port1:Wa,port2:lu}=new MessageChannel;Wa.onmessage=({data:cu})=>{Wa.close(),lu.close(),au(cu)},Wa.onmessageerror=({data:cu})=>{Wa.close(),lu.close(),FC(cu)},lu.postMessage(ou)})))(Fn);return new Ts(Tn)})(us,xe);return Zt.set(ee,Be),Be})(k,vt,V,H).then((ut=>Ue=ut));const Gt=wa(H.numberOfInputs,H.channelCount),gt=wa(H.numberOfOutputs,K),fe=V.parameterDescriptors===void 0?[]:V.parameterDescriptors.reduce(((ut,{name:ee})=>({...ut,[ee]:new Float32Array(128)})),{});let oe=!0;const hs=()=>{H.numberOfOutputs>0&&nt.disconnect(ft);for(let ut=0,ee=0;ut<H.numberOfOutputs;ut+=1){const us=pt[ut];for(let xe=0;xe<K[ut];xe+=1)ft.disconnect(us,ee+xe,xe);ee+=K[ut]}},vi=new Map;nt.onaudioprocess=({inputBuffer:ut,outputBuffer:ee})=>{if(Ue!==null){const us=M(vt);for(let xe=0;xe<X;xe+=128){for(let Zt=0;Zt<H.numberOfInputs;Zt+=1)for(let Be=0;Be<H.channelCount;Be+=1)Wi(ut,Gt[Zt],Be,Be,xe);V.parameterDescriptors!==void 0&&V.parameterDescriptors.forEach((({name:Zt},Be)=>{Wi(ut,fe,Zt,G+Be,xe)}));for(let Zt=0;Zt<H.numberOfInputs;Zt+=1)for(let Be=0;Be<K[Zt];Be+=1)gt[Zt][Be].byteLength===0&&(gt[Zt][Be]=new Float32Array(128));try{const Zt=Gt.map(((Ts,Fn)=>{if(us[Fn].size>0)return vi.set(Fn,X/128),Ts;const Tn=vi.get(Fn);return Tn===void 0?[]:(Ts.every((ou=>ou.every((au=>au===0))))&&(Tn===1?vi.delete(Fn):vi.set(Fn,Tn-1)),Ts)}));oe=Q(k.currentTime+xe/k.sampleRate,k.sampleRate,(()=>Ue.process(Zt,gt,fe)));for(let Ts=0,Fn=0;Ts<H.numberOfOutputs;Ts+=1){for(let Tn=0;Tn<K[Ts];Tn+=1)BA(ee,gt[Ts],Tn,Fn+Tn,xe);Fn+=K[Ts]}}catch(Zt){oe=!1,vt.dispatchEvent(new ErrorEvent("processorerror",{colno:Zt.colno,filename:Zt.filename,lineno:Zt.lineno,message:Zt.message}))}if(!oe){for(let Zt=0;Zt<H.numberOfInputs;Zt+=1){z[Zt].disconnect(j[Zt]);for(let Be=0;Be<H.channelCount;Be+=1)j[xe].disconnect(ot,Be,Zt*H.channelCount+Be)}if(V.parameterDescriptors!==void 0){const Zt=V.parameterDescriptors.length;for(let Be=0;Be<Zt;Be+=1){const Ts=q[Be];Ts.disconnect(ot,0,G+Be),Ts.stop()}}ot.disconnect(nt),nt.onaudioprocess=null,Au?hs():nm();break}}}};let Au=!1;const ru=B(k,{channelCount:1,channelCountMode:"explicit",channelInterpretation:"discrete",gain:0}),sm=()=>nt.connect(ru).connect(k.destination),nm=()=>{nt.disconnect(ru),ru.disconnect()};return sm(),P(vt,(()=>{if(oe){nm(),H.numberOfOutputs>0&&nt.connect(ft);for(let ut=0,ee=0;ut<H.numberOfOutputs;ut+=1){const us=pt[ut];for(let xe=0;xe<K[ut];xe+=1)ft.connect(us,ee+xe,xe);ee+=K[ut]}}Au=!0}),(()=>{oe&&(sm(),hs()),Au=!1}))})(Ep,mt,Je,ci,Ur,xA,Es,Pr,vs,Sp,Xc,xy,li),Sy=((p,n,o,c,f)=>(w,B,b,E,S,Q)=>{if(b!==null)try{const k=new b(w,E,Q),W=new Map;let V=null;if(Object.defineProperties(k,{channelCount:{get:()=>Q.channelCount,set:()=>{throw p()}},channelCountMode:{get:()=>"explicit",set:()=>{throw p()}},onprocessorerror:{get:()=>V,set:H=>{typeof V=="function"&&k.removeEventListener("processorerror",V),V=typeof H=="function"?H:null,typeof V=="function"&&k.addEventListener("processorerror",V)}}}),k.addEventListener=(P=k.addEventListener,(...H)=>{if(H[0]==="processorerror"){const K=typeof H[1]=="function"?H[1]:typeof H[1]=="object"&&H[1]!==null&&typeof H[1].handleEvent=="function"?H[1].handleEvent:null;if(K!==null){const G=W.get(H[1]);G!==void 0?H[1]=G:(H[1]=N=>{N.type==="error"?(Object.defineProperties(N,{type:{value:"processorerror"}}),K(N)):K(new ErrorEvent(H[0],{...N}))},W.set(K,H[1]))}}return P.call(k,"error",H[1],H[2]),P.call(k,...H)}),k.removeEventListener=(M=k.removeEventListener,(...H)=>{if(H[0]==="processorerror"){const K=W.get(H[1]);K!==void 0&&(W.delete(H[1]),H[1]=K)}return M.call(k,"error",H[1],H[2]),M.call(k,H[0],H[1],H[2])}),Q.numberOfOutputs!==0){const H=o(w,{channelCount:1,channelCountMode:"explicit",channelInterpretation:"discrete",gain:0});return k.connect(H).connect(w.destination),f(k,(()=>H.disconnect()),(()=>H.connect(w.destination)))}return k}catch(k){throw k.code===11?c():k}var M,P;if(S===void 0)throw c();return(k=>{const{port1:W}=new MessageChannel;try{W.postMessage(k)}finally{W.close()}})(Q),n(w,B,S,Q)})(Je,Ey,Es,vs,li),Fy=((p,n,o,c,f,w,B,b,E,S,Q,M,P,k,W,V)=>(H,K,G)=>{const N=new WeakMap;let Z=null;return{render(it,z){b(z,it);const j=N.get(z);return j!==void 0?Promise.resolve(j):(async(q,ot)=>{let X=Q(q),nt=null;const ft=ct(X,ot),pt=Array.isArray(K.outputChannelCount)?K.outputChannelCount:Array.from(K.outputChannelCount);if(M===null){const Ut=pt.reduce(((vt,Rt)=>vt+Rt),0),_t=f(ot,{channelCount:Math.max(1,Ut),channelCountMode:"explicit",channelInterpretation:"discrete",numberOfOutputs:Math.max(1,Ut)}),bt=[];for(let vt=0;vt<q.numberOfOutputs;vt+=1)bt.push(c(ot,{channelCount:1,channelCountMode:"explicit",channelInterpretation:"speakers",numberOfInputs:pt[vt]}));const Dt=B(ot,{channelCount:K.channelCount,channelCountMode:K.channelCountMode,channelInterpretation:K.channelInterpretation,gain:1});Dt.connect=n.bind(null,bt),Dt.disconnect=E.bind(null,bt),nt=[_t,bt,Dt]}else ft||(X=new M(ot,H));if(N.set(ot,nt===null?X:nt[2]),nt!==null){if(Z===null){if(G===void 0)throw new Error("Missing the processor constructor.");if(P===null)throw new Error("Missing the native OfflineAudioContext constructor.");const Rt=q.channelCount*q.numberOfInputs,$t=G.parameterDescriptors===void 0?0:G.parameterDescriptors.length,te=Rt+$t;Z=tB(q,te===0?null:await(async()=>{const Ue=new P(te,128*Math.ceil(q.context.length/128),ot.sampleRate),Fs=[],Gt=[];for(let oe=0;oe<K.numberOfInputs;oe+=1)Fs.push(B(Ue,{channelCount:K.channelCount,channelCountMode:K.channelCountMode,channelInterpretation:K.channelInterpretation,gain:1})),Gt.push(f(Ue,{channelCount:K.channelCount,channelCountMode:"explicit",channelInterpretation:"discrete",numberOfOutputs:K.channelCount}));const gt=await Promise.all(Array.from(q.parameters.values()).map((async oe=>{const hs=w(Ue,{channelCount:1,channelCountMode:"explicit",channelInterpretation:"discrete",offset:oe.value});return await k(Ue,oe,hs.offset),hs}))),fe=c(Ue,{channelCount:1,channelCountMode:"explicit",channelInterpretation:"speakers",numberOfInputs:Math.max(1,Rt+$t)});for(let oe=0;oe<K.numberOfInputs;oe+=1){Fs[oe].connect(Gt[oe]);for(let hs=0;hs<K.channelCount;hs+=1)Gt[oe].connect(fe,hs,oe*K.channelCount+hs)}for(const[oe,hs]of gt.entries())hs.connect(fe,0,Rt+oe),hs.start(0);return fe.connect(Ue.destination),await Promise.all(Fs.map((oe=>W(q,Ue,oe)))),V(Ue)})(),ot,K,pt,G,S)}const Ut=await Z,_t=o(ot,{buffer:null,channelCount:2,channelCountMode:"max",channelInterpretation:"speakers",loop:!1,loopEnd:0,loopStart:0,playbackRate:1}),[bt,Dt,vt]=nt;Ut!==null&&(_t.buffer=Ut,_t.start(0)),_t.connect(bt);for(let Rt=0,$t=0;Rt<q.numberOfOutputs;Rt+=1){const te=Dt[Rt];for(let ve=0;ve<pt[Rt];ve+=1)bt.connect(te,$t+ve,ve);$t+=pt[Rt]}return vt}if(ft)for(const[Ut,_t]of q.parameters.entries())await p(ot,_t,X.parameters.get(Ut));else for(const[Ut,_t]of q.parameters.entries())await k(ot,_t,X.parameters.get(Ut));return await W(q,ot,X),X})(it,z)}}})(_n,Ep,_A,ci,Ur,xA,Es,_y,Sp,Xc,ue,bA,Ze,xn,As,ba),Ty=(p=>n=>p.get(n))(_p),Iy=(p=>(n,o)=>{p.set(n,o)})(Fp),Tp=bp?((p,n,o,c,f,w,B,b,E,S,Q,M,P,k)=>class extends n{constructor(W,V,H){var K;const G=b(W),N=E(G),Z=(nt=>({...nt,outputChannelCount:nt.outputChannelCount!==void 0?nt.outputChannelCount:nt.numberOfInputs===1&&nt.numberOfOutputs===1?[nt.channelCount]:Array.from({length:nt.numberOfOutputs},(()=>1))}))({...ga,...H});(nt=>{const{port1:ft,port2:pt}=new MessageChannel;try{ft.postMessage(nt)}finally{ft.close(),pt.close()}})(Z);const it=T.get(G),z=it==null?void 0:it.get(V),j=N||G.state!=="closed"?G:(K=B(G))!==null&&K!==void 0?K:G,q=f(j,N?null:W.baseLatency,S,V,z,Z);super(W,!0,q,N?c(V,Z,z):null);const ot=[];q.parameters.forEach(((nt,ft)=>{const pt=o(this,N,nt);ot.push([ft,pt])})),this._nativeAudioWorkletNode=q,this._onprocessorerror=null,this._parameters=new ma(ot),N&&p(G,this);const{activeInputs:X}=w(this);M(q,X)}get onprocessorerror(){return this._onprocessorerror}set onprocessorerror(W){const V=typeof W=="function"?k(this,W):null;this._nativeAudioWorkletNode.onprocessorerror=V;const H=this._nativeAudioWorkletNode.onprocessorerror;this._onprocessorerror=H!==null&&H===V?W:H}get parameters(){return this._parameters===null?this._nativeAudioWorkletNode.parameters:this._parameters}get port(){return this._nativeAudioWorkletNode.port}})(by,De,ln,Fy,Sy,Lt,Ty,me,ae,bA,0,Iy,0,CA):void 0,Qy=((p,n)=>(o,c,f)=>{if(n===null)throw new Error("Missing the native OfflineAudioContext constructor.");try{return new n(o,c,f)}catch(w){throw w.name==="SyntaxError"?p():w}})(vs,Ze),My=((p,n,o,c,f,w,B,b)=>(E,S)=>o(E).render(E,S).then((()=>Promise.all(Array.from(c(S)).map((Q=>o(Q).render(Q,S)))))).then((()=>f(S))).then((Q=>(typeof Q.copyFromChannel!="function"?(B(Q),At(Q)):n(w,(()=>w(Q)))||b(Q),p.add(Q),Q))))(Kc,qs,Vc,Yc,ba,lt,zc,$c),Uy=((p,n,o,c,f)=>class extends p{constructor(w,B,b){let E;if(typeof w=="number"&&B!==void 0&&b!==void 0)E={length:B,numberOfChannels:w,sampleRate:b};else{if(typeof w!="object")throw new Error("The given parameters are not valid.");E=w}const{length:S,numberOfChannels:Q,sampleRate:M}={...uB,...E},P=c(Q,S,M);n(Mr,(()=>Mr(P)))||P.addEventListener("statechange",(()=>{let k=0;const W=V=>{this._state==="running"&&(k>0?(P.removeEventListener("statechange",W),V.stopImmediatePropagation(),this._waitForThePromiseToSettle(V)):k+=1)};return W})()),super(P,Q),this._length=S,this._nativeOfflineAudioContext=P,this._state=null}get length(){return this._nativeOfflineAudioContext.length===void 0?this._length:this._nativeOfflineAudioContext.length}get state(){return this._state===null?this._nativeOfflineAudioContext.state:this._state}startRendering(){return this._state==="running"?Promise.reject(o()):(this._state="running",f(this.destination,this._nativeOfflineAudioContext).finally((()=>{this._state=null,qt(this)})))}_waitForThePromiseToSettle(w){this._state===null?this._nativeOfflineAudioContext.dispatchEvent(w):setTimeout((()=>this._waitForThePromiseToSettle(w)))}})(xp,qs,Je,Qy,My),Py=((p,n)=>o=>{const c=p.get(o);return n(c)||n(o)})(x,Wc),ky=((p,n)=>o=>p.has(o)||n(o))(v,Gc),Dy=((p,n)=>o=>p.has(o)||n(o))(C,lp),Ly=((p,n)=>o=>{const c=p.get(o);return n(c)||n(o)})(x,ae),Hy=()=>(async(p,n,o,c,f,w,B,b,E,S,Q,M,P,k,W,V)=>!!(p(n,n)&&p(o,o)&&p(f,f)&&p(w,w)&&p(b,b)&&p(E,E)&&p(S,S)&&p(Q,Q)&&p(M,M)&&p(P,P)&&p(k,k))&&(await Promise.all([p(c,c),p(B,B),p(W,W),p(V,V)])).every((H=>H)))(qs,(p=>()=>{if(p===null)return!1;const n=new p(1,1,44100).createBuffer(1,1,44100);if(n.copyToChannel===void 0)return!0;const o=new Float32Array(2);try{n.copyFromChannel(o,0,0)}catch{return!1}return!0})(Ze),(p=>()=>{if(p===null)return!1;if(p.prototype!==void 0&&p.prototype.close!==void 0)return!0;const n=new p,o=n.close!==void 0;try{n.close()}catch{}return o})(ai),(p=>()=>{if(p===null)return Promise.resolve(!1);const n=new p(1,1,44100);return new Promise((o=>{let c=!0;const f=B=>{c&&(c=!1,n.startRendering(),o(B instanceof TypeError))};let w;try{w=n.decodeAudioData(null,(()=>{}),f)}catch(B){f(B)}w!==void 0&&w.catch(f)}))})(Ze),(p=>()=>{if(p===null)return!1;let n;try{n=new p({latencyHint:"balanced"})}catch{return!1}return n.close(),!0})(ai),(p=>()=>{if(p===null)return!1;const n=new p(1,1,44100).createGain(),o=n.connect(n)===n;return n.disconnect(n),o})(Ze),((p,n)=>async()=>{if(p===null)return!0;if(n===null)return!1;const o=new Blob(['let c,p;class A extends AudioWorkletProcessor{constructor(){super();this.port.onmessage=(e)=>{p=e.data;p.onmessage=()=>{p.postMessage(c);p.close()};this.port.postMessage(0)}}process(){c=1}}registerProcessor("a",A)'],{type:"application/javascript; charset=utf-8"}),c=new MessageChannel,f=new n(1,128,44100),w=URL.createObjectURL(o);let B=!1;try{await f.audioWorklet.addModule(w);const b=new p(f,"a",{numberOfOutputs:0}),E=f.createOscillator();await new Promise((S=>{b.port.onmessage=()=>S(),b.port.postMessage(c.port2,[c.port2])})),b.port.onmessage=()=>B=!0,E.connect(b),E.start(0),await f.startRendering(),B=await new Promise((S=>{c.port1.onmessage=({data:Q})=>S(Q===1),c.port1.postMessage(0)}))}catch{}finally{c.port1.close(),URL.revokeObjectURL(w)}return B})(bA,Ze),(p=>()=>{if(p===null)return!1;const n=new p(1,1,44100).createChannelMerger();if(n.channelCountMode==="max")return!0;try{n.channelCount=2}catch{return!0}return!1})(Ze),(p=>()=>{if(p===null)return!1;const n=new p(1,1,44100);return n.createConstantSource===void 0||n.createConstantSource().offset.maxValue!==Number.POSITIVE_INFINITY})(Ze),(p=>()=>{if(p===null)return!1;const n=new p(1,1,44100),o=n.createConvolver();o.buffer=n.createBuffer(1,1,n.sampleRate);try{o.buffer=n.createBuffer(1,1,n.sampleRate)}catch{return!1}return!0})(Ze),(p=>()=>{if(p===null)return!1;const n=new p(1,1,44100).createConvolver();try{n.channelCount=1}catch{return!1}return!0})(Ze),vB,(p=>()=>p!==null&&p.hasOwnProperty("isSecureContext"))(an),(p=>()=>{if(p===null)return!1;const n=new p;try{return n.createMediaStreamSource(new MediaStream),!1}catch{return!0}finally{n.close()}})(ai),(p=>()=>{if(p===null)return Promise.resolve(!1);const n=new p(1,1,44100);if(n.createStereoPanner===void 0||n.createConstantSource===void 0)return Promise.resolve(!0);const o=n.createConstantSource(),c=n.createStereoPanner();return o.channelCount=1,o.offset.value=1,c.channelCount=1,o.start(),o.connect(c).connect(n.destination),n.startRendering().then((f=>f.getChannelData(0)[0]!==1))})(Ze),BB);function Ss(p){return p===void 0}function Ot(p){return p!==void 0}function Ip(p){return typeof p=="function"}function Us(p){return typeof p=="number"}function On(p){return Object.prototype.toString.call(p)==="[object Object]"&&p.constructor===Object}function jc(p){return typeof p=="boolean"}function rs(p){return Array.isArray(p)}function cn(p){return typeof p=="string"}function Lr(p){return cn(p)&&/^([a-g]{1}(?:b|#|x|bb)?)(-?[0-9]+)/i.test(p)}function Et(p,n){if(!p)throw new Error(n)}function os(p,n,o=1/0){if(!(n<=p&&p<=o))throw new RangeError(`Value must be within [${n}, ${o}], got: ${p}`)}function Jc(p){p.isOffline||p.state==="running"||EA('The AudioContext is "suspended". Invoke Tone.start() from a user action to start the audio.')}let Qp=!1,Mp=!1;function Zc(p){Qp=p}function Up(p){Ss(p)&&Qp&&!Mp&&(Mp=!0,EA("Events scheduled inside of scheduled callbacks should use the passed in scheduling time. See https://github.com/Tonejs/Tone.js/wiki/Accurate-Timing"))}let th=console;function Ry(p){th=p}function Pp(...p){th.log(...p)}function EA(...p){th.warn(...p)}const Ps=typeof self=="object"?self:null,Oy=Ps&&(Ps.hasOwnProperty("AudioContext")||Ps.hasOwnProperty("webkitAudioContext"));function hn(p,n,o,c){var f,w=arguments.length,B=w<3?n:c;if(typeof Reflect=="object"&&typeof Reflect.decorate=="function")B=Reflect.decorate(p,n,o,c);else for(var b=p.length-1;b>=0;b--)(f=p[b])&&(B=(w<3?f(B):w>3?f(n,o,B):f(n,o))||B);return w>3&&B&&Object.defineProperty(n,o,B),B}function de(p,n,o,c){return new(o||(o=Promise))((function(f,w){function B(S){try{E(c.next(S))}catch(Q){w(Q)}}function b(S){try{E(c.throw(S))}catch(Q){w(Q)}}function E(S){var Q;S.done?f(S.value):(Q=S.value,Q instanceof o?Q:new o((function(M){M(Q)}))).then(B,b)}E((c=c.apply(p,n||[])).next())}))}typeof SuppressedError=="function"&&SuppressedError;class Ny{constructor(n,o,c,f){this._callback=n,this._type=o,this._minimumUpdateInterval=Math.max(128/(f||44100),.001),this.updateInterval=c,this._createClock()}_createWorker(){const n=new Blob([`
			// the initial timeout time
			let timeoutTime =  ${(1e3*this._updateInterval).toFixed(1)};
			// onmessage callback
			self.onmessage = function(msg){
				timeoutTime = parseInt(msg.data);
			};
			// the tick function which posts a message
			// and schedules a new tick
			function tick(){
				setTimeout(tick, timeoutTime);
				self.postMessage('tick');
			}
			// call tick initially
			tick();
			`],{type:"text/javascript"}),o=URL.createObjectURL(n),c=new Worker(o);c.onmessage=this._callback.bind(this),this._worker=c}_createTimeout(){this._timeout=setTimeout((()=>{this._createTimeout(),this._callback()}),1e3*this._updateInterval)}_createClock(){if(this._type==="worker")try{this._createWorker()}catch{this._type="timeout",this._createClock()}else this._type==="timeout"&&this._createTimeout()}_disposeClock(){this._timeout&&clearTimeout(this._timeout),this._worker&&(this._worker.terminate(),this._worker.onmessage=null)}get updateInterval(){return this._updateInterval}set updateInterval(n){var o;this._updateInterval=Math.max(n,this._minimumUpdateInterval),this._type==="worker"&&((o=this._worker)===null||o===void 0||o.postMessage(1e3*this._updateInterval))}get type(){return this._type}set type(n){this._disposeClock(),this._type=n,this._createClock()}dispose(){this._disposeClock()}}function Ki(p){return Dy(p)}function hi(p){return ky(p)}function xa(p){return Ly(p)}function SA(p){return Py(p)}function Vy(p,n){return p==="value"||Ki(n)||hi(n)||(function(o){return o instanceof dp})(n)}function zs(p,...n){if(!n.length)return p;const o=n.shift();if(On(p)&&On(o))for(const c in o)Vy(c,o[c])?p[c]=o[c]:On(o[c])?(p[c]||Object.assign(p,{[c]:{}}),zs(p[c],o[c])):Object.assign(p,{[c]:o[c]});return zs(p,...n)}function et(p,n,o=[],c){const f={},w=Array.from(n);if(On(w[0])&&c&&!Reflect.has(w[0],c)&&(Object.keys(w[0]).some((B=>Reflect.has(p,B)))||(zs(f,{[c]:w[0]}),o.splice(o.indexOf(c),1),w.shift())),w.length===1&&On(w[0]))zs(f,w[0]);else for(let B=0;B<o.length;B++)Ot(w[B])&&(f[o[B]]=w[B]);return zs(p,f)}function $s(p,n){return Ss(p)?n:p}function as(p,n){return n.forEach((o=>{Reflect.has(p,o)&&delete p[o]})),p}class Nn{constructor(){this.debug=!1,this._wasDisposed=!1}static getDefaults(){return{}}log(...n){(this.debug||Ps&&this.toString()===Ps.TONE_DEBUG_CLASS)&&Pp(this,...n)}dispose(){return this._wasDisposed=!0,this}get disposed(){return this._wasDisposed}toString(){return this.name}}Nn.version=h;const eh=1e-6;function FA(p,n){return p>n+eh}function sh(p,n){return FA(p,n)||un(p,n)}function Ea(p,n){return p+eh<n}function un(p,n){return Math.abs(p-n)<eh}function qi(p,n,o){return Math.max(Math.min(p,o),n)}class ks extends Nn{constructor(){super(),this.name="Timeline",this._timeline=[];const n=et(ks.getDefaults(),arguments,["memory"]);this.memory=n.memory,this.increasing=n.increasing}static getDefaults(){return{memory:1/0,increasing:!1}}get length(){return this._timeline.length}add(n){if(Et(Reflect.has(n,"time"),"Timeline: events must have a time attribute"),n.time=n.time.valueOf(),this.increasing&&this.length){const o=this._timeline[this.length-1];Et(sh(n.time,o.time),"The time must be greater than or equal to the last scheduled time"),this._timeline.push(n)}else{const o=this._search(n.time);this._timeline.splice(o+1,0,n)}if(this.length>this.memory){const o=this.length-this.memory;this._timeline.splice(0,o)}return this}remove(n){const o=this._timeline.indexOf(n);return o!==-1&&this._timeline.splice(o,1),this}get(n,o="time"){const c=this._search(n,o);return c!==-1?this._timeline[c]:null}peek(){return this._timeline[0]}shift(){return this._timeline.shift()}getAfter(n,o="time"){const c=this._search(n,o);return c+1<this._timeline.length?this._timeline[c+1]:null}getBefore(n){const o=this._timeline.length;if(o>0&&this._timeline[o-1].time<n)return this._timeline[o-1];const c=this._search(n);return c-1>=0?this._timeline[c-1]:null}cancel(n){if(this._timeline.length>1){let o=this._search(n);if(o>=0)if(un(this._timeline[o].time,n)){for(let c=o;c>=0&&un(this._timeline[c].time,n);c--)o=c;this._timeline=this._timeline.slice(0,o)}else this._timeline=this._timeline.slice(0,o+1);else this._timeline=[]}else this._timeline.length===1&&sh(this._timeline[0].time,n)&&(this._timeline=[]);return this}cancelBefore(n){const o=this._search(n);return o>=0&&(this._timeline=this._timeline.slice(o+1)),this}previousEvent(n){const o=this._timeline.indexOf(n);return o>0?this._timeline[o-1]:null}_search(n,o="time"){if(this._timeline.length===0)return-1;let c=0;const f=this._timeline.length;let w=f;if(f>0&&this._timeline[f-1][o]<=n)return f-1;for(;c<w;){let B=Math.floor(c+(w-c)/2);const b=this._timeline[B],E=this._timeline[B+1];if(un(b[o],n)){for(let S=B;S<this._timeline.length&&un(this._timeline[S][o],n);S++)B=S;return B}if(Ea(b[o],n)&&FA(E[o],n))return B;FA(b[o],n)?w=B:c=B+1}return-1}_iterate(n,o=0,c=this._timeline.length-1){this._timeline.slice(o,c+1).forEach(n)}forEach(n){return this._iterate(n),this}forEachBefore(n,o){const c=this._search(n);return c!==-1&&this._iterate(o,0,c),this}forEachAfter(n,o){const c=this._search(n);return this._iterate(o,c+1),this}forEachBetween(n,o,c){let f=this._search(n),w=this._search(o);return f!==-1&&w!==-1?(this._timeline[f].time!==n&&(f+=1),this._timeline[w].time===o&&(w-=1),this._iterate(c,f,w)):f===-1&&this._iterate(c,0,w),this}forEachFrom(n,o){let c=this._search(n);for(;c>=0&&this._timeline[c].time>=n;)c--;return this._iterate(o,c+1),this}forEachAtTime(n,o){const c=this._search(n);if(c!==-1&&un(this._timeline[c].time,n)){let f=c;for(let w=c;w>=0&&un(this._timeline[w].time,n);w--)f=w;this._iterate((w=>{o(w)}),f,c)}return this}dispose(){return super.dispose(),this._timeline=[],this}}const kp=[];function Sa(p){kp.push(p)}const Dp=[];function Fa(p){Dp.push(p)}class TA extends Nn{constructor(){super(...arguments),this.name="Emitter"}on(n,o){return n.split(/\W+/).forEach((c=>{Ss(this._events)&&(this._events={}),this._events.hasOwnProperty(c)||(this._events[c]=[]),this._events[c].push(o)})),this}once(n,o){const c=(...f)=>{o(...f),this.off(n,c)};return this.on(n,c),this}off(n,o){return n.split(/\W+/).forEach((c=>{if(Ss(this._events)&&(this._events={}),this._events.hasOwnProperty(c))if(Ss(o))this._events[c]=[];else{const f=this._events[c];for(let w=f.length-1;w>=0;w--)f[w]===o&&f.splice(w,1)}})),this}emit(n,...o){if(this._events&&this._events.hasOwnProperty(n)){const c=this._events[n].slice(0);for(let f=0,w=c.length;f<w;f++)c[f].apply(this,o)}return this}static mixin(n){["on","once","off","emit"].forEach((o=>{const c=Object.getOwnPropertyDescriptor(TA.prototype,o);Object.defineProperty(n.prototype,o,c)}))}dispose(){return super.dispose(),this._events=void 0,this}}class nh extends TA{constructor(){super(...arguments),this.isOffline=!1}toJSON(){return{}}}class IA extends nh{constructor(){var n,o;super(),this.name="Context",this._constants=new Map,this._timeouts=new ks,this._timeoutIds=0,this._initialized=!1,this._closeStarted=!1,this.isOffline=!1,this._workletPromise=null;const c=et(IA.getDefaults(),arguments,["context"]);c.context?(this._context=c.context,this._latencyHint=((n=arguments[0])===null||n===void 0?void 0:n.latencyHint)||""):(this._context=(function(f){return new Cy(f)})({latencyHint:c.latencyHint}),this._latencyHint=c.latencyHint),this._ticker=new Ny(this.emit.bind(this,"tick"),c.clockSource,c.updateInterval,this._context.sampleRate),this.on("tick",this._timeoutLoop.bind(this)),this._context.onstatechange=()=>{this.emit("statechange",this.state)},this[!((o=arguments[0])===null||o===void 0)&&o.hasOwnProperty("updateInterval")?"_lookAhead":"lookAhead"]=c.lookAhead}static getDefaults(){return{clockSource:"worker",latencyHint:"interactive",lookAhead:.1,updateInterval:.05}}initialize(){var n;return this._initialized||(n=this,kp.forEach((o=>o(n))),this._initialized=!0),this}createAnalyser(){return this._context.createAnalyser()}createOscillator(){return this._context.createOscillator()}createBufferSource(){return this._context.createBufferSource()}createBiquadFilter(){return this._context.createBiquadFilter()}createBuffer(n,o,c){return this._context.createBuffer(n,o,c)}createChannelMerger(n){return this._context.createChannelMerger(n)}createChannelSplitter(n){return this._context.createChannelSplitter(n)}createConstantSource(){return this._context.createConstantSource()}createConvolver(){return this._context.createConvolver()}createDelay(n){return this._context.createDelay(n)}createDynamicsCompressor(){return this._context.createDynamicsCompressor()}createGain(){return this._context.createGain()}createIIRFilter(n,o){return this._context.createIIRFilter(n,o)}createPanner(){return this._context.createPanner()}createPeriodicWave(n,o,c){return this._context.createPeriodicWave(n,o,c)}createStereoPanner(){return this._context.createStereoPanner()}createWaveShaper(){return this._context.createWaveShaper()}createMediaStreamSource(n){return Et(SA(this._context),"Not available if OfflineAudioContext"),this._context.createMediaStreamSource(n)}createMediaElementSource(n){return Et(SA(this._context),"Not available if OfflineAudioContext"),this._context.createMediaElementSource(n)}createMediaStreamDestination(){return Et(SA(this._context),"Not available if OfflineAudioContext"),this._context.createMediaStreamDestination()}decodeAudioData(n){return this._context.decodeAudioData(n)}get currentTime(){return this._context.currentTime}get state(){return this._context.state}get sampleRate(){return this._context.sampleRate}get listener(){return this.initialize(),this._listener}set listener(n){Et(!this._initialized,"The listener cannot be set after initialization."),this._listener=n}get transport(){return this.initialize(),this._transport}set transport(n){Et(!this._initialized,"The transport cannot be set after initialization."),this._transport=n}get draw(){return this.initialize(),this._draw}set draw(n){Et(!this._initialized,"Draw cannot be set after initialization."),this._draw=n}get destination(){return this.initialize(),this._destination}set destination(n){Et(!this._initialized,"The destination cannot be set after initialization."),this._destination=n}createAudioWorkletNode(n,o){return(function(c,f,w){return Et(Ot(Tp),"AudioWorkletNode only works in a secure context (https or localhost)"),new(c instanceof(Ps==null?void 0:Ps.BaseAudioContext)?Ps==null?void 0:Ps.AudioWorkletNode:Tp)(c,f,w)})(this.rawContext,n,o)}addAudioWorkletModule(n){return de(this,void 0,void 0,(function*(){Et(Ot(this.rawContext.audioWorklet),"AudioWorkletNode is only available in a secure context (https or localhost)"),this._workletPromise||(this._workletPromise=this.rawContext.audioWorklet.addModule(n)),yield this._workletPromise}))}workletsAreReady(){return de(this,void 0,void 0,(function*(){(yield this._workletPromise)?this._workletPromise:Promise.resolve()}))}get updateInterval(){return this._ticker.updateInterval}set updateInterval(n){this._ticker.updateInterval=n}get clockSource(){return this._ticker.type}set clockSource(n){this._ticker.type=n}get lookAhead(){return this._lookAhead}set lookAhead(n){this._lookAhead=n,this.updateInterval=n?n/2:.01}get latencyHint(){return this._latencyHint}get rawContext(){return this._context}now(){return this._context.currentTime+this._lookAhead}immediate(){return this._context.currentTime}resume(){return SA(this._context)?this._context.resume():Promise.resolve()}close(){return de(this,void 0,void 0,(function*(){var n;SA(this._context)&&this.state!=="closed"&&!this._closeStarted&&(this._closeStarted=!0,yield this._context.close()),this._initialized&&(n=this,Dp.forEach((o=>o(n))))}))}getConstant(n){if(this._constants.has(n))return this._constants.get(n);{const o=this._context.createBuffer(1,128,this._context.sampleRate),c=o.getChannelData(0);for(let w=0;w<c.length;w++)c[w]=n;const f=this._context.createBufferSource();return f.channelCount=1,f.channelCountMode="explicit",f.buffer=o,f.loop=!0,f.start(0),this._constants.set(n,f),f}}dispose(){return super.dispose(),this._ticker.dispose(),this._timeouts.dispose(),Object.keys(this._constants).map((n=>this._constants[n].disconnect())),this.close(),this}_timeoutLoop(){const n=this.now();let o=this._timeouts.peek();for(;this._timeouts.length&&o&&o.time<=n;)o.callback(),this._timeouts.shift(),o=this._timeouts.peek()}setTimeout(n,o){this._timeoutIds++;const c=this.now();return this._timeouts.add({callback:n,id:this._timeoutIds,time:c+o}),this._timeoutIds}clearTimeout(n){return this._timeouts.forEach((o=>{o.id===n&&this._timeouts.remove(o)})),this}clearInterval(n){return this.clearTimeout(n)}setInterval(n,o){const c=++this._timeoutIds,f=()=>{const w=this.now();this._timeouts.add({callback:()=>{n(),f()},id:c,time:w+o})};return f(),c}}function Ft(p,n){rs(n)?n.forEach((o=>Ft(p,o))):Object.defineProperty(p,n,{enumerable:!0,writable:!1})}function Hr(p,n){rs(n)?n.forEach((o=>Hr(p,o))):Object.defineProperty(p,n,{writable:!0})}const Wt=()=>{};class Jt extends Nn{constructor(){super(),this.name="ToneAudioBuffer",this.onload=Wt;const n=et(Jt.getDefaults(),arguments,["url","onload","onerror"]);this.reverse=n.reverse,this.onload=n.onload,cn(n.url)?this.load(n.url).catch(n.onerror):n.url&&this.set(n.url)}static getDefaults(){return{onerror:Wt,onload:Wt,reverse:!1}}get sampleRate(){return this._buffer?this._buffer.sampleRate:we().sampleRate}set(n){return n instanceof Jt?n.loaded?this._buffer=n.get():n.onload=()=>{this.set(n),this.onload(this)}:this._buffer=n,this._reversed&&this._reverse(),this}get(){return this._buffer}load(n){return de(this,void 0,void 0,(function*(){const o=Jt.load(n).then((c=>{this.set(c),this.onload(this)}));Jt.downloads.push(o);try{yield o}finally{const c=Jt.downloads.indexOf(o);Jt.downloads.splice(c,1)}return this}))}dispose(){return super.dispose(),this._buffer=void 0,this}fromArray(n){const o=rs(n)&&n[0].length>0,c=o?n.length:1,f=o?n[0].length:n.length,w=we(),B=w.createBuffer(c,f,w.sampleRate),b=o||c!==1?n:[n];for(let E=0;E<c;E++)B.copyToChannel(b[E],E);return this._buffer=B,this}toMono(n){if(Us(n))this.fromArray(this.toArray(n));else{let o=new Float32Array(this.length);const c=this.numberOfChannels;for(let f=0;f<c;f++){const w=this.toArray(f);for(let B=0;B<w.length;B++)o[B]+=w[B]}o=o.map((f=>f/c)),this.fromArray(o)}return this}toArray(n){if(Us(n))return this.getChannelData(n);if(this.numberOfChannels===1)return this.toArray(0);{const o=[];for(let c=0;c<this.numberOfChannels;c++)o[c]=this.getChannelData(c);return o}}getChannelData(n){return this._buffer?this._buffer.getChannelData(n):new Float32Array(0)}slice(n,o=this.duration){Et(this.loaded,"Buffer is not loaded");const c=Math.floor(n*this.sampleRate),f=Math.floor(o*this.sampleRate);Et(c<f,"The start time must be less than the end time");const w=f-c,B=we().createBuffer(this.numberOfChannels,w,this.sampleRate);for(let b=0;b<this.numberOfChannels;b++)B.copyToChannel(this.getChannelData(b).subarray(c,f),b);return new Jt(B)}_reverse(){if(this.loaded)for(let n=0;n<this.numberOfChannels;n++)this.getChannelData(n).reverse();return this}get loaded(){return this.length>0}get duration(){return this._buffer?this._buffer.duration:0}get length(){return this._buffer?this._buffer.length:0}get numberOfChannels(){return this._buffer?this._buffer.numberOfChannels:0}get reverse(){return this._reversed}set reverse(n){this._reversed!==n&&(this._reversed=n,this._reverse())}static fromArray(n){return new Jt().fromArray(n)}static fromUrl(n){return de(this,void 0,void 0,(function*(){return yield new Jt().load(n)}))}static load(n){return de(this,void 0,void 0,(function*(){const o=n.match(/\[([^\]\[]+\|.+)\]$/);if(o){const b=o[1].split("|");let E=b[0];for(const S of b)if(Jt.supportsType(S)){E=S;break}n=n.replace(o[0],E)}const c=Jt.baseUrl===""||Jt.baseUrl.endsWith("/")?Jt.baseUrl:Jt.baseUrl+"/",f=document.createElement("a");f.href=c+n,f.pathname=(f.pathname+f.hash).split("/").map(encodeURIComponent).join("/");const w=yield fetch(f.href);if(!w.ok)throw new Error(`could not load url: ${n}`);const B=yield w.arrayBuffer();return yield we().decodeAudioData(B)}))}static supportsType(n){const o=n.split("."),c=o[o.length-1];return document.createElement("audio").canPlayType("audio/"+c)!==""}static loaded(){return de(this,void 0,void 0,(function*(){for(yield Promise.resolve();Jt.downloads.length;)yield Jt.downloads[0]}))}}Jt.baseUrl="",Jt.downloads=[];class QA extends IA{constructor(){var n,o,c;super({clockSource:"offline",context:xa(arguments[0])?arguments[0]:(n=arguments[0],o=arguments[1]*arguments[2],c=arguments[2],new Uy(n,o,c)),lookAhead:0,updateInterval:xa(arguments[0])?128/arguments[0].sampleRate:128/arguments[2]}),this.name="OfflineContext",this._currentTime=0,this.isOffline=!0,this._duration=xa(arguments[0])?arguments[0].length/arguments[0].sampleRate:arguments[1]}now(){return this._currentTime}get currentTime(){return this._currentTime}_renderClock(n){return de(this,void 0,void 0,(function*(){let o=0;for(;this._duration-this._currentTime>=0;){this.emit("tick"),this._currentTime+=128/this.sampleRate,o++;const c=Math.floor(this.sampleRate/128);n&&o%c==0&&(yield new Promise((f=>setTimeout(f,1))))}}))}render(){return de(this,arguments,void 0,(function*(n=!0){yield this.workletsAreReady(),yield this._renderClock(n);const o=yield this._context.startRendering();return new Jt(o)}))}close(){return Promise.resolve()}}const Lp=new class extends nh{constructor(){super(...arguments),this.lookAhead=0,this.latencyHint=0,this.isOffline=!1}createAnalyser(){return{}}createOscillator(){return{}}createBufferSource(){return{}}createBiquadFilter(){return{}}createBuffer(p,n,o){return{}}createChannelMerger(p){return{}}createChannelSplitter(p){return{}}createConstantSource(){return{}}createConvolver(){return{}}createDelay(p){return{}}createDynamicsCompressor(){return{}}createGain(){return{}}createIIRFilter(p,n){return{}}createPanner(){return{}}createPeriodicWave(p,n,o){return{}}createStereoPanner(){return{}}createWaveShaper(){return{}}createMediaStreamSource(p){return{}}createMediaElementSource(p){return{}}createMediaStreamDestination(){return{}}decodeAudioData(p){return Promise.resolve({})}createAudioWorkletNode(p,n){return{}}get rawContext(){return{}}addAudioWorkletModule(p){return de(this,void 0,void 0,(function*(){return Promise.resolve()}))}resume(){return Promise.resolve()}setTimeout(p,n){return 0}clearTimeout(p){return this}setInterval(p,n){return 0}clearInterval(p){return this}getConstant(p){return{}}get currentTime(){return 0}get state(){return{}}get sampleRate(){return 0}get listener(){return{}}get transport(){return{}}get draw(){return{}}set draw(p){}get destination(){return{}}set destination(p){}now(){return 0}immediate(){return 0}};let Rr=Lp;function we(){return Rr===Lp&&Oy&&Ta(new IA),Rr}function Ta(p,n=!1){n&&Rr.dispose(),Rr=SA(p)?new IA(p):xa(p)?new QA(p):p}function Wy(){return Rr.resume()}if(Ps&&!Ps.TONE_SILENCE_LOGGING){const n=` * Tone.js v${h} * `;console.log(`%c${n}`,"background: #000; color: #fff")}function MA(p){return Math.pow(10,p/20)}function Or(p){return Math.log(p)/Math.LN10*20}function UA(p){return Math.pow(2,p/12)}let Ia=440;function ui(p){return Math.round(Hp(p))}function Hp(p){return 69+12*Math.log2(p/Ia)}function ih(p){return Ia*Math.pow(2,(p-69)/12)}class Ah extends Nn{constructor(n,o,c){super(),this.defaultUnits="s",this._val=o,this._units=c,this.context=n,this._expressions=this._getExpressions()}_getExpressions(){return{hz:{method:n=>this._frequencyToUnits(parseFloat(n)),regexp:/^(\d+(?:\.\d+)?)hz$/i},i:{method:n=>this._ticksToUnits(parseInt(n,10)),regexp:/^(\d+)i$/i},m:{method:n=>this._beatsToUnits(parseInt(n,10)*this._getTimeSignature()),regexp:/^(\d+)m$/i},n:{method:(n,o)=>{const c=parseInt(n,10),f=o==="."?1.5:1;return c===1?this._beatsToUnits(this._getTimeSignature())*f:this._beatsToUnits(4/c)*f},regexp:/^(\d+)n(\.?)$/i},number:{method:n=>this._expressions[this.defaultUnits].method.call(this,n),regexp:/^(\d+(?:\.\d+)?)$/},s:{method:n=>this._secondsToUnits(parseFloat(n)),regexp:/^(\d+(?:\.\d+)?)s$/},samples:{method:n=>parseInt(n,10)/this.context.sampleRate,regexp:/^(\d+)samples$/},t:{method:n=>{const o=parseInt(n,10);return this._beatsToUnits(8/(3*Math.floor(o)))},regexp:/^(\d+)t$/i},tr:{method:(n,o,c)=>{let f=0;return n&&n!=="0"&&(f+=this._beatsToUnits(this._getTimeSignature()*parseFloat(n))),o&&o!=="0"&&(f+=this._beatsToUnits(parseFloat(o))),c&&c!=="0"&&(f+=this._beatsToUnits(parseFloat(c)/4)),f},regexp:/^(\d+(?:\.\d+)?):(\d+(?:\.\d+)?):?(\d+(?:\.\d+)?)?$/}}}valueOf(){if(this._val instanceof Ah&&this.fromType(this._val),Ss(this._val))return this._noArg();if(cn(this._val)&&Ss(this._units)){for(const n in this._expressions)if(this._expressions[n].regexp.test(this._val.trim())){this._units=n;break}}else if(On(this._val)){let n=0;for(const o in this._val)if(Ot(this._val[o])){const c=this._val[o];n+=new this.constructor(this.context,o).valueOf()*c}return n}if(Ot(this._units)){const n=this._expressions[this._units],o=this._val.toString().trim().match(n.regexp);return o?n.method.apply(this,o.slice(1)):n.method.call(this,this._val)}return cn(this._val)?parseFloat(this._val):this._val}_frequencyToUnits(n){return 1/n}_beatsToUnits(n){return 60/this._getBpm()*n}_secondsToUnits(n){return n}_ticksToUnits(n){return n*this._beatsToUnits(1)/this._getPPQ()}_noArg(){return this._now()}_getBpm(){return this.context.transport.bpm.value}_getTimeSignature(){return this.context.transport.timeSignature}_getPPQ(){return this.context.transport.PPQ}fromType(n){switch(this._units=void 0,this.defaultUnits){case"s":this._val=n.toSeconds();break;case"i":this._val=n.toTicks();break;case"hz":this._val=n.toFrequency();break;case"midi":this._val=n.toMidi()}return this}toFrequency(){return 1/this.toSeconds()}toSamples(){return this.toSeconds()*this.context.sampleRate}toMilliseconds(){return 1e3*this.toSeconds()}}class Ds extends Ah{constructor(){super(...arguments),this.name="TimeClass"}_getExpressions(){return Object.assign(super._getExpressions(),{now:{method:n=>this._now()+new this.constructor(this.context,n).valueOf(),regexp:/^\+(.+)/},quantize:{method:n=>{const o=new Ds(this.context,n).valueOf();return this._secondsToUnits(this.context.transport.nextSubdivision(o))},regexp:/^@(.+)/}})}quantize(n,o=1){const c=new this.constructor(this.context,n).valueOf(),f=this.valueOf();return f+(Math.round(f/c)*c-f)*o}toNotation(){const n=this.toSeconds(),o=["1m"];for(let w=1;w<9;w++){const B=Math.pow(2,w);o.push(B+"n."),o.push(B+"n"),o.push(B+"t")}o.push("0");let c=o[0],f=new Ds(this.context,o[0]).toSeconds();return o.forEach((w=>{const B=new Ds(this.context,w).toSeconds();Math.abs(B-n)<Math.abs(f-n)&&(c=w,f=B)})),c}toBarsBeatsSixteenths(){const n=this._beatsToUnits(1);let o=this.valueOf()/n;o=parseFloat(o.toFixed(4));const c=Math.floor(o/this._getTimeSignature());let f=o%1*4;o=Math.floor(o)%this._getTimeSignature();const w=f.toString();return w.length>3&&(f=parseFloat(parseFloat(w).toFixed(3))),[c,o,f].join(":")}toTicks(){const n=this._beatsToUnits(1);return this.valueOf()/n*this._getPPQ()}toSeconds(){return this.valueOf()}toMidi(){return ui(this.toFrequency())}_now(){return this.context.now()}}function Gy(p,n){return new Ds(we(),p,n)}class Bs extends Ds{constructor(){super(...arguments),this.name="Frequency",this.defaultUnits="hz"}static get A4(){return Ia}static set A4(n){(function(o){Ia=o})(n)}_getExpressions(){return Object.assign({},super._getExpressions(),{midi:{regexp:/^(\d+(?:\.\d+)?midi)/,method(n){return this.defaultUnits==="midi"?n:Bs.mtof(n)}},note:{regexp:/^([a-g]{1}(?:b|#|##|x|bb|###|#x|x#|bbb)?)(-?[0-9]+)/i,method(n,o){const c=Ky[n.toLowerCase()]+12*(parseInt(o,10)+1);return this.defaultUnits==="midi"?c:Bs.mtof(c)}},tr:{regexp:/^(\d+(?:\.\d+)?):(\d+(?:\.\d+)?):?(\d+(?:\.\d+)?)?/,method(n,o,c){let f=1;return n&&n!=="0"&&(f*=this._beatsToUnits(this._getTimeSignature()*parseFloat(n))),o&&o!=="0"&&(f*=this._beatsToUnits(parseFloat(o))),c&&c!=="0"&&(f*=this._beatsToUnits(parseFloat(c)/4)),f}}})}transpose(n){return new Bs(this.context,this.valueOf()*UA(n))}harmonize(n){return n.map((o=>this.transpose(o)))}toMidi(){return ui(this.valueOf())}toNote(){const n=this.toFrequency(),o=Math.log2(n/Bs.A4);let c=Math.round(12*o)+57;const f=Math.floor(c/12);return f<0&&(c+=-12*f),qy[c%12]+f.toString()}toSeconds(){return 1/super.toSeconds()}toTicks(){const n=this._beatsToUnits(1),o=this.valueOf()/n;return Math.floor(o*this._getPPQ())}_noArg(){return 0}_frequencyToUnits(n){return n}_ticksToUnits(n){return 1/(60*n/(this._getBpm()*this._getPPQ()))}_beatsToUnits(n){return 1/super._beatsToUnits(n)}_secondsToUnits(n){return 1/n}static mtof(n){return ih(n)}static ftom(n){return ui(n)}}const Ky={cbbb:-3,cbb:-2,cb:-1,c:0,"c#":1,cx:2,"c##":2,"c###":3,"cx#":3,"c#x":3,dbbb:-1,dbb:0,db:1,d:2,"d#":3,dx:4,"d##":4,"d###":5,"dx#":5,"d#x":5,ebbb:1,ebb:2,eb:3,e:4,"e#":5,ex:6,"e##":6,"e###":7,"ex#":7,"e#x":7,fbbb:2,fbb:3,fb:4,f:5,"f#":6,fx:7,"f##":7,"f###":8,"fx#":8,"f#x":8,gbbb:4,gbb:5,gb:6,g:7,"g#":8,gx:9,"g##":9,"g###":10,"gx#":10,"g#x":10,abbb:6,abb:7,ab:8,a:9,"a#":10,ax:11,"a##":11,"a###":12,"ax#":12,"a#x":12,bbbb:8,bbb:9,bb:10,b:11,"b#":12,bx:13,"b##":13,"b###":14,"bx#":14,"b#x":14},qy=["C","C#","D","D#","E","F","F#","G","G#","A","A#","B"];function zy(p,n){return new Bs(we(),p,n)}class Ve extends Ds{constructor(){super(...arguments),this.name="TransportTime"}_now(){return this.context.transport.seconds}}function $y(p,n){return new Ve(we(),p,n)}class ts extends Nn{constructor(){super();const n=et(ts.getDefaults(),arguments,["context"]);this.defaultContext?this.context=this.defaultContext:this.context=n.context}static getDefaults(){return{context:we()}}now(){return this.context.currentTime+this.context.lookAhead}immediate(){return this.context.currentTime}get sampleTime(){return 1/this.context.sampleRate}get blockTime(){return 128/this.context.sampleRate}toSeconds(n){return Up(n),new Ds(this.context,n).toSeconds()}toFrequency(n){return new Bs(this.context,n).toFrequency()}toTicks(n){return new Ve(this.context,n).toTicks()}_getPartialProperties(n){const o=this.get();return Object.keys(o).forEach((c=>{Ss(n[c])&&delete o[c]})),o}get(){const n=this.constructor.getDefaults();return Object.keys(n).forEach((o=>{if(Reflect.has(this,o)){const c=this[o];Ot(c)&&Ot(c.value)&&Ot(c.setValueAtTime)?n[o]=c.value:c instanceof ts?n[o]=c._getPartialProperties(n[o]):rs(c)||Us(c)||cn(c)||jc(c)?n[o]=c:delete n[o]}})),n}set(n){return Object.keys(n).forEach((o=>{Reflect.has(this,o)&&Ot(this[o])&&(this[o]&&Ot(this[o].value)&&Ot(this[o].setValueAtTime)?this[o].value!==n[o]&&(this[o].value=n[o]):this[o]instanceof ts?this[o].set(n[o]):this[o]=n[o])})),this}}class PA extends ks{constructor(n="stopped"){super(),this.name="StateTimeline",this._initial=n,this.setStateAtTime(this._initial,0)}getValueAtTime(n){const o=this.get(n);return o!==null?o.state:this._initial}setStateAtTime(n,o,c){return os(o,0),this.add(Object.assign({},c,{state:n,time:o})),this}getLastState(n,o){for(let c=this._search(o);c>=0;c--){const f=this._timeline[c];if(f.state===n)return f}}getNextState(n,o){const c=this._search(o);if(c!==-1)for(let f=c;f<this._timeline.length;f++){const w=this._timeline[f];if(w.state===n)return w}}}class kt extends ts{constructor(){const n=et(kt.getDefaults(),arguments,["param","units","convert"]);for(super(n),this.name="Param",this.overridden=!1,this._minOutput=1e-7,Et(Ot(n.param)&&(Ki(n.param)||n.param instanceof kt),"param must be an AudioParam");!Ki(n.param);)n.param=n.param._param;this._swappable=!!Ot(n.swappable)&&n.swappable,this._swappable?(this.input=this.context.createGain(),this._param=n.param,this.input.connect(this._param)):this._param=this.input=n.param,this._events=new ks(1e3),this._initialValue=this._param.defaultValue,this.units=n.units,this.convert=n.convert,this._minValue=n.minValue,this._maxValue=n.maxValue,Ot(n.value)&&n.value!==this._toType(this._initialValue)&&this.setValueAtTime(n.value,0)}static getDefaults(){return Object.assign(ts.getDefaults(),{convert:!0,units:"number"})}get value(){const n=this.now();return this.getValueAtTime(n)}set value(n){this.cancelScheduledValues(this.now()),this.setValueAtTime(n,this.now())}get minValue(){return Ot(this._minValue)?this._minValue:this.units==="time"||this.units==="frequency"||this.units==="normalRange"||this.units==="positive"||this.units==="transportTime"||this.units==="ticks"||this.units==="bpm"||this.units==="hertz"||this.units==="samples"?0:this.units==="audioRange"?-1:this.units==="decibels"?-1/0:this._param.minValue}get maxValue(){return Ot(this._maxValue)?this._maxValue:this.units==="normalRange"||this.units==="audioRange"?1:this._param.maxValue}_is(n,o){return this.units===o}_assertRange(n){return Ot(this.maxValue)&&Ot(this.minValue)&&os(n,this._fromType(this.minValue),this._fromType(this.maxValue)),n}_fromType(n){return this.convert&&!this.overridden?this._is(n,"time")?this.toSeconds(n):this._is(n,"decibels")?MA(n):this._is(n,"frequency")?this.toFrequency(n):n:this.overridden?0:n}_toType(n){return this.convert&&this.units==="decibels"?Or(n):n}setValueAtTime(n,o){const c=this.toSeconds(o),f=this._fromType(n);return Et(isFinite(f)&&isFinite(c),`Invalid argument(s) to setValueAtTime: ${JSON.stringify(n)}, ${JSON.stringify(o)}`),this._assertRange(f),this.log(this.units,"setValueAtTime",n,c),this._events.add({time:c,type:"setValueAtTime",value:f}),this._param.setValueAtTime(f,c),this}getValueAtTime(n){const o=Math.max(this.toSeconds(n),0),c=this._events.getAfter(o),f=this._events.get(o);let w=this._initialValue;if(f===null)w=this._initialValue;else if(f.type!=="setTargetAtTime"||c!==null&&c.type!=="setValueAtTime")if(c===null)w=f.value;else if(c.type==="linearRampToValueAtTime"||c.type==="exponentialRampToValueAtTime"){let B=f.value;if(f.type==="setTargetAtTime"){const b=this._events.getBefore(f.time);B=b===null?this._initialValue:b.value}w=c.type==="linearRampToValueAtTime"?this._linearInterpolate(f.time,B,c.time,c.value,o):this._exponentialInterpolate(f.time,B,c.time,c.value,o)}else w=f.value;else{const B=this._events.getBefore(f.time);let b;b=B===null?this._initialValue:B.value,f.type==="setTargetAtTime"&&(w=this._exponentialApproach(f.time,b,f.value,f.constant,o))}return this._toType(w)}setRampPoint(n){n=this.toSeconds(n);let o=this.getValueAtTime(n);return this.cancelAndHoldAtTime(n),this._fromType(o)===0&&(o=this._toType(this._minOutput)),this.setValueAtTime(o,n),this}linearRampToValueAtTime(n,o){const c=this._fromType(n),f=this.toSeconds(o);return Et(isFinite(c)&&isFinite(f),`Invalid argument(s) to linearRampToValueAtTime: ${JSON.stringify(n)}, ${JSON.stringify(o)}`),this._assertRange(c),this._events.add({time:f,type:"linearRampToValueAtTime",value:c}),this.log(this.units,"linearRampToValueAtTime",n,f),this._param.linearRampToValueAtTime(c,f),this}exponentialRampToValueAtTime(n,o){let c=this._fromType(n);c=un(c,0)?this._minOutput:c,this._assertRange(c);const f=this.toSeconds(o);return Et(isFinite(c)&&isFinite(f),`Invalid argument(s) to exponentialRampToValueAtTime: ${JSON.stringify(n)}, ${JSON.stringify(o)}`),this._events.add({time:f,type:"exponentialRampToValueAtTime",value:c}),this.log(this.units,"exponentialRampToValueAtTime",n,f),this._param.exponentialRampToValueAtTime(c,f),this}exponentialRampTo(n,o,c){return c=this.toSeconds(c),this.setRampPoint(c),this.exponentialRampToValueAtTime(n,c+this.toSeconds(o)),this}linearRampTo(n,o,c){return c=this.toSeconds(c),this.setRampPoint(c),this.linearRampToValueAtTime(n,c+this.toSeconds(o)),this}targetRampTo(n,o,c){return c=this.toSeconds(c),this.setRampPoint(c),this.exponentialApproachValueAtTime(n,c,o),this}exponentialApproachValueAtTime(n,o,c){o=this.toSeconds(o),c=this.toSeconds(c);const f=Math.log(c+1)/Math.log(200);return this.setTargetAtTime(n,o,f),this.cancelAndHoldAtTime(o+.9*c),this.linearRampToValueAtTime(n,o+c),this}setTargetAtTime(n,o,c){const f=this._fromType(n);Et(isFinite(c)&&c>0,"timeConstant must be a number greater than 0");const w=this.toSeconds(o);return this._assertRange(f),Et(isFinite(f)&&isFinite(w),`Invalid argument(s) to setTargetAtTime: ${JSON.stringify(n)}, ${JSON.stringify(o)}`),this._events.add({constant:c,time:w,type:"setTargetAtTime",value:f}),this.log(this.units,"setTargetAtTime",n,w,c),this._param.setTargetAtTime(f,w,c),this}setValueCurveAtTime(n,o,c,f=1){c=this.toSeconds(c),o=this.toSeconds(o);const w=this._fromType(n[0])*f;this.setValueAtTime(this._toType(w),o);const B=c/(n.length-1);for(let b=1;b<n.length;b++){const E=this._fromType(n[b])*f;this.linearRampToValueAtTime(this._toType(E),o+b*B)}return this}cancelScheduledValues(n){const o=this.toSeconds(n);return Et(isFinite(o),`Invalid argument to cancelScheduledValues: ${JSON.stringify(n)}`),this._events.cancel(o),this._param.cancelScheduledValues(o),this.log(this.units,"cancelScheduledValues",o),this}cancelAndHoldAtTime(n){const o=this.toSeconds(n),c=this._fromType(this.getValueAtTime(o));Et(isFinite(o),`Invalid argument to cancelAndHoldAtTime: ${JSON.stringify(n)}`),this.log(this.units,"cancelAndHoldAtTime",o,"value="+c);const f=this._events.get(o),w=this._events.getAfter(o);return f&&un(f.time,o)?w?(this._param.cancelScheduledValues(w.time),this._events.cancel(w.time)):(this._param.cancelAndHoldAtTime(o),this._events.cancel(o+this.sampleTime)):w&&(this._param.cancelScheduledValues(w.time),this._events.cancel(w.time),w.type==="linearRampToValueAtTime"?this.linearRampToValueAtTime(this._toType(c),o):w.type==="exponentialRampToValueAtTime"&&this.exponentialRampToValueAtTime(this._toType(c),o)),this._events.add({time:o,type:"setValueAtTime",value:c}),this._param.setValueAtTime(c,o),this}rampTo(n,o=.1,c){return this.units==="frequency"||this.units==="bpm"||this.units==="decibels"?this.exponentialRampTo(n,o,c):this.linearRampTo(n,o,c),this}apply(n){const o=this.context.currentTime;n.setValueAtTime(this.getValueAtTime(o),o);const c=this._events.get(o);if(c&&c.type==="setTargetAtTime"){const f=this._events.getAfter(c.time),w=f?f.time:o+2,B=(w-o)/10;for(let b=o;b<w;b+=B)n.linearRampToValueAtTime(this.getValueAtTime(b),b)}return this._events.forEachAfter(this.context.currentTime,(f=>{f.type==="cancelScheduledValues"?n.cancelScheduledValues(f.time):f.type==="setTargetAtTime"?n.setTargetAtTime(f.value,f.time,f.constant):n[f.type](f.value,f.time)})),this}setParam(n){Et(this._swappable,"The Param must be assigned as 'swappable' in the constructor");const o=this.input;return o.disconnect(this._param),this.apply(n),this._param=n,o.connect(this._param),this}dispose(){return super.dispose(),this._events.dispose(),this}get defaultValue(){return this._toType(this._param.defaultValue)}_exponentialApproach(n,o,c,f,w){return c+(o-c)*Math.exp(-(w-n)/f)}_linearInterpolate(n,o,c,f,w){return o+(w-n)/(c-n)*(f-o)}_exponentialInterpolate(n,o,c,f,w){return o*Math.pow(f/o,(w-n)/(c-n))}}class at extends ts{constructor(){super(...arguments),this._internalChannels=[]}get numberOfInputs(){return Ot(this.input)?Ki(this.input)||this.input instanceof kt?1:this.input.numberOfInputs:0}get numberOfOutputs(){return Ot(this.output)?this.output.numberOfOutputs:0}_isAudioNode(n){return Ot(n)&&(n instanceof at||hi(n))}_getInternalNodes(){const n=this._internalChannels.slice(0);return this._isAudioNode(this.input)&&n.push(this.input),this._isAudioNode(this.output)&&this.input!==this.output&&n.push(this.output),n}_setChannelProperties(n){this._getInternalNodes().forEach((o=>{o.channelCount=n.channelCount,o.channelCountMode=n.channelCountMode,o.channelInterpretation=n.channelInterpretation}))}_getChannelProperties(){const n=this._getInternalNodes();Et(n.length>0,"ToneAudioNode does not have any internal nodes");const o=n[0];return{channelCount:o.channelCount,channelCountMode:o.channelCountMode,channelInterpretation:o.channelInterpretation}}get channelCount(){return this._getChannelProperties().channelCount}set channelCount(n){const o=this._getChannelProperties();this._setChannelProperties(Object.assign(o,{channelCount:n}))}get channelCountMode(){return this._getChannelProperties().channelCountMode}set channelCountMode(n){const o=this._getChannelProperties();this._setChannelProperties(Object.assign(o,{channelCountMode:n}))}get channelInterpretation(){return this._getChannelProperties().channelInterpretation}set channelInterpretation(n){const o=this._getChannelProperties();this._setChannelProperties(Object.assign(o,{channelInterpretation:n}))}connect(n,o=0,c=0){return ys(this,n,o,c),this}toDestination(){return this.connect(this.context.destination),this}toMaster(){return EA("toMaster() has been renamed toDestination()"),this.toDestination()}disconnect(n,o=0,c=0){return rh(this,n,o,c),this}chain(...n){return Ls(this,...n),this}fan(...n){return n.forEach((o=>this.connect(o))),this}dispose(){return super.dispose(),Ot(this.input)&&(this.input instanceof at?this.input.dispose():hi(this.input)&&this.input.disconnect()),Ot(this.output)&&(this.output instanceof at?this.output.dispose():hi(this.output)&&this.output.disconnect()),this._internalChannels=[],this}}function Ls(...p){const n=p.shift();p.reduce(((o,c)=>(o instanceof at?o.connect(c):hi(o)&&ys(o,c),c)),n)}function ys(p,n,o=0,c=0){for(Et(Ot(p),"Cannot connect from undefined node"),Et(Ot(n),"Cannot connect to undefined node"),(n instanceof at||hi(n))&&Et(n.numberOfInputs>0,"Cannot connect to node with no inputs"),Et(p.numberOfOutputs>0,"Cannot connect from node with no outputs");n instanceof at||n instanceof kt;)Ot(n.input)&&(n=n.input);for(;p instanceof at;)Ot(p.output)&&(p=p.output);Ki(n)?p.connect(n,o):p.connect(n,o,c)}function rh(p,n,o=0,c=0){if(Ot(n))for(;n instanceof at;)n=n.input;for(;!hi(p);)Ot(p.output)&&(p=p.output);Ki(n)?p.disconnect(n,o):hi(n)?p.disconnect(n,o,c):p.disconnect()}function Xy(...p){const n=p.pop();Ot(n)&&p.forEach((o=>ys(o,n)))}class xt extends at{constructor(){const n=et(xt.getDefaults(),arguments,["gain","units"]);super(n),this.name="Gain",this._gainNode=this.context.createGain(),this.input=this._gainNode,this.output=this._gainNode,this.gain=new kt({context:this.context,convert:n.convert,param:this._gainNode.gain,units:n.units,value:n.gain,minValue:n.minValue,maxValue:n.maxValue}),Ft(this,"gain")}static getDefaults(){return Object.assign(at.getDefaults(),{convert:!0,gain:1,units:"gain"})}dispose(){return super.dispose(),this._gainNode.disconnect(),this.gain.dispose(),this}}class kA extends at{constructor(n){super(n),this.onended=Wt,this._startTime=-1,this._stopTime=-1,this._timeout=-1,this.output=new xt({context:this.context,gain:0}),this._gainNode=this.output,this.getStateAtTime=function(o){const c=this.toSeconds(o);return this._startTime!==-1&&c>=this._startTime&&(this._stopTime===-1||c<=this._stopTime)?"started":"stopped"},this._fadeIn=n.fadeIn,this._fadeOut=n.fadeOut,this._curve=n.curve,this.onended=n.onended}static getDefaults(){return Object.assign(at.getDefaults(),{curve:"linear",fadeIn:0,fadeOut:0,onended:Wt})}_startGain(n,o=1){Et(this._startTime===-1,"Source cannot be started more than once");const c=this.toSeconds(this._fadeIn);return this._startTime=n+c,this._startTime=Math.max(this._startTime,this.context.currentTime),c>0?(this._gainNode.gain.setValueAtTime(0,n),this._curve==="linear"?this._gainNode.gain.linearRampToValueAtTime(o,n+c):this._gainNode.gain.exponentialApproachValueAtTime(o,n,c)):this._gainNode.gain.setValueAtTime(o,n),this}stop(n){return this.log("stop",n),this._stopGain(this.toSeconds(n)),this}_stopGain(n){Et(this._startTime!==-1,"'start' must be called before 'stop'"),this.cancelStop();const o=this.toSeconds(this._fadeOut);return this._stopTime=this.toSeconds(n)+o,this._stopTime=Math.max(this._stopTime,this.now()),o>0?this._curve==="linear"?this._gainNode.gain.linearRampTo(0,o,n):this._gainNode.gain.targetRampTo(0,o,n):(this._gainNode.gain.cancelAndHoldAtTime(n),this._gainNode.gain.setValueAtTime(0,n)),this.context.clearTimeout(this._timeout),this._timeout=this.context.setTimeout((()=>{const c=this._curve==="exponential"?2*o:0;this._stopSource(this.now()+c),this._onended()}),this._stopTime-this.context.currentTime),this}_onended(){if(this.onended!==Wt&&(this.onended(this),this.onended=Wt,!this.context.isOffline)){const n=()=>this.dispose();window.requestIdleCallback!==void 0?window.requestIdleCallback(n):setTimeout(n,1e3)}}get state(){return this.getStateAtTime(this.now())}cancelStop(){return this.log("cancelStop"),Et(this._startTime!==-1,"Source is not started"),this._gainNode.gain.cancelScheduledValues(this._startTime+this.sampleTime),this.context.clearTimeout(this._timeout),this._stopTime=-1,this}dispose(){return super.dispose(),this._gainNode.dispose(),this.onended=Wt,this}}class Qa extends kA{constructor(){const n=et(Qa.getDefaults(),arguments,["offset"]);super(n),this.name="ToneConstantSource",this._source=this.context.createConstantSource(),ys(this._source,this._gainNode),this.offset=new kt({context:this.context,convert:n.convert,param:this._source.offset,units:n.units,value:n.offset,minValue:n.minValue,maxValue:n.maxValue})}static getDefaults(){return Object.assign(kA.getDefaults(),{convert:!0,offset:1,units:"number"})}start(n){const o=this.toSeconds(n);return this.log("start",o),this._startGain(o),this._source.start(o),this}_stopSource(n){this._source.stop(n)}dispose(){return super.dispose(),this.state==="started"&&this.stop(),this._source.disconnect(),this.offset.dispose(),this}}class Mt extends at{constructor(){const n=et(Mt.getDefaults(),arguments,["value","units"]);super(n),this.name="Signal",this.override=!0,this.output=this._constantSource=new Qa({context:this.context,convert:n.convert,offset:n.value,units:n.units,minValue:n.minValue,maxValue:n.maxValue}),this._constantSource.start(0),this.input=this._param=this._constantSource.offset}static getDefaults(){return Object.assign(at.getDefaults(),{convert:!0,units:"number",value:0})}connect(n,o=0,c=0){return Nr(this,n,o,c),this}dispose(){return super.dispose(),this._param.dispose(),this._constantSource.dispose(),this}setValueAtTime(n,o){return this._param.setValueAtTime(n,o),this}getValueAtTime(n){return this._param.getValueAtTime(n)}setRampPoint(n){return this._param.setRampPoint(n),this}linearRampToValueAtTime(n,o){return this._param.linearRampToValueAtTime(n,o),this}exponentialRampToValueAtTime(n,o){return this._param.exponentialRampToValueAtTime(n,o),this}exponentialRampTo(n,o,c){return this._param.exponentialRampTo(n,o,c),this}linearRampTo(n,o,c){return this._param.linearRampTo(n,o,c),this}targetRampTo(n,o,c){return this._param.targetRampTo(n,o,c),this}exponentialApproachValueAtTime(n,o,c){return this._param.exponentialApproachValueAtTime(n,o,c),this}setTargetAtTime(n,o,c){return this._param.setTargetAtTime(n,o,c),this}setValueCurveAtTime(n,o,c,f){return this._param.setValueCurveAtTime(n,o,c,f),this}cancelScheduledValues(n){return this._param.cancelScheduledValues(n),this}cancelAndHoldAtTime(n){return this._param.cancelAndHoldAtTime(n),this}rampTo(n,o,c){return this._param.rampTo(n,o,c),this}get value(){return this._param.value}set value(n){this._param.value=n}get convert(){return this._param.convert}set convert(n){this._param.convert=n}get units(){return this._param.units}get overridden(){return this._param.overridden}set overridden(n){this._param.overridden=n}get maxValue(){return this._param.maxValue}get minValue(){return this._param.minValue}apply(n){return this._param.apply(n),this}}function Nr(p,n,o,c){(n instanceof kt||Ki(n)||n instanceof Mt&&n.override)&&(n.cancelScheduledValues(0),n.setValueAtTime(0,0),n instanceof Mt&&(n.overridden=!0)),ys(p,n,o,c)}class oh extends kt{constructor(){const n=et(oh.getDefaults(),arguments,["value"]);super(n),this.name="TickParam",this._events=new ks(1/0),this._multiplier=1,this._multiplier=n.multiplier,this._events.cancel(0),this._events.add({ticks:0,time:0,type:"setValueAtTime",value:this._fromType(n.value)}),this.setValueAtTime(n.value,0)}static getDefaults(){return Object.assign(kt.getDefaults(),{multiplier:1,units:"hertz",value:1})}setTargetAtTime(n,o,c){o=this.toSeconds(o),this.setRampPoint(o);const f=this._fromType(n),w=this._events.get(o),B=Math.round(Math.max(1/c,1));for(let b=0;b<=B;b++){const E=c*b+o,S=this._exponentialApproach(w.time,w.value,f,c,E);this.linearRampToValueAtTime(this._toType(S),E)}return this}setValueAtTime(n,o){const c=this.toSeconds(o);super.setValueAtTime(n,o);const f=this._events.get(c),w=this._events.previousEvent(f),B=this._getTicksUntilEvent(w,c);return f.ticks=Math.max(B,0),this}linearRampToValueAtTime(n,o){const c=this.toSeconds(o);super.linearRampToValueAtTime(n,o);const f=this._events.get(c),w=this._events.previousEvent(f),B=this._getTicksUntilEvent(w,c);return f.ticks=Math.max(B,0),this}exponentialRampToValueAtTime(n,o){o=this.toSeconds(o);const c=this._fromType(n),f=this._events.get(o),w=Math.round(Math.max(10*(o-f.time),1)),B=(o-f.time)/w;for(let b=0;b<=w;b++){const E=B*b+f.time,S=this._exponentialInterpolate(f.time,f.value,o,c,E);this.linearRampToValueAtTime(this._toType(S),E)}return this}_getTicksUntilEvent(n,o){if(n===null)n={ticks:0,time:0,type:"setValueAtTime",value:0};else if(Ss(n.ticks)){const B=this._events.previousEvent(n);n.ticks=this._getTicksUntilEvent(B,n.time)}const c=this._fromType(this.getValueAtTime(n.time));let f=this._fromType(this.getValueAtTime(o));const w=this._events.get(o);return w&&w.time===o&&w.type==="setValueAtTime"&&(f=this._fromType(this.getValueAtTime(o-this.sampleTime))),.5*(o-n.time)*(c+f)+n.ticks}getTicksAtTime(n){const o=this.toSeconds(n),c=this._events.get(o);return Math.max(this._getTicksUntilEvent(c,o),0)}getDurationOfTicks(n,o){const c=this.toSeconds(o),f=this.getTicksAtTime(o);return this.getTimeOfTick(f+n)-c}getTimeOfTick(n){const o=this._events.get(n,"ticks"),c=this._events.getAfter(n,"ticks");if(o&&o.ticks===n)return o.time;if(o&&c&&c.type==="linearRampToValueAtTime"&&o.value!==c.value){const f=this._fromType(this.getValueAtTime(o.time)),w=(this._fromType(this.getValueAtTime(c.time))-f)/(c.time-o.time),B=Math.sqrt(Math.pow(f,2)-2*w*(o.ticks-n)),b=(-f+B)/w;return(b>0?b:(-f-B)/w)+o.time}return o?o.value===0?1/0:o.time+(n-o.ticks)/o.value:n/this._initialValue}ticksToTime(n,o){return this.getDurationOfTicks(n,o)}timeToTicks(n,o){const c=this.toSeconds(o),f=this.toSeconds(n),w=this.getTicksAtTime(c);return this.getTicksAtTime(c+f)-w}_fromType(n){return this.units==="bpm"&&this.multiplier?1/(60/n/this.multiplier):super._fromType(n)}_toType(n){return this.units==="bpm"&&this.multiplier?n/this.multiplier*60:super._toType(n)}get multiplier(){return this._multiplier}set multiplier(n){const o=this.value;this._multiplier=n,this.cancelScheduledValues(0),this.setValueAtTime(o,0)}}class ah extends Mt{constructor(){const n=et(ah.getDefaults(),arguments,["value"]);super(n),this.name="TickSignal",this.input=this._param=new oh({context:this.context,convert:n.convert,multiplier:n.multiplier,param:this._constantSource.offset,units:n.units,value:n.value})}static getDefaults(){return Object.assign(Mt.getDefaults(),{multiplier:1,units:"hertz",value:1})}ticksToTime(n,o){return this._param.ticksToTime(n,o)}timeToTicks(n,o){return this._param.timeToTicks(n,o)}getTimeOfTick(n){return this._param.getTimeOfTick(n)}getDurationOfTicks(n,o){return this._param.getDurationOfTicks(n,o)}getTicksAtTime(n){return this._param.getTicksAtTime(n)}get multiplier(){return this._param.multiplier}set multiplier(n){this._param.multiplier=n}dispose(){return super.dispose(),this._param.dispose(),this}}class lh extends ts{constructor(){const n=et(lh.getDefaults(),arguments,["frequency"]);super(n),this.name="TickSource",this._state=new PA,this._tickOffset=new ks,this._ticksAtTime=new ks,this._secondsAtTime=new ks,this.frequency=new ah({context:this.context,units:n.units,value:n.frequency}),Ft(this,"frequency"),this._state.setStateAtTime("stopped",0),this.setTicksAtTime(0,0)}static getDefaults(){return Object.assign({frequency:1,units:"hertz"},ts.getDefaults())}get state(){return this.getStateAtTime(this.now())}start(n,o){const c=this.toSeconds(n);return this._state.getValueAtTime(c)!=="started"&&(this._state.setStateAtTime("started",c),Ot(o)&&this.setTicksAtTime(o,c),this._ticksAtTime.cancel(c),this._secondsAtTime.cancel(c)),this}stop(n){const o=this.toSeconds(n);if(this._state.getValueAtTime(o)==="stopped"){const c=this._state.get(o);c&&c.time>0&&(this._tickOffset.cancel(c.time),this._state.cancel(c.time))}return this._state.cancel(o),this._state.setStateAtTime("stopped",o),this.setTicksAtTime(0,o),this._ticksAtTime.cancel(o),this._secondsAtTime.cancel(o),this}pause(n){const o=this.toSeconds(n);return this._state.getValueAtTime(o)==="started"&&(this._state.setStateAtTime("paused",o),this._ticksAtTime.cancel(o),this._secondsAtTime.cancel(o)),this}cancel(n){return n=this.toSeconds(n),this._state.cancel(n),this._tickOffset.cancel(n),this._ticksAtTime.cancel(n),this._secondsAtTime.cancel(n),this}getTicksAtTime(n){const o=this.toSeconds(n),c=this._state.getLastState("stopped",o),f=this._ticksAtTime.get(o),w={state:"paused",time:o};this._state.add(w);let B=f||c,b=f?f.ticks:0,E=null;return this._state.forEachBetween(B.time,o+this.sampleTime,(S=>{let Q=B.time;const M=this._tickOffset.get(S.time);M&&M.time>=B.time&&(b=M.ticks,Q=M.time),B.state==="started"&&S.state!=="started"&&(b+=this.frequency.getTicksAtTime(S.time)-this.frequency.getTicksAtTime(Q),S.time!==w.time&&(E={state:S.state,time:S.time,ticks:b})),B=S})),this._state.remove(w),E&&this._ticksAtTime.add(E),b}get ticks(){return this.getTicksAtTime(this.now())}set ticks(n){this.setTicksAtTime(n,this.now())}get seconds(){return this.getSecondsAtTime(this.now())}set seconds(n){const o=this.now(),c=this.frequency.timeToTicks(n,o);this.setTicksAtTime(c,o)}getSecondsAtTime(n){n=this.toSeconds(n);const o=this._state.getLastState("stopped",n),c={state:"paused",time:n};this._state.add(c);const f=this._secondsAtTime.get(n);let w=f||o,B=f?f.seconds:0,b=null;return this._state.forEachBetween(w.time,n+this.sampleTime,(E=>{let S=w.time;const Q=this._tickOffset.get(E.time);Q&&Q.time>=w.time&&(B=Q.seconds,S=Q.time),w.state==="started"&&E.state!=="started"&&(B+=E.time-S,E.time!==c.time&&(b={state:E.state,time:E.time,seconds:B})),w=E})),this._state.remove(c),b&&this._secondsAtTime.add(b),B}setTicksAtTime(n,o){return o=this.toSeconds(o),this._tickOffset.cancel(o),this._tickOffset.add({seconds:this.frequency.getDurationOfTicks(n,o),ticks:n,time:o}),this._ticksAtTime.cancel(o),this._secondsAtTime.cancel(o),this}getStateAtTime(n){return n=this.toSeconds(n),this._state.getValueAtTime(n)}getTimeOfTick(n,o=this.now()){const c=this._tickOffset.get(o),f=this._state.get(o),w=Math.max(c.time,f.time),B=this.frequency.getTicksAtTime(w)+n-c.ticks;return this.frequency.getTimeOfTick(B)}forEachTickBetween(n,o,c){let f=this._state.get(n);this._state.forEachBetween(n,o,(B=>{f&&f.state==="started"&&B.state!=="started"&&this.forEachTickBetween(Math.max(f.time,n),B.time-this.sampleTime,c),f=B}));let w=null;if(f&&f.state==="started"){const B=Math.max(f.time,n),b=this.frequency.getTicksAtTime(B),E=b-this.frequency.getTicksAtTime(f.time);let S=Math.ceil(E)-E;S=un(S,1)?0:S;let Q=this.frequency.getTimeOfTick(b+S);for(;Q<o;){try{c(Q,Math.round(this.getTicksAtTime(Q)))}catch(M){w=M;break}Q+=this.frequency.getDurationOfTicks(1,Q)}}if(w)throw w;return this}dispose(){return super.dispose(),this._state.dispose(),this._tickOffset.dispose(),this._ticksAtTime.dispose(),this._secondsAtTime.dispose(),this.frequency.dispose(),this}}class DA extends ts{constructor(){const n=et(DA.getDefaults(),arguments,["callback","frequency"]);super(n),this.name="Clock",this.callback=Wt,this._lastUpdate=0,this._state=new PA("stopped"),this._boundLoop=this._loop.bind(this),this.callback=n.callback,this._tickSource=new lh({context:this.context,frequency:n.frequency,units:n.units}),this._lastUpdate=0,this.frequency=this._tickSource.frequency,Ft(this,"frequency"),this._state.setStateAtTime("stopped",0),this.context.on("tick",this._boundLoop)}static getDefaults(){return Object.assign(ts.getDefaults(),{callback:Wt,frequency:1,units:"hertz"})}get state(){return this._state.getValueAtTime(this.now())}start(n,o){Jc(this.context);const c=this.toSeconds(n);return this.log("start",c),this._state.getValueAtTime(c)!=="started"&&(this._state.setStateAtTime("started",c),this._tickSource.start(c,o),c<this._lastUpdate&&this.emit("start",c,o)),this}stop(n){const o=this.toSeconds(n);return this.log("stop",o),this._state.cancel(o),this._state.setStateAtTime("stopped",o),this._tickSource.stop(o),o<this._lastUpdate&&this.emit("stop",o),this}pause(n){const o=this.toSeconds(n);return this._state.getValueAtTime(o)==="started"&&(this._state.setStateAtTime("paused",o),this._tickSource.pause(o),o<this._lastUpdate&&this.emit("pause",o)),this}get ticks(){return Math.ceil(this.getTicksAtTime(this.now()))}set ticks(n){this._tickSource.ticks=n}get seconds(){return this._tickSource.seconds}set seconds(n){this._tickSource.seconds=n}getSecondsAtTime(n){return this._tickSource.getSecondsAtTime(n)}setTicksAtTime(n,o){return this._tickSource.setTicksAtTime(n,o),this}getTimeOfTick(n,o=this.now()){return this._tickSource.getTimeOfTick(n,o)}getTicksAtTime(n){return this._tickSource.getTicksAtTime(n)}nextTickTime(n,o){const c=this.toSeconds(o),f=this.getTicksAtTime(c);return this._tickSource.getTimeOfTick(f+n,c)}_loop(){const n=this._lastUpdate,o=this.now();this._lastUpdate=o,this.log("loop",n,o),n!==o&&(this._state.forEachBetween(n,o,(c=>{switch(c.state){case"started":const f=this._tickSource.getTicksAtTime(c.time);this.emit("start",c.time,f);break;case"stopped":c.time!==0&&this.emit("stop",c.time);break;case"paused":this.emit("pause",c.time)}})),this._tickSource.forEachTickBetween(n,o,((c,f)=>{this.callback(c,f)})))}getStateAtTime(n){const o=this.toSeconds(n);return this._state.getValueAtTime(o)}dispose(){return super.dispose(),this.context.off("tick",this._boundLoop),this._tickSource.dispose(),this._state.dispose(),this}}TA.mixin(DA);class Hs extends at{constructor(){const n=et(Hs.getDefaults(),arguments,["delayTime","maxDelay"]);super(n),this.name="Delay";const o=this.toSeconds(n.maxDelay);this._maxDelay=Math.max(o,this.toSeconds(n.delayTime)),this._delayNode=this.input=this.output=this.context.createDelay(o),this.delayTime=new kt({context:this.context,param:this._delayNode.delayTime,units:"time",value:n.delayTime,minValue:0,maxValue:this.maxDelay}),Ft(this,"delayTime")}static getDefaults(){return Object.assign(at.getDefaults(),{delayTime:0,maxDelay:1})}get maxDelay(){return this._maxDelay}dispose(){return super.dispose(),this._delayNode.disconnect(),this.delayTime.dispose(),this}}class Vn extends at{constructor(){const n=et(Vn.getDefaults(),arguments,["volume"]);super(n),this.name="Volume",this.input=this.output=new xt({context:this.context,gain:n.volume,units:"decibels"}),this.volume=this.output.gain,Ft(this,"volume"),this._unmutedVolume=n.volume,this.mute=n.mute}static getDefaults(){return Object.assign(at.getDefaults(),{mute:!1,volume:0})}get mute(){return this.volume.value===-1/0}set mute(n){!this.mute&&n?(this._unmutedVolume=this.volume.value,this.volume.value=-1/0):this.mute&&!n&&(this.volume.value=this._unmutedVolume)}dispose(){return super.dispose(),this.input.dispose(),this.volume.dispose(),this}}class ch extends at{constructor(){const n=et(ch.getDefaults(),arguments);super(n),this.name="Destination",this.input=new Vn({context:this.context}),this.output=new xt({context:this.context}),this.volume=this.input.volume,Ls(this.input,this.output,this.context.rawContext.destination),this.mute=n.mute,this._internalChannels=[this.input,this.context.rawContext.destination,this.output]}static getDefaults(){return Object.assign(at.getDefaults(),{mute:!1,volume:0})}get mute(){return this.input.mute}set mute(n){this.input.mute=n}chain(...n){return this.input.disconnect(),n.unshift(this.input),n.push(this.output),Ls(...n),this}get maxChannelCount(){return this.context.rawContext.destination.maxChannelCount}dispose(){return super.dispose(),this.volume.dispose(),this}}Sa((p=>{p.destination=new ch({context:p})})),Fa((p=>{p.destination.dispose()}));class Yy extends at{constructor(){super(...arguments),this.name="Listener",this.positionX=new kt({context:this.context,param:this.context.rawContext.listener.positionX}),this.positionY=new kt({context:this.context,param:this.context.rawContext.listener.positionY}),this.positionZ=new kt({context:this.context,param:this.context.rawContext.listener.positionZ}),this.forwardX=new kt({context:this.context,param:this.context.rawContext.listener.forwardX}),this.forwardY=new kt({context:this.context,param:this.context.rawContext.listener.forwardY}),this.forwardZ=new kt({context:this.context,param:this.context.rawContext.listener.forwardZ}),this.upX=new kt({context:this.context,param:this.context.rawContext.listener.upX}),this.upY=new kt({context:this.context,param:this.context.rawContext.listener.upY}),this.upZ=new kt({context:this.context,param:this.context.rawContext.listener.upZ})}static getDefaults(){return Object.assign(at.getDefaults(),{positionX:0,positionY:0,positionZ:0,forwardX:0,forwardY:0,forwardZ:-1,upX:0,upY:1,upZ:0})}dispose(){return super.dispose(),this.positionX.dispose(),this.positionY.dispose(),this.positionZ.dispose(),this.forwardX.dispose(),this.forwardY.dispose(),this.forwardZ.dispose(),this.upX.dispose(),this.upY.dispose(),this.upZ.dispose(),this}}function jy(p,n){return de(this,arguments,void 0,(function*(o,c,f=2,w=we().sampleRate){const B=we(),b=new QA(f,c,w);Ta(b),yield o(b);const E=b.render();Ta(B);const S=yield E;return new Jt(S)}))}Sa((p=>{p.listener=new Yy({context:p})})),Fa((p=>{p.listener.dispose()}));class LA extends Nn{constructor(){super(),this.name="ToneAudioBuffers",this._buffers=new Map,this._loadingCount=0;const n=et(LA.getDefaults(),arguments,["urls","onload","baseUrl"],"urls");this.baseUrl=n.baseUrl,Object.keys(n.urls).forEach((o=>{this._loadingCount++;const c=n.urls[o];this.add(o,c,this._bufferLoaded.bind(this,n.onload),n.onerror)}))}static getDefaults(){return{baseUrl:"",onerror:Wt,onload:Wt,urls:{}}}has(n){return this._buffers.has(n.toString())}get(n){return Et(this.has(n),`ToneAudioBuffers has no buffer named: ${n}`),this._buffers.get(n.toString())}_bufferLoaded(n){this._loadingCount--,this._loadingCount===0&&n&&n()}get loaded(){return Array.from(this._buffers).every((([n,o])=>o.loaded))}add(n,o,c=Wt,f=Wt){return cn(o)?(this.baseUrl&&o.trim().substring(0,11).toLowerCase()==="data:audio/"&&(this.baseUrl=""),this._buffers.set(n.toString(),new Jt(this.baseUrl+o,c,f))):this._buffers.set(n.toString(),new Jt(o,c,f)),this}dispose(){return super.dispose(),this._buffers.forEach((n=>n.dispose())),this._buffers.clear(),this}}class HA extends Bs{constructor(){super(...arguments),this.name="MidiClass",this.defaultUnits="midi"}_frequencyToUnits(n){return ui(super._frequencyToUnits(n))}_ticksToUnits(n){return ui(super._ticksToUnits(n))}_beatsToUnits(n){return ui(super._beatsToUnits(n))}_secondsToUnits(n){return ui(super._secondsToUnits(n))}toMidi(){return this.valueOf()}toFrequency(){return ih(this.toMidi())}transpose(n){return new HA(this.context,this.toMidi()+n)}}function Jy(p,n){return new HA(we(),p,n)}class Ce extends Ve{constructor(){super(...arguments),this.name="Ticks",this.defaultUnits="i"}_now(){return this.context.transport.ticks}_beatsToUnits(n){return this._getPPQ()*n}_secondsToUnits(n){return Math.floor(n/(60/this._getBpm())*this._getPPQ())}_ticksToUnits(n){return n}toTicks(){return this.valueOf()}toSeconds(){return this.valueOf()/this._getPPQ()*(60/this._getBpm())}}function Zy(p,n){return new Ce(we(),p,n)}class tC extends ts{constructor(){super(...arguments),this.name="Draw",this.expiration=.25,this.anticipation=.008,this._events=new ks,this._boundDrawLoop=this._drawLoop.bind(this),this._animationFrame=-1}schedule(n,o){return this._events.add({callback:n,time:this.toSeconds(o)}),this._events.length===1&&(this._animationFrame=requestAnimationFrame(this._boundDrawLoop)),this}cancel(n){return this._events.cancel(this.toSeconds(n)),this}_drawLoop(){const n=this.context.currentTime;for(;this._events.length&&this._events.peek().time-this.anticipation<=n;){const o=this._events.shift();o&&n-o.time<=this.expiration&&o.callback()}this._events.length>0&&(this._animationFrame=requestAnimationFrame(this._boundDrawLoop))}dispose(){return super.dispose(),this._events.dispose(),cancelAnimationFrame(this._animationFrame),this}}Sa((p=>{p.draw=new tC({context:p})})),Fa((p=>{p.draw.dispose()}));class Rp extends Nn{constructor(){super(...arguments),this.name="IntervalTimeline",this._root=null,this._length=0}add(n){Et(Ot(n.time),"Events must have a time property"),Et(Ot(n.duration),"Events must have a duration parameter"),n.time=n.time.valueOf();let o=new eC(n.time,n.time+n.duration,n);for(this._root===null?this._root=o:this._root.insert(o),this._length++;o!==null;)o.updateHeight(),o.updateMax(),this._rebalance(o),o=o.parent;return this}remove(n){if(this._root!==null){const o=[];this._root.search(n.time,o);for(const c of o)if(c.event===n){this._removeNode(c),this._length--;break}}return this}get length(){return this._length}cancel(n){return this.forEachFrom(n,(o=>this.remove(o))),this}_setRoot(n){this._root=n,this._root!==null&&(this._root.parent=null)}_replaceNodeInParent(n,o){n.parent!==null?(n.isLeftChild()?n.parent.left=o:n.parent.right=o,this._rebalance(n.parent)):this._setRoot(o)}_removeNode(n){if(n.left===null&&n.right===null)this._replaceNodeInParent(n,null);else if(n.right===null)this._replaceNodeInParent(n,n.left);else if(n.left===null)this._replaceNodeInParent(n,n.right);else{let o,c=null;if(n.getBalance()>0)if(n.left.right===null)o=n.left,o.right=n.right,c=o;else{for(o=n.left.right;o.right!==null;)o=o.right;o.parent&&(o.parent.right=o.left,c=o.parent,o.left=n.left,o.right=n.right)}else if(n.right.left===null)o=n.right,o.left=n.left,c=o;else{for(o=n.right.left;o.left!==null;)o=o.left;o.parent&&(o.parent.left=o.right,c=o.parent,o.left=n.left,o.right=n.right)}n.parent!==null?n.isLeftChild()?n.parent.left=o:n.parent.right=o:this._setRoot(o),c&&this._rebalance(c)}n.dispose()}_rotateLeft(n){const o=n.parent,c=n.isLeftChild(),f=n.right;f&&(n.right=f.left,f.left=n),o!==null?c?o.left=f:o.right=f:this._setRoot(f)}_rotateRight(n){const o=n.parent,c=n.isLeftChild(),f=n.left;f&&(n.left=f.right,f.right=n),o!==null?c?o.left=f:o.right=f:this._setRoot(f)}_rebalance(n){const o=n.getBalance();o>1&&n.left?n.left.getBalance()<0?this._rotateLeft(n.left):this._rotateRight(n):o<-1&&n.right&&(n.right.getBalance()>0?this._rotateRight(n.right):this._rotateLeft(n))}get(n){if(this._root!==null){const o=[];if(this._root.search(n,o),o.length>0){let c=o[0];for(let f=1;f<o.length;f++)o[f].low>c.low&&(c=o[f]);return c.event}}return null}forEach(n){if(this._root!==null){const o=[];this._root.traverse((c=>o.push(c))),o.forEach((c=>{c.event&&n(c.event)}))}return this}forEachAtTime(n,o){if(this._root!==null){const c=[];this._root.search(n,c),c.forEach((f=>{f.event&&o(f.event)}))}return this}forEachFrom(n,o){if(this._root!==null){const c=[];this._root.searchAfter(n,c),c.forEach((f=>{f.event&&o(f.event)}))}return this}dispose(){return super.dispose(),this._root!==null&&this._root.traverse((n=>n.dispose())),this._root=null,this}}class eC{constructor(n,o,c){this._left=null,this._right=null,this.parent=null,this.height=0,this.event=c,this.low=n,this.high=o,this.max=this.high}insert(n){n.low<=this.low?this.left===null?this.left=n:this.left.insert(n):this.right===null?this.right=n:this.right.insert(n)}search(n,o){n>this.max||(this.left!==null&&this.left.search(n,o),this.low<=n&&this.high>n&&o.push(this),this.low>n||this.right!==null&&this.right.search(n,o))}searchAfter(n,o){this.low>=n&&(o.push(this),this.left!==null&&this.left.searchAfter(n,o)),this.right!==null&&this.right.searchAfter(n,o)}traverse(n){n(this),this.left!==null&&this.left.traverse(n),this.right!==null&&this.right.traverse(n)}updateHeight(){this.left!==null&&this.right!==null?this.height=Math.max(this.left.height,this.right.height)+1:this.right!==null?this.height=this.right.height+1:this.left!==null?this.height=this.left.height+1:this.height=0}updateMax(){this.max=this.high,this.left!==null&&(this.max=Math.max(this.max,this.left.max)),this.right!==null&&(this.max=Math.max(this.max,this.right.max))}getBalance(){let n=0;return this.left!==null&&this.right!==null?n=this.left.height-this.right.height:this.left!==null?n=this.left.height+1:this.right!==null&&(n=-(this.right.height+1)),n}isLeftChild(){return this.parent!==null&&this.parent.left===this}get left(){return this._left}set left(n){this._left=n,n!==null&&(n.parent=this),this.updateHeight(),this.updateMax()}get right(){return this._right}set right(n){this._right=n,n!==null&&(n.parent=this),this.updateHeight(),this.updateMax()}dispose(){this.parent=null,this._left=null,this._right=null,this.event=null}}class sC extends Nn{constructor(n){super(),this.name="TimelineValue",this._timeline=new ks({memory:10}),this._initialValue=n}set(n,o){return this._timeline.add({value:n,time:o}),this}get(n){const o=this._timeline.get(n);return o?o.value:this._initialValue}}class Rs extends at{constructor(){super(et(Rs.getDefaults(),arguments,["context"]))}connect(n,o=0,c=0){return Nr(this,n,o,c),this}}class dn extends Rs{constructor(){const n=et(dn.getDefaults(),arguments,["mapping","length"]);super(n),this.name="WaveShaper",this._shaper=this.context.createWaveShaper(),this.input=this._shaper,this.output=this._shaper,rs(n.mapping)||n.mapping instanceof Float32Array?this.curve=Float32Array.from(n.mapping):Ip(n.mapping)&&this.setMap(n.mapping,n.length)}static getDefaults(){return Object.assign(Mt.getDefaults(),{length:1024})}setMap(n,o=1024){const c=new Float32Array(o);for(let f=0,w=o;f<w;f++){const B=f/(w-1)*2-1;c[f]=n(B,f)}return this.curve=c,this}get curve(){return this._shaper.curve}set curve(n){this._shaper.curve=n}get oversample(){return this._shaper.oversample}set oversample(n){Et(["none","2x","4x"].some((o=>o.includes(n))),"oversampling must be either 'none', '2x', or '4x'"),this._shaper.oversample=n}dispose(){return super.dispose(),this._shaper.disconnect(),this}}class RA extends Rs{constructor(){const n=et(RA.getDefaults(),arguments,["value"]);super(n),this.name="Pow",this._exponentScaler=this.input=this.output=new dn({context:this.context,mapping:this._expFunc(n.value),length:8192}),this._exponent=n.value}static getDefaults(){return Object.assign(Rs.getDefaults(),{value:1})}_expFunc(n){return o=>Math.pow(Math.abs(o),n)}get value(){return this._exponent}set value(n){this._exponent=n,this._exponentScaler.setMap(this._expFunc(this._exponent))}dispose(){return super.dispose(),this._exponentScaler.dispose(),this}}class di{constructor(n,o){this.id=di._eventId++,this._remainderTime=0;const c=Object.assign(di.getDefaults(),o);this.transport=n,this.callback=c.callback,this._once=c.once,this.time=Math.floor(c.time),this._remainderTime=c.time-this.time}static getDefaults(){return{callback:Wt,once:!1,time:0}}get floatTime(){return this.time+this._remainderTime}invoke(n){if(this.callback){const o=this.transport.bpm.getDurationOfTicks(1,n);this.callback(n+this._remainderTime*o),this._once&&this.transport.clear(this.id)}}dispose(){return this.callback=void 0,this}}di._eventId=0;class hh extends di{constructor(n,o){super(n,o),this._currentId=-1,this._nextId=-1,this._nextTick=this.time,this._boundRestart=this._restart.bind(this);const c=Object.assign(hh.getDefaults(),o);this.duration=c.duration,this._interval=c.interval,this._nextTick=c.time,this.transport.on("start",this._boundRestart),this.transport.on("loopStart",this._boundRestart),this.transport.on("ticks",this._boundRestart),this.context=this.transport.context,this._restart()}static getDefaults(){return Object.assign({},di.getDefaults(),{duration:1/0,interval:1,once:!1})}invoke(n){this._createEvents(n),super.invoke(n)}_createEvent(){return Ea(this._nextTick,this.floatTime+this.duration)?this.transport.scheduleOnce(this.invoke.bind(this),new Ce(this.context,this._nextTick).toSeconds()):-1}_createEvents(n){Ea(this._nextTick+this._interval,this.floatTime+this.duration)&&(this._nextTick+=this._interval,this._currentId=this._nextId,this._nextId=this.transport.scheduleOnce(this.invoke.bind(this),new Ce(this.context,this._nextTick).toSeconds()))}_restart(n){this.transport.clear(this._currentId),this.transport.clear(this._nextId),this._nextTick=this.floatTime;const o=this.transport.getTicksAtTime(n);FA(o,this.time)&&(this._nextTick=this.floatTime+Math.ceil((o-this.floatTime)/this._interval)*this._interval),this._currentId=this._createEvent(),this._nextTick+=this._interval,this._nextId=this._createEvent()}dispose(){return super.dispose(),this.transport.clear(this._currentId),this.transport.clear(this._nextId),this.transport.off("start",this._boundRestart),this.transport.off("loopStart",this._boundRestart),this.transport.off("ticks",this._boundRestart),this}}class Ma extends ts{constructor(){const n=et(Ma.getDefaults(),arguments);super(n),this.name="Transport",this._loop=new sC(!1),this._loopStart=0,this._loopEnd=0,this._scheduledEvents={},this._timeline=new ks,this._repeatedEvents=new Rp,this._syncedSignals=[],this._swingAmount=0,this._ppq=n.ppq,this._clock=new DA({callback:this._processTick.bind(this),context:this.context,frequency:0,units:"bpm"}),this._bindClockEvents(),this.bpm=this._clock.frequency,this._clock.frequency.multiplier=n.ppq,this.bpm.setValueAtTime(n.bpm,0),Ft(this,"bpm"),this._timeSignature=n.timeSignature,this._swingTicks=n.ppq/2}static getDefaults(){return Object.assign(ts.getDefaults(),{bpm:120,loopEnd:"4m",loopStart:0,ppq:192,swing:0,swingSubdivision:"8n",timeSignature:4})}_processTick(n,o){if(this._loop.get(n)&&o>=this._loopEnd&&(this.emit("loopEnd",n),this._clock.setTicksAtTime(this._loopStart,n),o=this._loopStart,this.emit("loopStart",n,this._clock.getSecondsAtTime(n)),this.emit("loop",n)),this._swingAmount>0&&o%this._ppq!=0&&o%(2*this._swingTicks)!=0){const c=o%(2*this._swingTicks)/(2*this._swingTicks),f=Math.sin(c*Math.PI)*this._swingAmount;n+=new Ce(this.context,2*this._swingTicks/3).toSeconds()*f}Zc(!0),this._timeline.forEachAtTime(o,(c=>c.invoke(n))),Zc(!1)}schedule(n,o){const c=new di(this,{callback:n,time:new Ve(this.context,o).toTicks()});return this._addEvent(c,this._timeline)}scheduleRepeat(n,o,c,f=1/0){const w=new hh(this,{callback:n,duration:new Ds(this.context,f).toTicks(),interval:new Ds(this.context,o).toTicks(),time:new Ve(this.context,c).toTicks()});return this._addEvent(w,this._repeatedEvents)}scheduleOnce(n,o){const c=new di(this,{callback:n,once:!0,time:new Ve(this.context,o).toTicks()});return this._addEvent(c,this._timeline)}clear(n){if(this._scheduledEvents.hasOwnProperty(n)){const o=this._scheduledEvents[n.toString()];o.timeline.remove(o.event),o.event.dispose(),delete this._scheduledEvents[n.toString()]}return this}_addEvent(n,o){return this._scheduledEvents[n.id.toString()]={event:n,timeline:o},o.add(n),n.id}cancel(n=0){const o=this.toTicks(n);return this._timeline.forEachFrom(o,(c=>this.clear(c.id))),this._repeatedEvents.forEachFrom(o,(c=>this.clear(c.id))),this}_bindClockEvents(){this._clock.on("start",((n,o)=>{o=new Ce(this.context,o).toSeconds(),this.emit("start",n,o)})),this._clock.on("stop",(n=>{this.emit("stop",n)})),this._clock.on("pause",(n=>{this.emit("pause",n)}))}get state(){return this._clock.getStateAtTime(this.now())}start(n,o){let c;return this.context.resume(),Ot(o)&&(c=this.toTicks(o)),this._clock.start(n,c),this}stop(n){return this._clock.stop(n),this}pause(n){return this._clock.pause(n),this}toggle(n){return n=this.toSeconds(n),this._clock.getStateAtTime(n)!=="started"?this.start(n):this.stop(n),this}get timeSignature(){return this._timeSignature}set timeSignature(n){rs(n)&&(n=n[0]/n[1]*4),this._timeSignature=n}get loopStart(){return new Ds(this.context,this._loopStart,"i").toSeconds()}set loopStart(n){this._loopStart=this.toTicks(n)}get loopEnd(){return new Ds(this.context,this._loopEnd,"i").toSeconds()}set loopEnd(n){this._loopEnd=this.toTicks(n)}get loop(){return this._loop.get(this.now())}set loop(n){this._loop.set(n,this.now())}setLoopPoints(n,o){return this.loopStart=n,this.loopEnd=o,this}get swing(){return this._swingAmount}set swing(n){this._swingAmount=n}get swingSubdivision(){return new Ce(this.context,this._swingTicks).toNotation()}set swingSubdivision(n){this._swingTicks=this.toTicks(n)}get position(){const n=this.now(),o=this._clock.getTicksAtTime(n);return new Ce(this.context,o).toBarsBeatsSixteenths()}set position(n){const o=this.toTicks(n);this.ticks=o}get seconds(){return this._clock.seconds}set seconds(n){const o=this.now(),c=this._clock.frequency.timeToTicks(n,o);this.ticks=c}get progress(){if(this.loop){const n=this.now();return(this._clock.getTicksAtTime(n)-this._loopStart)/(this._loopEnd-this._loopStart)}return 0}get ticks(){return this._clock.ticks}set ticks(n){if(this._clock.ticks!==n){const o=this.now();if(this.state==="started"){const c=this._clock.getTicksAtTime(o),f=o+this._clock.frequency.getDurationOfTicks(Math.ceil(c)-c,o);this.emit("stop",f),this._clock.setTicksAtTime(n,f),this.emit("start",f,this._clock.getSecondsAtTime(f))}else this.emit("ticks",o),this._clock.setTicksAtTime(n,o)}}getTicksAtTime(n){return this._clock.getTicksAtTime(n)}getSecondsAtTime(n){return this._clock.getSecondsAtTime(n)}get PPQ(){return this._clock.frequency.multiplier}set PPQ(n){this._clock.frequency.multiplier=n}nextSubdivision(n){if(n=this.toTicks(n),this.state!=="started")return 0;{const o=this.now(),c=n-this.getTicksAtTime(o)%n;return this._clock.nextTickTime(c,o)}}syncSignal(n,o){const c=this.now();let f=this.bpm,w=1/(60/f.getValueAtTime(c)/this.PPQ),B=[];if(n.units==="time"){const E=.015625/w,S=new xt(E),Q=new RA(-1),M=new xt(E);f.chain(S,Q,M),f=M,w=1/w,B=[S,Q,M]}o||(o=n.getValueAtTime(c)!==0?n.getValueAtTime(c)/w:0);const b=new xt(o);return f.connect(b),b.connect(n._param),B.push(b),this._syncedSignals.push({initial:n.value,nodes:B,signal:n}),n.value=0,this}unsyncSignal(n){for(let o=this._syncedSignals.length-1;o>=0;o--){const c=this._syncedSignals[o];c.signal===n&&(c.nodes.forEach((f=>f.dispose())),c.signal.value=c.initial,this._syncedSignals.splice(o,1))}return this}dispose(){return super.dispose(),this._clock.dispose(),Hr(this,"bpm"),this._timeline.dispose(),this._repeatedEvents.dispose(),this}}TA.mixin(Ma),Sa((p=>{p.transport=new Ma({context:p})})),Fa((p=>{p.transport.dispose()}));class Me extends at{constructor(n){super(n),this.input=void 0,this._state=new PA("stopped"),this._synced=!1,this._scheduled=[],this._syncedStart=Wt,this._syncedStop=Wt,this._state.memory=100,this._state.increasing=!0,this._volume=this.output=new Vn({context:this.context,mute:n.mute,volume:n.volume}),this.volume=this._volume.volume,Ft(this,"volume"),this.onstop=n.onstop}static getDefaults(){return Object.assign(at.getDefaults(),{mute:!1,onstop:Wt,volume:0})}get state(){return this._synced?this.context.transport.state==="started"?this._state.getValueAtTime(this.context.transport.seconds):"stopped":this._state.getValueAtTime(this.now())}get mute(){return this._volume.mute}set mute(n){this._volume.mute=n}_clampToCurrentTime(n){return this._synced?n:Math.max(n,this.context.currentTime)}start(n,o,c){let f=Ss(n)&&this._synced?this.context.transport.seconds:this.toSeconds(n);if(f=this._clampToCurrentTime(f),this._synced||this._state.getValueAtTime(f)!=="started")if(this.log("start",f),this._state.setStateAtTime("started",f),this._synced){const w=this._state.get(f);w&&(w.offset=this.toSeconds($s(o,0)),w.duration=c?this.toSeconds(c):void 0);const B=this.context.transport.schedule((b=>{this._start(b,o,c)}),f);this._scheduled.push(B),this.context.transport.state==="started"&&this.context.transport.getSecondsAtTime(this.immediate())>f&&this._syncedStart(this.now(),this.context.transport.seconds)}else Jc(this.context),this._start(f,o,c);else Et(FA(f,this._state.get(f).time),"Start time must be strictly greater than previous start time"),this._state.cancel(f),this._state.setStateAtTime("started",f),this.log("restart",f),this.restart(f,o,c);return this}stop(n){let o=Ss(n)&&this._synced?this.context.transport.seconds:this.toSeconds(n);if(o=this._clampToCurrentTime(o),this._state.getValueAtTime(o)==="started"||Ot(this._state.getNextState("started",o))){if(this.log("stop",o),this._synced){const c=this.context.transport.schedule(this._stop.bind(this),o);this._scheduled.push(c)}else this._stop(o);this._state.cancel(o),this._state.setStateAtTime("stopped",o)}return this}restart(n,o,c){return n=this.toSeconds(n),this._state.getValueAtTime(n)==="started"&&(this._state.cancel(n),this._restart(n,o,c)),this}sync(){return this._synced||(this._synced=!0,this._syncedStart=(n,o)=>{if(FA(o,0)){const c=this._state.get(o);if(c&&c.state==="started"&&c.time!==o){const f=o-this.toSeconds(c.time);let w;c.duration&&(w=this.toSeconds(c.duration)-f),this._start(n,this.toSeconds(c.offset)+f,w)}}},this._syncedStop=n=>{const o=this.context.transport.getSecondsAtTime(Math.max(n-this.sampleTime,0));this._state.getValueAtTime(o)==="started"&&this._stop(n)},this.context.transport.on("start",this._syncedStart),this.context.transport.on("loopStart",this._syncedStart),this.context.transport.on("stop",this._syncedStop),this.context.transport.on("pause",this._syncedStop),this.context.transport.on("loopEnd",this._syncedStop)),this}unsync(){return this._synced&&(this.context.transport.off("stop",this._syncedStop),this.context.transport.off("pause",this._syncedStop),this.context.transport.off("loopEnd",this._syncedStop),this.context.transport.off("start",this._syncedStart),this.context.transport.off("loopStart",this._syncedStart)),this._synced=!1,this._scheduled.forEach((n=>this.context.transport.clear(n))),this._scheduled=[],this._state.cancel(0),this._stop(0),this}dispose(){return super.dispose(),this.onstop=Wt,this.unsync(),this._volume.dispose(),this._state.dispose(),this}}class fi extends kA{constructor(){const n=et(fi.getDefaults(),arguments,["url","onload"]);super(n),this.name="ToneBufferSource",this._source=this.context.createBufferSource(),this._internalChannels=[this._source],this._sourceStarted=!1,this._sourceStopped=!1,ys(this._source,this._gainNode),this._source.onended=()=>this._stopSource(),this.playbackRate=new kt({context:this.context,param:this._source.playbackRate,units:"positive",value:n.playbackRate}),this.loop=n.loop,this.loopStart=n.loopStart,this.loopEnd=n.loopEnd,this._buffer=new Jt(n.url,n.onload,n.onerror),this._internalChannels.push(this._source)}static getDefaults(){return Object.assign(kA.getDefaults(),{url:new Jt,loop:!1,loopEnd:0,loopStart:0,onload:Wt,onerror:Wt,playbackRate:1})}get fadeIn(){return this._fadeIn}set fadeIn(n){this._fadeIn=n}get fadeOut(){return this._fadeOut}set fadeOut(n){this._fadeOut=n}get curve(){return this._curve}set curve(n){this._curve=n}start(n,o,c,f=1){Et(this.buffer.loaded,"buffer is either not set or not loaded");const w=this.toSeconds(n);this._startGain(w,f),o=this.loop?$s(o,this.loopStart):$s(o,0);let B=Math.max(this.toSeconds(o),0);if(this.loop){const b=this.toSeconds(this.loopEnd)||this.buffer.duration,E=this.toSeconds(this.loopStart),S=b-E;sh(B,b)&&(B=(B-E)%S+E),un(B,this.buffer.duration)&&(B=0)}if(this._source.buffer=this.buffer.get(),this._source.loopEnd=this.toSeconds(this.loopEnd)||this.buffer.duration,Ea(B,this.buffer.duration)&&(this._sourceStarted=!0,this._source.start(w,B)),Ot(c)){let b=this.toSeconds(c);b=Math.max(b,0),this.stop(w+b)}return this}_stopSource(n){!this._sourceStopped&&this._sourceStarted&&(this._sourceStopped=!0,this._source.stop(this.toSeconds(n)),this._onended())}get loopStart(){return this._source.loopStart}set loopStart(n){this._source.loopStart=this.toSeconds(n)}get loopEnd(){return this._source.loopEnd}set loopEnd(n){this._source.loopEnd=this.toSeconds(n)}get buffer(){return this._buffer}set buffer(n){this._buffer.set(n)}get loop(){return this._source.loop}set loop(n){this._source.loop=n,this._sourceStarted&&this.cancelStop()}dispose(){return super.dispose(),this._source.onended=null,this._source.disconnect(),this._buffer.dispose(),this.playbackRate.dispose(),this}}class pi extends Me{constructor(){const n=et(pi.getDefaults(),arguments,["type"]);super(n),this.name="Noise",this._source=null,this._playbackRate=n.playbackRate,this.type=n.type,this._fadeIn=n.fadeIn,this._fadeOut=n.fadeOut}static getDefaults(){return Object.assign(Me.getDefaults(),{fadeIn:0,fadeOut:0,playbackRate:1,type:"white"})}get type(){return this._type}set type(n){if(Et(n in Op,"Noise: invalid type: "+n),this._type!==n&&(this._type=n,this.state==="started")){const o=this.now();this._stop(o),this._start(o)}}get playbackRate(){return this._playbackRate}set playbackRate(n){this._playbackRate=n,this._source&&(this._source.playbackRate.value=n)}_start(n){const o=Op[this._type];this._source=new fi({url:o,context:this.context,fadeIn:this._fadeIn,fadeOut:this._fadeOut,loop:!0,onended:()=>this.onstop(this),playbackRate:this._playbackRate}).connect(this.output),this._source.start(this.toSeconds(n),Math.random()*(o.duration-.001))}_stop(n){this._source&&(this._source.stop(this.toSeconds(n)),this._source=null)}get fadeIn(){return this._fadeIn}set fadeIn(n){this._fadeIn=n,this._source&&(this._source.fadeIn=this._fadeIn)}get fadeOut(){return this._fadeOut}set fadeOut(n){this._fadeOut=n,this._source&&(this._source.fadeOut=this._fadeOut)}_restart(n){this._stop(n),this._start(n)}dispose(){return super.dispose(),this._source&&this._source.disconnect(),this}}const OA=220500,Wn={brown:null,pink:null,white:null},Op={get brown(){if(!Wn.brown){const p=[];for(let n=0;n<2;n++){const o=new Float32Array(OA);p[n]=o;let c=0;for(let f=0;f<OA;f++){const w=2*Math.random()-1;o[f]=(c+.02*w)/1.02,c=o[f],o[f]*=3.5}}Wn.brown=new Jt().fromArray(p)}return Wn.brown},get pink(){if(!Wn.pink){const p=[];for(let n=0;n<2;n++){const o=new Float32Array(OA);let c,f,w,B,b,E,S;p[n]=o,c=f=w=B=b=E=S=0;for(let Q=0;Q<OA;Q++){const M=2*Math.random()-1;c=.99886*c+.0555179*M,f=.99332*f+.0750759*M,w=.969*w+.153852*M,B=.8665*B+.3104856*M,b=.55*b+.5329522*M,E=-.7616*E-.016898*M,o[Q]=c+f+w+B+b+E+S+.5362*M,o[Q]*=.11,S=.115926*M}}Wn.pink=new Jt().fromArray(p)}return Wn.pink},get white(){if(!Wn.white){const p=[];for(let n=0;n<2;n++){const o=new Float32Array(OA);p[n]=o;for(let c=0;c<OA;c++)o[c]=2*Math.random()-1}Wn.white=new Jt().fromArray(p)}return Wn.white}};class Vr extends at{constructor(){const n=et(Vr.getDefaults(),arguments,["volume"]);super(n),this.name="UserMedia",this._volume=this.output=new Vn({context:this.context,volume:n.volume}),this.volume=this._volume.volume,Ft(this,"volume"),this.mute=n.mute}static getDefaults(){return Object.assign(at.getDefaults(),{mute:!1,volume:0})}open(n){return de(this,void 0,void 0,(function*(){Et(Vr.supported,"UserMedia is not supported"),this.state==="started"&&this.close();const o=yield Vr.enumerateDevices();Us(n)?this._device=o[n]:(this._device=o.find((w=>w.label===n||w.deviceId===n)),!this._device&&o.length>0&&(this._device=o[0]),Et(Ot(this._device),`No matching device ${n}`));const c={audio:{echoCancellation:!1,sampleRate:this.context.sampleRate,noiseSuppression:!1,mozNoiseSuppression:!1}};this._device&&(c.audio.deviceId=this._device.deviceId);const f=yield navigator.mediaDevices.getUserMedia(c);if(!this._stream){this._stream=f;const w=this.context.createMediaStreamSource(f);ys(w,this.output),this._mediaStream=w}return this}))}close(){return this._stream&&this._mediaStream&&(this._stream.getAudioTracks().forEach((n=>{n.stop()})),this._stream=void 0,this._mediaStream.disconnect(),this._mediaStream=void 0),this._device=void 0,this}static enumerateDevices(){return de(this,void 0,void 0,(function*(){return(yield navigator.mediaDevices.enumerateDevices()).filter((n=>n.kind==="audioinput"))}))}get state(){return this._stream&&this._stream.active?"started":"stopped"}get deviceId(){return this._device?this._device.deviceId:void 0}get groupId(){return this._device?this._device.groupId:void 0}get label(){return this._device?this._device.label:void 0}get mute(){return this._volume.mute}set mute(n){this._volume.mute=n}dispose(){return super.dispose(),this.close(),this._volume.dispose(),this.volume.dispose(),this}static get supported(){return Ot(navigator.mediaDevices)&&Ot(navigator.mediaDevices.getUserMedia)}}function zi(p,n){return de(this,void 0,void 0,(function*(){const o=n/p.context.sampleRate,c=new QA(1,o,p.context.sampleRate);return new p.constructor(Object.assign(p.get(),{frequency:2/o,detune:0,context:c})).toDestination().start(0),(yield c.render()).getChannelData(0)}))}class Wr extends kA{constructor(){const n=et(Wr.getDefaults(),arguments,["frequency","type"]);super(n),this.name="ToneOscillatorNode",this._oscillator=this.context.createOscillator(),this._internalChannels=[this._oscillator],ys(this._oscillator,this._gainNode),this.type=n.type,this.frequency=new kt({context:this.context,param:this._oscillator.frequency,units:"frequency",value:n.frequency}),this.detune=new kt({context:this.context,param:this._oscillator.detune,units:"cents",value:n.detune}),Ft(this,["frequency","detune"])}static getDefaults(){return Object.assign(kA.getDefaults(),{detune:0,frequency:440,type:"sine"})}start(n){const o=this.toSeconds(n);return this.log("start",o),this._startGain(o),this._oscillator.start(o),this}_stopSource(n){this._oscillator.stop(n)}setPeriodicWave(n){return this._oscillator.setPeriodicWave(n),this}get type(){return this._oscillator.type}set type(n){this._oscillator.type=n}dispose(){return super.dispose(),this.state==="started"&&this.stop(),this._oscillator.disconnect(),this.frequency.dispose(),this.detune.dispose(),this}}class be extends Me{constructor(){const n=et(be.getDefaults(),arguments,["frequency","type"]);super(n),this.name="Oscillator",this._oscillator=null,this.frequency=new Mt({context:this.context,units:"frequency",value:n.frequency}),Ft(this,"frequency"),this.detune=new Mt({context:this.context,units:"cents",value:n.detune}),Ft(this,"detune"),this._partials=n.partials,this._partialCount=n.partialCount,this._type=n.type,n.partialCount&&n.type!=="custom"&&(this._type=this.baseType+n.partialCount.toString()),this.phase=n.phase}static getDefaults(){return Object.assign(Me.getDefaults(),{detune:0,frequency:440,partialCount:0,partials:[],phase:0,type:"sine"})}_start(n){const o=this.toSeconds(n),c=new Wr({context:this.context,onended:()=>this.onstop(this)});this._oscillator=c,this._wave?this._oscillator.setPeriodicWave(this._wave):this._oscillator.type=this._type,this._oscillator.connect(this.output),this.frequency.connect(this._oscillator.frequency),this.detune.connect(this._oscillator.detune),this._oscillator.start(o)}_stop(n){const o=this.toSeconds(n);this._oscillator&&this._oscillator.stop(o)}_restart(n){const o=this.toSeconds(n);return this.log("restart",o),this._oscillator&&this._oscillator.cancelStop(),this._state.cancel(o),this}syncFrequency(){return this.context.transport.syncSignal(this.frequency),this}unsyncFrequency(){return this.context.transport.unsyncSignal(this.frequency),this}_getCachedPeriodicWave(){if(this._type==="custom")return be._periodicWaveCache.find((n=>{return n.phase===this._phase&&(o=n.partials,c=this._partials,o.length===c.length&&o.every(((f,w)=>c[w]===f)));var o,c}));{const n=be._periodicWaveCache.find((o=>o.type===this._type&&o.phase===this._phase));return this._partialCount=n?n.partialCount:this._partialCount,n}}get type(){return this._type}set type(n){this._type=n;const o=["sine","square","sawtooth","triangle"].indexOf(n)!==-1;if(this._phase===0&&o)this._wave=void 0,this._partialCount=0,this._oscillator!==null&&(this._oscillator.type=n);else{const c=this._getCachedPeriodicWave();if(Ot(c)){const{partials:f,wave:w}=c;this._wave=w,this._partials=f,this._oscillator!==null&&this._oscillator.setPeriodicWave(this._wave)}else{const[f,w]=this._getRealImaginary(n,this._phase),B=this.context.createPeriodicWave(f,w);this._wave=B,this._oscillator!==null&&this._oscillator.setPeriodicWave(this._wave),be._periodicWaveCache.push({imag:w,partialCount:this._partialCount,partials:this._partials,phase:this._phase,real:f,type:this._type,wave:this._wave}),be._periodicWaveCache.length>100&&be._periodicWaveCache.shift()}}}get baseType(){return this._type.replace(this.partialCount.toString(),"")}set baseType(n){this.partialCount&&this._type!=="custom"&&n!=="custom"?this.type=n+this.partialCount:this.type=n}get partialCount(){return this._partialCount}set partialCount(n){os(n,0);let o=this._type;const c=/^(sine|triangle|square|sawtooth)(\d+)$/.exec(this._type);if(c&&(o=c[1]),this._type!=="custom")this.type=n===0?o:o+n.toString();else{const f=new Float32Array(n);this._partials.forEach(((w,B)=>f[B]=w)),this._partials=Array.from(f),this.type=this._type}}_getRealImaginary(n,o){let c=2048;const f=new Float32Array(c),w=new Float32Array(c);let B=1;if(n==="custom"){if(B=this._partials.length+1,this._partialCount=this._partials.length,c=B,this._partials.length===0)return[f,w]}else{const b=/^(sine|triangle|square|sawtooth)(\d+)$/.exec(n);b?(B=parseInt(b[2],10)+1,this._partialCount=parseInt(b[2],10),n=b[1],B=Math.max(B,2),c=B):this._partialCount=0,this._partials=[]}for(let b=1;b<c;++b){const E=2/(b*Math.PI);let S;switch(n){case"sine":S=b<=B?1:0,this._partials[b-1]=S;break;case"square":S=1&b?2*E:0,this._partials[b-1]=S;break;case"sawtooth":S=E*(1&b?1:-1),this._partials[b-1]=S;break;case"triangle":S=1&b?E*E*2*(b-1>>1&1?-1:1):0,this._partials[b-1]=S;break;case"custom":S=this._partials[b-1];break;default:throw new TypeError("Oscillator: invalid type: "+n)}S!==0?(f[b]=-S*Math.sin(o*b),w[b]=S*Math.cos(o*b)):(f[b]=0,w[b]=0)}return[f,w]}_inverseFFT(n,o,c){let f=0;const w=n.length;for(let B=0;B<w;B++)f+=n[B]*Math.cos(B*c)+o[B]*Math.sin(B*c);return f}getInitialValue(){const[n,o]=this._getRealImaginary(this._type,0);let c=0;const f=2*Math.PI;for(let w=0;w<32;w++)c=Math.max(this._inverseFFT(n,o,w/32*f),c);return qi(-this._inverseFFT(n,o,this._phase)/c,-1,1)}get partials(){return this._partials.slice(0,this.partialCount)}set partials(n){this._partials=n,this._partialCount=this._partials.length,n.length&&(this.type="custom")}get phase(){return this._phase*(180/Math.PI)}set phase(n){this._phase=n*Math.PI/180,this.type=this._type}asArray(){return de(this,arguments,void 0,(function*(n=1024){return zi(this,n)}))}dispose(){return super.dispose(),this._oscillator!==null&&this._oscillator.dispose(),this._wave=void 0,this.frequency.dispose(),this.detune.dispose(),this}}be._periodicWaveCache=[];class Ua extends Rs{constructor(){super(...arguments),this.name="AudioToGain",this._norm=new dn({context:this.context,mapping:n=>(n+1)/2}),this.input=this._norm,this.output=this._norm}dispose(){return super.dispose(),this._norm.dispose(),this}}class _e extends Mt{constructor(){const n=et(_e.getDefaults(),arguments,["value"]);super(n),this.name="Multiply",this.override=!1,this._mult=this.input=this.output=new xt({context:this.context,minValue:n.minValue,maxValue:n.maxValue}),this.factor=this._param=this._mult.gain,this.factor.setValueAtTime(n.value,0)}static getDefaults(){return Object.assign(Mt.getDefaults(),{value:0})}dispose(){return super.dispose(),this._mult.dispose(),this}}class Gr extends Me{constructor(){const n=et(Gr.getDefaults(),arguments,["frequency","type","modulationType"]);super(n),this.name="AMOscillator",this._modulationScale=new Ua({context:this.context}),this._modulationNode=new xt({context:this.context}),this._carrier=new be({context:this.context,detune:n.detune,frequency:n.frequency,onstop:()=>this.onstop(this),phase:n.phase,type:n.type}),this.frequency=this._carrier.frequency,this.detune=this._carrier.detune,this._modulator=new be({context:this.context,phase:n.phase,type:n.modulationType}),this.harmonicity=new _e({context:this.context,units:"positive",value:n.harmonicity}),this.frequency.chain(this.harmonicity,this._modulator.frequency),this._modulator.chain(this._modulationScale,this._modulationNode.gain),this._carrier.chain(this._modulationNode,this.output),Ft(this,["frequency","detune","harmonicity"])}static getDefaults(){return Object.assign(be.getDefaults(),{harmonicity:1,modulationType:"square"})}_start(n){this._modulator.start(n),this._carrier.start(n)}_stop(n){this._modulator.stop(n),this._carrier.stop(n)}_restart(n){this._modulator.restart(n),this._carrier.restart(n)}get type(){return this._carrier.type}set type(n){this._carrier.type=n}get baseType(){return this._carrier.baseType}set baseType(n){this._carrier.baseType=n}get partialCount(){return this._carrier.partialCount}set partialCount(n){this._carrier.partialCount=n}get modulationType(){return this._modulator.type}set modulationType(n){this._modulator.type=n}get phase(){return this._carrier.phase}set phase(n){this._carrier.phase=n,this._modulator.phase=n}get partials(){return this._carrier.partials}set partials(n){this._carrier.partials=n}asArray(){return de(this,arguments,void 0,(function*(n=1024){return zi(this,n)}))}dispose(){return super.dispose(),this.frequency.dispose(),this.detune.dispose(),this.harmonicity.dispose(),this._carrier.dispose(),this._modulator.dispose(),this._modulationNode.dispose(),this._modulationScale.dispose(),this}}class NA extends Me{constructor(){const n=et(NA.getDefaults(),arguments,["frequency","type","modulationType"]);super(n),this.name="FMOscillator",this._modulationNode=new xt({context:this.context,gain:0}),this._carrier=new be({context:this.context,detune:n.detune,frequency:0,onstop:()=>this.onstop(this),phase:n.phase,type:n.type}),this.detune=this._carrier.detune,this.frequency=new Mt({context:this.context,units:"frequency",value:n.frequency}),this._modulator=new be({context:this.context,phase:n.phase,type:n.modulationType}),this.harmonicity=new _e({context:this.context,units:"positive",value:n.harmonicity}),this.modulationIndex=new _e({context:this.context,units:"positive",value:n.modulationIndex}),this.frequency.connect(this._carrier.frequency),this.frequency.chain(this.harmonicity,this._modulator.frequency),this.frequency.chain(this.modulationIndex,this._modulationNode),this._modulator.connect(this._modulationNode.gain),this._modulationNode.connect(this._carrier.frequency),this._carrier.connect(this.output),this.detune.connect(this._modulator.detune),Ft(this,["modulationIndex","frequency","detune","harmonicity"])}static getDefaults(){return Object.assign(be.getDefaults(),{harmonicity:1,modulationIndex:2,modulationType:"square"})}_start(n){this._modulator.start(n),this._carrier.start(n)}_stop(n){this._modulator.stop(n),this._carrier.stop(n)}_restart(n){return this._modulator.restart(n),this._carrier.restart(n),this}get type(){return this._carrier.type}set type(n){this._carrier.type=n}get baseType(){return this._carrier.baseType}set baseType(n){this._carrier.baseType=n}get partialCount(){return this._carrier.partialCount}set partialCount(n){this._carrier.partialCount=n}get modulationType(){return this._modulator.type}set modulationType(n){this._modulator.type=n}get phase(){return this._carrier.phase}set phase(n){this._carrier.phase=n,this._modulator.phase=n}get partials(){return this._carrier.partials}set partials(n){this._carrier.partials=n}asArray(){return de(this,arguments,void 0,(function*(n=1024){return zi(this,n)}))}dispose(){return super.dispose(),this.frequency.dispose(),this.harmonicity.dispose(),this._carrier.dispose(),this._modulator.dispose(),this._modulationNode.dispose(),this.modulationIndex.dispose(),this}}class VA extends Me{constructor(){const n=et(VA.getDefaults(),arguments,["frequency","width"]);super(n),this.name="PulseOscillator",this._widthGate=new xt({context:this.context,gain:0}),this._thresh=new dn({context:this.context,mapping:o=>o<=0?-1:1}),this.width=new Mt({context:this.context,units:"audioRange",value:n.width}),this._triangle=new be({context:this.context,detune:n.detune,frequency:n.frequency,onstop:()=>this.onstop(this),phase:n.phase,type:"triangle"}),this.frequency=this._triangle.frequency,this.detune=this._triangle.detune,this._triangle.chain(this._thresh,this.output),this.width.chain(this._widthGate,this._thresh),Ft(this,["width","frequency","detune"])}static getDefaults(){return Object.assign(Me.getDefaults(),{detune:0,frequency:440,phase:0,type:"pulse",width:.2})}_start(n){n=this.toSeconds(n),this._triangle.start(n),this._widthGate.gain.setValueAtTime(1,n)}_stop(n){n=this.toSeconds(n),this._triangle.stop(n),this._widthGate.gain.cancelScheduledValues(n),this._widthGate.gain.setValueAtTime(0,n)}_restart(n){this._triangle.restart(n),this._widthGate.gain.cancelScheduledValues(n),this._widthGate.gain.setValueAtTime(1,n)}get phase(){return this._triangle.phase}set phase(n){this._triangle.phase=n}get type(){return"pulse"}get baseType(){return"pulse"}get partials(){return[]}get partialCount(){return 0}set carrierType(n){this._triangle.type=n}asArray(){return de(this,arguments,void 0,(function*(n=1024){return zi(this,n)}))}dispose(){return super.dispose(),this._triangle.dispose(),this.width.dispose(),this._widthGate.dispose(),this._thresh.dispose(),this}}class Kr extends Me{constructor(){const n=et(Kr.getDefaults(),arguments,["frequency","type","spread"]);super(n),this.name="FatOscillator",this._oscillators=[],this.frequency=new Mt({context:this.context,units:"frequency",value:n.frequency}),this.detune=new Mt({context:this.context,units:"cents",value:n.detune}),this._spread=n.spread,this._type=n.type,this._phase=n.phase,this._partials=n.partials,this._partialCount=n.partialCount,this.count=n.count,Ft(this,["frequency","detune"])}static getDefaults(){return Object.assign(be.getDefaults(),{count:3,spread:20,type:"sawtooth"})}_start(n){n=this.toSeconds(n),this._forEach((o=>o.start(n)))}_stop(n){n=this.toSeconds(n),this._forEach((o=>o.stop(n)))}_restart(n){this._forEach((o=>o.restart(n)))}_forEach(n){for(let o=0;o<this._oscillators.length;o++)n(this._oscillators[o],o)}get type(){return this._type}set type(n){this._type=n,this._forEach((o=>o.type=n))}get spread(){return this._spread}set spread(n){if(this._spread=n,this._oscillators.length>1){const o=-n/2,c=n/(this._oscillators.length-1);this._forEach(((f,w)=>f.detune.value=o+c*w))}}get count(){return this._oscillators.length}set count(n){if(os(n,1),this._oscillators.length!==n){this._forEach((o=>o.dispose())),this._oscillators=[];for(let o=0;o<n;o++){const c=new be({context:this.context,volume:-6-1.1*n,type:this._type,phase:this._phase+o/n*360,partialCount:this._partialCount,onstop:o===0?()=>this.onstop(this):Wt});this.type==="custom"&&(c.partials=this._partials),this.frequency.connect(c.frequency),this.detune.connect(c.detune),c.detune.overridden=!1,c.connect(this.output),this._oscillators[o]=c}this.spread=this._spread,this.state==="started"&&this._forEach((o=>o.start()))}}get phase(){return this._phase}set phase(n){this._phase=n,this._forEach(((o,c)=>o.phase=this._phase+c/this.count*360))}get baseType(){return this._oscillators[0].baseType}set baseType(n){this._forEach((o=>o.baseType=n)),this._type=this._oscillators[0].type}get partials(){return this._oscillators[0].partials}set partials(n){this._partials=n,this._partialCount=this._partials.length,n.length&&(this._type="custom",this._forEach((o=>o.partials=n)))}get partialCount(){return this._oscillators[0].partialCount}set partialCount(n){this._partialCount=n,this._forEach((o=>o.partialCount=n)),this._type=this._oscillators[0].type}asArray(){return de(this,arguments,void 0,(function*(n=1024){return zi(this,n)}))}dispose(){return super.dispose(),this.frequency.dispose(),this.detune.dispose(),this._forEach((n=>n.dispose())),this}}class qr extends Me{constructor(){const n=et(qr.getDefaults(),arguments,["frequency","modulationFrequency"]);super(n),this.name="PWMOscillator",this.sourceType="pwm",this._scale=new _e({context:this.context,value:2}),this._pulse=new VA({context:this.context,frequency:n.modulationFrequency}),this._pulse.carrierType="sine",this.modulationFrequency=this._pulse.frequency,this._modulator=new be({context:this.context,detune:n.detune,frequency:n.frequency,onstop:()=>this.onstop(this),phase:n.phase}),this.frequency=this._modulator.frequency,this.detune=this._modulator.detune,this._modulator.chain(this._scale,this._pulse.width),this._pulse.connect(this.output),Ft(this,["modulationFrequency","frequency","detune"])}static getDefaults(){return Object.assign(Me.getDefaults(),{detune:0,frequency:440,modulationFrequency:.4,phase:0,type:"pwm"})}_start(n){n=this.toSeconds(n),this._modulator.start(n),this._pulse.start(n)}_stop(n){n=this.toSeconds(n),this._modulator.stop(n),this._pulse.stop(n)}_restart(n){this._modulator.restart(n),this._pulse.restart(n)}get type(){return"pwm"}get baseType(){return"pwm"}get partials(){return[]}get partialCount(){return 0}get phase(){return this._modulator.phase}set phase(n){this._modulator.phase=n}asArray(){return de(this,arguments,void 0,(function*(n=1024){return zi(this,n)}))}dispose(){return super.dispose(),this._pulse.dispose(),this._scale.dispose(),this._modulator.dispose(),this}}const Np={am:Gr,fat:Kr,fm:NA,oscillator:be,pulse:VA,pwm:qr};class Gn extends Me{constructor(){const n=et(Gn.getDefaults(),arguments,["frequency","type"]);super(n),this.name="OmniOscillator",this.frequency=new Mt({context:this.context,units:"frequency",value:n.frequency}),this.detune=new Mt({context:this.context,units:"cents",value:n.detune}),Ft(this,["frequency","detune"]),this.set(n)}static getDefaults(){return Object.assign(be.getDefaults(),NA.getDefaults(),Gr.getDefaults(),Kr.getDefaults(),VA.getDefaults(),qr.getDefaults())}_start(n){this._oscillator.start(n)}_stop(n){this._oscillator.stop(n)}_restart(n){return this._oscillator.restart(n),this}get type(){let n="";return["am","fm","fat"].some((o=>this._sourceType===o))&&(n=this._sourceType),n+this._oscillator.type}set type(n){n.substr(0,2)==="fm"?(this._createNewOscillator("fm"),this._oscillator=this._oscillator,this._oscillator.type=n.substr(2)):n.substr(0,2)==="am"?(this._createNewOscillator("am"),this._oscillator=this._oscillator,this._oscillator.type=n.substr(2)):n.substr(0,3)==="fat"?(this._createNewOscillator("fat"),this._oscillator=this._oscillator,this._oscillator.type=n.substr(3)):n==="pwm"?(this._createNewOscillator("pwm"),this._oscillator=this._oscillator):n==="pulse"?this._createNewOscillator("pulse"):(this._createNewOscillator("oscillator"),this._oscillator=this._oscillator,this._oscillator.type=n)}get partials(){return this._oscillator.partials}set partials(n){this._getOscType(this._oscillator,"pulse")||this._getOscType(this._oscillator,"pwm")||(this._oscillator.partials=n)}get partialCount(){return this._oscillator.partialCount}set partialCount(n){this._getOscType(this._oscillator,"pulse")||this._getOscType(this._oscillator,"pwm")||(this._oscillator.partialCount=n)}set(n){return Reflect.has(n,"type")&&n.type&&(this.type=n.type),super.set(n),this}_createNewOscillator(n){if(n!==this._sourceType){this._sourceType=n;const o=Np[n],c=this.now();if(this._oscillator){const f=this._oscillator;f.stop(c),this.context.setTimeout((()=>f.dispose()),this.blockTime)}this._oscillator=new o({context:this.context}),this.frequency.connect(this._oscillator.frequency),this.detune.connect(this._oscillator.detune),this._oscillator.connect(this.output),this._oscillator.onstop=()=>this.onstop(this),this.state==="started"&&this._oscillator.start(c)}}get phase(){return this._oscillator.phase}set phase(n){this._oscillator.phase=n}get sourceType(){return this._sourceType}set sourceType(n){let o="sine";this._oscillator.type!=="pwm"&&this._oscillator.type!=="pulse"&&(o=this._oscillator.type),n==="fm"?this.type="fm"+o:n==="am"?this.type="am"+o:n==="fat"?this.type="fat"+o:n==="oscillator"?this.type=o:n==="pulse"?this.type="pulse":n==="pwm"&&(this.type="pwm")}_getOscType(n,o){return n instanceof Np[o]}get baseType(){return this._oscillator.baseType}set baseType(n){this._getOscType(this._oscillator,"pulse")||this._getOscType(this._oscillator,"pwm")||n==="pulse"||n==="pwm"||(this._oscillator.baseType=n)}get width(){return this._getOscType(this._oscillator,"pulse")?this._oscillator.width:void 0}get count(){return this._getOscType(this._oscillator,"fat")?this._oscillator.count:void 0}set count(n){this._getOscType(this._oscillator,"fat")&&Us(n)&&(this._oscillator.count=n)}get spread(){return this._getOscType(this._oscillator,"fat")?this._oscillator.spread:void 0}set spread(n){this._getOscType(this._oscillator,"fat")&&Us(n)&&(this._oscillator.spread=n)}get modulationType(){return this._getOscType(this._oscillator,"fm")||this._getOscType(this._oscillator,"am")?this._oscillator.modulationType:void 0}set modulationType(n){(this._getOscType(this._oscillator,"fm")||this._getOscType(this._oscillator,"am"))&&cn(n)&&(this._oscillator.modulationType=n)}get modulationIndex(){return this._getOscType(this._oscillator,"fm")?this._oscillator.modulationIndex:void 0}get harmonicity(){return this._getOscType(this._oscillator,"fm")||this._getOscType(this._oscillator,"am")?this._oscillator.harmonicity:void 0}get modulationFrequency(){return this._getOscType(this._oscillator,"pwm")?this._oscillator.modulationFrequency:void 0}asArray(){return de(this,arguments,void 0,(function*(n=1024){return zi(this,n)}))}dispose(){return super.dispose(),this.detune.dispose(),this.frequency.dispose(),this._oscillator.dispose(),this}}class $i extends Mt{constructor(){super(et($i.getDefaults(),arguments,["value"])),this.override=!1,this.name="Add",this._sum=new xt({context:this.context}),this.input=this._sum,this.output=this._sum,this.addend=this._param,Ls(this._constantSource,this._sum)}static getDefaults(){return Object.assign(Mt.getDefaults(),{value:0})}dispose(){return super.dispose(),this._sum.dispose(),this}}class Kn extends Rs{constructor(){const n=et(Kn.getDefaults(),arguments,["min","max"]);super(n),this.name="Scale",this._mult=this.input=new _e({context:this.context,value:n.max-n.min}),this._add=this.output=new $i({context:this.context,value:n.min}),this._min=n.min,this._max=n.max,this.input.connect(this.output)}static getDefaults(){return Object.assign(Rs.getDefaults(),{max:1,min:0})}get min(){return this._min}set min(n){this._min=n,this._setRange()}get max(){return this._max}set max(n){this._max=n,this._setRange()}_setRange(){this._add.value=this._min,this._mult.value=this._max-this._min}dispose(){return super.dispose(),this._add.dispose(),this._mult.dispose(),this}}class Pa extends Rs{constructor(){super(et(Pa.getDefaults(),arguments)),this.name="Zero",this._gain=new xt({context:this.context}),this.output=this._gain,this.input=void 0,ys(this.context.getConstant(0),this._gain)}dispose(){return super.dispose(),rh(this.context.getConstant(0),this._gain),this}}class Cs extends at{constructor(){const n=et(Cs.getDefaults(),arguments,["frequency","min","max"]);super(n),this.name="LFO",this._stoppedValue=0,this._units="number",this.convert=!0,this._fromType=kt.prototype._fromType,this._toType=kt.prototype._toType,this._is=kt.prototype._is,this._clampValue=kt.prototype._clampValue,this._oscillator=new be(n),this.frequency=this._oscillator.frequency,this._amplitudeGain=new xt({context:this.context,gain:n.amplitude,units:"normalRange"}),this.amplitude=this._amplitudeGain.gain,this._stoppedSignal=new Mt({context:this.context,units:"audioRange",value:0}),this._zeros=new Pa({context:this.context}),this._a2g=new Ua({context:this.context}),this._scaler=this.output=new Kn({context:this.context,max:n.max,min:n.min}),this.units=n.units,this.min=n.min,this.max=n.max,this._oscillator.chain(this._amplitudeGain,this._a2g,this._scaler),this._zeros.connect(this._a2g),this._stoppedSignal.connect(this._a2g),Ft(this,["amplitude","frequency"]),this.phase=n.phase}static getDefaults(){return Object.assign(be.getDefaults(),{amplitude:1,frequency:"4n",max:1,min:0,type:"sine",units:"number"})}start(n){return n=this.toSeconds(n),this._stoppedSignal.setValueAtTime(0,n),this._oscillator.start(n),this}stop(n){return n=this.toSeconds(n),this._stoppedSignal.setValueAtTime(this._stoppedValue,n),this._oscillator.stop(n),this}sync(){return this._oscillator.sync(),this._oscillator.syncFrequency(),this}unsync(){return this._oscillator.unsync(),this._oscillator.unsyncFrequency(),this}_setStoppedValue(){this._stoppedValue=this._oscillator.getInitialValue(),this._stoppedSignal.value=this._stoppedValue}get min(){return this._toType(this._scaler.min)}set min(n){n=this._fromType(n),this._scaler.min=n}get max(){return this._toType(this._scaler.max)}set max(n){n=this._fromType(n),this._scaler.max=n}get type(){return this._oscillator.type}set type(n){this._oscillator.type=n,this._setStoppedValue()}get partials(){return this._oscillator.partials}set partials(n){this._oscillator.partials=n,this._setStoppedValue()}get phase(){return this._oscillator.phase}set phase(n){this._oscillator.phase=n,this._setStoppedValue()}get units(){return this._units}set units(n){const o=this.min,c=this.max;this._units=n,this.min=o,this.max=c}get state(){return this._oscillator.state}connect(n,o,c){return(n instanceof kt||n instanceof Mt)&&(this.convert=n.convert,this.units=n.units),Nr(this,n,o,c),this}dispose(){return super.dispose(),this._oscillator.dispose(),this._stoppedSignal.dispose(),this._zeros.dispose(),this._scaler.dispose(),this._a2g.dispose(),this._amplitudeGain.dispose(),this.amplitude.dispose(),this}}function Vp(p,n=1/0){const o=new WeakMap;return function(c,f){Reflect.defineProperty(c,f,{configurable:!0,enumerable:!0,get:function(){return o.get(this)},set:function(w){os(w,p,n),o.set(this,w)}})}}function qn(p,n=1/0){const o=new WeakMap;return function(c,f){Reflect.defineProperty(c,f,{configurable:!0,enumerable:!0,get:function(){return o.get(this)},set:function(w){os(this.toSeconds(w),p,n),o.set(this,w)}})}}class WA extends Me{constructor(){const n=et(WA.getDefaults(),arguments,["url","onload"]);super(n),this.name="Player",this._activeSources=new Set,this._buffer=new Jt({onload:this._onload.bind(this,n.onload),onerror:n.onerror,reverse:n.reverse,url:n.url}),this.autostart=n.autostart,this._loop=n.loop,this._loopStart=n.loopStart,this._loopEnd=n.loopEnd,this._playbackRate=n.playbackRate,this.fadeIn=n.fadeIn,this.fadeOut=n.fadeOut}static getDefaults(){return Object.assign(Me.getDefaults(),{autostart:!1,fadeIn:0,fadeOut:0,loop:!1,loopEnd:0,loopStart:0,onload:Wt,onerror:Wt,playbackRate:1,reverse:!1})}load(n){return de(this,void 0,void 0,(function*(){return yield this._buffer.load(n),this._onload(),this}))}_onload(n=Wt){n(),this.autostart&&this.start()}_onSourceEnd(n){this.onstop(this),this._activeSources.delete(n),this._activeSources.size!==0||this._synced||this._state.getValueAtTime(this.now())!=="started"||(this._state.cancel(this.now()),this._state.setStateAtTime("stopped",this.now()))}start(n,o,c){return super.start(n,o,c),this}_start(n,o,c){o=this._loop?$s(o,this._loopStart):$s(o,0);const f=this.toSeconds(o),w=c;c=$s(c,Math.max(this._buffer.duration-f,0));let B=this.toSeconds(c);B/=this._playbackRate,n=this.toSeconds(n);const b=new fi({url:this._buffer,context:this.context,fadeIn:this.fadeIn,fadeOut:this.fadeOut,loop:this._loop,loopEnd:this._loopEnd,loopStart:this._loopStart,onended:this._onSourceEnd.bind(this),playbackRate:this._playbackRate}).connect(this.output);this._loop||this._synced||(this._state.cancel(n+B),this._state.setStateAtTime("stopped",n+B,{implicitEnd:!0})),this._activeSources.add(b),this._loop&&Ss(w)?b.start(n,f):b.start(n,f,B-this.toSeconds(this.fadeOut))}_stop(n){const o=this.toSeconds(n);this._activeSources.forEach((c=>c.stop(o)))}restart(n,o,c){return super.restart(n,o,c),this}_restart(n,o,c){var f;(f=[...this._activeSources].pop())===null||f===void 0||f.stop(n),this._start(n,o,c)}seek(n,o){const c=this.toSeconds(o);if(this._state.getValueAtTime(c)==="started"){const f=this.toSeconds(n);this._stop(c),this._start(c,f)}return this}setLoopPoints(n,o){return this.loopStart=n,this.loopEnd=o,this}get loopStart(){return this._loopStart}set loopStart(n){this._loopStart=n,this.buffer.loaded&&os(this.toSeconds(n),0,this.buffer.duration),this._activeSources.forEach((o=>{o.loopStart=n}))}get loopEnd(){return this._loopEnd}set loopEnd(n){this._loopEnd=n,this.buffer.loaded&&os(this.toSeconds(n),0,this.buffer.duration),this._activeSources.forEach((o=>{o.loopEnd=n}))}get buffer(){return this._buffer}set buffer(n){this._buffer.set(n)}get loop(){return this._loop}set loop(n){if(this._loop!==n&&(this._loop=n,this._activeSources.forEach((o=>{o.loop=n})),n)){const o=this._state.getNextState("stopped",this.now());o&&this._state.cancel(o.time)}}get playbackRate(){return this._playbackRate}set playbackRate(n){this._playbackRate=n;const o=this.now(),c=this._state.getNextState("stopped",o);c&&c.implicitEnd&&(this._state.cancel(c.time),this._activeSources.forEach((f=>f.cancelStop()))),this._activeSources.forEach((f=>{f.playbackRate.setValueAtTime(n,o)}))}get reverse(){return this._buffer.reverse}set reverse(n){this._buffer.reverse=n}get loaded(){return this._buffer.loaded}dispose(){return super.dispose(),this._activeSources.forEach((n=>n.dispose())),this._activeSources.clear(),this._buffer.dispose(),this}}hn([qn(0)],WA.prototype,"fadeIn",void 0),hn([qn(0)],WA.prototype,"fadeOut",void 0);class uh extends at{constructor(){const n=et(uh.getDefaults(),arguments,["urls","onload"],"urls");super(n),this.name="Players",this.input=void 0,this._players=new Map,this._volume=this.output=new Vn({context:this.context,volume:n.volume}),this.volume=this._volume.volume,Ft(this,"volume"),this._buffers=new LA({urls:n.urls,onload:n.onload,baseUrl:n.baseUrl,onerror:n.onerror}),this.mute=n.mute,this._fadeIn=n.fadeIn,this._fadeOut=n.fadeOut}static getDefaults(){return Object.assign(Me.getDefaults(),{baseUrl:"",fadeIn:0,fadeOut:0,mute:!1,onload:Wt,onerror:Wt,urls:{},volume:0})}get mute(){return this._volume.mute}set mute(n){this._volume.mute=n}get fadeIn(){return this._fadeIn}set fadeIn(n){this._fadeIn=n,this._players.forEach((o=>{o.fadeIn=n}))}get fadeOut(){return this._fadeOut}set fadeOut(n){this._fadeOut=n,this._players.forEach((o=>{o.fadeOut=n}))}get state(){return Array.from(this._players).some((([n,o])=>o.state==="started"))?"started":"stopped"}has(n){return this._buffers.has(n)}player(n){if(Et(this.has(n),`No Player with the name ${n} exists on this object`),!this._players.has(n)){const o=new WA({context:this.context,fadeIn:this._fadeIn,fadeOut:this._fadeOut,url:this._buffers.get(n)}).connect(this.output);this._players.set(n,o)}return this._players.get(n)}get loaded(){return this._buffers.loaded}add(n,o,c){return Et(!this._buffers.has(n),"A buffer with that name already exists on this object"),this._buffers.add(n,o,c),this}stopAll(n){return this._players.forEach((o=>o.stop(n))),this}dispose(){return super.dispose(),this._volume.dispose(),this.volume.dispose(),this._players.forEach((n=>n.dispose())),this._buffers.dispose(),this}}class dh extends Me{constructor(){const n=et(dh.getDefaults(),arguments,["url","onload"]);super(n),this.name="GrainPlayer",this._loopStart=0,this._loopEnd=0,this._activeSources=[],this.buffer=new Jt({onload:n.onload,onerror:n.onerror,reverse:n.reverse,url:n.url}),this._clock=new DA({context:this.context,callback:this._tick.bind(this),frequency:1/n.grainSize}),this._playbackRate=n.playbackRate,this._grainSize=n.grainSize,this._overlap=n.overlap,this.detune=n.detune,this.overlap=n.overlap,this.loop=n.loop,this.playbackRate=n.playbackRate,this.grainSize=n.grainSize,this.loopStart=n.loopStart,this.loopEnd=n.loopEnd,this.reverse=n.reverse,this._clock.on("stop",this._onstop.bind(this))}static getDefaults(){return Object.assign(Me.getDefaults(),{onload:Wt,onerror:Wt,overlap:.1,grainSize:.2,playbackRate:1,detune:0,loop:!1,loopStart:0,loopEnd:0,reverse:!1})}_start(n,o,c){o=$s(o,0),o=this.toSeconds(o),n=this.toSeconds(n);const f=1/this._clock.frequency.getValueAtTime(n);this._clock.start(n,o/f),c&&this.stop(n+this.toSeconds(c))}restart(n,o,c){return super.restart(n,o,c),this}_restart(n,o,c){this._stop(n),this._start(n,o,c)}_stop(n){this._clock.stop(n)}_onstop(n){this._activeSources.forEach((o=>{o.fadeOut=0,o.stop(n)})),this.onstop(this)}_tick(n){const o=this._clock.getTicksAtTime(n),c=o*this._grainSize;if(this.log("offset",c),!this.loop&&c>this.buffer.duration)return void this.stop(n);const f=c<this._overlap?0:this._overlap,w=new fi({context:this.context,url:this.buffer,fadeIn:f,fadeOut:this._overlap,loop:this.loop,loopStart:this._loopStart,loopEnd:this._loopEnd,playbackRate:UA(this.detune/100)}).connect(this.output);w.start(n,this._grainSize*o),w.stop(n+this._grainSize/this.playbackRate),this._activeSources.push(w),w.onended=()=>{const B=this._activeSources.indexOf(w);B!==-1&&this._activeSources.splice(B,1)}}get playbackRate(){return this._playbackRate}set playbackRate(n){os(n,.001),this._playbackRate=n,this.grainSize=this._grainSize}get loopStart(){return this._loopStart}set loopStart(n){this.buffer.loaded&&os(this.toSeconds(n),0,this.buffer.duration),this._loopStart=this.toSeconds(n)}get loopEnd(){return this._loopEnd}set loopEnd(n){this.buffer.loaded&&os(this.toSeconds(n),0,this.buffer.duration),this._loopEnd=this.toSeconds(n)}get reverse(){return this.buffer.reverse}set reverse(n){this.buffer.reverse=n}get grainSize(){return this._grainSize}set grainSize(n){this._grainSize=this.toSeconds(n),this._clock.frequency.setValueAtTime(this._playbackRate/this._grainSize,this.now())}get overlap(){return this._overlap}set overlap(n){const o=this.toSeconds(n);os(o,0),this._overlap=o}get loaded(){return this.buffer.loaded}dispose(){return super.dispose(),this.buffer.dispose(),this._clock.dispose(),this._activeSources.forEach((n=>n.dispose())),this}}class Wp extends Rs{constructor(){super(...arguments),this.name="Abs",this._abs=new dn({context:this.context,mapping:n=>Math.abs(n)<.001?0:Math.abs(n)}),this.input=this._abs,this.output=this._abs}dispose(){return super.dispose(),this._abs.dispose(),this}}class Gp extends Rs{constructor(){super(...arguments),this.name="GainToAudio",this._norm=new dn({context:this.context,mapping:n=>2*Math.abs(n)-1}),this.input=this._norm,this.output=this._norm}dispose(){return super.dispose(),this._norm.dispose(),this}}class fh extends Rs{constructor(){super(...arguments),this.name="Negate",this._multiply=new _e({context:this.context,value:-1}),this.input=this._multiply,this.output=this._multiply}dispose(){return super.dispose(),this._multiply.dispose(),this}}class Xi extends Mt{constructor(){super(et(Xi.getDefaults(),arguments,["value"])),this.override=!1,this.name="Subtract",this._sum=new xt({context:this.context}),this.input=this._sum,this.output=this._sum,this._neg=new fh({context:this.context}),this.subtrahend=this._param,Ls(this._constantSource,this._neg,this._sum)}static getDefaults(){return Object.assign(Mt.getDefaults(),{value:0})}dispose(){return super.dispose(),this._neg.dispose(),this._sum.dispose(),this}}class ka extends Rs{constructor(){super(et(ka.getDefaults(),arguments)),this.name="GreaterThanZero",this._thresh=this.output=new dn({context:this.context,length:127,mapping:n=>n<=0?0:1}),this._scale=this.input=new _e({context:this.context,value:1e4}),this._scale.connect(this._thresh)}dispose(){return super.dispose(),this._scale.dispose(),this._thresh.dispose(),this}}class Da extends Mt{constructor(){const n=et(Da.getDefaults(),arguments,["value"]);super(n),this.name="GreaterThan",this.override=!1,this._subtract=this.input=new Xi({context:this.context,value:n.value}),this._gtz=this.output=new ka({context:this.context}),this.comparator=this._param=this._subtract.subtrahend,Ft(this,"comparator"),this._subtract.connect(this._gtz)}static getDefaults(){return Object.assign(Mt.getDefaults(),{value:0})}dispose(){return super.dispose(),this._gtz.dispose(),this._subtract.dispose(),this.comparator.dispose(),this}}class La extends Kn{constructor(){const n=et(La.getDefaults(),arguments,["min","max","exponent"]);super(n),this.name="ScaleExp",this.input=this._exp=new RA({context:this.context,value:n.exponent}),this._exp.connect(this._mult)}static getDefaults(){return Object.assign(Kn.getDefaults(),{exponent:1})}get exponent(){return this._exp.value}set exponent(n){this._exp.value=n}dispose(){return super.dispose(),this._exp.dispose(),this}}class nC extends Mt{constructor(){const n=et(Mt.getDefaults(),arguments,["value","units"]);super(n),this.name="SyncedSignal",this.override=!1,this._lastVal=n.value,this._synced=this.context.transport.scheduleRepeat(this._onTick.bind(this),"1i"),this._syncedCallback=this._anchorValue.bind(this),this.context.transport.on("start",this._syncedCallback),this.context.transport.on("pause",this._syncedCallback),this.context.transport.on("stop",this._syncedCallback),this._constantSource.disconnect(),this._constantSource.stop(0),this._constantSource=this.output=new Qa({context:this.context,offset:n.value,units:n.units}).start(0),this.setValueAtTime(n.value,0)}_onTick(n){const o=super.getValueAtTime(this.context.transport.seconds);this._lastVal!==o&&(this._lastVal=o,this._constantSource.offset.setValueAtTime(o,n))}_anchorValue(n){const o=super.getValueAtTime(this.context.transport.seconds);this._lastVal=o,this._constantSource.offset.cancelAndHoldAtTime(n),this._constantSource.offset.setValueAtTime(o,n)}getValueAtTime(n){const o=new Ve(this.context,n).toSeconds();return super.getValueAtTime(o)}setValueAtTime(n,o){const c=new Ve(this.context,o).toSeconds();return super.setValueAtTime(n,c),this}linearRampToValueAtTime(n,o){const c=new Ve(this.context,o).toSeconds();return super.linearRampToValueAtTime(n,c),this}exponentialRampToValueAtTime(n,o){const c=new Ve(this.context,o).toSeconds();return super.exponentialRampToValueAtTime(n,c),this}setTargetAtTime(n,o,c){const f=new Ve(this.context,o).toSeconds();return super.setTargetAtTime(n,f,c),this}cancelScheduledValues(n){const o=new Ve(this.context,n).toSeconds();return super.cancelScheduledValues(o),this}setValueCurveAtTime(n,o,c,f){const w=new Ve(this.context,o).toSeconds();return c=this.toSeconds(c),super.setValueCurveAtTime(n,w,c,f),this}cancelAndHoldAtTime(n){const o=new Ve(this.context,n).toSeconds();return super.cancelAndHoldAtTime(o),this}setRampPoint(n){const o=new Ve(this.context,n).toSeconds();return super.setRampPoint(o),this}exponentialRampTo(n,o,c){const f=new Ve(this.context,c).toSeconds();return super.exponentialRampTo(n,o,f),this}linearRampTo(n,o,c){const f=new Ve(this.context,c).toSeconds();return super.linearRampTo(n,o,f),this}targetRampTo(n,o,c){const f=new Ve(this.context,c).toSeconds();return super.targetRampTo(n,o,f),this}dispose(){return super.dispose(),this.context.transport.clear(this._synced),this.context.transport.off("start",this._syncedCallback),this.context.transport.off("pause",this._syncedCallback),this.context.transport.off("stop",this._syncedCallback),this._constantSource.dispose(),this}}class ls extends at{constructor(){const n=et(ls.getDefaults(),arguments,["attack","decay","sustain","release"]);super(n),this.name="Envelope",this._sig=new Mt({context:this.context,value:0}),this.output=this._sig,this.input=void 0,this.attack=n.attack,this.decay=n.decay,this.sustain=n.sustain,this.release=n.release,this.attackCurve=n.attackCurve,this.releaseCurve=n.releaseCurve,this.decayCurve=n.decayCurve}static getDefaults(){return Object.assign(at.getDefaults(),{attack:.01,attackCurve:"linear",decay:.1,decayCurve:"exponential",release:1,releaseCurve:"exponential",sustain:.5})}get value(){return this.getValueAtTime(this.now())}_getCurve(n,o){if(cn(n))return n;{let c;for(c in Ha)if(Ha[c][o]===n)return c;return n}}_setCurve(n,o,c){if(cn(c)&&Reflect.has(Ha,c)){const f=Ha[c];On(f)?n!=="_decayCurve"&&(this[n]=f[o]):this[n]=f}else{if(!rs(c)||n==="_decayCurve")throw new Error("Envelope: invalid curve: "+c);this[n]=c}}get attackCurve(){return this._getCurve(this._attackCurve,"In")}set attackCurve(n){this._setCurve("_attackCurve","In",n)}get releaseCurve(){return this._getCurve(this._releaseCurve,"Out")}set releaseCurve(n){this._setCurve("_releaseCurve","Out",n)}get decayCurve(){return this._getCurve(this._decayCurve,"Out")}set decayCurve(n){this._setCurve("_decayCurve","Out",n)}triggerAttack(n,o=1){this.log("triggerAttack",n,o),n=this.toSeconds(n);let c=this.toSeconds(this.attack);const f=this.toSeconds(this.decay),w=this.getValueAtTime(n);if(w>0&&(c=(1-w)/(1/c)),c<this.sampleTime)this._sig.cancelScheduledValues(n),this._sig.setValueAtTime(o,n);else if(this._attackCurve==="linear")this._sig.linearRampTo(o,c,n);else if(this._attackCurve==="exponential")this._sig.targetRampTo(o,c,n);else{this._sig.cancelAndHoldAtTime(n);let B=this._attackCurve;for(let b=1;b<B.length;b++)if(B[b-1]<=w&&w<=B[b]){B=this._attackCurve.slice(b),B[0]=w;break}this._sig.setValueCurveAtTime(B,n,c,o)}if(f&&this.sustain<1){const B=o*this.sustain,b=n+c;this.log("decay",b),this._decayCurve==="linear"?this._sig.linearRampToValueAtTime(B,f+b):this._sig.exponentialApproachValueAtTime(B,b,f)}return this}triggerRelease(n){this.log("triggerRelease",n),n=this.toSeconds(n);const o=this.getValueAtTime(n);if(o>0){const c=this.toSeconds(this.release);c<this.sampleTime?this._sig.setValueAtTime(0,n):this._releaseCurve==="linear"?this._sig.linearRampTo(0,c,n):this._releaseCurve==="exponential"?this._sig.targetRampTo(0,c,n):(Et(rs(this._releaseCurve),"releaseCurve must be either 'linear', 'exponential' or an array"),this._sig.cancelAndHoldAtTime(n),this._sig.setValueCurveAtTime(this._releaseCurve,n,c,o))}return this}getValueAtTime(n){return this._sig.getValueAtTime(n)}triggerAttackRelease(n,o,c=1){return o=this.toSeconds(o),this.triggerAttack(o,c),this.triggerRelease(o+this.toSeconds(n)),this}cancel(n){return this._sig.cancelScheduledValues(this.toSeconds(n)),this}connect(n,o=0,c=0){return Nr(this,n,o,c),this}asArray(){return de(this,arguments,void 0,(function*(n=1024){const o=n/this.context.sampleRate,c=new QA(1,o,this.context.sampleRate),f=this.toSeconds(this.attack)+this.toSeconds(this.decay),w=f+this.toSeconds(this.release),B=.1*w,b=w+B,E=new this.constructor(Object.assign(this.get(),{attack:o*this.toSeconds(this.attack)/b,decay:o*this.toSeconds(this.decay)/b,release:o*this.toSeconds(this.release)/b,context:c}));return E._sig.toDestination(),E.triggerAttackRelease(o*(f+B)/b,0),(yield c.render()).getChannelData(0)}))}dispose(){return super.dispose(),this._sig.dispose(),this}}hn([qn(0)],ls.prototype,"attack",void 0),hn([qn(0)],ls.prototype,"decay",void 0),hn([Vp(0,1)],ls.prototype,"sustain",void 0),hn([qn(0)],ls.prototype,"release",void 0);const Ha=(()=>{let n,o;const c=[];for(n=0;n<128;n++)c[n]=Math.sin(n/127*(Math.PI/2));const f=[];for(n=0;n<127;n++){o=n/127;const Q=Math.sin(o*(2*Math.PI)*6.4-Math.PI/2)+1;f[n]=Q/10+.83*o}f[127]=1;const w=[];for(n=0;n<128;n++)w[n]=Math.ceil(n/127*5)/5;const B=[];for(n=0;n<128;n++)o=n/127,B[n]=.5*(1-Math.cos(Math.PI*o));const b=[];for(n=0;n<128;n++){o=n/127;const Q=4*Math.pow(o,3)+.2,M=Math.cos(Q*Math.PI*2*o);b[n]=Math.abs(M*(1-o))}function E(Q){const M=new Array(Q.length);for(let P=0;P<Q.length;P++)M[P]=1-Q[P];return M}return{bounce:{In:E(b),Out:b},cosine:{In:c,Out:(S=c,S.slice(0).reverse())},exponential:"exponential",linear:"linear",ripple:{In:f,Out:E(f)},sine:{In:B,Out:E(B)},step:{In:w,Out:E(w)}};var S})();class Xs extends at{constructor(){const n=et(Xs.getDefaults(),arguments);super(n),this._scheduledEvents=[],this._synced=!1,this._original_triggerAttack=this.triggerAttack,this._original_triggerRelease=this.triggerRelease,this._syncedRelease=o=>this._original_triggerRelease(o),this._volume=this.output=new Vn({context:this.context,volume:n.volume}),this.volume=this._volume.volume,Ft(this,"volume")}static getDefaults(){return Object.assign(at.getDefaults(),{volume:0})}sync(){return this._syncState()&&(this._syncMethod("triggerAttack",1),this._syncMethod("triggerRelease",0),this.context.transport.on("stop",this._syncedRelease),this.context.transport.on("pause",this._syncedRelease),this.context.transport.on("loopEnd",this._syncedRelease)),this}_syncState(){let n=!1;return this._synced||(this._synced=!0,n=!0),n}_syncMethod(n,o){const c=this["_original_"+n]=this[n];this[n]=(...f)=>{const w=f[o],B=this.context.transport.schedule((b=>{f[o]=b,c.apply(this,f)}),w);this._scheduledEvents.push(B)}}unsync(){return this._scheduledEvents.forEach((n=>this.context.transport.clear(n))),this._scheduledEvents=[],this._synced&&(this._synced=!1,this.triggerAttack=this._original_triggerAttack,this.triggerRelease=this._original_triggerRelease,this.context.transport.off("stop",this._syncedRelease),this.context.transport.off("pause",this._syncedRelease),this.context.transport.off("loopEnd",this._syncedRelease)),this}triggerAttackRelease(n,o,c,f){const w=this.toSeconds(c),B=this.toSeconds(o);return this.triggerAttack(n,w,f),this.triggerRelease(w+B),this}dispose(){return super.dispose(),this._volume.dispose(),this.unsync(),this._scheduledEvents=[],this}}class cs extends Xs{constructor(){const n=et(cs.getDefaults(),arguments);super(n),this.portamento=n.portamento,this.onsilence=n.onsilence}static getDefaults(){return Object.assign(Xs.getDefaults(),{detune:0,onsilence:Wt,portamento:0})}triggerAttack(n,o,c=1){this.log("triggerAttack",n,o,c);const f=this.toSeconds(o);return this._triggerEnvelopeAttack(f,c),this.setNote(n,f),this}triggerRelease(n){this.log("triggerRelease",n);const o=this.toSeconds(n);return this._triggerEnvelopeRelease(o),this}setNote(n,o){const c=this.toSeconds(o),f=n instanceof Bs?n.toFrequency():n;if(this.portamento>0&&this.getLevelAtTime(c)>.05){const w=this.toSeconds(this.portamento);this.frequency.exponentialRampTo(f,w,c)}else this.frequency.setValueAtTime(f,c);return this}}hn([qn(0)],cs.prototype,"portamento",void 0);class GA extends ls{constructor(){super(et(GA.getDefaults(),arguments,["attack","decay","sustain","release"])),this.name="AmplitudeEnvelope",this._gainNode=new xt({context:this.context,gain:0}),this.output=this._gainNode,this.input=this._gainNode,this._sig.connect(this._gainNode.gain),this.output=this._gainNode,this.input=this._gainNode}dispose(){return super.dispose(),this._gainNode.dispose(),this}}class mi extends cs{constructor(){const n=et(mi.getDefaults(),arguments);super(n),this.name="Synth",this.oscillator=new Gn(Object.assign({context:this.context,detune:n.detune,onstop:()=>this.onsilence(this)},n.oscillator)),this.frequency=this.oscillator.frequency,this.detune=this.oscillator.detune,this.envelope=new GA(Object.assign({context:this.context},n.envelope)),this.oscillator.chain(this.envelope,this.output),Ft(this,["oscillator","frequency","detune","envelope"])}static getDefaults(){return Object.assign(cs.getDefaults(),{envelope:Object.assign(as(ls.getDefaults(),Object.keys(at.getDefaults())),{attack:.005,decay:.1,release:1,sustain:.3}),oscillator:Object.assign(as(Gn.getDefaults(),[...Object.keys(Me.getDefaults()),"frequency","detune"]),{type:"triangle"})})}_triggerEnvelopeAttack(n,o){if(this.envelope.triggerAttack(n,o),this.oscillator.start(n),this.envelope.sustain===0){const c=this.toSeconds(this.envelope.attack),f=this.toSeconds(this.envelope.decay);this.oscillator.stop(n+c+f)}}_triggerEnvelopeRelease(n){this.envelope.triggerRelease(n),this.oscillator.stop(n+this.toSeconds(this.envelope.release))}getLevelAtTime(n){return n=this.toSeconds(n),this.envelope.getValueAtTime(n)}dispose(){return super.dispose(),this.oscillator.dispose(),this.envelope.dispose(),this}}class zr extends cs{constructor(){const n=et(zr.getDefaults(),arguments);super(n),this.name="ModulationSynth",this._carrier=new mi({context:this.context,oscillator:n.oscillator,envelope:n.envelope,onsilence:()=>this.onsilence(this),volume:-10}),this._modulator=new mi({context:this.context,oscillator:n.modulation,envelope:n.modulationEnvelope,volume:-10}),this.oscillator=this._carrier.oscillator,this.envelope=this._carrier.envelope,this.modulation=this._modulator.oscillator,this.modulationEnvelope=this._modulator.envelope,this.frequency=new Mt({context:this.context,units:"frequency"}),this.detune=new Mt({context:this.context,value:n.detune,units:"cents"}),this.harmonicity=new _e({context:this.context,value:n.harmonicity,minValue:0}),this._modulationNode=new xt({context:this.context,gain:0}),Ft(this,["frequency","harmonicity","oscillator","envelope","modulation","modulationEnvelope","detune"])}static getDefaults(){return Object.assign(cs.getDefaults(),{harmonicity:3,oscillator:Object.assign(as(Gn.getDefaults(),[...Object.keys(Me.getDefaults()),"frequency","detune"]),{type:"sine"}),envelope:Object.assign(as(ls.getDefaults(),Object.keys(at.getDefaults())),{attack:.01,decay:.01,sustain:1,release:.5}),modulation:Object.assign(as(Gn.getDefaults(),[...Object.keys(Me.getDefaults()),"frequency","detune"]),{type:"square"}),modulationEnvelope:Object.assign(as(ls.getDefaults(),Object.keys(at.getDefaults())),{attack:.5,decay:0,sustain:1,release:.5})})}_triggerEnvelopeAttack(n,o){this._carrier._triggerEnvelopeAttack(n,o),this._modulator._triggerEnvelopeAttack(n,o)}_triggerEnvelopeRelease(n){return this._carrier._triggerEnvelopeRelease(n),this._modulator._triggerEnvelopeRelease(n),this}getLevelAtTime(n){return n=this.toSeconds(n),this.envelope.getValueAtTime(n)}dispose(){return super.dispose(),this._carrier.dispose(),this._modulator.dispose(),this.frequency.dispose(),this.detune.dispose(),this.harmonicity.dispose(),this._modulationNode.dispose(),this}}class ph extends zr{constructor(){super(et(ph.getDefaults(),arguments)),this.name="AMSynth",this._modulationScale=new Ua({context:this.context}),this.frequency.connect(this._carrier.frequency),this.frequency.chain(this.harmonicity,this._modulator.frequency),this.detune.fan(this._carrier.detune,this._modulator.detune),this._modulator.chain(this._modulationScale,this._modulationNode.gain),this._carrier.chain(this._modulationNode,this.output)}dispose(){return super.dispose(),this._modulationScale.dispose(),this}}class $r extends at{constructor(){const n=et($r.getDefaults(),arguments,["frequency","type"]);super(n),this.name="BiquadFilter",this._filter=this.context.createBiquadFilter(),this.input=this.output=this._filter,this.Q=new kt({context:this.context,units:"number",value:n.Q,param:this._filter.Q}),this.frequency=new kt({context:this.context,units:"frequency",value:n.frequency,param:this._filter.frequency}),this.detune=new kt({context:this.context,units:"cents",value:n.detune,param:this._filter.detune}),this.gain=new kt({context:this.context,units:"decibels",convert:!1,value:n.gain,param:this._filter.gain}),this.type=n.type}static getDefaults(){return Object.assign(at.getDefaults(),{Q:1,type:"lowpass",frequency:350,detune:0,gain:0})}get type(){return this._filter.type}set type(n){Et(["lowpass","highpass","bandpass","lowshelf","highshelf","notch","allpass","peaking"].indexOf(n)!==-1,`Invalid filter type: ${n}`),this._filter.type=n}getFrequencyResponse(n=128){const o=new Float32Array(n);for(let B=0;B<n;B++){const b=19980*Math.pow(B/n,2)+20;o[B]=b}const c=new Float32Array(n),f=new Float32Array(n),w=this.context.createBiquadFilter();return w.type=this.type,w.Q.value=this.Q.value,w.frequency.value=this.frequency.value,w.gain.value=this.gain.value,w.getFrequencyResponse(o,c,f),c}dispose(){return super.dispose(),this._filter.disconnect(),this.Q.dispose(),this.frequency.dispose(),this.gain.dispose(),this.detune.dispose(),this}}class Os extends at{constructor(){const n=et(Os.getDefaults(),arguments,["frequency","type","rolloff"]);super(n),this.name="Filter",this.input=new xt({context:this.context}),this.output=new xt({context:this.context}),this._filters=[],this._filters=[],this.Q=new Mt({context:this.context,units:"positive",value:n.Q}),this.frequency=new Mt({context:this.context,units:"frequency",value:n.frequency}),this.detune=new Mt({context:this.context,units:"cents",value:n.detune}),this.gain=new Mt({context:this.context,units:"decibels",convert:!1,value:n.gain}),this._type=n.type,this.rolloff=n.rolloff,Ft(this,["detune","frequency","gain","Q"])}static getDefaults(){return Object.assign(at.getDefaults(),{Q:1,detune:0,frequency:350,gain:0,rolloff:-12,type:"lowpass"})}get type(){return this._type}set type(n){Et(["lowpass","highpass","bandpass","lowshelf","highshelf","notch","allpass","peaking"].indexOf(n)!==-1,`Invalid filter type: ${n}`),this._type=n,this._filters.forEach((o=>o.type=n))}get rolloff(){return this._rolloff}set rolloff(n){const o=Us(n)?n:parseInt(n,10),c=[-12,-24,-48,-96];let f=c.indexOf(o);Et(f!==-1,`rolloff can only be ${c.join(", ")}`),f+=1,this._rolloff=o,this.input.disconnect(),this._filters.forEach((w=>w.disconnect())),this._filters=new Array(f);for(let w=0;w<f;w++){const B=new $r({context:this.context});B.type=this._type,this.frequency.connect(B.frequency),this.detune.connect(B.detune),this.Q.connect(B.Q),this.gain.connect(B.gain),this._filters[w]=B}this._internalChannels=this._filters,Ls(this.input,...this._internalChannels,this.output)}getFrequencyResponse(n=128){const o=new $r({frequency:this.frequency.value,gain:this.gain.value,Q:this.Q.value,type:this._type,detune:this.detune.value}),c=new Float32Array(n).map((()=>1));return this._filters.forEach((()=>{o.getFrequencyResponse(n).forEach(((f,w)=>c[w]*=f))})),o.dispose(),c}dispose(){return super.dispose(),this._filters.forEach((n=>{n.dispose()})),Hr(this,["detune","frequency","gain","Q"]),this.frequency.dispose(),this.Q.dispose(),this.detune.dispose(),this.gain.dispose(),this}}class Xr extends ls{constructor(){const n=et(Xr.getDefaults(),arguments,["attack","decay","sustain","release"]);super(n),this.name="FrequencyEnvelope",this._octaves=n.octaves,this._baseFrequency=this.toFrequency(n.baseFrequency),this._exponent=this.input=new RA({context:this.context,value:n.exponent}),this._scale=this.output=new Kn({context:this.context,min:this._baseFrequency,max:this._baseFrequency*Math.pow(2,this._octaves)}),this._sig.chain(this._exponent,this._scale)}static getDefaults(){return Object.assign(ls.getDefaults(),{baseFrequency:200,exponent:1,octaves:4})}get baseFrequency(){return this._baseFrequency}set baseFrequency(n){const o=this.toFrequency(n);os(o,0),this._baseFrequency=o,this._scale.min=this._baseFrequency,this.octaves=this._octaves}get octaves(){return this._octaves}set octaves(n){this._octaves=n,this._scale.max=this._baseFrequency*Math.pow(2,n)}get exponent(){return this._exponent.value}set exponent(n){this._exponent.value=n}dispose(){return super.dispose(),this._exponent.dispose(),this._scale.dispose(),this}}class Yi extends cs{constructor(){const n=et(Yi.getDefaults(),arguments);super(n),this.name="MonoSynth",this.oscillator=new Gn(Object.assign(n.oscillator,{context:this.context,detune:n.detune,onstop:()=>this.onsilence(this)})),this.frequency=this.oscillator.frequency,this.detune=this.oscillator.detune,this.filter=new Os(Object.assign(n.filter,{context:this.context})),this.filterEnvelope=new Xr(Object.assign(n.filterEnvelope,{context:this.context})),this.envelope=new GA(Object.assign(n.envelope,{context:this.context})),this.oscillator.chain(this.filter,this.envelope,this.output),this.filterEnvelope.connect(this.filter.frequency),Ft(this,["oscillator","frequency","detune","filter","filterEnvelope","envelope"])}static getDefaults(){return Object.assign(cs.getDefaults(),{envelope:Object.assign(as(ls.getDefaults(),Object.keys(at.getDefaults())),{attack:.005,decay:.1,release:1,sustain:.9}),filter:Object.assign(as(Os.getDefaults(),Object.keys(at.getDefaults())),{Q:1,rolloff:-12,type:"lowpass"}),filterEnvelope:Object.assign(as(Xr.getDefaults(),Object.keys(at.getDefaults())),{attack:.6,baseFrequency:200,decay:.2,exponent:2,octaves:3,release:2,sustain:.5}),oscillator:Object.assign(as(Gn.getDefaults(),Object.keys(Me.getDefaults())),{type:"sawtooth"})})}_triggerEnvelopeAttack(n,o=1){if(this.envelope.triggerAttack(n,o),this.filterEnvelope.triggerAttack(n),this.oscillator.start(n),this.envelope.sustain===0){const c=this.toSeconds(this.envelope.attack),f=this.toSeconds(this.envelope.decay);this.oscillator.stop(n+c+f)}}_triggerEnvelopeRelease(n){this.envelope.triggerRelease(n),this.filterEnvelope.triggerRelease(n),this.oscillator.stop(n+this.toSeconds(this.envelope.release))}getLevelAtTime(n){return n=this.toSeconds(n),this.envelope.getValueAtTime(n)}dispose(){return super.dispose(),this.oscillator.dispose(),this.envelope.dispose(),this.filterEnvelope.dispose(),this.filter.dispose(),this}}class mh extends cs{constructor(){const n=et(mh.getDefaults(),arguments);super(n),this.name="DuoSynth",this.voice0=new Yi(Object.assign(n.voice0,{context:this.context,onsilence:()=>this.onsilence(this)})),this.voice1=new Yi(Object.assign(n.voice1,{context:this.context})),this.harmonicity=new _e({context:this.context,units:"positive",value:n.harmonicity}),this._vibrato=new Cs({frequency:n.vibratoRate,context:this.context,min:-50,max:50}),this._vibrato.start(),this.vibratoRate=this._vibrato.frequency,this._vibratoGain=new xt({context:this.context,units:"normalRange",gain:n.vibratoAmount}),this.vibratoAmount=this._vibratoGain.gain,this.frequency=new Mt({context:this.context,units:"frequency",value:440}),this.detune=new Mt({context:this.context,units:"cents",value:n.detune}),this.frequency.connect(this.voice0.frequency),this.frequency.chain(this.harmonicity,this.voice1.frequency),this._vibrato.connect(this._vibratoGain),this._vibratoGain.fan(this.voice0.detune,this.voice1.detune),this.detune.fan(this.voice0.detune,this.voice1.detune),this.voice0.connect(this.output),this.voice1.connect(this.output),Ft(this,["voice0","voice1","frequency","vibratoAmount","vibratoRate"])}getLevelAtTime(n){return n=this.toSeconds(n),this.voice0.envelope.getValueAtTime(n)+this.voice1.envelope.getValueAtTime(n)}static getDefaults(){return zs(cs.getDefaults(),{vibratoAmount:.5,vibratoRate:5,harmonicity:1.5,voice0:zs(as(Yi.getDefaults(),Object.keys(cs.getDefaults())),{filterEnvelope:{attack:.01,decay:0,sustain:1,release:.5},envelope:{attack:.01,decay:0,sustain:1,release:.5}}),voice1:zs(as(Yi.getDefaults(),Object.keys(cs.getDefaults())),{filterEnvelope:{attack:.01,decay:0,sustain:1,release:.5},envelope:{attack:.01,decay:0,sustain:1,release:.5}})})}_triggerEnvelopeAttack(n,o){this.voice0._triggerEnvelopeAttack(n,o),this.voice1._triggerEnvelopeAttack(n,o)}_triggerEnvelopeRelease(n){return this.voice0._triggerEnvelopeRelease(n),this.voice1._triggerEnvelopeRelease(n),this}dispose(){return super.dispose(),this.voice0.dispose(),this.voice1.dispose(),this.frequency.dispose(),this.detune.dispose(),this._vibrato.dispose(),this.vibratoRate.dispose(),this._vibratoGain.dispose(),this.harmonicity.dispose(),this}}class gh extends zr{constructor(){const n=et(gh.getDefaults(),arguments);super(n),this.name="FMSynth",this.modulationIndex=new _e({context:this.context,value:n.modulationIndex}),this.frequency.connect(this._carrier.frequency),this.frequency.chain(this.harmonicity,this._modulator.frequency),this.frequency.chain(this.modulationIndex,this._modulationNode),this.detune.fan(this._carrier.detune,this._modulator.detune),this._modulator.connect(this._modulationNode.gain),this._modulationNode.connect(this._carrier.frequency),this._carrier.connect(this.output)}static getDefaults(){return Object.assign(zr.getDefaults(),{modulationIndex:10})}dispose(){return super.dispose(),this.modulationIndex.dispose(),this}}const Kp=[1,1.483,1.932,2.546,2.63,3.897];class wh extends cs{constructor(){const n=et(wh.getDefaults(),arguments);super(n),this.name="MetalSynth",this._oscillators=[],this._freqMultipliers=[],this.detune=new Mt({context:this.context,units:"cents",value:n.detune}),this.frequency=new Mt({context:this.context,units:"frequency"}),this._amplitude=new xt({context:this.context,gain:0}).connect(this.output),this._highpass=new Os({Q:0,context:this.context,type:"highpass"}).connect(this._amplitude);for(let o=0;o<Kp.length;o++){const c=new NA({context:this.context,harmonicity:n.harmonicity,modulationIndex:n.modulationIndex,modulationType:"square",onstop:o===0?()=>this.onsilence(this):Wt,type:"square"});c.connect(this._highpass),this._oscillators[o]=c;const f=new _e({context:this.context,value:Kp[o]});this._freqMultipliers[o]=f,this.frequency.chain(f,c.frequency),this.detune.connect(c.detune)}this._filterFreqScaler=new Kn({context:this.context,max:7e3,min:this.toFrequency(n.resonance)}),this.envelope=new ls({attack:n.envelope.attack,attackCurve:"linear",context:this.context,decay:n.envelope.decay,release:n.envelope.release,sustain:0}),this.envelope.chain(this._filterFreqScaler,this._highpass.frequency),this.envelope.connect(this._amplitude.gain),this._octaves=n.octaves,this.octaves=n.octaves}static getDefaults(){return zs(cs.getDefaults(),{envelope:Object.assign(as(ls.getDefaults(),Object.keys(at.getDefaults())),{attack:.001,decay:1.4,release:.2}),harmonicity:5.1,modulationIndex:32,octaves:1.5,resonance:4e3})}_triggerEnvelopeAttack(n,o=1){return this.envelope.triggerAttack(n,o),this._oscillators.forEach((c=>c.start(n))),this.envelope.sustain===0&&this._oscillators.forEach((c=>{c.stop(n+this.toSeconds(this.envelope.attack)+this.toSeconds(this.envelope.decay))})),this}_triggerEnvelopeRelease(n){return this.envelope.triggerRelease(n),this._oscillators.forEach((o=>o.stop(n+this.toSeconds(this.envelope.release)))),this}getLevelAtTime(n){return n=this.toSeconds(n),this.envelope.getValueAtTime(n)}get modulationIndex(){return this._oscillators[0].modulationIndex.value}set modulationIndex(n){this._oscillators.forEach((o=>o.modulationIndex.value=n))}get harmonicity(){return this._oscillators[0].harmonicity.value}set harmonicity(n){this._oscillators.forEach((o=>o.harmonicity.value=n))}get resonance(){return this._filterFreqScaler.min}set resonance(n){this._filterFreqScaler.min=this.toFrequency(n),this.octaves=this._octaves}get octaves(){return this._octaves}set octaves(n){this._octaves=n,this._filterFreqScaler.max=this._filterFreqScaler.min*Math.pow(2,n)}dispose(){return super.dispose(),this._oscillators.forEach((n=>n.dispose())),this._freqMultipliers.forEach((n=>n.dispose())),this.frequency.dispose(),this.detune.dispose(),this._filterFreqScaler.dispose(),this._amplitude.dispose(),this.envelope.dispose(),this._highpass.dispose(),this}}class Yr extends mi{constructor(){const n=et(Yr.getDefaults(),arguments);super(n),this.name="MembraneSynth",this.portamento=0,this.pitchDecay=n.pitchDecay,this.octaves=n.octaves,Ft(this,["oscillator","envelope"])}static getDefaults(){return zs(cs.getDefaults(),mi.getDefaults(),{envelope:{attack:.001,attackCurve:"exponential",decay:.4,release:1.4,sustain:.01},octaves:10,oscillator:{type:"sine"},pitchDecay:.05})}setNote(n,o){const c=this.toSeconds(o),f=this.toFrequency(n instanceof Bs?n.toFrequency():n),w=f*this.octaves;return this.oscillator.frequency.setValueAtTime(w,c),this.oscillator.frequency.exponentialRampToValueAtTime(f,c+this.toSeconds(this.pitchDecay)),this}dispose(){return super.dispose(),this}}hn([Vp(0)],Yr.prototype,"octaves",void 0),hn([qn(0)],Yr.prototype,"pitchDecay",void 0);class vh extends Xs{constructor(){const n=et(vh.getDefaults(),arguments);super(n),this.name="NoiseSynth",this.noise=new pi(Object.assign({context:this.context},n.noise)),this.envelope=new GA(Object.assign({context:this.context},n.envelope)),this.noise.chain(this.envelope,this.output)}static getDefaults(){return Object.assign(Xs.getDefaults(),{envelope:Object.assign(as(ls.getDefaults(),Object.keys(at.getDefaults())),{decay:.1,sustain:0}),noise:Object.assign(as(pi.getDefaults(),Object.keys(Me.getDefaults())),{type:"white"})})}triggerAttack(n,o=1){return n=this.toSeconds(n),this.envelope.triggerAttack(n,o),this.noise.start(n),this.envelope.sustain===0&&this.noise.stop(n+this.toSeconds(this.envelope.attack)+this.toSeconds(this.envelope.decay)),this}triggerRelease(n){return n=this.toSeconds(n),this.envelope.triggerRelease(n),this.noise.stop(n+this.toSeconds(this.envelope.release)),this}sync(){return this._syncState()&&(this._syncMethod("triggerAttack",0),this._syncMethod("triggerRelease",0)),this}triggerAttackRelease(n,o,c=1){return o=this.toSeconds(o),n=this.toSeconds(n),this.triggerAttack(o,c),this.triggerRelease(o+n),this}dispose(){return super.dispose(),this.noise.dispose(),this.envelope.dispose(),this}}const Bh=new Set;function yh(p){Bh.add(p)}function qp(p,n){const o=`registerProcessor("${p}", ${n})`;Bh.add(o)}class Ch extends at{constructor(n){super(n),this.name="ToneAudioWorklet",this.workletOptions={},this.onprocessorerror=Wt;const o=URL.createObjectURL(new Blob([Array.from(Bh).join(`
`)],{type:"text/javascript"})),c=this._audioWorkletName();this._dummyGain=this.context.createGain(),this._dummyParam=this._dummyGain.gain,this.context.addAudioWorkletModule(o).then((()=>{this.disposed||(this._worklet=this.context.createAudioWorkletNode(c,this.workletOptions),this._worklet.onprocessorerror=this.onprocessorerror.bind(this),this.onReady(this._worklet))}))}dispose(){return super.dispose(),this._dummyGain.disconnect(),this._worklet&&(this._worklet.port.postMessage("dispose"),this._worklet.disconnect()),this}}yh(`
	/**
	 * The base AudioWorkletProcessor for use in Tone.js. Works with the {@link ToneAudioWorklet}. 
	 */
	class ToneAudioWorkletProcessor extends AudioWorkletProcessor {

		constructor(options) {
			
			super(options);
			/**
			 * If the processor was disposed or not. Keep alive until it's disposed.
			 */
			this.disposed = false;
		   	/** 
			 * The number of samples in the processing block
			 */
			this.blockSize = 128;
			/**
			 * the sample rate
			 */
			this.sampleRate = sampleRate;

			this.port.onmessage = (event) => {
				// when it receives a dispose 
				if (event.data === "dispose") {
					this.disposed = true;
				}
			};
		}
	}
`),yh(`
	/**
	 * Abstract class for a single input/output processor. 
	 * has a 'generate' function which processes one sample at a time
	 */
	class SingleIOProcessor extends ToneAudioWorkletProcessor {

		constructor(options) {
			super(Object.assign(options, {
				numberOfInputs: 1,
				numberOfOutputs: 1
			}));
			/**
			 * Holds the name of the parameter and a single value of that
			 * parameter at the current sample
			 * @type { [name: string]: number }
			 */
			this.params = {}
		}

		/**
		 * Generate an output sample from the input sample and parameters
		 * @abstract
		 * @param input number
		 * @param channel number
		 * @param parameters { [name: string]: number }
		 * @returns number
		 */
		generate(){}

		/**
		 * Update the private params object with the 
		 * values of the parameters at the given index
		 * @param parameters { [name: string]: Float32Array },
		 * @param index number
		 */
		updateParams(parameters, index) {
			for (const paramName in parameters) {
				const param = parameters[paramName];
				if (param.length > 1) {
					this.params[paramName] = parameters[paramName][index];
				} else {
					this.params[paramName] = parameters[paramName][0];
				}
			}
		}

		/**
		 * Process a single frame of the audio
		 * @param inputs Float32Array[][]
		 * @param outputs Float32Array[][]
		 */
		process(inputs, outputs, parameters) {
			const input = inputs[0];
			const output = outputs[0];
			// get the parameter values
			const channelCount = Math.max(input && input.length || 0, output.length);
			for (let sample = 0; sample < this.blockSize; sample++) {
				this.updateParams(parameters, sample);
				for (let channel = 0; channel < channelCount; channel++) {
					const inputSample = input && input.length ? input[channel][sample] : 0;
					output[channel][sample] = this.generate(inputSample, channel, this.params);
				}
			}
			return !this.disposed;
		}
	};
`),yh(`
	/**
	 * A multichannel buffer for use within an AudioWorkletProcessor as a delay line
	 */
	class DelayLine {
		
		constructor(size, channels) {
			this.buffer = [];
			this.writeHead = []
			this.size = size;

			// create the empty channels
			for (let i = 0; i < channels; i++) {
				this.buffer[i] = new Float32Array(this.size);
				this.writeHead[i] = 0;
			}
		}

		/**
		 * Push a value onto the end
		 * @param channel number
		 * @param value number
		 */
		push(channel, value) {
			this.writeHead[channel] += 1;
			if (this.writeHead[channel] > this.size) {
				this.writeHead[channel] = 0;
			}
			this.buffer[channel][this.writeHead[channel]] = value;
		}

		/**
		 * Get the recorded value of the channel given the delay
		 * @param channel number
		 * @param delay number delay samples
		 */
		get(channel, delay) {
			let readHead = this.writeHead[channel] - Math.floor(delay);
			if (readHead < 0) {
				readHead += this.size;
			}
			return this.buffer[channel][readHead];
		}
	}
`);const zp="feedback-comb-filter";qp(zp,`
	class FeedbackCombFilterWorklet extends SingleIOProcessor {

		constructor(options) {
			super(options);
			this.delayLine = new DelayLine(this.sampleRate, options.channelCount || 2);
		}

		static get parameterDescriptors() {
			return [{
				name: "delayTime",
				defaultValue: 0.1,
				minValue: 0,
				maxValue: 1,
				automationRate: "k-rate"
			}, {
				name: "feedback",
				defaultValue: 0.5,
				minValue: 0,
				maxValue: 0.9999,
				automationRate: "k-rate"
			}];
		}

		generate(input, channel, parameters) {
			const delayedSample = this.delayLine.get(channel, parameters.delayTime * this.sampleRate);
			this.delayLine.push(channel, input + delayedSample * parameters.feedback);
			return delayedSample;
		}
	}
`);class jr extends Ch{constructor(){const n=et(jr.getDefaults(),arguments,["delayTime","resonance"]);super(n),this.name="FeedbackCombFilter",this.input=new xt({context:this.context}),this.output=new xt({context:this.context}),this.delayTime=new kt({context:this.context,value:n.delayTime,units:"time",minValue:0,maxValue:1,param:this._dummyParam,swappable:!0}),this.resonance=new kt({context:this.context,value:n.resonance,units:"normalRange",param:this._dummyParam,swappable:!0}),Ft(this,["resonance","delayTime"])}_audioWorkletName(){return zp}static getDefaults(){return Object.assign(at.getDefaults(),{delayTime:.1,resonance:.5})}onReady(n){Ls(this.input,n,this.output);const o=n.parameters.get("delayTime");this.delayTime.setParam(o);const c=n.parameters.get("feedback");this.resonance.setParam(c)}dispose(){return super.dispose(),this.input.dispose(),this.output.dispose(),this.delayTime.dispose(),this.resonance.dispose(),this}}class Jr extends at{constructor(){const n=et(Jr.getDefaults(),arguments,["frequency","type"]);super(n),this.name="OnePoleFilter",this._frequency=n.frequency,this._type=n.type,this.input=new xt({context:this.context}),this.output=new xt({context:this.context}),this._createFilter()}static getDefaults(){return Object.assign(at.getDefaults(),{frequency:880,type:"lowpass"})}_createFilter(){const n=this._filter,o=this.toFrequency(this._frequency),c=1/(2*Math.PI*o);if(this._type==="lowpass"){const f=1/(c*this.context.sampleRate),w=f-1;this._filter=this.context.createIIRFilter([f,0],[1,w])}else{const f=1/(c*this.context.sampleRate)-1;this._filter=this.context.createIIRFilter([1,-1],[1,f])}this.input.chain(this._filter,this.output),n&&this.context.setTimeout((()=>{this.disposed||(this.input.disconnect(n),n.disconnect())}),this.blockTime)}get frequency(){return this._frequency}set frequency(n){this._frequency=n,this._createFilter()}get type(){return this._type}set type(n){this._type=n,this._createFilter()}getFrequencyResponse(n=128){const o=new Float32Array(n);for(let w=0;w<n;w++){const B=19980*Math.pow(w/n,2)+20;o[w]=B}const c=new Float32Array(n),f=new Float32Array(n);return this._filter.getFrequencyResponse(o,c,f),c}dispose(){return super.dispose(),this.input.dispose(),this.output.dispose(),this._filter.disconnect(),this}}class Zr extends at{constructor(){const n=et(Zr.getDefaults(),arguments,["delayTime","resonance","dampening"]);super(n),this.name="LowpassCombFilter",this._combFilter=this.output=new jr({context:this.context,delayTime:n.delayTime,resonance:n.resonance}),this.delayTime=this._combFilter.delayTime,this.resonance=this._combFilter.resonance,this._lowpass=this.input=new Jr({context:this.context,frequency:n.dampening,type:"lowpass"}),this._lowpass.connect(this._combFilter)}static getDefaults(){return Object.assign(at.getDefaults(),{dampening:3e3,delayTime:.1,resonance:.5})}get dampening(){return this._lowpass.frequency}set dampening(n){this._lowpass.frequency=n}dispose(){return super.dispose(),this._combFilter.dispose(),this._lowpass.dispose(),this}}class bh extends Xs{constructor(){const n=et(bh.getDefaults(),arguments);super(n),this.name="PluckSynth",this._noise=new pi({context:this.context,type:"pink"}),this.attackNoise=n.attackNoise,this._lfcf=new Zr({context:this.context,dampening:n.dampening,resonance:n.resonance}),this.resonance=n.resonance,this.release=n.release,this._noise.connect(this._lfcf),this._lfcf.connect(this.output)}static getDefaults(){return zs(Xs.getDefaults(),{attackNoise:1,dampening:4e3,resonance:.7,release:1})}get dampening(){return this._lfcf.dampening}set dampening(n){this._lfcf.dampening=n}triggerAttack(n,o){const c=this.toFrequency(n);o=this.toSeconds(o);const f=1/c;return this._lfcf.delayTime.setValueAtTime(f,o),this._noise.start(o),this._noise.stop(o+f*this.attackNoise),this._lfcf.resonance.cancelScheduledValues(o),this._lfcf.resonance.setValueAtTime(this.resonance,o),this}triggerRelease(n){return this._lfcf.resonance.linearRampTo(0,this.release,n),this}dispose(){return super.dispose(),this._noise.dispose(),this._lfcf.dispose(),this}}class _h extends Xs{constructor(){const n=et(_h.getDefaults(),arguments,["voice","options"]);super(n),this.name="PolySynth",this._availableVoices=[],this._activeVoices=[],this._voices=[],this._gcTimeout=-1,this._averageActiveVoices=0,this._syncedRelease=f=>this.releaseAll(f),Et(!Us(n.voice),"DEPRECATED: The polyphony count is no longer the first argument.");const o=n.voice.getDefaults();this.options=Object.assign(o,n.options),this.voice=n.voice,this.maxPolyphony=n.maxPolyphony,this._dummyVoice=this._getNextAvailableVoice();const c=this._voices.indexOf(this._dummyVoice);this._voices.splice(c,1),this._gcTimeout=this.context.setInterval(this._collectGarbage.bind(this),1)}static getDefaults(){return Object.assign(Xs.getDefaults(),{maxPolyphony:32,options:{},voice:mi})}get activeVoices(){return this._activeVoices.length}_makeVoiceAvailable(n){this._availableVoices.push(n);const o=this._activeVoices.findIndex((c=>c.voice===n));this._activeVoices.splice(o,1)}_getNextAvailableVoice(){if(this._availableVoices.length)return this._availableVoices.shift();if(this._voices.length<this.maxPolyphony){const n=new this.voice(Object.assign(this.options,{context:this.context,onsilence:this._makeVoiceAvailable.bind(this)}));return Et(n instanceof cs,"Voice must extend Monophonic class"),n.connect(this.output),this._voices.push(n),n}EA("Max polyphony exceeded. Note dropped.")}_collectGarbage(){if(this._averageActiveVoices=Math.max(.95*this._averageActiveVoices,this.activeVoices),this._availableVoices.length&&this._voices.length>Math.ceil(this._averageActiveVoices+1)){const n=this._availableVoices.shift(),o=this._voices.indexOf(n);this._voices.splice(o,1),this.context.isOffline||n.dispose()}}_triggerAttack(n,o,c){n.forEach((f=>{const w=new HA(this.context,f).toMidi(),B=this._getNextAvailableVoice();B&&(B.triggerAttack(f,o,c),this._activeVoices.push({midi:w,voice:B,released:!1}),this.log("triggerAttack",f,o))}))}_triggerRelease(n,o){n.forEach((c=>{const f=new HA(this.context,c).toMidi(),w=this._activeVoices.find((({midi:B,released:b})=>B===f&&!b));w&&(w.voice.triggerRelease(o),w.released=!0,this.log("triggerRelease",c,o))}))}_scheduleEvent(n,o,c,f){Et(!this.disposed,"Synth was already disposed"),c<=this.now()?n==="attack"?this._triggerAttack(o,c,f):this._triggerRelease(o,c):this.context.setTimeout((()=>{this.disposed||this._scheduleEvent(n,o,c,f)}),c-this.now())}triggerAttack(n,o,c){Array.isArray(n)||(n=[n]);const f=this.toSeconds(o);return this._scheduleEvent("attack",n,f,c),this}triggerRelease(n,o){Array.isArray(n)||(n=[n]);const c=this.toSeconds(o);return this._scheduleEvent("release",n,c),this}triggerAttackRelease(n,o,c,f){const w=this.toSeconds(c);if(this.triggerAttack(n,w,f),rs(o)){Et(rs(n),"If the duration is an array, the notes must also be an array");for(let B=0;B<n.length;B++){const b=o[Math.min(B,o.length-1)],E=this.toSeconds(b);Et(E>0,"The duration must be greater than 0"),this.triggerRelease(n[B],w+E)}}else{const B=this.toSeconds(o);Et(B>0,"The duration must be greater than 0"),this.triggerRelease(n,w+B)}return this}sync(){return this._syncState()&&(this._syncMethod("triggerAttack",1),this._syncMethod("triggerRelease",1),this.context.transport.on("stop",this._syncedRelease),this.context.transport.on("pause",this._syncedRelease),this.context.transport.on("loopEnd",this._syncedRelease)),this}set(n){const o=as(n,["onsilence","context"]);return this.options=zs(this.options,o),this._voices.forEach((c=>c.set(o))),this._dummyVoice.set(o),this}get(){return this._dummyVoice.get()}releaseAll(n){const o=this.toSeconds(n);return this._activeVoices.forEach((({voice:c})=>{c.triggerRelease(o)})),this}dispose(){return super.dispose(),this._dummyVoice.dispose(),this._voices.forEach((n=>n.dispose())),this._activeVoices=[],this._availableVoices=[],this.context.clearInterval(this._gcTimeout),this}}class to extends Xs{constructor(){const n=et(to.getDefaults(),arguments,["urls","onload","baseUrl"],"urls");super(n),this.name="Sampler",this._activeSources=new Map;const o={};Object.keys(n.urls).forEach((c=>{const f=parseInt(c,10);if(Et(Lr(c)||Us(f)&&isFinite(f),`url key is neither a note or midi pitch: ${c}`),Lr(c)){const w=new Bs(this.context,c).toMidi();o[w]=n.urls[c]}else Us(f)&&isFinite(f)&&(o[f]=n.urls[f])})),this._buffers=new LA({urls:o,onload:n.onload,baseUrl:n.baseUrl,onerror:n.onerror}),this.attack=n.attack,this.release=n.release,this.curve=n.curve,this._buffers.loaded&&Promise.resolve().then(n.onload)}static getDefaults(){return Object.assign(Xs.getDefaults(),{attack:0,baseUrl:"",curve:"exponential",onload:Wt,onerror:Wt,release:.1,urls:{}})}_findClosest(n){let o=0;for(;o<96;){if(this._buffers.has(n+o))return-o;if(this._buffers.has(n-o))return o;o++}throw new Error(`No available buffers for note: ${n}`)}triggerAttack(n,o,c=1){return this.log("triggerAttack",n,o,c),Array.isArray(n)||(n=[n]),n.forEach((f=>{const w=Hp(new Bs(this.context,f).toFrequency()),B=Math.round(w),b=w-B,E=this._findClosest(B),S=B-E,Q=this._buffers.get(S),M=UA(E+b),P=new fi({url:Q,context:this.context,curve:this.curve,fadeIn:this.attack,fadeOut:this.release,playbackRate:M}).connect(this.output);P.start(o,0,Q.duration/M,c),rs(this._activeSources.get(B))||this._activeSources.set(B,[]),this._activeSources.get(B).push(P),P.onended=()=>{if(this._activeSources&&this._activeSources.has(B)){const k=this._activeSources.get(B),W=k.indexOf(P);W!==-1&&k.splice(W,1)}}})),this}triggerRelease(n,o){return this.log("triggerRelease",n,o),Array.isArray(n)||(n=[n]),n.forEach((c=>{const f=new Bs(this.context,c).toMidi();if(this._activeSources.has(f)&&this._activeSources.get(f).length){const w=this._activeSources.get(f);o=this.toSeconds(o),w.forEach((B=>{B.stop(o)})),this._activeSources.set(f,[])}})),this}releaseAll(n){const o=this.toSeconds(n);return this._activeSources.forEach((c=>{for(;c.length;)c.shift().stop(o)})),this}sync(){return this._syncState()&&(this._syncMethod("triggerAttack",1),this._syncMethod("triggerRelease",1)),this}triggerAttackRelease(n,o,c,f=1){const w=this.toSeconds(c);return this.triggerAttack(n,w,f),rs(o)?(Et(rs(n),"notes must be an array when duration is array"),n.forEach(((B,b)=>{const E=o[Math.min(b,o.length-1)];this.triggerRelease(B,w+this.toSeconds(E))}))):this.triggerRelease(n,w+this.toSeconds(o)),this}add(n,o,c){if(Et(Lr(n)||isFinite(n),`note must be a pitch or midi: ${n}`),Lr(n)){const f=new Bs(this.context,n).toMidi();this._buffers.add(f,o,c)}else this._buffers.add(n,o,c);return this}get loaded(){return this._buffers.loaded}dispose(){return super.dispose(),this._buffers.dispose(),this._activeSources.forEach((n=>{n.forEach((o=>o.dispose()))})),this._activeSources.clear(),this}}hn([qn(0)],to.prototype,"attack",void 0),hn([qn(0)],to.prototype,"release",void 0);class En extends ts{constructor(){const n=et(En.getDefaults(),arguments,["callback","value"]);super(n),this.name="ToneEvent",this._state=new PA("stopped"),this._startOffset=0,this._loop=n.loop,this.callback=n.callback,this.value=n.value,this._loopStart=this.toTicks(n.loopStart),this._loopEnd=this.toTicks(n.loopEnd),this._playbackRate=n.playbackRate,this._probability=n.probability,this._humanize=n.humanize,this.mute=n.mute,this._playbackRate=n.playbackRate,this._state.increasing=!0,this._rescheduleEvents()}static getDefaults(){return Object.assign(ts.getDefaults(),{callback:Wt,humanize:!1,loop:!1,loopEnd:"1m",loopStart:0,mute:!1,playbackRate:1,probability:1,value:null})}_rescheduleEvents(n=-1){this._state.forEachFrom(n,(o=>{let c;if(o.state==="started"){o.id!==-1&&this.context.transport.clear(o.id);const f=o.time+Math.round(this.startOffset/this._playbackRate);if(this._loop===!0||Us(this._loop)&&this._loop>1){c=1/0,Us(this._loop)&&(c=this._loop*this._getLoopDuration());const w=this._state.getAfter(f);w!==null&&(c=Math.min(c,w.time-f)),c!==1/0&&(c=new Ce(this.context,c));const B=new Ce(this.context,this._getLoopDuration());o.id=this.context.transport.scheduleRepeat(this._tick.bind(this),B,new Ce(this.context,f),c)}else o.id=this.context.transport.schedule(this._tick.bind(this),new Ce(this.context,f))}}))}get state(){return this._state.getValueAtTime(this.context.transport.ticks)}get startOffset(){return this._startOffset}set startOffset(n){this._startOffset=n}get probability(){return this._probability}set probability(n){this._probability=n}get humanize(){return this._humanize}set humanize(n){this._humanize=n}start(n){const o=this.toTicks(n);return this._state.getValueAtTime(o)==="stopped"&&(this._state.add({id:-1,state:"started",time:o}),this._rescheduleEvents(o)),this}stop(n){this.cancel(n);const o=this.toTicks(n);if(this._state.getValueAtTime(o)==="started"){this._state.setStateAtTime("stopped",o,{id:-1});const c=this._state.getBefore(o);let f=o;c!==null&&(f=c.time),this._rescheduleEvents(f)}return this}cancel(n){n=$s(n,-1/0);const o=this.toTicks(n);return this._state.forEachFrom(o,(c=>{this.context.transport.clear(c.id)})),this._state.cancel(o),this}_tick(n){const o=this.context.transport.getTicksAtTime(n);if(!this.mute&&this._state.getValueAtTime(o)==="started"){if(this.probability<1&&Math.random()>this.probability)return;if(this.humanize){let c=.02;jc(this.humanize)||(c=this.toSeconds(this.humanize)),n+=(2*Math.random()-1)*c}this.callback(n,this.value)}}_getLoopDuration(){return(this._loopEnd-this._loopStart)/this._playbackRate}get loop(){return this._loop}set loop(n){this._loop=n,this._rescheduleEvents()}get playbackRate(){return this._playbackRate}set playbackRate(n){this._playbackRate=n,this._rescheduleEvents()}get loopEnd(){return new Ce(this.context,this._loopEnd).toSeconds()}set loopEnd(n){this._loopEnd=this.toTicks(n),this._loop&&this._rescheduleEvents()}get loopStart(){return new Ce(this.context,this._loopStart).toSeconds()}set loopStart(n){this._loopStart=this.toTicks(n),this._loop&&this._rescheduleEvents()}get progress(){if(this._loop){const n=this.context.transport.ticks,o=this._state.get(n);if(o!==null&&o.state==="started"){const c=this._getLoopDuration();return(n-o.time)%c/c}return 0}return 0}dispose(){return super.dispose(),this.cancel(),this._state.dispose(),this}}class eo extends ts{constructor(){const n=et(eo.getDefaults(),arguments,["callback","interval"]);super(n),this.name="Loop",this._event=new En({context:this.context,callback:this._tick.bind(this),loop:!0,loopEnd:n.interval,playbackRate:n.playbackRate,probability:n.probability,humanize:n.humanize}),this.callback=n.callback,this.iterations=n.iterations}static getDefaults(){return Object.assign(ts.getDefaults(),{interval:"4n",callback:Wt,playbackRate:1,iterations:1/0,probability:1,mute:!1,humanize:!1})}start(n){return this._event.start(n),this}stop(n){return this._event.stop(n),this}cancel(n){return this._event.cancel(n),this}_tick(n){this.callback(n)}get state(){return this._event.state}get progress(){return this._event.progress}get interval(){return this._event.loopEnd}set interval(n){this._event.loopEnd=n}get playbackRate(){return this._event.playbackRate}set playbackRate(n){this._event.playbackRate=n}get humanize(){return this._event.humanize}set humanize(n){this._event.humanize=n}get probability(){return this._event.probability}set probability(n){this._event.probability=n}get mute(){return this._event.mute}set mute(n){this._event.mute=n}get iterations(){return this._event.loop===!0?1/0:this._event.loop}set iterations(n){this._event.loop=n===1/0||n}dispose(){return super.dispose(),this._event.dispose(),this}}class so extends En{constructor(){const n=et(so.getDefaults(),arguments,["callback","events"]);super(n),this.name="Part",this._state=new PA("stopped"),this._events=new Set,this._state.increasing=!0,n.events.forEach((o=>{rs(o)?this.add(o[0],o[1]):this.add(o)}))}static getDefaults(){return Object.assign(En.getDefaults(),{events:[]})}start(n,o){const c=this.toTicks(n);if(this._state.getValueAtTime(c)!=="started"){o=$s(o,this._loop?this._loopStart:0),o=this._loop?$s(o,this._loopStart):$s(o,0);const f=this.toTicks(o);this._state.add({id:-1,offset:f,state:"started",time:c}),this._forEach((w=>{this._startNote(w,c,f)}))}return this}_startNote(n,o,c){o-=c,this._loop?n.startOffset>=this._loopStart&&n.startOffset<this._loopEnd?(n.startOffset<c&&(o+=this._getLoopDuration()),n.start(new Ce(this.context,o))):n.startOffset<this._loopStart&&n.startOffset>=c&&(n.loop=!1,n.start(new Ce(this.context,o))):n.startOffset>=c&&n.start(new Ce(this.context,o))}get startOffset(){return this._startOffset}set startOffset(n){this._startOffset=n,this._forEach((o=>{o.startOffset+=this._startOffset}))}stop(n){const o=this.toTicks(n);return this._state.cancel(o),this._state.setStateAtTime("stopped",o),this._forEach((c=>{c.stop(n)})),this}at(n,o){const c=new Ve(this.context,n).toTicks(),f=new Ce(this.context,1).toSeconds(),w=this._events.values();let B=w.next();for(;!B.done;){const b=B.value;if(Math.abs(c-b.startOffset)<f)return Ot(o)&&(b.value=o),b;B=w.next()}return Ot(o)?(this.add(n,o),this.at(n)):null}add(n,o){n instanceof Object&&Reflect.has(n,"time")&&(n=(o=n).time);const c=this.toTicks(n);let f;return o instanceof En?(f=o,f.callback=this._tick.bind(this)):f=new En({callback:this._tick.bind(this),context:this.context,value:o}),f.startOffset=c,f.set({humanize:this.humanize,loop:this.loop,loopEnd:this.loopEnd,loopStart:this.loopStart,playbackRate:this.playbackRate,probability:this.probability}),this._events.add(f),this._restartEvent(f),this}_restartEvent(n){this._state.forEach((o=>{o.state==="started"?this._startNote(n,o.time,o.offset):n.stop(new Ce(this.context,o.time))}))}remove(n,o){return On(n)&&n.hasOwnProperty("time")&&(n=(o=n).time),n=this.toTicks(n),this._events.forEach((c=>{c.startOffset===n&&(Ss(o)||Ot(o)&&c.value===o)&&(this._events.delete(c),c.dispose())})),this}clear(){return this._forEach((n=>n.dispose())),this._events.clear(),this}cancel(n){return this._forEach((o=>o.cancel(n))),this._state.cancel(this.toTicks(n)),this}_forEach(n){return this._events&&this._events.forEach((o=>{o instanceof so?o._forEach(n):n(o)})),this}_setAll(n,o){this._forEach((c=>{c[n]=o}))}_tick(n,o){this.mute||this.callback(n,o)}_testLoopBoundries(n){this._loop&&(n.startOffset<this._loopStart||n.startOffset>=this._loopEnd)?n.cancel(0):n.state==="stopped"&&this._restartEvent(n)}get probability(){return this._probability}set probability(n){this._probability=n,this._setAll("probability",n)}get humanize(){return this._humanize}set humanize(n){this._humanize=n,this._setAll("humanize",n)}get loop(){return this._loop}set loop(n){this._loop=n,this._forEach((o=>{o.loopStart=this.loopStart,o.loopEnd=this.loopEnd,o.loop=n,this._testLoopBoundries(o)}))}get loopEnd(){return new Ce(this.context,this._loopEnd).toSeconds()}set loopEnd(n){this._loopEnd=this.toTicks(n),this._loop&&this._forEach((o=>{o.loopEnd=n,this._testLoopBoundries(o)}))}get loopStart(){return new Ce(this.context,this._loopStart).toSeconds()}set loopStart(n){this._loopStart=this.toTicks(n),this._loop&&this._forEach((o=>{o.loopStart=this.loopStart,this._testLoopBoundries(o)}))}get playbackRate(){return this._playbackRate}set playbackRate(n){this._playbackRate=n,this._setAll("playbackRate",n)}get length(){return this._events.size}dispose(){return super.dispose(),this.clear(),this}}function*iC(p){let n=0;for(;n<p;)n=qi(n,0,p-1),yield n,n++}function*AC(p){let n=p-1;for(;n>=0;)n=qi(n,0,p-1),yield n,n--}function*no(p,n){for(;;)yield*n(p)}function*$p(p,n){let o=n?0:p-1;for(;;)o=qi(o,0,p-1),yield o,n?(o++,o>=p-1&&(n=!1)):(o--,o<=0&&(n=!0))}function*rC(p){let n=0,o=0;for(;n<p;)n=qi(n,0,p-1),yield n,o++,n+=o%2?2:-1}function*oC(p){let n=p-1,o=0;for(;n>=0;)n=qi(n,0,p-1),yield n,o++,n+=o%2?-2:1}function*aC(p){const n=[];for(let o=0;o<p;o++)n.push(o);for(;n.length>0;)yield qi(n.splice(Math.floor(n.length*Math.random()),1)[0],0,p-1)}function*Xp(p,n="up",o=0){switch(Et(p>=1,"The number of values must be at least one"),n){case"up":yield*no(p,iC);case"down":yield*no(p,AC);case"upDown":yield*$p(p,!0);case"downUp":yield*$p(p,!1);case"alternateUp":yield*no(p,rC);case"alternateDown":yield*no(p,oC);case"random":yield*(function*(c){for(;;)yield Math.floor(Math.random()*c)})(p);case"randomOnce":yield*no(p,aC);case"randomWalk":yield*(function*(c){let f=Math.floor(Math.random()*c);for(;;)f===0?f++:f===c-1||Math.random()<.5?f--:f++,yield f})(p)}}class xh extends eo{constructor(){const n=et(xh.getDefaults(),arguments,["callback","values","pattern"]);super(n),this.name="Pattern",this.callback=n.callback,this._values=n.values,this._pattern=Xp(n.values.length,n.pattern),this._type=n.pattern}static getDefaults(){return Object.assign(eo.getDefaults(),{pattern:"up",values:[],callback:Wt})}_tick(n){const o=this._pattern.next();this._index=o.value,this._value=this._values[o.value],this.callback(n,this._value)}get values(){return this._values}set values(n){this._values=n,this.pattern=this._type}get value(){return this._value}get index(){return this._index}get pattern(){return this._type}set pattern(n){this._type=n,this._pattern=Xp(this._values.length,this._type)}}class Eh extends En{constructor(){const n=et(Eh.getDefaults(),arguments,["callback","events","subdivision"]);super(n),this.name="Sequence",this._part=new so({callback:this._seqCallback.bind(this),context:this.context}),this._events=[],this._eventsArray=[],this._subdivision=this.toTicks(n.subdivision),this.events=n.events,this.loop=n.loop,this.loopStart=n.loopStart,this.loopEnd=n.loopEnd,this.playbackRate=n.playbackRate,this.probability=n.probability,this.humanize=n.humanize,this.mute=n.mute,this.playbackRate=n.playbackRate}static getDefaults(){return Object.assign(as(En.getDefaults(),["value"]),{events:[],loop:!0,loopEnd:0,loopStart:0,subdivision:"8n"})}_seqCallback(n,o){o===null||this.mute||this.callback(n,o)}get events(){return this._events}set events(n){this.clear(),this._eventsArray=n,this._events=this._createSequence(this._eventsArray),this._eventsUpdated()}start(n,o){return this._part.start(n,o&&this._indexTime(o)),this}stop(n){return this._part.stop(n),this}get subdivision(){return new Ce(this.context,this._subdivision).toSeconds()}_createSequence(n){return new Proxy(n,{get:(o,c)=>o[c],set:(o,c,f)=>(cn(c)&&isFinite(parseInt(c,10))&&rs(f)?o[c]=this._createSequence(f):o[c]=f,this._eventsUpdated(),!0)})}_eventsUpdated(){this._part.clear(),this._rescheduleSequence(this._eventsArray,this._subdivision,this.startOffset),this.loopEnd=this.loopEnd}_rescheduleSequence(n,o,c){n.forEach(((f,w)=>{const B=w*o+c;if(rs(f))this._rescheduleSequence(f,o/f.length,B);else{const b=new Ce(this.context,B,"i").toSeconds();this._part.add(b,f)}}))}_indexTime(n){return new Ce(this.context,n*this._subdivision+this.startOffset).toSeconds()}clear(){return this._part.clear(),this}dispose(){return super.dispose(),this._part.dispose(),this}get loop(){return this._part.loop}set loop(n){this._part.loop=n}get loopStart(){return this._loopStart}set loopStart(n){this._loopStart=n,this._part.loopStart=this._indexTime(n)}get loopEnd(){return this._loopEnd}set loopEnd(n){this._loopEnd=n,this._part.loopEnd=n===0?this._indexTime(this._eventsArray.length):this._indexTime(n)}get startOffset(){return this._part.startOffset}set startOffset(n){this._part.startOffset=n}get playbackRate(){return this._part.playbackRate}set playbackRate(n){this._part.playbackRate=n}get probability(){return this._part.probability}set probability(n){this._part.probability=n}get progress(){return this._part.progress}get humanize(){return this._part.humanize}set humanize(n){this._part.humanize=n}get length(){return this._part.length}}class KA extends at{constructor(){const n=et(KA.getDefaults(),arguments,["fade"]);super(n),this.name="CrossFade",this._panner=this.context.createStereoPanner(),this._split=this.context.createChannelSplitter(2),this._g2a=new Gp({context:this.context}),this.a=new xt({context:this.context,gain:0}),this.b=new xt({context:this.context,gain:0}),this.output=new xt({context:this.context}),this._internalChannels=[this.a,this.b],this.fade=new Mt({context:this.context,units:"normalRange",value:n.fade}),Ft(this,"fade"),this.context.getConstant(1).connect(this._panner),this._panner.connect(this._split),this._panner.channelCount=1,this._panner.channelCountMode="explicit",ys(this._split,this.a.gain,0),ys(this._split,this.b.gain,1),this.fade.chain(this._g2a,this._panner.pan),this.a.connect(this.output),this.b.connect(this.output)}static getDefaults(){return Object.assign(at.getDefaults(),{fade:.5})}dispose(){return super.dispose(),this.a.dispose(),this.b.dispose(),this.output.dispose(),this.fade.dispose(),this._g2a.dispose(),this._panner.disconnect(),this._split.disconnect(),this}}class qe extends at{constructor(n){super(n),this.name="Effect",this._dryWet=new KA({context:this.context}),this.wet=this._dryWet.fade,this.effectSend=new xt({context:this.context}),this.effectReturn=new xt({context:this.context}),this.input=new xt({context:this.context}),this.output=this._dryWet,this.input.fan(this._dryWet.a,this.effectSend),this.effectReturn.connect(this._dryWet.b),this.wet.setValueAtTime(n.wet,0),this._internalChannels=[this.effectReturn,this.effectSend],Ft(this,"wet")}static getDefaults(){return Object.assign(at.getDefaults(),{wet:1})}connectEffect(n){return this._internalChannels.push(n),this.effectSend.chain(n,this.effectReturn),this}dispose(){return super.dispose(),this._dryWet.dispose(),this.effectSend.dispose(),this.effectReturn.dispose(),this.wet.dispose(),this}}class Ra extends qe{constructor(n){super(n),this.name="LFOEffect",this._lfo=new Cs({context:this.context,frequency:n.frequency,amplitude:n.depth}),this.depth=this._lfo.amplitude,this.frequency=this._lfo.frequency,this.type=n.type,Ft(this,["frequency","depth"])}static getDefaults(){return Object.assign(qe.getDefaults(),{frequency:1,type:"sine",depth:1})}start(n){return this._lfo.start(n),this}stop(n){return this._lfo.stop(n),this}sync(){return this._lfo.sync(),this}unsync(){return this._lfo.unsync(),this}get type(){return this._lfo.type}set type(n){this._lfo.type=n}dispose(){return super.dispose(),this._lfo.dispose(),this.frequency.dispose(),this.depth.dispose(),this}}class Sh extends Ra{constructor(){const n=et(Sh.getDefaults(),arguments,["frequency","baseFrequency","octaves"]);super(n),this.name="AutoFilter",this.filter=new Os(Object.assign(n.filter,{context:this.context})),this.connectEffect(this.filter),this._lfo.connect(this.filter.frequency),this.octaves=n.octaves,this.baseFrequency=n.baseFrequency}static getDefaults(){return Object.assign(Ra.getDefaults(),{baseFrequency:200,octaves:2.6,filter:{type:"lowpass",rolloff:-12,Q:1}})}get baseFrequency(){return this._lfo.min}set baseFrequency(n){this._lfo.min=this.toFrequency(n),this.octaves=this._octaves}get octaves(){return this._octaves}set octaves(n){this._octaves=n,this._lfo.max=this._lfo.min*Math.pow(2,n)}dispose(){return super.dispose(),this.filter.dispose(),this}}class io extends at{constructor(){const n=et(io.getDefaults(),arguments,["pan"]);super(n),this.name="Panner",this._panner=this.context.createStereoPanner(),this.input=this._panner,this.output=this._panner,this.pan=new kt({context:this.context,param:this._panner.pan,value:n.pan,minValue:-1,maxValue:1}),this._panner.channelCount=n.channelCount,this._panner.channelCountMode="explicit",Ft(this,"pan")}static getDefaults(){return Object.assign(at.getDefaults(),{pan:0,channelCount:1})}dispose(){return super.dispose(),this._panner.disconnect(),this.pan.dispose(),this}}class Fh extends Ra{constructor(){const n=et(Fh.getDefaults(),arguments,["frequency"]);super(n),this.name="AutoPanner",this._panner=new io({context:this.context,channelCount:n.channelCount}),this.connectEffect(this._panner),this._lfo.connect(this._panner.pan),this._lfo.min=-1,this._lfo.max=1}static getDefaults(){return Object.assign(Ra.getDefaults(),{channelCount:1})}dispose(){return super.dispose(),this._panner.dispose(),this}}class Ao extends at{constructor(){const n=et(Ao.getDefaults(),arguments,["smoothing"]);super(n),this.name="Follower",this._abs=this.input=new Wp({context:this.context}),this._lowpass=this.output=new Jr({context:this.context,frequency:1/this.toSeconds(n.smoothing),type:"lowpass"}),this._abs.connect(this._lowpass),this._smoothing=n.smoothing}static getDefaults(){return Object.assign(at.getDefaults(),{smoothing:.05})}get smoothing(){return this._smoothing}set smoothing(n){this._smoothing=n,this._lowpass.frequency=1/this.toSeconds(this.smoothing)}dispose(){return super.dispose(),this._abs.dispose(),this._lowpass.dispose(),this}}class Th extends qe{constructor(){const n=et(Th.getDefaults(),arguments,["baseFrequency","octaves","sensitivity"]);super(n),this.name="AutoWah",this._follower=new Ao({context:this.context,smoothing:n.follower}),this._sweepRange=new La({context:this.context,min:0,max:1,exponent:.5}),this._baseFrequency=this.toFrequency(n.baseFrequency),this._octaves=n.octaves,this._inputBoost=new xt({context:this.context}),this._bandpass=new Os({context:this.context,rolloff:-48,frequency:0,Q:n.Q}),this._peaking=new Os({context:this.context,type:"peaking"}),this._peaking.gain.value=n.gain,this.gain=this._peaking.gain,this.Q=this._bandpass.Q,this.effectSend.chain(this._inputBoost,this._follower,this._sweepRange),this._sweepRange.connect(this._bandpass.frequency),this._sweepRange.connect(this._peaking.frequency),this.effectSend.chain(this._bandpass,this._peaking,this.effectReturn),this._setSweepRange(),this.sensitivity=n.sensitivity,Ft(this,["gain","Q"])}static getDefaults(){return Object.assign(qe.getDefaults(),{baseFrequency:100,octaves:6,sensitivity:0,Q:2,gain:2,follower:.2})}get octaves(){return this._octaves}set octaves(n){this._octaves=n,this._setSweepRange()}get follower(){return this._follower.smoothing}set follower(n){this._follower.smoothing=n}get baseFrequency(){return this._baseFrequency}set baseFrequency(n){this._baseFrequency=this.toFrequency(n),this._setSweepRange()}get sensitivity(){return Or(1/this._inputBoost.gain.value)}set sensitivity(n){this._inputBoost.gain.value=1/MA(n)}_setSweepRange(){this._sweepRange.min=this._baseFrequency,this._sweepRange.max=Math.min(this._baseFrequency*Math.pow(2,this._octaves),this.context.sampleRate/2)}dispose(){return super.dispose(),this._follower.dispose(),this._sweepRange.dispose(),this._bandpass.dispose(),this._peaking.dispose(),this._inputBoost.dispose(),this}}const Yp="bit-crusher";qp(Yp,`
	class BitCrusherWorklet extends SingleIOProcessor {

		static get parameterDescriptors() {
			return [{
				name: "bits",
				defaultValue: 12,
				minValue: 1,
				maxValue: 16,
				automationRate: 'k-rate'
			}];
		}

		generate(input, _channel, parameters) {
			const step = Math.pow(0.5, parameters.bits - 1);
			const val = step * Math.floor(input / step + 0.5);
			return val;
		}
	}
`);class Ih extends qe{constructor(){const n=et(Ih.getDefaults(),arguments,["bits"]);super(n),this.name="BitCrusher",this._bitCrusherWorklet=new Qh({context:this.context,bits:n.bits}),this.connectEffect(this._bitCrusherWorklet),this.bits=this._bitCrusherWorklet.bits}static getDefaults(){return Object.assign(qe.getDefaults(),{bits:4})}dispose(){return super.dispose(),this._bitCrusherWorklet.dispose(),this}}class Qh extends Ch{constructor(){const n=et(Qh.getDefaults(),arguments);super(n),this.name="BitCrusherWorklet",this.input=new xt({context:this.context}),this.output=new xt({context:this.context}),this.bits=new kt({context:this.context,value:n.bits,units:"positive",minValue:1,maxValue:16,param:this._dummyParam,swappable:!0})}static getDefaults(){return Object.assign(Ch.getDefaults(),{bits:12})}_audioWorkletName(){return Yp}onReady(n){Ls(this.input,n,this.output);const o=n.parameters.get("bits");this.bits.setParam(o)}dispose(){return super.dispose(),this.input.dispose(),this.output.dispose(),this.bits.dispose(),this}}class Mh extends qe{constructor(){const n=et(Mh.getDefaults(),arguments,["order"]);super(n),this.name="Chebyshev",this._shaper=new dn({context:this.context,length:4096}),this._order=n.order,this.connectEffect(this._shaper),this.order=n.order,this.oversample=n.oversample}static getDefaults(){return Object.assign(qe.getDefaults(),{order:1,oversample:"none"})}_getCoefficient(n,o,c){return c.has(o)||(o===0?c.set(o,0):o===1?c.set(o,n):c.set(o,2*n*this._getCoefficient(n,o-1,c)-this._getCoefficient(n,o-2,c))),c.get(o)}get order(){return this._order}set order(n){Et(Number.isInteger(n),"'order' must be an integer"),this._order=n,this._shaper.setMap((o=>this._getCoefficient(o,n,new Map)))}get oversample(){return this._shaper.oversample}set oversample(n){this._shaper.oversample=n}dispose(){return super.dispose(),this._shaper.dispose(),this}}class ji extends at{constructor(){const n=et(ji.getDefaults(),arguments,["channels"]);super(n),this.name="Split",this._splitter=this.input=this.output=this.context.createChannelSplitter(n.channels),this._internalChannels=[this._splitter]}static getDefaults(){return Object.assign(at.getDefaults(),{channels:2})}dispose(){return super.dispose(),this._splitter.disconnect(),this}}class gi extends at{constructor(){const n=et(gi.getDefaults(),arguments,["channels"]);super(n),this.name="Merge",this._merger=this.output=this.input=this.context.createChannelMerger(n.channels)}static getDefaults(){return Object.assign(at.getDefaults(),{channels:2})}dispose(){return super.dispose(),this._merger.disconnect(),this}}class Sn extends at{constructor(n){super(n),this.name="StereoEffect",this.input=new xt({context:this.context}),this.input.channelCount=2,this.input.channelCountMode="explicit",this._dryWet=this.output=new KA({context:this.context,fade:n.wet}),this.wet=this._dryWet.fade,this._split=new ji({context:this.context,channels:2}),this._merge=new gi({context:this.context,channels:2}),this.input.connect(this._split),this.input.connect(this._dryWet.a),this._merge.connect(this._dryWet.b),Ft(this,["wet"])}connectEffectLeft(...n){this._split.connect(n[0],0,0),Ls(...n),ys(n[n.length-1],this._merge,0,0)}connectEffectRight(...n){this._split.connect(n[0],1,0),Ls(...n),ys(n[n.length-1],this._merge,0,1)}static getDefaults(){return Object.assign(at.getDefaults(),{wet:1})}dispose(){return super.dispose(),this._dryWet.dispose(),this._split.dispose(),this._merge.dispose(),this}}class Uh extends Sn{constructor(n){super(n),this.feedback=new Mt({context:this.context,value:n.feedback,units:"normalRange"}),this._feedbackL=new xt({context:this.context}),this._feedbackR=new xt({context:this.context}),this._feedbackSplit=new ji({context:this.context,channels:2}),this._feedbackMerge=new gi({context:this.context,channels:2}),this._merge.connect(this._feedbackSplit),this._feedbackMerge.connect(this._split),this._feedbackSplit.connect(this._feedbackL,0,0),this._feedbackL.connect(this._feedbackMerge,0,0),this._feedbackSplit.connect(this._feedbackR,1,0),this._feedbackR.connect(this._feedbackMerge,0,1),this.feedback.fan(this._feedbackL.gain,this._feedbackR.gain),Ft(this,["feedback"])}static getDefaults(){return Object.assign(Sn.getDefaults(),{feedback:.5})}dispose(){return super.dispose(),this.feedback.dispose(),this._feedbackL.dispose(),this._feedbackR.dispose(),this._feedbackSplit.dispose(),this._feedbackMerge.dispose(),this}}class Ph extends Uh{constructor(){const n=et(Ph.getDefaults(),arguments,["frequency","delayTime","depth"]);super(n),this.name="Chorus",this._depth=n.depth,this._delayTime=n.delayTime/1e3,this._lfoL=new Cs({context:this.context,frequency:n.frequency,min:0,max:1}),this._lfoR=new Cs({context:this.context,frequency:n.frequency,min:0,max:1,phase:180}),this._delayNodeL=new Hs({context:this.context}),this._delayNodeR=new Hs({context:this.context}),this.frequency=this._lfoL.frequency,Ft(this,["frequency"]),this._lfoL.frequency.connect(this._lfoR.frequency),this.connectEffectLeft(this._delayNodeL),this.connectEffectRight(this._delayNodeR),this._lfoL.connect(this._delayNodeL.delayTime),this._lfoR.connect(this._delayNodeR.delayTime),this.depth=this._depth,this.type=n.type,this.spread=n.spread}static getDefaults(){return Object.assign(Uh.getDefaults(),{frequency:1.5,delayTime:3.5,depth:.7,type:"sine",spread:180,feedback:0,wet:.5})}get depth(){return this._depth}set depth(n){this._depth=n;const o=this._delayTime*n;this._lfoL.min=Math.max(this._delayTime-o,0),this._lfoL.max=this._delayTime+o,this._lfoR.min=Math.max(this._delayTime-o,0),this._lfoR.max=this._delayTime+o}get delayTime(){return 1e3*this._delayTime}set delayTime(n){this._delayTime=n/1e3,this.depth=this._depth}get type(){return this._lfoL.type}set type(n){this._lfoL.type=n,this._lfoR.type=n}get spread(){return this._lfoR.phase-this._lfoL.phase}set spread(n){this._lfoL.phase=90-n/2,this._lfoR.phase=n/2+90}start(n){return this._lfoL.start(n),this._lfoR.start(n),this}stop(n){return this._lfoL.stop(n),this._lfoR.stop(n),this}sync(){return this._lfoL.sync(),this._lfoR.sync(),this}unsync(){return this._lfoL.unsync(),this._lfoR.unsync(),this}dispose(){return super.dispose(),this._lfoL.dispose(),this._lfoR.dispose(),this._delayNodeL.dispose(),this._delayNodeR.dispose(),this.frequency.dispose(),this}}class kh extends qe{constructor(){const n=et(kh.getDefaults(),arguments,["distortion"]);super(n),this.name="Distortion",this._shaper=new dn({context:this.context,length:4096}),this._distortion=n.distortion,this.connectEffect(this._shaper),this.distortion=n.distortion,this.oversample=n.oversample}static getDefaults(){return Object.assign(qe.getDefaults(),{distortion:.4,oversample:"none"})}get distortion(){return this._distortion}set distortion(n){this._distortion=n;const o=100*n,c=Math.PI/180;this._shaper.setMap((f=>Math.abs(f)<.001?0:(3+o)*f*20*c/(Math.PI+o*Math.abs(f))))}get oversample(){return this._shaper.oversample}set oversample(n){this._shaper.oversample=n}dispose(){return super.dispose(),this._shaper.dispose(),this}}class Oa extends qe{constructor(n){super(n),this.name="FeedbackEffect",this._feedbackGain=new xt({context:this.context,gain:n.feedback,units:"normalRange"}),this.feedback=this._feedbackGain.gain,Ft(this,"feedback"),this.effectReturn.chain(this._feedbackGain,this.effectSend)}static getDefaults(){return Object.assign(qe.getDefaults(),{feedback:.125})}dispose(){return super.dispose(),this._feedbackGain.dispose(),this.feedback.dispose(),this}}class Dh extends Oa{constructor(){const n=et(Dh.getDefaults(),arguments,["delayTime","feedback"]);super(n),this.name="FeedbackDelay",this._delayNode=new Hs({context:this.context,delayTime:n.delayTime,maxDelay:n.maxDelay}),this.delayTime=this._delayNode.delayTime,this.connectEffect(this._delayNode),Ft(this,"delayTime")}static getDefaults(){return Object.assign(Oa.getDefaults(),{delayTime:.25,maxDelay:1})}dispose(){return super.dispose(),this._delayNode.dispose(),this.delayTime.dispose(),this}}class lC extends at{constructor(n){super(n),this.name="PhaseShiftAllpass",this.input=new xt({context:this.context}),this.output=new xt({context:this.context}),this.offset90=new xt({context:this.context}),this._bank0=this._createAllPassFilterBank([.6923878,.9360654322959,.988229522686,.9987488452737]),this._bank1=this._createAllPassFilterBank([.4021921162426,.856171088242,.9722909545651,.9952884791278]),this._oneSampleDelay=this.context.createIIRFilter([0,1],[1,0]),Ls(this.input,...this._bank0,this._oneSampleDelay,this.output),Ls(this.input,...this._bank1,this.offset90)}_createAllPassFilterBank(n){return n.map((o=>{const c=[[o*o,0,-1],[1,0,-o*o]];return this.context.createIIRFilter(c[0],c[1])}))}dispose(){return super.dispose(),this.input.dispose(),this.output.dispose(),this.offset90.dispose(),this._bank0.forEach((n=>n.disconnect())),this._bank1.forEach((n=>n.disconnect())),this._oneSampleDelay.disconnect(),this}}class Lh extends qe{constructor(){const n=et(Lh.getDefaults(),arguments,["frequency"]);super(n),this.name="FrequencyShifter",this.frequency=new Mt({context:this.context,units:"frequency",value:n.frequency,minValue:-this.context.sampleRate/2,maxValue:this.context.sampleRate/2}),this._sine=new Wr({context:this.context,type:"sine"}),this._cosine=new be({context:this.context,phase:-90,type:"sine"}),this._sineMultiply=new _e({context:this.context}),this._cosineMultiply=new _e({context:this.context}),this._negate=new fh({context:this.context}),this._add=new $i({context:this.context}),this._phaseShifter=new lC({context:this.context}),this.effectSend.connect(this._phaseShifter),this.frequency.fan(this._sine.frequency,this._cosine.frequency),this._phaseShifter.offset90.connect(this._cosineMultiply),this._cosine.connect(this._cosineMultiply.factor),this._phaseShifter.connect(this._sineMultiply),this._sine.connect(this._sineMultiply.factor),this._sineMultiply.connect(this._negate),this._cosineMultiply.connect(this._add),this._negate.connect(this._add.addend),this._add.connect(this.effectReturn);const o=this.immediate();this._sine.start(o),this._cosine.start(o)}static getDefaults(){return Object.assign(qe.getDefaults(),{frequency:0})}dispose(){return super.dispose(),this.frequency.dispose(),this._add.dispose(),this._cosine.dispose(),this._cosineMultiply.dispose(),this._negate.dispose(),this._phaseShifter.dispose(),this._sine.dispose(),this._sineMultiply.dispose(),this}}const jp=[1557/44100,1617/44100,1491/44100,1422/44100,1277/44100,1356/44100,1188/44100,1116/44100],Jp=[225,556,441,341];class Hh extends Sn{constructor(){const n=et(Hh.getDefaults(),arguments,["roomSize","dampening"]);super(n),this.name="Freeverb",this._combFilters=[],this._allpassFiltersL=[],this._allpassFiltersR=[],this.roomSize=new Mt({context:this.context,value:n.roomSize,units:"normalRange"}),this._allpassFiltersL=Jp.map((o=>{const c=this.context.createBiquadFilter();return c.type="allpass",c.frequency.value=o,c})),this._allpassFiltersR=Jp.map((o=>{const c=this.context.createBiquadFilter();return c.type="allpass",c.frequency.value=o,c})),this._combFilters=jp.map(((o,c)=>{const f=new Zr({context:this.context,dampening:n.dampening,delayTime:o});return c<jp.length/2?this.connectEffectLeft(f,...this._allpassFiltersL):this.connectEffectRight(f,...this._allpassFiltersR),this.roomSize.connect(f.resonance),f})),Ft(this,["roomSize"])}static getDefaults(){return Object.assign(Sn.getDefaults(),{roomSize:.7,dampening:3e3})}get dampening(){return this._combFilters[0].dampening}set dampening(n){this._combFilters.forEach((o=>o.dampening=n))}dispose(){return super.dispose(),this._allpassFiltersL.forEach((n=>n.disconnect())),this._allpassFiltersR.forEach((n=>n.disconnect())),this._combFilters.forEach((n=>n.dispose())),this.roomSize.dispose(),this}}const Zp=[.06748,.06404,.08212,.09004],cC=[.773,.802,.753,.733],hC=[347,113,37];class Rh extends Sn{constructor(){const n=et(Rh.getDefaults(),arguments,["roomSize"]);super(n),this.name="JCReverb",this._allpassFilters=[],this._feedbackCombFilters=[],this.roomSize=new Mt({context:this.context,value:n.roomSize,units:"normalRange"}),this._scaleRoomSize=new Kn({context:this.context,min:-.733,max:.197}),this._allpassFilters=hC.map((o=>{const c=this.context.createBiquadFilter();return c.type="allpass",c.frequency.value=o,c})),this._feedbackCombFilters=Zp.map(((o,c)=>{const f=new jr({context:this.context,delayTime:o});return this._scaleRoomSize.connect(f.resonance),f.resonance.value=cC[c],c<Zp.length/2?this.connectEffectLeft(...this._allpassFilters,f):this.connectEffectRight(...this._allpassFilters,f),f})),this.roomSize.connect(this._scaleRoomSize),Ft(this,["roomSize"])}static getDefaults(){return Object.assign(Sn.getDefaults(),{roomSize:.5})}dispose(){return super.dispose(),this._allpassFilters.forEach((n=>n.disconnect())),this._feedbackCombFilters.forEach((n=>n.dispose())),this.roomSize.dispose(),this._scaleRoomSize.dispose(),this}}class tm extends Uh{constructor(n){super(n),this._feedbackL.disconnect(),this._feedbackL.connect(this._feedbackMerge,0,1),this._feedbackR.disconnect(),this._feedbackR.connect(this._feedbackMerge,0,0),Ft(this,["feedback"])}}class Oh extends tm{constructor(){const n=et(Oh.getDefaults(),arguments,["delayTime","feedback"]);super(n),this.name="PingPongDelay",this._leftDelay=new Hs({context:this.context,maxDelay:n.maxDelay}),this._rightDelay=new Hs({context:this.context,maxDelay:n.maxDelay}),this._rightPreDelay=new Hs({context:this.context,maxDelay:n.maxDelay}),this.delayTime=new Mt({context:this.context,units:"time",value:n.delayTime}),this.connectEffectLeft(this._leftDelay),this.connectEffectRight(this._rightPreDelay,this._rightDelay),this.delayTime.fan(this._leftDelay.delayTime,this._rightDelay.delayTime,this._rightPreDelay.delayTime),this._feedbackL.disconnect(),this._feedbackL.connect(this._rightDelay),Ft(this,["delayTime"])}static getDefaults(){return Object.assign(tm.getDefaults(),{delayTime:.25,maxDelay:1})}dispose(){return super.dispose(),this._leftDelay.dispose(),this._rightDelay.dispose(),this._rightPreDelay.dispose(),this.delayTime.dispose(),this}}class Nh extends Oa{constructor(){const n=et(Nh.getDefaults(),arguments,["pitch"]);super(n),this.name="PitchShift",this._frequency=new Mt({context:this.context}),this._delayA=new Hs({maxDelay:1,context:this.context}),this._lfoA=new Cs({context:this.context,min:0,max:.1,type:"sawtooth"}).connect(this._delayA.delayTime),this._delayB=new Hs({maxDelay:1,context:this.context}),this._lfoB=new Cs({context:this.context,min:0,max:.1,type:"sawtooth",phase:180}).connect(this._delayB.delayTime),this._crossFade=new KA({context:this.context}),this._crossFadeLFO=new Cs({context:this.context,min:0,max:1,type:"triangle",phase:90}).connect(this._crossFade.fade),this._feedbackDelay=new Hs({delayTime:n.delayTime,context:this.context}),this.delayTime=this._feedbackDelay.delayTime,Ft(this,"delayTime"),this._pitch=n.pitch,this._windowSize=n.windowSize,this._delayA.connect(this._crossFade.a),this._delayB.connect(this._crossFade.b),this._frequency.fan(this._lfoA.frequency,this._lfoB.frequency,this._crossFadeLFO.frequency),this.effectSend.fan(this._delayA,this._delayB),this._crossFade.chain(this._feedbackDelay,this.effectReturn);const o=this.now();this._lfoA.start(o),this._lfoB.start(o),this._crossFadeLFO.start(o),this.windowSize=this._windowSize}static getDefaults(){return Object.assign(Oa.getDefaults(),{pitch:0,windowSize:.1,delayTime:0,feedback:0})}get pitch(){return this._pitch}set pitch(n){this._pitch=n;let o=0;n<0?(this._lfoA.min=0,this._lfoA.max=this._windowSize,this._lfoB.min=0,this._lfoB.max=this._windowSize,o=UA(n-1)+1):(this._lfoA.min=this._windowSize,this._lfoA.max=0,this._lfoB.min=this._windowSize,this._lfoB.max=0,o=UA(n)-1),this._frequency.value=o*(1.2/this._windowSize)}get windowSize(){return this._windowSize}set windowSize(n){this._windowSize=this.toSeconds(n),this.pitch=this._pitch}dispose(){return super.dispose(),this._frequency.dispose(),this._delayA.dispose(),this._delayB.dispose(),this._lfoA.dispose(),this._lfoB.dispose(),this._crossFade.dispose(),this._crossFadeLFO.dispose(),this._feedbackDelay.dispose(),this}}class Vh extends Sn{constructor(){const n=et(Vh.getDefaults(),arguments,["frequency","octaves","baseFrequency"]);super(n),this.name="Phaser",this._lfoL=new Cs({context:this.context,frequency:n.frequency,min:0,max:1}),this._lfoR=new Cs({context:this.context,frequency:n.frequency,min:0,max:1,phase:180}),this._baseFrequency=this.toFrequency(n.baseFrequency),this._octaves=n.octaves,this.Q=new Mt({context:this.context,value:n.Q,units:"positive"}),this._filtersL=this._makeFilters(n.stages,this._lfoL),this._filtersR=this._makeFilters(n.stages,this._lfoR),this.frequency=this._lfoL.frequency,this.frequency.value=n.frequency,this.connectEffectLeft(...this._filtersL),this.connectEffectRight(...this._filtersR),this._lfoL.frequency.connect(this._lfoR.frequency),this.baseFrequency=n.baseFrequency,this.octaves=n.octaves,this._lfoL.start(),this._lfoR.start(),Ft(this,["frequency","Q"])}static getDefaults(){return Object.assign(Sn.getDefaults(),{frequency:.5,octaves:3,stages:10,Q:10,baseFrequency:350})}_makeFilters(n,o){const c=[];for(let f=0;f<n;f++){const w=this.context.createBiquadFilter();w.type="allpass",this.Q.connect(w.Q),o.connect(w.frequency),c.push(w)}return c}get octaves(){return this._octaves}set octaves(n){this._octaves=n;const o=this._baseFrequency*Math.pow(2,n);this._lfoL.max=o,this._lfoR.max=o}get baseFrequency(){return this._baseFrequency}set baseFrequency(n){this._baseFrequency=this.toFrequency(n),this._lfoL.min=this._baseFrequency,this._lfoR.min=this._baseFrequency,this.octaves=this._octaves}dispose(){return super.dispose(),this.Q.dispose(),this._lfoL.dispose(),this._lfoR.dispose(),this._filtersL.forEach((n=>n.disconnect())),this._filtersR.forEach((n=>n.disconnect())),this.frequency.dispose(),this}}class Wh extends qe{constructor(){const n=et(Wh.getDefaults(),arguments,["decay"]);super(n),this.name="Reverb",this._convolver=this.context.createConvolver(),this.ready=Promise.resolve(),this._decay=n.decay,this._preDelay=n.preDelay,this.generate(),this.connectEffect(this._convolver)}static getDefaults(){return Object.assign(qe.getDefaults(),{decay:1.5,preDelay:.01})}get decay(){return this._decay}set decay(n){os(n=this.toSeconds(n),.001),this._decay=n,this.generate()}get preDelay(){return this._preDelay}set preDelay(n){os(n=this.toSeconds(n),0),this._preDelay=n,this.generate()}generate(){return de(this,void 0,void 0,(function*(){const n=this.ready,o=new QA(2,this._decay+this._preDelay,this.context.sampleRate),c=new pi({context:o}),f=new pi({context:o}),w=new gi({context:o});c.connect(w,0,0),f.connect(w,0,1);const B=new xt({context:o}).toDestination();w.connect(B),c.start(0),f.start(0),B.gain.setValueAtTime(0,0),B.gain.setValueAtTime(1,this._preDelay),B.gain.exponentialApproachValueAtTime(0,this._preDelay,this.decay);const b=o.render();return this.ready=b.then(Wt),yield n,this._convolver.buffer=(yield b).get(),this}))}dispose(){return super.dispose(),this._convolver.disconnect(),this}}class ro extends at{constructor(){super(et(ro.getDefaults(),arguments)),this.name="MidSideSplit",this._split=this.input=new ji({channels:2,context:this.context}),this._midAdd=new $i({context:this.context}),this.mid=new _e({context:this.context,value:Math.SQRT1_2}),this._sideSubtract=new Xi({context:this.context}),this.side=new _e({context:this.context,value:Math.SQRT1_2}),this._split.connect(this._midAdd,0),this._split.connect(this._midAdd.addend,1),this._split.connect(this._sideSubtract,0),this._split.connect(this._sideSubtract.subtrahend,1),this._midAdd.connect(this.mid),this._sideSubtract.connect(this.side)}dispose(){return super.dispose(),this.mid.dispose(),this.side.dispose(),this._midAdd.dispose(),this._sideSubtract.dispose(),this._split.dispose(),this}}class oo extends at{constructor(){super(et(oo.getDefaults(),arguments)),this.name="MidSideMerge",this.mid=new xt({context:this.context}),this.side=new xt({context:this.context}),this._left=new $i({context:this.context}),this._leftMult=new _e({context:this.context,value:Math.SQRT1_2}),this._right=new Xi({context:this.context}),this._rightMult=new _e({context:this.context,value:Math.SQRT1_2}),this._merge=this.output=new gi({context:this.context}),this.mid.fan(this._left),this.side.connect(this._left.addend),this.mid.connect(this._right),this.side.connect(this._right.subtrahend),this._left.connect(this._leftMult),this._right.connect(this._rightMult),this._leftMult.connect(this._merge,0,0),this._rightMult.connect(this._merge,0,1)}dispose(){return super.dispose(),this.mid.dispose(),this.side.dispose(),this._leftMult.dispose(),this._rightMult.dispose(),this._left.dispose(),this._right.dispose(),this}}class em extends qe{constructor(n){super(n),this.name="MidSideEffect",this._midSideMerge=new oo({context:this.context}),this._midSideSplit=new ro({context:this.context}),this._midSend=this._midSideSplit.mid,this._sideSend=this._midSideSplit.side,this._midReturn=this._midSideMerge.mid,this._sideReturn=this._midSideMerge.side,this.effectSend.connect(this._midSideSplit),this._midSideMerge.connect(this.effectReturn)}connectEffectMid(...n){this._midSend.chain(...n,this._midReturn)}connectEffectSide(...n){this._sideSend.chain(...n,this._sideReturn)}dispose(){return super.dispose(),this._midSideSplit.dispose(),this._midSideMerge.dispose(),this._midSend.dispose(),this._sideSend.dispose(),this._midReturn.dispose(),this._sideReturn.dispose(),this}}class Gh extends em{constructor(){const n=et(Gh.getDefaults(),arguments,["width"]);super(n),this.name="StereoWidener",this.width=new Mt({context:this.context,value:n.width,units:"normalRange"}),Ft(this,["width"]),this._twoTimesWidthMid=new _e({context:this.context,value:2}),this._twoTimesWidthSide=new _e({context:this.context,value:2}),this._midMult=new _e({context:this.context}),this._twoTimesWidthMid.connect(this._midMult.factor),this.connectEffectMid(this._midMult),this._oneMinusWidth=new Xi({context:this.context}),this._oneMinusWidth.connect(this._twoTimesWidthMid),ys(this.context.getConstant(1),this._oneMinusWidth),this.width.connect(this._oneMinusWidth.subtrahend),this._sideMult=new _e({context:this.context}),this.width.connect(this._twoTimesWidthSide),this._twoTimesWidthSide.connect(this._sideMult.factor),this.connectEffectSide(this._sideMult)}static getDefaults(){return Object.assign(em.getDefaults(),{width:.5})}dispose(){return super.dispose(),this.width.dispose(),this._midMult.dispose(),this._sideMult.dispose(),this._twoTimesWidthMid.dispose(),this._twoTimesWidthSide.dispose(),this._oneMinusWidth.dispose(),this}}class Kh extends Sn{constructor(){const n=et(Kh.getDefaults(),arguments,["frequency","depth"]);super(n),this.name="Tremolo",this._lfoL=new Cs({context:this.context,type:n.type,min:1,max:0}),this._lfoR=new Cs({context:this.context,type:n.type,min:1,max:0}),this._amplitudeL=new xt({context:this.context}),this._amplitudeR=new xt({context:this.context}),this.frequency=new Mt({context:this.context,value:n.frequency,units:"frequency"}),this.depth=new Mt({context:this.context,value:n.depth,units:"normalRange"}),Ft(this,["frequency","depth"]),this.connectEffectLeft(this._amplitudeL),this.connectEffectRight(this._amplitudeR),this._lfoL.connect(this._amplitudeL.gain),this._lfoR.connect(this._amplitudeR.gain),this.frequency.fan(this._lfoL.frequency,this._lfoR.frequency),this.depth.fan(this._lfoR.amplitude,this._lfoL.amplitude),this.spread=n.spread}static getDefaults(){return Object.assign(Sn.getDefaults(),{frequency:10,type:"sine",depth:.5,spread:180})}start(n){return this._lfoL.start(n),this._lfoR.start(n),this}stop(n){return this._lfoL.stop(n),this._lfoR.stop(n),this}sync(){return this._lfoL.sync(),this._lfoR.sync(),this.context.transport.syncSignal(this.frequency),this}unsync(){return this._lfoL.unsync(),this._lfoR.unsync(),this.context.transport.unsyncSignal(this.frequency),this}get type(){return this._lfoL.type}set type(n){this._lfoL.type=n,this._lfoR.type=n}get spread(){return this._lfoR.phase-this._lfoL.phase}set spread(n){this._lfoL.phase=90-n/2,this._lfoR.phase=n/2+90}dispose(){return super.dispose(),this._lfoL.dispose(),this._lfoR.dispose(),this._amplitudeL.dispose(),this._amplitudeR.dispose(),this.frequency.dispose(),this.depth.dispose(),this}}class qh extends qe{constructor(){const n=et(qh.getDefaults(),arguments,["frequency","depth"]);super(n),this.name="Vibrato",this._delayNode=new Hs({context:this.context,delayTime:0,maxDelay:n.maxDelay}),this._lfo=new Cs({context:this.context,type:n.type,min:0,max:n.maxDelay,frequency:n.frequency,phase:-90}).start().connect(this._delayNode.delayTime),this.frequency=this._lfo.frequency,this.depth=this._lfo.amplitude,this.depth.value=n.depth,Ft(this,["frequency","depth"]),this.effectSend.chain(this._delayNode,this.effectReturn)}static getDefaults(){return Object.assign(qe.getDefaults(),{maxDelay:.005,frequency:5,depth:.1,type:"sine"})}get type(){return this._lfo.type}set type(n){this._lfo.type=n}dispose(){return super.dispose(),this._delayNode.dispose(),this._lfo.dispose(),this.frequency.dispose(),this.depth.dispose(),this}}class ao extends at{constructor(){const n=et(ao.getDefaults(),arguments,["type","size"]);super(n),this.name="Analyser",this._analysers=[],this._buffers=[],this.input=this.output=this._gain=new xt({context:this.context}),this._split=new ji({context:this.context,channels:n.channels}),this.input.connect(this._split),os(n.channels,1);for(let o=0;o<n.channels;o++)this._analysers[o]=this.context.createAnalyser(),this._split.connect(this._analysers[o],o,0);this.size=n.size,this.type=n.type,this.smoothing=n.smoothing}static getDefaults(){return Object.assign(at.getDefaults(),{size:1024,smoothing:.8,type:"fft",channels:1})}getValue(){return this._analysers.forEach(((n,o)=>{const c=this._buffers[o];this._type==="fft"?n.getFloatFrequencyData(c):this._type==="waveform"&&n.getFloatTimeDomainData(c)})),this.channels===1?this._buffers[0]:this._buffers}get size(){return this._analysers[0].frequencyBinCount}set size(n){this._analysers.forEach(((o,c)=>{o.fftSize=2*n,this._buffers[c]=new Float32Array(n)}))}get channels(){return this._analysers.length}get type(){return this._type}set type(n){Et(n==="waveform"||n==="fft",`Analyser: invalid type: ${n}`),this._type=n}get smoothing(){return this._analysers[0].smoothingTimeConstant}set smoothing(n){this._analysers.forEach((o=>o.smoothingTimeConstant=n))}dispose(){return super.dispose(),this._analysers.forEach((n=>n.disconnect())),this._split.dispose(),this._gain.dispose(),this}}class wi extends at{constructor(){super(et(wi.getDefaults(),arguments)),this.name="MeterBase",this.input=this.output=this._analyser=new ao({context:this.context,size:256,type:"waveform"})}dispose(){return super.dispose(),this._analyser.dispose(),this}}class zh extends wi{constructor(){const n=et(zh.getDefaults(),arguments,["smoothing"]);super(n),this.name="Meter",this.input=this.output=this._analyser=new ao({context:this.context,size:256,type:"waveform",channels:n.channelCount}),this.smoothing=n.smoothing,this.normalRange=n.normalRange,this._rms=new Array(n.channelCount),this._rms.fill(0)}static getDefaults(){return Object.assign(wi.getDefaults(),{smoothing:.8,normalRange:!1,channelCount:1})}getLevel(){return EA("'getLevel' has been changed to 'getValue'"),this.getValue()}getValue(){const n=this._analyser.getValue(),o=(this.channels===1?[n]:n).map(((c,f)=>{const w=c.reduce(((b,E)=>b+E*E),0),B=Math.sqrt(w/c.length);return this._rms[f]=Math.max(B,this._rms[f]*this.smoothing),this.normalRange?this._rms[f]:Or(this._rms[f])}));return this.channels===1?o[0]:o}get channels(){return this._analyser.channels}dispose(){return super.dispose(),this._analyser.dispose(),this}}class $h extends wi{constructor(){const n=et($h.getDefaults(),arguments,["size"]);super(n),this.name="FFT",this.normalRange=n.normalRange,this._analyser.type="fft",this.size=n.size}static getDefaults(){return Object.assign(at.getDefaults(),{normalRange:!1,size:1024,smoothing:.8})}getValue(){return this._analyser.getValue().map((n=>this.normalRange?MA(n):n))}get size(){return this._analyser.size}set size(n){this._analyser.size=n}get smoothing(){return this._analyser.smoothing}set smoothing(n){this._analyser.smoothing=n}getFrequencyOfIndex(n){return Et(0<=n&&n<this.size,`index must be greater than or equal to 0 and less than ${this.size}`),n*this.context.sampleRate/(2*this.size)}}class Xh extends wi{constructor(){super(et(Xh.getDefaults(),arguments)),this.name="DCMeter",this._analyser.type="waveform",this._analyser.size=256}getValue(){return this._analyser.getValue()[0]}}class Yh extends wi{constructor(){const n=et(Yh.getDefaults(),arguments,["size"]);super(n),this.name="Waveform",this._analyser.type="waveform",this.size=n.size}static getDefaults(){return Object.assign(wi.getDefaults(),{size:1024})}getValue(){return this._analyser.getValue()}get size(){return this._analyser.size}set size(n){this._analyser.size=n}}class Le extends at{constructor(){const n=et(Le.getDefaults(),arguments,["solo"]);super(n),this.name="Solo",this.input=this.output=new xt({context:this.context}),Le._allSolos.has(this.context)||Le._allSolos.set(this.context,new Set),Le._allSolos.get(this.context).add(this),this.solo=n.solo}static getDefaults(){return Object.assign(at.getDefaults(),{solo:!1})}get solo(){return this._isSoloed()}set solo(n){n?this._addSolo():this._removeSolo(),Le._allSolos.get(this.context).forEach((o=>o._updateSolo()))}get muted(){return this.input.gain.value===0}_addSolo(){Le._soloed.has(this.context)||Le._soloed.set(this.context,new Set),Le._soloed.get(this.context).add(this)}_removeSolo(){Le._soloed.has(this.context)&&Le._soloed.get(this.context).delete(this)}_isSoloed(){return Le._soloed.has(this.context)&&Le._soloed.get(this.context).has(this)}_noSolos(){return!Le._soloed.has(this.context)||Le._soloed.has(this.context)&&Le._soloed.get(this.context).size===0}_updateSolo(){this._isSoloed()||this._noSolos()?this.input.gain.value=1:this.input.gain.value=0}dispose(){return super.dispose(),Le._allSolos.get(this.context).delete(this),this._removeSolo(),this}}Le._allSolos=new Map,Le._soloed=new Map;class Na extends at{constructor(){const n=et(Na.getDefaults(),arguments,["pan","volume"]);super(n),this.name="PanVol",this._panner=this.input=new io({context:this.context,pan:n.pan,channelCount:n.channelCount}),this.pan=this._panner.pan,this._volume=this.output=new Vn({context:this.context,volume:n.volume}),this.volume=this._volume.volume,this._panner.connect(this._volume),this.mute=n.mute,Ft(this,["pan","volume"])}static getDefaults(){return Object.assign(at.getDefaults(),{mute:!1,pan:0,volume:0,channelCount:1})}get mute(){return this._volume.mute}set mute(n){this._volume.mute=n}dispose(){return super.dispose(),this._panner.dispose(),this.pan.dispose(),this._volume.dispose(),this.volume.dispose(),this}}class Ji extends at{constructor(){const n=et(Ji.getDefaults(),arguments,["volume","pan"]);super(n),this.name="Channel",this._solo=this.input=new Le({solo:n.solo,context:this.context}),this._panVol=this.output=new Na({context:this.context,pan:n.pan,volume:n.volume,mute:n.mute,channelCount:n.channelCount}),this.pan=this._panVol.pan,this.volume=this._panVol.volume,this._solo.connect(this._panVol),Ft(this,["pan","volume"])}static getDefaults(){return Object.assign(at.getDefaults(),{pan:0,volume:0,mute:!1,solo:!1,channelCount:1})}get solo(){return this._solo.solo}set solo(n){this._solo.solo=n}get muted(){return this._solo.muted||this.mute}get mute(){return this._panVol.mute}set mute(n){this._panVol.mute=n}_getBus(n){return Ji.buses.has(n)||Ji.buses.set(n,new xt({context:this.context})),Ji.buses.get(n)}send(n,o=0){const c=this._getBus(n),f=new xt({context:this.context,units:"decibels",gain:o});return this.connect(f),f.connect(c),f}receive(n){return this._getBus(n).connect(this),this}dispose(){return super.dispose(),this._panVol.dispose(),this.pan.dispose(),this.volume.dispose(),this._solo.dispose(),this}}Ji.buses=new Map;class jh extends at{constructor(){super(et(jh.getDefaults(),arguments)),this.name="Mono",this.input=new xt({context:this.context}),this._merge=this.output=new gi({channels:2,context:this.context}),this.input.connect(this._merge,0,0),this.input.connect(this._merge,0,1)}dispose(){return super.dispose(),this._merge.dispose(),this.input.dispose(),this}}class lo extends at{constructor(){const n=et(lo.getDefaults(),arguments,["lowFrequency","highFrequency"]);super(n),this.name="MultibandSplit",this.input=new xt({context:this.context}),this.output=void 0,this.low=new Os({context:this.context,frequency:0,type:"lowpass"}),this._lowMidFilter=new Os({context:this.context,frequency:0,type:"highpass"}),this.mid=new Os({context:this.context,frequency:0,type:"lowpass"}),this.high=new Os({context:this.context,frequency:0,type:"highpass"}),this._internalChannels=[this.low,this.mid,this.high],this.lowFrequency=new Mt({context:this.context,units:"frequency",value:n.lowFrequency}),this.highFrequency=new Mt({context:this.context,units:"frequency",value:n.highFrequency}),this.Q=new Mt({context:this.context,units:"positive",value:n.Q}),this.input.fan(this.low,this.high),this.input.chain(this._lowMidFilter,this.mid),this.lowFrequency.fan(this.low.frequency,this._lowMidFilter.frequency),this.highFrequency.fan(this.mid.frequency,this.high.frequency),this.Q.connect(this.low.Q),this.Q.connect(this._lowMidFilter.Q),this.Q.connect(this.mid.Q),this.Q.connect(this.high.Q),Ft(this,["high","mid","low","highFrequency","lowFrequency"])}static getDefaults(){return Object.assign(at.getDefaults(),{Q:1,highFrequency:2500,lowFrequency:400})}dispose(){return super.dispose(),Hr(this,["high","mid","low","highFrequency","lowFrequency"]),this.low.dispose(),this._lowMidFilter.dispose(),this.mid.dispose(),this.high.dispose(),this.lowFrequency.dispose(),this.highFrequency.dispose(),this.Q.dispose(),this}}class Jh extends at{constructor(){const n=et(Jh.getDefaults(),arguments,["positionX","positionY","positionZ"]);super(n),this.name="Panner3D",this._panner=this.input=this.output=this.context.createPanner(),this.panningModel=n.panningModel,this.maxDistance=n.maxDistance,this.distanceModel=n.distanceModel,this.coneOuterGain=n.coneOuterGain,this.coneOuterAngle=n.coneOuterAngle,this.coneInnerAngle=n.coneInnerAngle,this.refDistance=n.refDistance,this.rolloffFactor=n.rolloffFactor,this.positionX=new kt({context:this.context,param:this._panner.positionX,value:n.positionX}),this.positionY=new kt({context:this.context,param:this._panner.positionY,value:n.positionY}),this.positionZ=new kt({context:this.context,param:this._panner.positionZ,value:n.positionZ}),this.orientationX=new kt({context:this.context,param:this._panner.orientationX,value:n.orientationX}),this.orientationY=new kt({context:this.context,param:this._panner.orientationY,value:n.orientationY}),this.orientationZ=new kt({context:this.context,param:this._panner.orientationZ,value:n.orientationZ})}static getDefaults(){return Object.assign(at.getDefaults(),{coneInnerAngle:360,coneOuterAngle:360,coneOuterGain:0,distanceModel:"inverse",maxDistance:1e4,orientationX:0,orientationY:0,orientationZ:0,panningModel:"equalpower",positionX:0,positionY:0,positionZ:0,refDistance:1,rolloffFactor:1})}setPosition(n,o,c){return this.positionX.value=n,this.positionY.value=o,this.positionZ.value=c,this}setOrientation(n,o,c){return this.orientationX.value=n,this.orientationY.value=o,this.orientationZ.value=c,this}get panningModel(){return this._panner.panningModel}set panningModel(n){this._panner.panningModel=n}get refDistance(){return this._panner.refDistance}set refDistance(n){this._panner.refDistance=n}get rolloffFactor(){return this._panner.rolloffFactor}set rolloffFactor(n){this._panner.rolloffFactor=n}get distanceModel(){return this._panner.distanceModel}set distanceModel(n){this._panner.distanceModel=n}get coneInnerAngle(){return this._panner.coneInnerAngle}set coneInnerAngle(n){this._panner.coneInnerAngle=n}get coneOuterAngle(){return this._panner.coneOuterAngle}set coneOuterAngle(n){this._panner.coneOuterAngle=n}get coneOuterGain(){return this._panner.coneOuterGain}set coneOuterGain(n){this._panner.coneOuterGain=n}get maxDistance(){return this._panner.maxDistance}set maxDistance(n){this._panner.maxDistance=n}dispose(){return super.dispose(),this._panner.disconnect(),this.orientationX.dispose(),this.orientationY.dispose(),this.orientationZ.dispose(),this.positionX.dispose(),this.positionY.dispose(),this.positionZ.dispose(),this}}class Va extends at{constructor(){const n=et(Va.getDefaults(),arguments);super(n),this.name="Recorder",this.input=new xt({context:this.context}),Et(Va.supported,"Media Recorder API is not available"),this._stream=this.context.createMediaStreamDestination(),this.input.connect(this._stream),this._recorder=new MediaRecorder(this._stream.stream,{mimeType:n.mimeType})}static getDefaults(){return at.getDefaults()}get mimeType(){return this._recorder.mimeType}static get supported(){return Ps!==null&&Reflect.has(Ps,"MediaRecorder")}get state(){return this._recorder.state==="inactive"?"stopped":this._recorder.state==="paused"?"paused":"started"}start(){return de(this,void 0,void 0,(function*(){Et(this.state!=="started","Recorder is already started");const n=new Promise((o=>{const c=()=>{this._recorder.removeEventListener("start",c,!1),o()};this._recorder.addEventListener("start",c,!1)}));return this._recorder.start(),yield n}))}stop(){return de(this,void 0,void 0,(function*(){Et(this.state!=="stopped","Recorder is not started");const n=new Promise((o=>{const c=f=>{this._recorder.removeEventListener("dataavailable",c,!1),o(f.data)};this._recorder.addEventListener("dataavailable",c,!1)}));return this._recorder.stop(),yield n}))}pause(){return Et(this.state==="started","Recorder must be started"),this._recorder.pause(),this}dispose(){return super.dispose(),this.input.dispose(),this._stream.disconnect(),this}}class zn extends at{constructor(){const n=et(zn.getDefaults(),arguments,["threshold","ratio"]);super(n),this.name="Compressor",this._compressor=this.context.createDynamicsCompressor(),this.input=this._compressor,this.output=this._compressor,this.threshold=new kt({minValue:this._compressor.threshold.minValue,maxValue:this._compressor.threshold.maxValue,context:this.context,convert:!1,param:this._compressor.threshold,units:"decibels",value:n.threshold}),this.attack=new kt({minValue:this._compressor.attack.minValue,maxValue:this._compressor.attack.maxValue,context:this.context,param:this._compressor.attack,units:"time",value:n.attack}),this.release=new kt({minValue:this._compressor.release.minValue,maxValue:this._compressor.release.maxValue,context:this.context,param:this._compressor.release,units:"time",value:n.release}),this.knee=new kt({minValue:this._compressor.knee.minValue,maxValue:this._compressor.knee.maxValue,context:this.context,convert:!1,param:this._compressor.knee,units:"decibels",value:n.knee}),this.ratio=new kt({minValue:this._compressor.ratio.minValue,maxValue:this._compressor.ratio.maxValue,context:this.context,convert:!1,param:this._compressor.ratio,units:"positive",value:n.ratio}),Ft(this,["knee","release","attack","ratio","threshold"])}static getDefaults(){return Object.assign(at.getDefaults(),{attack:.003,knee:30,ratio:12,release:.25,threshold:-24})}get reduction(){return this._compressor.reduction}dispose(){return super.dispose(),this._compressor.disconnect(),this.attack.dispose(),this.release.dispose(),this.threshold.dispose(),this.ratio.dispose(),this.knee.dispose(),this}}class Zh extends at{constructor(){const n=et(Zh.getDefaults(),arguments,["threshold","smoothing"]);super(n),this.name="Gate",this._follower=new Ao({context:this.context,smoothing:n.smoothing}),this._gt=new Da({context:this.context,value:MA(n.threshold)}),this.input=new xt({context:this.context}),this._gate=this.output=new xt({context:this.context}),this.input.connect(this._gate),this.input.chain(this._follower,this._gt,this._gate.gain)}static getDefaults(){return Object.assign(at.getDefaults(),{smoothing:.1,threshold:-40})}get threshold(){return Or(this._gt.value)}set threshold(n){this._gt.value=MA(n)}get smoothing(){return this._follower.smoothing}set smoothing(n){this._follower.smoothing=n}dispose(){return super.dispose(),this.input.dispose(),this._follower.dispose(),this._gt.dispose(),this._gate.dispose(),this}}class tu extends at{constructor(){const n=et(tu.getDefaults(),arguments,["threshold"]);super(n),this.name="Limiter",this._compressor=this.input=this.output=new zn({context:this.context,ratio:20,attack:.003,release:.01,threshold:n.threshold}),this.threshold=this._compressor.threshold,Ft(this,"threshold")}static getDefaults(){return Object.assign(at.getDefaults(),{threshold:-12})}get reduction(){return this._compressor.reduction}dispose(){return super.dispose(),this._compressor.dispose(),this.threshold.dispose(),this}}class eu extends at{constructor(){const n=et(eu.getDefaults(),arguments);super(n),this.name="MidSideCompressor",this._midSideSplit=this.input=new ro({context:this.context}),this._midSideMerge=this.output=new oo({context:this.context}),this.mid=new zn(Object.assign(n.mid,{context:this.context})),this.side=new zn(Object.assign(n.side,{context:this.context})),this._midSideSplit.mid.chain(this.mid,this._midSideMerge.mid),this._midSideSplit.side.chain(this.side,this._midSideMerge.side),Ft(this,["mid","side"])}static getDefaults(){return Object.assign(at.getDefaults(),{mid:{ratio:3,threshold:-24,release:.03,attack:.02,knee:16},side:{ratio:6,threshold:-30,release:.25,attack:.03,knee:10}})}dispose(){return super.dispose(),this.mid.dispose(),this.side.dispose(),this._midSideSplit.dispose(),this._midSideMerge.dispose(),this}}class su extends at{constructor(){const n=et(su.getDefaults(),arguments);super(n),this.name="MultibandCompressor",this._splitter=this.input=new lo({context:this.context,lowFrequency:n.lowFrequency,highFrequency:n.highFrequency}),this.lowFrequency=this._splitter.lowFrequency,this.highFrequency=this._splitter.highFrequency,this.output=new xt({context:this.context}),this.low=new zn(Object.assign(n.low,{context:this.context})),this.mid=new zn(Object.assign(n.mid,{context:this.context})),this.high=new zn(Object.assign(n.high,{context:this.context})),this._splitter.low.chain(this.low,this.output),this._splitter.mid.chain(this.mid,this.output),this._splitter.high.chain(this.high,this.output),Ft(this,["high","mid","low","highFrequency","lowFrequency"])}static getDefaults(){return Object.assign(at.getDefaults(),{lowFrequency:250,highFrequency:2e3,low:{ratio:6,threshold:-30,release:.25,attack:.03,knee:10},mid:{ratio:3,threshold:-24,release:.03,attack:.02,knee:16},high:{ratio:3,threshold:-24,release:.03,attack:.02,knee:16}})}dispose(){return super.dispose(),this._splitter.dispose(),this.low.dispose(),this.mid.dispose(),this.high.dispose(),this.output.dispose(),this}}class nu extends at{constructor(){const n=et(nu.getDefaults(),arguments,["low","mid","high"]);super(n),this.name="EQ3",this.output=new xt({context:this.context}),this._internalChannels=[],this.input=this._multibandSplit=new lo({context:this.context,highFrequency:n.highFrequency,lowFrequency:n.lowFrequency}),this._lowGain=new xt({context:this.context,gain:n.low,units:"decibels"}),this._midGain=new xt({context:this.context,gain:n.mid,units:"decibels"}),this._highGain=new xt({context:this.context,gain:n.high,units:"decibels"}),this.low=this._lowGain.gain,this.mid=this._midGain.gain,this.high=this._highGain.gain,this.Q=this._multibandSplit.Q,this.lowFrequency=this._multibandSplit.lowFrequency,this.highFrequency=this._multibandSplit.highFrequency,this._multibandSplit.low.chain(this._lowGain,this.output),this._multibandSplit.mid.chain(this._midGain,this.output),this._multibandSplit.high.chain(this._highGain,this.output),Ft(this,["low","mid","high","lowFrequency","highFrequency"]),this._internalChannels=[this._multibandSplit]}static getDefaults(){return Object.assign(at.getDefaults(),{high:0,highFrequency:2500,low:0,lowFrequency:400,mid:0})}dispose(){return super.dispose(),Hr(this,["low","mid","high","lowFrequency","highFrequency"]),this._multibandSplit.dispose(),this.lowFrequency.dispose(),this.highFrequency.dispose(),this._lowGain.dispose(),this._midGain.dispose(),this._highGain.dispose(),this.low.dispose(),this.mid.dispose(),this.high.dispose(),this.Q.dispose(),this}}class iu extends at{constructor(){const n=et(iu.getDefaults(),arguments,["url","onload"]);super(n),this.name="Convolver",this._convolver=this.context.createConvolver(),this._buffer=new Jt(n.url,(o=>{this.buffer=o,n.onload()})),this.input=new xt({context:this.context}),this.output=new xt({context:this.context}),this._buffer.loaded&&(this.buffer=this._buffer),this.normalize=n.normalize,this.input.chain(this._convolver,this.output)}static getDefaults(){return Object.assign(at.getDefaults(),{normalize:!0,onload:Wt})}load(n){return de(this,void 0,void 0,(function*(){this.buffer=yield this._buffer.load(n)}))}get buffer(){return this._buffer.length?this._buffer:null}set buffer(n){n&&this._buffer.set(n),this._convolver.buffer&&(this.input.disconnect(),this._convolver.disconnect(),this._convolver=this.context.createConvolver(),this.input.chain(this._convolver,this.output));const o=this._buffer.get();this._convolver.buffer=o||null}get normalize(){return this._convolver.normalize}set normalize(n){this._convolver.normalize=n}dispose(){return super.dispose(),this._buffer.dispose(),this._convolver.disconnect(),this}}function uC(){return we().now()}function dC(){return we().immediate()}const fC=we().transport;function pC(){return we().transport}const mC=we().destination,gC=we().destination;function wC(){return we().destination}const vC=we().listener;function BC(){return we().listener}const yC=we().draw;function CC(){return we().draw}const bC=we();function _C(){return Jt.loaded()}const xC=Jt,EC=LA,SC=fi})(),r})()))})(Fl)),Fl.exports}var $=UC();const PC=uw($),kC=QC({__proto__:null,default:PC},[$]),Am=Array(19).fill(2),DC=["anacrusis","anacrusis","solid","dashed","dashed","dashed","solid","dashed","dashed","dashed","solid","dashed","dashed","dashed","solid","dashed","dashed","dashed","solid"],sd=Array(16).fill(2),pw=["dashed","dashed","dashed","solid","dashed","dashed","dashed","solid","dashed","dashed","dashed","solid","dashed","dashed","dashed"];function LC(){return{hasAnacrusis:!1,macrobeatGroupings:[...sd],macrobeatBoundaryStyles:[...pw],baseMicrobeatPx:40,modulationMarkers:[]}}const Cr=12,HC=50,RC=.52,OC=.5,Ga=3,Ka=1,br=30,_r=.5,rm=3,qa=8,Tl=.25,NC=1.25,VC=.8,WC=.7,GC=.9,KC=4,qC=1.5,zC=.15,$C=.2,XC=1,mw=1.5,YC="#CCCCCC",gw=1,om=3,am=5,jC=7,Il=16,JC=0,ZC=255,ww=()=>({enabled:!0,blend:0,cutoff:16,resonance:0,type:"lowpass"}),tb=()=>({speed:0,span:0}),eb=()=>({speed:0,span:0}),sb={"#4a90e2":{primary:"#4a90e2",light:"#63a9fd"},"#68a03f":{primary:"#68a03f",light:"#80b958"},"#d66573":{primary:"#d66573",light:"#f27e8b"},"#2d2d2d":{primary:"#2d2d2d",light:"#424242"}};function lm(){const e=t=>{const s=new Float32Array(Cr).fill(0),i=new Float32Array(Cr).fill(0);return s[0]=1,{name:t,adsr:{attack:.1,decay:.2,sustain:.8,release:.3},coeffs:s,phases:i,activePresetName:"sine",gain:1,filter:ww(),vibrato:tb(),tremelo:eb()}};return{timbres:{"#4a90e2":e("Blue"),"#2d2d2d":e("Black"),"#d66573":e("Red"),"#68a03f":e("Green")},colorPalette:sb}}function nb(){return{isMicPaintActive:!1,isDetecting:!1,detectedPitch:{frequency:0,clarity:0,midi:0,pitchClass:0},paintHistory:[],paintSettings:{thickness:6,opacity:80,minClarity:.1,colorMode:"chromatic",playbackEnabled:!0}}}const pe=[{pitch:"C8",flatName:"C8",sharpName:"C8",toneNote:"C8",frequency:4186.01,column:"A",hex:"#fef1f5",isAccidental:!1},{pitch:"B7",flatName:"B7",sharpName:"B7",toneNote:"B7",frequency:3951.07,column:"B",hex:"#fbf2fa",isAccidental:!1},{pitch:"B/A7",flatName:"B7",sharpName:"A7",toneNote:"Bb7",frequency:3729.31,column:"A",hex:"#f6f3fd",isAccidental:!0},{pitch:"A7",flatName:"A7",sharpName:"A7",toneNote:"A7",frequency:3520,column:"B",hex:"#f1f5ff",isAccidental:!1},{pitch:"A/G7",flatName:"A7",sharpName:"G7",toneNote:"Ab7",frequency:3322.44,column:"A",hex:"#edf7fe",isAccidental:!0},{pitch:"G7",flatName:"G7",sharpName:"G7",toneNote:"G7",frequency:3135.96,column:"B",hex:"#ebf8fa",isAccidental:!1},{pitch:"G/F7",flatName:"G7",sharpName:"F7",toneNote:"Gb7",frequency:2959.96,column:"A",hex:"#ecf8f5",isAccidental:!0},{pitch:"F7",flatName:"F7",sharpName:"F7",toneNote:"F7",frequency:2793.83,column:"B",hex:"#eff8f0",isAccidental:!1},{pitch:"E7",flatName:"E7",sharpName:"E7",toneNote:"E7",frequency:2637.02,column:"A",hex:"#f4f7ec",isAccidental:!1},{pitch:"E/D7",flatName:"E7",sharpName:"D7",toneNote:"Eb7",frequency:2489.02,column:"B",hex:"#f9f5eb",isAccidental:!0},{pitch:"D7",flatName:"D7",sharpName:"D7",toneNote:"D7",frequency:2349.32,column:"A",hex:"#fdf3ec",isAccidental:!1},{pitch:"D/C7",flatName:"D7",sharpName:"C7",toneNote:"Db7",frequency:2217.46,column:"B",hex:"#fef2f0",isAccidental:!0},{pitch:"C7",flatName:"C7",sharpName:"C7",toneNote:"C7",frequency:2093,column:"A",hex:"#fef1f5",isAccidental:!1},{pitch:"B6",flatName:"B6",sharpName:"B6",toneNote:"B6",frequency:1975.53,column:"B",hex:"#f0d1ec",isAccidental:!1},{pitch:"B/A6",flatName:"B6",sharpName:"A6",toneNote:"Bb6",frequency:1864.66,column:"A",hex:"#e1d6f9",isAccidental:!0},{pitch:"A6",flatName:"A6",sharpName:"A6",toneNote:"A6",frequency:1760,column:"B",hex:"#cfdcff",isAccidental:!1},{pitch:"A/G6",flatName:"A6",sharpName:"G6",toneNote:"Ab6",frequency:1661.22,column:"A",hex:"#bfe2fb",isAccidental:!0},{pitch:"G6",flatName:"G6",sharpName:"G6",toneNote:"G6",frequency:1567.94,column:"B",hex:"#b7e6ef",isAccidental:!1},{pitch:"G/F6",flatName:"G6",sharpName:"F6",toneNote:"Gb6",frequency:1479.98,column:"A",hex:"#b9e8dd",isAccidental:!0},{pitch:"F6",flatName:"F6",sharpName:"F6",toneNote:"F6",frequency:1396.91,column:"B",hex:"#c6e6cb",isAccidental:!1},{pitch:"E6",flatName:"E6",sharpName:"E6",toneNote:"E6",frequency:1318.51,column:"A",hex:"#d8e2bd",isAccidental:!1},{pitch:"E/D6",flatName:"E6",sharpName:"D6",toneNote:"Eb6",frequency:1244.51,column:"B",hex:"#e9dcb7",isAccidental:!0},{pitch:"D6",flatName:"D6",sharpName:"D6",toneNote:"D6",frequency:1174.66,column:"A",hex:"#f6d5bc",isAccidental:!1},{pitch:"D/C6",flatName:"D6",sharpName:"C6",toneNote:"Db6",frequency:1108.73,column:"B",hex:"#fcd1c9",isAccidental:!0},{pitch:"C6",flatName:"C6",sharpName:"C6",toneNote:"C6",frequency:1046.5,column:"A",hex:"#facfdb",isAccidental:!1},{pitch:"B5",flatName:"B5",sharpName:"B5",toneNote:"B5",frequency:987.77,column:"B",hex:"#e6b2e1",isAccidental:!1},{pitch:"B/A5",flatName:"B5",sharpName:"A5",toneNote:"Bb5",frequency:932.33,column:"A",hex:"#cebaf6",isAccidental:!0},{pitch:"A5",flatName:"A5",sharpName:"A5",toneNote:"A5",frequency:880,column:"B",hex:"#b0c4fe",isAccidental:!1},{pitch:"A/G5",flatName:"A5",sharpName:"G5",toneNote:"Ab5",frequency:830.61,column:"A",hex:"#92cef8",isAccidental:!0},{pitch:"G5",flatName:"G5",sharpName:"G5",toneNote:"G5",frequency:783.99,column:"B",hex:"#7fd5e5",isAccidental:!1},{pitch:"G/F5",flatName:"G5",sharpName:"F5",toneNote:"Gb5",frequency:739.99,column:"A",hex:"#84d8c8",isAccidental:!0},{pitch:"F5",flatName:"F5",sharpName:"F5",toneNote:"F5",frequency:698.46,column:"B",hex:"#9ed6a8",isAccidental:!1},{pitch:"E5",flatName:"E5",sharpName:"E5",toneNote:"E5",frequency:659.25,column:"A",hex:"#bece8f",isAccidental:!1},{pitch:"E/D5",flatName:"E5",sharpName:"D5",toneNote:"Eb5",frequency:622.25,column:"B",hex:"#dbc484",isAccidental:!0},{pitch:"D5",flatName:"D5",sharpName:"D5",toneNote:"D5",frequency:587.33,column:"A",hex:"#f0b98d",isAccidental:!1},{pitch:"D/C5",flatName:"D5",sharpName:"C5",toneNote:"Db5",frequency:554.37,column:"B",hex:"#f9b1a5",isAccidental:!0},{pitch:"C5",flatName:"C5",sharpName:"C5",toneNote:"C5",frequency:523.25,column:"A",hex:"#f5afc3",isAccidental:!1},{pitch:"B4",flatName:"B4",sharpName:"B4",toneNote:"B4",frequency:493.88,column:"B",hex:"#db8fd4",isAccidental:!1},{pitch:"B/A4",flatName:"B4",sharpName:"A4",toneNote:"Bb4",frequency:466.16,column:"A",hex:"#ba9bf2",isAccidental:!0},{pitch:"A4",flatName:"A4",sharpName:"A4",toneNote:"A4",frequency:440,column:"B",hex:"#8fa9ff",isAccidental:!1},{pitch:"A/G4",flatName:"A4",sharpName:"G4",toneNote:"Ab4",frequency:415.3,column:"A",hex:"#58b8f6",isAccidental:!0},{pitch:"G4",flatName:"G4",sharpName:"G4",toneNote:"G4",frequency:392,column:"B",hex:"#16c3da",isAccidental:!1},{pitch:"G/F4",flatName:"G4",sharpName:"F4",toneNote:"Gb4",frequency:369.99,column:"A",hex:"#2dc8b1",isAccidental:!0},{pitch:"F4",flatName:"F4",sharpName:"F4",toneNote:"F4",frequency:349.23,column:"B",hex:"#6ec482",isAccidental:!1},{pitch:"E4",flatName:"E4",sharpName:"E4",toneNote:"E4",frequency:329.63,column:"A",hex:"#a4ba57",isAccidental:!1},{pitch:"E/D4",flatName:"E4",sharpName:"D4",toneNote:"Eb4",frequency:311.13,column:"B",hex:"#cdaa42",isAccidental:!0},{pitch:"D4",flatName:"D4",sharpName:"D4",toneNote:"D4",frequency:293.66,column:"A",hex:"#e89955",isAccidental:!1},{pitch:"D/C4",flatName:"D4",sharpName:"C4",toneNote:"Db4",frequency:277.18,column:"B",hex:"#f48e7d",isAccidental:!0},{pitch:"C4",flatName:"C4",sharpName:"C4",toneNote:"C4",frequency:261.63,column:"A",hex:"#ef8aab",isAccidental:!1},{pitch:"B3",flatName:"B3",sharpName:"B3",toneNote:"B3",frequency:246.94,column:"B",hex:"#be7cb8",isAccidental:!1},{pitch:"B/A3",flatName:"B3",sharpName:"A3",toneNote:"Bb3",frequency:233.08,column:"A",hex:"#a286d2",isAccidental:!0},{pitch:"A3",flatName:"A3",sharpName:"A3",toneNote:"A3",frequency:220,column:"B",hex:"#7b93dd",isAccidental:!1},{pitch:"A/G3",flatName:"A3",sharpName:"G3",toneNote:"Ab3",frequency:207.65,column:"A",hex:"#4c9fd6",isAccidental:!0},{pitch:"G3",flatName:"G3",sharpName:"G3",toneNote:"G3",frequency:196,column:"B",hex:"#13a9bd",isAccidental:!1},{pitch:"G/F3",flatName:"G3",sharpName:"F3",toneNote:"Gb3",frequency:185,column:"A",hex:"#27ad99",isAccidental:!0},{pitch:"F3",flatName:"F3",sharpName:"F3",toneNote:"F3",frequency:174.61,column:"B",hex:"#5faa71",isAccidental:!1},{pitch:"E3",flatName:"E3",sharpName:"E3",toneNote:"E3",frequency:164.81,column:"A",hex:"#8ea14b",isAccidental:!1},{pitch:"E/D3",flatName:"E3",sharpName:"D3",toneNote:"Eb3",frequency:155.56,column:"B",hex:"#b29338",isAccidental:!0},{pitch:"D3",flatName:"D3",sharpName:"D3",toneNote:"D3",frequency:146.83,column:"A",hex:"#ca8549",isAccidental:!1},{pitch:"D/C3",flatName:"D3",sharpName:"C3",toneNote:"Db3",frequency:138.59,column:"B",hex:"#d47a6c",isAccidental:!0},{pitch:"C3",flatName:"C3",sharpName:"C3",toneNote:"C3",frequency:130.81,column:"A",hex:"#cf7894",isAccidental:!1},{pitch:"B2",flatName:"B2",sharpName:"B2",toneNote:"B2",frequency:123.47,column:"B",hex:"#a46b9f",isAccidental:!1},{pitch:"B/A2",flatName:"B2",sharpName:"A2",toneNote:"Bb2",frequency:116.54,column:"A",hex:"#8b73b6",isAccidental:!0},{pitch:"A2",flatName:"A2",sharpName:"A2",toneNote:"A2",frequency:110,column:"B",hex:"#6a7ebf",isAccidental:!1},{pitch:"A/G2",flatName:"A2",sharpName:"G2",toneNote:"Ab2",frequency:103.83,column:"A",hex:"#4189b8",isAccidental:!0},{pitch:"G2",flatName:"G2",sharpName:"G2",toneNote:"G2",frequency:98,column:"B",hex:"#1092a3",isAccidental:!1},{pitch:"G/F2",flatName:"G2",sharpName:"F2",toneNote:"Gb2",frequency:92.5,column:"A",hex:"#219584",isAccidental:!0},{pitch:"F2",flatName:"F2",sharpName:"F2",toneNote:"F2",frequency:87.31,column:"B",hex:"#519360",isAccidental:!1},{pitch:"E2",flatName:"E2",sharpName:"E2",toneNote:"E2",frequency:82.41,column:"A",hex:"#7a8b40",isAccidental:!1},{pitch:"E/D2",flatName:"E2",sharpName:"D2",toneNote:"Eb2",frequency:77.78,column:"B",hex:"#997f30",isAccidental:!0},{pitch:"D2",flatName:"D2",sharpName:"D2",toneNote:"D2",frequency:73.42,column:"A",hex:"#ae723e",isAccidental:!1},{pitch:"D/C2",flatName:"D2",sharpName:"C2",toneNote:"Db2",frequency:69.3,column:"B",hex:"#b7695d",isAccidental:!0},{pitch:"C2",flatName:"C2",sharpName:"C2",toneNote:"C2",frequency:65.41,column:"A",hex:"#b3677f",isAccidental:!1},{pitch:"B1",flatName:"B1",sharpName:"B1",toneNote:"B1",frequency:61.74,column:"B",hex:"#6f466b",isAccidental:!1},{pitch:"B/A1",flatName:"B1",sharpName:"A1",toneNote:"Bb1",frequency:58.27,column:"A",hex:"#5d4c7b",isAccidental:!0},{pitch:"A1",flatName:"A1",sharpName:"A1",toneNote:"A1",frequency:55,column:"B",hex:"#465482",isAccidental:!1},{pitch:"A/G1",flatName:"A1",sharpName:"G1",toneNote:"Ab1",frequency:51.91,column:"A",hex:"#295c7d",isAccidental:!0},{pitch:"G1",flatName:"G1",sharpName:"G1",toneNote:"G1",frequency:49,column:"B",hex:"#06626e",isAccidental:!1},{pitch:"G/F1",flatName:"G1",sharpName:"F1",toneNote:"Gb1",frequency:46.25,column:"A",hex:"#126458",isAccidental:!0},{pitch:"F1",flatName:"F1",sharpName:"F1",toneNote:"F1",frequency:43.65,column:"B",hex:"#34633f",isAccidental:!1},{pitch:"E1",flatName:"E1",sharpName:"E1",toneNote:"E1",frequency:41.2,column:"A",hex:"#515d28",isAccidental:!1},{pitch:"E/D1",flatName:"E1",sharpName:"D1",toneNote:"Eb1",frequency:38.89,column:"B",hex:"#67541d",isAccidental:!0},{pitch:"D1",flatName:"D1",sharpName:"D1",toneNote:"D1",frequency:36.71,column:"A",hex:"#764c27",isAccidental:!1},{pitch:"D/C1",flatName:"D1",sharpName:"C1",toneNote:"Db1",frequency:34.65,column:"B",hex:"#7c453d",isAccidental:!0},{pitch:"C1",flatName:"C1",sharpName:"C1",toneNote:"C1",frequency:32.7,column:"A",hex:"#794455",isAccidental:!1}],vw={placedNotes:[],placedChords:[],tonicSignGroups:{},stampPlacements:[],tripletPlacements:[],annotations:[],lassoSelection:{selectedItems:[],convexHull:null,isActive:!1},history:[{notes:[],tonicSignGroups:{},timbres:lm().timbres,placedChords:[],stampPlacements:[],tripletPlacements:[],annotations:[],lassoSelection:{selectedItems:[],convexHull:null,isActive:!1}}],historyIndex:0,fullRowData:[],pitchRange:{topIndex:0,bottomIndex:Math.max(0,((pe==null?void 0:pe.length)||1)-1)},...LC(),...lm(),paint:nb(),selectedTool:"note",previousTool:"note",selectedToolTonicNumber:1,selectedNote:{shape:"circle",color:"#4a90e2"},deviceProfile:{isMobile:!1,isTouch:!1,isCoarsePointer:!1,orientation:"landscape",width:0,height:0},activeChordId:null,activeChordIntervals:["1P"],isIntervalsInverted:!1,chordPositionState:0,gridPosition:0,viewportRows:0,logicRows:0,cellWidth:0,cellHeight:0,columnWidths:[],degreeDisplayMode:"off",accidentalMode:{sharp:!0,flat:!0},showFrequencyLabels:!1,focusColours:!1,snapZoomToRange:!1,isPitchRangeLocked:!1,isPlaying:!1,isPaused:!1,isLooping:!1,tempo:90,waveformExtendedView:!1,adsrTimeAxisScale:1,adsrComponentWidth:100,isPrintPreviewActive:!1,printOptions:{includeButtonGrid:!0,includeDrums:!0,orientation:"landscape",colorMode:"color",cropTop:0,cropBottom:1,cropLeft:0,cropRight:1}};function cm(e){const t=JSON.parse(JSON.stringify(e));for(const s in t){const i=t[s];i.coeffs&&typeof i.coeffs=="object"&&!Array.isArray(i.coeffs)?i.coeffs=new Float32Array(Object.values(i.coeffs)):Array.isArray(i.coeffs)&&(i.coeffs=new Float32Array(i.coeffs))}return t}const ib={recordState(){this.state.history=this.state.history.slice(0,this.state.historyIndex+1);const e=JSON.parse(JSON.stringify(this.state.timbres)),t={notes:JSON.parse(JSON.stringify(this.state.placedNotes)),tonicSignGroups:JSON.parse(JSON.stringify(this.state.tonicSignGroups)),stampPlacements:JSON.parse(JSON.stringify(this.state.stampPlacements)),tripletPlacements:JSON.parse(JSON.stringify(this.state.tripletPlacements||[])),timbres:e,annotations:this.state.annotations?JSON.parse(JSON.stringify(this.state.annotations)):[]};this.state.history.push(t),this.state.historyIndex++,this.emit("historyChanged")},undo(){var e;if(this.state.historyIndex>0){this.state.historyIndex--;const t=this.state.history[this.state.historyIndex];this.state.placedNotes=JSON.parse(JSON.stringify(t.notes)),this.state.tonicSignGroups=JSON.parse(JSON.stringify(t.tonicSignGroups)),this.state.stampPlacements=JSON.parse(JSON.stringify(t.stampPlacements||[])),this.state.tripletPlacements=JSON.parse(JSON.stringify(t.tripletPlacements||[])),this.state.timbres=cm(t.timbres),this.state.annotations=t.annotations?JSON.parse(JSON.stringify(t.annotations)):[],this.emit("notesChanged"),this.emit("stampPlacementsChanged"),this.emit("tripletPlacementsChanged"),this.emit("rhythmStructureChanged"),(e=this.state.selectedNote)!=null&&e.color&&this.emit("timbreChanged",this.state.selectedNote.color),this.emit("annotationsChanged"),this.emit("historyChanged")}},redo(){var e;if(this.state.historyIndex<this.state.history.length-1){this.state.historyIndex++;const t=this.state.history[this.state.historyIndex];this.state.placedNotes=JSON.parse(JSON.stringify(t.notes)),this.state.tonicSignGroups=JSON.parse(JSON.stringify(t.tonicSignGroups)),this.state.stampPlacements=JSON.parse(JSON.stringify(t.stampPlacements||[])),this.state.tripletPlacements=JSON.parse(JSON.stringify(t.tripletPlacements||[])),this.state.timbres=cm(t.timbres),this.state.annotations=t.annotations?JSON.parse(JSON.stringify(t.annotations)):[],this.emit("notesChanged"),this.emit("stampPlacementsChanged"),this.emit("tripletPlacementsChanged"),this.emit("rhythmStructureChanged"),(e=this.state.selectedNote)!=null&&e.color&&this.emit("timbreChanged",this.state.selectedNote.color),this.emit("annotationsChanged"),this.emit("historyChanged")}}};function hf(e){return e!==null&&typeof e=="object"&&"name"in e&&typeof e.name=="string"}function uf(e){return e!==null&&typeof e=="object"&&"step"in e&&typeof e.step=="number"&&"alt"in e&&typeof e.alt=="number"&&!isNaN(e.step)&&!isNaN(e.alt)}var Bw=[0,2,4,-1,1,3,5],yw=Bw.map(e=>Math.floor(e*7/12));function Cw(e){const{step:t,alt:s,oct:i,dir:A=1}=e,r=Bw[t]+7*s;if(i===void 0)return[A*r];const a=i-yw[t]-4*s;return[A*r,A*a]}var Ab=[3,0,4,1,5,2,6];function bw(e){const[t,s,i]=e,A=Ab[rb(t)],r=Math.floor((t+1)/7);if(s===void 0)return{step:A,alt:r,dir:i};const a=s+4*r+yw[A];return{step:A,alt:r,oct:a,dir:i}}function rb(e){const t=(e+1)%7;return t<0?7+t:t}var hm=(e,t)=>Array(Math.abs(t)+1).join(e),nd=Object.freeze({empty:!0,name:"",num:NaN,q:"",type:"",step:NaN,alt:NaN,dir:NaN,simple:NaN,semitones:NaN,chroma:NaN,coord:[],oct:NaN}),ob="([-+]?\\d+)(d{1,4}|m|M|P|A{1,4})",ab="(AA|A|P|M|m|d|dd)([-+]?\\d+)",lb=new RegExp("^"+ob+"|"+ab+"$");function cb(e){const t=lb.exec(`${e}`);return t===null?["",""]:t[1]?[t[1],t[2]]:[t[4],t[3]]}var um={};function rn(e){return typeof e=="string"?um[e]||(um[e]=hb(e)):uf(e)?rn(db(e)):hf(e)?rn(e.name):nd}var dm=[0,2,4,5,7,9,11],_w="PMMPPMM";function hb(e){const t=cb(e);if(t[0]==="")return nd;const s=+t[0],i=t[1],A=(Math.abs(s)-1)%7,r=_w[A];if(r==="M"&&i==="P")return nd;const a=r==="M"?"majorable":"perfectable",l=""+s+i,h=s<0?-1:1,u=s===8||s===-8?s:h*(A+1),m=ub(a,i),g=Math.floor((Math.abs(s)-1)/7),v=h*(dm[A]+m+12*g),y=(h*(dm[A]+m)%12+12)%12,C=Cw({step:A,alt:m,oct:g,dir:h});return{empty:!1,name:l,num:s,q:i,step:A,alt:m,dir:h,type:a,simple:u,semitones:v,chroma:y,coord:C,oct:g}}function xw(e,t){const[s,i=0]=e,A=s*7+i*12<0,r=t||A?[-s,-i,-1]:[s,i,1];return rn(bw(r))}function ub(e,t){return t==="M"&&e==="majorable"||t==="P"&&e==="perfectable"?0:t==="m"&&e==="majorable"?-1:/^A+$/.test(t)?t.length:/^d+$/.test(t)?-1*(e==="perfectable"?t.length:t.length+1):0}function db(e){const{step:t,alt:s,oct:i=0,dir:A}=e;if(!A)return"";const r=t+1+7*i,a=r===0?t+1:r,l=A<0?"-":"",h=_w[t]==="M"?"majorable":"perfectable";return l+a+fb(h,s)}function fb(e,t){return t===0?e==="majorable"?"M":"P":t===-1&&e==="majorable"?"m":t>0?hm("A",t):hm("d",e==="perfectable"?t:t+1)}var fm=(e,t)=>Array(Math.abs(t)+1).join(e),Ew=Object.freeze({empty:!0,name:"",letter:"",acc:"",pc:"",step:NaN,alt:NaN,chroma:NaN,height:NaN,coord:[],midi:null,freq:null}),pm=new Map,pb=e=>"CDEFGAB".charAt(e),Sw=e=>e<0?fm("b",-e):fm("#",e),Fw=e=>e[0]==="b"?-e.length:e.length;function je(e){const t=JSON.stringify(e),s=pm.get(t);if(s)return s;const i=typeof e=="string"?vb(e):uf(e)?je(Bb(e)):hf(e)?je(e.name):Ew;return pm.set(t,i),i}var mb=/^([a-gA-G]?)(#{1,}|b{1,}|x{1,}|)(-?\d*)\s*(.*)$/;function df(e){const t=mb.exec(e);return t?[t[1].toUpperCase(),t[2].replace(/x/g,"##"),t[3],t[4]]:["","","",""]}function gb(e){return je(bw(e))}var wb=(e,t)=>(e%t+t)%t,hu=[0,2,4,5,7,9,11];function vb(e){const t=df(e);if(t[0]===""||t[3]!=="")return Ew;const s=t[0],i=t[1],A=t[2],r=(s.charCodeAt(0)+3)%7,a=Fw(i),l=A.length?+A:void 0,h=Cw({step:r,alt:a,oct:l}),u=s+i+A,m=s+i,g=(hu[r]+a+120)%12,v=l===void 0?wb(hu[r]+a,12)-1188:hu[r]+a+12*(l+1),y=v>=0&&v<=127?v:null,C=l===void 0?null:Math.pow(2,(v-69)/12)*440;return{empty:!1,acc:i,alt:a,chroma:g,coord:h,freq:C,height:v,letter:s,midi:y,name:u,oct:l,pc:m,step:r}}function Bb(e){const{step:t,alt:s,oct:i}=e,A=pb(t);if(!A)return"";const r=A+Sw(s);return i||i===0?r+i:r}function mc(e,t){const s=je(e),i=Array.isArray(t)?t:rn(t).coord;if(s.empty||!i||i.length<2)return"";const A=s.coord,r=A.length===1?[A[0]+i[0]]:[A[0]+i[0],A[1]+i[1]];return gb(r).name}function Xl(e,t){const s=je(e),i=je(t);if(s.empty||i.empty)return"";const A=s.coord,r=i.coord,a=r[0]-A[0],l=A.length===2&&r.length===2?r[1]-A[1]:-Math.floor(a*7/12),h=i.height===s.height&&i.midi!==null&&s.oct===i.oct&&s.step>i.step;return xw([a,l],h).name}function ff(e,t){const s=t.length,i=(e%s+s)%s;return t.slice(i,s).concat(t.slice(0,i))}function yb(e){return e.filter(t=>t===0||t)}var hA={empty:!0,name:"",setNum:0,chroma:"000000000000",normalized:"000000000000",intervals:[]},Tw=e=>Number(e).toString(2).padStart(12,"0"),mm=e=>parseInt(e,2),Cb=/^[01]{12}$/;function Iw(e){return Cb.test(e)}var bb=e=>typeof e=="number"&&e>=0&&e<=4095,_b=e=>e&&Iw(e.chroma),gm={[hA.chroma]:hA};function pf(e){const t=Iw(e)?e:bb(e)?Tw(e):Array.isArray(e)?Ib(e):_b(e)?e.chroma:hA.chroma;return gm[t]=gm[t]||Tb(t)}var xb=["1P","2m","2M","3m","3M","4P","5d","5P","6m","6M","7m","7M"];function Eb(e){const t=[];for(let s=0;s<12;s++)e.charAt(s)==="1"&&t.push(xb[s]);return t}function Sb(e,t=!0){const i=pf(e).chroma.split("");return yb(i.map((A,r)=>{const a=ff(r,i);return t&&a[0]==="0"?null:a.join("")}))}function Fb(e){const t=e.split("");return t.map((s,i)=>ff(i,t).join(""))}function Tb(e){const t=mm(e),s=Fb(e).map(mm).filter(r=>r>=2048).sort()[0],i=Tw(s),A=Eb(e);return{empty:!1,name:"",setNum:t,chroma:e,normalized:i,intervals:A}}function Ib(e){if(e.length===0)return hA.chroma;let t;const s=[0,0,0,0,0,0,0,0,0,0,0,0];for(let i=0;i<e.length;i++)t=je(e[i]),t.empty&&(t=rn(e[i])),t.empty||(s[t.chroma]=1);return s.join("")}var Qb=[["1P 3M 5P","major","M ^  maj"],["1P 3M 5P 7M","major seventh","maj7  ma7 M7 Maj7 ^7"],["1P 3M 5P 7M 9M","major ninth","maj9 9 ^9"],["1P 3M 5P 7M 9M 13M","major thirteenth","maj13 Maj13 ^13"],["1P 3M 5P 6M","sixth","6 add6 add13 M6"],["1P 3M 5P 6M 9M","sixth added ninth","6add9 6/9 69 M69"],["1P 3M 6m 7M","major seventh flat sixth","M7b6 ^7b6"],["1P 3M 5P 7M 11A","major seventh sharp eleventh","maj#4 #4 #11 M7#11 ^7#11 maj7#11"],["1P 3m 5P","minor","m min -"],["1P 3m 5P 7m","minor seventh","m7 min7 mi7 -7"],["1P 3m 5P 7M","minor/major seventh","m/ma7 m/maj7 mM7 mMaj7 m/M7 -7 m -^7 -maj7"],["1P 3m 5P 6M","minor sixth","m6 -6"],["1P 3m 5P 7m 9M","minor ninth","m9 -9"],["1P 3m 5P 7M 9M","minor/major ninth","mM9 mMaj9 -^9"],["1P 3m 5P 7m 9M 11P","minor eleventh","m11 -11"],["1P 3m 5P 7m 9M 13M","minor thirteenth","m13 -13"],["1P 3m 5d","diminished","dim  o"],["1P 3m 5d 7d","diminished seventh","dim7 7 o7"],["1P 3m 5d 7m","half-diminished","m7b5  -7b5 h7 h"],["1P 3M 5P 7m","dominant seventh","7 dom"],["1P 3M 5P 7m 9M","dominant ninth","9"],["1P 3M 5P 7m 9M 13M","dominant thirteenth","13"],["1P 3M 5P 7m 11A","lydian dominant seventh","7#11 7#4"],["1P 3M 5P 7m 9m","dominant flat ninth","7b9"],["1P 3M 5P 7m 9A","dominant sharp ninth","7#9"],["1P 3M 7m 9m","altered","alt7"],["1P 4P 5P","suspended fourth","sus4 sus"],["1P 2M 5P","suspended second","sus2"],["1P 4P 5P 7m","suspended fourth seventh","7sus4 7sus"],["1P 5P 7m 9M 11P","eleventh","11"],["1P 4P 5P 7m 9m","suspended fourth flat ninth","b9sus phryg 7b9sus 7b9sus4"],["1P 5P","fifth","5"],["1P 3M 5A","augmented","aug + +5 ^#5"],["1P 3m 5A","minor augmented","m#5 -#5 m+"],["1P 3M 5A 7M","augmented seventh","maj7#5 maj7+5 +maj7 ^7#5"],["1P 3M 5P 7M 9M 11A","major sharp eleventh (lydian)","maj9#11 9#11 ^9#11"],["1P 2M 4P 5P","","sus24 sus4add9"],["1P 3M 5A 7M 9M","","maj9#5 Maj9#5"],["1P 3M 5A 7m","","7#5 +7 7+ 7aug aug7"],["1P 3M 5A 7m 9A","","7#5#9 7#9#5 7alt"],["1P 3M 5A 7m 9M","","9#5 9+"],["1P 3M 5A 7m 9M 11A","","9#5#11"],["1P 3M 5A 7m 9m","","7#5b9 7b9#5"],["1P 3M 5A 7m 9m 11A","","7#5b9#11"],["1P 3M 5A 9A","","+add#9"],["1P 3M 5A 9M","","M#5add9 +add9"],["1P 3M 5P 6M 11A","","M6#11 M6b5 6#11 6b5"],["1P 3M 5P 6M 7M 9M","","M7add13"],["1P 3M 5P 6M 9M 11A","","69#11"],["1P 3m 5P 6M 9M","","m69 -69"],["1P 3M 5P 6m 7m","","7b6"],["1P 3M 5P 7M 9A 11A","","maj7#9#11"],["1P 3M 5P 7M 9M 11A 13M","","M13#11 maj13#11 M13+4 M13#4"],["1P 3M 5P 7M 9m","","M7b9"],["1P 3M 5P 7m 11A 13m","","7#11b13 7b5b13"],["1P 3M 5P 7m 13M","","7add6 67 7add13"],["1P 3M 5P 7m 9A 11A","","7#9#11 7b5#9 7#9b5"],["1P 3M 5P 7m 9A 11A 13M","","13#9#11"],["1P 3M 5P 7m 9A 11A 13m","","7#9#11b13"],["1P 3M 5P 7m 9A 13M","","13#9"],["1P 3M 5P 7m 9A 13m","","7#9b13"],["1P 3M 5P 7m 9M 11A","","9#11 9+4 9#4"],["1P 3M 5P 7m 9M 11A 13M","","13#11 13+4 13#4"],["1P 3M 5P 7m 9M 11A 13m","","9#11b13 9b5b13"],["1P 3M 5P 7m 9m 11A","","7b9#11 7b5b9 7b9b5"],["1P 3M 5P 7m 9m 11A 13M","","13b9#11"],["1P 3M 5P 7m 9m 11A 13m","","7b9b13#11 7b9#11b13 7b5b9b13"],["1P 3M 5P 7m 9m 13M","","13b9"],["1P 3M 5P 7m 9m 13m","","7b9b13"],["1P 3M 5P 7m 9m 9A","","7b9#9"],["1P 3M 5P 9M","","Madd9 2 add9 add2"],["1P 3M 5P 9m","","Maddb9"],["1P 3M 5d","","Mb5"],["1P 3M 5d 6M 7m 9M","","13b5"],["1P 3M 5d 7M","","M7b5"],["1P 3M 5d 7M 9M","","M9b5"],["1P 3M 5d 7m","","7b5"],["1P 3M 5d 7m 9M","","9b5"],["1P 3M 7m","","7no5"],["1P 3M 7m 13m","","7b13"],["1P 3M 7m 9M","","9no5"],["1P 3M 7m 9M 13M","","13no5"],["1P 3M 7m 9M 13m","","9b13"],["1P 3m 4P 5P","","madd4"],["1P 3m 5P 6m 7M","","mMaj7b6"],["1P 3m 5P 6m 7M 9M","","mMaj9b6"],["1P 3m 5P 7m 11P","","m7add11 m7add4"],["1P 3m 5P 9M","","madd9"],["1P 3m 5d 6M 7M","","o7M7"],["1P 3m 5d 7M","","oM7"],["1P 3m 6m 7M","","mb6M7"],["1P 3m 6m 7m","","m7#5"],["1P 3m 6m 7m 9M","","m9#5"],["1P 3m 5A 7m 9M 11P","","m11A"],["1P 3m 6m 9m","","mb6b9"],["1P 2M 3m 5d 7m","","m9b5"],["1P 4P 5A 7M","","M7#5sus4"],["1P 4P 5A 7M 9M","","M9#5sus4"],["1P 4P 5A 7m","","7#5sus4"],["1P 4P 5P 7M","","M7sus4"],["1P 4P 5P 7M 9M","","M9sus4"],["1P 4P 5P 7m 9M","","9sus4 9sus"],["1P 4P 5P 7m 9M 13M","","13sus4 13sus"],["1P 4P 5P 7m 9m 13m","","7sus4b9b13 7b9b13sus4"],["1P 4P 7m 10m","","4 quartal"],["1P 5P 7m 9m 11P","","11b9"]],Mb=Qb,Ub={...hA,name:"",quality:"Unknown",intervals:[],aliases:[]},mf=[],Io={};function Pb(e){return Io[e]||Ub}function kb(){return mf.slice()}function Db(e,t,s){const i=Hb(e),A={...pf(e),name:s||"",quality:i,intervals:e,aliases:t};mf.push(A),A.name&&(Io[A.name]=A),Io[A.setNum]=A,Io[A.chroma]=A,A.aliases.forEach(r=>Lb(A,r))}function Lb(e,t){Io[t]=e}function Hb(e){const t=s=>e.indexOf(s)!==-1;return t("5A")?"Augmented":t("3M")?"Major":t("5d")?"Diminished":t("3m")?"Minor":"Unknown"}Mb.forEach(([e,t,s])=>Db(e.split(" "),s.split(" "),t));mf.sort((e,t)=>e.setNum-t.setNum);var Rb=e=>{const t=e.reduce((s,i)=>{const A=je(i).chroma;return A!==void 0&&(s[A]=s[A]||je(i).name),s},{});return s=>t[s]};function Ob(e,t={}){const s=e.map(A=>je(A).pc).filter(A=>A);return je.length===0?[]:zb(s,1,t).filter(A=>A.weight).sort((A,r)=>r.weight-A.weight).map(A=>A.name)}var gc={anyThirds:384,perfectFifth:16,nonPerfectFifths:40,anySeventh:3},wc=e=>t=>!!(t&e),Nb=wc(gc.anyThirds),Vb=wc(gc.perfectFifth),Wb=wc(gc.anySeventh),Gb=wc(gc.nonPerfectFifths);function Kb(e){const t=parseInt(e.chroma,2);return Nb(t)&&Vb(t)&&Wb(t)}function qb(e){const t=parseInt(e,2);return Gb(t)?e:(t|16).toString(2)}function zb(e,t,s){const i=e[0],A=je(i).chroma,r=Rb(e),a=Sb(e,!1),l=[];return a.forEach((h,u)=>{const m=s.assumePerfectFifth&&qb(h);kb().filter(v=>s.assumePerfectFifth&&Kb(v)?v.chroma===m:v.chroma===h).forEach(v=>{const y=v.aliases[0],C=r(u);u!==A?l.push({weight:.5*t,name:`${C}${y}/${i}`}):l.push({weight:1*t,name:`${C}${y}`})})}),l}var $b=rn;function Xb(e){const t=rn(e);if(t.empty)return"";const s=(7-t.step)%7,i=t.type==="perfectable"?-t.alt:-(t.alt+1);return rn({step:s,alt:i,oct:t.oct,dir:t.dir}).name}var wm=Xl,Yb=jb((e,t)=>[e[0]-t[0],e[1]-t[1]]);function jb(e){return(t,s)=>{const i=rn(t).coord,A=rn(s).coord;if(i&&A){const r=e(i,A);return xw(r).name}}}var Jb=[["1P 2M 3M 5P 6M","major pentatonic","pentatonic"],["1P 2M 3M 4P 5P 6M 7M","major","ionian"],["1P 2M 3m 4P 5P 6m 7m","minor","aeolian"],["1P 2M 3m 3M 5P 6M","major blues"],["1P 3m 4P 5d 5P 7m","minor blues","blues"],["1P 2M 3m 4P 5P 6M 7M","melodic minor"],["1P 2M 3m 4P 5P 6m 7M","harmonic minor"],["1P 2M 3M 4P 5P 6M 7m 7M","bebop"],["1P 2M 3m 4P 5d 6m 6M 7M","diminished","whole-half diminished"],["1P 2M 3m 4P 5P 6M 7m","dorian"],["1P 2M 3M 4A 5P 6M 7M","lydian"],["1P 2M 3M 4P 5P 6M 7m","mixolydian","dominant"],["1P 2m 3m 4P 5P 6m 7m","phrygian"],["1P 2m 3m 4P 5d 6m 7m","locrian"],["1P 3M 4P 5P 7M","ionian pentatonic"],["1P 3M 4P 5P 7m","mixolydian pentatonic","indian"],["1P 2M 4P 5P 6M","ritusen"],["1P 2M 4P 5P 7m","egyptian"],["1P 3M 4P 5d 7m","neopolitan major pentatonic"],["1P 3m 4P 5P 6m","vietnamese 1"],["1P 2m 3m 5P 6m","pelog"],["1P 2m 4P 5P 6m","kumoijoshi"],["1P 2M 3m 5P 6m","hirajoshi"],["1P 2m 4P 5d 7m","iwato"],["1P 2m 4P 5P 7m","in-sen"],["1P 3M 4A 5P 7M","lydian pentatonic","chinese"],["1P 3m 4P 6m 7m","malkos raga"],["1P 3m 4P 5d 7m","locrian pentatonic","minor seven flat five pentatonic"],["1P 3m 4P 5P 7m","minor pentatonic","vietnamese 2"],["1P 3m 4P 5P 6M","minor six pentatonic"],["1P 2M 3m 5P 6M","flat three pentatonic","kumoi"],["1P 2M 3M 5P 6m","flat six pentatonic"],["1P 2m 3M 5P 6M","scriabin"],["1P 3M 5d 6m 7m","whole tone pentatonic"],["1P 3M 4A 5A 7M","lydian #5P pentatonic"],["1P 3M 4A 5P 7m","lydian dominant pentatonic"],["1P 3m 4P 5P 7M","minor #7M pentatonic"],["1P 3m 4d 5d 7m","super locrian pentatonic"],["1P 2M 3m 4P 5P 7M","minor hexatonic"],["1P 2A 3M 5P 5A 7M","augmented"],["1P 2M 4P 5P 6M 7m","piongio"],["1P 2m 3M 4A 6M 7m","prometheus neopolitan"],["1P 2M 3M 4A 6M 7m","prometheus"],["1P 2m 3M 5d 6m 7m","mystery #1"],["1P 2m 3M 4P 5A 6M","six tone symmetric"],["1P 2M 3M 4A 5A 6A","whole tone","messiaen's mode #1"],["1P 2m 4P 4A 5P 7M","messiaen's mode #5"],["1P 2M 3M 4P 5d 6m 7m","locrian major","arabian"],["1P 2m 3M 4A 5P 6m 7M","double harmonic lydian"],["1P 2m 2A 3M 4A 6m 7m","altered","super locrian","diminished whole tone","pomeroy"],["1P 2M 3m 4P 5d 6m 7m","locrian #2","half-diminished","aeolian b5"],["1P 2M 3M 4P 5P 6m 7m","mixolydian b6","melodic minor fifth mode","hindu"],["1P 2M 3M 4A 5P 6M 7m","lydian dominant","lydian b7","overtone"],["1P 2M 3M 4A 5A 6M 7M","lydian augmented"],["1P 2m 3m 4P 5P 6M 7m","dorian b2","phrygian #6","melodic minor second mode"],["1P 2m 3m 4d 5d 6m 7d","ultralocrian","superlocrian bb7","superlocrian diminished"],["1P 2m 3m 4P 5d 6M 7m","locrian 6","locrian natural 6","locrian sharp 6"],["1P 2A 3M 4P 5P 5A 7M","augmented heptatonic"],["1P 2M 3m 4A 5P 6M 7m","dorian #4","ukrainian dorian","romanian minor","altered dorian"],["1P 2M 3m 4A 5P 6M 7M","lydian diminished"],["1P 2M 3M 4A 5A 7m 7M","leading whole tone"],["1P 2M 3M 4A 5P 6m 7m","lydian minor"],["1P 2m 3M 4P 5P 6m 7m","phrygian dominant","spanish","phrygian major"],["1P 2m 3m 4P 5P 6m 7M","balinese"],["1P 2m 3m 4P 5P 6M 7M","neopolitan major"],["1P 2M 3M 4P 5P 6m 7M","harmonic major"],["1P 2m 3M 4P 5P 6m 7M","double harmonic major","gypsy"],["1P 2M 3m 4A 5P 6m 7M","hungarian minor"],["1P 2A 3M 4A 5P 6M 7m","hungarian major"],["1P 2m 3M 4P 5d 6M 7m","oriental"],["1P 2m 3m 3M 4A 5P 7m","flamenco"],["1P 2m 3m 4A 5P 6m 7M","todi raga"],["1P 2m 3M 4P 5d 6m 7M","persian"],["1P 2m 3M 5d 6m 7m 7M","enigmatic"],["1P 2M 3M 4P 5A 6M 7M","major augmented","major #5","ionian augmented","ionian #5"],["1P 2A 3M 4A 5P 6M 7M","lydian #9"],["1P 2m 2M 4P 4A 5P 6m 7M","messiaen's mode #4"],["1P 2m 3M 4P 4A 5P 6m 7M","purvi raga"],["1P 2m 3m 3M 4P 5P 6m 7m","spanish heptatonic"],["1P 2M 3m 3M 4P 5P 6M 7m","bebop minor"],["1P 2M 3M 4P 5P 5A 6M 7M","bebop major"],["1P 2m 3m 4P 5d 5P 6m 7m","bebop locrian"],["1P 2M 3m 4P 5P 6m 7m 7M","minor bebop"],["1P 2M 3M 4P 5d 5P 6M 7M","ichikosucho"],["1P 2M 3m 4P 5P 6m 6M 7M","minor six diminished"],["1P 2m 3m 3M 4A 5P 6M 7m","half-whole diminished","dominant diminished","messiaen's mode #2"],["1P 3m 3M 4P 5P 6M 7m 7M","kafi raga"],["1P 2M 3M 4P 4A 5A 6A 7M","messiaen's mode #6"],["1P 2M 3m 3M 4P 5d 5P 6M 7m","composite blues"],["1P 2M 3m 3M 4A 5P 6m 7m 7M","messiaen's mode #3"],["1P 2m 2M 3m 4P 4A 5P 6m 6M 7M","messiaen's mode #7"],["1P 2m 2M 3m 3M 4P 5d 5P 6m 6M 7m 7M","chromatic"]],Zb=Jb,t_={...hA,intervals:[],aliases:[]},Qo={};function Qw(e){return Qo[e]||t_}function e_(e,t,s=[]){const i={...pf(e),name:t,intervals:e,aliases:s};return Qo[i.name]=i,Qo[i.setNum]=i,Qo[i.chroma]=i,i.aliases.forEach(A=>s_(i,A)),i}function s_(e,t){Qo[t]=e}Zb.forEach(([e,t,...s])=>e_(e.split(" "),t,s));var Mw={empty:!0,name:"",symbol:"",root:"",bass:"",rootDegree:0,type:"",tonic:null,setNum:NaN,quality:"Unknown",chroma:"",normalized:"",aliases:[],notes:[],intervals:[]};function Uw(e){const[t,s,i,A]=df(e);return t===""?uu("",e):t==="A"&&A==="ug"?uu("","aug"):uu(t+s,i+A)}function uu(e,t){const s=t.split("/");if(s.length===1)return[e,s[0],""];const[i,A,r,a]=df(s[1]);return i!==""&&r===""&&a===""?[e,s[0],i+A]:[e,t,""]}function vm(e){if(Array.isArray(e))return du(e[1]||"",e[0],e[2]);if(e==="")return Mw;{const[t,s,i]=Uw(e),A=du(s,t,i);return A.empty?du(e):A}}function du(e,t,s){const i=Pb(e),A=je(t||""),r=je(s||"");if(i.empty||t&&A.empty||s&&r.empty)return Mw;const a=Xl(A.pc,r.pc),l=i.intervals.indexOf(a),h=l>=0,u=h?r:je(""),m=l===-1?NaN:l+1,g=r.pc&&r.pc!==A.pc,v=Array.from(i.intervals);if(h)for(let F=1;F<m;F++){const I=v[0][0],T=v[0][1],U=parseInt(I,10)+7;v.push(`${U}${T}`),v.shift()}else if(g){const F=Yb(Xl(A.pc,r.pc),"8P");F&&v.unshift(F)}const y=A.empty?[]:v.map(F=>mc(A.pc,F));e=i.aliases.indexOf(e)!==-1?e:i.aliases[0];const C=`${A.empty?"":A.pc}${e}${h&&m>1?"/"+u.pc:g?"/"+r.pc:""}`,x=`${t?A.pc+" ":""}${i.name}${h&&m>1?" over "+u.pc:g?" over "+r.pc:""}`;return{...i,name:x,symbol:C,tonic:A.pc,type:i.name,root:u.pc,bass:g?r.pc:"",intervals:v,rootDegree:m,notes:y}}var n_=[[.125,"dl",["large","duplex longa","maxima","octuple","octuple whole"]],[.25,"l",["long","longa"]],[.5,"d",["double whole","double","breve"]],[1,"w",["whole","semibreve"]],[2,"h",["half","minim"]],[4,"q",["quarter","crotchet"]],[8,"e",["eighth","quaver"]],[16,"s",["sixteenth","semiquaver"]],[32,"t",["thirty-second","demisemiquaver"]],[64,"sf",["sixty-fourth","hemidemisemiquaver"]],[128,"h",["hundred twenty-eighth"]],[256,"th",["two hundred fifty-sixth"]]],i_=n_;i_.forEach(([e,t,s])=>void 0);var A_="C C# D D# E F F# G G# A A# B".split(" "),r_="C Db D Eb E F Gb G Ab A Bb B".split(" ");function gf(e,t={}){if(isNaN(e)||e===-1/0||e===1/0)return"";e=Math.round(e);const i=(t.sharps===!0?A_:r_)[e%12];if(t.pitchClass)return i;const A=Math.floor(e/12)-1;return i+A}var Xo=je,id=e=>Xo(e).pc,Fi=e=>Xo(e).midi;function o_(e){return gf(e)}var Mo=mc,Ql=e=>{const t=Xo(e);return t.empty?"":gf(t.midi||t.chroma,{sharps:t.alt>0,pitchClass:t.midi===null})};function Zn(e,t){const s=Xo(e);if(s.empty)return"";const i=Xo(t||gf(s.midi||s.chroma,{sharps:s.alt<0,pitchClass:!0}));if(i.empty||i.chroma!==s.chroma)return"";if(s.oct===void 0)return i.pc;const A=s.chroma-s.alt,r=i.chroma-i.alt,a=A>11||r<0?-1:A<0||r>11?1:0,l=s.oct+a;return i.pc+l}var Pw={empty:!0,name:"",chordType:""},Bm={};function Yo(e){return typeof e=="string"?Bm[e]||(Bm[e]=u_(e)):typeof e=="number"?Yo(wf[e]||""):uf(e)?a_(e):hf(e)?Yo(e.name):Pw}function a_(e){return Yo(Sw(e.alt)+wf[e.step])}var l_=/^(#{1,}|b{1,}|x{1,}|)(IV|I{1,3}|VI{0,2}|iv|i{1,3}|vi{0,2})([^IViv]*)$/;function c_(e){return l_.exec(e)||["","","",""]}var h_="I II III IV V VI VII",wf=h_.split(" ");function u_(e){const[t,s,i,A]=c_(e);if(!i)return Pw;const r=i.toUpperCase(),a=wf.indexOf(r),l=Fw(s),h=1;return{empty:!1,name:t,roman:i,interval:rn({step:a,alt:l,dir:h}).name,acc:s,chordType:A,alt:l,step:a,major:i===r,oct:0,dir:h}}var vf=[[0,2773,0,"ionian","","Maj7","major"],[1,2902,2,"dorian","m","m7"],[2,3418,4,"phrygian","m","m7"],[3,2741,-1,"lydian","","Maj7"],[4,2774,1,"mixolydian","","7"],[5,2906,3,"aeolian","m","m7","minor"],[6,3434,5,"locrian","dim","m7b5"]],ym={...hA,name:"",alt:0,modeNum:NaN,triad:"",seventh:"",aliases:[]},d_=vf.map(f_),Ad={};d_.forEach(e=>{Ad[e.name]=e,e.aliases.forEach(t=>{Ad[t]=e})});function kw(e){return typeof e=="string"?Ad[e.toLowerCase()]||ym:e&&e.name?kw(e.name):ym}function f_(e){const[t,s,i,A,r,a,l]=e,h=l?[l]:[],u=Number(s).toString(2);return{empty:!1,intervals:Qw(A).intervals,modeNum:t,chroma:u,normalized:u,name:A,setNum:s,alt:i,triad:r,seventh:a,aliases:h}}function Dw(e){return(t,s)=>{const i=kw(t);if(i.empty)return[];const A=ff(i.modeNum,e),r=i.intervals.map(a=>mc(s,a));return A.map((a,l)=>r[l]+a)}}Dw(vf.map(e=>e[4]));Dw(vf.map(e=>e[5]));function p_(e,t){return t.map(s=>{const[i,A]=Uw(s),r=Xl(e,i);return Yo(rn(r)).name+A})}var m_={empty:!0,name:"",type:"",tonic:null,setNum:NaN,chroma:"",normalized:"",aliases:[],notes:[],intervals:[]};function g_(e){if(typeof e!="string")return["",""];const t=e.indexOf(" "),s=je(e.substring(0,t));if(s.empty){const A=je(e);return A.empty?["",e.toLowerCase()]:[A.name,""]}const i=e.substring(s.name.length+1).toLowerCase();return[s.name,i.length?i:""]}function w_(e){const t=Array.isArray(e)?e:g_(e),s=je(t[0]).name,i=Qw(t[1]);if(i.empty)return m_;const A=i.name,r=s?i.intervals.map(l=>mc(s,l)):[],a=s?s+" "+A:A;return{...i,name:a,type:A,tonic:s,notes:r}}const v_=["major","dorian","phrygian","lydian","mixolydian","minor","locrian"],Ai=e=>e.tonicSignGroups?Object.values(e.tonicSignGroups).flat():[],An=(e,t)=>{let s=2;const{macrobeatGroupings:i}=e,A=Ai(e);A.some(h=>h.preMacrobeatIndex===-1)&&(s+=2);for(let h=0;h<t;h++)s+=i[h],A.some(u=>u.preMacrobeatIndex===h)&&(s+=2);const r=s,a=i[t],l=r+(a||0)-1;return{startColumn:r,endColumn:l,grouping:a}},B_=e=>e.placedNotes.filter(t=>!t.isDrum),y_=e=>e.placedNotes.filter(t=>t.isDrum),C_=(e,t)=>{const i=Ai(e).filter(l=>l.columnIndex<=t);if(i.length===0)return{keyTonic:"C",keyMode:"major"};const A=i.reduce((l,h)=>h.columnIndex>l.columnIndex?h:l),r=id(e.fullRowData[A.row].toneNote),a=v_[A.tonicNumber-1]||"major";return{keyTonic:r,keyMode:a}};let b_=class{constructor(){this.logLevel="ERROR",this.enabledLevels={DEBUG:!1,INFO:!1,WARN:!1,ERROR:!0},this.categories={general:!1,state:!1,canvas:!1,audio:!1,ui:!1,layout:!1,harmony:!1,paint:!1,performance:!1,initialization:!1,transport:!1,grid:!1,toolbar:!1,zoom:!1,scroll:!1,keyboard:!1,mouse:!1,adsr:!1,filter:!1,waveform:!1,debug:!1}}enable(...t){t.forEach(s=>{Object.prototype.hasOwnProperty.call(this.categories,s)&&(this.categories[s]=!0)})}disable(...t){t.forEach(s=>{Object.prototype.hasOwnProperty.call(this.categories,s)&&(this.categories[s]=!1)})}enableAll(){Object.keys(this.categories).forEach(t=>{this.categories[t]=!0}),this.setLevel("DEBUG")}disableAll(){Object.keys(this.categories).forEach(t=>{this.categories[t]=!1}),this.setLevel("ERROR")}isCategoryEnabled(t){return this.categories[t]===!0}setLevel(t){const i=["DEBUG","INFO","WARN","ERROR"].indexOf(t);i!==-1&&(this.enabledLevels={DEBUG:i<=0,INFO:i<=1,WARN:i<=2,ERROR:i<=3})}formatComponent(t){return`[${t}]`}moduleLoaded(t,s="general"){!this.enabledLevels.INFO||this.isCategoryEnabled(s)}initStart(t,s="initialization"){!this.enabledLevels.INFO||this.isCategoryEnabled(s)}initSuccess(t,s="initialization"){!this.enabledLevels.INFO||this.isCategoryEnabled(s)}initFailed(t,s="",i="initialization"){!this.enabledLevels.WARN||this.isCategoryEnabled(i)}section(t,s="general"){!this.enabledLevels.INFO||this.isCategoryEnabled(s)}event(t,s,i="",A="ui"){!this.enabledLevels.INFO||this.isCategoryEnabled(A)}state(t,s,i=null,A="state"){!this.enabledLevels.INFO||this.isCategoryEnabled(A)}debug(t,s,i=null,A="debug"){!this.enabledLevels.DEBUG||this.isCategoryEnabled(A)}timing(t,s,i,A="performance"){!this.enabledLevels.DEBUG||this.isCategoryEnabled(A)}warn(t,s,i=null,A="general"){!this.enabledLevels.WARN||this.isCategoryEnabled(A)}error(t,s,i=null,A="general"){this.enabledLevels.ERROR}info(t,s,i=null,A="general"){!this.enabledLevels.INFO||this.isCategoryEnabled(A)}getConfig(){return{logLevel:this.logLevel,enabledLevels:{...this.enabledLevels},enabledCategories:Object.entries(this.categories).filter(([,t])=>t).map(([t])=>t)}}getAvailableCategories(){return Object.keys(this.categories)}log(t,s,i=null){this.info(t,s,i,"general")}};const _=new b_;typeof window<"u"&&(window.logger=_);const __={0:{degree:1,alt:0},1:{degree:2,alt:-1},2:{degree:2,alt:0},3:{degree:3,alt:-1},4:{degree:3,alt:0},5:{degree:4,alt:0},6:{degree:5,alt:-1},7:{degree:5,alt:0},8:{degree:6,alt:-1},9:{degree:6,alt:0},10:{degree:7,alt:-1},11:{degree:7,alt:0}};function x_(e){if(Math.abs(e.num)!==8||e.alt>=0)return null;const s=(e.semitones%12+12)%12;return __[s]||null}function Cm(e){if(!e)return null;const t=$b(e);if(!t||t.num===void 0)return null;const s=x_(t),i=s?s.degree:Math.abs(t.num),A=s?s.alt:t.alt;let r="";return A<0?r="".repeat(Math.abs(A)):A>0&&(r="".repeat(A)),`${r}${i}`}function bm(e){return e&&{"1":"2","2":"1","2":"3","3":"2","4":"5","5":"4","5":"6","6":"5","6":"7","7":"6"}[e]||null}function _m(e){return e&&(e.includes("")||e.includes(""))}const Uo={getEnharmonicDegree:bm,hasAccidental:_m,getDegreeForNote(e,t){var u;if(!e||!t)return null;const{keyTonic:s,keyMode:i}=C_(t,e.startColumnIndex);if(!s)return null;const A=(u=t.fullRowData[e.row])==null?void 0:u.toneNote;if(!A)return null;const r=id(A);let a=s;if(t.degreeDisplayMode!=="modal"&&i!=="major"){const g=["major","dorian","phrygian","lydian","mixolydian","minor","locrian"].indexOf(i);if(g>0){const y=["1P","2M","3M","4P","5P","6M","7M"][g];a=Mo(s,Xb(y))}}const l=wm(a,r),h=Cm(l);if(e.enharmonicPreference&&_m(h)){const m=bm(h);if(m)return m}return h},getDegreesForNotes(e,t){return!e||e.length===0?[]:e.map(s=>{const i=wm(t,id(s));return Cm(i)})},getRomanNumeralForNotes(e,t){if(!e||e.length<2)return null;const[s]=Ob(e);if(!s)return null;const i=vm(s).symbol;if(!i)return null;const[A]=p_(t,[i]);if(!A)return null;const r=Yo(A),a=r.roman;let l=r.name.replace(a,"");const h=vm(s).tonic;return l==="6"&&(l="add6"),{roman:a,ext:l,root:h}}};function rd(e){if(!(!e||e.isDrum)&&e.shape==="circle"&&typeof e.startColumnIndex=="number"){const t=e.startColumnIndex+1;(typeof e.endColumnIndex!="number"||e.endColumnIndex<t)&&(e.endColumnIndex=t)}}function fu(){return`uuid-${Date.now()}-${Math.random().toString(36).substr(2,9)}`}const E_={addNote(e){const t=this.state.placedNotes.find(i=>!i.isDrum&&i.row===e.row&&i.startColumnIndex===e.startColumnIndex&&i.color===e.color);if(t){if(this.state.degreeDisplayMode!=="off"){const i=Uo.getDegreeForNote(t,this.state);if(Uo.hasAccidental(i))return t.enharmonicPreference=!t.enharmonicPreference,_.debug("NoteActions","[ENHARMONIC] Toggled enharmonic preference for note",{noteUuid:t.uuid,currentDegree:i,enharmonicPreference:t.enharmonicPreference},"notes"),this.emit("notesChanged"),t}return null}const s={...e,uuid:fu()};return rd(s),this.state.placedNotes.push(s),this.emit("notesChanged"),s},updateNoteTail(e,t){let s=t;e.shape==="circle"&&(s=Math.max(e.startColumnIndex+1,t)),e.endColumnIndex=s,this.emit("notesChanged")},updateMultipleNoteTails(e,t){e.forEach(s=>{let i=t;s.shape==="circle"&&(i=Math.max(s.startColumnIndex+1,t)),s.endColumnIndex=i}),this.emit("notesChanged")},updateNoteRow(e,t){e.row=t,this.emit("notesChanged")},updateMultipleNoteRows(e,t){e.forEach((s,i)=>{s.row=t[i]}),this.emit("notesChanged")},updateNotePosition(e,t){e.startColumnIndex=t,e.endColumnIndex=e.shape==="circle"?t+1:t,this.emit("notesChanged")},updateMultipleNotePositions(e,t){e.forEach(s=>{s.startColumnIndex=t,s.endColumnIndex=s.shape==="circle"?t+1:t}),this.emit("notesChanged")},eraseInPitchArea(e,t,s=1,i=!0){const A=e+s-1,r=t-1,a=t+1;let l=!1;const h=this.state.placedNotes.length;return this.state.placedNotes=this.state.placedNotes.filter(u=>{if(u.isDrum)return!0;if(u.shape==="circle"){const m=u.startColumnIndex+1,g=typeof u.endColumnIndex=="number"?Math.max(m,u.endColumnIndex):m,v=u.startColumnIndex<=A&&g>=e,y=u.row>=r&&u.row<=a;if(v&&y)return!1}else if(u.row>=r&&u.row<=a&&u.startColumnIndex<=A&&u.endColumnIndex>=e)return!1;return!0}),this.state.placedNotes.length<h&&(l=!0),l&&(this.emit("notesChanged"),i&&this.recordState()),l},eraseDrumNoteAt(e,t,s=!0){const i=this.state.placedNotes.length;this.state.placedNotes=this.state.placedNotes.filter(r=>!(r.isDrum&&r.drumTrack===t&&r.startColumnIndex===e));const A=this.state.placedNotes.length<i;return A&&(this.emit("notesChanged"),s&&this.recordState()),A},addTonicSignGroup(e){_.debug("TonicPlacement","Starting addTonicSignGroup",{tonicSignGroup:e},"state");const t=e[0],{preMacrobeatIndex:s}=t;if(_.debug("TonicPlacement","preMacrobeatIndex",{preMacrobeatIndex:s},"state"),Object.values(this.state.tonicSignGroups).flat().some(l=>l.preMacrobeatIndex===s)){_.debug("TonicPlacement","Tonic already exists at this preMacrobeatIndex, returning",null,"state");return}const i=An(this.state,s+1).startColumn;_.debug("TonicPlacement","Boundary column for shifting notes",{boundaryColumn:i},"state");const A=this.state.placedNotes.filter(l=>l.startColumnIndex>=i);_.debug("TonicPlacement","Notes that will be shifted",{noteRanges:A.map(l=>`${l.startColumnIndex}-${l.endColumnIndex}`)},"state"),this.state.placedNotes.forEach(l=>{if(l.startColumnIndex>=i){const h=l.startColumnIndex,u=l.endColumnIndex;l.startColumnIndex+=2,l.endColumnIndex+=2,_.debug("TonicPlacement",`Shifted note from ${h}-${u} to ${l.startColumnIndex}-${l.endColumnIndex}`,null,"state")}});const r=fu(),a=e.map(l=>({...l,uuid:r}));this.state.tonicSignGroups[r]=a,_.debug("TonicPlacement","Added tonic group",{uuid:r,columns:a.map(l=>l.columnIndex)},"state"),_.debug("TonicPlacement","Emitting events: notesChanged, rhythmStructureChanged",null,"state"),this.emit("notesChanged"),this.emit("rhythmStructureChanged"),this.recordState()},eraseTonicSignAt(e,t=!0){const s=Object.entries(this.state.tonicSignGroups).find(([,l])=>l.some(h=>h.columnIndex===e));if(!s)return!1;const[i,A]=s,r=A[0].preMacrobeatIndex,a=An(this.state,r+1).startColumn;return delete this.state.tonicSignGroups[i],this.state.placedNotes.forEach(l=>{l.startColumnIndex>=a&&(l.startColumnIndex-=2,l.endColumnIndex-=2)}),this.emit("notesChanged"),this.emit("rhythmStructureChanged"),t&&this.recordState(),!0},toggleDrumNote(e){const t=this.state.placedNotes.findIndex(s=>s.isDrum&&s.drumTrack===e.drumTrack&&s.startColumnIndex===e.startColumnIndex);t>=0?this.state.placedNotes.splice(t,1):this.state.placedNotes.push({...e,uuid:fu()}),this.emit("notesChanged"),this.recordState()},clearAllNotes(){this.state.placedNotes=[],this.state.tonicSignGroups={},this.emit("notesChanged"),this.emit("rhythmStructureChanged"),this.recordState()},loadNotes(e){e==null||e.forEach(rd),this.state.placedNotes=e,this.emit("notesChanged"),this.recordState()}},S_={setADSR(e,t){this.state.timbres[e]&&(this.state.timbres[e].adsr=t,this.state.timbres[e].activePresetName=null,this.emit("timbreChanged",e))},setFilterSettings(e,t){if(this.state.timbres[e]){_.debug("TimbreActions","setFilterSettings called",{color:e,newSettings:t,activePresetName:this.state.timbres[e].activePresetName},"timbre"),_.debug("TimbreActions","setFilterSettings call stack",{stack:new Error().stack},"timbre"),Object.assign(this.state.timbres[e].filter,t);const s=this.state.timbres[e].filter.blend;s<=0?this.state.timbres[e].filter.type="highpass":s>=2?this.state.timbres[e].filter.type="lowpass":this.state.timbres[e].filter.type="bandpass",t.enabled===void 0&&(_.debug("TimbreActions","Clearing activePresetName because enabled is undefined",{color:e},"timbre"),this.state.timbres[e].activePresetName=null),this.emit("timbreChanged",e)}},setHarmonicCoefficients(e,t){this.state.timbres[e]&&(this.state.timbres[e].coeffs=t,this.state.timbres[e].activePresetName=null,this.emit("timbreChanged",e))},setHarmonicPhases(e,t){this.state.timbres[e]&&(_.debug("TimbreActions",`setHarmonicPhases called for ${e}`,null,"state"),_.debug("TimbreActions","Old phases",{phases:this.state.timbres[e].phases},"state"),_.debug("TimbreActions","New phases",{phases:t},"state"),_.debug("TimbreActions","Coefficients before phase change",{coeffs:this.state.timbres[e].coeffs},"state"),this.state.timbres[e].phases=t,this.state.timbres[e].activePresetName=null,_.debug("TimbreActions","Coefficients after phase change",{coeffs:this.state.timbres[e].coeffs},"state"),_.debug("TimbreActions","Emitting timbreChanged for phase change",null,"state"),this.emit("timbreChanged",e))},applyPreset(e,t){!t||!this.state.timbres[e]||(_.debug("TimbreActions",`applyPreset called for ${e}`,null,"state"),_.debug("TimbreActions","Preset name",{name:t.name},"state"),_.debug("TimbreActions","Preset coeffs",{coeffs:t.coeffs},"state"),_.debug("TimbreActions","Old timbre coeffs",{coeffs:this.state.timbres[e].coeffs},"state"),this.state.timbres[e].adsr=t.adsr,this.state.timbres[e].coeffs=new Float32Array(t.coeffs),t.phases?this.state.timbres[e].phases=new Float32Array(t.phases):this.state.timbres[e].phases=new Float32Array(this.state.timbres[e].coeffs.length).fill(0),this.state.timbres[e].activePresetName=t.name,this.state.timbres[e].gain=t.gain||1,t.filter?this.state.timbres[e].filter=JSON.parse(JSON.stringify(t.filter)):this.state.timbres[e].filter=ww(),_.debug("TimbreActions","Applied preset - new coeffs",{coeffs:this.state.timbres[e].coeffs},"state"),this.emit("timbreChanged",e),this.recordState())}};function er(e,...t){}const en={COMPRESSION_2_3:2/3,EXPANSION_3_2:3/2};function F_(e,t){if(er("log","[MODULATION] measureIndexToCanvasX called:",{measureIndex:e,hasState:!!t,cellWidth:t?t.cellWidth:"N/A"}),!t)return e*200;const s=t.cellWidth||40;if(e===0)return 2*s;const i=e-1,A=An(t,i);return A?(A.endColumn+1)*s:e*s*4}function T_(e,t,s=null,i=null,A=null){return{id:`mod_${Date.now()}_${Math.random().toString(36).substr(2,9)}`,measureIndex:e,ratio:t,active:!0,xPosition:s,columnIndex:i,macrobeatIndex:A}}function Lw(e){return Math.abs(e-en.COMPRESSION_2_3)<.001?"2:3":Math.abs(e-en.EXPANSION_3_2)<.001?"3:2":`${e}`}function Hw(e){return Math.abs(e-en.COMPRESSION_2_3)<.001?"#dc3545":Math.abs(e-en.EXPANSION_3_2)<.001?"#007bff":"#6c757d"}function xm(e){return{segments:[{startX:0,endX:1/0,scale:1,spacingPx:e}],microbeatToCanvasX(t){return t*e},canvasXToMicrobeat(t){return t/e},getSegmentAtX(){return this.segments[0]},getGhostGridPositions(){return[]}}}function Rw(e,t,s=null){if(!e||e.length===0)return xm(t);const i=[...e.filter(l=>l.active)].sort((l,h)=>l.measureIndex-h.measureIndex);if(i.length===0)return xm(t);const A=i.map(l=>{let h;return l.xPosition!==null&&l.xPosition!==void 0?(h=l.xPosition,er("log",`[MODULATION] Marker at measure ${l.measureIndex}  using stored x=${h}`)):(h=F_(l.measureIndex,s),er("log",`[MODULATION] Marker at measure ${l.measureIndex}  calculated x=${h}`)),er("log","[MODULATION] Final marker position:",{id:l.id,measureIndex:l.measureIndex,canvasX:h,isStored:l.xPosition!==null&&l.xPosition!==void 0}),{...l,xCanvas:h}}),r=[];let a=1;(A.length===0||A[0].xCanvas>0)&&r.push({startX:0,endX:A.length>0?A[0].xCanvas:1/0,scale:1,spacingPx:t});for(let l=0;l<A.length;l++){const h=A[l],u=l+1<A.length?A[l+1].xCanvas:1/0;a*=h.ratio,r.push({startX:h.xCanvas,endX:u,scale:a,spacingPx:t*a,marker:h})}return{segments:r,microbeatToCanvasX(l){let h=0,u=0;for(const m of r){const v=(m.endX-m.startX)/m.spacingPx;if(u+v>=l){const y=l-u;return m.startX+y*m.spacingPx}u+=v,h=m.endX}return h},canvasXToMicrobeat(l){let h=0;for(const u of r){if(l>=u.startX&&l<u.endX){const v=(l-u.startX)/u.spacingPx;return h+v}const m=u.endX-u.startX;h+=m/u.spacingPx}return h},getSegmentAtX(l){return r.find(h=>l>=h.startX&&l<h.endX)||null},getGhostGridPositions(l,h){if(er("log","[GHOST-CALC] getGhostGridPositions called with:",{segment:l,hasMarker:!!l.marker,hasOptions:!!h}),!l.marker)return[];if(!h||!h.columnWidths)return[];const u=[],{columnWidths:m,cellWidth:g}=h;if(er("log","[GHOST-CALC] Options check:",{hasColumnWidths:!!m,columnCount:m?m.length:0,cellWidth:g,segmentStartX:l.startX,segmentEndX:l.endX,segmentScale:l.scale}),!m||!g||g===0)return[];let v=0;for(let y=0;y<m.length;y++){const C=v;if(l.endX===1/0?C>=l.startX:C>=l.startX&&C<l.endX){let I,T;if(l.endX===1/0){const U=m.reduce((D,O)=>D+O,0)*g;T=Math.max(U,l.startX+800),I=T-l.startX}else I=l.endX-l.startX,T=l.endX;if(I>0&&l.scale>0){const U=(C-l.startX)/I,D=I/l.scale,O=l.startX+U*D;!isNaN(O)&&isFinite(O)&&u.push(O)}}const F=m[y]||0;if(v+=F*g,l.endX!==1/0&&v>l.endX)break}return u}}}function I_(e,t,s){let i=0;for(const A of t.segments){if(e>=A.startX&&e<A.endX){const u=(e-A.startX)/A.spacingPx,m=s/A.scale;return i+u*m}const a=(A.endX-A.startX)/A.spacingPx,l=s/A.scale;i+=a*l}return i}function Ow(e,t=null){const s=Array.isArray(t)?t:e.macrobeatGroupings||[],A=[...Ai(e)].sort((m,g)=>m.preMacrobeatIndex-g.preMacrobeatIndex);let r=0;const a=[];let l=0;const h=m=>{a.push({visualIndex:a.length,type:`legend-${m}`,timeIndex:null})},u=m=>{var v,y;let g=(v=A[r])==null?void 0:v.uuid;for(;A[r]&&A[r].preMacrobeatIndex===m;){for(a.push({visualIndex:a.length,type:"tonic",timeIndex:null}),a.push({visualIndex:a.length,type:"tonic",timeIndex:null});A[r]&&A[r].uuid===g;)r++;g=(y=A[r])==null?void 0:y.uuid}};return h("left"),h("left"),u(-1),s.forEach((m,g)=>{for(let v=0;v<m;v++)a.push({visualIndex:a.length,type:"time",timeIndex:l++});u(g)}),h("right"),h("right"),{entries:a,totalTimeColumns:l}}function Bi(e,t,s=null){const{entries:i}=Ow(e,s),A=i[t];return A?A.timeIndex:null}function yi(e,t,s=null){const{entries:i,totalTimeColumns:A}=Ow(e,s);if(t==null||t<0||t>=A)return null;const r=i.find(a=>a.timeIndex===t);return r?r.visualIndex:null}function Em(e,t,s=null){const i=Array.isArray(s)?s:e.macrobeatGroupings||[];if(t==null)return 0;let A=0;for(let r=0;r<=t&&r<i.length;r++)A+=i[r];return A}const Q_={setAnacrusis(e){var h,u,m;if(this.state.hasAnacrusis===e)return;const t=[...this.state.macrobeatGroupings],s=[...this.state.macrobeatBoundaryStyles],i=t.reduce((g,v)=>g+v,0);let A,r;if(e){const g=this._anacrusisCache,v=Am.length-sd.length,y=Am.slice(0,v),C=DC.slice(0,v),x=(h=g==null?void 0:g.groupings)!=null&&h.length?[...g.groupings]:[...y],F=(u=g==null?void 0:g.boundaryStyles)!=null&&u.length?[...g.boundaryStyles]:[...C];if(A=[...x,...t],r=[...F,...s],!((m=g==null?void 0:g.boundaryStyles)!=null&&m.length))for(let I=0;I<F.length;I++)r[I]=I<F.length-1?"anacrusis":"solid";this._anacrusisCache=null,_.debug("rhythmActions","Enabled anacrusis",{insertedCount:x.length,insertedColumns:x.reduce((I,T)=>I+T,0)},"state")}else{const g=s.findIndex(x=>x==="solid");let v=0;if(g!==-1)v=g+1;else for(;v<s.length&&s[v]==="anacrusis";)v++;v=Math.min(v,t.length);const y=t.slice(0,v),C=s.slice(0,v);v>0?this._anacrusisCache={groupings:y,boundaryStyles:C}:this._anacrusisCache=null,A=t.slice(v),r=s.slice(v).map(x=>x==="anacrusis"?"dashed":x),A.length===0&&(A=[...sd],r=[...pw]),_.debug("rhythmActions","Disabled anacrusis",{removalCount:v,removedColumns:y.reduce((x,F)=>x+F,0)},"state")}const l=A.reduce((g,v)=>g+v,0)-i;if(this.state.hasAnacrusis=e,this.state.macrobeatGroupings=[...A],this.state.macrobeatBoundaryStyles=[...r],l!==0){const g=[];this.state.placedNotes.forEach(C=>{const x=Bi(this.state,C.startColumnIndex,t),F=Bi(this.state,C.endColumnIndex,t);if(x===null||F===null)return;const I=x+l,T=F+l;if(I<0){g.push(C);return}const U=yi(this.state,I,A),D=yi(this.state,T,A);if(U===null||D===null){g.push(C);return}C.startColumnIndex=U,C.endColumnIndex=D}),g.forEach(C=>{const x=this.state.placedNotes.indexOf(C);x>-1&&this.state.placedNotes.splice(x,1)});const v=[];this.state.stampPlacements.forEach(C=>{const x=Bi(this.state,C.startColumn,t),F=Bi(this.state,C.endColumn,t);if(x===null||F===null)return;const I=x+l,T=F+l;if(I<0){v.push(C);return}const U=yi(this.state,I,A),D=yi(this.state,T,A);if(U===null||D===null){v.push(C);return}C.startColumn=U,C.endColumn=D}),v.forEach(C=>{const x=this.state.stampPlacements.indexOf(C);x>-1&&this.state.stampPlacements.splice(x,1)});const y=[];this.state.tripletPlacements&&(this.state.tripletPlacements.forEach(C=>{const x=l/2,F=1;if(C.startCellIndex>=F){const I=C.startCellIndex+x;I<F?y.push(C):C.startCellIndex=I}}),y.forEach(C=>{const x=this.state.tripletPlacements.indexOf(C);x>-1&&this.state.tripletPlacements.splice(x,1)})),Object.values(this.state.tonicSignGroups).flat().forEach(C=>{C.preMacrobeatIndex>=0})}this.emit("anacrusisChanged",e),this.emit("notesChanged"),this.emit("stampPlacementsChanged"),this.emit("tripletPlacementsChanged"),this.emit("rhythmStructureChanged"),this.recordState()},toggleMacrobeatGrouping(e){if(e===void 0||e<0||e>=this.state.macrobeatGroupings.length){_.error("rhythmActions",`Invalid index for toggleMacrobeatGrouping: ${e}`,null,"state");return}const t=[...this.state.macrobeatGroupings],s=t[e],i=s===2?3:2,A=i-s,r=[...t];r[e]=i;const a=Em(this.state,e,t),l=[];this.state.placedNotes.forEach(h=>{const u=Bi(this.state,h.startColumnIndex,t),m=Bi(this.state,h.endColumnIndex,t);if(!(u===null||m===null)&&u>=a){const g=u+A,v=m+A,y=yi(this.state,g,r),C=yi(this.state,v,r);y!==null&&C!==null?(h.startColumnIndex=y,h.endColumnIndex=C):l.push(h)}}),l.length&&l.forEach(h=>{const u=this.state.placedNotes.indexOf(h);u>-1&&this.state.placedNotes.splice(u,1)}),this.state.macrobeatGroupings=r,this.emit("notesChanged"),this.emit("rhythmStructureChanged"),this.recordState()},cycleMacrobeatBoundaryStyle(e){if(e===void 0||e<0||e>=this.state.macrobeatBoundaryStyles.length){_.error("rhythmActions",`Invalid index for cycleMacrobeatBoundaryStyle: ${e}`,null,"state");return}const t=this._isBoundaryInAnacrusis(e);let s;t?s=["dashed","solid","anacrusis"]:s=["dashed","solid"];const i=this.state.macrobeatBoundaryStyles[e],A=s.indexOf(i),r=A===-1?0:(A+1)%s.length;this.state.macrobeatBoundaryStyles[e]=s[r],this.emit("rhythmStructureChanged"),this.recordState()},_isBoundaryInAnacrusis(e){if(!this.state.hasAnacrusis)return!1;for(let t=0;t<=e;t++)if(this.state.macrobeatBoundaryStyles[t]==="solid")return t===e;return!0},increaseMacrobeatCount(){this.state.macrobeatGroupings.push(2),this.state.macrobeatBoundaryStyles.push("dashed"),this.emit("rhythmStructureChanged"),this.recordState()},decreaseMacrobeatCount(){this.state.macrobeatGroupings.length>1&&(this.state.macrobeatGroupings.pop(),this.state.macrobeatBoundaryStyles.pop(),this.emit("rhythmStructureChanged"),this.recordState())},updateTimeSignature(e,t){if(!Array.isArray(t)||t.length===0){_.error("rhythmActions","Invalid groupings provided to updateTimeSignature",null,"state");return}let s=0,i=0,A=0;for(let y=0;y<this.state.macrobeatGroupings.length;y++){if(A===e){s=y;break}const C=y===this.state.macrobeatGroupings.length-1;(this.state.macrobeatBoundaryStyles[y]==="solid"||C)&&A++}A=0;for(let y=0;y<this.state.macrobeatGroupings.length;y++)if(A===e){const C=y===this.state.macrobeatGroupings.length-1;if(this.state.macrobeatBoundaryStyles[y]==="solid"||C){i=y;break}}else if(A<e){const C=y===this.state.macrobeatGroupings.length-1;(this.state.macrobeatBoundaryStyles[y]==="solid"||C)&&A++}const r=i-s+1,a=t.length,l=this.state.macrobeatGroupings.slice(s,i+1).reduce((y,C)=>y+C,0),u=t.reduce((y,C)=>y+C,0)-l,m=Em(this.state,i,this.state.macrobeatGroupings);if(u!==0){const y=(()=>{const x=[...this.state.macrobeatGroupings];return x.splice(s,r,...t),x})(),C=[];this.state.placedNotes.forEach(x=>{const F=Bi(this.state,x.startColumnIndex,this.state.macrobeatGroupings),I=Bi(this.state,x.endColumnIndex,this.state.macrobeatGroupings);if(!(F===null||I===null)&&F>=m){const T=F+u,U=I+u,D=yi(this.state,T,y),O=yi(this.state,U,y);D!==null&&O!==null?(x.startColumnIndex=D,x.endColumnIndex=O):C.push(x)}}),C.length&&C.forEach(x=>{const F=this.state.placedNotes.indexOf(x);F>-1&&this.state.placedNotes.splice(F,1)})}const g=[...t],v=new Array(a-1).fill("dashed");if(i<this.state.macrobeatBoundaryStyles.length){const y=this.state.macrobeatBoundaryStyles[i];a>0&&v.push(y)}this.state.macrobeatGroupings.splice(s,r,...g),this.state.macrobeatBoundaryStyles.splice(s,r-1,...v),this.emit("notesChanged"),this.emit("rhythmStructureChanged"),this.recordState()},addModulationMarker(e,t,s=null,i=null,A=null){if(!Object.values(en).includes(t))return _.error("rhythmActions",`Invalid modulation ratio: ${t}`,null,"state"),null;const r=this.state.modulationMarkers.findIndex(l=>l.measureIndex===e||A!==null&&l.macrobeatIndex===A||i!==null&&l.columnIndex===i);if(r!==-1){const l=this.state.modulationMarkers[r];return _.info("rhythmActions",`Replacing existing modulation marker ${l.id} at measure ${e} (old ratio: ${l.ratio}, new ratio: ${t})`,null,"state"),l.ratio=t,l.xPosition=s,i!==null&&(l.columnIndex=i),A!==null&&(l.macrobeatIndex=A),this.emit("modulationMarkersChanged"),this.recordState(),l.id}const a=T_(e,t,s,i,A);return this.state.modulationMarkers.push(a),this.state.modulationMarkers.sort((l,h)=>l.measureIndex-h.measureIndex),this.emit("modulationMarkersChanged"),this.recordState(),_.info("rhythmActions",`Added modulation marker ${a.id} at measure ${e} with ratio=${t}, columnIndex=${i}`,null,"state"),a.id},removeModulationMarker(e){const t=this.state.modulationMarkers.findIndex(s=>s.id===e);if(t===-1){_.warn("rhythmActions",`Modulation marker not found: ${e}`,null,"state");return}this.state.modulationMarkers.splice(t,1),this.emit("modulationMarkersChanged"),this.recordState(),_.info("rhythmActions",`Removed modulation marker ${e}`,null,"state")},setModulationRatio(e,t){if(!Object.values(en).includes(t)){_.error("rhythmActions",`Invalid modulation ratio: ${t}`,null,"state");return}const s=this.state.modulationMarkers.find(i=>i.id===e);if(!s){_.warn("rhythmActions",`Modulation marker not found: ${e}`,null,"state");return}s.ratio=t,this.emit("modulationMarkersChanged"),this.recordState(),_.info("rhythmActions",`Updated modulation marker ${e} ratio to ${t}`,null,"state")},moveModulationMarker(e,t){const s=this.state.modulationMarkers.find(i=>i.id===e);if(!s){_.warn("rhythmActions",`Modulation marker not found: ${e}`,null,"state");return}s.measureIndex=t,this.state.modulationMarkers.sort((i,A)=>i.measureIndex-A.measureIndex),this.emit("modulationMarkersChanged"),this.recordState(),_.info("rhythmActions",`Moved modulation marker ${e} to measure ${t}`,null,"state")},toggleModulationMarker(e){const t=this.state.modulationMarkers.find(s=>s.id===e);if(!t){_.warn("rhythmActions",`Modulation marker not found: ${e}`,null,"state");return}t.active=!t.active,this.emit("modulationMarkersChanged"),this.recordState(),_.info("rhythmActions",`Toggled modulation marker ${e} active state to ${t.active}`,null,"state")},clearModulationMarkers(){const e=this.state.modulationMarkers.length;this.state.modulationMarkers=[],this.emit("modulationMarkersChanged"),this.recordState(),_.info("rhythmActions",`Cleared ${e} modulation markers`,null,"state")}};function Sm(e,t,s){if(!e||typeof e!="object")return!0;const i=t.topIndex,A=s.topIndex,r=s.bottomIndex,a=r-A;let l=!1,h=!1;const u=m=>{if(typeof m!="number")return m;l=!0;const g=m+i;g>=A&&g<=r&&(h=!0);const v=g-A;return Math.max(0,Math.min(a,v))};if(typeof e.row=="number"&&(e.row=u(e.row)),typeof e.startRow=="number"&&(e.startRow=u(e.startRow)),typeof e.endRow=="number"&&(e.endRow=u(e.endRow)),typeof e.mouseRow=="number"&&(e.mouseRow=u(e.mouseRow)),typeof e.baseRow=="number"&&(e.baseRow=u(e.baseRow)),Array.isArray(e.path)){let m=!1;e.path.forEach(g=>{if(g&&typeof g.row=="number"){const v=g.row+i;v>=A&&v<=r&&(m=!0),g.row=Math.max(0,Math.min(a,v-A))}}),e.path.length>0&&(l=!0,m&&(h=!0))}if(Array.isArray(e.points)){let m=!1;e.points.forEach(g=>{if(g&&typeof g.row=="number"){const v=g.row+i;v>=A&&v<=r&&(m=!0),g.row=Math.max(0,Math.min(a,v-A))}}),e.points.length>0&&(l=!0,m&&(h=!0))}return e.data&&typeof e.data=="object"&&Object.entries(e.data).forEach(([,m])=>{if(m&&typeof m=="object"){if(Array.isArray(m))m.forEach(g=>{if(g&&typeof g.row=="number"){const v=g.row+i;v>=A&&v<=r&&(h=!0),l=!0,g.row=Math.max(0,Math.min(a,v-A))}});else if(typeof m.row=="number"){const g=m.row+i;g>=A&&g<=r&&(h=!0),l=!0,m.row=Math.max(0,Math.min(a,g-A))}}}),!l||h}const M_={toggleAccidentalMode(e){if(!Object.prototype.hasOwnProperty.call(this.state.accidentalMode||{},e))return;const t={...this.state.accidentalMode},s=t[e],i=e==="flat"?"sharp":"flat",A=t[i];_.debug("ViewActions",`toggleAccidentalMode(${e})`,{previousState:t,requestedType:e,requestedValue:!s,pairedType:i,pairedValue:A},"state"),s&&!A?(this.state.accidentalMode[i]=!0,this.state.accidentalMode[e]=!1,_.warn("ViewActions",`Prevented both accidentals from being disabled (enabling ${i})`,{enforcedType:i,toggledType:e},"state")):this.state.accidentalMode[e]=!s,_.debug("ViewActions",`toggleAccidentalMode(${e}) result`,{newState:{...this.state.accidentalMode}},"state"),this.emit("accidentalModeChanged",this.state.accidentalMode),this.emit("layoutConfigChanged")},toggleFrequencyLabels(){const e=this.state.showFrequencyLabels;this.state.showFrequencyLabels=!this.state.showFrequencyLabels,_.debug("ViewActions","toggleFrequencyLabels",{previous:e,next:this.state.showFrequencyLabels,accidentalMode:{...this.state.accidentalMode}},"state"),this.emit("frequencyLabelsChanged",this.state.showFrequencyLabels),this.emit("layoutConfigChanged")},toggleFocusColours(){this.state.focusColours=!this.state.focusColours;const e=this.state.focusColours;this.emit("focusColoursChanged",e),e&&!this.state.showFrequencyLabels&&(this.state.showFrequencyLabels=!0,this.emit("frequencyLabelsChanged",!0)),this.emit("layoutConfigChanged")},setSnapZoomToRange(e){const t=!!e;this.state.snapZoomToRange!==t&&(this.state.snapZoomToRange=t,this.emit("snapZoomSettingChanged",t))},setPitchRangeLock(e){const t=!!e;this.state.isPitchRangeLocked!==t&&(this.state.isPitchRangeLocked=t,this.emit("pitchRangeLockChanged",t))},setDegreeDisplayMode(e){const t=this.state.degreeDisplayMode;this.state.degreeDisplayMode=this.state.degreeDisplayMode===e?"off":e;const s=this.state.degreeDisplayMode;_.debug("ViewActions","setDegreeDisplayMode",{oldMode:t,newMode:s},"state"),this.emit("layoutConfigChanged"),this.emit("degreeDisplayModeChanged",s)},setSelectedTool(e,t){if(this.state.selectedTool!==e||e==="tonicization"&&this.state.selectedToolTonicNumber!==t){const i=this.state.selectedTool;this.state.previousTool=i,this.state.selectedTool=e,e==="tonicization"&&t&&(this.state.selectedToolTonicNumber=parseInt(t,10)),this.emit("toolChanged",{newTool:e,oldTool:i})}},setSelectedNote(e,t){const s={...this.state.selectedNote};this.state.selectedNote={shape:e,color:t},this.emit("noteChanged",{newNote:this.state.selectedNote,oldNote:s})},setKeySignature(e){this.state.keySignature!==e&&(this.state.keySignature=e,this.emit("keySignatureChanged",e))},setTempo(e){this.state.tempo=e,this.emit("tempoChanged",e)},setLooping(e){this.state.isLooping=e,this.emit("loopingChanged",e)},setPlaybackState(e,t=!1){this.state.isPlaying=e,this.state.isPaused=t,this.emit("playbackStateChanged",{isPlaying:e,isPaused:t})},toggleWaveformExtendedView(){this.state.waveformExtendedView=!this.state.waveformExtendedView,this.emit("waveformExtendedViewChanged",this.state.waveformExtendedView)},setAdsrTimeAxisScale(e){const t=Math.max(.1,Math.min(5,e));this.state.adsrTimeAxisScale=t,this.emit("adsrTimeAxisScaleChanged",t)},setAdsrComponentWidth(e){const t=Math.max(50,Math.min(200,e));this.state.adsrComponentWidth=t,this.emit("adsrComponentWidthChanged",t)},setLayoutConfig(e){const t={cellWidth:this.state.cellWidth,cellHeight:this.state.cellHeight,columnWidths:[...this.state.columnWidths||[]]};let s=!1;if(e.cellWidth!==void 0&&this.state.cellWidth!==e.cellWidth&&(this.state.cellWidth=e.cellWidth,s=!0),e.cellHeight!==void 0&&this.state.cellHeight!==e.cellHeight&&(this.state.cellHeight=e.cellHeight,s=!0),e.columnWidths!==void 0){const i=JSON.stringify(this.state.columnWidths||[]),A=JSON.stringify(e.columnWidths);i!==A&&(this.state.columnWidths=[...e.columnWidths],s=!0)}s&&this.emit("layoutConfigChanged",{oldConfig:t,newConfig:{cellWidth:this.state.cellWidth,cellHeight:this.state.cellHeight,columnWidths:[...this.state.columnWidths||[]]}})},setGridPosition(e){const t=this.state.fullRowData.length-this.state.viewportRows*2,s=Math.max(0,Math.min(e,t));this.state.gridPosition!==s&&(this.state.gridPosition=s,this.emit("layoutConfigChanged"))},shiftGridUp(){this.setGridPosition(this.state.gridPosition-1)},shiftGridDown(){this.setGridPosition(this.state.gridPosition+1)},setPrintOptions(e){this.state.printOptions={...this.state.printOptions,...e},this.emit("printOptionsChanged",this.state.printOptions)},setPrintPreviewActive(e){this.state.isPrintPreviewActive=e,this.emit("printPreviewStateChanged",e)},setPitchRange(e,t={}){const{trimOutsideRange:s=!0,preserveContent:i=!1}=t,A=s&&!i,r=pe.length,a=this.state.pitchRange||{topIndex:0,bottomIndex:r-1};if(!e||r===0)return;const l=e.topIndex??a.topIndex,h=e.bottomIndex??a.bottomIndex,u=Math.max(0,Math.min(r-1,l)),m=Math.max(u,Math.min(r-1,h));if(a.topIndex===u&&a.bottomIndex===m)return;const g=pe.slice(u,m+1),v=g.length-1;let y=0,C=0,x=0;if(this.state.placedNotes=this.state.placedNotes.filter(T=>{if(T.isDrum)return!0;const U=T.row+a.topIndex,D=Math.max(0,Math.min(v,U-u));return(U<u||U>m)&&A?(y+=1,!1):(T.row=D,!0)}),this.state.tonicSignGroups){const T={};Object.entries(this.state.tonicSignGroups).forEach(([U,D])=>{const O=D.map(R=>{if(typeof R.row!="number")return null;const st=R.row+a.topIndex,Y=Math.max(0,Math.min(v,st-u));return(st<u||st>m)&&A?null:{...R,row:Y}}).filter(Boolean);O.length>0&&(T[U]=O)}),this.state.tonicSignGroups=T}if(Array.isArray(this.state.stampPlacements)&&(this.state.stampPlacements=this.state.stampPlacements.filter(T=>{const U=T.row+a.topIndex,D=Math.max(0,Math.min(v,U-u));return(U<u||U>m)&&A?(C+=1,!1):(T.row=D,!0)})),Array.isArray(this.state.tripletPlacements)&&(this.state.tripletPlacements=this.state.tripletPlacements.filter(T=>{const U=T.row+a.topIndex,D=Math.max(0,Math.min(v,U-u));return(U<u||U>m)&&A?(x+=1,!1):(T.row=D,!0)})),Array.isArray(this.state.annotations)&&this.state.annotations.length>0){const T={topIndex:u,bottomIndex:m};A?this.state.annotations=this.state.annotations.filter(U=>Sm(U,a,T)):this.state.annotations.forEach(U=>Sm(U,a,T))}if(this.state.printOptions){const T=this.state.printOptions.topRow??0,U=this.state.printOptions.bottomRow??v,D=a.topIndex-u,O=Math.max(0,Math.min(v,T+D)),R=Math.max(O,Math.min(v,U+D));this.state.printOptions={...this.state.printOptions,topRow:O,bottomRow:R}}this.state.pitchRange={topIndex:u,bottomIndex:m},this.state.fullRowData=g;let F=null;if(typeof t.maintainGlobalStart=="number"&&Number.isFinite(t.maintainGlobalStart)){const T=Math.round(t.maintainGlobalStart-u);F=Math.max(0,Math.min(v,T))}const I={removedNotes:y,removedStamps:C,removedTriplets:x,maintainStartRow:F};this.emit("pitchRangeChanged",{topIndex:u,bottomIndex:m,metadata:I}),this.emit("layoutConfigChanged"),this.emit("notesChanged"),this.emit("stampPlacementsChanged"),this.emit("tripletPlacementsChanged"),this.emit("annotationsChanged"),this.recordState()},setDeviceProfile(e={}){const t=this.state.deviceProfile||{},s={isMobile:e.isMobile??t.isMobile??!1,isTouch:e.isTouch??t.isTouch??!1,isCoarsePointer:e.isCoarsePointer??t.isCoarsePointer??!1,orientation:e.orientation??t.orientation??"landscape",width:e.width??t.width??0,height:e.height??t.height??0},i=Object.keys(s).some(A=>s[A]!==t[A]);this.state.deviceProfile=s,i&&this.emit("deviceProfileChanged",s)}},U_={setActiveChordIntervals(e){this.state.activeChordIntervals=e,this.emit("activeChordIntervalsChanged",e)},setIntervalsInversion(e){this.state.isIntervalsInverted=e,this.emit("intervalsInversionChanged",e)},setChordPosition(e){this.state.chordPositionState=e,this.emit("chordPositionChanged",e)}};_.moduleLoaded("paintActions","state");const P_={setMicPaintActive(e){this.state.paint.isMicPaintActive=e,_.debug("paintActions",`Mic Paint Active set to: ${e}`,null,"paint"),this.emit("micPaintStateChanged",e)},setPaintDetectionState(e){this.state.paint.isDetecting=e,_.debug("paintActions",`Paint detection state set to: ${e}`,null,"paint"),this.emit("paintDetectionStateChanged",e)},setDetectedPitch(e){this.state.paint.detectedPitch=e,this.emit("pitchDetected",e)},addPaintPoint(e){this.state.paint.paintHistory.push(e)},clearPaintHistory(){this.state.paint.paintHistory=[],_.debug("paintActions","Paint history cleared",null,"paint"),this.emit("paintHistoryChanged"),this.recordState()},setPaintSettings(e){Object.assign(this.state.paint.paintSettings,e),_.debug("paintActions","Paint settings updated",{settings:this.state.paint.paintSettings},"paint"),this.emit("paintSettingsChanged",this.state.paint.paintSettings),this.recordState()}};_.moduleLoaded("StampActions","stamps");function k_(){return`stamp-${Date.now()}-${Math.random().toString(36).substr(2,9)}`}const D_={addStampPlacement(e,t,s,i="#4a90e2"){const A=t+1,r=this.state.stampPlacements.find(l=>l.row===s&&l.startColumn<=A&&l.endColumn>=t);r&&this.removeStampPlacement(r.id);const a={id:k_(),stampId:e,startColumn:t,endColumn:A,row:s,color:i,timestamp:Date.now()};return this.state.stampPlacements.push(a),this.emit("stampPlacementsChanged"),_.debug("StampActions",`Added stamp ${e} at ${t}-${A},${s}`,{stampId:e,startColumn:t,endColumn:A,row:s,placementId:a.id},"stamps"),a},removeStampPlacement(e){const t=this.state.stampPlacements.findIndex(i=>i.id===e);if(t===-1)return!1;const s=this.state.stampPlacements.splice(t,1)[0];return this.emit("stampPlacementsChanged"),_.debug("StampActions",`Removed stamp ${s.stampId} at ${s.startColumn}-${s.endColumn},${s.row}`,{placementId:e,stampId:s.stampId,startColumn:s.startColumn,endColumn:s.endColumn,row:s.row},"stamps"),!0},eraseStampsInArea(e,t,s,i){const A=[];for(const a of this.state.stampPlacements){const l=a.startColumn<=t&&a.endColumn>=e,h=a.row>=s&&a.row<=i;l&&h&&A.push(a.id)}let r=!1;return A.forEach(a=>{this.removeStampPlacement(a)&&(r=!0)}),r},getAllStampPlacements(){return[...this.state.stampPlacements]},getStampAt(e,t){return this.state.stampPlacements.find(s=>s.row===t&&e>=s.startColumn&&e<=s.endColumn)||null},clearAllStamps(){const e=this.state.stampPlacements.length>0;this.state.stampPlacements=[],e&&(this.emit("stampPlacementsChanged"),_.info("StampActions","Cleared all stamp placements",null,"stamps"))},getStampPlaybackData(){return this.state.stampPlacements.map(e=>{const t=this.state.fullRowData[e.row];return{stampId:e.stampId,column:e.startColumn,startColumn:e.startColumn,endColumn:e.endColumn,row:e.row,pitch:t==null?void 0:t.toneNote,color:e.color,placement:e}}).filter(e=>e.pitch)},updateStampShapeOffset(e,t,s){const i=this.state.stampPlacements.find(A=>A.id===e);if(!i){_.warn("StampActions","[STAMP SHAPE OFFSET] Placement not found",{placementId:e},"stamps");return}i.shapeOffsets||(i.shapeOffsets={}),_.debug("StampActions","[STAMP SHAPE OFFSET] Updating shape offset",{placementId:e,shapeKey:t,oldOffset:i.shapeOffsets[t]||0,newOffset:s,baseRow:i.row,targetRow:i.row+s},"stamps"),i.shapeOffsets[t]=s,this.emit("stampPlacementsChanged")},getShapeRow(e,t){var i;const s=((i=e.shapeOffsets)==null?void 0:i[t])||0;return e.row+s}};_.moduleLoaded("TripletActions","triplets");function L_(){return`triplet-${Date.now()}-${Math.random().toString(36).substr(2,9)}`}const H_={addTripletPlacement(e){this.state.tripletPlacements||(this.state.tripletPlacements=[]);const t=this.state.tripletPlacements.find(i=>i.row===e.row&&!(i.startCellIndex+i.span<=e.startCellIndex||e.startCellIndex+e.span<=i.startCellIndex));t&&this.removeTripletPlacement(t.id),this.state.stampPlacements&&this.state.stampPlacements.filter(A=>{if(A.row!==e.row)return!1;const r=Math.floor(A.startColumn/2),a=Math.floor(A.endColumn/2),l=e.startCellIndex+e.span-1;return!(a<e.startCellIndex||r>l)}).forEach(A=>this.removeStampPlacement(A.id));const s={id:L_(),...e};return this.state.tripletPlacements.push(s),this.emit("tripletPlacementsChanged"),this.emit("rhythmStructureChanged"),_.debug("TripletActions",`Added triplet ${e.stampId} at cell ${e.startCellIndex}, row ${e.row}`,{stampId:e.stampId,startCellIndex:e.startCellIndex,span:e.span,row:e.row,placementId:s.id},"triplets"),s},removeTripletPlacement(e){if(!this.state.tripletPlacements)return!1;const t=this.state.tripletPlacements.findIndex(i=>i.id===e);if(t===-1)return!1;const s=this.state.tripletPlacements.splice(t,1)[0];return this.emit("tripletPlacementsChanged"),_.debug("TripletActions",`Removed triplet ${s.stampId} at cell ${s.startCellIndex}, row ${s.row}`,{placementId:e,stampId:s.stampId,startCellIndex:s.startCellIndex,span:s.span,row:s.row},"triplets"),!0},eraseTripletsInArea(e,t,s,i){if(!this.state.tripletPlacements)return!1;const A=Math.floor(e/2),r=Math.floor(t/2),a=[];for(const h of this.state.tripletPlacements)h.row>=s&&h.row<=i&&(h.startCellIndex+h.span-1<A||h.startCellIndex>r||a.push(h.id));let l=!1;return a.forEach(h=>{this.removeTripletPlacement(h)&&(l=!0)}),l},getAllTripletPlacements(){return[...this.state.tripletPlacements||[]]},getTripletAt(e,t){return this.state.tripletPlacements&&this.state.tripletPlacements.find(s=>s.row===t&&e>=s.startCellIndex&&e<s.startCellIndex+s.span)||null},clearAllTripletPlacements(){if(!this.state.tripletPlacements)return;const e=this.state.tripletPlacements.length>0;this.state.tripletPlacements=[],e&&(this.emit("tripletPlacementsChanged"),_.info("TripletActions","Cleared all triplet placements",null,"triplets"))},getTripletPlaybackData(){return this.state.tripletPlacements?this.state.tripletPlacements.map(e=>{const t=this.state.fullRowData[e.row];return{startCellIndex:e.startCellIndex,stampId:e.stampId,row:e.row,pitch:t==null?void 0:t.toneNote,color:e.color,span:e.span,placement:e}}).filter(e=>e.pitch):[]},updateTripletShapeOffset(e,t,s){const i=this.state.tripletPlacements.find(A=>A.id===e);if(!i){_.warn("TripletActions","[TRIPLET SHAPE OFFSET] Placement not found",{placementId:e},"triplets");return}i.shapeOffsets||(i.shapeOffsets={}),_.debug("TripletActions","[TRIPLET SHAPE OFFSET] Updating shape offset",{placementId:e,shapeKey:t,oldOffset:i.shapeOffsets[t]||0,newOffset:s,baseRow:i.row,targetRow:i.row+s},"triplets"),i.shapeOffsets[t]=s,this.emit("tripletPlacementsChanged")},getTripletShapeRow(e,t){var i;const s=((i=e.shapeOffsets)==null?void 0:i[t])||0;return e.row+s}};_.moduleLoaded("Store","general");const Bf="studentNotationState";function R_(){var e,t;try{const s=localStorage.getItem(Bf);if(s===null)return;const i=JSON.parse(s);if(i.timbres)for(const A in i.timbres){const r=i.timbres[A];if(r.coeffs&&typeof r.coeffs=="object"){const a=Array.isArray(r.coeffs)?r.coeffs:Object.values(r.coeffs);r.coeffs=new Float32Array(a)}if(r.phases&&typeof r.phases=="object"){const a=Array.isArray(r.phases)?r.phases:Object.values(r.phases);r.phases=new Float32Array(a)}}if(i.paint){const A=vw.paint||{},r=i.paint;i.paint={...A,...r,paintSettings:{...A.paintSettings,...r.paintSettings||{}}}}if(i.pitchRange){const A=(pe==null?void 0:pe.length)||((e=i.fullRowData)==null?void 0:e.length)||0,r=Math.max(0,A-1),a=Math.max(0,Math.min(r,i.pitchRange.topIndex??0)),l=Math.max(a,Math.min(r,i.pitchRange.bottomIndex??r));i.pitchRange={topIndex:a,bottomIndex:l}}return(t=i.placedNotes)!=null&&t.length&&i.placedNotes.forEach(rd),i}catch(s){_.error("Store","Could not load state from localStorage",s,"general");return}}function vc(e){try{const t=JSON.parse(JSON.stringify({placedNotes:e.placedNotes,placedChords:e.placedChords,tonicSignGroups:e.tonicSignGroups,stampPlacements:e.stampPlacements,tripletPlacements:e.tripletPlacements,timbres:e.timbres,macrobeatGroupings:e.macrobeatGroupings,macrobeatBoundaryStyles:e.macrobeatBoundaryStyles,hasAnacrusis:e.hasAnacrusis,baseMicrobeatPx:e.baseMicrobeatPx,modulationMarkers:e.modulationMarkers,tempo:e.tempo,activeChordIntervals:e.activeChordIntervals,selectedNote:e.selectedNote,annotations:e.annotations,pitchRange:e.pitchRange,snapZoomToRange:e.snapZoomToRange,isPitchRangeLocked:e.isPitchRangeLocked,degreeDisplayMode:e.degreeDisplayMode,paint:{paintHistory:e.paint.paintHistory,paintSettings:e.paint.paintSettings}}));if(e.timbres)for(const i in e.timbres)e.timbres[i].coeffs&&t.timbres[i]&&(t.timbres[i].coeffs=Array.from(e.timbres[i].coeffs)),e.timbres[i].phases&&t.timbres[i]&&(t.timbres[i].phases=Array.from(e.timbres[i].phases));const s=JSON.stringify(t);localStorage.setItem(Bf,s)}catch(t){_.error("Store","Could not save state to localStorage",t,"general")}}const Fm={...ib,...E_,...S_,...Q_,...M_,...U_,...P_,...D_,...H_,clearSavedState(){try{localStorage.removeItem(Bf),localStorage.removeItem("effectDialValues"),window.location.reload()}catch(e){_.error("Store","Could not clear state from localStorage",e,"general")}}},co={},yf=R_(),O_=!yf,N_={...vw,...yf},d={state:N_,on(e,t){co[e]||(co[e]=[]),co[e].push(t)},emit(e,t){co[e]&&co[e].forEach(s=>{try{s(t)}catch(i){_.error("Store",`Error in listener for event "${e}"`,i,"general")}})}};d.isColdStart=O_;for(const e in Fm)d[e]=Fm[e].bind(d);d.on("tempoChanged",()=>{vc(d.state)});d.on("degreeDisplayModeChanged",()=>{vc(d.state)});const V_=d.recordState;d.recordState=function(...e){V_.apply(this,e),vc(this.state)};yf||vc(d.state);function W_(e){const{macrobeatGroupings:t}=e,s=Ai(e),i=[...e.columnWidths||[]],A=[Ga,Ga];_.debug("Columns Layout","Starting column width calculation",null,"layout"),_.debug("Columns Layout","Placed tonic signs",s.map(h=>`col:${h.columnIndex},mb:${h.preMacrobeatIndex}`),"layout"),_.debug("Columns Layout","Old columnWidths",i,"layout"),_.debug("Columns Layout","Macrobeat groupings",t,"layout");const r=[...s].sort((h,u)=>h.preMacrobeatIndex-u.preMacrobeatIndex);let a=0;const l=h=>{var m,g;let u=(m=r[a])==null?void 0:m.uuid;for(;r[a]&&r[a].preMacrobeatIndex===h;){_.debug("Columns Layout",`Adding tonic columns for mbIndex ${h}, tonic at column ${r[a].columnIndex}`,null,"layout");const v=A.length;for(A.push(Ka),A.push(Ka),_.debug("Columns Layout",`Added 2 columns (width=${Ka} each), total columns: ${v} -> ${A.length}`,null,"layout");r[a]&&r[a].uuid===u;)a++;u=(g=r[a])==null?void 0:g.uuid}};return l(-1),t.forEach((h,u)=>{for(let m=0;m<h;m++)A.push(Ka);l(u)}),A.push(Ga,Ga),_.debug("Columns Layout","Final newColumnWidths",A,"layout"),_.debug("Columns Layout","Width change",`${i.length} -> ${A.length} columns`,"layout"),_.debug("Columns Layout","Old total width units",i.reduce((h,u)=>h+u,0),"layout"),_.debug("Columns Layout","New total width units",A.reduce((h,u)=>h+u,0),"layout"),A}function G_(e,t,s){let i=0;for(let A=0;A<e;A++)i+=(t[A]||0)*s;return i}function K_(e,t){return e.reduce((s,i)=>s+i,0)*t}const jo=30;let $e=1,Ti=RC,ti=0,eA,Ml,od,ad,ld,Nw,Vw,Ww,Gw,Kw,fn,nA,cd,Tm,Ul=!1,Ns=!1,pu=0,mu=0,Po=!1,ko=null,gu=!1,wu=!1;function hd(){var a;const e=((a=d.state.fullRowData)==null?void 0:a.length)||0;if(e===0)return Tl;const t=document.getElementById("pitch-grid-container"),s=ti||window.innerHeight||0,i=(t==null?void 0:t.clientHeight)||(s?s*.7:0);if(!i||i<=0)return Tl;const A=2*i/(e*jo);return Math.max(Tl,A)}function q_(){const e=(window==null?void 0:window.devicePixelRatio)??1;return!Number.isFinite(e)||e<=0?1:e}function vu(e,t,s,i,A=null){if(!e)return!1;const r=Number.isFinite(i)&&i>0?i:1;e.dataset.pixelRatio=`${r}`;let a=!1;if(typeof t=="number"){const l=Math.max(1,Math.round(t*r));Math.abs(e.width-l)>.5&&(e.width=l,a=!0),e.style.width=`${t}px`,e.dataset.logicalWidth=`${t}`}if(typeof s=="number"){const l=Math.max(1,Math.round(s*r));Math.abs(e.height-l)>.5&&(e.height=l,a=!0),e.style.height=`${s}px`,e.dataset.logicalHeight=`${s}`}if(a){const l=A||e.getContext("2d");l&&l.setTransform(r,0,0,r,0,0)}return a}function z_(){eA=document.getElementById("pitch-grid-wrapper"),Ml=document.getElementById("notation-grid"),document.getElementById("drum-grid-wrapper"),ad=document.getElementById("drum-grid"),Nw=document.getElementById("drum-playhead-canvas"),Vw=document.getElementById("playhead-canvas"),Ww=document.getElementById("hover-canvas"),Gw=document.getElementById("drum-hover-canvas"),Kw=document.getElementById("pitch-paint-canvas"),fn=document.getElementById("button-grid"),nA=document.getElementById("grid-scrollbar-proxy"),cd=(nA==null?void 0:nA.querySelector(".grid-scrollbar-inner"))||null;const e=document.getElementById("canvas-container");return!eA||!Ml||!e?{}:(od=Ml.getContext("2d"),ld=ad.getContext("2d"),{ctx:od,drumCtx:ld,canvasContainer:e})}function Jn(){var ct,lt;if(!eA||eA.clientHeight===0){gu||(_.warn("LayoutService","Pitch grid wrapper not ready for layout (height=0). Retrying on next frame.",null,"layout"),gu=!0),requestAnimationFrame(Jn);return}if(gu=!1,Ul)return;Ul=!0;const e=document.getElementById("pitch-grid-container");eA.clientWidth;const t=window.innerHeight;(Math.abs(t-ti)>3||ti===0)&&(ti=t);const i=hd();$e<i&&($e=i,_.debug("LayoutService",`[Zoom] Enforcing minimum zoom to maintain grid height: ${Math.round($e*100)}%`,null,"layout"));const A=jo,r=A*OC,a=A*$e,l=r*$e;d.setLayoutConfig({cellHeight:a,cellWidth:l});const h=W_(d.state);d.setLayoutConfig({columnWidths:h}),(!d.state.cellWidth||!h.length)&&_.warn("LayoutService","Unexpected layout configuration",{cellWidth:d.state.cellWidth,columnCount:h.length},"layout");const m=h.reduce((mt,At)=>mt+At,0)*d.state.cellWidth,g=yt.getModulatedCanvasWidth(),v=g>m?g:m,y=Math.round(v),C=q_(),x=document.getElementById("drum-grid-wrapper"),F=document.getElementById("grids-wrapper"),I=y+"px";if(e&&(e.style.width=I),eA&&(eA.style.width=I),x&&(x.style.width=I),cd&&nA){cd.style.width=I;const mt=(F==null?void 0:F.getBoundingClientRect().width)||0;y>mt?nA.style.display="":nA.style.display="none"}const T=Math.max(br,_r*d.state.cellHeight),U=rm*T,D=`${U}px`,O=((ct=d.state.columnWidths)==null?void 0:ct.length)??0,R=2,st=O-2;let Y=0;for(let mt=R;mt<st;mt++)Y+=(d.state.columnWidths[mt]||0)*d.state.cellWidth;if(O<=4&&_.warn("LayoutService","Column widths array does not contain interior columns.",{columnWidthsCount:O,columnWidths:d.state.columnWidths},"layout"),Y<50&&O>4&&_.warn("LayoutService","Computed button-grid middle cell width is unexpectedly small.",{middleCellWidth:Y,columnWidthsSample:(lt=d.state.columnWidths)==null?void 0:lt.slice(0,10),cellWidth:d.state.cellWidth,macrobeatGroupings:d.state.macrobeatGroupings},"layout"),fn){const mt=fn.querySelector(".button-grid-left-cell"),At=fn.querySelector(".button-grid-middle-cell"),St=fn.querySelector(".button-grid-right-cell"),Qt=d.state.columnWidths.slice(0,2).reduce((qt,se)=>qt+se*d.state.cellWidth,0),Pt=d.state.columnWidths.slice(-2).reduce((qt,se)=>qt+se*d.state.cellWidth,0);(Math.abs(mu-U)>5||mu===0)&&(fn.style.height=D,mu=U);const Lt=(qt,se)=>{if(!qt)return;const Ie=`${Math.max(0,se)}px`;qt.style.width=Ie,qt.style.flex=`0 0 ${Ie}`,qt.style.maxWidth=Ie,qt.style.minWidth=Ie,qt.style.height=D};if(mt){Lt(mt,Qt);const qt=mt.getBoundingClientRect();Qt>0&&qt.width===0&&_.warn("LayoutService","Left button-grid cell measured width is 0 after assignment.",{assignedWidth:Qt,measuredWidth:qt.width,computedDisplay:window.getComputedStyle(mt).display},"layout")}if(At){Y===0&&_.warn("LayoutService","Calculated middle button-grid width is 0. Check column width data.",{columnWidths:d.state.columnWidths,cellWidth:d.state.cellWidth},"layout"),Lt(At,Y);const qt=At.getBoundingClientRect();if(Y>0&&qt.width===0&&_.warn("LayoutService","Middle button-grid cell assigned width but still measures 0.",{assignedWidth:Y,measuredWidth:qt.width,computedStyles:window.getComputedStyle(At)},"layout"),Math.abs(qt.width-Y)>5&&(_.warn("LayoutService","Middle cell measured width does not match assigned width.",{assignedWidth:Y,measuredWidth:qt.width,styleWidth:At.style.width,cellWidth:d.state.cellWidth},"layout"),requestAnimationFrame(()=>{const se=At.getBoundingClientRect();Math.abs(se.width-Y)>5&&_.warn("LayoutService","Middle cell still mismatched after RAF.",{assignedWidth:Y,measuredWidth:se.width,delta:se.width-Y,computedStyles:window.getComputedStyle(At)},"layout")})),!wu){const se=At.querySelector("#beat-line-button-layer");if(se){const Ie=se.getBoundingClientRect();if(Ie.width===0){const ie=window.getComputedStyle(se);_.warn("LayoutService","#beat-line-button-layer width is 0 despite middle cell sizing.",{beatLineRect:Ie,beatLineStyles:{display:ie.display,position:ie.position,flex:{direction:ie.flexDirection,grow:ie.flexGrow,shrink:ie.flexShrink,basis:ie.flexBasis},width:ie.width,minWidth:ie.minWidth,maxWidth:ie.maxWidth},middleRect:qt,middleCellComputedWidth:ie.width},"layout"),wu=!0}}else _.warn("LayoutService","Could not find #beat-line-button-layer inside middle cell to measure.",null,"layout"),wu=!0}}if(St){Lt(St,Pt);const qt=St.getBoundingClientRect();Pt>0&&qt.width===0&&_.warn("LayoutService","Right button-grid cell measured width is 0 after assignment.",{assignedWidth:Pt,measuredWidth:qt.width,computedDisplay:window.getComputedStyle(St).display},"layout")}const Te=Qt+Y+Pt;Number.isFinite(Te)&&Te>0&&(fn.style.width=I,fn.style.maxWidth=I,fn.style.minWidth=I),fn.getBoundingClientRect().width===0&&_.warn("LayoutService","Entire button grid wrapper width is 0 after layout pass.",{leftCellWidth:Qt,middleCellWidth:Y,rightCellWidth:Pt,wrapperStyles:window.getComputedStyle(fn)},"layout")}const L=Math.max(br,_r*d.state.cellHeight),J=rm*L,dt=`${J}px`,ht=[{element:Ml,context:od},{element:Vw},{element:Ww},{element:Kw}];ht.forEach(({element:mt,context:At})=>{vu(mt,y,void 0,C,At)}),[{element:ad,context:ld},{element:Nw},{element:Gw}].forEach(({element:mt,context:At})=>{vu(mt,y,J,C,At)});const Tt=Math.abs(pu-J)>5;x&&(Tt||pu===0)&&(x.style.height=dt,pu=J);const Ht=C,tt=y;if(setTimeout(()=>{const At=document.getElementById("pitch-grid-container").clientHeight;ht.forEach(({element:St,context:Qt})=>{vu(St,tt,At,Ht,Qt)}),document.dispatchEvent(new CustomEvent("canvasResized",{detail:{source:"layoutService-deferred"}}))}),ko!==null){const mt=d.state.fullRowData.length;if(mt<=0)Ti=0;else{const At=Math.max(0,Math.min(mt-1,ko)),St=document.getElementById("pitch-grid-container"),Qt=(St==null?void 0:St.clientHeight)||ti*.7,Vt=(d.state.cellHeight||jo)/2,he=Math.max(0,mt*Vt-Qt);if(he<=0)Ti=0;else{const Lt=At*Vt;Ti=Math.max(0,Math.min(1,Lt/he))}}ko=null}d.emit("layoutConfigChanged"),Ul=!1,Po&&(Po=!1,yt.snapZoomToCurrentRange())}const yt={init(){const{ctx:e,drumCtx:t,canvasContainer:s}=z_();requestAnimationFrame(Jn),this.initScrollHandler();const i=()=>{Ul||(clearTimeout(Tm),Tm=setTimeout(()=>{Jn()},HC))};return window.addEventListener("resize",i),{ctx:e,drumCtx:t}},getCurrentZoomLevel(){return $e},setZoomLevel(e){$e=e,Jn()},_canScrollRange(e){const t=d.state.pitchRange;if(!t||!pe||pe.length===0)return!1;const s=pe.length-1,i=e<0&&t.topIndex>0,A=e>0&&t.bottomIndex<s;return i||A},initScrollHandler(){const e=document.getElementById("pitch-grid-wrapper");e&&e.addEventListener("wheel",t=>{if(t.preventDefault(),t.ctrlKey||t.metaKey)t.deltaY<0?this.zoomIn():this.zoomOut();else{const s=t.deltaY>0?1:-1;d.state.isPitchRangeLocked?this.scrollByPixels(t.deltaY):this._canScrollRange(s)?this.scrollByUnits(s):this.scrollByPixels(t.deltaY)}},{passive:!1})},zoomIn(){Ns||(d.state.snapZoomToRange&&d.setSnapZoomToRange(!1),Ns=!0,$e=Math.min(qa,$e*NC),_.debug("LayoutService",`[Zoom] Zoom level: ${Math.round($e*100)}%`,null,"layout"),requestAnimationFrame(()=>{requestAnimationFrame(()=>{Jn(),Ns=!1})}))},zoomOut(){if(Ns)return;d.state.snapZoomToRange&&d.setSnapZoomToRange(!1),Ns=!0;const e=hd(),t=Math.max(Tl,$e*VC),s=Math.max(e,t);s!==t&&_.debug("LayoutService",`[Zoom] Minimum zoom reached; clamping to ${Math.round(s*100)}%`,null,"layout"),$e=s,_.debug("LayoutService",`[Zoom] Zoom level: ${Math.round($e*100)}%`,null,"layout"),requestAnimationFrame(()=>{requestAnimationFrame(()=>{Jn(),Ns=!1})})},resetZoom(){Ns||(d.state.snapZoomToRange&&d.setSnapZoomToRange(!1),Ns=!0,$e=1,_.debug("LayoutService","[Zoom] Zoom level reset to 100%",null,"layout"),requestAnimationFrame(()=>{requestAnimationFrame(()=>{Jn(),Ns=!1})}))},snapZoomToCurrentRange(){if(Ns){Po=!0;return}const e=hd(),t=Math.min(qa,e);if(!isFinite(t)||t<=0)return;const s=Math.abs($e-t)>1e-4;Ns=!0,$e=t,e>qa+1e-4?_.debug("LayoutService",`[Zoom] Snap zoom limited by MAX_ZOOM_LEVEL (${Math.round(qa*100)}%)`,null,"layout"):s&&_.debug("LayoutService",`[Zoom] Snap zoom to range: ${Math.round($e*100)}%`,null,"layout"),requestAnimationFrame(()=>{requestAnimationFrame(()=>{Jn(),Ns=!1,Po&&(Po=!1,this.snapZoomToCurrentRange())})})},setPendingStartRow(e){typeof e=="number"&&Number.isFinite(e)?ko=Math.max(0,e):ko=null},scroll(e){const t=e/ti/4;Ti=Math.max(0,Math.min(1,Ti+t)),d.emit("layoutConfigChanged")},scrollByUnits(e){const t=d.state.pitchRange;if(!t||!pe||pe.length===0||d.state.isPitchRangeLocked)return;const s=t.topIndex+e,i=t.bottomIndex+e,A=pe.length-1;s<0||i>A||d.setPitchRange({topIndex:s,bottomIndex:i})},scrollByPixels(e){const t=d.state.fullRowData.length,i=(d.state.cellHeight||jo)*$e,r=t*i,a=Math.max(0,r-ti);if(a>0){const l=e/a;Ti=Math.max(0,Math.min(1,Ti+l))}d.emit("layoutConfigChanged")},getViewportInfo(){const e=d.state.fullRowData.length,t=document.getElementById("pitch-grid-container"),s=(t==null?void 0:t.clientHeight)||ti*.7,i=d.state.cellHeight||jo,A=i/2,a=e*A,h=Math.max(0,a-s)*Ti,u=Math.max(0,Math.floor(h/A)),m=s/A,g=Math.min(e,Math.ceil(u+m));return{zoomLevel:$e,viewportHeight:ti,containerHeight:s,cellHeight:i,halfUnit:A,startRank:u,endRank:g,scrollOffset:h}},getMacrobeatWidthPx(e,t){return t*e.cellWidth},getColumnX(e){return G_(e,d.state.columnWidths,d.state.cellWidth)},getCanvasWidth(){return K_(d.state.columnWidths,d.state.cellWidth)},getModulatedCanvasWidth(){const e=this.getCanvasWidth();if(!d.state.modulationMarkers||d.state.modulationMarkers.length===0)return e;try{const t=d.state.baseMicrobeatPx||d.state.cellWidth||40;let s=e;return d.state.modulationMarkers.forEach(A=>{A.ratio>1&&(s*=A.ratio)}),Math.max(e,s)}catch{return e}},recalculateLayout(){Jn()},get isZooming(){return Ns}};let Bu=null,yu=null;const Cf={setContexts({ctx:e,drumCtx:t}){Bu=e,yu=t},getPitchContext(){return Bu||_.error("CanvasContextService","Pitch context requested before it was set.",null,"canvas"),Bu},getDrumContext(){return yu||_.error("CanvasContextService","Drum context requested before it was set.",null,"canvas"),yu}};d.on("modulationMarkersChanged",()=>{Y_()});d.on("scrollChanged",()=>{Do=null,Lo=null});d.on("zoomChanged",()=>{Do=null,Lo=null});let yo=null,ud=null,Do=null,Lo=null;function qw(e){const t=JSON.stringify({markers:e.modulationMarkers||[],baseMicrobeatPx:e.baseMicrobeatPx||e.cellWidth||40});if(yo&&t===ud)return yo;const s=e.baseMicrobeatPx||e.cellWidth||40;return yo=Rw(e.modulationMarkers||[],s,e),ud=t,yo}function zw(){const e=performance.now();return(!Do||!Lo||e-Lo>1)&&(Do=yt.getViewportInfo(),Lo=e),Do}function Bt(e,t){let s=0;const i=Math.floor(e),A=e-i;for(let u=0;u<i;u++){const m=t.columnWidths[u]||0;s+=m*t.cellWidth}if(A>0&&i<t.columnWidths.length){const u=t.columnWidths[i]||0;s+=A*u*t.cellWidth}if(!t.modulationMarkers||t.modulationMarkers.length===0)return s;const r=qw(t),a=t.baseMicrobeatPx||t.cellWidth||40,l=s/a;return r.microbeatToCanvasX(l)}function Nt(e,t){const s=zw(),i=e-s.startRank,A=t.cellHeight/2;return i*A}function Cu(e){let t=(e||"").replace(/\d/g,"").trim();return t=t.replace(/b/g,"").replace(/#/g,""),t}function $_(e){switch(e){case"C":return{lineWidth:3.33,dash:[],color:"#adb5bd"};case"E":return{lineWidth:1,dash:[5,5],color:"#adb5bd"};case"G":return{lineWidth:1,dash:[],color:"#dee2e6"};case"B":case"A":case"F":case"E/D":case"D/C":return{lineWidth:1,dash:[],color:"#ced4da"};default:return{lineWidth:1,dash:[],color:"#ced4da"}}}function X_(){const e=yt.getViewportInfo(),{startRank:t,endRank:s}=e;return{startRow:t,endRow:s}}function Y_(){yo=null,ud=null}function j_(e,t){if(t.modulationMarkers&&t.modulationMarkers.length>0){const r=qw(t),a=t.baseMicrobeatPx||t.cellWidth||40;return r.canvasXToMicrobeat(e)*a/t.cellWidth}let s=0;const{columnWidths:i,cellWidth:A}=t;if(A===0)return 0;for(let r=0;r<i.length;r++){const a=i[r]*A;if(e<s+a){const l=(e-s)/a;return r+l}s+=a}return i.length-1}function J_(e,t){const s=zw(),i=t.cellHeight/2;return e/i+s.startRank}function $w(e,t){return t.some(s=>s.columnIndex===e)}function Z_(e,t){return t.some(s=>e===s.columnIndex||e===s.columnIndex+1)}function bf(e,t){const s=Ai(t);return!Z_(e,s)}function Xw(e,t){for(const s of t)if(e===s.columnIndex+1)return!1;return t.some(s=>e===s.columnIndex+2),!0}function ke(e){var i;if(!e)return 0;const t=(i=e.dataset)==null?void 0:i.logicalWidth,s=t!==void 0?Number(t):NaN;return Number.isFinite(s)?s:e.width||0}function le(e){var i;if(!e)return 0;const t=(i=e.dataset)==null?void 0:i.logicalHeight,s=t!==void 0?Number(t):NaN;return Number.isFinite(s)?s:e.height||0}function tx(e,t,s,i){const{sharp:A,flat:r}=t.accidentalMode,a=t.showFrequencyLabels||!1,l=A||r,h=!A&&!r;function u(v){const y=[];return pe.forEach(C=>{Cu(C.pitch)===v&&(C.column==="A"||C.column==="B")&&(C.column==="A"?y.push(1,t.columnWidths.length-2):C.column==="B"&&y.push(0,t.columnWidths.length-1))}),[...new Set(y)]}function m(v){const y=[];return pe.forEach(C=>{Cu(C.pitch)===v&&(C.column==="A"||C.column==="B")&&(C.column==="A"?y.push(0,t.columnWidths.length-1):C.column==="B"&&y.push(1,t.columnWidths.length-2))}),[...new Set(y)]}function g(){return[1,t.columnWidths.length-2]}for(let v=s;v<=i;v++){const y=t.fullRowData[v];if(!y)continue;const C=Nt(v,t);if(C<-10||C>t.viewportHeight+10)continue;const x=Cu(y.pitch),F=$_(x);if(x==="C"||x==="E"){const I=u(x),T=Bt(0,t),U=Bt(t.columnWidths.length,t);bu(e,T,U,C,t,I,"stroke",F)}else if(x==="G"){const I=Bt(2,t),U=Bt(t.columnWidths.length-2,t)-I;if(e.fillStyle=F.color,e.fillRect(I,C-t.cellHeight/2,U,t.cellHeight),!a){const D=g();h?(e.fillStyle=F.color,ho(e,C,t,D,"fill",F)):l&&ho(e,C,t,D,"stroke",F)}}else if(["B","A","F"].includes(x))if(h){let T=m(x).filter(U=>U!==0&&U!==t.columnWidths.length-1);x==="A"&&(T=T.filter(U=>U!==1&&U!==t.columnWidths.length-2)),T.length>0&&ho(e,C,t,T,"stroke",F)}else{const I=m(x);ho(e,C,t,I,"stroke",F)}else if(["E/D","D/C"].includes(x)){const I=m(x);ho(e,C,t,I,"stroke",F)}else if(x==="B/A")if(h){const I=Bt(0,t),T=Bt(t.columnWidths.length,t);e.beginPath(),e.moveTo(I,C),e.lineTo(T,C),e.lineWidth=F.lineWidth,e.strokeStyle=F.color,e.setLineDash(F.dash),e.stroke(),e.setLineDash([])}else{const I=u(x),T=Bt(0,t),U=Bt(t.columnWidths.length,t);bu(e,T,U,C,t,I,"stroke",F)}else{const I=u(x),T=Bt(0,t),U=Bt(t.columnWidths.length,t);bu(e,T,U,C,t,I,"stroke",F)}}}function bu(e,t,s,i,A,r,a,l){const h=r.map(m=>({start:Bt(m,A),end:Bt(m+1,A)})).sort((m,g)=>m.start-g.start);let u=t;h.forEach(m=>{u<m.start&&dd(e,u,m.start,i,A,a,l),u=Math.max(u,m.end)}),u<s&&dd(e,u,s,i,A,a,l)}function dd(e,t,s,i,A,r,a){r==="fill"?e.fillRect(t,i-A.cellHeight/2,s-t,A.cellHeight):(e.beginPath(),e.moveTo(t,i),e.lineTo(s,i),e.lineWidth=a.lineWidth,e.strokeStyle=a.color,e.setLineDash(a.dash),e.stroke(),e.setLineDash([]))}function ho(e,t,s,i,A,r){i.forEach(a=>{const l=Bt(a,s),h=Bt(a+1,s);dd(e,l,h,t,s,A||"stroke",r)})}function ex(e,t,s,i){tx(e,t,s,i)}function sx(e,t){nx(e,t)}function nx(e,t){const{columnWidths:s,macrobeatGroupings:i,macrobeatBoundaryStyles:A,placedTonicSigns:r}=t,a=s.length,l=[];let h=2;for(let u=0;u<i.length;u++){for(;r.some(m=>m.columnIndex===h);)h+=2;h+=i[u],l.push(h)}for(let u=0;u<=a;u++){const m=Bt(u,t);let g;const v=u===2||u===a-2,y=$w(u,r),C=r.some(I=>u===I.columnIndex+2),x=l.includes(u);if(Xw(u,r)){if(v||y||C)g={lineWidth:2,strokeStyle:"#adb5bd",dash:[]};else if(x){const I=l.indexOf(u);if(I!==-1){const T=A[I];if(T==="anacrusis")continue;g={lineWidth:1,strokeStyle:"#adb5bd",dash:T==="solid"?[]:[5,5]}}else continue}else continue;e.beginPath(),e.moveTo(m,0),e.lineTo(m,le(e.canvas)),e.lineWidth=g.lineWidth,e.strokeStyle=g.strokeStyle,e.setLineDash(g.dash),e.stroke()}}e.setLineDash([])}const Im=["major","dorian","phrygian","lydian","mixolydian","minor","locrian"];function ix(e){const t=Ai(e);if(t.length===0)return{leftTonic:null,rightTonic:null};const s=t.reduce((A,r)=>r.columnIndex<A.columnIndex?r:A),i=t.reduce((A,r)=>r.columnIndex>A.columnIndex?r:A);return{leftTonic:s,rightTonic:t.length===1?s:i}}function Qm(e,t){const s=t[e];if(!s)return null;const A=s.pitch.replace(/\d+$/,"");return(A.includes("/")?A.split("/")[0]:A).replace(//g,"b").replace(//g,"#")}function Mm(e,t){if(!e||!t)return[];const s=t-1;if(s<0||s>=Im.length)return _.warn("LegendRenderer",`Invalid tonic number: ${t}`,null,"grid"),[];const i=Im[s];try{const A=`${e} ${i}`;return w_(A).notes||[]}catch(A){return _.warn("LegendRenderer",`Could not generate ${i} scale`,{tonic:e,error:A},"grid"),[]}}function Um(e,t){if(!e||!t.length)return!1;const s=e.replace(/\d+$/,"");return(s.includes("/")?s.split("/"):[s]).map(r=>r.replace(//g,"b").replace(//g,"#")).some(r=>t.some(a=>{try{return Zn(r)===Zn(a)||r===a}catch{return r===a}}))}function Ax(e,t,s,i){const{fullRowData:A,columnWidths:r,cellWidth:a,cellHeight:l,colorMode:h}=t,{sharp:u,flat:m}=d.state.accidentalMode,{focusColours:g,showFrequencyLabels:v}=d.state;let y=[],C=[];if(g){const T=ix(d.state);if(T.leftTonic){const U=Qm(T.leftTonic.row,A);y=Mm(U,T.leftTonic.tonicNumber)}if(T.rightTonic){const U=Qm(T.rightTonic.row,A);C=Mm(U,T.rightTonic.tonicNumber)}}const x=(T,U=[],D=null)=>{if(v){const L=g&&Array.isArray(U)&&U.length>0,J=D?Um(D.pitch,U):!1;return L&&D&&!J?null:D&&D.frequency?String(D.frequency):T}if(!D){if(!T.includes("/"))return T;const L=T.slice(-1),J=T.substring(0,T.length-1),[dt,ht]=J.split("/");return u&&m?`${dt}/${ht}${L}`:u?`${ht}${L}`:m?`${dt}${L}`:`${ht}${L}`}const{flatName:O,sharpName:R,isAccidental:st}=D;if(!st)return O;if(g&&U.length>0){const L=O.replace(//g,"b").replace(//g,"#").replace(/\d+$/,""),J=R.replace(//g,"b").replace(//g,"#").replace(/\d+$/,""),dt=U.some(rt=>{try{return Zn(rt)===Zn(L)||rt===L}catch{return rt===L}}),ht=U.some(rt=>{try{return Zn(rt)===Zn(J)||rt===J}catch{return rt===J}});if(!u&&!m){if(dt)return O;if(ht)return R}else{if(u&&!m)return ht?R:null;if(!u&&m)return dt?O:null;if(u&&m)return dt||ht?D.pitch:null}}let Y;return u&&m?Y=D.pitch:u&&!m?Y=R:m&&!u?Y=O:Y=R,Y},F=()=>!u&&!m;function I(T,U){const D=Bt(T,t),O=r.slice(T,T+2).map(L=>L*a);let R=D;const Y=T===0?y:C;U.forEach((L,J)=>{const dt=O[J];for(let ht=s;ht<=i;ht++){const rt=A[ht];if(!(!rt||rt.isDummy)&&rt.column===L){const Tt=Nt(ht,t),It=rt.isAccidental??rt.pitch.includes("/"),Ht=!v&&It&&F();let tt=h==="bw"?"#ffffff":rt.hex||"#ffffff";const ct=x(rt.pitch,Y,rt),lt=ct===null;let mt=Ht||lt;if(!v&&g&&Y.length>0&&!lt&&(Um(rt.pitch,Y)||(mt=!0)),mt){const Lt=tt.match(/^#([a-f\d]{2})([a-f\d]{2})([a-f\d]{2})$/i);if(Lt){const Te=parseInt(Lt[1],16),ns=parseInt(Lt[2],16),qt=parseInt(Lt[3],16);tt=`rgba(${Te}, ${ns}, ${qt}, 0)`}}if(e.fillStyle=tt,e.fillRect(R,Tt-l/2,dt,l),lt)continue;const At=ct.length<=3,St=Math.max(10,Math.min(a*1.2,l*1.2)),Qt=At?St:St*.7;e.font=`bold ${Qt}px 'Atkinson Hyperlegible', sans-serif`,e.textAlign="center",e.textBaseline="middle";const Pt=R+dt/2,Vt=Tt,he=mt?"00":"FF";e.strokeStyle=`#212529${he}`,e.lineWidth=2.5,e.lineJoin="round",e.strokeText(ct,Pt,Vt),e.fillStyle=`#ffffff${he}`,e.fillText(ct,Pt,Vt)}}R+=dt})}I(0,["B","A"]),I(r.length-2,["A","B"])}function Yw(e){if(!e||typeof e.startColumnIndex!="number"||typeof e.endColumnIndex!="number")return!1;const t=e.shape==="circle"?e.startColumnIndex+1:e.startColumnIndex;return e.endColumnIndex>t}function jw(e,t,s){const{cellWidth:i}=s,A=i*.25;if(!e.uuid)return 0;const r=t.filter(h=>!h.isDrum&&h.row===e.row&&h.startColumnIndex===e.startColumnIndex&&h.uuid&&h.uuid!==e.uuid);if(r.length===0)return 0;const a=[e,...r];return a.sort((h,u)=>{const m=parseInt(h.uuid.split("-")[1]),g=parseInt(u.uuid.split("-")[1]);return m-g}),a.findIndex(h=>h.uuid===e.uuid)*A}function Jw(e,t){const{cellHeight:s}=t;return(window.animationEffectsManager?window.animationEffectsManager.shouldAnimateNote(e):!1)?(window.animationEffectsManager?window.animationEffectsManager.getVibratoYOffset(e.color):0)*s:0}function Zw(e,t,s,i,A,r){if(!window.animationEffectsManager||!window.animationEffectsManager.shouldFillNote(t))return;const l=window.animationEffectsManager.getFillLevel(t);if(l<=0)return;e.save();const h=1-l,u=e.createRadialGradient(s,i,0,s,i,Math.max(A,r));u.addColorStop(0,"transparent"),u.addColorStop(Math.max(0,h-.05),"transparent"),u.addColorStop(h,t.color+"1F"),u.addColorStop(1,t.color+"BF"),e.beginPath(),e.ellipse(s,i,A,r,0,0,2*Math.PI),e.clip(),e.fillStyle=u,e.fillRect(s-A-10,i-r-10,(A+10)*2,(r+10)*2),e.restore()}function rx(e,t,s){const{cellHeight:i}=s,A=i/2*.12;if(!e.uuid)return 0;const r=t.filter(h=>!h.isDrum&&h.row===e.row&&h.startColumnIndex===e.startColumnIndex&&h.uuid&&h.uuid!==e.uuid&&Yw(h));if(r.length===0)return 0;const a=[e,...r];return a.sort((h,u)=>{const m=parseInt(h.uuid.split("-")[1]),g=parseInt(u.uuid.split("-")[1]);return m-g}),a.findIndex(h=>h.uuid===e.uuid)*A}function ox(e,t){const s=Uo.getDegreeForNote(e,t);if(!s)return{label:null,isAccidental:!1};if(!Uo.hasAccidental(s))return{label:s,isAccidental:!1};const A=d.state.accidentalMode||{},r=A.sharp??!0,a=A.flat??!0;if(!r&&!a)return{label:null,isAccidental:!0};let l=s.includes("")?s:null,h=s.includes("")?s:null;const u=Uo.getEnharmonicDegree(s);u&&(u.includes("")&&!l&&(l=u),u.includes("")&&!h&&(h=u));let m=null;if(r&&a){const g=[];l&&g.push(l),h&&(!l||h!==l)&&g.push(h),m=g.join("/"),m||(m=s)}else r?m=l||s:a&&(m=h||s);return{label:m,isAccidental:!0}}function ax(e){if(!e)return{multiplier:1,category:"natural"};const t=e.includes(""),s=e.includes(""),i=e.includes("/");return!t&&!s?{multiplier:1,category:"natural"}:i?{multiplier:.75,category:"both-accidentals"}:{multiplier:.88,category:"single-accidental"}}function tv(e,t,s,i,A,r){const{label:a}=ox(t,s);if(!a)return;const{multiplier:l,category:h}=ax(a);let u;if(t.shape==="circle"){const g=r*2*GC;switch(h){case"natural":u=g*1;break;case"single-accidental":u=g*.8;break;case"both-accidentals":u=g*.4;break;default:u=g*l}}else{const g=r*2*WC;switch(h){case"natural":u=g*1.5;break;case"single-accidental":u=g*1.2;break;case"both-accidentals":u=g*1;break;default:u=g*l}}const m=u;if(!(m<KC))if(e.fillStyle="#212529",e.font=`bold ${m}px 'Atkinson Hyperlegible', sans-serif`,e.textAlign="center",e.textBaseline="middle",t.shape==="oval"&&h==="both-accidentals"&&a.includes("/")){const g=a.split("/"),v=m*1.1,y=v*(g.length-1),C=A-y/2;g.forEach((x,F)=>{const I=C+F*v,T=m*.08;e.fillText(x.trim(),i,I+T)})}else{const g=m*.08;e.fillText(a,i,A+g)}}let Yl=!1;function jl(e,t){return Number.isFinite(e)&&e>0&&Number.isFinite(t)&&t>0}function _f(e,t,s,i){const{cellWidth:A,cellHeight:r}=t,a=Nt(i,t),l=Jw(s,t),h=a+l,u=Bt(s.startColumnIndex,t);let m;if(t.modulationMarkers&&t.modulationMarkers.length>0?m=Bt(s.startColumnIndex+1,t)-u:m=A,!jl(m,r)){Yl||(console.warn("[PitchGrid] Skipping note render until layout dimensions are ready."),Yl=!0);return}const g=jw(s,d.state.placedNotes,t),v=u+m+g,y=Math.max(qC,m*zC);if(Yw(s)){const I=Bt(s.endColumnIndex+1,t)+g-g,T=rx(s,d.state.placedNotes,t),U=h+T;e.beginPath(),e.moveTo(v,U),e.lineTo(I,U),e.strokeStyle=s.color,e.lineWidth=Math.max(XC,m*$C),e.stroke()}const C=m-y/2,x=r/2-y/2;jl(C,x)&&(e.save(),Zw(e,s,v,h,C,x),e.beginPath(),e.ellipse(v,h,C,x,0,0,2*Math.PI),e.strokeStyle=s.color,e.lineWidth=y,e.shadowColor=s.color,e.shadowBlur=mw,e.stroke(),e.shadowBlur=0,e.shadowColor="transparent",e.restore(),t.degreeDisplayMode!=="off"&&tv(e,s,t,v,h,C))}function xf(e,t,s,i){const{columnWidths:A,cellWidth:r,cellHeight:a}=t,l=Nt(i,t),h=Jw(s,t),u=l+h,m=Bt(s.startColumnIndex,t);let g;if(t.modulationMarkers&&t.modulationMarkers.length>0?g=Bt(s.startColumnIndex+1,t)-m:g=((A==null?void 0:A[s.startColumnIndex])||0)*r,!jl(g,a)){Yl||(console.warn("[PitchGrid] Skipping note render until layout dimensions are ready."),Yl=!0);return}const v=jw(s,d.state.placedNotes,t),y=Math.max(.5,g*.15),C=m+g/2+v,x=g/2-y/2,F=a/2-y/2;jl(x,F)&&(e.save(),Zw(e,s,C,u,x,F),e.beginPath(),e.ellipse(C,u,x,F,0,0,2*Math.PI),e.strokeStyle=s.color,e.lineWidth=y,e.shadowColor=s.color,e.shadowBlur=mw,e.stroke(),e.shadowBlur=0,e.shadowColor="transparent",e.restore(),t.degreeDisplayMode!=="off"&&tv(e,s,t,C,u,x))}function Ef(e,t,s){const{cellWidth:i,cellHeight:A}=t,r=Nt(s.row,t),a=Bt(s.columnIndex,t);let l;t.modulationMarkers&&t.modulationMarkers.length>0?l=Bt(s.columnIndex+1,t)-a:l=i;const h=l*2,u=a+h/2,m=Math.min(h,A)/2*.9;if(m<2||(e.beginPath(),e.arc(u,r,m,0,2*Math.PI),e.strokeStyle="#212529",e.lineWidth=Math.max(.5,l*.05),e.stroke(),!s.tonicNumber))return;const g=s.tonicNumber.toString(),v=m*1.5;v<6||(e.fillStyle="#212529",e.font=`bold ${v}px 'Atkinson Hyperlegible', sans-serif`,e.textAlign="center",e.textBaseline="middle",e.fillText(g,u,r))}const fd=[{id:1,diamonds:[0],ovals:[],label:"left 8th"},{id:2,diamonds:[1],ovals:[],label:"e"},{id:3,diamonds:[2],ovals:[],label:"right 8th"},{id:4,diamonds:[3],ovals:[],label:"a"},{id:5,diamonds:[0,1],ovals:[],label:"1 e"},{id:6,diamonds:[1,2],ovals:[],label:"e &"},{id:7,diamonds:[2,3],ovals:[],label:"& a"},{id:8,diamonds:[0,2],ovals:[],label:"two 8ths"},{id:9,diamonds:[1,3],ovals:[],label:"e a"},{id:10,diamonds:[0,1,2],ovals:[],label:"1 e + right 8th"},{id:11,diamonds:[1,2,3],ovals:[],label:"e & a"},{id:12,diamonds:[0,1,3],ovals:[],label:"1 e a"},{id:13,diamonds:[0,2,3],ovals:[],label:"left 8th + & a"},{id:14,diamonds:[0,3],ovals:[],label:"left 8th + a"},{id:15,diamonds:[0,1,2,3],ovals:[],label:"1 e & a"}];function Bc(e){return fd.find(t=>t.id===e)}function Pm(e,t,s,i){const A=Math.sqrt(3)/2*s,r=Math.max(1,i-2*A),a=t-(r/2+A),l=a+A,h=l+r,u=h+A,m=e-s/2,g=e+s/2;return`M ${[`${e},${a}`,`${m},${l}`,`${m},${h}`,`${e},${u}`,`${g},${h}`,`${g},${l}`].join(" ")} Z`.replace(/,/g," ")}class lx{constructor(t={}){this.options={diamondW:30,diamondH:120,ovalRx:30,ovalRy:60,strokeWidth:2,...t}}renderToCanvas(t,s,i,A,r,a,l="#000",h=null,u=null){const m=Math.min(r/100,a/100)*.8,g=this.options.diamondW*m,v=this.options.diamondH*m,y=this.options.ovalRx*m,C=this.options.ovalRy*m,x=[.125,.375,.625,.875].map(I=>i+I*r),F=A+a/2;t.save(),t.strokeStyle=l,t.fillStyle=l,t.lineWidth=this.options.strokeWidth,t.lineCap="round",t.lineJoin="round",s.ovals.forEach(I=>{var D;const T=I===0?i+.25*r:i+.75*r;let U=F;if(h&&u){const O=`oval_${I}`,R=((D=h.shapeOffsets)==null?void 0:D[O])||0,st=h.row+R;U=u(st)}t.beginPath(),t.ellipse(T,U,y,C,0,0,Math.PI*2),t.stroke()}),s.diamonds.forEach(I=>{var R;const T=x[I];let U=F;if(h&&u){const st=`diamond_${I}`,Y=((R=h.shapeOffsets)==null?void 0:R[st])||0,L=h.row+Y;U=u(L)}const D=Pm(T,U,g,v),O=new Path2D(D);t.stroke(O)}),t.restore()}renderToSVG(t,s=100,i=100){const A=document.createElementNS("http://www.w3.org/2000/svg","svg");A.setAttribute("viewBox",`0 0 ${s} ${i}`),A.style.color="#000000";const r=Math.min(s/100,i/100)*.8,a=this.options.diamondW*r,l=this.options.diamondH*r,h=this.options.ovalRx*r,u=this.options.ovalRy*r,m=[12.5,37.5,62.5,87.5],g=i/2;return t.ovals.forEach(v=>{const y=v===0?25:75,C=document.createElementNS("http://www.w3.org/2000/svg","ellipse");C.setAttribute("cx",y),C.setAttribute("cy",g),C.setAttribute("rx",h),C.setAttribute("ry",u),C.setAttribute("fill","none"),C.setAttribute("stroke","currentColor"),C.setAttribute("stroke-width",this.options.strokeWidth*2),C.setAttribute("stroke-linecap","round"),A.appendChild(C)}),t.diamonds.forEach(v=>{const y=m[v],C=Pm(y,g,a,l),x=document.createElementNS("http://www.w3.org/2000/svg","path");x.setAttribute("d",C),x.setAttribute("fill","none"),x.setAttribute("stroke","currentColor"),x.setAttribute("stroke-width",this.options.strokeWidth*2),x.setAttribute("stroke-linejoin","round"),x.setAttribute("stroke-linecap","round"),A.appendChild(x)}),A}}const Sf=new lx;_.moduleLoaded("StampRenderer","stamps");function cx(e,t){const s=d.getAllStampPlacements();s.length!==0&&(_.debug("StampRenderer",`Rendering ${s.length} stamps`,{count:s.length},"stamps"),s.forEach(i=>{hx(e,i,t)}))}function hx(e,t,s){const i=Bc(t.stampId);if(!i)return;const{startColumn:A,endColumn:r,row:a,color:l}=t,h=Bt(A,s),m=Nt(a,s)-s.cellHeight/2,g=s.cellWidth*2,v=s.cellHeight,y=ke(e.canvas);if(h+g<0||h>y)return;const C=x=>Nt(x,s);Sf.renderToCanvas(e,i,h,m,g,v,l,t,C),e.save(),e.globalAlpha=.1,e.fillStyle=l,e.fillRect(h+1,m+1,g-2,v-2),e.restore(),_.debug("StampRenderer",`Rendered stamp ${i.id} at ${A}-${r},${a}`,{stampId:i.id,startColumn:A,endColumn:r,row:a,stampX:h,stampY:m,hasOffsets:!!t.shapeOffsets},"stamps")}function ux(e,t,s,i,A){if(!i)return;const r=Bt(t,A),l=Nt(s,A)-A.cellHeight/2,h=A.cellWidth*2,u=A.cellHeight;e.save(),e.globalAlpha=.6,Sf.renderToCanvas(e,i,r,l,h,u,A.previewColor||"#4a90e2"),e.restore()}function km(e,t,s){return[{id:t+0,span:e,hits:[0],label:`${s} [1]`},{id:t+1,span:e,hits:[1],label:`${s} [2]`},{id:t+2,span:e,hits:[2],label:`${s} [3]`},{id:t+3,span:e,hits:[0,1],label:`${s} [1 2]`},{id:t+4,span:e,hits:[1,2],label:`${s} [2 3]`},{id:t+5,span:e,hits:[0,2],label:`${s} [1 3]`},{id:t+6,span:e,hits:[0,1,2],label:`${s} [1 2 3]`}]}const pd=[...km("eighth",1,"8th triplet"),...km("quarter",8,"Quarter triplet")],dx={eighth:1,quarter:2},ev=[16.6667,50,83.3333];function ca(e){return pd.find(t=>t.id===e)}_.moduleLoaded("TripletRenderer","triplets");function fx(e,t){const s=d.getAllTripletPlacements();s.length!==0&&(_.debug("TripletRenderer",`Rendering ${s.length} triplet groups`,{count:s.length},"triplets"),s.forEach(i=>{px(e,i,t)}))}function px(e,t,s){const i=ca(t.stampId);if(!i)return;const{startCellIndex:A,span:r,row:a,color:l}=t,h=A*2,u=Bt(h,s),m=Nt(a,s),g=m-s.cellHeight/2,v=s.cellWidth*2*r,y=s.cellHeight,C=ke(e.canvas);if(u+v<0||u>C)return;sv(e,i,u,m,v,y,l,t,F=>Nt(F,s)),e.save(),e.globalAlpha=.1,e.fillStyle=l,e.fillRect(u+1,g+1,v-2,y-2),e.restore()}function sv(e,t,s,i,A,r,a,l=null,h=null){const u=t.span==="eighth"?"ovalWide":"circleWide",m=Math.min(A/100,r/100)*.8,g=Math.max(1,3*m);t.hits.forEach(v=>{var F;const y=ev[v],C=s+A*y/100;let x=i;if(l&&h){const I=`triplet_${v}`,T=((F=l.shapeOffsets)==null?void 0:F[I])||0,U=l.row+T;x=h(U),T!==0&&_.debug("TripletRenderer","Drawing notehead with offset",{slot:v,shapeKey:I,rowOffset:T,baseRow:l.row,shapeRow:U,y:x},"triplets")}mx(e,u,C,x,a,g,m)})}function mx(e,t,s,i,A="currentColor",r=4,a=1){const l=20*a,h=60*a;if(e.strokeStyle=A,e.lineWidth=r,e.fillStyle="none",e.beginPath(),t==="circleWide"){const u=l*2,m=h;e.ellipse(s,i,u,m,0,0,2*Math.PI)}else{const u=l,m=h;e.ellipse(s,i,u,m,0,0,2*Math.PI)}e.stroke()}function gx(e,t,s,i,A){if(!i)return;const r=t*2,a=i.span==="eighth"?1:2,l=Bt(r,A),h=Nt(s,A),u=A.cellWidth*2*a,m=A.cellHeight;e.save(),e.globalAlpha=.6;const g=A.previewColor||"#4a90e2";sv(e,i,l,h,u,m,g),e.restore()}function wx(e,t){const s=t.cellWidth||40;if(e===0)return 2*s;const i=e-1,A=An(t,i);return A?(A.endColumn+1)*s:(_.warn("ModulationRenderer","Could not find measure info for index",{measureIndex:e},"grid"),e*200)}function nv(e,t){const{modulationMarkers:s}=t;if(!s||s.length===0)return;const i=s.filter(A=>A.active).map(A=>{let r;if(A.columnIndex!==null&&A.columnIndex!==void 0)r=Bt(A.columnIndex+1,t);else if(A.macrobeatIndex!==null&&A.macrobeatIndex!==void 0){const a=An(t,A.macrobeatIndex);a?r=Bt(a.endColumn+1,t):(_.warn("ModulationRenderer","Could not find macrobeat info for index",{macrobeatIndex:A.macrobeatIndex},"grid"),r=A.xPosition||0)}else A.measureIndex!==null&&A.measureIndex!==void 0?r=wx(A.measureIndex,t):r=A.xPosition||0;return{...A,xCanvas:r}});e.save(),i.forEach(A=>{vx(e,A)}),e.restore()}function vx(e,t){const s=t.xCanvas,i=t.ratio,A=Hw(i),r=Lw(i);Bx(e,s,A),yx(e,s,r,A)}function Bx(e,t,s){const A=le(e.canvas);e.beginPath(),e.moveTo(t,0),e.lineTo(t,A),e.lineWidth=3,e.strokeStyle=s,e.setLineDash([]),e.stroke()}function yx(e,t,s,i){const r="Arial, sans-serif";e.font=`14px ${r}`,e.textAlign="center",e.textBaseline="middle";const m=e.measureText(s).width,g=14,v=m+12,y=g+12,C=t-v/2,x=20;Cx(e,C,x,v,y,8,i),e.fillStyle="white",e.fillText(s,t,x+y/2)}function Cx(e,t,s,i,A,r,a){e.beginPath(),e.moveTo(t+r,s),e.lineTo(t+i-r,s),e.quadraticCurveTo(t+i,s,t+i,s+r),e.lineTo(t+i,s+A-r),e.quadraticCurveTo(t+i,s+A,t+i-r,s+A),e.lineTo(t+r,s+A),e.quadraticCurveTo(t,s+A,t,s+A-r),e.lineTo(t,s+r),e.quadraticCurveTo(t,s,t+r,s),e.closePath(),e.fillStyle=a,e.fill(),e.strokeStyle="rgba(0, 0, 0, 0.2)",e.lineWidth=1,e.stroke()}function Jo(e,t){if(!t||t.length<3)return!1;const s=e.x!==void 0?e.x:e.col,i=e.y!==void 0?e.y:e.row;let A=!1;for(let r=0,a=t.length-1;r<t.length;a=r++){const l=t[r].x!==void 0?t[r].x:t[r].col,h=t[r].y!==void 0?t[r].y:t[r].row,u=t[a].x!==void 0?t[a].x:t[a].col,m=t[a].y!==void 0?t[a].y:t[a].row;h>i!=m>i&&s<(u-l)*(i-h)/(m-h)+l&&(A=!A)}return A}function za(e){if(!e||e.length<3)return e;const t=e.map(r=>({x:r.x!==void 0?r.x:r.col,y:r.y!==void 0?r.y:r.row}));let s=t[0];for(let r=1;r<t.length;r++)(t[r].y<s.y||t[r].y===s.y&&t[r].x<s.x)&&(s=t[r]);const i=t.filter(r=>r!==s);i.sort((r,a)=>{const l=Math.atan2(r.y-s.y,r.x-s.x),h=Math.atan2(a.y-s.y,a.x-s.x);if(l!==h)return l-h;const u=Math.hypot(r.x-s.x,r.y-s.y),m=Math.hypot(a.x-s.x,a.y-s.y);return u-m});const A=[s,i[0]];for(let r=1;r<i.length;r++){for(;A.length>1&&!bx(A[A.length-2],A[A.length-1],i[r]);)A.pop();A.push(i[r])}return A}function bx(e,t,s){return(t.x-e.x)*(s.y-e.y)-(t.y-e.y)*(s.x-e.x)>0}function _x(e,t,s,i=10){const A=e.x,r=e.y,a=t.x,l=t.y,h=s.x,u=s.y,m=h-a,g=u-l,v=m*m+g*g;if(v===0)return Math.hypot(A-a,r-l)<=i;let y=((A-a)*m+(r-l)*g)/v;y=Math.max(0,Math.min(1,y));const C=a+y*m,x=l+y*g;return Math.hypot(A-C,r-x)<=i}function Dm(e,t,s=10){if(!t||t.length<2)return!1;for(let i=0;i<t.length;i++){const A=t[i],r=t[(i+1)%t.length];if(_x(e,A,r,s))return!0}return!1}function xx(e,t){const{centerX:s,centerY:i,rx:A,ry:r}=t,a=16;for(let l=0;l<a;l++){const h=l/a*2*Math.PI,u=s+A*Math.cos(h),m=i+r*Math.sin(h);if(Jo({x:u,y:m},e))return!0}return!!Jo({x:s,y:i},e)}function Lm(e,t){const{x:s,y:i,width:A,height:r}=t,a=[{x:s,y:i},{x:s+A,y:i},{x:s+A,y:i+r},{x:s,y:i+r}];for(const l of a)if(Jo(l,e))return!0;for(const l of e){const h=l.x!==void 0?l.x:l.col,u=l.y!==void 0?l.y:l.row;if(h>=s&&h<=s+A&&u>=i&&u<=i+r)return!0}return!1}_.moduleLoaded("AnnotationService","annotation");class Ex{constructor(){this.canvas=null,this.ctx=null,this.currentTool=null,this.isDrawing=!1,this.currentPath=[],this.startPoint=null,this.tempAnnotation=null,this.selectedAnnotation=null,this.hoverAnnotation=null,this.eraserCursor=null,this.isDragging=!1,this.dragOffset=null,this.isResizing=!1,this.resizeHandle=null,this.resizeStartBounds=null,this.isDraggingSelection=!1,this.selectionDragStart=null,this.selectionDragTotal=null}initialize(){if(this.canvas=document.getElementById("notation-grid"),!this.canvas){_.error("AnnotationService","Pitch grid canvas not found",null,"annotation");return}this.ctx=this.canvas.getContext("2d"),this.setupEventListeners(),d.on("annotationsChanged",()=>{this.selectedAnnotation=null,this.render()}),_.initSuccess("AnnotationService")}setupEventListeners(){this.canvas.addEventListener("mousedown",this.handleMouseDown.bind(this)),this.canvas.addEventListener("mousemove",this.handleMouseMove.bind(this)),this.canvas.addEventListener("mouseup",this.handleMouseUp.bind(this)),this.canvas.addEventListener("mouseleave",this.handleMouseLeave.bind(this)),this.canvas.addEventListener("dblclick",this.handleDoubleClick.bind(this)),this.canvas.addEventListener("contextmenu",t=>t.preventDefault()),document.addEventListener("keydown",this.handleKeyDown.bind(this))}handleKeyDown(t){if(!this.selectedAnnotation)return;const s=document.activeElement,i=s.contentEditable==="true",A=s.tagName.toLowerCase();["input","textarea"].includes(A)||i||(t.key==="Delete"||t.key==="Backspace")&&(t.preventDefault(),this.deleteSelectedAnnotation())}deleteSelectedAnnotation(){if(!this.selectedAnnotation)return;const t=d.state.annotations.indexOf(this.selectedAnnotation);t>-1&&(d.state.annotations.splice(t,1),this.selectedAnnotation=null,d.recordState(),this.render(),_.log("AnnotationService","Deleted annotation","annotation"))}resize(){if(!this.canvas)return;const t=document.getElementById("notation-grid");t&&(this.canvas.width=t.width,this.canvas.height=t.height,this.render())}getRenderOptions(){return{columnWidths:d.state.columnWidths,cellWidth:d.state.cellWidth,cellHeight:d.state.cellHeight,modulationMarkers:d.state.modulationMarkers,baseMicrobeatPx:d.state.cellWidth}}canvasToGrid(t,s){const i=this.getRenderOptions();return{col:j_(t,i),row:J_(s,i)}}gridToCanvas(t,s){const i=this.getRenderOptions();return{x:Bt(t,i),y:Nt(s,i)}}setTool(t,s){if(this.currentTool=t,this.toolSettings=s,this.canvas)switch(t){case"arrow":case"text":this.canvas.style.cursor="crosshair";break;case"marker":case"highlighter":this.canvas.style.cursor=`url("data:image/svg+xml;utf8,<svg xmlns='http://www.w3.org/2000/svg' width='16' height='16'><circle cx='8' cy='8' r='4' fill='rgba(0,0,0,0.5)'/></svg>") 8 8, crosshair`;break;case"lasso":this.canvas.style.cursor="crosshair";break;default:this.canvas.style.cursor="default"}}handleMouseDown(t){var l,h;if(!this.currentTool||!this.toolSettings)return;const s=this.canvas.getBoundingClientRect(),i=t.clientX-s.left,A=t.clientY-s.top,r=this.canvasToGrid(i,A);if(t.button===2){if(this.currentTool==="lasso"&&((l=d.state.lassoSelection)!=null&&l.isActive)){this.removeFromLassoSelection(i,A);return}this.tempEraserMode=!0,this.isDrawing=!0,this.eraseAtPoint(i,A),this.showEraserCursor(i,A);return}if(this.selectedAnnotation&&this.selectedAnnotation.type==="text"){const u=this.getResizeHandleAt(i,A,this.selectedAnnotation);if(u){this.isResizing=!0,this.resizeHandle=u,this.resizeStartBounds={col:this.selectedAnnotation.col,row:this.selectedAnnotation.row,widthCols:this.selectedAnnotation.widthCols,heightRows:this.selectedAnnotation.heightRows,mouseCol:r.col,mouseRow:r.row};return}}if((h=d.state.lassoSelection)!=null&&h.isActive&&d.state.lassoSelection.convexHull){const u=Dm({x:i,y:A},d.state.lassoSelection.convexHull,10),m=Jo({x:i,y:A},d.state.lassoSelection.convexHull);if(u||m){this.isDraggingSelection=!0,this.selectionDragStart={canvasX:i,canvasY:A},this.selectionDragTotal={col:0,row:0};return}}const a=this.getAnnotationAt(i,A);if(a&&(a.type==="arrow"||a.type==="text")){if(this.selectedAnnotation===a){this.isDragging=!0,a.type==="arrow"?this.dragOffset={startCol:r.col-a.startCol,startRow:r.row-a.startRow,endCol:r.col-a.endCol,endRow:r.row-a.endRow}:a.type==="text"&&(this.dragOffset={col:r.col-a.col,row:r.row-a.row});return}this.selectedAnnotation=a,this.loadAnnotationSettings(a),this.render();return}else this.selectedAnnotation=null;switch(this.isDrawing=!0,this.startPoint=r,this.currentPath=[r],this.currentTool){case"arrow":this.tempAnnotation={type:"arrow",startCol:r.col,startRow:r.row,endCol:r.col,endRow:r.row,settings:{...this.toolSettings.arrow}};break;case"text":this.tempAnnotation={type:"text",startCol:r.col,startRow:r.row,endCol:r.col,endRow:r.row};break;case"marker":case"highlighter":this.tempAnnotation={type:this.currentTool,path:[r],settings:{...this.toolSettings[this.currentTool]}};break;case"lasso":this.tempAnnotation={type:"lasso",path:[{x:i,y:A}]};break}}handleMouseMove(t){const s=this.canvas.getBoundingClientRect(),i=t.clientX-s.left,A=t.clientY-s.top,r=this.canvasToGrid(i,A);if(this.tempEraserMode){this.eraseAtPoint(i,A),this.showEraserCursor(i,A);return}if(this.isResizing&&this.selectedAnnotation&&this.selectedAnnotation.type==="text"){const a=r.col-this.resizeStartBounds.mouseCol,l=r.row-this.resizeStartBounds.mouseRow;let h=this.resizeStartBounds.col,u=this.resizeStartBounds.row,m=this.resizeStartBounds.widthCols,g=this.resizeStartBounds.heightRows;this.resizeHandle.includes("n")&&(u=this.resizeStartBounds.row+l,g=this.resizeStartBounds.heightRows-l),this.resizeHandle.includes("s")&&(g=this.resizeStartBounds.heightRows+l),this.resizeHandle.includes("w")&&(h=this.resizeStartBounds.col+a,m=this.resizeStartBounds.widthCols-a),this.resizeHandle.includes("e")&&(m=this.resizeStartBounds.widthCols+a);const v=2,y=1;m<v&&(this.resizeHandle.includes("w")&&(h=this.resizeStartBounds.col+this.resizeStartBounds.widthCols-v),m=v),g<y&&(this.resizeHandle.includes("n")&&(u=this.resizeStartBounds.row+this.resizeStartBounds.heightRows-y),g=y),this.selectedAnnotation.col=h,this.selectedAnnotation.row=u,this.selectedAnnotation.widthCols=m,this.selectedAnnotation.heightRows=g,this.render();return}if(this.isDraggingSelection&&this.selectionDragStart){const a=this.getRenderOptions(),l=i-this.selectionDragStart.canvasX,h=A-this.selectionDragStart.canvasY,u=Math.round(l/a.cellWidth),m=Math.round(h/(a.cellHeight/2)),g={col:u-this.selectionDragTotal.col,row:m-this.selectionDragTotal.row};if(g.col!==0||g.row!==0){d.state.lassoSelection.selectedItems.forEach(y=>{if(y.type==="note"){y.data.row+=g.row;const C=y.data.columnIndex!==void 0?"columnIndex":"startColumnIndex";y.data[C]+=g.col,y.data.endColumnIndex!==void 0&&(y.data.endColumnIndex+=g.col)}else y.type==="stamp"?(y.data.row+=g.row,y.data.startColumn+=g.col,y.data.endColumn+=g.col):y.type==="triplet"&&(y.data.row+=g.row,y.data.column+=g.col)}),this.selectionDragTotal.col=u,this.selectionDragTotal.row=m;const v=d.state.lassoSelection.selectedItems.map(y=>{const C=y.data.columnIndex!==void 0?y.data.columnIndex:y.data.startColumnIndex!==void 0?y.data.startColumnIndex:y.data.column,x=Bt(C,a),F=Nt(y.data.row,a);return{x,y:F}});d.state.lassoSelection.convexHull=za(v),this.render()}return}if(this.isDragging&&this.selectedAnnotation){this.selectedAnnotation.type==="arrow"?(this.selectedAnnotation.startCol=r.col-this.dragOffset.startCol,this.selectedAnnotation.startRow=r.row-this.dragOffset.startRow,this.selectedAnnotation.endCol=r.col-this.dragOffset.endCol,this.selectedAnnotation.endRow=r.row-this.dragOffset.endRow):this.selectedAnnotation.type==="text"&&(this.selectedAnnotation.col=r.col-this.dragOffset.col,this.selectedAnnotation.row=r.row-this.dragOffset.row),this.render();return}if(!this.isDrawing){this.updateHover(i,A);return}if(this.tempAnnotation)switch(this.currentTool){case"arrow":this.tempAnnotation.endCol=r.col,this.tempAnnotation.endRow=r.row,this.render();break;case"text":this.tempAnnotation.endCol=r.col,this.tempAnnotation.endRow=r.row,this.render();break;case"marker":case"highlighter":if(this.tempAnnotation.path.length>0){const a=this.tempAnnotation.path[this.tempAnnotation.path.length-1],l=this.interpolatePoints(a,r);this.tempAnnotation.path.push(...l)}else this.tempAnnotation.path.push(r);this.render();break;case"lasso":this.tempAnnotation.path.push({x:i,y:A}),this.render();break}}handleMouseUp(){if(this.isResizing){this.isResizing=!1,this.resizeHandle=null,this.resizeStartBounds=null,d.recordState();return}if(this.isDraggingSelection){this.isDraggingSelection=!1,this.selectionDragStart=null,this.selectionDragTotal=null,d.recordState();return}if(this.isDragging){this.isDragging=!1,this.dragOffset=null,d.recordState();return}if(this.isDrawing){if(this.isDrawing=!1,this.tempEraserMode){this.tempEraserMode=!1,this.render();return}if(this.tempAnnotation){if(this.currentTool==="text"){const{startCol:t,startRow:s,endCol:i,endRow:A}=this.tempAnnotation,r=Math.abs(i-t),a=Math.abs(A-s),l=Math.min(t,i),h=Math.min(s,A);r>.5&&a>.2&&this.createTextAnnotation(l,h,r,a),this.tempAnnotation=null,this.render();return}this.currentTool==="lasso"?this.handleLassoSelection():(d.state.annotations.push(this.tempAnnotation),this.currentTool==="arrow"&&(this.selectedAnnotation=this.tempAnnotation),d.recordState()),this.tempAnnotation=null,this.render()}}}handleMouseLeave(t){this.isDrawing&&this.handleMouseUp(t)}handleDoubleClick(t){const s=this.canvas.getBoundingClientRect(),i=t.clientX-s.left,A=t.clientY-s.top,r=this.getAnnotationAt(i,A);r&&r.type==="text"&&this.editTextAnnotation(r)}editTextAnnotation(t){const{col:s,row:i,widthCols:A,heightRows:r,text:a,settings:l}=t,h=d.state.annotations.indexOf(t);h>-1&&(d.state.annotations.splice(h,1),this.selectedAnnotation=null,this.render()),this.createTextAnnotation(s,i,A,r,a,l)}createTextAnnotation(t,s,i,A,r=null,a=null){this.isDrawing=!1;const l=this.gridToCanvas(t,s),h=this.gridToCanvas(t+i,s+A),u=l.x,m=l.y,g=h.x-u,v=h.y-m,C=window.getComputedStyle(document.documentElement).getPropertyValue("--main-font").trim()||'"Atkinson Hyperlegible", Arial, sans-serif',x=a||this.toolSettings.text,F=document.createElement("div");F.contentEditable=!0,F.className="annotation-text-input",F.textContent=r||"Type here...";const I=x.size,T=I*1.2;F.style.width=`${g}px`,F.style.height=`${v}px`,F.style.padding=x.background?"4px 8px":"4px",F.style.border="2px dashed rgba(74, 144, 226, 0.5)",F.style.backgroundColor=x.background?"#ffffff":"transparent",F.style.color=x.color,F.style.fontSize=`${I}px`,F.style.lineHeight=`${T}px`,F.style.fontWeight=x.bold?"bold":"normal",F.style.fontStyle=x.italic?"italic":"normal",F.style.textDecoration=x.underline?"underline":"none",x.superscript?(F.style.fontSize=`${I*.6}px`,F.style.verticalAlign="super"):x.subscript&&(F.style.fontSize=`${I*.6}px`,F.style.verticalAlign="sub"),F.style.outline="none",F.style.zIndex="10000",F.style.position="fixed",F.style.cursor="text",F.style.pointerEvents="auto",F.style.fontFamily=C,F.style.whiteSpace="pre-wrap",F.style.wordWrap="break-word",F.style.overflow="hidden",F.style.boxSizing="border-box";const U=this.canvas.getBoundingClientRect();F.style.left=`${U.left+u}px`,F.style.top=`${U.top+m}px`,document.body.appendChild(F),F.focus();const D=document.createRange();D.selectNodeContents(F);const O=window.getSelection();O.removeAllRanges(),O.addRange(D);let R=!1;const st=()=>{if(R)return;R=!0;const L=F.textContent.trim();if(L&&L!=="Type here..."){const J={type:"text",col:t,row:s,widthCols:i,heightRows:A,text:L,settings:{...x}};d.state.annotations.push(J),this.selectedAnnotation=d.state.annotations[d.state.annotations.length-1],d.recordState(),this.render()}document.body.contains(F)&&document.body.removeChild(F)};let Y=!1;F.addEventListener("input",()=>{!Y&&F.textContent==="Type here..."&&(F.textContent="",Y=!0)}),setTimeout(()=>{F.addEventListener("blur",st)},100),F.addEventListener("keydown",L=>{L.key==="Enter"&&!L.shiftKey&&(L.preventDefault(),st()),L.key==="Escape"&&(R=!0,document.body.contains(F)&&document.body.removeChild(F))})}handleLassoSelection(){if(!this.tempAnnotation||!this.tempAnnotation.path)return;const t=this.tempAnnotation.path,s=[],i=this.getRenderOptions();window.event&&window.event.shiftKey&&d.state.lassoSelection.selectedItems&&s.push(...d.state.lassoSelection.selectedItems),d.state.placedNotes.forEach((a,l)=>{if(a.isDrum)return;const h=a.columnIndex!==void 0?a.columnIndex:a.startColumnIndex,u=Bt(h,i),m=Nt(a.row,i),{cellWidth:g,cellHeight:v}=i;let y=g;i.modulationMarkers&&i.modulationMarkers.length>0&&(y=Bt(h+1,i)-u);const C=a.shape==="oval"?u+y:u+y/2,x=m,F=a.shape==="oval"?y:y/2,I=v/2;if(xx(t,{centerX:C,centerY:x,rx:F,ry:I})){const T=`note-${a.row}-${h}-${a.color}-${a.shape}`;s.find(U=>U.id===T)||s.push({type:"note",id:T,data:a,index:l})}}),d.state.stampPlacements.forEach((a,l)=>{const{cellWidth:h,cellHeight:u}=i,m=Bt(a.startColumn,i),g=Nt(a.row,i)-u/2,v=h*2;if(Lm(t,{x:m,y:g,width:v,height:u})){const C=`stamp-${a.row}-${a.startColumn}-${a.stampId}`;s.find(x=>x.id===C)||s.push({type:"stamp",id:C,data:a,index:l})}}),d.state.tripletPlacements.forEach((a,l)=>{const{cellWidth:h,cellHeight:u}=i,m=Bt(a.column,i),g=Nt(a.row,i)-u/2,v=h*2;if(Lm(t,{x:m,y:g,width:v,height:u})){const C=`triplet-${a.row}-${a.column}-${a.tripletId}`;s.find(x=>x.id===C)||s.push({type:"triplet",id:C,data:a,index:l})}});let r=null;if(s.length>0){const a=s.map(l=>{const h=l.data.columnIndex!==void 0?l.data.columnIndex:l.data.startColumnIndex!==void 0?l.data.startColumnIndex:l.data.column,u=Bt(h,i),m=Nt(l.data.row,i);return{x:u,y:m}});r=za(a)}d.state.lassoSelection={selectedItems:s,convexHull:r,isActive:s.length>0},d.recordState(),_.log("AnnotationService",`Lasso selection completed: ${s.length} items selected`,"annotation"),this.render()}updateLassoConvexHull(){var i,A;if(!((i=d.state.lassoSelection)!=null&&i.isActive)||!((A=d.state.lassoSelection.selectedItems)!=null&&A.length))return;const t=this.getRenderOptions(),s=d.state.lassoSelection.selectedItems.map(r=>{const a=r.data.columnIndex!==void 0?r.data.columnIndex:r.data.startColumnIndex!==void 0?r.data.startColumnIndex:r.data.column,l=Bt(a,t),h=Nt(r.data.row,t);return{x:l,y:h}});d.state.lassoSelection.convexHull=za(s)}removeFromLassoSelection(t,s){var a;if(!((a=d.state.lassoSelection)!=null&&a.isActive))return;const i=this.getRenderOptions(),A=15;let r=null;if(d.state.placedNotes.forEach(l=>{const h=Bt(l.columnIndex,i),u=Nt(l.row,i);Math.hypot(t-h,s-u)<=A&&(r=`note-${l.row}-${l.columnIndex}-${l.color}-${l.shape}`)}),r||d.state.stampPlacements.forEach(l=>{const h=Bt(l.column,i),u=Nt(l.row,i);Math.hypot(t-h,s-u)<=A&&(r=`stamp-${l.row}-${l.column}-${l.stampId}`)}),r||d.state.tripletPlacements.forEach(l=>{const h=Bt(l.column,i),u=Nt(l.row,i);Math.hypot(t-h,s-u)<=A&&(r=`triplet-${l.row}-${l.column}-${l.tripletId}`)}),r){const l=d.state.lassoSelection.selectedItems.filter(u=>u.id!==r);let h=null;if(l.length>0){const u=l.map(m=>{const g=Bt(m.data.columnIndex||m.data.column,i),v=Nt(m.data.row,i);return{x:g,y:v}});h=za(u)}d.state.lassoSelection={selectedItems:l,convexHull:h,isActive:l.length>0},d.recordState(),this.render(),_.log("AnnotationService",`Removed item from lasso selection. ${l.length} items remain.`,"annotation")}}drawTempAnnotation(){if(this.tempAnnotation)switch(this.tempAnnotation.type){case"arrow":this.drawArrow(this.tempAnnotation,!0);break;case"text":this.drawTextBoxPreview(this.tempAnnotation);break;case"marker":this.drawPath(this.tempAnnotation,!1);break;case"highlighter":this.drawPath(this.tempAnnotation,!0);break;case"lasso":this.drawLassoPath(this.tempAnnotation);break}}drawTextBoxPreview(t){const{startX:s,startY:i,endX:A,endY:r}=t,a=this.ctx,l=Math.min(s,A),h=Math.min(i,r),u=Math.abs(A-s),m=Math.abs(r-i);a.save(),a.strokeStyle="rgba(74, 144, 226, 0.6)",a.lineWidth=2,a.setLineDash([5,5]),a.strokeRect(l,h,u,m),this.toolSettings.text.background&&(a.fillStyle="rgba(255, 255, 255, 0.8)",a.fillRect(l,h,u,m)),a.restore()}render(){iA.render()}drawArrow(t,s=!1,i=!1,A=!1){const{startX:r,startY:a,endX:l,endY:h,settings:u}=t,m=this.ctx;m.save(),i&&(m.strokeStyle="#4a90e2",m.lineWidth=this.getStrokeWidth(u.strokeWeight)+4,m.globalAlpha=.3,m.setLineDash([]),m.beginPath(),m.moveTo(r,a),m.lineTo(l,h),m.stroke(),m.globalAlpha=1),A&&!i&&(m.strokeStyle="#4a90e2",m.lineWidth=this.getStrokeWidth(u.strokeWeight)+4,m.globalAlpha=.15,m.setLineDash([]),m.beginPath(),m.moveTo(r,a),m.lineTo(l,h),m.stroke(),m.globalAlpha=1),m.strokeStyle=s?"rgba(0, 0, 0, 0.5)":"#000000",m.lineWidth=this.getStrokeWidth(u.strokeWeight),m.setLineDash(this.getLineDash(u.lineStyle));const g=Math.atan2(h-a,l-r),v=u.arrowheadSize||12;let y=r,C=a,x=l,F=h;u.startArrowhead!=="none"&&(y=r+Math.cos(g)*v,C=a+Math.sin(g)*v),u.endArrowhead!=="none"&&(x=l-Math.cos(g)*v,F=h-Math.sin(g)*v),m.beginPath(),m.moveTo(y,C),m.lineTo(x,F),m.stroke(),u.startArrowhead!=="none"&&this.drawArrowhead(m,r,a,g+Math.PI,u.startArrowhead,v),u.endArrowhead!=="none"&&this.drawArrowhead(m,l,h,g,u.endArrowhead,v),m.restore()}drawArrowhead(t,s,i,A,r,a=12){switch(t.save(),t.translate(s,i),t.rotate(A),t.setLineDash([]),r){case"filled":case"filled-arrow":t.beginPath(),t.moveTo(0,0),t.lineTo(-a,-a/2),t.lineTo(-a,a/2),t.closePath(),t.fillStyle=t.strokeStyle,t.fill();break;case"unfilled":case"unfilled-arrow":t.beginPath(),t.moveTo(0,0),t.lineTo(-a,-a/2),t.lineTo(-a,a/2),t.closePath(),t.stroke();break;case"circle":t.beginPath(),t.arc(0,0,a/3,0,Math.PI*2),t.fillStyle=t.strokeStyle,t.fill();break}t.restore()}wrapText(t,s,i){const A=s.split(`
`),r=[];return A.forEach(a=>{if(!a.trim()){r.push("");return}const l=a.split(" ");let h="";l.forEach(u=>{const m=h?h+" "+u:u;t.measureText(m).width>i&&h?(r.push(h),h=u):h=m}),h&&r.push(h)}),r}drawText(t,s=!1,i=!1){const{x:A,y:r,text:a,settings:l}=t,h=this.ctx;h.save();const m=window.getComputedStyle(document.documentElement).getPropertyValue("--main-font").trim()||'"Atkinson Hyperlegible", Arial, sans-serif',g=this.getSizeValue(l.size);h.font=`${l.italic?"italic ":""}${l.bold?"bold ":""}${g} ${m}`,h.textBaseline="top";const v=parseInt(g)*1.2,y=t.width||0,C=t.height||0,x=l.background?16:8,F=y-x,I=this.wrapText(h,a,F);if(l.background){h.fillStyle="#ffffff";const U=8;h.fillRect(A-U/2,r-U/2,y+U,C+U/2)}if(i&&!s){h.fillStyle="rgba(74, 144, 226, 0.1)";const U=l.background?8:2;h.fillRect(A-U/2,r-U/2,y+U,C+U/2)}if(s){h.fillStyle="rgba(74, 144, 226, 0.2)";const U=l.background?8:2;h.fillRect(A-U/2,r-U/2,y+U,C+U/2)}h.fillStyle=l.color;const T=parseInt(g);I.forEach((U,D)=>{const O=r+D*v;this.drawTextWithSuperscripts(h,U,A,O,T,l,m)}),s&&this.drawResizeHandles(A,r,y,C),h.restore()}drawTextWithSuperscripts(t,s,i,A,r,a,l){if(a.superscript||a.subscript){t.save();const g=r*.6,v=a.superscript?-r*.4:r*.3;if(t.font=`${a.italic?"italic ":""}${a.bold?"bold ":""}${g}px ${l}`,t.fillText(s,i,A+v),a.underline){const y=t.measureText(s);t.beginPath(),t.strokeStyle=a.color,t.lineWidth=1,t.moveTo(i,A+v+g*1.2-2),t.lineTo(i+y.width,A+v+g*1.2-2),t.stroke()}t.restore();return}let h=i;const u=this.parseFormattedText(s),m=(g,v)=>{if(g){if(t.save(),v==="superscript"){const y=r*.6,C=-r*.4;t.font=`${a.italic?"italic ":""}${a.bold?"bold ":""}${y}px ${l}`,t.fillText(g,h,A+C),h+=t.measureText(g).width}else if(v==="subscript"){const y=r*.6,C=r*.3;t.font=`${a.italic?"italic ":""}${a.bold?"bold ":""}${y}px ${l}`,t.fillText(g,h,A+C),h+=t.measureText(g).width}else{if(t.font=`${a.italic?"italic ":""}${a.bold?"bold ":""}${r}px ${l}`,t.fillText(g,h,A),a.underline){const y=t.measureText(g);t.beginPath(),t.strokeStyle=a.color,t.lineWidth=1,t.moveTo(h,A+r*1.2-2),t.lineTo(h+y.width,A+r*1.2-2),t.stroke()}h+=t.measureText(g).width}t.restore()}};u.forEach(g=>{m(g.text,g.format)})}parseFormattedText(t){const s=[];let i=0,A="",r=!1;for(;i<t.length;){if(t.substr(i,5)==="<sup>"){A&&(s.push({text:A,format:"normal"}),A="");const a=t.indexOf("</sup>",i);if(a!==-1){const l=t.substring(i+5,a);s.push({text:l,format:"superscript"}),i=a+6;continue}}if(t.substr(i,5)==="<sub>"){A&&(s.push({text:A,format:"normal"}),A="");const a=t.indexOf("</sub>",i);if(a!==-1){const l=t.substring(i+5,a);s.push({text:l,format:"subscript"}),i=a+6;continue}}if(t[i]==="^"&&!r){A&&(s.push({text:A,format:"normal"}),A=""),r=!0,i++;continue}if(r&&t[i]===" "){A&&(s.push({text:A,format:"superscript"}),A=""),r=!1,s.push({text:" ",format:"normal"}),i++;continue}A+=t[i],i++}return A&&s.push({text:A,format:r?"superscript":"normal"}),s}drawResizeHandles(t,s,i,A){const r=this.ctx,a=8,l=[{pos:"nw",x:t,y:s},{pos:"n",x:t+i/2,y:s},{pos:"ne",x:t+i,y:s},{pos:"e",x:t+i,y:s+A/2},{pos:"se",x:t+i,y:s+A},{pos:"s",x:t+i/2,y:s+A},{pos:"sw",x:t,y:s+A},{pos:"w",x:t,y:s+A/2}];r.save(),l.forEach(h=>{r.fillStyle="#4a90e2",r.strokeStyle="#ffffff",r.lineWidth=2,r.fillRect(h.x-a/2,h.y-a/2,a,a),r.strokeRect(h.x-a/2,h.y-a/2,a,a)}),r.restore()}drawPath(t,s){const{path:i,settings:A}=t,r=this.ctx;if(!(i.length<2)){r.save(),s&&(r.globalAlpha=.3),r.strokeStyle=A.color,r.lineWidth=this.getStrokeWidth(A.size),r.lineCap="round",r.lineJoin="round",r.beginPath(),r.moveTo(i[0].x,i[0].y);for(let a=1;a<i.length;a++)r.lineTo(i[a].x,i[a].y);r.stroke(),r.restore()}}drawLassoPath(t){const{path:s}=t,i=this.ctx;if(!(s.length<2)){i.save(),i.strokeStyle="rgba(0, 100, 255, 0.8)",i.lineWidth=2,i.setLineDash([5,5]),i.beginPath(),i.moveTo(s[0].x,s[0].y);for(let A=1;A<s.length;A++)i.lineTo(s[A].x,s[A].y);i.lineTo(s[0].x,s[0].y),i.stroke(),i.restore()}}getStrokeWidth(t){if(typeof t=="number")return t;switch(t){case"small":return 2;case"medium":return 4;case"large":return 6;default:return 2}}getLineDash(t){switch(t){case"solid":return[];case"dashed-big":return[10,5];case"dashed-small":return[5,3];case"dotted":return[2,3];default:return[]}}getSizeValue(t){if(typeof t=="number")return`${t}px`;switch(t){case"small":return"14px";case"medium":return"18px";case"large":return"24px";default:return"16px"}}updateHover(t,s){var r;const i=this.hoverAnnotation;if(this.selectedAnnotation&&this.selectedAnnotation.type==="text"){const a=this.getResizeHandleAt(t,s,this.selectedAnnotation);if(a){const l={nw:"nwse-resize",n:"ns-resize",ne:"nesw-resize",e:"ew-resize",se:"nwse-resize",s:"ns-resize",sw:"nesw-resize",w:"ew-resize"};this.canvas.style.cursor=l[a];return}}if((r=d.state.lassoSelection)!=null&&r.isActive&&d.state.lassoSelection.convexHull){const a=Dm({x:t,y:s},d.state.lassoSelection.convexHull,10),l=Jo({x:t,y:s},d.state.lassoSelection.convexHull);if(a||l){this.canvas.style.cursor="move";return}}const A=this.getAnnotationAt(t,s);A&&(A.type==="arrow"||A.type==="text")?(this.canvas.style.cursor="move",this.hoverAnnotation=A):(this.setTool(this.currentTool,this.toolSettings),this.hoverAnnotation=null),i!==this.hoverAnnotation&&this.render()}getResizeHandleAt(t,s,i){if(!i||i.type!=="text")return null;const r=8/2+2,a=i.width||0,l=i.height||0,h=i.x,u=i.y,m=[{pos:"nw",x:h,y:u},{pos:"n",x:h+a/2,y:u},{pos:"ne",x:h+a,y:u},{pos:"e",x:h+a,y:u+l/2},{pos:"se",x:h+a,y:u+l},{pos:"s",x:h+a/2,y:u+l},{pos:"sw",x:h,y:u+l},{pos:"w",x:h,y:u+l/2}];for(const g of m)if(Math.sqrt(Math.pow(t-g.x,2)+Math.pow(s-g.y,2))<=r)return g.pos;return null}getAnnotationAt(t,s){for(let A=d.state.annotations.length-1;A>=0;A--){const r=d.state.annotations[A];if(r.type==="arrow"){if(this.distanceToLineSegment(t,s,r.startX,r.startY,r.endX,r.endY)<10)return r}else if(r.type==="text"){let a=r.width,l=r.height;if(!a||!l){const h=r.text.split(`
`),u=r.settings.size,m=u*1.2;this.ctx.font=`${u}px Arial`,a=0,h.forEach(g=>{const v=this.ctx.measureText(g);a=Math.max(a,v.width)}),l=h.length*m}if(t>=r.x&&t<=r.x+a&&s>=r.y&&s<=r.y+l)return r}}return null}showEraserCursor(t,s){this.render();const A=(d.state.cellWidth||40)*2;this.ctx.save(),this.ctx.fillStyle="rgba(220, 53, 69, 0.3)",this.ctx.fillRect(t-A/2,s-A/2,A,A),this.ctx.restore()}loadAnnotationSettings(t){if(t.type==="arrow"&&window.drawToolsController){const s=t.settings;window.drawToolsController.settings.arrow={...s},window.drawToolsController.renderArrowOptions()}else if(t.type==="text"&&window.drawToolsController){const s=t.settings;window.drawToolsController.settings.text={...s},window.drawToolsController.renderTextOptions()}}applyCurrentSettingsToSelected(){this.selectedAnnotation&&(this.selectedAnnotation.type==="arrow"&&this.toolSettings.arrow?(this.selectedAnnotation.settings={...this.toolSettings.arrow},this.render()):this.selectedAnnotation.type==="text"&&this.toolSettings.text&&(this.selectedAnnotation.settings={...this.toolSettings.text},this.render()))}clearAnnotations(){d.state.annotations=[],this.render()}eraseAtPoint(t,s){let A=!1;return d.state.annotations=d.state.annotations.filter(r=>{let a=!0;if(r.type==="arrow"){const l=this.getRenderOptions(),h=Bt(r.startCol,l),u=Nt(r.startRow,l),m=Bt(r.endCol,l),g=Nt(r.endRow,l);this.distanceToLineSegment(t,s,h,u,m,g)<10&&(a=!1,A=!0)}else if(r.type==="text"){const l=this.getRenderOptions(),h=Bt(r.col,l),u=Nt(r.row,l),m=Bt(r.col+r.widthCols,l),g=Nt(r.row+r.heightRows,l);t>=h&&t<=m&&s>=u&&s<=g&&(a=!1,A=!0)}else if(r.type==="marker"||r.type==="highlighter"){const l=this.getRenderOptions();for(let h=0;h<r.path.length;h++){const u=Bt(r.path[h].col,l),m=Nt(r.path[h].row,l),g=t-u,v=s-m;if(Math.sqrt(g*g+v*v)<10){a=!1,A=!0;break}}}return a}),A&&this.render(),A}interpolatePoints(t,s){const i=[],A=s.col-t.col,r=s.row-t.row,a=Math.sqrt(A*A+r*r),l=Math.max(1,Math.floor(a/.1));for(let h=1;h<=l;h++){const u=h/l;i.push({col:t.col+u*A,row:t.row+u*r})}return i}distanceToLineSegment(t,s,i,A,r,a){const l=r-i,h=a-A,u=l*l+h*h;if(u===0){const x=t-i,F=s-A;return Math.sqrt(x*x+F*F)}let m=((t-i)*l+(s-A)*h)/u;m=Math.max(0,Math.min(1,m));const g=i+m*l,v=A+m*h,y=t-g,C=s-v;return Math.sqrt(y*y+C*C)}deleteAnnotationAt(t,s){this.eraseAtPoint(t,s)}getAnnotations(){return d.state.annotations}loadAnnotations(t){d.state.annotations=t||[],this.render()}applyInlineFormatting(t){const s=document.querySelector(".annotation-text-input");if(!s)return;const i=window.getSelection();if(!i.rangeCount)return;const A=i.getRangeAt(0),r=A.toString();if(!r)return;let a;if(t==="superscript")a=`<sup>${r}</sup>`;else if(t==="subscript")a=`<sub>${r}</sub>`;else return;A.deleteContents();const l=document.createTextNode(a);A.insertNode(l),A.setStartAfter(l),A.setEndAfter(l),i.removeAllRanges(),i.addRange(A),s.focus()}}const re=new Ex;function Sx(e,t){var a;const s=d.state.annotations,i=re.tempAnnotation,A=re.selectedAnnotation,r=re.hoverAnnotation;if(s&&s.length>0&&s.forEach(l=>{const h=l===A,u=l===r;switch(l.type){case"arrow":Hm(e,l,h,u,t);break;case"text":Fx(e,l,h,u,t);break;case"marker":$a(e,l,!1,t);break;case"highlighter":$a(e,l,!0,t);break}}),i)switch(i.type){case"arrow":Hm(e,i,!1,!1,t);break;case"text":Ux(e,i,t);break;case"marker":$a(e,i,!1,t);break;case"highlighter":$a(e,i,!0,t);break;case"lasso":kx(e,i);break}(a=d.state.lassoSelection)!=null&&a.isActive&&d.state.lassoSelection.convexHull&&(re.updateLassoConvexHull(),Dx(e,d.state.lassoSelection.convexHull))}function Hm(e,t,s=!1,i=!1,A){const{startCol:r,startRow:a,endCol:l,endRow:h,settings:u}=t,m=Bt(r,A),g=Nt(a,A),v=Bt(l,A),y=Nt(h,A);e.save(),e.strokeStyle=t.color||"#000000",e.lineWidth=md(u.strokeWeight),e.setLineDash(Px(u.lineStyle));const C=Math.atan2(y-g,v-m),x=u.arrowheadSize||12;let F=m,I=g,T=v,U=y;u.startArrowhead!=="none"&&(F=m+Math.cos(C)*x,I=g+Math.sin(C)*x),u.endArrowhead!=="none"&&(T=v-Math.cos(C)*x,U=y-Math.sin(C)*x),e.beginPath(),e.moveTo(F,I),e.lineTo(T,U),e.stroke(),e.setLineDash([]),u.startArrowhead!=="none"&&Rm(e,m,g,C+Math.PI,u.startArrowhead,x),u.endArrowhead!=="none"&&Rm(e,v,y,C,u.endArrowhead,x),(s||i)&&(e.strokeStyle=s?"rgba(74, 144, 226, 0.6)":"rgba(74, 144, 226, 0.3)",e.lineWidth=md(u.strokeWeight)+4,e.setLineDash([]),e.beginPath(),e.moveTo(m,g),e.lineTo(v,y),e.stroke()),e.restore()}function Rm(e,t,s,i,A,r){switch(e.save(),e.translate(t,s),e.rotate(i),A){case"filled":case"filled-arrow":e.beginPath(),e.moveTo(0,0),e.lineTo(-r,-r/2),e.lineTo(-r,r/2),e.closePath(),e.fillStyle=e.strokeStyle,e.fill();break;case"unfilled":case"unfilled-arrow":e.beginPath(),e.moveTo(0,0),e.lineTo(-r,-r/2),e.lineTo(-r,r/2),e.closePath(),e.stroke();break;case"circle":e.beginPath(),e.arc(0,0,r/3,0,Math.PI*2),e.fillStyle=e.strokeStyle,e.fill();break}e.restore()}function Fx(e,t,s=!1,i=!1,A){const{col:r,row:a,text:l,settings:h,widthCols:u,heightRows:m}=t,g=Bt(r,A),v=Nt(a,A),y=Bt(r+u,A)-g,C=Nt(a+m,A)-v;e.save();const F=window.getComputedStyle(document.documentElement).getPropertyValue("--main-font").trim()||'"Atkinson Hyperlegible", Arial, sans-serif',I=h.size,T=I*1.2,U=h.background?8:4,D=4,O=y-U*2,R=Tx(e,l,O,I,h,F);h.background&&(e.fillStyle="#ffffff",e.fillRect(g,v,y,C)),i&&!s&&(e.fillStyle="rgba(74, 144, 226, 0.1)",e.fillRect(g,v,y,C)),s&&(e.fillStyle="rgba(74, 144, 226, 0.2)",e.fillRect(g,v,y,C)),e.fillStyle=h.color,R.forEach((st,Y)=>{const L=v+D+Y*T;Ix(e,st,g+U,L,I,h,F)}),s&&Mx(e,g,v,y,C),e.restore()}function Tx(e,t,s,i,A,r){e.font=`${A.italic?"italic ":""}${A.bold?"bold ":""}${i}px ${r}`;const a=t.split(`
`),l=[];return a.forEach(h=>{if(!h.trim()){l.push("");return}const u=h.split(" ");let m="";u.forEach(g=>{const v=m?m+" "+g:g;e.measureText(v).width>s&&m?(l.push(m),m=g):m=v}),m&&l.push(m)}),l}function Ix(e,t,s,i,A,r,a){if(r.superscript||r.subscript){e.save();const u=A*.6,m=r.superscript?-A*.4:A*.3;if(e.font=`${r.italic?"italic ":""}${r.bold?"bold ":""}${u}px ${a}`,e.fillText(t,s,i+m),r.underline){const g=e.measureText(t);e.beginPath(),e.strokeStyle=r.color,e.lineWidth=1,e.moveTo(s,i+m+u*1.2-2),e.lineTo(s+g.width,i+m+u*1.2-2),e.stroke()}e.restore();return}const l=Qx(t);let h=s;l.forEach(u=>{if(e.save(),u.format==="superscript"){const m=A*.6,g=-A*.4;e.font=`${r.italic?"italic ":""}${r.bold?"bold ":""}${m}px ${a}`,e.fillText(u.text,h,i+g),h+=e.measureText(u.text).width}else if(u.format==="subscript"){const m=A*.6,g=A*.3;e.font=`${r.italic?"italic ":""}${r.bold?"bold ":""}${m}px ${a}`,e.fillText(u.text,h,i+g),h+=e.measureText(u.text).width}else{if(e.font=`${r.italic?"italic ":""}${r.bold?"bold ":""}${A}px ${a}`,e.fillText(u.text,h,i),r.underline){const m=e.measureText(u.text);e.beginPath(),e.strokeStyle=r.color,e.lineWidth=1,e.moveTo(h,i+A*1.2-2),e.lineTo(h+m.width,i+A*1.2-2),e.stroke()}h+=e.measureText(u.text).width}e.restore()})}function Qx(e){const t=[];let s=0,i="",A=!1;for(;s<e.length;){if(e.substr(s,5)==="<sup>"){i&&(t.push({text:i,format:"normal"}),i="");const r=e.indexOf("</sup>",s);if(r!==-1){const a=e.substring(s+5,r);t.push({text:a,format:"superscript"}),s=r+6;continue}}if(e.substr(s,5)==="<sub>"){i&&(t.push({text:i,format:"normal"}),i="");const r=e.indexOf("</sub>",s);if(r!==-1){const a=e.substring(s+5,r);t.push({text:a,format:"subscript"}),s=r+6;continue}}if(e[s]==="^"&&!A){i&&(t.push({text:i,format:"normal"}),i=""),A=!0,s++;continue}if(A&&e[s]===" "){i&&(t.push({text:i,format:"superscript"}),i=""),A=!1,t.push({text:" ",format:"normal"}),s++;continue}i+=e[s],s++}return i&&t.push({text:i,format:A?"superscript":"normal"}),t}function Mx(e,t,s,i,A){const a=[{x:t,y:s},{x:t+i/2,y:s},{x:t+i,y:s},{x:t+i,y:s+A/2},{x:t+i,y:s+A},{x:t+i/2,y:s+A},{x:t,y:s+A},{x:t,y:s+A/2}];e.save(),a.forEach(l=>{e.fillStyle="#4a90e2",e.strokeStyle="#ffffff",e.lineWidth=2,e.fillRect(l.x-8/2,l.y-8/2,8,8),e.strokeRect(l.x-8/2,l.y-8/2,8,8)}),e.restore()}function Ux(e,t,s){const{startCol:i,startRow:A,endCol:r,endRow:a}=t,l=Bt(i,s),h=Nt(A,s),u=Bt(r,s),m=Nt(a,s),g=Math.min(l,u),v=Math.min(h,m),y=Math.abs(u-l),C=Math.abs(m-h);e.save(),e.strokeStyle="rgba(74, 144, 226, 0.6)",e.lineWidth=2,e.setLineDash([5,5]),e.strokeRect(g,v,y,C),e.restore()}function $a(e,t,s,i){const{path:A,settings:r}=t;if(!A||A.length<2)return;const a=A.map(l=>({x:Bt(l.col,i),y:Nt(l.row,i)}));e.save(),s&&(e.globalAlpha=.3),e.strokeStyle=r.color,e.lineWidth=typeof r.size=="number"?r.size:md(r.size),e.lineCap="round",e.lineJoin="round",e.beginPath(),e.moveTo(a[0].x,a[0].y);for(let l=1;l<a.length;l++)e.lineTo(a[l].x,a[l].y);e.stroke(),e.restore()}function md(e){if(typeof e=="number")return e;switch(e){case"small":return 2;case"medium":return 4;case"large":return 6;default:return 4}}function Px(e){switch(e){case"solid":return[];case"dashed-big":return[10,5];case"dashed-small":return[5,3];case"dotted":return[2,3];default:return[]}}function kx(e,t){if(!(!t.path||t.path.length<2)){e.save(),e.strokeStyle="#4a90e2",e.lineWidth=2,e.setLineDash([5,5]),e.globalAlpha=.7,e.beginPath(),e.moveTo(t.path[0].x,t.path[0].y);for(let s=1;s<t.path.length;s++)e.lineTo(t.path[s].x,t.path[s].y);t.path.length>2&&e.lineTo(t.path[0].x,t.path[0].y),e.stroke(),e.restore()}}function Dx(e,t){if(!(!t||t.length<3)){e.save(),e.strokeStyle="#4a90e2",e.lineWidth=2,e.setLineDash([8,4]),e.globalAlpha=.8,e.beginPath(),e.moveTo(t[0].x,t[0].y);for(let s=1;s<t.length;s++)e.lineTo(t[s].x,t[s].y);e.closePath(),e.stroke(),e.fillStyle="rgba(74, 144, 226, 0.1)",e.fill(),e.restore()}}function Lx(e,t){const s={...t,...d.state};e.clearRect(0,0,ke(e.canvas),le(e.canvas));const{startRow:i,endRow:A}=X_();Ax(e,s,i,A),ex(e,s,i,A),sx(e,s);const r=t.placedNotes.filter(l=>!l.isDrum&&l.row>=i&&l.row<=A),a=t.placedTonicSigns.filter(l=>l.row>=i&&l.row<=A);r.forEach(l=>{l.shape==="oval"?xf(e,s,l,l.row):l.shape==="circle"&&_f(e,s,l,l.row)}),a.forEach(l=>{Ef(e,s,l)}),cx(e,s),fx(e,s),nv(e,s),Sx(e,s)}const iv={getTimeSignatureSegments(){const e=[];let t=d.state.hasAnacrusis,s=An(d.state,0).startColumn,i=0,A=!1;return d.state.macrobeatGroupings.forEach((r,a)=>{i+=r,r===3&&(A=!0);const l=a===d.state.macrobeatGroupings.length-1,u=d.state.macrobeatBoundaryStyles[a]==="solid";if(u||l){const m=An(d.state,a).endColumn+1,g=d.state.modulationMarkers&&d.state.modulationMarkers.length>0;let v,y;if(g){const x={...d.state,modulationMarkers:d.state.modulationMarkers,cellWidth:d.state.cellWidth,columnWidths:d.state.columnWidths,baseMicrobeatPx:d.state.cellWidth};v=Bt(s,x),y=Bt(m,x)}else v=yt.getColumnX(s),y=yt.getColumnX(m);const C=A?`${i}/8`:`${i/2}/4`;e.push({label:C,centerX:(v+y)/2,startX:v,endX:y,isAnacrusis:t}),l||(s=m,i=0,A=!1,u&&(t=!1))}}),e},getRhythmUIButtons(){const e=[],t=d.state.modulationMarkers&&d.state.modulationMarkers.length>0,s=t?{...d.state,modulationMarkers:d.state.modulationMarkers,cellWidth:d.state.cellWidth,columnWidths:d.state.columnWidths,baseMicrobeatPx:d.state.cellWidth}:null;return d.state.macrobeatGroupings.forEach((i,A)=>{const{startColumn:r,endColumn:a}=An(d.state,A),l=t?Bt(r,s):yt.getColumnX(r),h=t?Bt(a+1,s):yt.getColumnX(a+1),u=(l+h)/2,m=d.state.macrobeatBoundaryStyles[A]??null;e.push({type:"grouping",content:i,x:u,startX:l,endX:h,index:A,nextBoundaryStyle:m}),A<d.state.macrobeatGroupings.length-1&&e.push({type:"boundary",boundaryStyle:m,x:h,index:A})}),e}},Hx="data-rhythm-ui-element",gd=e=>`${Math.round(e*100)/100}px`,Rx=e=>{e.querySelectorAll(`[${Hx}]`).forEach(t=>t.remove())},Ox=e=>{const t=document.getElementById("notation-grid");if(!t)return null;const s=t.getBoundingClientRect(),i=e.getBoundingClientRect();return s.width===0?null:s.left-i.left},Nx=(e,t)=>{const s=document.createElement("button");return s.type="button",s.className="grouping-segment",s.dataset.rhythmUiElement="grouping",s.dataset.index=e.index,s.textContent=e.content,s.style.left=gd(t+e.startX),s.style.width=gd(Math.max(0,e.endX-e.startX)),e.nextBoundaryStyle?s.dataset.nextBoundaryStyle=e.nextBoundaryStyle:s.removeAttribute("data-next-boundary-style"),s.setAttribute("aria-label",`Toggle macrobeat grouping (${e.content}) at position ${e.index+1}`),s.addEventListener("click",i=>{i.stopPropagation(),d.toggleMacrobeatGrouping(e.index)}),s},Vx=(e,t)=>{const s=document.createElement("button");s.type="button",s.className="rhythm-ui-button rhythm-ui-button--boundary",s.dataset.rhythmUiElement="boundary",s.dataset.index=e.index,s.style.left=gd(t+e.x),s.setAttribute("aria-label","Cycle boundary style");const i=document.createElement("span");return i.className="boundary-diamond",i.dataset.style=e.boundaryStyle||"dashed",s.appendChild(i),s.addEventListener("click",A=>{A.stopPropagation(),d.cycleMacrobeatBoundaryStyle(e.index)}),s};function Wx(){const e=document.getElementById("beat-line-button-layer");if(!e){_.warn("rhythmUI","Cannot render rhythm UI without beat-line container",null,"ui");return}const t=Ox(e);if(t===null)return;const s=e.querySelector("#grouping-buttons-row"),i=e.querySelector("#boundary-buttons-row");Rx(e);const A=iv.getRhythmUIButtons();if(!Array.isArray(A)||A.length===0)return;const r=document.createDocumentFragment(),a=document.createDocumentFragment();A.forEach(l=>{l.type==="grouping"?r.appendChild(Nx(l,t)):l.type==="boundary"&&a.appendChild(Vx(l,t))}),s?s.appendChild(r):e.appendChild(r),i?i.appendChild(a):e.appendChild(a)}const Gx={getTimeSignatureOptions(){return{"Single Macrobeat":[{label:"1/4",groupings:[2],description:"one 2-beat"},{label:"2/8",groupings:[2],description:"one 2-beat"},{label:"3/8",groupings:[3],description:"one 3-beat"}],"Two Macrobeats":[{label:"2/4",groupings:[2,2],description:"two 2-beats"},{label:"4/8",groupings:[2,2],description:"two 2-beats"},{label:"5/8",groupings:[2,3],description:"2+3"},{label:"5/8",groupings:[3,2],description:"3+2"},{label:"6/8",groupings:[3,3],description:"two 3-beats"}],"Three Macrobeats":[{label:"3/4",groupings:[2,2,2],description:"three 2-beats"},{label:"7/8",groupings:[2,2,3],description:"2+2+3"},{label:"7/8",groupings:[3,2,2],description:"3+2+2"},{label:"7/8",groupings:[2,3,2],description:"2+3+2"},{label:"8/8",groupings:[3,3,2],description:"3+3+2"},{label:"8/8",groupings:[3,2,3],description:"3+2+3"},{label:"8/8",groupings:[2,3,3],description:"2+3+3"},{label:"9/8",groupings:[3,3,3],description:"three 3-beats"}],"Four Macrobeats":[{label:"4/4",groupings:[2,2,2,2],description:"four 2-beats"},{label:"10/8",groupings:[2,2,3,3],description:"2+2+3+3"},{label:"10/8",groupings:[2,3,2,3],description:"2+3+2+3"},{label:"10/8",groupings:[2,3,3,2],description:"2+3+3+2"},{label:"10/8",groupings:[3,2,3,2],description:"3+2+3+2"},{label:"10/8",groupings:[3,3,2,2],description:"3+3+2+2"},{label:"10/8",groupings:[3,2,2,3],description:"3+2+2+3"},{label:"11/8",groupings:[3,3,3,2],description:"3+3+3+2"},{label:"11/8",groupings:[3,3,2,3],description:"3+3+2+3"},{label:"11/8",groupings:[3,2,3,3],description:"3+2+3+3"},{label:"11/8",groupings:[2,3,3,3],description:"2+3+3+3"},{label:"12/8",groupings:[3,3,3,3],description:"four 3-beats"}],"Five Macrobeats":[{label:"5/4",groupings:[2,2,2,2,2],description:"five 2-beats"},{label:"11/8",groupings:[2,2,2,2,3],description:"2+2+2+2+3"},{label:"11/8",groupings:[2,2,2,3,2],description:"2+2+2+3+2"},{label:"11/8",groupings:[2,2,3,2,2],description:"2+2+3+2+2"},{label:"11/8",groupings:[2,3,2,2,2],description:"2+3+2+2+2"},{label:"11/8",groupings:[3,2,2,2,2],description:"3+2+2+2+2"},{label:"12/8",groupings:[2,2,2,3,3],description:"2+2+2+3+3"},{label:"12/8",groupings:[2,2,3,2,3],description:"2+2+3+2+3"},{label:"12/8",groupings:[2,2,3,3,2],description:"2+2+3+3+2"},{label:"12/8",groupings:[2,3,2,2,3],description:"2+3+2+2+3"},{label:"12/8",groupings:[2,3,2,3,2],description:"2+3+2+3+2"},{label:"12/8",groupings:[2,3,3,2,2],description:"2+3+3+2+2"},{label:"12/8",groupings:[3,2,2,2,3],description:"3+2+2+2+3"},{label:"12/8",groupings:[3,2,2,3,2],description:"3+2+2+3+2"},{label:"12/8",groupings:[3,2,3,2,2],description:"3+2+3+2+2"},{label:"12/8",groupings:[3,3,2,2,2],description:"3+3+2+2+2"},{label:"13/8",groupings:[3,2,2,3,3],description:"3+2+2+3+3"},{label:"13/8",groupings:[3,3,2,3,2],description:"3+3+2+3+2"},{label:"13/8",groupings:[3,3,3,2,2],description:"3+3+3+2+2"},{label:"15/8",groupings:[3,3,3,3,3],description:"five 3-beats"}]}},generateDropdownHTML(){const e=this.getTimeSignatureOptions();let t='<div id="time-signature-dropdown" class="time-signature-dropdown hidden">';return Object.entries(e).forEach(([s,i])=>{t+='<div class="dropdown-category">',t+=`<div class="dropdown-category-header">${s}</div>`,i.forEach((A,r)=>{const a=`${s}-${r}`;t+=`<div class="dropdown-option" data-groupings="${JSON.stringify(A.groupings)}" data-key="${a}">`,t+=`<span class="dropdown-label">${A.label}</span>`,t+=`<span class="dropdown-description">${A.description}</span>`,t+="</div>"}),t+="</div>"}),t+="</div>",t},getTimeSignatureLabel(e){const t=e.reduce((i,A)=>i+A,0);return e.includes(3)?`${t}/8`:`${t/2}/4`}};let rr=null;function Kx(){const e=document.getElementById("beat-line-button-layer");if(!e)return;const t=e.querySelector("#time-signature-row")||e;e.querySelectorAll(".time-signature-label").forEach(h=>h.remove());const i=document.getElementById("notation-grid");if(!i)return;const A=i.getBoundingClientRect(),r=e.getBoundingClientRect(),a=A.left-r.left;iv.getTimeSignatureSegments().forEach((h,u)=>{const m=document.createElement("div");m.className="time-signature-label",h.isAnacrusis&&m.classList.add("anacrusis-label"),m.textContent=h.label,m.style.position="absolute",m.style.left=`${a+h.centerX}px`,m.style.transform="translateX(-50%)",m.style.pointerEvents="auto",m.addEventListener("click",g=>{g.stopPropagation(),zx(m,u)}),t.appendChild(m)}),qx()}function qx(){if(!document.getElementById("time-signature-dropdown")){const e=Gx.generateDropdownHTML();document.body.insertAdjacentHTML("beforeend",e),document.getElementById("time-signature-dropdown").addEventListener("click",Xx)}}function zx(e,t){const s=document.getElementById("time-signature-dropdown");if(!s)return;s.dataset.measureIndex=t;const i=e.getBoundingClientRect();s.style.left=`${i.left}px`,s.style.top=`${i.bottom+5}px`;const A=s.getBoundingClientRect(),r=window.innerWidth,a=window.innerHeight;i.left+A.width>r&&(s.style.left=`${r-A.width-10}px`),i.bottom+A.height>a&&(s.style.top=`${i.top-A.height-5}px`),s.classList.remove("hidden"),rr={dropdown:s,measureIndex:t},setTimeout(()=>{document.addEventListener("click",$x,{once:!0})},0)}function $x(e){const t=document.getElementById("time-signature-dropdown");t&&!t.contains(e.target)&&(t.classList.add("hidden"),rr=null)}function Xx(e){const t=e.target.closest(".dropdown-option");if(!t)return;const s=t.dataset.groupings,i=parseInt(rr==null?void 0:rr.measureIndex,10);if(!(!s||Number.isNaN(i)))try{const A=JSON.parse(s);d.updateTimeSignature(i,A),document.getElementById("time-signature-dropdown").classList.add("hidden"),rr=null}catch{}}_.moduleLoaded("PitchGridController","grid");function Yx(){const e=Cf.getPitchContext();if(!e||!e.canvas){_.error("PitchGridController","Pitch grid context not available for rendering",null,"grid");return}const t=yt.getViewportInfo(),s={placedNotes:B_(d.state),placedTonicSigns:Ai(d.state),fullRowData:d.state.fullRowData,columnWidths:d.state.columnWidths,cellWidth:d.state.cellWidth,cellHeight:d.state.cellHeight,rowHeight:d.state.cellHeight*.5,macrobeatGroupings:d.state.macrobeatGroupings,macrobeatBoundaryStyles:d.state.macrobeatBoundaryStyles,colorMode:"color",degreeDisplayMode:d.state.degreeDisplayMode,zoomLevel:t.zoomLevel,viewportHeight:t.containerHeight};Lx(e,s)}const iA={render(){Yx()},renderMacrobeatTools(){Wx(),Kx()}};/*!
 * html2canvas 1.4.1 <https://html2canvas.hertzen.com>
 * Copyright (c) 2022 Niklas von Hertzen <https://hertzen.com>
 * Released under MIT License
 *//*! *****************************************************************************
Copyright (c) Microsoft Corporation.

Permission to use, copy, modify, and/or distribute this software for any
purpose with or without fee is hereby granted.

THE SOFTWARE IS PROVIDED "AS IS" AND THE AUTHOR DISCLAIMS ALL WARRANTIES WITH
REGARD TO THIS SOFTWARE INCLUDING ALL IMPLIED WARRANTIES OF MERCHANTABILITY
AND FITNESS. IN NO EVENT SHALL THE AUTHOR BE LIABLE FOR ANY SPECIAL, DIRECT,
INDIRECT, OR CONSEQUENTIAL DAMAGES OR ANY DAMAGES WHATSOEVER RESULTING FROM
LOSS OF USE, DATA OR PROFITS, WHETHER IN AN ACTION OF CONTRACT, NEGLIGENCE OR
OTHER TORTIOUS ACTION, ARISING OUT OF OR IN CONNECTION WITH THE USE OR
PERFORMANCE OF THIS SOFTWARE.
***************************************************************************** */var wd=function(e,t){return wd=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(s,i){s.__proto__=i}||function(s,i){for(var A in i)Object.prototype.hasOwnProperty.call(i,A)&&(s[A]=i[A])},wd(e,t)};function bn(e,t){if(typeof t!="function"&&t!==null)throw new TypeError("Class extends value "+String(t)+" is not a constructor or null");wd(e,t);function s(){this.constructor=e}e.prototype=t===null?Object.create(t):(s.prototype=t.prototype,new s)}var vd=function(){return vd=Object.assign||function(t){for(var s,i=1,A=arguments.length;i<A;i++){s=arguments[i];for(var r in s)Object.prototype.hasOwnProperty.call(s,r)&&(t[r]=s[r])}return t},vd.apply(this,arguments)};function _s(e,t,s,i){function A(r){return r instanceof s?r:new s(function(a){a(r)})}return new(s||(s=Promise))(function(r,a){function l(m){try{u(i.next(m))}catch(g){a(g)}}function h(m){try{u(i.throw(m))}catch(g){a(g)}}function u(m){m.done?r(m.value):A(m.value).then(l,h)}u((i=i.apply(e,[])).next())})}function gs(e,t){var s={label:0,sent:function(){if(r[0]&1)throw r[1];return r[1]},trys:[],ops:[]},i,A,r,a;return a={next:l(0),throw:l(1),return:l(2)},typeof Symbol=="function"&&(a[Symbol.iterator]=function(){return this}),a;function l(u){return function(m){return h([u,m])}}function h(u){if(i)throw new TypeError("Generator is already executing.");for(;s;)try{if(i=1,A&&(r=u[0]&2?A.return:u[0]?A.throw||((r=A.return)&&r.call(A),0):A.next)&&!(r=r.call(A,u[1])).done)return r;switch(A=0,r&&(u=[u[0]&2,r.value]),u[0]){case 0:case 1:r=u;break;case 4:return s.label++,{value:u[1],done:!1};case 5:s.label++,A=u[1],u=[0];continue;case 7:u=s.ops.pop(),s.trys.pop();continue;default:if(r=s.trys,!(r=r.length>0&&r[r.length-1])&&(u[0]===6||u[0]===2)){s=0;continue}if(u[0]===3&&(!r||u[1]>r[0]&&u[1]<r[3])){s.label=u[1];break}if(u[0]===6&&s.label<r[1]){s.label=r[1],r=u;break}if(r&&s.label<r[2]){s.label=r[2],s.ops.push(u);break}r[2]&&s.ops.pop(),s.trys.pop();continue}u=t.call(e,s)}catch(m){u=[6,m],A=0}finally{i=r=0}if(u[0]&5)throw u[1];return{value:u[0]?u[1]:void 0,done:!0}}}function Xa(e,t,s){if(arguments.length===2)for(var i=0,A=t.length,r;i<A;i++)(r||!(i in t))&&(r||(r=Array.prototype.slice.call(t,0,i)),r[i]=t[i]);return e.concat(r||t)}var ni=(function(){function e(t,s,i,A){this.left=t,this.top=s,this.width=i,this.height=A}return e.prototype.add=function(t,s,i,A){return new e(this.left+t,this.top+s,this.width+i,this.height+A)},e.fromClientRect=function(t,s){return new e(s.left+t.windowBounds.left,s.top+t.windowBounds.top,s.width,s.height)},e.fromDOMRectList=function(t,s){var i=Array.from(s).find(function(A){return A.width!==0});return i?new e(i.left+t.windowBounds.left,i.top+t.windowBounds.top,i.width,i.height):e.EMPTY},e.EMPTY=new e(0,0,0,0),e})(),yc=function(e,t){return ni.fromClientRect(e,t.getBoundingClientRect())},jx=function(e){var t=e.body,s=e.documentElement;if(!t||!s)throw new Error("Unable to get document size");var i=Math.max(Math.max(t.scrollWidth,s.scrollWidth),Math.max(t.offsetWidth,s.offsetWidth),Math.max(t.clientWidth,s.clientWidth)),A=Math.max(Math.max(t.scrollHeight,s.scrollHeight),Math.max(t.offsetHeight,s.offsetHeight),Math.max(t.clientHeight,s.clientHeight));return new ni(0,0,i,A)},Cc=function(e){for(var t=[],s=0,i=e.length;s<i;){var A=e.charCodeAt(s++);if(A>=55296&&A<=56319&&s<i){var r=e.charCodeAt(s++);(r&64512)===56320?t.push(((A&1023)<<10)+(r&1023)+65536):(t.push(A),s--)}else t.push(A)}return t},Re=function(){for(var e=[],t=0;t<arguments.length;t++)e[t]=arguments[t];if(String.fromCodePoint)return String.fromCodePoint.apply(String,e);var s=e.length;if(!s)return"";for(var i=[],A=-1,r="";++A<s;){var a=e[A];a<=65535?i.push(a):(a-=65536,i.push((a>>10)+55296,a%1024+56320)),(A+1===s||i.length>16384)&&(r+=String.fromCharCode.apply(String,i),i.length=0)}return r},Om="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/",Jx=typeof Uint8Array>"u"?[]:new Uint8Array(256);for(var Ya=0;Ya<Om.length;Ya++)Jx[Om.charCodeAt(Ya)]=Ya;var Nm="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/",Co=typeof Uint8Array>"u"?[]:new Uint8Array(256);for(var ja=0;ja<Nm.length;ja++)Co[Nm.charCodeAt(ja)]=ja;var Zx=function(e){var t=e.length*.75,s=e.length,i,A=0,r,a,l,h;e[e.length-1]==="="&&(t--,e[e.length-2]==="="&&t--);var u=typeof ArrayBuffer<"u"&&typeof Uint8Array<"u"&&typeof Uint8Array.prototype.slice<"u"?new ArrayBuffer(t):new Array(t),m=Array.isArray(u)?u:new Uint8Array(u);for(i=0;i<s;i+=4)r=Co[e.charCodeAt(i)],a=Co[e.charCodeAt(i+1)],l=Co[e.charCodeAt(i+2)],h=Co[e.charCodeAt(i+3)],m[A++]=r<<2|a>>4,m[A++]=(a&15)<<4|l>>2,m[A++]=(l&3)<<6|h&63;return u},t1=function(e){for(var t=e.length,s=[],i=0;i<t;i+=2)s.push(e[i+1]<<8|e[i]);return s},e1=function(e){for(var t=e.length,s=[],i=0;i<t;i+=4)s.push(e[i+3]<<24|e[i+2]<<16|e[i+1]<<8|e[i]);return s},aA=5,Ff=11,_u=2,s1=Ff-aA,Av=65536>>aA,n1=1<<aA,xu=n1-1,i1=1024>>aA,A1=Av+i1,r1=A1,o1=32,a1=r1+o1,l1=65536>>Ff,c1=1<<s1,h1=c1-1,Vm=function(e,t,s){return e.slice?e.slice(t,s):new Uint16Array(Array.prototype.slice.call(e,t,s))},u1=function(e,t,s){return e.slice?e.slice(t,s):new Uint32Array(Array.prototype.slice.call(e,t,s))},d1=function(e,t){var s=Zx(e),i=Array.isArray(s)?e1(s):new Uint32Array(s),A=Array.isArray(s)?t1(s):new Uint16Array(s),r=24,a=Vm(A,r/2,i[4]/2),l=i[5]===2?Vm(A,(r+i[4])/2):u1(i,Math.ceil((r+i[4])/4));return new f1(i[0],i[1],i[2],i[3],a,l)},f1=(function(){function e(t,s,i,A,r,a){this.initialValue=t,this.errorValue=s,this.highStart=i,this.highValueIndex=A,this.index=r,this.data=a}return e.prototype.get=function(t){var s;if(t>=0){if(t<55296||t>56319&&t<=65535)return s=this.index[t>>aA],s=(s<<_u)+(t&xu),this.data[s];if(t<=65535)return s=this.index[Av+(t-55296>>aA)],s=(s<<_u)+(t&xu),this.data[s];if(t<this.highStart)return s=a1-l1+(t>>Ff),s=this.index[s],s+=t>>aA&h1,s=this.index[s],s=(s<<_u)+(t&xu),this.data[s];if(t<=1114111)return this.data[this.highValueIndex]}return this.errorValue},e})(),Wm="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/",p1=typeof Uint8Array>"u"?[]:new Uint8Array(256);for(var Ja=0;Ja<Wm.length;Ja++)p1[Wm.charCodeAt(Ja)]=Ja;var m1="KwAAAAAAAAAACA4AUD0AADAgAAACAAAAAAAIABAAGABAAEgAUABYAGAAaABgAGgAYgBqAF8AZwBgAGgAcQB5AHUAfQCFAI0AlQCdAKIAqgCyALoAYABoAGAAaABgAGgAwgDKAGAAaADGAM4A0wDbAOEA6QDxAPkAAQEJAQ8BFwF1AH0AHAEkASwBNAE6AUIBQQFJAVEBWQFhAWgBcAF4ATAAgAGGAY4BlQGXAZ8BpwGvAbUBvQHFAc0B0wHbAeMB6wHxAfkBAQIJAvEBEQIZAiECKQIxAjgCQAJGAk4CVgJeAmQCbAJ0AnwCgQKJApECmQKgAqgCsAK4ArwCxAIwAMwC0wLbAjAA4wLrAvMC+AIAAwcDDwMwABcDHQMlAy0DNQN1AD0DQQNJA0kDSQNRA1EDVwNZA1kDdQB1AGEDdQBpA20DdQN1AHsDdQCBA4kDkQN1AHUAmQOhA3UAdQB1AHUAdQB1AHUAdQB1AHUAdQB1AHUAdQB1AHUAdQB1AKYDrgN1AHUAtgO+A8YDzgPWAxcD3gPjA+sD8wN1AHUA+wMDBAkEdQANBBUEHQQlBCoEFwMyBDgEYABABBcDSARQBFgEYARoBDAAcAQzAXgEgASIBJAEdQCXBHUAnwSnBK4EtgS6BMIEyAR1AHUAdQB1AHUAdQCVANAEYABgAGAAYABgAGAAYABgANgEYADcBOQEYADsBPQE/AQEBQwFFAUcBSQFLAU0BWQEPAVEBUsFUwVbBWAAYgVgAGoFcgV6BYIFigWRBWAAmQWfBaYFYABgAGAAYABgAKoFYACxBbAFuQW6BcEFwQXHBcEFwQXPBdMF2wXjBeoF8gX6BQIGCgYSBhoGIgYqBjIGOgZgAD4GRgZMBmAAUwZaBmAAYABgAGAAYABgAGAAYABgAGAAYABgAGIGYABpBnAGYABgAGAAYABgAGAAYABgAGAAYAB4Bn8GhQZgAGAAYAB1AHcDFQSLBmAAYABgAJMGdQA9A3UAmwajBqsGqwaVALMGuwbDBjAAywbSBtIG1QbSBtIG0gbSBtIG0gbdBuMG6wbzBvsGAwcLBxMHAwcbByMHJwcsBywHMQcsB9IGOAdAB0gHTgfSBkgHVgfSBtIG0gbSBtIG0gbSBtIG0gbSBiwHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAdgAGAALAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAdbB2MHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsB2kH0gZwB64EdQB1AHUAdQB1AHUAdQB1AHUHfQdgAIUHjQd1AHUAlQedB2AAYAClB6sHYACzB7YHvgfGB3UAzgfWBzMB3gfmB1EB7gf1B/0HlQENAQUIDQh1ABUIHQglCBcDLQg1CD0IRQhNCEEDUwh1AHUAdQBbCGMIZAhlCGYIZwhoCGkIYwhkCGUIZghnCGgIaQhjCGQIZQhmCGcIaAhpCGMIZAhlCGYIZwhoCGkIYwhkCGUIZghnCGgIaQhjCGQIZQhmCGcIaAhpCGMIZAhlCGYIZwhoCGkIYwhkCGUIZghnCGgIaQhjCGQIZQhmCGcIaAhpCGMIZAhlCGYIZwhoCGkIYwhkCGUIZghnCGgIaQhjCGQIZQhmCGcIaAhpCGMIZAhlCGYIZwhoCGkIYwhkCGUIZghnCGgIaQhjCGQIZQhmCGcIaAhpCGMIZAhlCGYIZwhoCGkIYwhkCGUIZghnCGgIaQhjCGQIZQhmCGcIaAhpCGMIZAhlCGYIZwhoCGkIYwhkCGUIZghnCGgIaQhjCGQIZQhmCGcIaAhpCGMIZAhlCGYIZwhoCGkIYwhkCGUIZghnCGgIaQhjCGQIZQhmCGcIaAhpCGMIZAhlCGYIZwhoCGkIYwhkCGUIZghnCGgIaQhjCGQIZQhmCGcIaAhpCGMIZAhlCGYIZwhoCGkIYwhkCGUIZghnCGgIaQhjCGQIZQhmCGcIaAhpCGMIZAhlCGYIZwhoCGkIYwhkCGUIZghnCGgIaQhjCGQIZQhmCGcIaAhpCGMIZAhlCGYIZwhoCGkIYwhkCGUIZghnCGgIaQhjCGQIZQhmCGcIaAhpCGMIZAhlCGYIZwhoCGkIYwhkCGUIZghnCGgIaQhjCGQIZQhmCGcIaAhpCGMIZAhlCGYIZwhoCGkIYwhkCGUIZghnCGgIaQhjCGQIZQhmCGcIaAhpCGMIZAhlCGYIZwhoCGkIYwhkCGUIZghnCGgIaQhjCGQIZQhmCGcIaAhpCGMIZAhlCGYIZwhoCGkIYwhkCGUIZghnCGgIaQhjCGQIZQhmCGcIaAhpCGMIZAhlCGYIZwhoCGkIYwhkCGUIZghnCGgIcAh3CHoIMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwAIIIggiCCIIIggiCCIIIggiCCIIIggiCCIIIggiCCIIIggiCCIIIggiCCIIIggiCCIIIggiCCIIIggiCCIIIgggwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAALAcsBywHLAcsBywHLAcsBywHLAcsB4oILAcsB44I0gaWCJ4Ipgh1AHUAqgiyCHUAdQB1AHUAdQB1AHUAdQB1AHUAtwh8AXUAvwh1AMUIyQjRCNkI4AjoCHUAdQB1AO4I9gj+CAYJDgkTCS0HGwkjCYIIggiCCIIIggiCCIIIggiCCIIIggiCCIIIggiCCIIIggiCCIIIggiCCIIIggiCCIIIggiCCIIIggiCCIIIggiAAIAAAAFAAYABgAGIAXwBgAHEAdQBFAJUAogCyAKAAYABgAEIA4ABGANMA4QDxAMEBDwE1AFwBLAE6AQEBUQF4QkhCmEKoQrhCgAHIQsAB0MLAAcABwAHAAeDC6ABoAHDCwMMAAcABwAHAAdDDGMMAAcAB6MM4wwjDWMNow3jDaABoAGgAaABoAGgAaABoAGgAaABoAGgAaABoAGgAaABoAGgAaABoAEjDqABWw6bDqABpg6gAaABoAHcDvwOPA+gAaABfA/8DvwO/A78DvwO/A78DvwO/A78DvwO/A78DvwO/A78DvwO/A78DvwO/A78DvwO/A78DvwO/A78DpcPAAcABwAHAAcABwAHAAcABwAHAAcABwAHAAcABwAHAAcABwAHAAcABwAHAAcABwAHAAcABwAHAAcABwAHAAcABwAHAAcABwAHAAcABwAHAAcABwAHAAcABwAHAAcABwAHAAcABwAHAAcABwAHAAcABwAHAAcABwAHAAcABwAHAAcABwAHAAcABwAHAAcABwAHAAcABwAHAAcABwAHAAcABwAHAAcABwAHAAcABwAHAAcABwAHAAcABwAHAAcABwAHAAcABwAHAAcABwAHAAcABwAHAAcABwAHAAcABwAHAAcABwAHAAcABwAHAAcABwAHAAcABwAHAAcABwAHAAcABwAHAAcABwAHAAcABwAHAAcABwAHAAcABwAHAAcABwAHAAcABwAHAAcABwAHAAcABwAHAAcABwAHAAcABwAHAAcABwAHAAcABwAHAAcABwAHAAcABwAHAAcABwAHAAcABwAHAAcABwAHAAcABwAHAAcABwAHAAcABwAHAAcABwAHAAcABwAHAAcABwAHAAcABwAHAAcABwAHAAcABwAHAAcABwAHAAcABwAHAAcABwAHAAcABwAHAAcABwAHAAcABwAHAAcABwAHAAcABwAHAAcABwAHAAcABwAHAAcABwAHAAcABwAHAAcABwAHAAcABwAHAAcABwAHAAcABwAHAAcABwAHAAcABwAHAAcABwAHAAcABwAHAAcABwAHAAcABwAHAAcABwAHAAcABwAHAAcABwAHAAcABwAHAAcABwAHAAcABwAHAAcABwAHAAcABwAHAAcABwAHAAcABwAHAAcABwAHAAcABwAHAAcABwAHAAcABwAHAAcABwAHAAcAB9cPKwkyCToJMAB1AHUAdQBCCUoJTQl1AFUJXAljCWcJawkwADAAMAAwAHMJdQB2CX4JdQCECYoJjgmWCXUAngkwAGAAYABxAHUApgn3A64JtAl1ALkJdQDACTAAMAAwADAAdQB1AHUAdQB1AHUAdQB1AHUAowYNBMUIMAAwADAAMADICcsJ0wnZCRUE4QkwAOkJ8An4CTAAMAB1AAAKvwh1AAgKDwoXCh8KdQAwACcKLgp1ADYKqAmICT4KRgowADAAdQB1AE4KMAB1AFYKdQBeCnUAZQowADAAMAAwADAAMAAwADAAMAAVBHUAbQowADAAdQC5CXUKMAAwAHwBxAijBogEMgF9CoQKiASMCpQKmgqIBKIKqgquCogEDQG2Cr4KxgrLCjAAMADTCtsKCgHjCusK8Qr5CgELMAAwADAAMAB1AIsECQsRC3UANAEZCzAAMAAwADAAMAB1ACELKQswAHUANAExCzkLdQBBC0kLMABRC1kLMAAwADAAMAAwADAAdQBhCzAAMAAwAGAAYABpC3ELdwt/CzAAMACHC4sLkwubC58Lpwt1AK4Ltgt1APsDMAAwADAAMAAwADAAMAAwAL4LwwvLC9IL1wvdCzAAMADlC+kL8Qv5C/8LSQswADAAMAAwADAAMAAwADAAMAAHDDAAMAAwADAAMAAODBYMHgx1AHUAdQB1AHUAdQB1AHUAdQB1AHUAdQB1AHUAdQB1AHUAdQB1AHUAdQB1AHUAdQB1AHUAdQB1ACYMMAAwADAAdQB1AHUALgx1AHUAdQB1AHUAdQA2DDAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwAHUAdQB1AHUAdQB1AHUAdQB1AHUAdQB1AHUAdQB1AHUAdQB1AD4MdQBGDHUAdQB1AHUAdQB1AEkMdQB1AHUAdQB1AFAMMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwAHUAdQB1AHUAdQB1AHUAdQB1AHUAdQB1AHUAdQBYDHUAdQB1AF8MMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAB1AHUAdQB1AHUAdQB1AHUAdQB1AHUAdQB1AHUAdQB1AHUA+wMVBGcMMAAwAHwBbwx1AHcMfwyHDI8MMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAYABgAJcMMAAwADAAdQB1AJ8MlQClDDAAMACtDCwHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsB7UMLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHdQB1AHUAdQB1AHUAdQB1AHUAdQB1AHUAdQB1AA0EMAC9DDAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAsBywHLAcsBywHLAcsBywHLQcwAMEMyAwsBywHLAcsBywHLAcsBywHLAcsBywHzAwwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwAHUAdQB1ANQM2QzhDDAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMABgAGAAYABgAGAAYABgAOkMYADxDGAA+AwADQYNYABhCWAAYAAODTAAMAAwADAAFg1gAGAAHg37AzAAMAAwADAAYABgACYNYAAsDTQNPA1gAEMNPg1LDWAAYABgAGAAYABgAGAAYABgAGAAUg1aDYsGVglhDV0NcQBnDW0NdQ15DWAAYABgAGAAYABgAGAAYABgAGAAYABgAGAAYABgAGAAlQCBDZUAiA2PDZcNMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAnw2nDTAAMAAwADAAMAAwAHUArw23DTAAMAAwADAAMAAwADAAMAAwADAAMAB1AL8NMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAB1AHUAdQB1AHUAdQDHDTAAYABgAM8NMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAA1w11ANwNMAAwAD0B5A0wADAAMAAwADAAMADsDfQN/A0EDgwOFA4wABsOMAAwADAAMAAwADAAMAAwANIG0gbSBtIG0gbSBtIG0gYjDigOwQUuDsEFMw7SBjoO0gbSBtIG0gbSBtIG0gbSBtIG0gbSBtIGQg5KDlIOVg7SBtIGXg5lDm0OdQ7SBtIGfQ6EDooOjQ6UDtIGmg6hDtIG0gaoDqwO0ga0DrwO0gZgAGAAYADEDmAAYAAkBtIGzA5gANIOYADaDokO0gbSBt8O5w7SBu8O0gb1DvwO0gZgAGAAxA7SBtIG0gbSBtIGYABgAGAAYAAED2AAsAUMD9IG0gbSBtIG0gbSBtIG0gbSBtIG0gbSBtIG0gbSBtIG0gbSBtIG0gbSBtIG0gbSBtIG0gbSBtIG0gbSBtIGFA8sBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAccD9IGLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHJA8sBywHLAcsBywHLAccDywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywPLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAc0D9IG0gbSBtIG0gbSBtIG0gbSBtIG0gbSBtIG0gbSBtIG0gbSBtIG0gbSBtIG0gbSBtIG0gbSBtIG0gbSBtIG0gbSBtIG0gbSBtIG0gbSBtIG0gbSBtIG0gbSBtIG0gbSBtIG0gbSBtIG0gbSBtIG0gbSBtIG0gbSBtIG0gbSBtIGLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAccD9IG0gbSBtIG0gbSBtIG0gbSBtIG0gbSBtIG0gbSBtIG0gbSBtIG0gbSBtIG0gbSBtIG0gbSBtIG0gbSBtIG0gbSBtIG0gbSBtIG0gbSBtIG0gbSBtIG0gbSBtIGFA8sBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHPA/SBtIG0gbSBtIG0gbSBtIG0gbSBtIG0gbSBtIG0gbSBtIG0gbSBtIG0gbSBtIG0gbSBtIG0gbSBtIG0gbSBtIG0gbSBtIG0gbSBtIG0gbSBtIG0gbSBtIG0gbSBtIG0gbSBtIG0gbSBtIG0gbSBtIG0gbSBtIG0gbSBtIG0gYUD0QPlQCVAJUAMAAwADAAMACVAJUAlQCVAJUAlQCVAEwPMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAA//8EAAQABAAEAAQABAAEAAQABAANAAMAAQABAAIABAAEAAQABAAEAAQABAAEAAQABAAEAAQABAAEAAQABAAEAAQACgATABcAHgAbABoAHgAXABYAEgAeABsAGAAPABgAHABLAEsASwBLAEsASwBLAEsASwBLABgAGAAeAB4AHgATAB4AUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQABYAGwASAB4AHgAeAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUAAWAA0AEQAeAAQAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAArACsAKwArACsAKwArACsAKwArACsAKwArACsAKwArACsAKwArACsAKwArACsAKwArACsAKwArACsAKwArACsAKwArACsAKwArACsAKwArACsAKwArACsAKwArACsAKwArACsAKwArACsAKwArACsAKwArACsAKwArACsAKwArAAQABAAEAAQABAAFAAQABAAEAAQABAAEAAQABAAEAAQABAAEAAQABAAEAAQABAAEAAQABAAEAAQABAAEAAQABAAJABYAGgAbABsAGwAeAB0AHQAeAE8AFwAeAA0AHgAeABoAGwBPAE8ADgBQAB0AHQAdAE8ATwAXAE8ATwBPABYAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAB0AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAdAFAAUABQAFAAUABQAFAAUAAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAFAAHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgBQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUAAeAB4AHgAeAFAATwBAAE8ATwBPAEAATwBQAFAATwBQAB4AHgAeAB4AHgAeAB0AHQAdAB0AHgAdAB4ADgBQAFAAUABQAFAAHgAeAB4AHgAeAB4AHgBQAB4AUAAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4ABAAEAAQABAAEAAQABAAEAAQABAAEAAQABAAEAAQABAAEAAQABAAEAAQABAAEAAQABAAEAAQABAAEAAQABAAEAAQABAAEAAQABAAEAAQABAAEAAQABAAEAAQABAAEAAQABAAEAAQABAAEAAQABAAEAAQABAAEAAQABAAEAAQABAAEAAQABAAJAAQABAAEAAQABAAEAAQABAAEAAQABAAEAAkACQAJAAkACQAJAAkABAAEAAQABAAEAAQABAAEAAQABAAEAAQABAAeAB4AHgAeAFAAHgAeAB4AKwArAFAAUABQAFAAGABQACsAKwArACsAHgAeAFAAHgBQAFAAUAArAFAAKwAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AKwAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4ABAAEAAQABAAEAAQABAAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgArAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUAArACsAUAAeAB4AHgAeAB4AHgBQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUAAYAA0AKwArAB4AHgAbACsABAAEAAQABAAEAAQABAAEAAQABAAEAAQABAAEAAQABAAEAAQABAAEAAQABAAEAAQABAAEAAQABAAEAAQABAAEAAQABAAEAAQABAAEAAQABAAEAAQABAAEAAQADQAEAB4ABAAEAB4ABAAEABMABAArACsAKwArACsAKwArACsAVgBWAFYAVgBWAFYAVgBWAFYAVgBWAFYAVgBWAFYAVgBWAFYAVgBWAFYAVgBWAFYAVgBWAFYAKwArACsAKwBWAFYAVgBWAB4AHgArACsAKwArACsAKwArACsAKwArACsAHgAeAB4AHgAeAB4AHgAeAB4AGgAaABoAGAAYAB4AHgAEAAQABAAEAAQABAAEAAQABAAEAAQAEwAEACsAEwATAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUAAEAAQABAAEAAQABAAEAAQABAAEAAQABAAEAAQABAAEAAQABAAEAAQABABLAEsASwBLAEsASwBLAEsASwBLABoAGQAZAB4AUABQAAQAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQABMAUAAEAAQABAAEAAQABAAEAB4AHgAEAAQABAAEAAQABABQAFAABAAEAB4ABAAEAAQABABQAFAASwBLAEsASwBLAEsASwBLAEsASwBQAFAAUAAeAB4AUAAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AKwAeAFAABABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUAAEAAQABAAEAAQABAAEAAQABAAEAAQABAAEAAQABAAEAAQABAAEACsAKwBQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAABAAEAAQABAAEAAQABAAEAAQABAAEAFAAKwArACsAKwArACsAKwArACsAKwArACsAKwArAEsASwBLAEsASwBLAEsASwBLAEsAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAABAAEAAQABAAEAAQABAAEAAQAUABQAB4AHgAYABMAUAArACsABAAbABsAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUAAEAAQABAAEAFAABAAEAAQABAAEAFAABAAEAAQAUAAEAAQABAAEAAQAKwArAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeACsAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUAAEAAQABAArACsAHgArAFAAUABQAFAAUABQAFAAUABQAFAAUAArACsAKwArACsAKwArACsAKwArACsAKwArACsAKwArACsAKwArACsAKwBQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUAArAFAAUABQAFAAUABQAFAAUABQAFAAKwArACsAKwArACsAKwArACsAKwArAAQABAAEAAQABAAEAAQABAAEAAQABAAEAAQABAAEAB4ABAAEAAQABAAEAAQABAAEAAQABAAEAAQABAAEAAQABAAEAAQABAAEAAQABAAEAAQABAAEAAQABAAEAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAAQABAAEAFAABAAEAAQABAAEAAQABAAEAAQABAAEAAQABAAEAAQABAAEAAQAUAAEAAQABAAEAAQABAAEAFAAUABQAFAAUABQAFAAUABQAFAABAAEAA0ADQBLAEsASwBLAEsASwBLAEsASwBLAB4AUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUAAEAAQABAArAFAAUABQAFAAUABQAFAAUAArACsAUABQACsAKwBQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAKwBQAFAAUABQAFAAUABQACsAUAArACsAKwBQAFAAUABQACsAKwAEAFAABAAEAAQABAAEAAQABAArACsABAAEACsAKwAEAAQABABQACsAKwArACsAKwArACsAKwAEACsAKwArACsAUABQACsAUABQAFAABAAEACsAKwBLAEsASwBLAEsASwBLAEsASwBLAFAAUAAaABoAUABQAFAAUABQAEwAHgAbAFAAHgAEACsAKwAEAAQABAArAFAAUABQAFAAUABQACsAKwArACsAUABQACsAKwBQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAKwBQAFAAUABQAFAAUABQACsAUABQACsAUABQACsAUABQACsAKwAEACsABAAEAAQABAAEACsAKwArACsABAAEACsAKwAEAAQABAArACsAKwAEACsAKwArACsAKwArACsAUABQAFAAUAArAFAAKwArACsAKwArACsAKwBLAEsASwBLAEsASwBLAEsASwBLAAQABABQAFAAUAAEAB4AKwArACsAKwArACsAKwArACsAKwAEAAQABAArAFAAUABQAFAAUABQAFAAUABQACsAUABQAFAAKwBQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAKwBQAFAAUABQAFAAUABQACsAUABQACsAUABQAFAAUABQACsAKwAEAFAABAAEAAQABAAEAAQABAAEACsABAAEAAQAKwAEAAQABAArACsAUAArACsAKwArACsAKwArACsAKwArACsAKwArACsAKwBQAFAABAAEACsAKwBLAEsASwBLAEsASwBLAEsASwBLAB4AGwArACsAKwArACsAKwArAFAABAAEAAQABAAEAAQAKwAEAAQABAArAFAAUABQAFAAUABQAFAAUAArACsAUABQACsAKwBQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAAQABAAEAAQABAArACsABAAEACsAKwAEAAQABAArACsAKwArACsAKwArAAQABAAEACsAKwArACsAUABQACsAUABQAFAABAAEACsAKwBLAEsASwBLAEsASwBLAEsASwBLAB4AUABQAFAAUABQAFAAUAArACsAKwArACsAKwArACsAKwArAAQAUAArAFAAUABQAFAAUABQACsAKwArAFAAUABQACsAUABQAFAAUAArACsAKwBQAFAAKwBQACsAUABQACsAKwArAFAAUAArACsAKwBQAFAAUAArACsAKwBQAFAAUABQAFAAUABQAFAAUABQAFAAUAArACsAKwArAAQABAAEAAQABAArACsAKwAEAAQABAArAAQABAAEAAQAKwArAFAAKwArACsAKwArACsABAArACsAKwArACsAKwArACsAKwArAEsASwBLAEsASwBLAEsASwBLAEsAUABQAFAAHgAeAB4AHgAeAB4AGwAeACsAKwArACsAKwAEAAQABAAEAAQAUABQAFAAUABQAFAAUABQACsAUABQAFAAKwBQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUAArAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAKwArACsAUAAEAAQABAAEAAQABAAEACsABAAEAAQAKwAEAAQABAAEACsAKwArACsAKwArACsABAAEACsAUABQAFAAKwArACsAKwArAFAAUAAEAAQAKwArAEsASwBLAEsASwBLAEsASwBLAEsAKwArACsAKwArACsAKwAOAFAAUABQAFAAUABQAFAAHgBQAAQABAAEAA4AUABQAFAAUABQAFAAUABQACsAUABQAFAAKwBQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUAArAFAAUABQAFAAUABQAFAAUABQAFAAKwBQAFAAUABQAFAAKwArAAQAUAAEAAQABAAEAAQABAAEACsABAAEAAQAKwAEAAQABAAEACsAKwArACsAKwArACsABAAEACsAKwArACsAKwArACsAUAArAFAAUAAEAAQAKwArAEsASwBLAEsASwBLAEsASwBLAEsAKwBQAFAAKwArACsAKwArACsAKwArACsAKwArACsAKwAEAAQABAAEAFAAUABQAFAAUABQAFAAUABQACsAUABQAFAAKwBQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAABAAEAFAABAAEAAQABAAEAAQABAArAAQABAAEACsABAAEAAQABABQAB4AKwArACsAKwBQAFAAUAAEAFAAUABQAFAAUABQAFAAUABQAFAABAAEACsAKwBLAEsASwBLAEsASwBLAEsASwBLAFAAUABQAFAAUABQAFAAUABQABoAUABQAFAAUABQAFAAKwAEAAQABAArAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQACsAKwArAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUAArAFAAUABQAFAAUABQAFAAUABQACsAUAArACsAUABQAFAAUABQAFAAUAArACsAKwAEACsAKwArACsABAAEAAQABAAEAAQAKwAEACsABAAEAAQABAAEAAQABAAEACsAKwArACsAKwArAEsASwBLAEsASwBLAEsASwBLAEsAKwArAAQABAAeACsAKwArACsAKwArACsAKwArACsAKwArAFwAXABcAFwAXABcAFwAXABcAFwAXABcAFwAXABcAFwAXABcAFwAXABcAFwAXABcAFwAXABcAFwAXABcAFwAXAAqAFwAXAAqACoAKgAqACoAKgAqACsAKwArACsAGwBcAFwAXABcAFwAXABcACoAKgAqACoAKgAqACoAKgAeAEsASwBLAEsASwBLAEsASwBLAEsADQANACsAKwArACsAKwBcAFwAKwBcACsAXABcAFwAXABcACsAXABcAFwAXABcAFwAXABcAFwAXABcAFwAXABcAFwAXABcAFwAXABcACsAXAArAFwAXABcAFwAXABcAFwAXABcAFwAKgBcAFwAKgAqACoAKgAqACoAKgAqACoAXAArACsAXABcAFwAXABcACsAXAArACoAKgAqACoAKgAqACsAKwBLAEsASwBLAEsASwBLAEsASwBLACsAKwBcAFwAXABcAFAADgAOAA4ADgAeAA4ADgAJAA4ADgANAAkAEwATABMAEwATAAkAHgATAB4AHgAeAAQABAAeAB4AHgAeAB4AHgBLAEsASwBLAEsASwBLAEsASwBLAFAAUABQAFAAUABQAFAAUABQAFAADQAEAB4ABAAeAAQAFgARABYAEQAEAAQAUABQAFAAUABQAFAAUABQACsAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAKwArACsAKwAEAAQABAAEAAQABAAEAAQABAAEAAQABAAEAAQADQAEAAQABAAEAAQADQAEAAQAUABQAFAAUABQAAQABAAEAAQABAAEAAQABAAEAAQABAArAAQABAAEAAQABAAEAAQABAAEAAQABAAEAAQABAAEAAQABAAEAAQABAAEAAQABAAEAAQABAAEAAQABAAEAAQABAArAA0ADQAeAB4AHgAeAB4AHgAEAB4AHgAeAB4AHgAeACsAHgAeAA4ADgANAA4AHgAeAB4AHgAeAAkACQArACsAKwArACsAXABcAFwAXABcAFwAXABcAFwAXABcAFwAXABcAFwAXABcAFwAXABcAFwAXABcAFwAXABcAFwAXABcAFwAXABcAFwAXABcACoAKgAqACoAKgAqACoAKgAqACoAKgAqACoAKgAqACoAKgAqACoAKgBcAEsASwBLAEsASwBLAEsASwBLAEsADQANAB4AHgAeAB4AXABcAFwAXABcAFwAKgAqACoAKgBcAFwAXABcACoAKgAqAFwAKgAqACoAXABcACoAKgAqACoAKgAqACoAXABcAFwAKgAqACoAKgBcAFwAXABcAFwAXABcAFwAXABcAFwAXABcACoAKgAqACoAKgAqACoAKgAqACoAKgAqAFwAKgBLAEsASwBLAEsASwBLAEsASwBLACoAKgAqACoAKgAqAFAAUABQAFAAUABQACsAUAArACsAKwArACsAUAArACsAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAHgBQAFAAUABQAFgAWABYAFgAWABYAFgAWABYAFgAWABYAFgAWABYAFgAWABYAFgAWABYAFgAWABYAFgAWABYAFgAWABYAFgAWABZAFkAWQBZAFkAWQBZAFkAWQBZAFkAWQBZAFkAWQBZAFkAWQBZAFkAWQBZAFkAWQBZAFkAWQBZAFkAWQBZAFkAWgBaAFoAWgBaAFoAWgBaAFoAWgBaAFoAWgBaAFoAWgBaAFoAWgBaAFoAWgBaAFoAWgBaAFoAWgBaAFoAWgBaAFAAUABQAFAAUABQAFAAUABQACsAUABQAFAAUAArACsAUABQAFAAUABQAFAAUAArAFAAKwBQAFAAUABQACsAKwBQAFAAUABQAFAAUABQAFAAUAArAFAAUABQAFAAKwArAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUAArAFAAUABQAFAAKwArAFAAUABQAFAAUABQAFAAKwBQACsAUABQAFAAUAArACsAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAKwBQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAKwBQAFAAUABQACsAKwBQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUAArACsABAAEAAQAHgANAB4AHgAeAB4AHgAeAB4AUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQACsAKwArAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAHgAeAB4AHgAeAB4AHgAeAB4AHgArACsAKwArACsAKwBQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQACsAKwBQAFAAUABQAFAAUAArACsADQBQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAHgAeAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUAANAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUAAWABEAKwArACsAUABQAFAAUABQAFAAUABQAFAAUABQAA0ADQANAFAAUABQAFAAUABQAFAAUABQAFAAUAArACsAKwArACsAKwArAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAKwBQAFAAUABQAAQABAAEACsAKwArACsAKwArACsAKwArACsAKwBQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUAAEAAQABAANAA0AKwArACsAKwArACsAKwArACsAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAABAAEACsAKwArACsAKwArACsAKwArACsAKwArAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAKwBQAFAAUAArAAQABAArACsAKwArACsAKwArACsAKwArACsAKwBcAFwAXABcAFwAXABcAFwAXABcAFwAXABcAFwAXABcAFwAXABcAFwAKgAqACoAKgAqACoAKgAqACoAKgAqACoAKgAqACoAKgAqACoAKgAqAA0ADQAVAFwADQAeAA0AGwBcACoAKwArAEsASwBLAEsASwBLAEsASwBLAEsAKwArACsAKwArACsAUABQAFAAUABQAFAAUABQAFAAUAArACsAKwArACsAKwAeAB4AEwATAA0ADQAOAB4AEwATAB4ABAAEAAQACQArAEsASwBLAEsASwBLAEsASwBLAEsAKwArACsAKwArACsAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUAArACsAKwArACsAKwArAFAAUABQAFAAUAAEAAQAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAAQAUAArACsAKwArACsAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUAArACsAKwArACsAKwArACsAKwArAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAKwAEAAQABAAEAAQABAAEAAQABAAEAAQABAArACsAKwArAAQABAAEAAQABAAEAAQABAAEAAQABAAEACsAKwArACsAHgArACsAKwATABMASwBLAEsASwBLAEsASwBLAEsASwBcAFwAXABcAFwAXABcAFwAXABcAFwAXABcAFwAXABcAFwAXAArACsAXABcAFwAXABcACsAKwArACsAKwArACsAKwArACsAKwBcAFwAXABcAFwAXABcAFwAXABcAFwAXAArACsAKwArAFwAXABcAFwAXABcAFwAXABcAFwAXABcAFwAXABcAFwAXABcACsAKwArACsAKwArAEsASwBLAEsASwBLAEsASwBLAEsAXAArACsAKwAqACoAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAAQABAAEAAQABAArACsAHgAeAFwAXABcAFwAXABcAFwAXABcAFwAXABcAFwAXABcAFwAXABcAFwAXABcACoAKgAqACoAKgAqACoAKgAqACoAKwAqACoAKgAqACoAKgAqACoAKgAqACoAKgAqACoAKgAqACoAKgAqACoAKgAqACoAKgAqACoAKgAqACoAKwArAAQASwBLAEsASwBLAEsASwBLAEsASwArACsAKwArACsAKwBLAEsASwBLAEsASwBLAEsASwBLACsAKwArACsAKwArACoAKgAqACoAKgAqACoAXAAqACoAKgAqACoAKgArACsABAAEAAQABAAEAAQABAAEAAQABAAEAAQABAAEAAQABAAEACsAKwArACsAKwArACsAKwArACsAKwArACsAKwArACsAKwArACsAKwArACsAKwArACsAKwArACsAKwArACsABAAEAAQABAAEAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAAQABAAEAAQABABQAFAAUABQAFAAUABQACsAKwArACsASwBLAEsASwBLAEsASwBLAEsASwANAA0AHgANAA0ADQANAB4AHgAeAB4AHgAeAB4AHgAeAB4ABAAEAAQABAAEAAQABAAEAAQAHgAeAB4AHgAeAB4AHgAeAB4AKwArACsABAAEAAQAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAABAAEAAQABAAEAAQABAAEAAQABAAEAAQABABQAFAASwBLAEsASwBLAEsASwBLAEsASwBQAFAAUABQAFAAUABQAFAABAAEAAQABAAEAAQABAAEAAQABAAEAAQABAAEACsAKwArACsAKwArACsAKwAeAB4AHgAeAFAAUABQAFAABAAEAAQABAAEAAQABAAEAAQABAAEAAQABAAEAAQABAAEAAQABAAEACsAKwArAA0ADQANAA0ADQBLAEsASwBLAEsASwBLAEsASwBLACsAKwArAFAAUABQAEsASwBLAEsASwBLAEsASwBLAEsAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAA0ADQBQAFAAUABQAFAAUABQAFAAUAArACsAKwArACsAKwArAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQACsAKwBQAFAAUAAeAB4AHgAeAB4AHgAeAB4AKwArACsAKwArACsAKwArAAQABAAEAB4ABAAEAAQABAAEAAQABAAEAAQABAAEAAQABABQAFAAUABQAAQAUABQAFAAUABQAFAABABQAFAABAAEAAQAUAArACsAKwArACsABAAEAAQABAAEAAQABAAEAAQABAAEAAQABAAEAAQABAAEAAQABAAEAAQABAAEAAQABAAEACsABAAEAAQABAAEAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AKwArAFAAUABQAFAAUABQACsAKwBQAFAAUABQAFAAUABQAFAAKwBQACsAUAArAFAAKwAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeACsAKwAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgArAB4AHgAeAB4AHgAeAB4AHgBQAB4AHgAeAFAAUABQACsAHgAeAB4AHgAeAB4AHgAeAB4AHgBQAFAAUABQACsAKwAeAB4AHgAeAB4AHgArAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AKwArAFAAUABQACsAHgAeAB4AHgAeAB4AHgAOAB4AKwANAA0ADQANAA0ADQANAAkADQANAA0ACAAEAAsABAAEAA0ACQANAA0ADAAdAB0AHgAXABcAFgAXABcAFwAWABcAHQAdAB4AHgAUABQAFAANAAEAAQAEAAQABAAEAAQACQAaABoAGgAaABoAGgAaABoAHgAXABcAHQAVABUAHgAeAB4AHgAeAB4AGAAWABEAFQAVABUAHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4ADQAeAA0ADQANAA0AHgANAA0ADQAHAB4AHgAeAB4AKwAEAAQABAAEAAQABAAEAAQABAAEAFAAUAArACsATwBQAFAAUABQAFAAHgAeAB4AFgARAE8AUABPAE8ATwBPAFAAUABQAFAAUAAeAB4AHgAWABEAKwBQAFAAUABQAFAAUABQAFAAUABQAFAAUABQACsAKwArABsAGwAbABsAGwAbABsAGgAbABsAGwAbABsAGwAbABsAGwAbABsAGwAbABsAGgAbABsAGwAbABoAGwAbABoAGwAbABsAGwAbABsAGwAbABsAGwAbABsAGwAbABsAGwAbAAQABAAEAAQABAAEAAQABAAEAAQABAAEAAQABAAEAAQAHgAeAFAAGgAeAB0AHgBQAB4AGgAeAB4AHgAeAB4AHgAeAB4AHgBPAB4AUAAbAB4AHgBQAFAAUABQAFAAHgAeAB4AHQAdAB4AUAAeAFAAHgBQAB4AUABPAFAAUAAeAB4AHgAeAB4AHgAeAFAAUABQAFAAUAAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAFAAHgBQAFAAUABQAE8ATwBQAFAAUABQAFAATwBQAFAATwBQAE8ATwBPAE8ATwBPAE8ATwBPAE8ATwBPAFAAUABQAFAATwBPAE8ATwBPAE8ATwBPAE8ATwBQAFAAUABQAFAAUABQAFAAUAAeAB4AUABQAFAAUABPAB4AHgArACsAKwArAB0AHQAdAB0AHQAdAB0AHQAdAB0AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB0AHgAdAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAdAB4AHQAdAB4AHgAeAB0AHQAeAB4AHQAeAB4AHgAdAB4AHQAbABsAHgAdAB4AHgAeAB4AHQAeAB4AHQAdAB0AHQAeAB4AHQAeAB0AHgAdAB0AHQAdAB0AHQAeAB0AHgAeAB4AHgAeAB0AHQAdAB0AHgAeAB4AHgAdAB0AHgAeAB4AHgAeAB4AHgAeAB4AHgAdAB4AHgAeAB0AHgAeAB4AHgAeAB0AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAdAB0AHgAeAB0AHQAdAB0AHgAeAB0AHQAeAB4AHQAdAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB0AHQAeAB4AHQAdAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHQAeAB4AHgAdAB4AHgAeAB4AHgAeAB4AHQAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB0AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AFAAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeABYAEQAWABEAHgAeAB4AHgAeAB4AHQAeAB4AHgAeAB4AHgAeACUAJQAeAB4AHgAeAB4AHgAeAB4AHgAWABEAHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AJQAlACUAJQAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgArACsAKwArACsAKwArACsAKwArACsAKwArACsAKwArACsAKwArACsAKwArACsAKwArAE8ATwBPAE8ATwBPAE8ATwBPAE8ATwBPAE8ATwBPAE8ATwBPAE8ATwBPAE8ATwBPAE8ATwBPAE8ATwBPAE8ATwAdAB0AHQAdAB0AHQAdAB0AHQAdAB0AHQAdAB0AHQAdAB0AHQAdAB0AHQAdAB0AHQAdAB0AHQAdAB0AHQAdAB0AHQAdAE8ATwBPAE8ATwBPAE8ATwBPAE8ATwBPAE8ATwBPAE8ATwBPAE8ATwBPAFAAHQAdAB0AHQAdAB0AHQAdAB0AHQAdAB0AHgAeAB4AHgAdAB0AHQAdAB0AHQAdAB0AHQAdAB0AHQAdAB0AHQAdAB0AHQAdAB0AHQAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHQAdAB0AHQAdAB0AHQAdAB0AHQAdAB0AHQAdAB0AHQAeAB4AHQAdAB0AHQAeAB4AHgAeAB4AHgAeAB4AHgAeAB0AHQAeAB0AHQAdAB0AHQAdAB0AHgAeAB4AHgAeAB4AHgAeAB0AHQAeAB4AHQAdAB4AHgAeAB4AHQAdAB4AHgAeAB4AHQAdAB0AHgAeAB0AHgAeAB0AHQAdAB0AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAdAB0AHQAdAB4AHgAeAB4AHgAeAB4AHgAeAB0AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAlACUAJQAlAB4AHQAdAB4AHgAdAB4AHgAeAB4AHQAdAB4AHgAeAB4AJQAlAB0AHQAlAB4AJQAlACUAIAAlACUAHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAlACUAJQAeAB4AHgAeAB0AHgAdAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAdAB0AHgAdAB0AHQAeAB0AJQAdAB0AHgAdAB0AHgAdAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeACUAHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHQAdAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAlACUAJQAlACUAJQAlACUAJQAlACUAJQAdAB0AHQAdACUAHgAlACUAJQAdACUAJQAdAB0AHQAlACUAHQAdACUAHQAdACUAJQAlAB4AHQAeAB4AHgAeAB0AHQAlAB0AHQAdAB0AHQAdACUAJQAlACUAJQAdACUAJQAgACUAHQAdACUAJQAlACUAJQAlACUAJQAeAB4AHgAlACUAIAAgACAAIAAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB0AHgAeAB4AFwAXABcAFwAXABcAHgATABMAJQAeAB4AHgAWABEAFgARABYAEQAWABEAFgARABYAEQAWABEATwBPAE8ATwBPAE8ATwBPAE8ATwBPAE8ATwBPAE8ATwBPAE8ATwBPAE8ATwAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeABYAEQAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAWABEAFgARABYAEQAWABEAFgARAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AFgARABYAEQAWABEAFgARABYAEQAWABEAFgARABYAEQAWABEAFgARABYAEQAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAWABEAFgARAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AFgARAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAdAB0AHQAdAB0AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgArACsAHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AKwAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AUABQAFAAUAAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAEAAQABAAeAB4AKwArACsAKwArABMADQANAA0AUAATAA0AUABQAFAAUABQAFAAUABQACsAKwArACsAKwArACsAUAANACsAKwArACsAKwArACsAKwArACsAKwArACsAKwAEAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUAArACsAKwArACsAKwArACsAKwBQAFAAUABQAFAAUABQACsAUABQAFAAUABQAFAAUAArAFAAUABQAFAAUABQAFAAKwBQAFAAUABQAFAAUABQACsAFwAXABcAFwAXABcAFwAXABcAFwAXABcAFwAXAA0ADQANAA0ADQANAA0ADQAeAA0AFgANAB4AHgAXABcAHgAeABcAFwAWABEAFgARABYAEQAWABEADQANAA0ADQATAFAADQANAB4ADQANAB4AHgAeAB4AHgAMAAwADQANAA0AHgANAA0AFgANAA0ADQANAA0ADQANAA0AHgANAB4ADQANAB4AHgAeACsAKwArACsAKwArACsAKwArACsAKwArACsAJQAlACUAJQAlACUAJQAlACUAJQAlACUAJQAlACUAJQAlACUAJQAlACUAJQAlACUAJQAlACsAJQAlACUAJQAlACUAJQAlACUAJQAlACUAJQAlACUAJQAlACUAJQAlACUAJQAlACUAJQAlACUAJQAlACUAJQAlACUAKwArACsAKwArACsAKwArACsAKwArACsAJQAlACUAJQAlACUAJQAlACUAJQAlACUAJQAlACUAJQAlACUAJQAlACUAJQArACsAKwArACsAKwArACsAKwArACsAKwArACsAKwArACsAKwAlACUAJQAlACUAJQAlACUAJQAlACUAJQArACsAKwArAA0AEQARACUAJQBHAFcAVwAWABEAFgARABYAEQAWABEAFgARACUAJQAWABEAFgARABYAEQAWABEAFQAWABEAEQAlAFcAVwBXAFcAVwBXAFcAVwBXAAQABAAEAAQABAAEACUAVwBXAFcAVwA2ACUAJQBXAFcAVwBHAEcAJQAlACUAKwBRAFcAUQBXAFEAVwBRAFcAUQBXAFcAVwBXAFcAVwBXAFcAVwBXAFcAVwBXAFcAVwBXAFcAVwBXAFcAVwBXAFcAVwBXAFEAVwBXAFcAVwBXAFcAVwBXAFcAVwBXAFcAVwBXAFcAVwBXAFcAVwBXAFcAVwBXAFcAVwBXAFcAVwBXAFcAVwBRAFcAUQBXAFEAVwBXAFcAVwBXAFcAUQBXAFcAVwBXAFcAVwBRAFEAKwArAAQABAAVABUARwBHAFcAFQBRAFcAUQBXAFEAVwBRAFcAUQBXAFcAVwBXAFcAVwBXAFcAVwBXAFcAVwBXAFcAVwBXAFcAVwBXAFcAVwBXAFcAVwBXAFEAVwBRAFcAUQBXAFcAVwBXAFcAVwBRAFcAVwBXAFcAVwBXAFEAUQBXAFcAVwBXABUAUQBHAEcAVwArACsAKwArACsAVwBXAFcAVwBXAFcAVwBXAFcAVwBXAFcAVwBXAFcAVwBXAFcAVwBXAFcAVwBXAFcAVwBXAFcAKwBXAFcAVwBXAFcAVwBXAFcAVwBXAFcAVwBXAFcAVwBXAFcAVwBXAFcAVwBXAFcAVwBXAFcAVwBXAFcAVwBXAFcAVwBXAFcAVwBXAFcAKwAlACUAVwBXAFcAVwAlACUAJQAlACUAJQAlACUAJQAlACsAKwArACsAKwArACsAKwArACsAKwArAFEAUQBRAFEAUQBRAFEAUQBRAFEAUQBRAFEAUQBRAFEAJQAlACUAJQAlACUAJQAlACUAJQAlACUAJQAlACUAJQAlACUAJQAlACUAJQAlACUAJQAlACUAJQAlACUAJQArAFcAVwBXAFcAVwBXAFcAVwBXAFcAJQAlACUAJQAlACUAJQAlACUAJQAlACUAJQAlACUAJQAlACUAJQAlACUAJQBPAE8ATwBPAE8ATwBPAE8AJQBXAFcAVwBXAFcAVwBXAFcAVwBXAFcAVwBXAFcAVwAlACUAJQAlACUAJQAlACUAJQAlACUAJQAlACUAJQAlACUAVwBXAFcAVwBXAFcAVwBXAFcAVwBXAFcAVwBXAFcAVwBXAFcAVwBXAFcAVwBXAFcAVwBXAFcAVwBXAFcAVwBXACUAJQAlAFcAVwBXAFcAVwBXAFcAVwBXAFcAVwBXAFcAVwBXAFcAVwBXAFcAVwBXAEcAVwBXAFcAVwBXAFcAVwBXAFcAVwBXAFcAVwBXAFcAKwArACsAJQAlACUAJQAlACUAJQAlACUAJQAlACUAJQAlACUAJQAlACUAJQArACsAKwArACsAKwArACsAKwBQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAADQATAA0AUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABLAEsASwBLAEsASwBLAEsASwBLAFAAUAArACsAKwArACsAKwArACsAKwArACsAKwArACsAKwArACsAKwArACsAHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAFAABAAEAAQABAAeAAQABAAEAAQABAAEAAQABAAEAAQAHgBQAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AUABQAAQABABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAAQABAAeAA0ADQANAA0ADQArACsAKwArACsAKwArACsAHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAFAAUABQAFAAUABQAFAAUABQAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AUAAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgBQAB4AHgAeAB4AHgAeAFAAHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgArACsAHgAeAB4AHgAeAB4AHgAeAB4AKwArACsAKwArACsAKwArACsAKwArACsAKwArACsAKwArACsAKwArACsAKwAeAB4AUABQAFAAUABQAFAAUABQAFAAUABQAAQAUABQAFAABABQAFAAUABQAAQAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAAQABAAEAAQABAAeAB4AHgAeAAQAKwArACsAUABQAFAAUABQAFAAHgAeABoAHgArACsAKwArACsAKwBQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAADgAOABMAEwArACsAKwArACsAKwArACsABAAEAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAAQABAAEAAQABAAEACsAKwArACsAKwArACsAKwANAA0ASwBLAEsASwBLAEsASwBLAEsASwArACsAKwArACsAKwAEAAQABAAEAAQABAAEAAQABAAEAAQABAAEAAQABAAEAAQABABQAFAAUABQAFAAUAAeAB4AHgBQAA4AUABQAAQAUABQAFAAUABQAFAABAAEAAQABAAEAAQABAAEAA0ADQBQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAAQABAAEAAQABAAEAAQABAAEAAQABAAEAAQAKwArACsAKwArACsAKwArACsAKwArAB4AWABYAFgAWABYAFgAWABYAFgAWABYAFgAWABYAFgAWABYAFgAWABYAFgAWABYAFgAWABYAFgAWABYACsAKwArAAQAHgAeAB4AHgAeAB4ADQANAA0AHgAeAB4AHgArAFAASwBLAEsASwBLAEsASwBLAEsASwArACsAKwArAB4AHgBcAFwAXABcAFwAKgBcAFwAXABcAFwAXABcAFwAXABcAEsASwBLAEsASwBLAEsASwBLAEsAXABcAFwAXABcACsAUABQAFAAUABQAFAAUABQAFAABAAEAAQABAAEAAQABAAEAAQABAAEAAQABAAEACsAKwArACsAKwArACsAKwArAFAAUABQAAQAUABQAFAAUABQAFAAUABQAAQABAArACsASwBLAEsASwBLAEsASwBLAEsASwArACsAHgANAA0ADQBcAFwAXABcAFwAXABcAFwAXABcAFwAXABcAFwAXABcAFwAXABcAFwAXABcAFwAKgAqACoAXAAqACoAKgBcAFwAXABcAFwAXABcAFwAXABcAFwAXABcAFwAXABcAFwAXAAqAFwAKgAqACoAXABcACoAKgBcAFwAXABcAFwAKgAqAFwAKgBcACsAKwArACsAKwArACsAKwArACsAKwArACsAKwArACsAKwArACsAKwArACsAKwArAFwAXABcACoAKgBQAFAAUABQAFAAUABQAFAAUABQAFAABAAEAAQABAAEAA0ADQBQAFAAUAAEAAQAKwArACsAKwArACsAKwArACsAKwBQAFAAUABQAFAAUAArACsAUABQAFAAUABQAFAAKwArAFAAUABQAFAAUABQACsAKwArACsAKwArACsAKwArAFAAUABQAFAAUABQAFAAKwBQAFAAUABQAFAAUABQACsAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAHgAeACsAKwArACsAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUAAEAAQABAAEAAQABAAEAAQADQAEAAQAKwArAEsASwBLAEsASwBLAEsASwBLAEsAKwArACsAKwArACsAVABVAFUAVQBVAFUAVQBVAFUAVQBVAFUAVQBVAFUAVQBVAFUAVQBVAFUAVQBVAFUAVQBVAFUAVQBUAFUAVQBVAFUAVQBVAFUAVQBVAFUAVQBVAFUAVQBVAFUAVQBVAFUAVQBVAFUAVQBVAFUAVQBVACsAKwArACsAKwArACsAKwArACsAKwArAFkAWQBZAFkAWQBZAFkAWQBZAFkAWQBZAFkAWQBZAFkAWQBZAFkAKwArACsAKwBaAFoAWgBaAFoAWgBaAFoAWgBaAFoAWgBaAFoAWgBaAFoAWgBaAFoAWgBaAFoAWgBaAFoAWgBaAFoAKwArACsAKwAGAAYABgAGAAYABgAGAAYABgAGAAYABgAGAAYABgAGAAYABgAGAAYABgAGAAYABgAGAAYABgAGAAYABgAGAAYAVwBXAFcAVwBXAFcAVwBXAFcAVwBXAFcAVwBXACUAJQBXAFcAVwBXAFcAVwBXAFcAVwBXAFcAVwBXAFcAVwBXAFcAVwBXAFcAVwBXAFcAVwBXAFcAJQAlACUAJQAlACUAUABQAFAAUABQAFAAUAArACsAKwArACsAKwArACsAKwArACsAKwBQAFAAUABQAFAAKwArACsAKwArAFYABABWAFYAVgBWAFYAVgBWAFYAVgBWAB4AVgBWAFYAVgBWAFYAVgBWAFYAVgBWAFYAVgArAFYAVgBWAFYAVgArAFYAKwBWAFYAKwBWAFYAKwBWAFYAVgBWAFYAVgBWAFYAVgBWAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AKwArACsAKwArACsAKwArACsAKwArACsAKwArACsAKwArAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAEQAWAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAKwArAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUAArACsAKwArACsAKwArACsAKwArACsAKwArACsAKwArACsAKwArACsAKwArACsAKwBQAFAAUABQAFAAUABQAFAAUABQAFAAUAAaAB4AKwArAAQABAAEAAQABAAEAAQABAAEAAQABAAEAAQABAAEAAQAGAARABEAGAAYABMAEwAWABEAFAArACsAKwArACsAKwAEAAQABAAEAAQABAAEAAQABAAEAAQABAAEAAQABAAEACUAJQAlACUAJQAWABEAFgARABYAEQAWABEAFgARABYAEQAlACUAFgARACUAJQAlACUAJQAlACUAEQAlABEAKwAVABUAEwATACUAFgARABYAEQAWABEAJQAlACUAJQAlACUAJQAlACsAJQAbABoAJQArACsAKwArAFAAUABQAFAAUAArAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAKwArAAcAKwATACUAJQAbABoAJQAlABYAEQAlACUAEQAlABEAJQBXAFcAVwBXAFcAVwBXAFcAVwBXABUAFQAlACUAJQATACUAVwBXAFcAVwBXAFcAVwBXAFcAVwBXAFcAVwBXAFcAVwBXAFcAVwBXAFcAVwBXAFcAVwBXABYAJQARACUAJQAlAFcAVwBXAFcAVwBXAFcAVwBXAFcAVwBXAFcAVwBXAFcAVwBXAFcAVwBXAFcAVwBXAFcAVwAWACUAEQAlABYAEQARABYAEQARABUAVwBRAFEAUQBRAFEAUQBRAFEAUQBRAFcAVwBXAFcAVwBXAFcAVwBXAFcAVwBXAFcAVwBXAFcAVwBXAFcAVwBXAFcAVwBXAFcAVwBXAFcAVwBXAFcAVwBXAEcARwArACsAVwBXAFcAVwBXAFcAKwArAFcAVwBXAFcAVwBXACsAKwBXAFcAVwBXAFcAVwArACsAVwBXAFcAKwArACsAGgAbACUAJQAlABsAGwArAB4AHgAeAB4AHgAeAB4AKwArACsAKwArACsAKwArACsAKwAEAAQABAAQAB0AKwArAFAAUABQAFAAUABQAFAAUABQAFAAUABQACsAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUAArAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAKwBQAFAAKwBQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUAArACsAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQACsAKwBQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUAArACsAKwArACsADQANAA0AKwArACsAKwBQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQACsAKwArAB4AHgAeAB4AHgAeAB4AHgAeAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgBQAFAAHgAeAB4AKwAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeACsAKwArACsAKwArACsAKwArACsAKwArACsAKwArACsAKwArACsAKwArACsAKwArACsAKwArACsAKwArACsAHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAAQAKwArAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUAArACsAKwArACsAKwArACsAKwArACsAKwArACsAKwAEAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQACsAKwArACsAKwArACsAKwArAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAKwArACsAKwArAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAABAAEAAQABAAEACsAKwArACsAKwBQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUAArAA0AUABQAFAAUAArACsAKwArAFAAUABQAFAAUABQAFAAUAANAFAAUABQAFAAUAArACsAKwArACsAKwArACsAKwArAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQACsAKwBQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAKwArACsAKwBQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQACsAKwArACsAKwArACsAKwBQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQACsAKwArACsAKwArACsAKwArACsAKwAeACsAKwArACsAKwArACsAKwArACsAKwArACsAKwArACsAUABQAFAAUABQAFAAKwArAFAAKwBQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUAArAFAAUAArACsAKwBQACsAKwBQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAKwANAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUAAeAB4AUABQAFAAUABQAFAAUAArACsAKwArACsAKwArAFAAUABQAFAAUABQAFAAUABQACsAKwArACsAKwArACsAKwArACsAKwArACsAKwArACsAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUAArAFAAUAArACsAKwArACsAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQACsAKwArAA0AUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQACsAKwArACsAKwAeAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQACsAKwArACsAUABQAFAAUABQAAQABAAEACsABAAEACsAKwArACsAKwAEAAQABAAEAFAAUABQAFAAKwBQAFAAUAArAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAKwArAAQABAAEACsAKwArACsABABQAFAAUABQAFAAUABQAFAAUAArACsAKwArACsAKwArAA0ADQANAA0ADQANAA0ADQAeACsAKwArACsAKwArACsAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUAAeAFAAUABQAFAAUABQAFAAUAAeAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAAQABAArACsAKwArAFAAUABQAFAAUAANAA0ADQANAA0ADQAUACsAKwArACsAKwArACsAKwArAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAKwArACsADQANAA0ADQANAA0ADQBQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUAArACsAKwArACsAKwArAB4AHgAeAB4AKwArACsAKwArACsAKwArACsAKwArACsAUABQAFAAUABQAFAAUAArACsAKwArACsAKwArACsAKwArACsAKwArACsAKwArAFAAUABQAFAAUABQAFAAUABQACsAKwArACsAKwArACsAKwArACsAKwArACsAKwArACsAKwArACsAKwArACsAKwBQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQACsAKwArACsAKwArACsAKwArACsAKwArACsAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUAArACsAKwArACsAKwArAFAAUABQAFAAUABQAAQABAAEAAQAKwArACsAKwArACsAKwArAEsASwBLAEsASwBLAEsASwBLAEsAKwArACsAKwArACsAUABQAFAAUABQAFAAUABQAFAAUAArAAQABAANACsAKwBQAFAAKwArACsAKwArACsAKwArACsAKwArACsAKwArAFAAUABQAFAAUABQAAQABAAEAAQABAAEAAQABAAEAAQABABQAFAAUABQAB4AHgAeAB4AHgArACsAKwArACsAKwAEAAQABAAEAAQABAAEAA0ADQAeAB4AHgAeAB4AKwArACsAKwBQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAEsASwBLAEsASwBLAEsASwBLAEsAKwArACsAKwArACsAKwArACsAKwArACsAKwArACsABABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAAQABAAEAAQABAAEAAQABAAEAAQABAAeAB4AHgANAA0ADQANACsAKwArACsAKwArACsAKwArACsAKwAeACsAKwBQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAKwArACsAKwArACsAKwBLAEsASwBLAEsASwBLAEsASwBLACsAKwArACsAKwArAFAAUABQAFAAUABQAFAABAAEAAQABAAEAAQABAAEAAQABAAEAAQABAAEACsASwBLAEsASwBLAEsASwBLAEsASwANAA0ADQANAFAABAAEAFAAKwArACsAKwArACsAKwArAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAABAAeAA4AUAArACsAKwArACsAKwArACsAKwAEAFAAUABQAFAADQANAB4ADQAEAAQABAAEAB4ABAAEAEsASwBLAEsASwBLAEsASwBLAEsAUAAOAFAADQANAA0AKwBQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAKwArACsAKwArACsAKwArACsAKwArAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQACsAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUAAEAAQABAAEAAQABAAEAAQABAAEAAQABAANAA0AHgANAA0AHgAEACsAUABQAFAAUABQAFAAUAArAFAAKwBQAFAAUABQACsAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAKwBQAFAAUABQAFAAUABQAFAAUABQAA0AKwArACsAKwArACsAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUAAEAAQABAAEAAQABAAEAAQABAAEAAQAKwArACsAKwArAEsASwBLAEsASwBLAEsASwBLAEsAKwArACsAKwArACsABAAEAAQABAArAFAAUABQAFAAUABQAFAAUAArACsAUABQACsAKwBQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAKwBQAFAAUABQAFAAUABQACsAUABQACsAUABQAFAAUABQACsABAAEAFAABAAEAAQABAAEAAQABAArACsABAAEACsAKwAEAAQABAArACsAUAArACsAKwArACsAKwAEACsAKwArACsAKwBQAFAAUABQAFAABAAEACsAKwAEAAQABAAEAAQABAAEACsAKwArAAQABAAEAAQABAArACsAKwArACsAKwArACsAKwArACsABAAEAAQABAAEAAQABABQAFAAUABQAA0ADQANAA0AHgBLAEsASwBLAEsASwBLAEsASwBLAA0ADQArAB4ABABQAFAAUAArACsAKwArACsAKwArACsAKwArACsAKwArACsAKwArACsAKwArACsAKwArACsAKwArACsAKwArACsAKwAEAAQABAAEAFAAUAAeAFAAKwArACsAKwArACsAKwArAEsASwBLAEsASwBLAEsASwBLAEsAKwArACsAKwArACsAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAABAAEAAQABAAEAAQABAArACsABAAEAAQABAAEAAQABAAEAAQADgANAA0AEwATAB4AHgAeAA0ADQANAA0ADQANAA0ADQANAA0ADQANAA0ADQANAFAAUABQAFAABAAEACsAKwAEAA0ADQAeAFAAKwArACsAKwArACsAKwArACsAKwArAEsASwBLAEsASwBLAEsASwBLAEsAKwArACsAKwArACsADgAOAA4ADgAOAA4ADgAOAA4ADgAOAA4ADgArACsAKwArACsAKwArACsAKwArACsAKwArACsAKwArACsAKwArAFAAUABQAFAAUABQAFAAUABQAFAAUAAEAAQABAAEAAQABAAEAAQABAAEAAQABAAEAFAAKwArACsAKwArACsAKwBLAEsASwBLAEsASwBLAEsASwBLACsAKwArACsAKwArACsAKwArACsAKwArACsAKwArACsAKwArACsAKwArACsAXABcAFwAXABcAFwAXABcAFwAXABcAFwAXABcAFwAXABcAFwAXABcAFwAXABcAFwAXABcAFwAKwArACoAKgAqACoAKgAqACoAKgAqACoAKgAqACoAKgAqACsAKwArACsASwBLAEsASwBLAEsASwBLAEsASwBcAFwADQANAA0AKgBQAFAAUABQAFAAUABQAFAAUABQAFAAUAAEAAQABAAEAAQABAAEAAQABAAEAAQABAAEAAQABAAeACsAKwArACsASwBLAEsASwBLAEsASwBLAEsASwBQAFAAUABQAFAAUABQAFAAUAArACsAKwArACsAKwArACsAKwArACsAKwBQAFAAUABQAFAAUABQAFAAKwArAFAAKwArAFAAUABQAFAAUABQAFAAUAArAFAAUAArAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAABAAEAAQABAAEAAQAKwAEAAQAKwArAAQABAAEAAQAUAAEAFAABAAEAA0ADQANACsAKwArACsAKwArACsAKwArAEsASwBLAEsASwBLAEsASwBLAEsAKwArACsAKwArACsAUABQAFAAUABQAFAAUABQACsAKwBQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAABAAEAAQABAAEAAQABAArACsABAAEAAQABAAEAAQABABQAA4AUAAEACsAKwArACsAKwArACsAKwArACsAKwArACsAKwArACsAKwArACsAKwArACsAKwArACsAKwArAFAABAAEAAQABAAEAAQABAAEAAQABABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUAAEAAQABAAEAAQABAAEAFAABAAEAAQABAAOAB4ADQANAA0ADQAOAB4ABAArACsAKwArACsAKwArACsAUAAEAAQABAAEAAQABAAEAAQABAAEAAQAUABQAFAAUABQAFAAUABQAFAAUAAEAAQABAAEAAQABAAEAAQABAAEAAQABAAEAAQABAAEAA0ADQANAFAADgAOAA4ADQANACsAKwArACsAKwArACsAKwArACsAKwArACsAKwArACsAKwArACsAKwArACsAKwArACsAKwArACsAKwBQAFAAUABQAFAAUABQAFAAUAArAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAABAAEAAQABAAEAAQABAAEACsABAAEAAQABAAEAAQABAAEAFAADQANAA0ADQANACsAKwArACsAKwArACsAKwArACsASwBLAEsASwBLAEsASwBLAEsASwBQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUAArACsAKwAOABMAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAKwArAAQABAAEAAQABAAEAAQABAAEAAQABAAEAAQABAArAAQABAAEAAQABAAEAAQABAAEAAQABAAEAAQABAArACsAKwArACsAKwArACsAKwBQAFAAUABQAFAAUABQACsAUABQACsAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUAAEAAQABAAEAAQABAArACsAKwAEACsABAAEACsABAAEAAQABAAEAAQABABQAAQAKwArACsAKwArACsAKwArAEsASwBLAEsASwBLAEsASwBLAEsAKwArACsAKwArACsAUABQAFAAUABQAFAAKwBQAFAAKwBQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUAAEAAQABAAEAAQAKwAEAAQAKwAEAAQABAAEAAQAUAArACsAKwArACsAKwArAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAABAAEAAQABAAeAB4AKwArACsAKwArACsAKwArACsAKwArACsAKwArACsAKwArACsAKwBQACsAKwArACsAKwArACsAKwArACsAKwArACsAKwArAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAB4AHgAeAB4AHgAeAB4AHgAaABoAGgAaAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgArACsAKwArACsAKwArACsAKwArACsAKwArAA0AUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQACsAKwArACsAKwArAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQACsADQANAA0ADQANACsAKwArACsAKwArACsAKwArACsAKwBQAFAAUABQACsAKwArACsAKwArACsAKwArACsAKwArACsAKwArACsAKwArACsAKwArACsAKwArACsAKwArACsAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAASABIAEgAQwBDAEMAUABQAFAAUABDAFAAUABQAEgAQwBIAEMAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAASABDAEMAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAKwAJAAkACQAJAAkACQAJABYAEQArACsAKwArACsAKwArAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABIAEMAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUAArACsAKwArACsAKwArACsAKwArACsAKwArACsAKwArACsAKwArACsAKwArACsAKwArAEsASwBLAEsASwBLAEsASwBLAEsAKwArACsAKwANAA0AKwArACsAKwArACsAKwArACsAKwArACsAKwArACsAKwBQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAKwArAAQABAAEAAQABAANACsAKwArACsAKwArACsAKwArACsAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUAAEAAQABAAEAAQABAAEAA0ADQANAB4AHgAeAB4AHgAeAFAAUABQAFAADQAeACsAKwArACsAKwArACsAKwArACsASwBLAEsASwBLAEsASwBLAEsASwArAFAAUABQAFAAUABQAFAAKwBQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUAArACsAKwArACsAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUAArACsAKwArACsAKwArACsAKwArACsAKwArACsAKwArAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUAANAA0AHgAeACsAKwArACsAKwBQAFAAUABQAFAAUABQAFAAUABQAFAAKwArACsAKwAEAFAABAAEAAQABAAEAAQABAAEAAQABAAEAAQABAAEAAQAKwArACsAKwArACsAKwAEAAQABAAEAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAARwBHABUARwAJACsAKwArACsAKwArACsAKwArACsAKwAEAAQAKwArACsAKwArACsAKwArACsAKwArACsAKwArAFcAVwBXAFcAVwBXAFcAVwBXAFcAVwBXAFcAVwBXAFcAVwBXAFcAVwBXAFcAVwBXACsAKwArACsAKwArACsAKwBXAFcAVwBXAFcAVwBXAFcAVwArACsAKwArACsAKwArACsAKwArACsAKwArACsAKwArACsAKwArACsAKwArACsAUQBRAFEAKwArACsAKwArACsAKwArACsAKwArACsAKwBRAFEAUQBRACsAKwArACsAKwArACsAKwBXAFcAVwBXAFcAVwBXAFcAVwBXAFcAVwBXAFcAVwBXAFcAVwBXAFcAVwBXAFcAVwBXAFcAVwBXACsAKwArACsAUABQAFAAUABQAFAAUABQAFAAUABQACsAKwArACsAKwBQAFAAUABQAFAAUABQAFAAUABQAFAAUABQACsAKwArACsAKwArACsAUABQAFAAUABQAFAAUABQAFAAUAArACsAHgAEAAQADQAEAAQABAAEACsAKwArACsAKwArACsAKwArACsAKwArACsAKwArACsAKwArACsAKwArACsAKwArACsAKwArACsAHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgArACsAKwArACsAKwArACsAKwArAB4AHgAeAB4AHgAeAB4AKwArAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAAQABAAEAAQABAAeAB4AHgAEAAQABAAEAAQABAAEAAQABAAEAAQABAAEAAQABAAEAAQABAAEAAQABAAEAB4AHgAEAAQABAAEAAQABAAEAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4ABAAEAAQABAAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4ABAAEAAQAHgArACsAKwArACsAKwArACsAKwArACsAKwArACsAKwArACsAKwArACsAKwArACsAKwArACsAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQACsAKwArACsAKwArACsAKwArACsAKwArAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgArACsAKwArACsAKwArACsAKwAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgArAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AKwBQAFAAKwArAFAAKwArAFAAUAArACsAUABQAFAAUAArAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeACsAUAArAFAAUABQAFAAUABQAFAAKwAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AKwBQAFAAUABQACsAKwBQAFAAUABQAFAAUABQAFAAKwBQAFAAUABQAFAAUABQACsAHgAeAFAAUABQAFAAUAArAFAAKwArACsAUABQAFAAUABQAFAAUAArAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AKwArAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAHgBQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgBQAFAAUABQAFAAUABQAFAAUABQAFAAHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgBQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAB4AHgAeAB4AHgAeAB4AHgAeACsAKwBLAEsASwBLAEsASwBLAEsASwBLAEsASwBLAEsASwBLAEsASwBLAEsASwBLAEsASwBLAEsASwBLAEsASwBLAEsASwBLAAQABAAEAAQABAAEAAQABAAEAAQABAAEAAQABAAEAAQABAAEAAQABAAEAAQABAAeAB4AHgAeAAQABAAEAAQABAAEAAQABAAEAAQABAAEAAQABAAeAB4AHgAeAB4AHgAeAB4ABAAeAB4AHgAeAB4AHgAeAB4AHgAeAAQAHgAeAA0ADQANAA0AHgArACsAKwArACsAKwArACsAKwArACsAKwArACsAKwAEAAQABAAEAAQAKwAEAAQABAAEAAQABAAEAAQABAAEAAQABAAEAAQABAArACsAKwArACsAKwArACsAKwArACsAKwArACsAKwArAAQABAAEAAQABAAEAAQAKwAEAAQABAAEAAQABAAEAAQABAAEAAQABAAEAAQABAAEAAQAKwArAAQABAAEAAQABAAEAAQAKwAEAAQAKwAEAAQABAAEAAQAKwArACsAKwArACsAKwArACsAKwArACsAKwArACsAKwArACsAKwArACsAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUAArACsAKwAEAAQABAAEAAQABAAEAFAAUABQAFAAUABQAFAAKwArAEsASwBLAEsASwBLAEsASwBLAEsAKwArACsAKwBQAB4AKwArACsAKwArACsAKwArACsAKwArACsAKwArACsAKwBQAFAAUABQAFAAUABQAFAAUABQAFAAUAAEAAQABAAEAEsASwBLAEsASwBLAEsASwBLAEsAKwArACsAKwArABsAUABQAFAAUABQACsAKwBQAFAAUABQAFAAUABQAFAAUAAEAAQABAAEAAQABAAEACsAKwArACsAKwArACsAKwArAB4AHgAeAB4ABAAEAAQABAAEAAQABABQACsAKwArACsASwBLAEsASwBLAEsASwBLAEsASwArACsAKwArABYAFgArACsAKwArACsAKwArACsAKwArACsAKwArACsAKwArACsAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAGgBQAFAAUAAaAFAAUABQAFAAKwArACsAKwArACsAKwArACsAKwArAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUAAeAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQACsAKwBQAFAAUABQACsAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAKwBQAFAAKwBQACsAKwBQACsAUABQAFAAUABQAFAAUABQAFAAUAArAFAAUABQAFAAKwBQACsAUAArACsAKwArACsAKwBQACsAKwArACsAUAArAFAAKwBQACsAUABQAFAAKwBQAFAAKwBQACsAKwBQACsAUAArAFAAKwBQACsAUAArAFAAUAArAFAAKwArAFAAUABQAFAAKwBQAFAAUABQAFAAUABQACsAUABQAFAAUAArAFAAUABQAFAAKwBQACsAUABQAFAAUABQAFAAUABQAFAAUAArAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUAArACsAKwArACsAUABQAFAAKwBQAFAAUABQAFAAKwBQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAKwArACsAKwArACsAKwArACsAKwArACsAKwArACsAKwAeAB4AKwArACsAKwArACsAKwArACsAKwArACsAKwArAE8ATwBPAE8ATwBPAE8ATwBPAE8ATwBPAE8AJQAlACUAHQAdAB0AHQAdAB0AHQAdAB0AHQAdAB0AHQAdAB0AHQAdAB0AHgAeAB0AHQAdAB0AHQAdAB0AHQAdAB0AHQAdAB0AHQAdAB0AHQAdAB4AHgAeACUAJQAlAB0AHQAdAB0AHQAdAB0AHQAdAB0AHQAdAB0AHQAdAB0AHQAlACUAJQAlACUAJQAlACUAJQAlACUAJQAlACUAJQAlACUAJQAlACUAJQApACkAKQApACkAKQApACkAKQApACkAKQApACkAKQApACkAKQApACkAKQApACkAKQApACkAJQAlACUAJQAlACAAJQAlACUAJQAlACUAJQAlACUAJQAlACUAJQAlACUAJQAlACUAJQAlACUAJQAeAB4AJQAlACUAJQAlACUAJQAlACUAJQAlACUAJQAlACUAJQAlACUAJQAlACUAJQAlAB4AHgAlACUAJQAlACUAHgAlACUAJQAlACUAIAAgACAAJQAlACAAJQAlACAAIAAgACUAJQAlACUAJQAlACUAJQAlACUAJQAlACUAJQAlACUAJQAlACUAJQAlACUAJQAlACUAJQAlACUAJQAlACEAIQAhACEAIQAlACUAIAAgACUAJQAgACAAIAAgACAAIAAgACAAIAAgACAAJQAlACUAJQAlACUAJQAlACUAJQAlACUAJQAlACUAJQAlACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAJQAlACUAIAAlACUAJQAlACAAIAAgACUAIAAgACAAJQAlACUAJQAlACUAJQAgACUAIAAlACUAJQAlACUAJQAlACUAJQAlACUAJQAlACUAHgAlAB4AJQAeACUAJQAlACUAJQAgACUAJQAlACUAHgAlAB4AHgAlACUAJQAlACUAJQAlACUAJQAlACUAJQAlAB4AHgAeAB4AHgAeAB4AJQAlACUAJQAlACUAJQAlACUAJQAlACUAJQAlACUAJQAeAB4AHgAeAB4AHgAeAB4AHgAeACUAJQAlACUAJQAlACUAJQAlACUAJQAlACUAHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAlACUAJQAlACUAJQAlACUAJQAlACUAJQAlACUAJQAlACUAJQAlACUAJQAlACAAIAAlACUAJQAlACAAJQAlACUAJQAlACUAJQAlACUAJQAlACUAJQAlACUAJQAlACAAJQAlACUAJQAgACAAJQAlACUAJQAlACUAJQAlACUAJQAlACUAJQAlACUAJQAlACUAJQAlACUAHgAeAB4AHgAeAB4AHgAeACUAJQAlACUAJQAlACUAJQAlACUAJQAlACUAJQAlACUAJQAlACUAJQAeAB4AHgAeAB4AHgAlACUAJQAlACUAJQAlACAAIAAgACUAJQAlACAAIAAgACAAIAAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeABcAFwAXABUAFQAVAB4AHgAeAB4AJQAlACUAIAAlACUAJQAlACUAJQAlACUAJQAlACUAJQAlACUAJQAlACAAIAAgACUAJQAlACUAJQAlACUAJQAlACAAJQAlACUAJQAlACUAJQAlACUAJQAlACAAJQAlACUAJQAlACUAJQAlACUAJQAlACUAJQAlACUAJQAlACUAJQAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AJQAlACUAJQAlACUAJQAlACUAJQAlACUAHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AJQAlACUAJQAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeACUAJQAlACUAJQAlACUAJQAeAB4AHgAeAB4AHgAeAB4AHgAeACUAJQAlACUAJQAlAB4AHgAeAB4AHgAeAB4AHgAlACUAJQAlACUAJQAlACUAHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAgACUAJQAgACUAJQAlACUAJQAlACUAJQAgACAAIAAgACAAIAAgACAAJQAlACUAJQAlACUAIAAlACUAJQAlACUAJQAlACUAJQAgACAAIAAgACAAIAAgACAAIAAgACUAJQAgACAAIAAlACUAJQAlACUAJQAlACUAJQAlACUAJQAlACUAJQAlACUAJQAlACUAJQAlACUAJQAgACUAJQAlACUAJQAlACUAJQAlACUAJQAlACUAJQAlACUAJQAlACUAJQAlACAAIAAlACAAIAAlACAAJQAlACUAJQAlACUAJQAlACUAJQAlACUAJQAgACAAIAAlACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAJQAlAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AKwAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgArACsAKwArACsAKwArACsAKwArACsAKwArACsAKwArAEsASwBLAEsASwBLAEsASwBLAEsAKwArACsAKwArACsAJQAlACUAJQAlACUAJQAlACUAJQAlACUAJQAlACUAJQAlACUAJQAlACUAJQAlACUAJQAlACUAJQAlACUAKwArAFcAVwBXAFcAVwBXAFcAVwBXAFcAVwBXAFcAVwBXAFcAVwBXAFcAVwBXAFcAVwBXAFcAVwBXAFcAVwBXACUAJQBXAFcAVwBXAFcAVwBXAFcAVwBXAFcAVwBXAFcAVwBXAFcAVwBXAFcAVwAlACUAJQAlACUAJQAlACUAJQAlACUAVwBXACUAJQAlACUAJQAlACUAJQAlACUAJQAlACUAJQBXAFcAVwBXAFcAVwBXAFcAVwBXAFcAVwBXAFcAVwBXAFcAJQAlACUAJQAlACUAJQAlACUAJQAlACUAJQAlACUAJQAlACUAJQAlACUAJQAlACUAJQAlACUAJQAlACUAJQBXAFcAVwBXAFcAVwBXAFcAVwBXAFcAJQAlACUAJQAlACUAJQAlACUAJQAlACUAJQAlACUAJQAlACUAJQAlACUAKwAEACsAKwArACsAKwArACsAKwArACsAKwArACsAKwArACsAKwArACsAKwArACsAKwArACsAKwArACsAKwArAAQABAAEAAQABAAEAAQABAAEAAQABAAEAAQABAAEAAQAKwArACsAKwArACsAKwArACsAKwArACsAKwArACsAKwArACsAKwArAA==",Gm=50,g1=1,rv=2,ov=3,w1=4,v1=5,Km=7,av=8,qm=9,Qi=10,Bd=11,zm=12,yd=13,B1=14,bo=15,Cd=16,Za=17,uo=18,y1=19,$m=20,bd=21,fo=22,Eu=23,qA=24,Vs=25,_o=26,xo=27,zA=28,C1=29,sA=30,b1=31,tl=32,el=33,_d=34,xd=35,Ed=36,Zo=37,Sd=38,Pl=39,kl=40,Su=41,lv=42,_1=43,x1=[9001,65288],cv="!",Xt="",sl="",Fd=d1(m1),$n=[sA,Ed],Td=[g1,rv,ov,v1],hv=[Qi,av],Xm=[xo,_o],E1=Td.concat(hv),Ym=[Sd,Pl,kl,_d,xd],S1=[bo,yd],F1=function(e,t){t===void 0&&(t="strict");var s=[],i=[],A=[];return e.forEach(function(r,a){var l=Fd.get(r);if(l>Gm?(A.push(!0),l-=Gm):A.push(!1),["normal","auto","loose"].indexOf(t)!==-1&&[8208,8211,12316,12448].indexOf(r)!==-1)return i.push(a),s.push(Cd);if(l===w1||l===Bd){if(a===0)return i.push(a),s.push(sA);var h=s[a-1];return E1.indexOf(h)===-1?(i.push(i[a-1]),s.push(h)):(i.push(a),s.push(sA))}if(i.push(a),l===b1)return s.push(t==="strict"?bd:Zo);if(l===lv||l===C1)return s.push(sA);if(l===_1)return r>=131072&&r<=196605||r>=196608&&r<=262141?s.push(Zo):s.push(sA);s.push(l)}),[i,s,A]},Fu=function(e,t,s,i){var A=i[s];if(Array.isArray(e)?e.indexOf(A)!==-1:e===A)for(var r=s;r<=i.length;){r++;var a=i[r];if(a===t)return!0;if(a!==Qi)break}if(A===Qi)for(var r=s;r>0;){r--;var l=i[r];if(Array.isArray(e)?e.indexOf(l)!==-1:e===l)for(var h=s;h<=i.length;){h++;var a=i[h];if(a===t)return!0;if(a!==Qi)break}if(l!==Qi)break}return!1},jm=function(e,t){for(var s=e;s>=0;){var i=t[s];if(i===Qi)s--;else return i}return 0},T1=function(e,t,s,i,A){if(s[i]===0)return Xt;var r=i-1;if(Array.isArray(A)&&A[r]===!0)return Xt;var a=r-1,l=r+1,h=t[r],u=a>=0?t[a]:0,m=t[l];if(h===rv&&m===ov)return Xt;if(Td.indexOf(h)!==-1)return cv;if(Td.indexOf(m)!==-1||hv.indexOf(m)!==-1)return Xt;if(jm(r,t)===av)return sl;if(Fd.get(e[r])===Bd||(h===tl||h===el)&&Fd.get(e[l])===Bd||h===Km||m===Km||h===qm||[Qi,yd,bo].indexOf(h)===-1&&m===qm||[Za,uo,y1,qA,zA].indexOf(m)!==-1||jm(r,t)===fo||Fu(Eu,fo,r,t)||Fu([Za,uo],bd,r,t)||Fu(zm,zm,r,t))return Xt;if(h===Qi)return sl;if(h===Eu||m===Eu)return Xt;if(m===Cd||h===Cd)return sl;if([yd,bo,bd].indexOf(m)!==-1||h===B1||u===Ed&&S1.indexOf(h)!==-1||h===zA&&m===Ed||m===$m||$n.indexOf(m)!==-1&&h===Vs||$n.indexOf(h)!==-1&&m===Vs||h===xo&&[Zo,tl,el].indexOf(m)!==-1||[Zo,tl,el].indexOf(h)!==-1&&m===_o||$n.indexOf(h)!==-1&&Xm.indexOf(m)!==-1||Xm.indexOf(h)!==-1&&$n.indexOf(m)!==-1||[xo,_o].indexOf(h)!==-1&&(m===Vs||[fo,bo].indexOf(m)!==-1&&t[l+1]===Vs)||[fo,bo].indexOf(h)!==-1&&m===Vs||h===Vs&&[Vs,zA,qA].indexOf(m)!==-1)return Xt;if([Vs,zA,qA,Za,uo].indexOf(m)!==-1)for(var g=r;g>=0;){var v=t[g];if(v===Vs)return Xt;if([zA,qA].indexOf(v)!==-1)g--;else break}if([xo,_o].indexOf(m)!==-1)for(var g=[Za,uo].indexOf(h)!==-1?a:r;g>=0;){var v=t[g];if(v===Vs)return Xt;if([zA,qA].indexOf(v)!==-1)g--;else break}if(Sd===h&&[Sd,Pl,_d,xd].indexOf(m)!==-1||[Pl,_d].indexOf(h)!==-1&&[Pl,kl].indexOf(m)!==-1||[kl,xd].indexOf(h)!==-1&&m===kl||Ym.indexOf(h)!==-1&&[$m,_o].indexOf(m)!==-1||Ym.indexOf(m)!==-1&&h===xo||$n.indexOf(h)!==-1&&$n.indexOf(m)!==-1||h===qA&&$n.indexOf(m)!==-1||$n.concat(Vs).indexOf(h)!==-1&&m===fo&&x1.indexOf(e[l])===-1||$n.concat(Vs).indexOf(m)!==-1&&h===uo)return Xt;if(h===Su&&m===Su){for(var y=s[r],C=1;y>0&&(y--,t[y]===Su);)C++;if(C%2!==0)return Xt}return h===tl&&m===el?Xt:sl},I1=function(e,t){t||(t={lineBreak:"normal",wordBreak:"normal"});var s=F1(e,t.lineBreak),i=s[0],A=s[1],r=s[2];(t.wordBreak==="break-all"||t.wordBreak==="break-word")&&(A=A.map(function(l){return[Vs,sA,lv].indexOf(l)!==-1?Zo:l}));var a=t.wordBreak==="keep-all"?r.map(function(l,h){return l&&e[h]>=19968&&e[h]<=40959}):void 0;return[i,A,a]},Q1=(function(){function e(t,s,i,A){this.codePoints=t,this.required=s===cv,this.start=i,this.end=A}return e.prototype.slice=function(){return Re.apply(void 0,this.codePoints.slice(this.start,this.end))},e})(),M1=function(e,t){var s=Cc(e),i=I1(s,t),A=i[0],r=i[1],a=i[2],l=s.length,h=0,u=0;return{next:function(){if(u>=l)return{done:!0,value:null};for(var m=Xt;u<l&&(m=T1(s,r,A,++u,a))===Xt;);if(m!==Xt||u===l){var g=new Q1(s,m,h,u);return h=u,{value:g,done:!1}}return{done:!0,value:null}}}},U1=1,P1=2,ha=4,Jm=8,Jl=10,Zm=47,Ho=92,k1=9,D1=32,nl=34,po=61,L1=35,H1=36,R1=37,il=39,Al=40,mo=41,O1=95,Qs=45,N1=33,V1=60,W1=62,G1=64,K1=91,q1=93,z1=61,$1=123,rl=63,X1=125,tg=124,Y1=126,j1=128,eg=65533,Tu=42,AA=43,J1=44,Z1=58,tE=59,ta=46,eE=0,sE=8,nE=11,iE=14,AE=31,rE=127,In=-1,uv=48,dv=97,fv=101,oE=102,aE=117,lE=122,pv=65,mv=69,gv=70,cE=85,hE=90,ws=function(e){return e>=uv&&e<=57},uE=function(e){return e>=55296&&e<=57343},$A=function(e){return ws(e)||e>=pv&&e<=gv||e>=dv&&e<=oE},dE=function(e){return e>=dv&&e<=lE},fE=function(e){return e>=pv&&e<=hE},pE=function(e){return dE(e)||fE(e)},mE=function(e){return e>=j1},ol=function(e){return e===Jl||e===k1||e===D1},Zl=function(e){return pE(e)||mE(e)||e===O1},sg=function(e){return Zl(e)||ws(e)||e===Qs},gE=function(e){return e>=eE&&e<=sE||e===nE||e>=iE&&e<=AE||e===rE},xi=function(e,t){return e!==Ho?!1:t!==Jl},al=function(e,t,s){return e===Qs?Zl(t)||xi(t,s):Zl(e)?!0:!!(e===Ho&&xi(e,t))},Iu=function(e,t,s){return e===AA||e===Qs?ws(t)?!0:t===ta&&ws(s):ws(e===ta?t:e)},wE=function(e){var t=0,s=1;(e[t]===AA||e[t]===Qs)&&(e[t]===Qs&&(s=-1),t++);for(var i=[];ws(e[t]);)i.push(e[t++]);var A=i.length?parseInt(Re.apply(void 0,i),10):0;e[t]===ta&&t++;for(var r=[];ws(e[t]);)r.push(e[t++]);var a=r.length,l=a?parseInt(Re.apply(void 0,r),10):0;(e[t]===mv||e[t]===fv)&&t++;var h=1;(e[t]===AA||e[t]===Qs)&&(e[t]===Qs&&(h=-1),t++);for(var u=[];ws(e[t]);)u.push(e[t++]);var m=u.length?parseInt(Re.apply(void 0,u),10):0;return s*(A+l*Math.pow(10,-a))*Math.pow(10,h*m)},vE={type:2},BE={type:3},yE={type:4},CE={type:13},bE={type:8},_E={type:21},xE={type:9},EE={type:10},SE={type:11},FE={type:12},TE={type:14},ll={type:23},IE={type:1},QE={type:25},ME={type:24},UE={type:26},PE={type:27},kE={type:28},DE={type:29},LE={type:31},Id={type:32},wv=(function(){function e(){this._value=[]}return e.prototype.write=function(t){this._value=this._value.concat(Cc(t))},e.prototype.read=function(){for(var t=[],s=this.consumeToken();s!==Id;)t.push(s),s=this.consumeToken();return t},e.prototype.consumeToken=function(){var t=this.consumeCodePoint();switch(t){case nl:return this.consumeStringToken(nl);case L1:var s=this.peekCodePoint(0),i=this.peekCodePoint(1),A=this.peekCodePoint(2);if(sg(s)||xi(i,A)){var r=al(s,i,A)?P1:U1,a=this.consumeName();return{type:5,value:a,flags:r}}break;case H1:if(this.peekCodePoint(0)===po)return this.consumeCodePoint(),CE;break;case il:return this.consumeStringToken(il);case Al:return vE;case mo:return BE;case Tu:if(this.peekCodePoint(0)===po)return this.consumeCodePoint(),TE;break;case AA:if(Iu(t,this.peekCodePoint(0),this.peekCodePoint(1)))return this.reconsumeCodePoint(t),this.consumeNumericToken();break;case J1:return yE;case Qs:var l=t,h=this.peekCodePoint(0),u=this.peekCodePoint(1);if(Iu(l,h,u))return this.reconsumeCodePoint(t),this.consumeNumericToken();if(al(l,h,u))return this.reconsumeCodePoint(t),this.consumeIdentLikeToken();if(h===Qs&&u===W1)return this.consumeCodePoint(),this.consumeCodePoint(),ME;break;case ta:if(Iu(t,this.peekCodePoint(0),this.peekCodePoint(1)))return this.reconsumeCodePoint(t),this.consumeNumericToken();break;case Zm:if(this.peekCodePoint(0)===Tu)for(this.consumeCodePoint();;){var m=this.consumeCodePoint();if(m===Tu&&(m=this.consumeCodePoint(),m===Zm))return this.consumeToken();if(m===In)return this.consumeToken()}break;case Z1:return UE;case tE:return PE;case V1:if(this.peekCodePoint(0)===N1&&this.peekCodePoint(1)===Qs&&this.peekCodePoint(2)===Qs)return this.consumeCodePoint(),this.consumeCodePoint(),QE;break;case G1:var g=this.peekCodePoint(0),v=this.peekCodePoint(1),y=this.peekCodePoint(2);if(al(g,v,y)){var a=this.consumeName();return{type:7,value:a}}break;case K1:return kE;case Ho:if(xi(t,this.peekCodePoint(0)))return this.reconsumeCodePoint(t),this.consumeIdentLikeToken();break;case q1:return DE;case z1:if(this.peekCodePoint(0)===po)return this.consumeCodePoint(),bE;break;case $1:return SE;case X1:return FE;case aE:case cE:var C=this.peekCodePoint(0),x=this.peekCodePoint(1);return C===AA&&($A(x)||x===rl)&&(this.consumeCodePoint(),this.consumeUnicodeRangeToken()),this.reconsumeCodePoint(t),this.consumeIdentLikeToken();case tg:if(this.peekCodePoint(0)===po)return this.consumeCodePoint(),xE;if(this.peekCodePoint(0)===tg)return this.consumeCodePoint(),_E;break;case Y1:if(this.peekCodePoint(0)===po)return this.consumeCodePoint(),EE;break;case In:return Id}return ol(t)?(this.consumeWhiteSpace(),LE):ws(t)?(this.reconsumeCodePoint(t),this.consumeNumericToken()):Zl(t)?(this.reconsumeCodePoint(t),this.consumeIdentLikeToken()):{type:6,value:Re(t)}},e.prototype.consumeCodePoint=function(){var t=this._value.shift();return typeof t>"u"?-1:t},e.prototype.reconsumeCodePoint=function(t){this._value.unshift(t)},e.prototype.peekCodePoint=function(t){return t>=this._value.length?-1:this._value[t]},e.prototype.consumeUnicodeRangeToken=function(){for(var t=[],s=this.consumeCodePoint();$A(s)&&t.length<6;)t.push(s),s=this.consumeCodePoint();for(var i=!1;s===rl&&t.length<6;)t.push(s),s=this.consumeCodePoint(),i=!0;if(i){var A=parseInt(Re.apply(void 0,t.map(function(h){return h===rl?uv:h})),16),r=parseInt(Re.apply(void 0,t.map(function(h){return h===rl?gv:h})),16);return{type:30,start:A,end:r}}var a=parseInt(Re.apply(void 0,t),16);if(this.peekCodePoint(0)===Qs&&$A(this.peekCodePoint(1))){this.consumeCodePoint(),s=this.consumeCodePoint();for(var l=[];$A(s)&&l.length<6;)l.push(s),s=this.consumeCodePoint();var r=parseInt(Re.apply(void 0,l),16);return{type:30,start:a,end:r}}else return{type:30,start:a,end:a}},e.prototype.consumeIdentLikeToken=function(){var t=this.consumeName();return t.toLowerCase()==="url"&&this.peekCodePoint(0)===Al?(this.consumeCodePoint(),this.consumeUrlToken()):this.peekCodePoint(0)===Al?(this.consumeCodePoint(),{type:19,value:t}):{type:20,value:t}},e.prototype.consumeUrlToken=function(){var t=[];if(this.consumeWhiteSpace(),this.peekCodePoint(0)===In)return{type:22,value:""};var s=this.peekCodePoint(0);if(s===il||s===nl){var i=this.consumeStringToken(this.consumeCodePoint());return i.type===0&&(this.consumeWhiteSpace(),this.peekCodePoint(0)===In||this.peekCodePoint(0)===mo)?(this.consumeCodePoint(),{type:22,value:i.value}):(this.consumeBadUrlRemnants(),ll)}for(;;){var A=this.consumeCodePoint();if(A===In||A===mo)return{type:22,value:Re.apply(void 0,t)};if(ol(A))return this.consumeWhiteSpace(),this.peekCodePoint(0)===In||this.peekCodePoint(0)===mo?(this.consumeCodePoint(),{type:22,value:Re.apply(void 0,t)}):(this.consumeBadUrlRemnants(),ll);if(A===nl||A===il||A===Al||gE(A))return this.consumeBadUrlRemnants(),ll;if(A===Ho)if(xi(A,this.peekCodePoint(0)))t.push(this.consumeEscapedCodePoint());else return this.consumeBadUrlRemnants(),ll;else t.push(A)}},e.prototype.consumeWhiteSpace=function(){for(;ol(this.peekCodePoint(0));)this.consumeCodePoint()},e.prototype.consumeBadUrlRemnants=function(){for(;;){var t=this.consumeCodePoint();if(t===mo||t===In)return;xi(t,this.peekCodePoint(0))&&this.consumeEscapedCodePoint()}},e.prototype.consumeStringSlice=function(t){for(var s=5e4,i="";t>0;){var A=Math.min(s,t);i+=Re.apply(void 0,this._value.splice(0,A)),t-=A}return this._value.shift(),i},e.prototype.consumeStringToken=function(t){var s="",i=0;do{var A=this._value[i];if(A===In||A===void 0||A===t)return s+=this.consumeStringSlice(i),{type:0,value:s};if(A===Jl)return this._value.splice(0,i),IE;if(A===Ho){var r=this._value[i+1];r!==In&&r!==void 0&&(r===Jl?(s+=this.consumeStringSlice(i),i=-1,this._value.shift()):xi(A,r)&&(s+=this.consumeStringSlice(i),s+=Re(this.consumeEscapedCodePoint()),i=-1))}i++}while(!0)},e.prototype.consumeNumber=function(){var t=[],s=ha,i=this.peekCodePoint(0);for((i===AA||i===Qs)&&t.push(this.consumeCodePoint());ws(this.peekCodePoint(0));)t.push(this.consumeCodePoint());i=this.peekCodePoint(0);var A=this.peekCodePoint(1);if(i===ta&&ws(A))for(t.push(this.consumeCodePoint(),this.consumeCodePoint()),s=Jm;ws(this.peekCodePoint(0));)t.push(this.consumeCodePoint());i=this.peekCodePoint(0),A=this.peekCodePoint(1);var r=this.peekCodePoint(2);if((i===mv||i===fv)&&((A===AA||A===Qs)&&ws(r)||ws(A)))for(t.push(this.consumeCodePoint(),this.consumeCodePoint()),s=Jm;ws(this.peekCodePoint(0));)t.push(this.consumeCodePoint());return[wE(t),s]},e.prototype.consumeNumericToken=function(){var t=this.consumeNumber(),s=t[0],i=t[1],A=this.peekCodePoint(0),r=this.peekCodePoint(1),a=this.peekCodePoint(2);if(al(A,r,a)){var l=this.consumeName();return{type:15,number:s,flags:i,unit:l}}return A===R1?(this.consumeCodePoint(),{type:16,number:s,flags:i}):{type:17,number:s,flags:i}},e.prototype.consumeEscapedCodePoint=function(){var t=this.consumeCodePoint();if($A(t)){for(var s=Re(t);$A(this.peekCodePoint(0))&&s.length<6;)s+=Re(this.consumeCodePoint());ol(this.peekCodePoint(0))&&this.consumeCodePoint();var i=parseInt(s,16);return i===0||uE(i)||i>1114111?eg:i}return t===In?eg:t},e.prototype.consumeName=function(){for(var t="";;){var s=this.consumeCodePoint();if(sg(s))t+=Re(s);else if(xi(s,this.peekCodePoint(0)))t+=Re(this.consumeEscapedCodePoint());else return this.reconsumeCodePoint(s),t}},e})(),vv=(function(){function e(t){this._tokens=t}return e.create=function(t){var s=new wv;return s.write(t),new e(s.read())},e.parseValue=function(t){return e.create(t).parseComponentValue()},e.parseValues=function(t){return e.create(t).parseComponentValues()},e.prototype.parseComponentValue=function(){for(var t=this.consumeToken();t.type===31;)t=this.consumeToken();if(t.type===32)throw new SyntaxError("Error parsing CSS component value, unexpected EOF");this.reconsumeToken(t);var s=this.consumeComponentValue();do t=this.consumeToken();while(t.type===31);if(t.type===32)return s;throw new SyntaxError("Error parsing CSS component value, multiple values found when expecting only one")},e.prototype.parseComponentValues=function(){for(var t=[];;){var s=this.consumeComponentValue();if(s.type===32)return t;t.push(s),t.push()}},e.prototype.consumeComponentValue=function(){var t=this.consumeToken();switch(t.type){case 11:case 28:case 2:return this.consumeSimpleBlock(t.type);case 19:return this.consumeFunction(t)}return t},e.prototype.consumeSimpleBlock=function(t){for(var s={type:t,values:[]},i=this.consumeToken();;){if(i.type===32||RE(i,t))return s;this.reconsumeToken(i),s.values.push(this.consumeComponentValue()),i=this.consumeToken()}},e.prototype.consumeFunction=function(t){for(var s={name:t.value,values:[],type:18};;){var i=this.consumeToken();if(i.type===32||i.type===3)return s;this.reconsumeToken(i),s.values.push(this.consumeComponentValue())}},e.prototype.consumeToken=function(){var t=this._tokens.shift();return typeof t>"u"?Id:t},e.prototype.reconsumeToken=function(t){this._tokens.unshift(t)},e})(),ua=function(e){return e.type===15},Fr=function(e){return e.type===17},ce=function(e){return e.type===20},HE=function(e){return e.type===0},Qd=function(e,t){return ce(e)&&e.value===t},Bv=function(e){return e.type!==31},xr=function(e){return e.type!==31&&e.type!==4},Dn=function(e){var t=[],s=[];return e.forEach(function(i){if(i.type===4){if(s.length===0)throw new Error("Error parsing function args, zero tokens for arg");t.push(s),s=[];return}i.type!==31&&s.push(i)}),s.length&&t.push(s),t},RE=function(e,t){return t===11&&e.type===12||t===28&&e.type===29?!0:t===2&&e.type===3},Ni=function(e){return e.type===17||e.type===15},We=function(e){return e.type===16||Ni(e)},yv=function(e){return e.length>1?[e[0],e[1]]:[e[0]]},ps={type:17,number:0,flags:ha},Tf={type:16,number:50,flags:ha},Mi={type:16,number:100,flags:ha},Eo=function(e,t,s){var i=e[0],A=e[1];return[ge(i,t),ge(typeof A<"u"?A:i,s)]},ge=function(e,t){if(e.type===16)return e.number/100*t;if(ua(e))switch(e.unit){case"rem":case"em":return 16*e.number;case"px":default:return e.number}return e.number},Cv="deg",bv="grad",_v="rad",xv="turn",bc={name:"angle",parse:function(e,t){if(t.type===15)switch(t.unit){case Cv:return Math.PI*t.number/180;case bv:return Math.PI/200*t.number;case _v:return t.number;case xv:return Math.PI*2*t.number}throw new Error("Unsupported angle type")}},Ev=function(e){return e.type===15&&(e.unit===Cv||e.unit===bv||e.unit===_v||e.unit===xv)},Sv=function(e){var t=e.filter(ce).map(function(s){return s.value}).join(" ");switch(t){case"to bottom right":case"to right bottom":case"left top":case"top left":return[ps,ps];case"to top":case"bottom":return sn(0);case"to bottom left":case"to left bottom":case"right top":case"top right":return[ps,Mi];case"to right":case"left":return sn(90);case"to top left":case"to left top":case"right bottom":case"bottom right":return[Mi,Mi];case"to bottom":case"top":return sn(180);case"to top right":case"to right top":case"left bottom":case"bottom left":return[Mi,ps];case"to left":case"right":return sn(270)}return 0},sn=function(e){return Math.PI*e/180},Li={name:"color",parse:function(e,t){if(t.type===18){var s=OE[t.name];if(typeof s>"u")throw new Error('Attempting to parse an unsupported color function "'+t.name+'"');return s(e,t.values)}if(t.type===5){if(t.value.length===3){var i=t.value.substring(0,1),A=t.value.substring(1,2),r=t.value.substring(2,3);return Ui(parseInt(i+i,16),parseInt(A+A,16),parseInt(r+r,16),1)}if(t.value.length===4){var i=t.value.substring(0,1),A=t.value.substring(1,2),r=t.value.substring(2,3),a=t.value.substring(3,4);return Ui(parseInt(i+i,16),parseInt(A+A,16),parseInt(r+r,16),parseInt(a+a,16)/255)}if(t.value.length===6){var i=t.value.substring(0,2),A=t.value.substring(2,4),r=t.value.substring(4,6);return Ui(parseInt(i,16),parseInt(A,16),parseInt(r,16),1)}if(t.value.length===8){var i=t.value.substring(0,2),A=t.value.substring(2,4),r=t.value.substring(4,6),a=t.value.substring(6,8);return Ui(parseInt(i,16),parseInt(A,16),parseInt(r,16),parseInt(a,16)/255)}}if(t.type===20){var l=ei[t.value.toUpperCase()];if(typeof l<"u")return l}return ei.TRANSPARENT}},Hi=function(e){return(255&e)===0},es=function(e){var t=255&e,s=255&e>>8,i=255&e>>16,A=255&e>>24;return t<255?"rgba("+A+","+i+","+s+","+t/255+")":"rgb("+A+","+i+","+s+")"},Ui=function(e,t,s,i){return(e<<24|t<<16|s<<8|Math.round(i*255)<<0)>>>0},ng=function(e,t){if(e.type===17)return e.number;if(e.type===16){var s=t===3?1:255;return t===3?e.number/100*s:Math.round(e.number/100*s)}return 0},ig=function(e,t){var s=t.filter(xr);if(s.length===3){var i=s.map(ng),A=i[0],r=i[1],a=i[2];return Ui(A,r,a,1)}if(s.length===4){var l=s.map(ng),A=l[0],r=l[1],a=l[2],h=l[3];return Ui(A,r,a,h)}return 0};function Qu(e,t,s){return s<0&&(s+=1),s>=1&&(s-=1),s<1/6?(t-e)*s*6+e:s<1/2?t:s<2/3?(t-e)*6*(2/3-s)+e:e}var Ag=function(e,t){var s=t.filter(xr),i=s[0],A=s[1],r=s[2],a=s[3],l=(i.type===17?sn(i.number):bc.parse(e,i))/(Math.PI*2),h=We(A)?A.number/100:0,u=We(r)?r.number/100:0,m=typeof a<"u"&&We(a)?ge(a,1):1;if(h===0)return Ui(u*255,u*255,u*255,1);var g=u<=.5?u*(h+1):u+h-u*h,v=u*2-g,y=Qu(v,g,l+1/3),C=Qu(v,g,l),x=Qu(v,g,l-1/3);return Ui(y*255,C*255,x*255,m)},OE={hsl:Ag,hsla:Ag,rgb:ig,rgba:ig},Ro=function(e,t){return Li.parse(e,vv.create(t).parseComponentValue())},ei={ALICEBLUE:4042850303,ANTIQUEWHITE:4209760255,AQUA:16777215,AQUAMARINE:2147472639,AZURE:4043309055,BEIGE:4126530815,BISQUE:4293182719,BLACK:255,BLANCHEDALMOND:4293643775,BLUE:65535,BLUEVIOLET:2318131967,BROWN:2771004159,BURLYWOOD:3736635391,CADETBLUE:1604231423,CHARTREUSE:2147418367,CHOCOLATE:3530104575,CORAL:4286533887,CORNFLOWERBLUE:1687547391,CORNSILK:4294499583,CRIMSON:3692313855,CYAN:16777215,DARKBLUE:35839,DARKCYAN:9145343,DARKGOLDENROD:3095837695,DARKGRAY:2846468607,DARKGREEN:6553855,DARKGREY:2846468607,DARKKHAKI:3182914559,DARKMAGENTA:2332068863,DARKOLIVEGREEN:1433087999,DARKORANGE:4287365375,DARKORCHID:2570243327,DARKRED:2332033279,DARKSALMON:3918953215,DARKSEAGREEN:2411499519,DARKSLATEBLUE:1211993087,DARKSLATEGRAY:793726975,DARKSLATEGREY:793726975,DARKTURQUOISE:13554175,DARKVIOLET:2483082239,DEEPPINK:4279538687,DEEPSKYBLUE:12582911,DIMGRAY:1768516095,DIMGREY:1768516095,DODGERBLUE:512819199,FIREBRICK:2988581631,FLORALWHITE:4294635775,FORESTGREEN:579543807,FUCHSIA:4278255615,GAINSBORO:3705462015,GHOSTWHITE:4177068031,GOLD:4292280575,GOLDENROD:3668254975,GRAY:2155905279,GREEN:8388863,GREENYELLOW:2919182335,GREY:2155905279,HONEYDEW:4043305215,HOTPINK:4285117695,INDIANRED:3445382399,INDIGO:1258324735,IVORY:4294963455,KHAKI:4041641215,LAVENDER:3873897215,LAVENDERBLUSH:4293981695,LAWNGREEN:2096890111,LEMONCHIFFON:4294626815,LIGHTBLUE:2916673279,LIGHTCORAL:4034953471,LIGHTCYAN:3774873599,LIGHTGOLDENRODYELLOW:4210742015,LIGHTGRAY:3553874943,LIGHTGREEN:2431553791,LIGHTGREY:3553874943,LIGHTPINK:4290167295,LIGHTSALMON:4288707327,LIGHTSEAGREEN:548580095,LIGHTSKYBLUE:2278488831,LIGHTSLATEGRAY:2005441023,LIGHTSLATEGREY:2005441023,LIGHTSTEELBLUE:2965692159,LIGHTYELLOW:4294959359,LIME:16711935,LIMEGREEN:852308735,LINEN:4210091775,MAGENTA:4278255615,MAROON:2147483903,MEDIUMAQUAMARINE:1724754687,MEDIUMBLUE:52735,MEDIUMORCHID:3126187007,MEDIUMPURPLE:2473647103,MEDIUMSEAGREEN:1018393087,MEDIUMSLATEBLUE:2070474495,MEDIUMSPRINGGREEN:16423679,MEDIUMTURQUOISE:1221709055,MEDIUMVIOLETRED:3340076543,MIDNIGHTBLUE:421097727,MINTCREAM:4127193855,MISTYROSE:4293190143,MOCCASIN:4293178879,NAVAJOWHITE:4292783615,NAVY:33023,OLDLACE:4260751103,OLIVE:2155872511,OLIVEDRAB:1804477439,ORANGE:4289003775,ORANGERED:4282712319,ORCHID:3664828159,PALEGOLDENROD:4008225535,PALEGREEN:2566625535,PALETURQUOISE:2951671551,PALEVIOLETRED:3681588223,PAPAYAWHIP:4293907967,PEACHPUFF:4292524543,PERU:3448061951,PINK:4290825215,PLUM:3718307327,POWDERBLUE:2967529215,PURPLE:2147516671,REBECCAPURPLE:1714657791,RED:4278190335,ROSYBROWN:3163525119,ROYALBLUE:1097458175,SADDLEBROWN:2336560127,SALMON:4202722047,SANDYBROWN:4104413439,SEAGREEN:780883967,SEASHELL:4294307583,SIENNA:2689740287,SILVER:3233857791,SKYBLUE:2278484991,SLATEBLUE:1784335871,SLATEGRAY:1887473919,SLATEGREY:1887473919,SNOW:4294638335,SPRINGGREEN:16744447,STEELBLUE:1182971135,TAN:3535047935,TEAL:8421631,THISTLE:3636451583,TOMATO:4284696575,TRANSPARENT:0,TURQUOISE:1088475391,VIOLET:4001558271,WHEAT:4125012991,WHITE:4294967295,WHITESMOKE:4126537215,YELLOW:4294902015,YELLOWGREEN:2597139199},NE={name:"background-clip",initialValue:"border-box",prefix:!1,type:1,parse:function(e,t){return t.map(function(s){if(ce(s))switch(s.value){case"padding-box":return 1;case"content-box":return 2}return 0})}},VE={name:"background-color",initialValue:"transparent",prefix:!1,type:3,format:"color"},_c=function(e,t){var s=Li.parse(e,t[0]),i=t[1];return i&&We(i)?{color:s,stop:i}:{color:s,stop:null}},rg=function(e,t){var s=e[0],i=e[e.length-1];s.stop===null&&(s.stop=ps),i.stop===null&&(i.stop=Mi);for(var A=[],r=0,a=0;a<e.length;a++){var l=e[a].stop;if(l!==null){var h=ge(l,t);h>r?A.push(h):A.push(r),r=h}else A.push(null)}for(var u=null,a=0;a<A.length;a++){var m=A[a];if(m===null)u===null&&(u=a);else if(u!==null){for(var g=a-u,v=A[u-1],y=(m-v)/(g+1),C=1;C<=g;C++)A[u+C-1]=y*C;u=null}}return e.map(function(x,F){var I=x.color;return{color:I,stop:Math.max(Math.min(1,A[F]/t),0)}})},WE=function(e,t,s){var i=t/2,A=s/2,r=ge(e[0],t)-i,a=A-ge(e[1],s);return(Math.atan2(a,r)+Math.PI*2)%(Math.PI*2)},GE=function(e,t,s){var i=typeof e=="number"?e:WE(e,t,s),A=Math.abs(t*Math.sin(i))+Math.abs(s*Math.cos(i)),r=t/2,a=s/2,l=A/2,h=Math.sin(i-Math.PI/2)*l,u=Math.cos(i-Math.PI/2)*l;return[A,r-u,r+u,a-h,a+h]},pn=function(e,t){return Math.sqrt(e*e+t*t)},og=function(e,t,s,i,A){var r=[[0,0],[0,t],[e,0],[e,t]];return r.reduce(function(a,l){var h=l[0],u=l[1],m=pn(s-h,i-u);return(A?m<a.optimumDistance:m>a.optimumDistance)?{optimumCorner:l,optimumDistance:m}:a},{optimumDistance:A?1/0:-1/0,optimumCorner:null}).optimumCorner},KE=function(e,t,s,i,A){var r=0,a=0;switch(e.size){case 0:e.shape===0?r=a=Math.min(Math.abs(t),Math.abs(t-i),Math.abs(s),Math.abs(s-A)):e.shape===1&&(r=Math.min(Math.abs(t),Math.abs(t-i)),a=Math.min(Math.abs(s),Math.abs(s-A)));break;case 2:if(e.shape===0)r=a=Math.min(pn(t,s),pn(t,s-A),pn(t-i,s),pn(t-i,s-A));else if(e.shape===1){var l=Math.min(Math.abs(s),Math.abs(s-A))/Math.min(Math.abs(t),Math.abs(t-i)),h=og(i,A,t,s,!0),u=h[0],m=h[1];r=pn(u-t,(m-s)/l),a=l*r}break;case 1:e.shape===0?r=a=Math.max(Math.abs(t),Math.abs(t-i),Math.abs(s),Math.abs(s-A)):e.shape===1&&(r=Math.max(Math.abs(t),Math.abs(t-i)),a=Math.max(Math.abs(s),Math.abs(s-A)));break;case 3:if(e.shape===0)r=a=Math.max(pn(t,s),pn(t,s-A),pn(t-i,s),pn(t-i,s-A));else if(e.shape===1){var l=Math.max(Math.abs(s),Math.abs(s-A))/Math.max(Math.abs(t),Math.abs(t-i)),g=og(i,A,t,s,!1),u=g[0],m=g[1];r=pn(u-t,(m-s)/l),a=l*r}break}return Array.isArray(e.size)&&(r=ge(e.size[0],i),a=e.size.length===2?ge(e.size[1],A):r),[r,a]},qE=function(e,t){var s=sn(180),i=[];return Dn(t).forEach(function(A,r){if(r===0){var a=A[0];if(a.type===20&&a.value==="to"){s=Sv(A);return}else if(Ev(a)){s=bc.parse(e,a);return}}var l=_c(e,A);i.push(l)}),{angle:s,stops:i,type:1}},cl=function(e,t){var s=sn(180),i=[];return Dn(t).forEach(function(A,r){if(r===0){var a=A[0];if(a.type===20&&["top","left","right","bottom"].indexOf(a.value)!==-1){s=Sv(A);return}else if(Ev(a)){s=(bc.parse(e,a)+sn(270))%sn(360);return}}var l=_c(e,A);i.push(l)}),{angle:s,stops:i,type:1}},zE=function(e,t){var s=sn(180),i=[],A=1,r=0,a=3,l=[];return Dn(t).forEach(function(h,u){var m=h[0];if(u===0){if(ce(m)&&m.value==="linear"){A=1;return}else if(ce(m)&&m.value==="radial"){A=2;return}}if(m.type===18){if(m.name==="from"){var g=Li.parse(e,m.values[0]);i.push({stop:ps,color:g})}else if(m.name==="to"){var g=Li.parse(e,m.values[0]);i.push({stop:Mi,color:g})}else if(m.name==="color-stop"){var v=m.values.filter(xr);if(v.length===2){var g=Li.parse(e,v[1]),y=v[0];Fr(y)&&i.push({stop:{type:16,number:y.number*100,flags:y.flags},color:g})}}}}),A===1?{angle:(s+sn(180))%sn(360),stops:i,type:A}:{size:a,shape:r,stops:i,position:l,type:A}},Fv="closest-side",Tv="farthest-side",Iv="closest-corner",Qv="farthest-corner",Mv="circle",Uv="ellipse",Pv="cover",kv="contain",$E=function(e,t){var s=0,i=3,A=[],r=[];return Dn(t).forEach(function(a,l){var h=!0;if(l===0){var u=!1;h=a.reduce(function(g,v){if(u)if(ce(v))switch(v.value){case"center":return r.push(Tf),g;case"top":case"left":return r.push(ps),g;case"right":case"bottom":return r.push(Mi),g}else(We(v)||Ni(v))&&r.push(v);else if(ce(v))switch(v.value){case Mv:return s=0,!1;case Uv:return s=1,!1;case"at":return u=!0,!1;case Fv:return i=0,!1;case Pv:case Tv:return i=1,!1;case kv:case Iv:return i=2,!1;case Qv:return i=3,!1}else if(Ni(v)||We(v))return Array.isArray(i)||(i=[]),i.push(v),!1;return g},h)}if(h){var m=_c(e,a);A.push(m)}}),{size:i,shape:s,stops:A,position:r,type:2}},hl=function(e,t){var s=0,i=3,A=[],r=[];return Dn(t).forEach(function(a,l){var h=!0;if(l===0?h=a.reduce(function(m,g){if(ce(g))switch(g.value){case"center":return r.push(Tf),!1;case"top":case"left":return r.push(ps),!1;case"right":case"bottom":return r.push(Mi),!1}else if(We(g)||Ni(g))return r.push(g),!1;return m},h):l===1&&(h=a.reduce(function(m,g){if(ce(g))switch(g.value){case Mv:return s=0,!1;case Uv:return s=1,!1;case kv:case Fv:return i=0,!1;case Tv:return i=1,!1;case Iv:return i=2,!1;case Pv:case Qv:return i=3,!1}else if(Ni(g)||We(g))return Array.isArray(i)||(i=[]),i.push(g),!1;return m},h)),h){var u=_c(e,a);A.push(u)}}),{size:i,shape:s,stops:A,position:r,type:2}},XE=function(e){return e.type===1},YE=function(e){return e.type===2},If={name:"image",parse:function(e,t){if(t.type===22){var s={url:t.value,type:0};return e.cache.addImage(t.value),s}if(t.type===18){var i=Dv[t.name];if(typeof i>"u")throw new Error('Attempting to parse an unsupported image function "'+t.name+'"');return i(e,t.values)}throw new Error("Unsupported image type "+t.type)}};function jE(e){return!(e.type===20&&e.value==="none")&&(e.type!==18||!!Dv[e.name])}var Dv={"linear-gradient":qE,"-moz-linear-gradient":cl,"-ms-linear-gradient":cl,"-o-linear-gradient":cl,"-webkit-linear-gradient":cl,"radial-gradient":$E,"-moz-radial-gradient":hl,"-ms-radial-gradient":hl,"-o-radial-gradient":hl,"-webkit-radial-gradient":hl,"-webkit-gradient":zE},JE={name:"background-image",initialValue:"none",type:1,prefix:!1,parse:function(e,t){if(t.length===0)return[];var s=t[0];return s.type===20&&s.value==="none"?[]:t.filter(function(i){return xr(i)&&jE(i)}).map(function(i){return If.parse(e,i)})}},ZE={name:"background-origin",initialValue:"border-box",prefix:!1,type:1,parse:function(e,t){return t.map(function(s){if(ce(s))switch(s.value){case"padding-box":return 1;case"content-box":return 2}return 0})}},tS={name:"background-position",initialValue:"0% 0%",type:1,prefix:!1,parse:function(e,t){return Dn(t).map(function(s){return s.filter(We)}).map(yv)}},eS={name:"background-repeat",initialValue:"repeat",prefix:!1,type:1,parse:function(e,t){return Dn(t).map(function(s){return s.filter(ce).map(function(i){return i.value}).join(" ")}).map(sS)}},sS=function(e){switch(e){case"no-repeat":return 1;case"repeat-x":case"repeat no-repeat":return 2;case"repeat-y":case"no-repeat repeat":return 3;case"repeat":default:return 0}},fr;(function(e){e.AUTO="auto",e.CONTAIN="contain",e.COVER="cover"})(fr||(fr={}));var nS={name:"background-size",initialValue:"0",prefix:!1,type:1,parse:function(e,t){return Dn(t).map(function(s){return s.filter(iS)})}},iS=function(e){return ce(e)||We(e)},xc=function(e){return{name:"border-"+e+"-color",initialValue:"transparent",prefix:!1,type:3,format:"color"}},AS=xc("top"),rS=xc("right"),oS=xc("bottom"),aS=xc("left"),Ec=function(e){return{name:"border-radius-"+e,initialValue:"0 0",prefix:!1,type:1,parse:function(t,s){return yv(s.filter(We))}}},lS=Ec("top-left"),cS=Ec("top-right"),hS=Ec("bottom-right"),uS=Ec("bottom-left"),Sc=function(e){return{name:"border-"+e+"-style",initialValue:"solid",prefix:!1,type:2,parse:function(t,s){switch(s){case"none":return 0;case"dashed":return 2;case"dotted":return 3;case"double":return 4}return 1}}},dS=Sc("top"),fS=Sc("right"),pS=Sc("bottom"),mS=Sc("left"),Fc=function(e){return{name:"border-"+e+"-width",initialValue:"0",type:0,prefix:!1,parse:function(t,s){return ua(s)?s.number:0}}},gS=Fc("top"),wS=Fc("right"),vS=Fc("bottom"),BS=Fc("left"),yS={name:"color",initialValue:"transparent",prefix:!1,type:3,format:"color"},CS={name:"direction",initialValue:"ltr",prefix:!1,type:2,parse:function(e,t){switch(t){case"rtl":return 1;case"ltr":default:return 0}}},bS={name:"display",initialValue:"inline-block",prefix:!1,type:1,parse:function(e,t){return t.filter(ce).reduce(function(s,i){return s|_S(i.value)},0)}},_S=function(e){switch(e){case"block":case"-webkit-box":return 2;case"inline":return 4;case"run-in":return 8;case"flow":return 16;case"flow-root":return 32;case"table":return 64;case"flex":case"-webkit-flex":return 128;case"grid":case"-ms-grid":return 256;case"ruby":return 512;case"subgrid":return 1024;case"list-item":return 2048;case"table-row-group":return 4096;case"table-header-group":return 8192;case"table-footer-group":return 16384;case"table-row":return 32768;case"table-cell":return 65536;case"table-column-group":return 131072;case"table-column":return 262144;case"table-caption":return 524288;case"ruby-base":return 1048576;case"ruby-text":return 2097152;case"ruby-base-container":return 4194304;case"ruby-text-container":return 8388608;case"contents":return 16777216;case"inline-block":return 33554432;case"inline-list-item":return 67108864;case"inline-table":return 134217728;case"inline-flex":return 268435456;case"inline-grid":return 536870912}return 0},xS={name:"float",initialValue:"none",prefix:!1,type:2,parse:function(e,t){switch(t){case"left":return 1;case"right":return 2;case"inline-start":return 3;case"inline-end":return 4}return 0}},ES={name:"letter-spacing",initialValue:"0",prefix:!1,type:0,parse:function(e,t){return t.type===20&&t.value==="normal"?0:t.type===17||t.type===15?t.number:0}},tc;(function(e){e.NORMAL="normal",e.STRICT="strict"})(tc||(tc={}));var SS={name:"line-break",initialValue:"normal",prefix:!1,type:2,parse:function(e,t){switch(t){case"strict":return tc.STRICT;case"normal":default:return tc.NORMAL}}},FS={name:"line-height",initialValue:"normal",prefix:!1,type:4},ag=function(e,t){return ce(e)&&e.value==="normal"?1.2*t:e.type===17?t*e.number:We(e)?ge(e,t):t},TS={name:"list-style-image",initialValue:"none",type:0,prefix:!1,parse:function(e,t){return t.type===20&&t.value==="none"?null:If.parse(e,t)}},IS={name:"list-style-position",initialValue:"outside",prefix:!1,type:2,parse:function(e,t){switch(t){case"inside":return 0;case"outside":default:return 1}}},Md={name:"list-style-type",initialValue:"none",prefix:!1,type:2,parse:function(e,t){switch(t){case"disc":return 0;case"circle":return 1;case"square":return 2;case"decimal":return 3;case"cjk-decimal":return 4;case"decimal-leading-zero":return 5;case"lower-roman":return 6;case"upper-roman":return 7;case"lower-greek":return 8;case"lower-alpha":return 9;case"upper-alpha":return 10;case"arabic-indic":return 11;case"armenian":return 12;case"bengali":return 13;case"cambodian":return 14;case"cjk-earthly-branch":return 15;case"cjk-heavenly-stem":return 16;case"cjk-ideographic":return 17;case"devanagari":return 18;case"ethiopic-numeric":return 19;case"georgian":return 20;case"gujarati":return 21;case"gurmukhi":return 22;case"hebrew":return 22;case"hiragana":return 23;case"hiragana-iroha":return 24;case"japanese-formal":return 25;case"japanese-informal":return 26;case"kannada":return 27;case"katakana":return 28;case"katakana-iroha":return 29;case"khmer":return 30;case"korean-hangul-formal":return 31;case"korean-hanja-formal":return 32;case"korean-hanja-informal":return 33;case"lao":return 34;case"lower-armenian":return 35;case"malayalam":return 36;case"mongolian":return 37;case"myanmar":return 38;case"oriya":return 39;case"persian":return 40;case"simp-chinese-formal":return 41;case"simp-chinese-informal":return 42;case"tamil":return 43;case"telugu":return 44;case"thai":return 45;case"tibetan":return 46;case"trad-chinese-formal":return 47;case"trad-chinese-informal":return 48;case"upper-armenian":return 49;case"disclosure-open":return 50;case"disclosure-closed":return 51;case"none":default:return-1}}},Tc=function(e){return{name:"margin-"+e,initialValue:"0",prefix:!1,type:4}},QS=Tc("top"),MS=Tc("right"),US=Tc("bottom"),PS=Tc("left"),kS={name:"overflow",initialValue:"visible",prefix:!1,type:1,parse:function(e,t){return t.filter(ce).map(function(s){switch(s.value){case"hidden":return 1;case"scroll":return 2;case"clip":return 3;case"auto":return 4;case"visible":default:return 0}})}},DS={name:"overflow-wrap",initialValue:"normal",prefix:!1,type:2,parse:function(e,t){switch(t){case"break-word":return"break-word";case"normal":default:return"normal"}}},Ic=function(e){return{name:"padding-"+e,initialValue:"0",prefix:!1,type:3,format:"length-percentage"}},LS=Ic("top"),HS=Ic("right"),RS=Ic("bottom"),OS=Ic("left"),NS={name:"text-align",initialValue:"left",prefix:!1,type:2,parse:function(e,t){switch(t){case"right":return 2;case"center":case"justify":return 1;case"left":default:return 0}}},VS={name:"position",initialValue:"static",prefix:!1,type:2,parse:function(e,t){switch(t){case"relative":return 1;case"absolute":return 2;case"fixed":return 3;case"sticky":return 4}return 0}},WS={name:"text-shadow",initialValue:"none",type:1,prefix:!1,parse:function(e,t){return t.length===1&&Qd(t[0],"none")?[]:Dn(t).map(function(s){for(var i={color:ei.TRANSPARENT,offsetX:ps,offsetY:ps,blur:ps},A=0,r=0;r<s.length;r++){var a=s[r];Ni(a)?(A===0?i.offsetX=a:A===1?i.offsetY=a:i.blur=a,A++):i.color=Li.parse(e,a)}return i})}},GS={name:"text-transform",initialValue:"none",prefix:!1,type:2,parse:function(e,t){switch(t){case"uppercase":return 2;case"lowercase":return 1;case"capitalize":return 3}return 0}},KS={name:"transform",initialValue:"none",prefix:!0,type:0,parse:function(e,t){if(t.type===20&&t.value==="none")return null;if(t.type===18){var s=$S[t.name];if(typeof s>"u")throw new Error('Attempting to parse an unsupported transform function "'+t.name+'"');return s(t.values)}return null}},qS=function(e){var t=e.filter(function(s){return s.type===17}).map(function(s){return s.number});return t.length===6?t:null},zS=function(e){var t=e.filter(function(h){return h.type===17}).map(function(h){return h.number}),s=t[0],i=t[1];t[2],t[3];var A=t[4],r=t[5];t[6],t[7],t[8],t[9],t[10],t[11];var a=t[12],l=t[13];return t[14],t[15],t.length===16?[s,i,A,r,a,l]:null},$S={matrix:qS,matrix3d:zS},lg={type:16,number:50,flags:ha},XS=[lg,lg],YS={name:"transform-origin",initialValue:"50% 50%",prefix:!0,type:1,parse:function(e,t){var s=t.filter(We);return s.length!==2?XS:[s[0],s[1]]}},jS={name:"visible",initialValue:"none",prefix:!1,type:2,parse:function(e,t){switch(t){case"hidden":return 1;case"collapse":return 2;case"visible":default:return 0}}},Oo;(function(e){e.NORMAL="normal",e.BREAK_ALL="break-all",e.KEEP_ALL="keep-all"})(Oo||(Oo={}));var JS={name:"word-break",initialValue:"normal",prefix:!1,type:2,parse:function(e,t){switch(t){case"break-all":return Oo.BREAK_ALL;case"keep-all":return Oo.KEEP_ALL;case"normal":default:return Oo.NORMAL}}},ZS={name:"z-index",initialValue:"auto",prefix:!1,type:0,parse:function(e,t){if(t.type===20)return{auto:!0,order:0};if(Fr(t))return{auto:!1,order:t.number};throw new Error("Invalid z-index number parsed")}},Lv={name:"time",parse:function(e,t){if(t.type===15)switch(t.unit.toLowerCase()){case"s":return 1e3*t.number;case"ms":return t.number}throw new Error("Unsupported time type")}},tF={name:"opacity",initialValue:"1",type:0,prefix:!1,parse:function(e,t){return Fr(t)?t.number:1}},eF={name:"text-decoration-color",initialValue:"transparent",prefix:!1,type:3,format:"color"},sF={name:"text-decoration-line",initialValue:"none",prefix:!1,type:1,parse:function(e,t){return t.filter(ce).map(function(s){switch(s.value){case"underline":return 1;case"overline":return 2;case"line-through":return 3;case"none":return 4}return 0}).filter(function(s){return s!==0})}},nF={name:"font-family",initialValue:"",prefix:!1,type:1,parse:function(e,t){var s=[],i=[];return t.forEach(function(A){switch(A.type){case 20:case 0:s.push(A.value);break;case 17:s.push(A.number.toString());break;case 4:i.push(s.join(" ")),s.length=0;break}}),s.length&&i.push(s.join(" ")),i.map(function(A){return A.indexOf(" ")===-1?A:"'"+A+"'"})}},iF={name:"font-size",initialValue:"0",prefix:!1,type:3,format:"length"},AF={name:"font-weight",initialValue:"normal",type:0,prefix:!1,parse:function(e,t){if(Fr(t))return t.number;if(ce(t))switch(t.value){case"bold":return 700;case"normal":default:return 400}return 400}},rF={name:"font-variant",initialValue:"none",type:1,prefix:!1,parse:function(e,t){return t.filter(ce).map(function(s){return s.value})}},oF={name:"font-style",initialValue:"normal",prefix:!1,type:2,parse:function(e,t){switch(t){case"oblique":return"oblique";case"italic":return"italic";case"normal":default:return"normal"}}},Ye=function(e,t){return(e&t)!==0},aF={name:"content",initialValue:"none",type:1,prefix:!1,parse:function(e,t){if(t.length===0)return[];var s=t[0];return s.type===20&&s.value==="none"?[]:t}},lF={name:"counter-increment",initialValue:"none",prefix:!0,type:1,parse:function(e,t){if(t.length===0)return null;var s=t[0];if(s.type===20&&s.value==="none")return null;for(var i=[],A=t.filter(Bv),r=0;r<A.length;r++){var a=A[r],l=A[r+1];if(a.type===20){var h=l&&Fr(l)?l.number:1;i.push({counter:a.value,increment:h})}}return i}},cF={name:"counter-reset",initialValue:"none",prefix:!0,type:1,parse:function(e,t){if(t.length===0)return[];for(var s=[],i=t.filter(Bv),A=0;A<i.length;A++){var r=i[A],a=i[A+1];if(ce(r)&&r.value!=="none"){var l=a&&Fr(a)?a.number:0;s.push({counter:r.value,reset:l})}}return s}},hF={name:"duration",initialValue:"0s",prefix:!1,type:1,parse:function(e,t){return t.filter(ua).map(function(s){return Lv.parse(e,s)})}},uF={name:"quotes",initialValue:"none",prefix:!0,type:1,parse:function(e,t){if(t.length===0)return null;var s=t[0];if(s.type===20&&s.value==="none")return null;var i=[],A=t.filter(HE);if(A.length%2!==0)return null;for(var r=0;r<A.length;r+=2){var a=A[r].value,l=A[r+1].value;i.push({open:a,close:l})}return i}},cg=function(e,t,s){if(!e)return"";var i=e[Math.min(t,e.length-1)];return i?s?i.open:i.close:""},dF={name:"box-shadow",initialValue:"none",type:1,prefix:!1,parse:function(e,t){return t.length===1&&Qd(t[0],"none")?[]:Dn(t).map(function(s){for(var i={color:255,offsetX:ps,offsetY:ps,blur:ps,spread:ps,inset:!1},A=0,r=0;r<s.length;r++){var a=s[r];Qd(a,"inset")?i.inset=!0:Ni(a)?(A===0?i.offsetX=a:A===1?i.offsetY=a:A===2?i.blur=a:i.spread=a,A++):i.color=Li.parse(e,a)}return i})}},fF={name:"paint-order",initialValue:"normal",prefix:!1,type:1,parse:function(e,t){var s=[0,1,2],i=[];return t.filter(ce).forEach(function(A){switch(A.value){case"stroke":i.push(1);break;case"fill":i.push(0);break;case"markers":i.push(2);break}}),s.forEach(function(A){i.indexOf(A)===-1&&i.push(A)}),i}},pF={name:"-webkit-text-stroke-color",initialValue:"currentcolor",prefix:!1,type:3,format:"color"},mF={name:"-webkit-text-stroke-width",initialValue:"0",type:0,prefix:!1,parse:function(e,t){return ua(t)?t.number:0}},gF=(function(){function e(t,s){var i,A;this.animationDuration=Ct(t,hF,s.animationDuration),this.backgroundClip=Ct(t,NE,s.backgroundClip),this.backgroundColor=Ct(t,VE,s.backgroundColor),this.backgroundImage=Ct(t,JE,s.backgroundImage),this.backgroundOrigin=Ct(t,ZE,s.backgroundOrigin),this.backgroundPosition=Ct(t,tS,s.backgroundPosition),this.backgroundRepeat=Ct(t,eS,s.backgroundRepeat),this.backgroundSize=Ct(t,nS,s.backgroundSize),this.borderTopColor=Ct(t,AS,s.borderTopColor),this.borderRightColor=Ct(t,rS,s.borderRightColor),this.borderBottomColor=Ct(t,oS,s.borderBottomColor),this.borderLeftColor=Ct(t,aS,s.borderLeftColor),this.borderTopLeftRadius=Ct(t,lS,s.borderTopLeftRadius),this.borderTopRightRadius=Ct(t,cS,s.borderTopRightRadius),this.borderBottomRightRadius=Ct(t,hS,s.borderBottomRightRadius),this.borderBottomLeftRadius=Ct(t,uS,s.borderBottomLeftRadius),this.borderTopStyle=Ct(t,dS,s.borderTopStyle),this.borderRightStyle=Ct(t,fS,s.borderRightStyle),this.borderBottomStyle=Ct(t,pS,s.borderBottomStyle),this.borderLeftStyle=Ct(t,mS,s.borderLeftStyle),this.borderTopWidth=Ct(t,gS,s.borderTopWidth),this.borderRightWidth=Ct(t,wS,s.borderRightWidth),this.borderBottomWidth=Ct(t,vS,s.borderBottomWidth),this.borderLeftWidth=Ct(t,BS,s.borderLeftWidth),this.boxShadow=Ct(t,dF,s.boxShadow),this.color=Ct(t,yS,s.color),this.direction=Ct(t,CS,s.direction),this.display=Ct(t,bS,s.display),this.float=Ct(t,xS,s.cssFloat),this.fontFamily=Ct(t,nF,s.fontFamily),this.fontSize=Ct(t,iF,s.fontSize),this.fontStyle=Ct(t,oF,s.fontStyle),this.fontVariant=Ct(t,rF,s.fontVariant),this.fontWeight=Ct(t,AF,s.fontWeight),this.letterSpacing=Ct(t,ES,s.letterSpacing),this.lineBreak=Ct(t,SS,s.lineBreak),this.lineHeight=Ct(t,FS,s.lineHeight),this.listStyleImage=Ct(t,TS,s.listStyleImage),this.listStylePosition=Ct(t,IS,s.listStylePosition),this.listStyleType=Ct(t,Md,s.listStyleType),this.marginTop=Ct(t,QS,s.marginTop),this.marginRight=Ct(t,MS,s.marginRight),this.marginBottom=Ct(t,US,s.marginBottom),this.marginLeft=Ct(t,PS,s.marginLeft),this.opacity=Ct(t,tF,s.opacity);var r=Ct(t,kS,s.overflow);this.overflowX=r[0],this.overflowY=r[r.length>1?1:0],this.overflowWrap=Ct(t,DS,s.overflowWrap),this.paddingTop=Ct(t,LS,s.paddingTop),this.paddingRight=Ct(t,HS,s.paddingRight),this.paddingBottom=Ct(t,RS,s.paddingBottom),this.paddingLeft=Ct(t,OS,s.paddingLeft),this.paintOrder=Ct(t,fF,s.paintOrder),this.position=Ct(t,VS,s.position),this.textAlign=Ct(t,NS,s.textAlign),this.textDecorationColor=Ct(t,eF,(i=s.textDecorationColor)!==null&&i!==void 0?i:s.color),this.textDecorationLine=Ct(t,sF,(A=s.textDecorationLine)!==null&&A!==void 0?A:s.textDecoration),this.textShadow=Ct(t,WS,s.textShadow),this.textTransform=Ct(t,GS,s.textTransform),this.transform=Ct(t,KS,s.transform),this.transformOrigin=Ct(t,YS,s.transformOrigin),this.visibility=Ct(t,jS,s.visibility),this.webkitTextStrokeColor=Ct(t,pF,s.webkitTextStrokeColor),this.webkitTextStrokeWidth=Ct(t,mF,s.webkitTextStrokeWidth),this.wordBreak=Ct(t,JS,s.wordBreak),this.zIndex=Ct(t,ZS,s.zIndex)}return e.prototype.isVisible=function(){return this.display>0&&this.opacity>0&&this.visibility===0},e.prototype.isTransparent=function(){return Hi(this.backgroundColor)},e.prototype.isTransformed=function(){return this.transform!==null},e.prototype.isPositioned=function(){return this.position!==0},e.prototype.isPositionedWithZIndex=function(){return this.isPositioned()&&!this.zIndex.auto},e.prototype.isFloating=function(){return this.float!==0},e.prototype.isInlineLevel=function(){return Ye(this.display,4)||Ye(this.display,33554432)||Ye(this.display,268435456)||Ye(this.display,536870912)||Ye(this.display,67108864)||Ye(this.display,134217728)},e})(),wF=(function(){function e(t,s){this.content=Ct(t,aF,s.content),this.quotes=Ct(t,uF,s.quotes)}return e})(),hg=(function(){function e(t,s){this.counterIncrement=Ct(t,lF,s.counterIncrement),this.counterReset=Ct(t,cF,s.counterReset)}return e})(),Ct=function(e,t,s){var i=new wv,A=s!==null&&typeof s<"u"?s.toString():t.initialValue;i.write(A);var r=new vv(i.read());switch(t.type){case 2:var a=r.parseComponentValue();return t.parse(e,ce(a)?a.value:t.initialValue);case 0:return t.parse(e,r.parseComponentValue());case 1:return t.parse(e,r.parseComponentValues());case 4:return r.parseComponentValue();case 3:switch(t.format){case"angle":return bc.parse(e,r.parseComponentValue());case"color":return Li.parse(e,r.parseComponentValue());case"image":return If.parse(e,r.parseComponentValue());case"length":var l=r.parseComponentValue();return Ni(l)?l:ps;case"length-percentage":var h=r.parseComponentValue();return We(h)?h:ps;case"time":return Lv.parse(e,r.parseComponentValue())}break}},vF="data-html2canvas-debug",BF=function(e){var t=e.getAttribute(vF);switch(t){case"all":return 1;case"clone":return 2;case"parse":return 3;case"render":return 4;default:return 0}},Ud=function(e,t){var s=BF(e);return s===1||t===s},Ln=(function(){function e(t,s){if(this.context=t,this.textNodes=[],this.elements=[],this.flags=0,Ud(s,3))debugger;this.styles=new gF(t,window.getComputedStyle(s,null)),Dd(s)&&(this.styles.animationDuration.some(function(i){return i>0})&&(s.style.animationDuration="0s"),this.styles.transform!==null&&(s.style.transform="none")),this.bounds=yc(this.context,s),Ud(s,4)&&(this.flags|=16)}return e})(),yF="AAAAAAAAAAAAEA4AGBkAAFAaAAACAAAAAAAIABAAGAAwADgACAAQAAgAEAAIABAACAAQAAgAEAAIABAACAAQAAgAEAAIABAAQABIAEQATAAIABAACAAQAAgAEAAIABAAVABcAAgAEAAIABAACAAQAGAAaABwAHgAgACIAI4AlgAIABAAmwCjAKgAsAC2AL4AvQDFAMoA0gBPAVYBWgEIAAgACACMANoAYgFkAWwBdAF8AX0BhQGNAZUBlgGeAaMBlQGWAasBswF8AbsBwwF0AcsBYwHTAQgA2wG/AOMBdAF8AekB8QF0AfkB+wHiAHQBfAEIAAMC5gQIAAsCEgIIAAgAFgIeAggAIgIpAggAMQI5AkACygEIAAgASAJQAlgCYAIIAAgACAAKBQoFCgUTBRMFGQUrBSsFCAAIAAgACAAIAAgACAAIAAgACABdAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACABoAmgCrwGvAQgAbgJ2AggAHgEIAAgACADnAXsCCAAIAAgAgwIIAAgACAAIAAgACACKAggAkQKZAggAPADJAAgAoQKkAqwCsgK6AsICCADJAggA0AIIAAgACAAIANYC3gIIAAgACAAIAAgACABAAOYCCAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAkASoB+QIEAAgACAA8AEMCCABCBQgACABJBVAFCAAIAAgACAAIAAgACAAIAAgACABTBVoFCAAIAFoFCABfBWUFCAAIAAgACAAIAAgAbQUIAAgACAAIAAgACABzBXsFfQWFBYoFigWKBZEFigWKBYoFmAWfBaYFrgWxBbkFCAAIAAgACAAIAAgACAAIAAgACAAIAMEFCAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAMgFCADQBQgACAAIAAgACAAIAAgACAAIAAgACAAIAO4CCAAIAAgAiQAIAAgACABAAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAD0AggACAD8AggACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIANYFCAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAMDvwAIAAgAJAIIAAgACAAIAAgACAAIAAgACwMTAwgACAB9BOsEGwMjAwgAKwMyAwsFYgE3A/MEPwMIAEUDTQNRAwgAWQOsAGEDCAAIAAgACAAIAAgACABpAzQFNQU2BTcFOAU5BToFNAU1BTYFNwU4BTkFOgU0BTUFNgU3BTgFOQU6BTQFNQU2BTcFOAU5BToFNAU1BTYFNwU4BTkFOgU0BTUFNgU3BTgFOQU6BTQFNQU2BTcFOAU5BToFNAU1BTYFNwU4BTkFOgU0BTUFNgU3BTgFOQU6BTQFNQU2BTcFOAU5BToFNAU1BTYFNwU4BTkFOgU0BTUFNgU3BTgFOQU6BTQFNQU2BTcFOAU5BToFNAU1BTYFNwU4BTkFOgU0BTUFNgU3BTgFOQU6BTQFNQU2BTcFOAU5BToFNAU1BTYFNwU4BTkFOgU0BTUFNgU3BTgFOQU6BTQFNQU2BTcFOAU5BToFNAU1BTYFNwU4BTkFOgU0BTUFNgU3BTgFOQU6BTQFNQU2BTcFOAU5BToFNAU1BTYFNwU4BTkFOgU0BTUFNgU3BTgFOQU6BTQFNQU2BTcFOAU5BToFNAU1BTYFNwU4BTkFOgU0BTUFNgU3BTgFOQU6BTQFNQU2BTcFOAU5BToFNAU1BTYFNwU4BTkFOgU0BTUFNgU3BTgFOQU6BTQFNQU2BTcFOAU5BToFNAU1BTYFNwU4BTkFOgU0BTUFNgU3BTgFOQU6BTQFNQU2BTcFOAU5BToFNAU1BTYFNwU4BTkFOgU0BTUFNgU3BTgFOQU6BTQFNQU2BTcFOAU5BToFNAU1BTYFNwU4BTkFOgU0BTUFNgU3BTgFOQU6BTQFNQU2BTcFOAU5BToFNAU1BTYFNwU4BTkFOgU0BTUFNgU3BTgFOQU6BTQFNQU2BTcFOAU5BToFNAU1BTYFNwU4BTkFOgU0BTUFNgU3BTgFOQU6BTQFNQU2BTcFOAU5BToFNAU1BTYFNwU4BTkFOgU0BTUFNgU3BTgFOQU6BTQFNQU2BTcFOAU5BToFNAU1BTYFNwU4BTkFIQUoBSwFCAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACABtAwgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACABMAEwACAAIAAgACAAIABgACAAIAAgACAC/AAgACAAyAQgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACACAAIAAwAAgACAAIAAgACAAIAAgACAAIAAAARABIAAgACAAIABQASAAIAAgAIABwAEAAjgCIABsAqAC2AL0AigDQAtwC+IJIQqVAZUBWQqVAZUBlQGVAZUBlQGrC5UBlQGVAZUBlQGVAZUBlQGVAXsKlQGVAbAK6wsrDGUMpQzlDJUBlQGVAZUBlQGVAZUBlQGVAZUBlQGVAZUBlQGVAZUBlQGVAZUBlQGVAZUBlQGVAZUBlQGVAZUBlQGVAZUBlQGVAZUBlQGVAZUBlQGVAZUBlQGVAZUBlQGVAZUBlQGVAZUBlQGVAZUBlQGVAZUBlQGVAZUBlQGVAZUBlQGVAZUBlQGVAZUBlQGVAZUBlQGVAZUBlQGVAZUBlQGVAZUBlQGVAZUBlQGVAZUBlQGVAZUBlQGVAZUBlQGVAZUBlQGVAZUBlQGVAZUBlQGVAZUBlQGVAZUBlQGVAZUBlQGVAZUBlQGVAZUBlQGVAZUBlQGVAZUBlQGVAZUBlQGVAZUBlQGVAZUBlQGVAZUBlQGVAZUBlQGVAZUBlQGVAZUBlQGVAZUBlQGVAZUBlQGVAZUBlQGVAZUBlQGVAZUBlQGVAZUBlQGVAZUBlQGVAZUBlQGVAZUBlQGVAZUBlQGVAZUBlQGVAZUBlQGVAZUBlQGVAZUBlQGVAZUBlQGVAZUBlQGVAZUBlQGVAZUBlQGVAZUBlQGVAZUBlQGVAZUBlQGVAZUBlQGVAZUBlQGVAZUBlQGVAZUBlQGVAZUBlQGVAZUBlQGVAZUBlQGVAZUBlQGVAZUBlQGVAZUBlQGVAZUBlQGVAZUBlQGVAZUBlQGVAZUBlQGVAZUBlQGVAZUBlQGVAZUBlQGVAZUBlQGVAZUBlQGVAZUBlQGVAZUBlQGVAZUBlQGVAZUBlQGVAZUBlQGVAZUBlQGVAZUBlQGVAZUBlQGVAZUBlQGVAZUBlQGVAZUBlQGVAZUBlQGVAZUBlQGVAZUBlQGVAZUBlQGVAZUBlQGVAZUBlQGVAZUBlQGVAZUBlQGVAZUBlQGVAZUBlQGVAZUBlQGVAZUBlQGVAZUBlQGVAZUBlQGVAZUBlQGVAZUBlQGVAZUBlQGVAZUBlQGVAZUBlQGVAZUBlQGVAZUBlQGVAZUBlQGVAZUBlQGVAZUBlQGVAZUBlQGVAZUBlQGVAZUBlQGVAZUBlQGVAZUBlQGVAfAKAAuZA64AtwCJALoC6ADwAAgAuACgA/oEpgO6AqsD+AAIAAgAswMIAAgACAAIAIkAuwP5AfsBwwPLAwgACAAIAAgACADRA9kDCAAIAOED6QMIAAgACAAIAAgACADuA/YDCAAIAP4DyQAIAAgABgQIAAgAXQAOBAgACAAIAAgACAAIABMECAAIAAgACAAIAAgACAD8AAQBCAAIAAgAGgQiBCoECAExBAgAEAEIAAgACAAIAAgACAAIAAgACAAIAAgACAA4BAgACABABEYECAAIAAgATAQYAQgAVAQIAAgACAAIAAgACAAIAAgACAAIAFoECAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgAOQEIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAB+BAcACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAEABhgSMBAgACAAIAAgAlAQIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAwAEAAQABAADAAMAAwADAAQABAAEAAQABAAEAAQABHATAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgAdQMIAAgACAAIAAgACAAIAMkACAAIAAgAfQMIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACACFA4kDCAAIAAgACAAIAOcBCAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAIcDCAAIAAgACAAIAAgACAAIAAgACAAIAJEDCAAIAAgACADFAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACABgBAgAZgQIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgAbAQCBXIECAAIAHkECAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACABAAJwEQACjBKoEsgQIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAC6BMIECAAIAAgACAAIAAgACABmBAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgAxwQIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAGYECAAIAAgAzgQIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgAigWKBYoFigWKBYoFigWKBd0FXwUIAOIF6gXxBYoF3gT5BQAGCAaKBYoFigWKBYoFigWKBYoFigWKBYoFigXWBIoFigWKBYoFigWKBYoFigWKBYsFEAaKBYoFigWKBYoFigWKBRQGCACKBYoFigWKBQgACAAIANEECAAIABgGigUgBggAJgYIAC4GMwaKBYoF0wQ3Bj4GigWKBYoFigWKBYoFigWKBYoFigWKBYoFigUIAAgACAAIAAgACAAIAAgAigWKBYoFigWKBYoFigWKBYoFigWKBYoFigWKBYoFigWKBYoFigWKBYoFigWKBYoFigWKBYoFigWKBYoFigWLBf///////wQABAAEAAQABAAEAAQABAAEAAQAAwAEAAQAAgAEAAQABAAEAAQABAAEAAQABAAEAAQABAAEAAQABAAEAAQABAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAABAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAQABAAEAAQABAAEAAQABAAEAAQABAAEAAQABAAEAAQABAAEAAQABAAEAAQABAAEAAQABAAEAAQABAAEAAQABAAAAAAAAAAAAAAAAAAAAAAAAAAOAAAAAAAAAAQADgAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAUABQAFAAUABQAFAAUAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAAAAUAAAAFAAUAAAAFAAUAAAAFAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAABAAEAAQABAAEAAQAAAAAAAAAAAAAAAAAAAAAAAAAAAAUABQAFAAUABQAFAAUABQAFAAUABQAAAAQAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAABQAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAUABQAFAAUABQAFAAUAAQAAAAUABQAFAAUABQAFAAAAAAAFAAUAAAAFAAUABQAFAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAEAAAAFAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAFAAUABQAFAAUABQAFAAUABQAFAAUAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAFAAUABQAFAAUABQAFAAUABQAAAAAAAAAAAAAAAAAAAAAAAAAFAAAAAAAFAAUAAQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABwAFAAUABQAFAAAABwAHAAcAAAAHAAcABwAFAAEAAAAAAAAAAAAAAAAAAAAAAAUAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAHAAcABwAFAAUABQAFAAcABwAFAAUAAAAAAAEAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAQAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAHAAAAAQABAAAAAAAAAAAAAAAFAAUABQAFAAAABwAFAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAABQAHAAcABwAHAAcAAAAHAAcAAAAAAAUABQAHAAUAAQAHAAEABwAFAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAABQAFAAUABQAFAAUABwABAAUABQAFAAUAAAAAAAAAAAAAAAEAAQABAAEAAQABAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABwAFAAUAAAAAAAAAAAAAAAAABQAFAAUABQAFAAUAAQAFAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAUABQAFAAQAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAQABQANAAQABAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAQABAAEAAQABAAEAAQAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAOAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAABAAEAAQABAAEAAQABAAEAAQABAAEAAQAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAEAAQABAAEAAQABAAEAAQABAAAAAAAAAAAAAAAAAAAAAAABQAHAAUABQAFAAAAAAAAAAcABQAFAAUABQAFAAQABAAEAAQABAAEAAQABAAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABAAEAAQABAAEAAQABAAEAAQABAAEAAQABAAEAAQABAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAUABQAFAAUAAAAFAAUABQAFAAUAAAAFAAUABQAAAAUABQAFAAUABQAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAFAAUABQAAAAAAAAAAAAUABQAFAAcAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAABQAHAAUAAAAHAAcABwAFAAUABQAFAAUABQAFAAUABwAHAAcABwAFAAcABwAAAAUABQAFAAUABQAFAAUAAAAAAAAAAAAAAAAAAAAAAAAAAAAFAAUAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAUABwAHAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAABQAAAAUABwAHAAUABQAFAAUAAAAAAAcABwAAAAAABwAHAAUAAAAAAAAAAAAAAAAAAAAAAAAABQAAAAAAAAAAAAAAAAAAAAAAAAAAAAUABQAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAABQAAAAAABQAFAAcAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAFAAAABwAHAAcABQAFAAAAAAAAAAAABQAFAAAAAAAFAAUABQAAAAAAAAAFAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAUABQAAAAAAAAAFAAAAAAAAAAAAAAAAAAAAAAAAAAAABwAFAAUABQAFAAUAAAAFAAUABwAAAAcABwAFAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAFAAUAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAFAAUABQAFAAUABQAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAUAAAAFAAUABwAFAAUABQAFAAAAAAAHAAcAAAAAAAcABwAFAAAAAAAAAAAAAAAAAAAABQAFAAUAAAAAAAAAAAAAAAAAAAAAAAAAAAAFAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAFAAcABwAAAAAAAAAHAAcABwAAAAcABwAHAAUAAAAAAAAAAAAAAAAAAAAAAAAABQAAAAAAAAAAAAAAAAAAAAAABQAHAAcABwAFAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAUABwAHAAcABwAAAAUABQAFAAAABQAFAAUABQAAAAAAAAAAAAAAAAAAAAUABQAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAABQAAAAcABQAHAAcABQAHAAcAAAAFAAcABwAAAAcABwAFAAUAAAAAAAAAAAAAAAAAAAAFAAUAAAAAAAAAAAAAAAAAAAAAAAAABQAFAAcABwAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAUABQAAAAUABwAAAAAAAAAAAAAAAAAAAAAAAAAAAAUAAAAAAAAAAAAFAAcABwAFAAUABQAAAAUAAAAHAAcABwAHAAcABwAHAAUAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAUAAAAHAAUABQAFAAUABQAFAAUAAAAAAAAAAAAAAAAAAAAAAAUABQAFAAUABQAFAAUABQAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAFAAAABwAFAAUABQAFAAUABQAFAAUABQAAAAAAAAAAAAAAAAAAAAAAAAAAAAAABQAFAAUABQAFAAUAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAUABQAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAABQAAAAUAAAAFAAAAAAAAAAAABwAHAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABwAFAAUABQAFAAUAAAAFAAUAAAAAAAAAAAAAAAUABQAFAAUABQAFAAUABQAFAAUABQAAAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAUABQAFAAUABwAFAAUABQAFAAUABQAAAAUABQAHAAcABQAFAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAHAAcABQAFAAAAAAAAAAAABQAFAAUAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAFAAUABQAFAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAABQAAAAcABQAFAAAAAAAAAAAAAAAAAAUAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAABQAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAABQAFAAUAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAUABQAHAAUABQAFAAUABQAFAAUABwAHAAcABwAHAAcABwAHAAUABwAHAAUABQAFAAUABQAFAAUABQAFAAUABQAAAAAAAAAAAAAAAAAAAAAAAAAFAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAABQAFAAUABwAHAAcABwAFAAUABwAHAAcAAAAAAAAAAAAHAAcABQAHAAcABwAHAAcABwAFAAUABQAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAABQAFAAcABwAFAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAcABQAHAAUABQAFAAUABQAFAAUAAAAFAAAABQAAAAAABQAFAAUABQAFAAUABQAFAAcABwAHAAcABwAHAAUABQAFAAUABQAFAAUABQAFAAUAAAAAAAUABQAFAAUABQAHAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAUABQAFAAUABQAFAAUABwAFAAcABwAHAAcABwAFAAcABwAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAFAAUABQAFAAUABQAFAAUABQAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAFAAUABwAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAHAAUABQAFAAUABwAHAAUABQAHAAUABQAFAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAFAAcABQAFAAcABwAHAAUABwAFAAUABQAHAAcAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAABwAHAAcABwAHAAcABwAHAAUABQAFAAUABQAFAAUABQAHAAcABQAFAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAABQAFAAUAAAAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAcABQAFAAUABQAFAAUABQAAAAAAAAAAAAUAAAAAAAAAAAAAAAAABQAAAAAABwAFAAUAAAAAAAAAAAAAAAAABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAAABQAFAAUABQAFAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAUABQAFAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAABQAFAAUABQAFAAUADgAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAOAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAUABQAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAUABQAFAAUAAAAFAAUABQAFAAUABQAFAAUABQAFAAAAAAAAAAAABQAAAAAAAAAFAAAAAAAAAAAABQAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAABwAHAAUABQAHAAAAAAAAAAAABQAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAcABwAHAAcABQAFAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAUAAAAAAAAAAAAAAAAABQAFAAUABQAFAAUABQAFAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAUABQAFAAUABQAFAAUABQAFAAUABQAHAAcAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAFAAcABwAFAAUABQAFAAcABwAFAAUABwAHAAAAAAAAAAAAAAAFAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAUABQAFAAUABQAFAAcABwAFAAUABwAHAAUABQAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAFAAAAAAAAAAAAAAAAAAAAAAAFAAcAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAABQAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAUAAAAFAAUABQAAAAAABQAFAAAAAAAAAAAAAAAFAAUAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAcABQAFAAcABwAAAAAAAAAAAAAABwAFAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAcABwAFAAcABwAFAAcABwAAAAcABQAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAABQAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAFAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAUABQAFAAUABQAAAAAAAAAAAAAAAAAFAAUABQAAAAUABQAAAAAAAAAAAAAABQAFAAUABQAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAFAAUABQAAAAAAAAAAAAUAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAUABQAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAcABQAHAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAFAAUABQAFAAUABwAFAAUABQAFAAUABQAFAAUAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAFAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAABwAHAAcABQAFAAUABQAFAAUABQAFAAUABwAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAHAAcABwAFAAUABQAHAAcABQAHAAUABQAAAAAAAAAAAAAAAAAFAAAABwAHAAcABQAFAAUABQAFAAUABQAFAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAUABwAHAAcABwAAAAAABwAHAAAAAAAHAAcABwAAAAAAAAAAAAAAAAAAAAAAAAAFAAAAAAAAAAAAAAAAAAAAAAAAAAAABwAHAAAAAAAFAAUABQAFAAUABQAFAAAAAAAAAAUABQAFAAUABQAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAHAAcABwAFAAUABQAFAAUABQAFAAUABwAHAAUABQAFAAcABQAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAABQAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAABQAHAAcABQAFAAUABQAFAAUABwAFAAcABwAFAAcABQAFAAcABQAFAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAABQAHAAcABQAFAAUABQAAAAAABwAHAAcABwAFAAUABwAFAAUAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAABQAFAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAcABwAHAAUABQAFAAUABQAFAAUABQAHAAcABQAHAAUAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAUABwAFAAcABwAFAAUABQAFAAUABQAHAAUAAAAAAAAAAAAAAAAAAAAAAAcABwAFAAUABQAFAAcABQAFAAUABQAFAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAHAAcABwAFAAUABQAFAAUABQAFAAUABQAHAAUABQAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAHAAcABwAFAAUABQAFAAAAAAAFAAUABwAHAAcABwAFAAAAAAAAAAcAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAFAAUABQAFAAUABQAFAAUABQAFAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAUAAAAAAAAAAAAAAAAAAAAAAAAABQAFAAUABQAFAAUABwAHAAUABQAFAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAcABQAFAAUABQAFAAUABQAAAAUABQAFAAUABQAFAAcABQAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUAAAAHAAUABQAFAAUABQAFAAUABwAFAAUABwAFAAUAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAABQAFAAUABQAFAAUAAAAAAAAABQAAAAUABQAAAAUAAAAAAAAAAAAAAAAAAAAAAAAAAAAHAAcABwAHAAcAAAAFAAUAAAAHAAcABQAHAAUAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAFAAUABwAHAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAFAAUABQAFAAUAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAFAAUABQAFAAUABQAFAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAABQAAAAcABwAHAAcABwAHAAcABwAHAAcABwAHAAcABwAHAAAAAAAAAAAAAAAAAAAABQAFAAUABQAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAUAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAcABwAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAUABQAAAAUABQAFAAAAAAAFAAUABQAFAAUABQAFAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAABQAFAAUABQAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAABQAFAAUAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAAAAAAAAAAABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAAAAAAAAAAAAAAAAAAAAAAFAAAAAAAAAAAAAAAAAAAAAAAAAAAABQAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAUABQAFAAUABQAAAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAABQAFAAUABQAFAAUABQAAAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAAAAAABQAFAAUABQAFAAUABQAAAAUABQAAAAUABQAFAAUABQAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAFAAUABQAFAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAABQAFAAUABQAFAAUABQAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAOAA4ADgAOAA4ADgAOAA4ADgAOAA4ADgAOAA4ADgAOAA4ADgAOAA4ADgAOAA4ADgAOAA4ADgAFAAUABQAFAAUADgAOAA4ADgAOAA4ADwAPAA8ADwAPAA8ADwAPAA8ADwAPAA8ADwAPAA8ADwAPAA8ADwAPAA8ADwAPAA8ADwAPAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAcABwAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAABwAHAAcABwAHAAcABwAHAAcABwAHAAcABwAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAABwAHAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAABwAHAAcABwAHAAcABwAHAAcABwAHAAcABwAHAAcABwAHAAcABwAHAAcABwAHAAcABwAHAAcABwAHAAcABwAHAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAAAAAAAAAkACQAJAAkACQAJAAkACQAJAAkACQAJAAkACQAJAAkACQAJAAkACQAJAAkACQAJAAkACQAJAAkACQAJAAkACQAKAAoACgAKAAoACgAKAAoACgAKAAoACgAKAAoACgAKAAoACgAKAAoACgAKAAoACgAMAAwADAAMAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAkACQAJAAkACQAJAAkACQAJAAkACQAJAAkACQAJAAkACQAJAAkAAAAAAAAAAAAKAAoACgAKAAoACgAKAAoACgAKAAoACgAKAAoACgAKAAoACgAKAAoACgAKAAoACgAKAAoACgAKAAoACgAKAAoACgAAAAAAAAAAAAsADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwACwAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAAAAAADgAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAA4AAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAOAA4ADgAOAA4ADgAAAAAAAAAAAAAAAAAAAAAAAAAAAAAADgAOAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAA4ADgAAAAAAAAAAAAAAAAAAAAAADgAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAADgAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAADgAOAA4ADgAOAA4ADgAOAA4ADgAOAAAAAAAAAAAADgAOAA4AAAAAAAAAAAAAAAAAAAAOAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAADgAOAAAAAAAAAAAAAAAAAAAAAAAAAAAADgAAAAAAAAAAAAAAAAAAAAAAAAAOAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAADgAOAA4ADgAAAA4ADgAOAA4ADgAOAAAADgAOAA4ADgAOAA4ADgAOAA4ADgAOAA4AAAAOAA4ADgAOAA4ADgAOAA4ADgAOAA4ADgAOAA4ADgAOAA4ADgAOAA4ADgAOAA4ADgAOAA4ADgAOAA4ADgAOAA4ADgAOAAAAAAAAAAAAAAAAAAAAAAAAAAAADgAOAA4ADgAOAA4ADgAOAA4ADgAOAA4ADgAOAA4ADgAOAA4AAAAAAA4ADgAOAA4ADgAOAA4ADgAOAA4ADgAAAA4AAAAOAAAAAAAAAAAAAAAAAA4AAAAAAAAAAAAAAAAADgAAAAAAAAAAAAAAAAAAAAAAAAAAAA4ADgAAAAAAAAAAAAAAAAAAAAAAAAAAAAAADgAAAAAADgAAAAAAAAAAAA4AAAAOAAAAAAAAAAAADgAOAA4AAAAOAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAOAA4ADgAOAA4AAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAOAA4ADgAAAAAAAAAAAAAAAAAAAAAAAAAOAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAOAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAOAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAOAA4AAAAAAAAAAAAAAAAAAAAAAAAAAAAAAA4ADgAOAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAADgAOAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAADgAAAAAAAAAAAA4AAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAOAAAADgAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAOAA4ADgAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAA4ADgAOAA4ADgAOAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAA4ADgAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAADgAAAAAADgAOAA4ADgAOAA4ADgAOAA4ADgAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAADgAOAA4ADgAOAA4ADgAOAA4ADgAOAA4ADgAOAA4ADgAOAA4ADgAAAA4ADgAOAA4ADgAOAA4ADgAOAA4ADgAOAA4ADgAOAAAAAAAAAAAAAAAAAAAAAAAAAAAADgAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAA4AAAAAAA4ADgAOAA4ADgAOAA4ADgAOAAAADgAOAA4ADgAAAAAAAAAAAAAAAAAAAAAAAAAOAA4ADgAOAA4ADgAOAA4ADgAOAA4ADgAOAA4ADgAOAA4ADgAOAA4ADgAOAA4AAAAAAAAAAAAAAAAADgAOAA4ADgAOAA4ADgAOAA4ADgAOAA4ADgAOAA4ADgAOAA4ADgAOAA4ADgAOAA4ADgAOAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAA4ADgAOAA4ADgAOAA4ADgAOAA4ADgAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAOAA4ADgAOAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAADgAOAA4ADgAOAA4ADgAOAAAAAAAAAAAAAAAAAAAAAAAAAAAADgAOAA4ADgAOAA4AAAAAAAAAAAAAAAAAAAAAAA4ADgAOAA4ADgAOAA4ADgAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAOAA4ADgAOAA4ADgAOAA4ADgAOAA4ADgAOAA4ADgAOAA4ADgAOAA4ADgAOAA4ADgAOAA4ADgAOAA4AAAAOAA4ADgAOAA4ADgAAAA4ADgAOAA4ADgAOAA4ADgAOAA4ADgAOAA4ADgAOAA4ADgAOAA4ADgAOAA4ADgAOAA4AAAAAAAAAAAA=",ug="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/",So=typeof Uint8Array>"u"?[]:new Uint8Array(256);for(var ul=0;ul<ug.length;ul++)So[ug.charCodeAt(ul)]=ul;var CF=function(e){var t=e.length*.75,s=e.length,i,A=0,r,a,l,h;e[e.length-1]==="="&&(t--,e[e.length-2]==="="&&t--);var u=typeof ArrayBuffer<"u"&&typeof Uint8Array<"u"&&typeof Uint8Array.prototype.slice<"u"?new ArrayBuffer(t):new Array(t),m=Array.isArray(u)?u:new Uint8Array(u);for(i=0;i<s;i+=4)r=So[e.charCodeAt(i)],a=So[e.charCodeAt(i+1)],l=So[e.charCodeAt(i+2)],h=So[e.charCodeAt(i+3)],m[A++]=r<<2|a>>4,m[A++]=(a&15)<<4|l>>2,m[A++]=(l&3)<<6|h&63;return u},bF=function(e){for(var t=e.length,s=[],i=0;i<t;i+=2)s.push(e[i+1]<<8|e[i]);return s},_F=function(e){for(var t=e.length,s=[],i=0;i<t;i+=4)s.push(e[i+3]<<24|e[i+2]<<16|e[i+1]<<8|e[i]);return s},lA=5,Qf=11,Mu=2,xF=Qf-lA,Hv=65536>>lA,EF=1<<lA,Uu=EF-1,SF=1024>>lA,FF=Hv+SF,TF=FF,IF=32,QF=TF+IF,MF=65536>>Qf,UF=1<<xF,PF=UF-1,dg=function(e,t,s){return e.slice?e.slice(t,s):new Uint16Array(Array.prototype.slice.call(e,t,s))},kF=function(e,t,s){return e.slice?e.slice(t,s):new Uint32Array(Array.prototype.slice.call(e,t,s))},DF=function(e,t){var s=CF(e),i=Array.isArray(s)?_F(s):new Uint32Array(s),A=Array.isArray(s)?bF(s):new Uint16Array(s),r=24,a=dg(A,r/2,i[4]/2),l=i[5]===2?dg(A,(r+i[4])/2):kF(i,Math.ceil((r+i[4])/4));return new LF(i[0],i[1],i[2],i[3],a,l)},LF=(function(){function e(t,s,i,A,r,a){this.initialValue=t,this.errorValue=s,this.highStart=i,this.highValueIndex=A,this.index=r,this.data=a}return e.prototype.get=function(t){var s;if(t>=0){if(t<55296||t>56319&&t<=65535)return s=this.index[t>>lA],s=(s<<Mu)+(t&Uu),this.data[s];if(t<=65535)return s=this.index[Hv+(t-55296>>lA)],s=(s<<Mu)+(t&Uu),this.data[s];if(t<this.highStart)return s=QF-MF+(t>>Qf),s=this.index[s],s+=t>>lA&PF,s=this.index[s],s=(s<<Mu)+(t&Uu),this.data[s];if(t<=1114111)return this.data[this.highValueIndex]}return this.errorValue},e})(),fg="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/",HF=typeof Uint8Array>"u"?[]:new Uint8Array(256);for(var dl=0;dl<fg.length;dl++)HF[fg.charCodeAt(dl)]=dl;var RF=1,Pu=2,ku=3,pg=4,mg=5,OF=7,gg=8,Du=9,Lu=10,wg=11,vg=12,Bg=13,yg=14,Hu=15,NF=function(e){for(var t=[],s=0,i=e.length;s<i;){var A=e.charCodeAt(s++);if(A>=55296&&A<=56319&&s<i){var r=e.charCodeAt(s++);(r&64512)===56320?t.push(((A&1023)<<10)+(r&1023)+65536):(t.push(A),s--)}else t.push(A)}return t},VF=function(){for(var e=[],t=0;t<arguments.length;t++)e[t]=arguments[t];if(String.fromCodePoint)return String.fromCodePoint.apply(String,e);var s=e.length;if(!s)return"";for(var i=[],A=-1,r="";++A<s;){var a=e[A];a<=65535?i.push(a):(a-=65536,i.push((a>>10)+55296,a%1024+56320)),(A+1===s||i.length>16384)&&(r+=String.fromCharCode.apply(String,i),i.length=0)}return r},WF=DF(yF),Js="",Ru="",GF=function(e){return WF.get(e)},KF=function(e,t,s){var i=s-2,A=t[i],r=t[s-1],a=t[s];if(r===Pu&&a===ku)return Js;if(r===Pu||r===ku||r===pg||a===Pu||a===ku||a===pg)return Ru;if(r===gg&&[gg,Du,wg,vg].indexOf(a)!==-1||(r===wg||r===Du)&&(a===Du||a===Lu)||(r===vg||r===Lu)&&a===Lu||a===Bg||a===mg||a===OF||r===RF)return Js;if(r===Bg&&a===yg){for(;A===mg;)A=t[--i];if(A===yg)return Js}if(r===Hu&&a===Hu){for(var l=0;A===Hu;)l++,A=t[--i];if(l%2===0)return Js}return Ru},qF=function(e){var t=NF(e),s=t.length,i=0,A=0,r=t.map(GF);return{next:function(){if(i>=s)return{done:!0,value:null};for(var a=Js;i<s&&(a=KF(t,r,++i))===Js;);if(a!==Js||i===s){var l=VF.apply(null,t.slice(A,i));return A=i,{value:l,done:!1}}return{done:!0,value:null}}}},zF=function(e){for(var t=qF(e),s=[],i;!(i=t.next()).done;)i.value&&s.push(i.value.slice());return s},$F=function(e){var t=123;if(e.createRange){var s=e.createRange();if(s.getBoundingClientRect){var i=e.createElement("boundtest");i.style.height=t+"px",i.style.display="block",e.body.appendChild(i),s.selectNode(i);var A=s.getBoundingClientRect(),r=Math.round(A.height);if(e.body.removeChild(i),r===t)return!0}}return!1},XF=function(e){var t=e.createElement("boundtest");t.style.width="50px",t.style.display="block",t.style.fontSize="12px",t.style.letterSpacing="0px",t.style.wordSpacing="0px",e.body.appendChild(t);var s=e.createRange();t.innerHTML=typeof"".repeat=="function"?"&#128104;".repeat(10):"";var i=t.firstChild,A=Cc(i.data).map(function(h){return Re(h)}),r=0,a={},l=A.every(function(h,u){s.setStart(i,r),s.setEnd(i,r+h.length);var m=s.getBoundingClientRect();r+=h.length;var g=m.x>a.x||m.y>a.y;return a=m,u===0?!0:g});return e.body.removeChild(t),l},YF=function(){return typeof new Image().crossOrigin<"u"},jF=function(){return typeof new XMLHttpRequest().responseType=="string"},JF=function(e){var t=new Image,s=e.createElement("canvas"),i=s.getContext("2d");if(!i)return!1;t.src="data:image/svg+xml,<svg xmlns='http://www.w3.org/2000/svg'></svg>";try{i.drawImage(t,0,0),s.toDataURL()}catch{return!1}return!0},Cg=function(e){return e[0]===0&&e[1]===255&&e[2]===0&&e[3]===255},ZF=function(e){var t=e.createElement("canvas"),s=100;t.width=s,t.height=s;var i=t.getContext("2d");if(!i)return Promise.reject(!1);i.fillStyle="rgb(0, 255, 0)",i.fillRect(0,0,s,s);var A=new Image,r=t.toDataURL();A.src=r;var a=Pd(s,s,0,0,A);return i.fillStyle="red",i.fillRect(0,0,s,s),bg(a).then(function(l){i.drawImage(l,0,0);var h=i.getImageData(0,0,s,s).data;i.fillStyle="red",i.fillRect(0,0,s,s);var u=e.createElement("div");return u.style.backgroundImage="url("+r+")",u.style.height=s+"px",Cg(h)?bg(Pd(s,s,0,0,u)):Promise.reject(!1)}).then(function(l){return i.drawImage(l,0,0),Cg(i.getImageData(0,0,s,s).data)}).catch(function(){return!1})},Pd=function(e,t,s,i,A){var r="http://www.w3.org/2000/svg",a=document.createElementNS(r,"svg"),l=document.createElementNS(r,"foreignObject");return a.setAttributeNS(null,"width",e.toString()),a.setAttributeNS(null,"height",t.toString()),l.setAttributeNS(null,"width","100%"),l.setAttributeNS(null,"height","100%"),l.setAttributeNS(null,"x",s.toString()),l.setAttributeNS(null,"y",i.toString()),l.setAttributeNS(null,"externalResourcesRequired","true"),a.appendChild(l),l.appendChild(A),a},bg=function(e){return new Promise(function(t,s){var i=new Image;i.onload=function(){return t(i)},i.onerror=s,i.src="data:image/svg+xml;charset=utf-8,"+encodeURIComponent(new XMLSerializer().serializeToString(e))})},fs={get SUPPORT_RANGE_BOUNDS(){var e=$F(document);return Object.defineProperty(fs,"SUPPORT_RANGE_BOUNDS",{value:e}),e},get SUPPORT_WORD_BREAKING(){var e=fs.SUPPORT_RANGE_BOUNDS&&XF(document);return Object.defineProperty(fs,"SUPPORT_WORD_BREAKING",{value:e}),e},get SUPPORT_SVG_DRAWING(){var e=JF(document);return Object.defineProperty(fs,"SUPPORT_SVG_DRAWING",{value:e}),e},get SUPPORT_FOREIGNOBJECT_DRAWING(){var e=typeof Array.from=="function"&&typeof window.fetch=="function"?ZF(document):Promise.resolve(!1);return Object.defineProperty(fs,"SUPPORT_FOREIGNOBJECT_DRAWING",{value:e}),e},get SUPPORT_CORS_IMAGES(){var e=YF();return Object.defineProperty(fs,"SUPPORT_CORS_IMAGES",{value:e}),e},get SUPPORT_RESPONSE_TYPE(){var e=jF();return Object.defineProperty(fs,"SUPPORT_RESPONSE_TYPE",{value:e}),e},get SUPPORT_CORS_XHR(){var e="withCredentials"in new XMLHttpRequest;return Object.defineProperty(fs,"SUPPORT_CORS_XHR",{value:e}),e},get SUPPORT_NATIVE_TEXT_SEGMENTATION(){var e=!!(typeof Intl<"u"&&Intl.Segmenter);return Object.defineProperty(fs,"SUPPORT_NATIVE_TEXT_SEGMENTATION",{value:e}),e}},No=(function(){function e(t,s){this.text=t,this.bounds=s}return e})(),tT=function(e,t,s,i){var A=nT(t,s),r=[],a=0;return A.forEach(function(l){if(s.textDecorationLine.length||l.trim().length>0)if(fs.SUPPORT_RANGE_BOUNDS){var h=_g(i,a,l.length).getClientRects();if(h.length>1){var u=Mf(l),m=0;u.forEach(function(v){r.push(new No(v,ni.fromDOMRectList(e,_g(i,m+a,v.length).getClientRects()))),m+=v.length})}else r.push(new No(l,ni.fromDOMRectList(e,h)))}else{var g=i.splitText(l.length);r.push(new No(l,eT(e,i))),i=g}else fs.SUPPORT_RANGE_BOUNDS||(i=i.splitText(l.length));a+=l.length}),r},eT=function(e,t){var s=t.ownerDocument;if(s){var i=s.createElement("html2canvaswrapper");i.appendChild(t.cloneNode(!0));var A=t.parentNode;if(A){A.replaceChild(i,t);var r=yc(e,i);return i.firstChild&&A.replaceChild(i.firstChild,i),r}}return ni.EMPTY},_g=function(e,t,s){var i=e.ownerDocument;if(!i)throw new Error("Node has no owner document");var A=i.createRange();return A.setStart(e,t),A.setEnd(e,t+s),A},Mf=function(e){if(fs.SUPPORT_NATIVE_TEXT_SEGMENTATION){var t=new Intl.Segmenter(void 0,{granularity:"grapheme"});return Array.from(t.segment(e)).map(function(s){return s.segment})}return zF(e)},sT=function(e,t){if(fs.SUPPORT_NATIVE_TEXT_SEGMENTATION){var s=new Intl.Segmenter(void 0,{granularity:"word"});return Array.from(s.segment(e)).map(function(i){return i.segment})}return AT(e,t)},nT=function(e,t){return t.letterSpacing!==0?Mf(e):sT(e,t)},iT=[32,160,4961,65792,65793,4153,4241],AT=function(e,t){for(var s=M1(e,{lineBreak:t.lineBreak,wordBreak:t.overflowWrap==="break-word"?"break-word":t.wordBreak}),i=[],A,r=function(){if(A.value){var a=A.value.slice(),l=Cc(a),h="";l.forEach(function(u){iT.indexOf(u)===-1?h+=Re(u):(h.length&&i.push(h),i.push(Re(u)),h="")}),h.length&&i.push(h)}};!(A=s.next()).done;)r();return i},rT=(function(){function e(t,s,i){this.text=oT(s.data,i.textTransform),this.textBounds=tT(t,this.text,i,s)}return e})(),oT=function(e,t){switch(t){case 1:return e.toLowerCase();case 3:return e.replace(aT,lT);case 2:return e.toUpperCase();default:return e}},aT=/(^|\s|:|-|\(|\))([a-z])/g,lT=function(e,t,s){return e.length>0?t+s.toUpperCase():e},Rv=(function(e){bn(t,e);function t(s,i){var A=e.call(this,s,i)||this;return A.src=i.currentSrc||i.src,A.intrinsicWidth=i.naturalWidth,A.intrinsicHeight=i.naturalHeight,A.context.cache.addImage(A.src),A}return t})(Ln),Ov=(function(e){bn(t,e);function t(s,i){var A=e.call(this,s,i)||this;return A.canvas=i,A.intrinsicWidth=i.width,A.intrinsicHeight=i.height,A}return t})(Ln),Nv=(function(e){bn(t,e);function t(s,i){var A=e.call(this,s,i)||this,r=new XMLSerializer,a=yc(s,i);return i.setAttribute("width",a.width+"px"),i.setAttribute("height",a.height+"px"),A.svg="data:image/svg+xml,"+encodeURIComponent(r.serializeToString(i)),A.intrinsicWidth=i.width.baseVal.value,A.intrinsicHeight=i.height.baseVal.value,A.context.cache.addImage(A.svg),A}return t})(Ln),Vv=(function(e){bn(t,e);function t(s,i){var A=e.call(this,s,i)||this;return A.value=i.value,A}return t})(Ln),kd=(function(e){bn(t,e);function t(s,i){var A=e.call(this,s,i)||this;return A.start=i.start,A.reversed=typeof i.reversed=="boolean"&&i.reversed===!0,A}return t})(Ln),cT=[{type:15,flags:0,unit:"px",number:3}],hT=[{type:16,flags:0,number:50}],uT=function(e){return e.width>e.height?new ni(e.left+(e.width-e.height)/2,e.top,e.height,e.height):e.width<e.height?new ni(e.left,e.top+(e.height-e.width)/2,e.width,e.width):e},dT=function(e){var t=e.type===fT?new Array(e.value.length+1).join(""):e.value;return t.length===0?e.placeholder||"":t},ec="checkbox",sc="radio",fT="password",xg=707406591,Uf=(function(e){bn(t,e);function t(s,i){var A=e.call(this,s,i)||this;switch(A.type=i.type.toLowerCase(),A.checked=i.checked,A.value=dT(i),(A.type===ec||A.type===sc)&&(A.styles.backgroundColor=3739148031,A.styles.borderTopColor=A.styles.borderRightColor=A.styles.borderBottomColor=A.styles.borderLeftColor=2779096575,A.styles.borderTopWidth=A.styles.borderRightWidth=A.styles.borderBottomWidth=A.styles.borderLeftWidth=1,A.styles.borderTopStyle=A.styles.borderRightStyle=A.styles.borderBottomStyle=A.styles.borderLeftStyle=1,A.styles.backgroundClip=[0],A.styles.backgroundOrigin=[0],A.bounds=uT(A.bounds)),A.type){case ec:A.styles.borderTopRightRadius=A.styles.borderTopLeftRadius=A.styles.borderBottomRightRadius=A.styles.borderBottomLeftRadius=cT;break;case sc:A.styles.borderTopRightRadius=A.styles.borderTopLeftRadius=A.styles.borderBottomRightRadius=A.styles.borderBottomLeftRadius=hT;break}return A}return t})(Ln),Wv=(function(e){bn(t,e);function t(s,i){var A=e.call(this,s,i)||this,r=i.options[i.selectedIndex||0];return A.value=r&&r.text||"",A}return t})(Ln),Gv=(function(e){bn(t,e);function t(s,i){var A=e.call(this,s,i)||this;return A.value=i.value,A}return t})(Ln),Kv=(function(e){bn(t,e);function t(s,i){var A=e.call(this,s,i)||this;A.src=i.src,A.width=parseInt(i.width,10)||0,A.height=parseInt(i.height,10)||0,A.backgroundColor=A.styles.backgroundColor;try{if(i.contentWindow&&i.contentWindow.document&&i.contentWindow.document.documentElement){A.tree=zv(s,i.contentWindow.document.documentElement);var r=i.contentWindow.document.documentElement?Ro(s,getComputedStyle(i.contentWindow.document.documentElement).backgroundColor):ei.TRANSPARENT,a=i.contentWindow.document.body?Ro(s,getComputedStyle(i.contentWindow.document.body).backgroundColor):ei.TRANSPARENT;A.backgroundColor=Hi(r)?Hi(a)?A.styles.backgroundColor:a:r}}catch{}return A}return t})(Ln),pT=["OL","UL","MENU"],Dl=function(e,t,s,i){for(var A=t.firstChild,r=void 0;A;A=r)if(r=A.nextSibling,$v(A)&&A.data.trim().length>0)s.textNodes.push(new rT(e,A,s.styles));else if(or(A))if(Jv(A)&&A.assignedNodes)A.assignedNodes().forEach(function(l){return Dl(e,l,s,i)});else{var a=qv(e,A);a.styles.isVisible()&&(mT(A,a,i)?a.flags|=4:gT(a.styles)&&(a.flags|=2),pT.indexOf(A.tagName)!==-1&&(a.flags|=8),s.elements.push(a),A.slot,A.shadowRoot?Dl(e,A.shadowRoot,a,i):!nc(A)&&!Xv(A)&&!ic(A)&&Dl(e,A,a,i))}},qv=function(e,t){return Ld(t)?new Rv(e,t):Yv(t)?new Ov(e,t):Xv(t)?new Nv(e,t):wT(t)?new Vv(e,t):vT(t)?new kd(e,t):BT(t)?new Uf(e,t):ic(t)?new Wv(e,t):nc(t)?new Gv(e,t):jv(t)?new Kv(e,t):new Ln(e,t)},zv=function(e,t){var s=qv(e,t);return s.flags|=4,Dl(e,t,s,s),s},mT=function(e,t,s){return t.styles.isPositionedWithZIndex()||t.styles.opacity<1||t.styles.isTransformed()||Pf(e)&&s.styles.isTransparent()},gT=function(e){return e.isPositioned()||e.isFloating()},$v=function(e){return e.nodeType===Node.TEXT_NODE},or=function(e){return e.nodeType===Node.ELEMENT_NODE},Dd=function(e){return or(e)&&typeof e.style<"u"&&!Ll(e)},Ll=function(e){return typeof e.className=="object"},wT=function(e){return e.tagName==="LI"},vT=function(e){return e.tagName==="OL"},BT=function(e){return e.tagName==="INPUT"},yT=function(e){return e.tagName==="HTML"},Xv=function(e){return e.tagName==="svg"},Pf=function(e){return e.tagName==="BODY"},Yv=function(e){return e.tagName==="CANVAS"},Eg=function(e){return e.tagName==="VIDEO"},Ld=function(e){return e.tagName==="IMG"},jv=function(e){return e.tagName==="IFRAME"},Sg=function(e){return e.tagName==="STYLE"},CT=function(e){return e.tagName==="SCRIPT"},nc=function(e){return e.tagName==="TEXTAREA"},ic=function(e){return e.tagName==="SELECT"},Jv=function(e){return e.tagName==="SLOT"},Fg=function(e){return e.tagName.indexOf("-")>0},bT=(function(){function e(){this.counters={}}return e.prototype.getCounterValue=function(t){var s=this.counters[t];return s&&s.length?s[s.length-1]:1},e.prototype.getCounterValues=function(t){var s=this.counters[t];return s||[]},e.prototype.pop=function(t){var s=this;t.forEach(function(i){return s.counters[i].pop()})},e.prototype.parse=function(t){var s=this,i=t.counterIncrement,A=t.counterReset,r=!0;i!==null&&i.forEach(function(l){var h=s.counters[l.counter];h&&l.increment!==0&&(r=!1,h.length||h.push(1),h[Math.max(0,h.length-1)]+=l.increment)});var a=[];return r&&A.forEach(function(l){var h=s.counters[l.counter];a.push(l.counter),h||(h=s.counters[l.counter]=[]),h.push(l.reset)}),a},e})(),Tg={integers:[1e3,900,500,400,100,90,50,40,10,9,5,4,1],values:["M","CM","D","CD","C","XC","L","XL","X","IX","V","IV","I"]},Ig={integers:[9e3,8e3,7e3,6e3,5e3,4e3,3e3,2e3,1e3,900,800,700,600,500,400,300,200,100,90,80,70,60,50,40,30,20,10,9,8,7,6,5,4,3,2,1],values:["","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","",""]},_T={integers:[1e4,9e3,8e3,7e3,6e3,5e3,4e3,3e3,2e3,1e3,400,300,200,100,90,80,70,60,50,40,30,20,19,18,17,16,15,10,9,8,7,6,5,4,3,2,1],values:["","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","",""]},xT={integers:[1e4,9e3,8e3,7e3,6e3,5e3,4e3,3e3,2e3,1e3,900,800,700,600,500,400,300,200,100,90,80,70,60,50,40,30,20,10,9,8,7,6,5,4,3,2,1],values:["","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","",""]},XA=function(e,t,s,i,A,r){return e<t||e>s?ea(e,A,r.length>0):i.integers.reduce(function(a,l,h){for(;e>=l;)e-=l,a+=i.values[h];return a},"")+r},Zv=function(e,t,s,i){var A="";do s||e--,A=i(e)+A,e/=t;while(e*t>=t);return A},He=function(e,t,s,i,A){var r=s-t+1;return(e<0?"-":"")+(Zv(Math.abs(e),r,i,function(a){return Re(Math.floor(a%r)+t)})+A)},Zi=function(e,t,s){s===void 0&&(s=". ");var i=t.length;return Zv(Math.abs(e),i,!1,function(A){return t[Math.floor(A%i)]})+s},sr=1,Ci=2,bi=4,Fo=8,Xn=function(e,t,s,i,A,r){if(e<-9999||e>9999)return ea(e,4,A.length>0);var a=Math.abs(e),l=A;if(a===0)return t[0]+l;for(var h=0;a>0&&h<=4;h++){var u=a%10;u===0&&Ye(r,sr)&&l!==""?l=t[u]+l:u>1||u===1&&h===0||u===1&&h===1&&Ye(r,Ci)||u===1&&h===1&&Ye(r,bi)&&e>100||u===1&&h>1&&Ye(r,Fo)?l=t[u]+(h>0?s[h-1]:"")+l:u===1&&h>0&&(l=s[h-1]+l),a=Math.floor(a/10)}return(e<0?i:"")+l},Qg="",Mg="",Ug="",Ou="",ea=function(e,t,s){var i=s?". ":"",A=s?"":"",r=s?", ":"",a=s?" ":"";switch(t){case 0:return""+a;case 1:return""+a;case 2:return""+a;case 5:var l=He(e,48,57,!0,i);return l.length<4?"0"+l:l;case 4:return Zi(e,"",A);case 6:return XA(e,1,3999,Tg,3,i).toLowerCase();case 7:return XA(e,1,3999,Tg,3,i);case 8:return He(e,945,969,!1,i);case 9:return He(e,97,122,!1,i);case 10:return He(e,65,90,!1,i);case 11:return He(e,1632,1641,!0,i);case 12:case 49:return XA(e,1,9999,Ig,3,i);case 35:return XA(e,1,9999,Ig,3,i).toLowerCase();case 13:return He(e,2534,2543,!0,i);case 14:case 30:return He(e,6112,6121,!0,i);case 15:return Zi(e,"",A);case 16:return Zi(e,"",A);case 17:case 48:return Xn(e,"",Qg,"",A,Ci|bi|Fo);case 47:return Xn(e,"",Mg,"",A,sr|Ci|bi|Fo);case 42:return Xn(e,"",Qg,"",A,Ci|bi|Fo);case 41:return Xn(e,"",Mg,"",A,sr|Ci|bi|Fo);case 26:return Xn(e,"","",Ug,A,0);case 25:return Xn(e,"","",Ug,A,sr|Ci|bi);case 31:return Xn(e,"","",Ou,r,sr|Ci|bi);case 33:return Xn(e,"","",Ou,r,0);case 32:return Xn(e,"","",Ou,r,sr|Ci|bi);case 18:return He(e,2406,2415,!0,i);case 20:return XA(e,1,19999,xT,3,i);case 21:return He(e,2790,2799,!0,i);case 22:return He(e,2662,2671,!0,i);case 22:return XA(e,1,10999,_T,3,i);case 23:return Zi(e,"");case 24:return Zi(e,"");case 27:return He(e,3302,3311,!0,i);case 28:return Zi(e,"",A);case 29:return Zi(e,"",A);case 34:return He(e,3792,3801,!0,i);case 37:return He(e,6160,6169,!0,i);case 38:return He(e,4160,4169,!0,i);case 39:return He(e,2918,2927,!0,i);case 40:return He(e,1776,1785,!0,i);case 43:return He(e,3046,3055,!0,i);case 44:return He(e,3174,3183,!0,i);case 45:return He(e,3664,3673,!0,i);case 46:return He(e,3872,3881,!0,i);case 3:default:return He(e,48,57,!0,i)}},t0="data-html2canvas-ignore",Pg=(function(){function e(t,s,i){if(this.context=t,this.options=i,this.scrolledElements=[],this.referenceElement=s,this.counters=new bT,this.quoteDepth=0,!s.ownerDocument)throw new Error("Cloned element does not have an owner document");this.documentElement=this.cloneNode(s.ownerDocument.documentElement,!1)}return e.prototype.toIFrame=function(t,s){var i=this,A=ET(t,s);if(!A.contentWindow)return Promise.reject("Unable to find iframe window");var r=t.defaultView.pageXOffset,a=t.defaultView.pageYOffset,l=A.contentWindow,h=l.document,u=TT(A).then(function(){return _s(i,void 0,void 0,function(){var m,g;return gs(this,function(v){switch(v.label){case 0:return this.scrolledElements.forEach(UT),l&&(l.scrollTo(s.left,s.top),/(iPad|iPhone|iPod)/g.test(navigator.userAgent)&&(l.scrollY!==s.top||l.scrollX!==s.left)&&(this.context.logger.warn("Unable to restore scroll position for cloned document"),this.context.windowBounds=this.context.windowBounds.add(l.scrollX-s.left,l.scrollY-s.top,0,0))),m=this.options.onclone,g=this.clonedReferenceElement,typeof g>"u"?[2,Promise.reject("Error finding the "+this.referenceElement.nodeName+" in the cloned document")]:h.fonts&&h.fonts.ready?[4,h.fonts.ready]:[3,2];case 1:v.sent(),v.label=2;case 2:return/(AppleWebKit)/g.test(navigator.userAgent)?[4,FT(h)]:[3,4];case 3:v.sent(),v.label=4;case 4:return typeof m=="function"?[2,Promise.resolve().then(function(){return m(h,g)}).then(function(){return A})]:[2,A]}})})});return h.open(),h.write(QT(document.doctype)+"<html></html>"),MT(this.referenceElement.ownerDocument,r,a),h.replaceChild(h.adoptNode(this.documentElement),h.documentElement),h.close(),u},e.prototype.createElementClone=function(t){if(Ud(t,2))debugger;if(Yv(t))return this.createCanvasClone(t);if(Eg(t))return this.createVideoClone(t);if(Sg(t))return this.createStyleClone(t);var s=t.cloneNode(!1);return Ld(s)&&(Ld(t)&&t.currentSrc&&t.currentSrc!==t.src&&(s.src=t.currentSrc,s.srcset=""),s.loading==="lazy"&&(s.loading="eager")),Fg(s)?this.createCustomElementClone(s):s},e.prototype.createCustomElementClone=function(t){var s=document.createElement("html2canvascustomelement");return Nu(t.style,s),s},e.prototype.createStyleClone=function(t){try{var s=t.sheet;if(s&&s.cssRules){var i=[].slice.call(s.cssRules,0).reduce(function(r,a){return a&&typeof a.cssText=="string"?r+a.cssText:r},""),A=t.cloneNode(!1);return A.textContent=i,A}}catch(r){if(this.context.logger.error("Unable to access cssRules property",r),r.name!=="SecurityError")throw r}return t.cloneNode(!1)},e.prototype.createCanvasClone=function(t){var s;if(this.options.inlineImages&&t.ownerDocument){var i=t.ownerDocument.createElement("img");try{return i.src=t.toDataURL(),i}catch{this.context.logger.info("Unable to inline canvas contents, canvas is tainted",t)}}var A=t.cloneNode(!1);try{A.width=t.width,A.height=t.height;var r=t.getContext("2d"),a=A.getContext("2d");if(a)if(!this.options.allowTaint&&r)a.putImageData(r.getImageData(0,0,t.width,t.height),0,0);else{var l=(s=t.getContext("webgl2"))!==null&&s!==void 0?s:t.getContext("webgl");if(l){var h=l.getContextAttributes();(h==null?void 0:h.preserveDrawingBuffer)===!1&&this.context.logger.warn("Unable to clone WebGL context as it has preserveDrawingBuffer=false",t)}a.drawImage(t,0,0)}return A}catch{this.context.logger.info("Unable to clone canvas as it is tainted",t)}return A},e.prototype.createVideoClone=function(t){var s=t.ownerDocument.createElement("canvas");s.width=t.offsetWidth,s.height=t.offsetHeight;var i=s.getContext("2d");try{return i&&(i.drawImage(t,0,0,s.width,s.height),this.options.allowTaint||i.getImageData(0,0,s.width,s.height)),s}catch{this.context.logger.info("Unable to clone video as it is tainted",t)}var A=t.ownerDocument.createElement("canvas");return A.width=t.offsetWidth,A.height=t.offsetHeight,A},e.prototype.appendChildNode=function(t,s,i){(!or(s)||!CT(s)&&!s.hasAttribute(t0)&&(typeof this.options.ignoreElements!="function"||!this.options.ignoreElements(s)))&&(!this.options.copyStyles||!or(s)||!Sg(s))&&t.appendChild(this.cloneNode(s,i))},e.prototype.cloneChildNodes=function(t,s,i){for(var A=this,r=t.shadowRoot?t.shadowRoot.firstChild:t.firstChild;r;r=r.nextSibling)if(or(r)&&Jv(r)&&typeof r.assignedNodes=="function"){var a=r.assignedNodes();a.length&&a.forEach(function(l){return A.appendChildNode(s,l,i)})}else this.appendChildNode(s,r,i)},e.prototype.cloneNode=function(t,s){if($v(t))return document.createTextNode(t.data);if(!t.ownerDocument)return t.cloneNode(!1);var i=t.ownerDocument.defaultView;if(i&&or(t)&&(Dd(t)||Ll(t))){var A=this.createElementClone(t);A.style.transitionProperty="none";var r=i.getComputedStyle(t),a=i.getComputedStyle(t,":before"),l=i.getComputedStyle(t,":after");this.referenceElement===t&&Dd(A)&&(this.clonedReferenceElement=A),Pf(A)&&DT(A);var h=this.counters.parse(new hg(this.context,r)),u=this.resolvePseudoContent(t,A,a,Vo.BEFORE);Fg(t)&&(s=!0),Eg(t)||this.cloneChildNodes(t,A,s),u&&A.insertBefore(u,A.firstChild);var m=this.resolvePseudoContent(t,A,l,Vo.AFTER);return m&&A.appendChild(m),this.counters.pop(h),(r&&(this.options.copyStyles||Ll(t))&&!jv(t)||s)&&Nu(r,A),(t.scrollTop!==0||t.scrollLeft!==0)&&this.scrolledElements.push([A,t.scrollLeft,t.scrollTop]),(nc(t)||ic(t))&&(nc(A)||ic(A))&&(A.value=t.value),A}return t.cloneNode(!1)},e.prototype.resolvePseudoContent=function(t,s,i,A){var r=this;if(i){var a=i.content,l=s.ownerDocument;if(!(!l||!a||a==="none"||a==="-moz-alt-content"||i.display==="none")){this.counters.parse(new hg(this.context,i));var h=new wF(this.context,i),u=l.createElement("html2canvaspseudoelement");Nu(i,u),h.content.forEach(function(g){if(g.type===0)u.appendChild(l.createTextNode(g.value));else if(g.type===22){var v=l.createElement("img");v.src=g.value,v.style.opacity="1",u.appendChild(v)}else if(g.type===18){if(g.name==="attr"){var y=g.values.filter(ce);y.length&&u.appendChild(l.createTextNode(t.getAttribute(y[0].value)||""))}else if(g.name==="counter"){var C=g.values.filter(xr),x=C[0],F=C[1];if(x&&ce(x)){var I=r.counters.getCounterValue(x.value),T=F&&ce(F)?Md.parse(r.context,F.value):3;u.appendChild(l.createTextNode(ea(I,T,!1)))}}else if(g.name==="counters"){var U=g.values.filter(xr),x=U[0],D=U[1],F=U[2];if(x&&ce(x)){var O=r.counters.getCounterValues(x.value),R=F&&ce(F)?Md.parse(r.context,F.value):3,st=D&&D.type===0?D.value:"",Y=O.map(function(dt){return ea(dt,R,!1)}).join(st);u.appendChild(l.createTextNode(Y))}}}else if(g.type===20)switch(g.value){case"open-quote":u.appendChild(l.createTextNode(cg(h.quotes,r.quoteDepth++,!0)));break;case"close-quote":u.appendChild(l.createTextNode(cg(h.quotes,--r.quoteDepth,!1)));break;default:u.appendChild(l.createTextNode(g.value))}}),u.className=Hd+" "+Rd;var m=A===Vo.BEFORE?" "+Hd:" "+Rd;return Ll(s)?s.className.baseValue+=m:s.className+=m,u}}},e.destroy=function(t){return t.parentNode?(t.parentNode.removeChild(t),!0):!1},e})(),Vo;(function(e){e[e.BEFORE=0]="BEFORE",e[e.AFTER=1]="AFTER"})(Vo||(Vo={}));var ET=function(e,t){var s=e.createElement("iframe");return s.className="html2canvas-container",s.style.visibility="hidden",s.style.position="fixed",s.style.left="-10000px",s.style.top="0px",s.style.border="0",s.width=t.width.toString(),s.height=t.height.toString(),s.scrolling="no",s.setAttribute(t0,"true"),e.body.appendChild(s),s},ST=function(e){return new Promise(function(t){if(e.complete){t();return}if(!e.src){t();return}e.onload=t,e.onerror=t})},FT=function(e){return Promise.all([].slice.call(e.images,0).map(ST))},TT=function(e){return new Promise(function(t,s){var i=e.contentWindow;if(!i)return s("No window assigned for iframe");var A=i.document;i.onload=e.onload=function(){i.onload=e.onload=null;var r=setInterval(function(){A.body.childNodes.length>0&&A.readyState==="complete"&&(clearInterval(r),t(e))},50)}})},IT=["all","d","content"],Nu=function(e,t){for(var s=e.length-1;s>=0;s--){var i=e.item(s);IT.indexOf(i)===-1&&t.style.setProperty(i,e.getPropertyValue(i))}return t},QT=function(e){var t="";return e&&(t+="<!DOCTYPE ",e.name&&(t+=e.name),e.internalSubset&&(t+=e.internalSubset),e.publicId&&(t+='"'+e.publicId+'"'),e.systemId&&(t+='"'+e.systemId+'"'),t+=">"),t},MT=function(e,t,s){e&&e.defaultView&&(t!==e.defaultView.pageXOffset||s!==e.defaultView.pageYOffset)&&e.defaultView.scrollTo(t,s)},UT=function(e){var t=e[0],s=e[1],i=e[2];t.scrollLeft=s,t.scrollTop=i},PT=":before",kT=":after",Hd="___html2canvas___pseudoelement_before",Rd="___html2canvas___pseudoelement_after",kg=`{
    content: "" !important;
    display: none !important;
}`,DT=function(e){LT(e,"."+Hd+PT+kg+`
         .`+Rd+kT+kg)},LT=function(e,t){var s=e.ownerDocument;if(s){var i=s.createElement("style");i.textContent=t,e.appendChild(i)}},e0=(function(){function e(){}return e.getOrigin=function(t){var s=e._link;return s?(s.href=t,s.href=s.href,s.protocol+s.hostname+s.port):"about:blank"},e.isSameOrigin=function(t){return e.getOrigin(t)===e._origin},e.setContext=function(t){e._link=t.document.createElement("a"),e._origin=e.getOrigin(t.location.href)},e._origin="about:blank",e})(),HT=(function(){function e(t,s){this.context=t,this._options=s,this._cache={}}return e.prototype.addImage=function(t){var s=Promise.resolve();return this.has(t)||(Wu(t)||VT(t))&&(this._cache[t]=this.loadImage(t)).catch(function(){}),s},e.prototype.match=function(t){return this._cache[t]},e.prototype.loadImage=function(t){return _s(this,void 0,void 0,function(){var s,i,A,r,a=this;return gs(this,function(l){switch(l.label){case 0:return s=e0.isSameOrigin(t),i=!Vu(t)&&this._options.useCORS===!0&&fs.SUPPORT_CORS_IMAGES&&!s,A=!Vu(t)&&!s&&!Wu(t)&&typeof this._options.proxy=="string"&&fs.SUPPORT_CORS_XHR&&!i,!s&&this._options.allowTaint===!1&&!Vu(t)&&!Wu(t)&&!A&&!i?[2]:(r=t,A?[4,this.proxy(r)]:[3,2]);case 1:r=l.sent(),l.label=2;case 2:return this.context.logger.debug("Added image "+t.substring(0,256)),[4,new Promise(function(h,u){var m=new Image;m.onload=function(){return h(m)},m.onerror=u,(WT(r)||i)&&(m.crossOrigin="anonymous"),m.src=r,m.complete===!0&&setTimeout(function(){return h(m)},500),a._options.imageTimeout>0&&setTimeout(function(){return u("Timed out ("+a._options.imageTimeout+"ms) loading image")},a._options.imageTimeout)})];case 3:return[2,l.sent()]}})})},e.prototype.has=function(t){return typeof this._cache[t]<"u"},e.prototype.keys=function(){return Promise.resolve(Object.keys(this._cache))},e.prototype.proxy=function(t){var s=this,i=this._options.proxy;if(!i)throw new Error("No proxy defined");var A=t.substring(0,256);return new Promise(function(r,a){var l=fs.SUPPORT_RESPONSE_TYPE?"blob":"text",h=new XMLHttpRequest;h.onload=function(){if(h.status===200)if(l==="text")r(h.response);else{var g=new FileReader;g.addEventListener("load",function(){return r(g.result)},!1),g.addEventListener("error",function(v){return a(v)},!1),g.readAsDataURL(h.response)}else a("Failed to proxy resource "+A+" with status code "+h.status)},h.onerror=a;var u=i.indexOf("?")>-1?"&":"?";if(h.open("GET",""+i+u+"url="+encodeURIComponent(t)+"&responseType="+l),l!=="text"&&h instanceof XMLHttpRequest&&(h.responseType=l),s._options.imageTimeout){var m=s._options.imageTimeout;h.timeout=m,h.ontimeout=function(){return a("Timed out ("+m+"ms) proxying "+A)}}h.send()})},e})(),RT=/^data:image\/svg\+xml/i,OT=/^data:image\/.*;base64,/i,NT=/^data:image\/.*/i,VT=function(e){return fs.SUPPORT_SVG_DRAWING||!GT(e)},Vu=function(e){return NT.test(e)},WT=function(e){return OT.test(e)},Wu=function(e){return e.substr(0,4)==="blob"},GT=function(e){return e.substr(-3).toLowerCase()==="svg"||RT.test(e)},wt=(function(){function e(t,s){this.type=0,this.x=t,this.y=s}return e.prototype.add=function(t,s){return new e(this.x+t,this.y+s)},e})(),YA=function(e,t,s){return new wt(e.x+(t.x-e.x)*s,e.y+(t.y-e.y)*s)},fl=(function(){function e(t,s,i,A){this.type=1,this.start=t,this.startControl=s,this.endControl=i,this.end=A}return e.prototype.subdivide=function(t,s){var i=YA(this.start,this.startControl,t),A=YA(this.startControl,this.endControl,t),r=YA(this.endControl,this.end,t),a=YA(i,A,t),l=YA(A,r,t),h=YA(a,l,t);return s?new e(this.start,i,a,h):new e(h,l,r,this.end)},e.prototype.add=function(t,s){return new e(this.start.add(t,s),this.startControl.add(t,s),this.endControl.add(t,s),this.end.add(t,s))},e.prototype.reverse=function(){return new e(this.end,this.endControl,this.startControl,this.start)},e})(),tn=function(e){return e.type===1},KT=(function(){function e(t){var s=t.styles,i=t.bounds,A=Eo(s.borderTopLeftRadius,i.width,i.height),r=A[0],a=A[1],l=Eo(s.borderTopRightRadius,i.width,i.height),h=l[0],u=l[1],m=Eo(s.borderBottomRightRadius,i.width,i.height),g=m[0],v=m[1],y=Eo(s.borderBottomLeftRadius,i.width,i.height),C=y[0],x=y[1],F=[];F.push((r+h)/i.width),F.push((C+g)/i.width),F.push((a+x)/i.height),F.push((u+v)/i.height);var I=Math.max.apply(Math,F);I>1&&(r/=I,a/=I,h/=I,u/=I,g/=I,v/=I,C/=I,x/=I);var T=i.width-h,U=i.height-v,D=i.width-g,O=i.height-x,R=s.borderTopWidth,st=s.borderRightWidth,Y=s.borderBottomWidth,L=s.borderLeftWidth,J=ge(s.paddingTop,t.bounds.width),dt=ge(s.paddingRight,t.bounds.width),ht=ge(s.paddingBottom,t.bounds.width),rt=ge(s.paddingLeft,t.bounds.width);this.topLeftBorderDoubleOuterBox=r>0||a>0?Ee(i.left+L/3,i.top+R/3,r-L/3,a-R/3,Ae.TOP_LEFT):new wt(i.left+L/3,i.top+R/3),this.topRightBorderDoubleOuterBox=r>0||a>0?Ee(i.left+T,i.top+R/3,h-st/3,u-R/3,Ae.TOP_RIGHT):new wt(i.left+i.width-st/3,i.top+R/3),this.bottomRightBorderDoubleOuterBox=g>0||v>0?Ee(i.left+D,i.top+U,g-st/3,v-Y/3,Ae.BOTTOM_RIGHT):new wt(i.left+i.width-st/3,i.top+i.height-Y/3),this.bottomLeftBorderDoubleOuterBox=C>0||x>0?Ee(i.left+L/3,i.top+O,C-L/3,x-Y/3,Ae.BOTTOM_LEFT):new wt(i.left+L/3,i.top+i.height-Y/3),this.topLeftBorderDoubleInnerBox=r>0||a>0?Ee(i.left+L*2/3,i.top+R*2/3,r-L*2/3,a-R*2/3,Ae.TOP_LEFT):new wt(i.left+L*2/3,i.top+R*2/3),this.topRightBorderDoubleInnerBox=r>0||a>0?Ee(i.left+T,i.top+R*2/3,h-st*2/3,u-R*2/3,Ae.TOP_RIGHT):new wt(i.left+i.width-st*2/3,i.top+R*2/3),this.bottomRightBorderDoubleInnerBox=g>0||v>0?Ee(i.left+D,i.top+U,g-st*2/3,v-Y*2/3,Ae.BOTTOM_RIGHT):new wt(i.left+i.width-st*2/3,i.top+i.height-Y*2/3),this.bottomLeftBorderDoubleInnerBox=C>0||x>0?Ee(i.left+L*2/3,i.top+O,C-L*2/3,x-Y*2/3,Ae.BOTTOM_LEFT):new wt(i.left+L*2/3,i.top+i.height-Y*2/3),this.topLeftBorderStroke=r>0||a>0?Ee(i.left+L/2,i.top+R/2,r-L/2,a-R/2,Ae.TOP_LEFT):new wt(i.left+L/2,i.top+R/2),this.topRightBorderStroke=r>0||a>0?Ee(i.left+T,i.top+R/2,h-st/2,u-R/2,Ae.TOP_RIGHT):new wt(i.left+i.width-st/2,i.top+R/2),this.bottomRightBorderStroke=g>0||v>0?Ee(i.left+D,i.top+U,g-st/2,v-Y/2,Ae.BOTTOM_RIGHT):new wt(i.left+i.width-st/2,i.top+i.height-Y/2),this.bottomLeftBorderStroke=C>0||x>0?Ee(i.left+L/2,i.top+O,C-L/2,x-Y/2,Ae.BOTTOM_LEFT):new wt(i.left+L/2,i.top+i.height-Y/2),this.topLeftBorderBox=r>0||a>0?Ee(i.left,i.top,r,a,Ae.TOP_LEFT):new wt(i.left,i.top),this.topRightBorderBox=h>0||u>0?Ee(i.left+T,i.top,h,u,Ae.TOP_RIGHT):new wt(i.left+i.width,i.top),this.bottomRightBorderBox=g>0||v>0?Ee(i.left+D,i.top+U,g,v,Ae.BOTTOM_RIGHT):new wt(i.left+i.width,i.top+i.height),this.bottomLeftBorderBox=C>0||x>0?Ee(i.left,i.top+O,C,x,Ae.BOTTOM_LEFT):new wt(i.left,i.top+i.height),this.topLeftPaddingBox=r>0||a>0?Ee(i.left+L,i.top+R,Math.max(0,r-L),Math.max(0,a-R),Ae.TOP_LEFT):new wt(i.left+L,i.top+R),this.topRightPaddingBox=h>0||u>0?Ee(i.left+Math.min(T,i.width-st),i.top+R,T>i.width+st?0:Math.max(0,h-st),Math.max(0,u-R),Ae.TOP_RIGHT):new wt(i.left+i.width-st,i.top+R),this.bottomRightPaddingBox=g>0||v>0?Ee(i.left+Math.min(D,i.width-L),i.top+Math.min(U,i.height-Y),Math.max(0,g-st),Math.max(0,v-Y),Ae.BOTTOM_RIGHT):new wt(i.left+i.width-st,i.top+i.height-Y),this.bottomLeftPaddingBox=C>0||x>0?Ee(i.left+L,i.top+Math.min(O,i.height-Y),Math.max(0,C-L),Math.max(0,x-Y),Ae.BOTTOM_LEFT):new wt(i.left+L,i.top+i.height-Y),this.topLeftContentBox=r>0||a>0?Ee(i.left+L+rt,i.top+R+J,Math.max(0,r-(L+rt)),Math.max(0,a-(R+J)),Ae.TOP_LEFT):new wt(i.left+L+rt,i.top+R+J),this.topRightContentBox=h>0||u>0?Ee(i.left+Math.min(T,i.width+L+rt),i.top+R+J,T>i.width+L+rt?0:h-L+rt,u-(R+J),Ae.TOP_RIGHT):new wt(i.left+i.width-(st+dt),i.top+R+J),this.bottomRightContentBox=g>0||v>0?Ee(i.left+Math.min(D,i.width-(L+rt)),i.top+Math.min(U,i.height+R+J),Math.max(0,g-(st+dt)),v-(Y+ht),Ae.BOTTOM_RIGHT):new wt(i.left+i.width-(st+dt),i.top+i.height-(Y+ht)),this.bottomLeftContentBox=C>0||x>0?Ee(i.left+L+rt,i.top+O,Math.max(0,C-(L+rt)),x-(Y+ht),Ae.BOTTOM_LEFT):new wt(i.left+L+rt,i.top+i.height-(Y+ht))}return e})(),Ae;(function(e){e[e.TOP_LEFT=0]="TOP_LEFT",e[e.TOP_RIGHT=1]="TOP_RIGHT",e[e.BOTTOM_RIGHT=2]="BOTTOM_RIGHT",e[e.BOTTOM_LEFT=3]="BOTTOM_LEFT"})(Ae||(Ae={}));var Ee=function(e,t,s,i,A){var r=4*((Math.sqrt(2)-1)/3),a=s*r,l=i*r,h=e+s,u=t+i;switch(A){case Ae.TOP_LEFT:return new fl(new wt(e,u),new wt(e,u-l),new wt(h-a,t),new wt(h,t));case Ae.TOP_RIGHT:return new fl(new wt(e,t),new wt(e+a,t),new wt(h,u-l),new wt(h,u));case Ae.BOTTOM_RIGHT:return new fl(new wt(h,t),new wt(h,t+l),new wt(e+a,u),new wt(e,u));case Ae.BOTTOM_LEFT:default:return new fl(new wt(h,u),new wt(h-a,u),new wt(e,t+l),new wt(e,t))}},Ac=function(e){return[e.topLeftBorderBox,e.topRightBorderBox,e.bottomRightBorderBox,e.bottomLeftBorderBox]},qT=function(e){return[e.topLeftContentBox,e.topRightContentBox,e.bottomRightContentBox,e.bottomLeftContentBox]},rc=function(e){return[e.topLeftPaddingBox,e.topRightPaddingBox,e.bottomRightPaddingBox,e.bottomLeftPaddingBox]},zT=(function(){function e(t,s,i){this.offsetX=t,this.offsetY=s,this.matrix=i,this.type=0,this.target=6}return e})(),pl=(function(){function e(t,s){this.path=t,this.target=s,this.type=1}return e})(),$T=(function(){function e(t){this.opacity=t,this.type=2,this.target=6}return e})(),XT=function(e){return e.type===0},s0=function(e){return e.type===1},YT=function(e){return e.type===2},Dg=function(e,t){return e.length===t.length?e.some(function(s,i){return s===t[i]}):!1},jT=function(e,t,s,i,A){return e.map(function(r,a){switch(a){case 0:return r.add(t,s);case 1:return r.add(t+i,s);case 2:return r.add(t+i,s+A);case 3:return r.add(t,s+A)}return r})},n0=(function(){function e(t){this.element=t,this.inlineLevel=[],this.nonInlineLevel=[],this.negativeZIndex=[],this.zeroOrAutoZIndexOrTransformedOrOpacity=[],this.positiveZIndex=[],this.nonPositionedFloats=[],this.nonPositionedInlineLevel=[]}return e})(),i0=(function(){function e(t,s){if(this.container=t,this.parent=s,this.effects=[],this.curves=new KT(this.container),this.container.styles.opacity<1&&this.effects.push(new $T(this.container.styles.opacity)),this.container.styles.transform!==null){var i=this.container.bounds.left+this.container.styles.transformOrigin[0].number,A=this.container.bounds.top+this.container.styles.transformOrigin[1].number,r=this.container.styles.transform;this.effects.push(new zT(i,A,r))}if(this.container.styles.overflowX!==0){var a=Ac(this.curves),l=rc(this.curves);Dg(a,l)?this.effects.push(new pl(a,6)):(this.effects.push(new pl(a,2)),this.effects.push(new pl(l,4)))}}return e.prototype.getEffects=function(t){for(var s=[2,3].indexOf(this.container.styles.position)===-1,i=this.parent,A=this.effects.slice(0);i;){var r=i.effects.filter(function(h){return!s0(h)});if(s||i.container.styles.position!==0||!i.parent){if(A.unshift.apply(A,r),s=[2,3].indexOf(i.container.styles.position)===-1,i.container.styles.overflowX!==0){var a=Ac(i.curves),l=rc(i.curves);Dg(a,l)||A.unshift(new pl(l,6))}}else A.unshift.apply(A,r);i=i.parent}return A.filter(function(h){return Ye(h.target,t)})},e})(),Od=function(e,t,s,i){e.container.elements.forEach(function(A){var r=Ye(A.flags,4),a=Ye(A.flags,2),l=new i0(A,e);Ye(A.styles.display,2048)&&i.push(l);var h=Ye(A.flags,8)?[]:i;if(r||a){var u=r||A.styles.isPositioned()?s:t,m=new n0(l);if(A.styles.isPositioned()||A.styles.opacity<1||A.styles.isTransformed()){var g=A.styles.zIndex.order;if(g<0){var v=0;u.negativeZIndex.some(function(C,x){return g>C.element.container.styles.zIndex.order?(v=x,!1):v>0}),u.negativeZIndex.splice(v,0,m)}else if(g>0){var y=0;u.positiveZIndex.some(function(C,x){return g>=C.element.container.styles.zIndex.order?(y=x+1,!1):y>0}),u.positiveZIndex.splice(y,0,m)}else u.zeroOrAutoZIndexOrTransformedOrOpacity.push(m)}else A.styles.isFloating()?u.nonPositionedFloats.push(m):u.nonPositionedInlineLevel.push(m);Od(l,m,r?m:s,h)}else A.styles.isInlineLevel()?t.inlineLevel.push(l):t.nonInlineLevel.push(l),Od(l,t,s,h);Ye(A.flags,8)&&A0(A,h)})},A0=function(e,t){for(var s=e instanceof kd?e.start:1,i=e instanceof kd?e.reversed:!1,A=0;A<t.length;A++){var r=t[A];r.container instanceof Vv&&typeof r.container.value=="number"&&r.container.value!==0&&(s=r.container.value),r.listValue=ea(s,r.container.styles.listStyleType,!0),s+=i?-1:1}},JT=function(e){var t=new i0(e,null),s=new n0(t),i=[];return Od(t,s,s,i),A0(t.container,i),s},Lg=function(e,t){switch(t){case 0:return nn(e.topLeftBorderBox,e.topLeftPaddingBox,e.topRightBorderBox,e.topRightPaddingBox);case 1:return nn(e.topRightBorderBox,e.topRightPaddingBox,e.bottomRightBorderBox,e.bottomRightPaddingBox);case 2:return nn(e.bottomRightBorderBox,e.bottomRightPaddingBox,e.bottomLeftBorderBox,e.bottomLeftPaddingBox);case 3:default:return nn(e.bottomLeftBorderBox,e.bottomLeftPaddingBox,e.topLeftBorderBox,e.topLeftPaddingBox)}},ZT=function(e,t){switch(t){case 0:return nn(e.topLeftBorderBox,e.topLeftBorderDoubleOuterBox,e.topRightBorderBox,e.topRightBorderDoubleOuterBox);case 1:return nn(e.topRightBorderBox,e.topRightBorderDoubleOuterBox,e.bottomRightBorderBox,e.bottomRightBorderDoubleOuterBox);case 2:return nn(e.bottomRightBorderBox,e.bottomRightBorderDoubleOuterBox,e.bottomLeftBorderBox,e.bottomLeftBorderDoubleOuterBox);case 3:default:return nn(e.bottomLeftBorderBox,e.bottomLeftBorderDoubleOuterBox,e.topLeftBorderBox,e.topLeftBorderDoubleOuterBox)}},tI=function(e,t){switch(t){case 0:return nn(e.topLeftBorderDoubleInnerBox,e.topLeftPaddingBox,e.topRightBorderDoubleInnerBox,e.topRightPaddingBox);case 1:return nn(e.topRightBorderDoubleInnerBox,e.topRightPaddingBox,e.bottomRightBorderDoubleInnerBox,e.bottomRightPaddingBox);case 2:return nn(e.bottomRightBorderDoubleInnerBox,e.bottomRightPaddingBox,e.bottomLeftBorderDoubleInnerBox,e.bottomLeftPaddingBox);case 3:default:return nn(e.bottomLeftBorderDoubleInnerBox,e.bottomLeftPaddingBox,e.topLeftBorderDoubleInnerBox,e.topLeftPaddingBox)}},eI=function(e,t){switch(t){case 0:return ml(e.topLeftBorderStroke,e.topRightBorderStroke);case 1:return ml(e.topRightBorderStroke,e.bottomRightBorderStroke);case 2:return ml(e.bottomRightBorderStroke,e.bottomLeftBorderStroke);case 3:default:return ml(e.bottomLeftBorderStroke,e.topLeftBorderStroke)}},ml=function(e,t){var s=[];return tn(e)?s.push(e.subdivide(.5,!1)):s.push(e),tn(t)?s.push(t.subdivide(.5,!0)):s.push(t),s},nn=function(e,t,s,i){var A=[];return tn(e)?A.push(e.subdivide(.5,!1)):A.push(e),tn(s)?A.push(s.subdivide(.5,!0)):A.push(s),tn(i)?A.push(i.subdivide(.5,!0).reverse()):A.push(i),tn(t)?A.push(t.subdivide(.5,!1).reverse()):A.push(t),A},r0=function(e){var t=e.bounds,s=e.styles;return t.add(s.borderLeftWidth,s.borderTopWidth,-(s.borderRightWidth+s.borderLeftWidth),-(s.borderTopWidth+s.borderBottomWidth))},oc=function(e){var t=e.styles,s=e.bounds,i=ge(t.paddingLeft,s.width),A=ge(t.paddingRight,s.width),r=ge(t.paddingTop,s.width),a=ge(t.paddingBottom,s.width);return s.add(i+t.borderLeftWidth,r+t.borderTopWidth,-(t.borderRightWidth+t.borderLeftWidth+i+A),-(t.borderTopWidth+t.borderBottomWidth+r+a))},sI=function(e,t){return e===0?t.bounds:e===2?oc(t):r0(t)},nI=function(e,t){return e===0?t.bounds:e===2?oc(t):r0(t)},Gu=function(e,t,s){var i=sI(nr(e.styles.backgroundOrigin,t),e),A=nI(nr(e.styles.backgroundClip,t),e),r=iI(nr(e.styles.backgroundSize,t),s,i),a=r[0],l=r[1],h=Eo(nr(e.styles.backgroundPosition,t),i.width-a,i.height-l),u=AI(nr(e.styles.backgroundRepeat,t),h,r,i,A),m=Math.round(i.left+h[0]),g=Math.round(i.top+h[1]);return[u,m,g,a,l]},jA=function(e){return ce(e)&&e.value===fr.AUTO},gl=function(e){return typeof e=="number"},iI=function(e,t,s){var i=t[0],A=t[1],r=t[2],a=e[0],l=e[1];if(!a)return[0,0];if(We(a)&&l&&We(l))return[ge(a,s.width),ge(l,s.height)];var h=gl(r);if(ce(a)&&(a.value===fr.CONTAIN||a.value===fr.COVER)){if(gl(r)){var u=s.width/s.height;return u<r!=(a.value===fr.COVER)?[s.width,s.width/r]:[s.height*r,s.height]}return[s.width,s.height]}var m=gl(i),g=gl(A),v=m||g;if(jA(a)&&(!l||jA(l))){if(m&&g)return[i,A];if(!h&&!v)return[s.width,s.height];if(v&&h){var y=m?i:A*r,C=g?A:i/r;return[y,C]}var x=m?i:s.width,F=g?A:s.height;return[x,F]}if(h){var I=0,T=0;return We(a)?I=ge(a,s.width):We(l)&&(T=ge(l,s.height)),jA(a)?I=T*r:(!l||jA(l))&&(T=I/r),[I,T]}var U=null,D=null;if(We(a)?U=ge(a,s.width):l&&We(l)&&(D=ge(l,s.height)),U!==null&&(!l||jA(l))&&(D=m&&g?U/i*A:s.height),D!==null&&jA(a)&&(U=m&&g?D/A*i:s.width),U!==null&&D!==null)return[U,D];throw new Error("Unable to calculate background-size for element")},nr=function(e,t){var s=e[t];return typeof s>"u"?e[0]:s},AI=function(e,t,s,i,A){var r=t[0],a=t[1],l=s[0],h=s[1];switch(e){case 2:return[new wt(Math.round(i.left),Math.round(i.top+a)),new wt(Math.round(i.left+i.width),Math.round(i.top+a)),new wt(Math.round(i.left+i.width),Math.round(h+i.top+a)),new wt(Math.round(i.left),Math.round(h+i.top+a))];case 3:return[new wt(Math.round(i.left+r),Math.round(i.top)),new wt(Math.round(i.left+r+l),Math.round(i.top)),new wt(Math.round(i.left+r+l),Math.round(i.height+i.top)),new wt(Math.round(i.left+r),Math.round(i.height+i.top))];case 1:return[new wt(Math.round(i.left+r),Math.round(i.top+a)),new wt(Math.round(i.left+r+l),Math.round(i.top+a)),new wt(Math.round(i.left+r+l),Math.round(i.top+a+h)),new wt(Math.round(i.left+r),Math.round(i.top+a+h))];default:return[new wt(Math.round(A.left),Math.round(A.top)),new wt(Math.round(A.left+A.width),Math.round(A.top)),new wt(Math.round(A.left+A.width),Math.round(A.height+A.top)),new wt(Math.round(A.left),Math.round(A.height+A.top))]}},rI="data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7",Hg="Hidden Text",oI=(function(){function e(t){this._data={},this._document=t}return e.prototype.parseMetrics=function(t,s){var i=this._document.createElement("div"),A=this._document.createElement("img"),r=this._document.createElement("span"),a=this._document.body;i.style.visibility="hidden",i.style.fontFamily=t,i.style.fontSize=s,i.style.margin="0",i.style.padding="0",i.style.whiteSpace="nowrap",a.appendChild(i),A.src=rI,A.width=1,A.height=1,A.style.margin="0",A.style.padding="0",A.style.verticalAlign="baseline",r.style.fontFamily=t,r.style.fontSize=s,r.style.margin="0",r.style.padding="0",r.appendChild(this._document.createTextNode(Hg)),i.appendChild(r),i.appendChild(A);var l=A.offsetTop-r.offsetTop+2;i.removeChild(r),i.appendChild(this._document.createTextNode(Hg)),i.style.lineHeight="normal",A.style.verticalAlign="super";var h=A.offsetTop-i.offsetTop+2;return a.removeChild(i),{baseline:l,middle:h}},e.prototype.getMetrics=function(t,s){var i=t+" "+s;return typeof this._data[i]>"u"&&(this._data[i]=this.parseMetrics(t,s)),this._data[i]},e})(),o0=(function(){function e(t,s){this.context=t,this.options=s}return e})(),aI=1e4,lI=(function(e){bn(t,e);function t(s,i){var A=e.call(this,s,i)||this;return A._activeEffects=[],A.canvas=i.canvas?i.canvas:document.createElement("canvas"),A.ctx=A.canvas.getContext("2d"),i.canvas||(A.canvas.width=Math.floor(i.width*i.scale),A.canvas.height=Math.floor(i.height*i.scale),A.canvas.style.width=i.width+"px",A.canvas.style.height=i.height+"px"),A.fontMetrics=new oI(document),A.ctx.scale(A.options.scale,A.options.scale),A.ctx.translate(-i.x,-i.y),A.ctx.textBaseline="bottom",A._activeEffects=[],A.context.logger.debug("Canvas renderer initialized ("+i.width+"x"+i.height+") with scale "+i.scale),A}return t.prototype.applyEffects=function(s){for(var i=this;this._activeEffects.length;)this.popEffect();s.forEach(function(A){return i.applyEffect(A)})},t.prototype.applyEffect=function(s){this.ctx.save(),YT(s)&&(this.ctx.globalAlpha=s.opacity),XT(s)&&(this.ctx.translate(s.offsetX,s.offsetY),this.ctx.transform(s.matrix[0],s.matrix[1],s.matrix[2],s.matrix[3],s.matrix[4],s.matrix[5]),this.ctx.translate(-s.offsetX,-s.offsetY)),s0(s)&&(this.path(s.path),this.ctx.clip()),this._activeEffects.push(s)},t.prototype.popEffect=function(){this._activeEffects.pop(),this.ctx.restore()},t.prototype.renderStack=function(s){return _s(this,void 0,void 0,function(){var i;return gs(this,function(A){switch(A.label){case 0:return i=s.element.container.styles,i.isVisible()?[4,this.renderStackContent(s)]:[3,2];case 1:A.sent(),A.label=2;case 2:return[2]}})})},t.prototype.renderNode=function(s){return _s(this,void 0,void 0,function(){return gs(this,function(i){switch(i.label){case 0:if(Ye(s.container.flags,16))debugger;return s.container.styles.isVisible()?[4,this.renderNodeBackgroundAndBorders(s)]:[3,3];case 1:return i.sent(),[4,this.renderNodeContent(s)];case 2:i.sent(),i.label=3;case 3:return[2]}})})},t.prototype.renderTextWithLetterSpacing=function(s,i,A){var r=this;if(i===0)this.ctx.fillText(s.text,s.bounds.left,s.bounds.top+A);else{var a=Mf(s.text);a.reduce(function(l,h){return r.ctx.fillText(h,l,s.bounds.top+A),l+r.ctx.measureText(h).width},s.bounds.left)}},t.prototype.createFontStyle=function(s){var i=s.fontVariant.filter(function(a){return a==="normal"||a==="small-caps"}).join(""),A=fI(s.fontFamily).join(", "),r=ua(s.fontSize)?""+s.fontSize.number+s.fontSize.unit:s.fontSize.number+"px";return[[s.fontStyle,i,s.fontWeight,r,A].join(" "),A,r]},t.prototype.renderTextNode=function(s,i){return _s(this,void 0,void 0,function(){var A,r,a,l,h,u,m,g,v=this;return gs(this,function(y){return A=this.createFontStyle(i),r=A[0],a=A[1],l=A[2],this.ctx.font=r,this.ctx.direction=i.direction===1?"rtl":"ltr",this.ctx.textAlign="left",this.ctx.textBaseline="alphabetic",h=this.fontMetrics.getMetrics(a,l),u=h.baseline,m=h.middle,g=i.paintOrder,s.textBounds.forEach(function(C){g.forEach(function(x){switch(x){case 0:v.ctx.fillStyle=es(i.color),v.renderTextWithLetterSpacing(C,i.letterSpacing,u);var F=i.textShadow;F.length&&C.text.trim().length&&(F.slice(0).reverse().forEach(function(I){v.ctx.shadowColor=es(I.color),v.ctx.shadowOffsetX=I.offsetX.number*v.options.scale,v.ctx.shadowOffsetY=I.offsetY.number*v.options.scale,v.ctx.shadowBlur=I.blur.number,v.renderTextWithLetterSpacing(C,i.letterSpacing,u)}),v.ctx.shadowColor="",v.ctx.shadowOffsetX=0,v.ctx.shadowOffsetY=0,v.ctx.shadowBlur=0),i.textDecorationLine.length&&(v.ctx.fillStyle=es(i.textDecorationColor||i.color),i.textDecorationLine.forEach(function(I){switch(I){case 1:v.ctx.fillRect(C.bounds.left,Math.round(C.bounds.top+u),C.bounds.width,1);break;case 2:v.ctx.fillRect(C.bounds.left,Math.round(C.bounds.top),C.bounds.width,1);break;case 3:v.ctx.fillRect(C.bounds.left,Math.ceil(C.bounds.top+m),C.bounds.width,1);break}}));break;case 1:i.webkitTextStrokeWidth&&C.text.trim().length&&(v.ctx.strokeStyle=es(i.webkitTextStrokeColor),v.ctx.lineWidth=i.webkitTextStrokeWidth,v.ctx.lineJoin=window.chrome?"miter":"round",v.ctx.strokeText(C.text,C.bounds.left,C.bounds.top+u)),v.ctx.strokeStyle="",v.ctx.lineWidth=0,v.ctx.lineJoin="miter";break}})}),[2]})})},t.prototype.renderReplacedElement=function(s,i,A){if(A&&s.intrinsicWidth>0&&s.intrinsicHeight>0){var r=oc(s),a=rc(i);this.path(a),this.ctx.save(),this.ctx.clip(),this.ctx.drawImage(A,0,0,s.intrinsicWidth,s.intrinsicHeight,r.left,r.top,r.width,r.height),this.ctx.restore()}},t.prototype.renderNodeContent=function(s){return _s(this,void 0,void 0,function(){var i,A,r,a,l,h,T,T,u,m,g,v,D,y,C,O,x,F,I,T,U,D,O;return gs(this,function(R){switch(R.label){case 0:this.applyEffects(s.getEffects(4)),i=s.container,A=s.curves,r=i.styles,a=0,l=i.textNodes,R.label=1;case 1:return a<l.length?(h=l[a],[4,this.renderTextNode(h,r)]):[3,4];case 2:R.sent(),R.label=3;case 3:return a++,[3,1];case 4:if(!(i instanceof Rv))return[3,8];R.label=5;case 5:return R.trys.push([5,7,,8]),[4,this.context.cache.match(i.src)];case 6:return T=R.sent(),this.renderReplacedElement(i,A,T),[3,8];case 7:return R.sent(),this.context.logger.error("Error loading image "+i.src),[3,8];case 8:if(i instanceof Ov&&this.renderReplacedElement(i,A,i.canvas),!(i instanceof Nv))return[3,12];R.label=9;case 9:return R.trys.push([9,11,,12]),[4,this.context.cache.match(i.svg)];case 10:return T=R.sent(),this.renderReplacedElement(i,A,T),[3,12];case 11:return R.sent(),this.context.logger.error("Error loading svg "+i.svg.substring(0,255)),[3,12];case 12:return i instanceof Kv&&i.tree?(u=new t(this.context,{scale:this.options.scale,backgroundColor:i.backgroundColor,x:0,y:0,width:i.width,height:i.height}),[4,u.render(i.tree)]):[3,14];case 13:m=R.sent(),i.width&&i.height&&this.ctx.drawImage(m,0,0,i.width,i.height,i.bounds.left,i.bounds.top,i.bounds.width,i.bounds.height),R.label=14;case 14:if(i instanceof Uf&&(g=Math.min(i.bounds.width,i.bounds.height),i.type===ec?i.checked&&(this.ctx.save(),this.path([new wt(i.bounds.left+g*.39363,i.bounds.top+g*.79),new wt(i.bounds.left+g*.16,i.bounds.top+g*.5549),new wt(i.bounds.left+g*.27347,i.bounds.top+g*.44071),new wt(i.bounds.left+g*.39694,i.bounds.top+g*.5649),new wt(i.bounds.left+g*.72983,i.bounds.top+g*.23),new wt(i.bounds.left+g*.84,i.bounds.top+g*.34085),new wt(i.bounds.left+g*.39363,i.bounds.top+g*.79)]),this.ctx.fillStyle=es(xg),this.ctx.fill(),this.ctx.restore()):i.type===sc&&i.checked&&(this.ctx.save(),this.ctx.beginPath(),this.ctx.arc(i.bounds.left+g/2,i.bounds.top+g/2,g/4,0,Math.PI*2,!0),this.ctx.fillStyle=es(xg),this.ctx.fill(),this.ctx.restore())),cI(i)&&i.value.length){switch(v=this.createFontStyle(r),D=v[0],y=v[1],C=this.fontMetrics.getMetrics(D,y).baseline,this.ctx.font=D,this.ctx.fillStyle=es(r.color),this.ctx.textBaseline="alphabetic",this.ctx.textAlign=uI(i.styles.textAlign),O=oc(i),x=0,i.styles.textAlign){case 1:x+=O.width/2;break;case 2:x+=O.width;break}F=O.add(x,0,0,-O.height/2+1),this.ctx.save(),this.path([new wt(O.left,O.top),new wt(O.left+O.width,O.top),new wt(O.left+O.width,O.top+O.height),new wt(O.left,O.top+O.height)]),this.ctx.clip(),this.renderTextWithLetterSpacing(new No(i.value,F),r.letterSpacing,C),this.ctx.restore(),this.ctx.textBaseline="alphabetic",this.ctx.textAlign="left"}if(!Ye(i.styles.display,2048))return[3,20];if(i.styles.listStyleImage===null)return[3,19];if(I=i.styles.listStyleImage,I.type!==0)return[3,18];T=void 0,U=I.url,R.label=15;case 15:return R.trys.push([15,17,,18]),[4,this.context.cache.match(U)];case 16:return T=R.sent(),this.ctx.drawImage(T,i.bounds.left-(T.width+10),i.bounds.top),[3,18];case 17:return R.sent(),this.context.logger.error("Error loading list-style-image "+U),[3,18];case 18:return[3,20];case 19:s.listValue&&i.styles.listStyleType!==-1&&(D=this.createFontStyle(r)[0],this.ctx.font=D,this.ctx.fillStyle=es(r.color),this.ctx.textBaseline="middle",this.ctx.textAlign="right",O=new ni(i.bounds.left,i.bounds.top+ge(i.styles.paddingTop,i.bounds.width),i.bounds.width,ag(r.lineHeight,r.fontSize.number)/2+1),this.renderTextWithLetterSpacing(new No(s.listValue,O),r.letterSpacing,ag(r.lineHeight,r.fontSize.number)/2+2),this.ctx.textBaseline="bottom",this.ctx.textAlign="left"),R.label=20;case 20:return[2]}})})},t.prototype.renderStackContent=function(s){return _s(this,void 0,void 0,function(){var i,A,I,r,a,I,l,h,I,u,m,I,g,v,I,y,C,I,x,F,I;return gs(this,function(T){switch(T.label){case 0:if(Ye(s.element.container.flags,16))debugger;return[4,this.renderNodeBackgroundAndBorders(s.element)];case 1:T.sent(),i=0,A=s.negativeZIndex,T.label=2;case 2:return i<A.length?(I=A[i],[4,this.renderStack(I)]):[3,5];case 3:T.sent(),T.label=4;case 4:return i++,[3,2];case 5:return[4,this.renderNodeContent(s.element)];case 6:T.sent(),r=0,a=s.nonInlineLevel,T.label=7;case 7:return r<a.length?(I=a[r],[4,this.renderNode(I)]):[3,10];case 8:T.sent(),T.label=9;case 9:return r++,[3,7];case 10:l=0,h=s.nonPositionedFloats,T.label=11;case 11:return l<h.length?(I=h[l],[4,this.renderStack(I)]):[3,14];case 12:T.sent(),T.label=13;case 13:return l++,[3,11];case 14:u=0,m=s.nonPositionedInlineLevel,T.label=15;case 15:return u<m.length?(I=m[u],[4,this.renderStack(I)]):[3,18];case 16:T.sent(),T.label=17;case 17:return u++,[3,15];case 18:g=0,v=s.inlineLevel,T.label=19;case 19:return g<v.length?(I=v[g],[4,this.renderNode(I)]):[3,22];case 20:T.sent(),T.label=21;case 21:return g++,[3,19];case 22:y=0,C=s.zeroOrAutoZIndexOrTransformedOrOpacity,T.label=23;case 23:return y<C.length?(I=C[y],[4,this.renderStack(I)]):[3,26];case 24:T.sent(),T.label=25;case 25:return y++,[3,23];case 26:x=0,F=s.positiveZIndex,T.label=27;case 27:return x<F.length?(I=F[x],[4,this.renderStack(I)]):[3,30];case 28:T.sent(),T.label=29;case 29:return x++,[3,27];case 30:return[2]}})})},t.prototype.mask=function(s){this.ctx.beginPath(),this.ctx.moveTo(0,0),this.ctx.lineTo(this.canvas.width,0),this.ctx.lineTo(this.canvas.width,this.canvas.height),this.ctx.lineTo(0,this.canvas.height),this.ctx.lineTo(0,0),this.formatPath(s.slice(0).reverse()),this.ctx.closePath()},t.prototype.path=function(s){this.ctx.beginPath(),this.formatPath(s),this.ctx.closePath()},t.prototype.formatPath=function(s){var i=this;s.forEach(function(A,r){var a=tn(A)?A.start:A;r===0?i.ctx.moveTo(a.x,a.y):i.ctx.lineTo(a.x,a.y),tn(A)&&i.ctx.bezierCurveTo(A.startControl.x,A.startControl.y,A.endControl.x,A.endControl.y,A.end.x,A.end.y)})},t.prototype.renderRepeat=function(s,i,A,r){this.path(s),this.ctx.fillStyle=i,this.ctx.translate(A,r),this.ctx.fill(),this.ctx.translate(-A,-r)},t.prototype.resizeImage=function(s,i,A){var r;if(s.width===i&&s.height===A)return s;var a=(r=this.canvas.ownerDocument)!==null&&r!==void 0?r:document,l=a.createElement("canvas");l.width=Math.max(1,i),l.height=Math.max(1,A);var h=l.getContext("2d");return h.drawImage(s,0,0,s.width,s.height,0,0,i,A),l},t.prototype.renderBackgroundImage=function(s){return _s(this,void 0,void 0,function(){var i,A,r,a,l,h;return gs(this,function(u){switch(u.label){case 0:i=s.styles.backgroundImage.length-1,A=function(m){var g,v,y,J,Ht,tt,rt,Tt,Y,C,J,Ht,tt,rt,Tt,x,F,I,T,U,D,O,R,st,Y,L,J,dt,ht,rt,Tt,It,Ht,tt,ct,lt,mt,At,St,Qt,Pt,Vt;return gs(this,function(he){switch(he.label){case 0:if(m.type!==0)return[3,5];g=void 0,v=m.url,he.label=1;case 1:return he.trys.push([1,3,,4]),[4,r.context.cache.match(v)];case 2:return g=he.sent(),[3,4];case 3:return he.sent(),r.context.logger.error("Error loading background-image "+v),[3,4];case 4:return g&&(y=Gu(s,i,[g.width,g.height,g.width/g.height]),J=y[0],Ht=y[1],tt=y[2],rt=y[3],Tt=y[4],Y=r.ctx.createPattern(r.resizeImage(g,rt,Tt),"repeat"),r.renderRepeat(J,Y,Ht,tt)),[3,6];case 5:XE(m)?(C=Gu(s,i,[null,null,null]),J=C[0],Ht=C[1],tt=C[2],rt=C[3],Tt=C[4],x=GE(m.angle,rt,Tt),F=x[0],I=x[1],T=x[2],U=x[3],D=x[4],O=document.createElement("canvas"),O.width=rt,O.height=Tt,R=O.getContext("2d"),st=R.createLinearGradient(I,U,T,D),rg(m.stops,F).forEach(function(Lt){return st.addColorStop(Lt.stop,es(Lt.color))}),R.fillStyle=st,R.fillRect(0,0,rt,Tt),rt>0&&Tt>0&&(Y=r.ctx.createPattern(O,"repeat"),r.renderRepeat(J,Y,Ht,tt))):YE(m)&&(L=Gu(s,i,[null,null,null]),J=L[0],dt=L[1],ht=L[2],rt=L[3],Tt=L[4],It=m.position.length===0?[Tf]:m.position,Ht=ge(It[0],rt),tt=ge(It[It.length-1],Tt),ct=KE(m,Ht,tt,rt,Tt),lt=ct[0],mt=ct[1],lt>0&&mt>0&&(At=r.ctx.createRadialGradient(dt+Ht,ht+tt,0,dt+Ht,ht+tt,lt),rg(m.stops,lt*2).forEach(function(Lt){return At.addColorStop(Lt.stop,es(Lt.color))}),r.path(J),r.ctx.fillStyle=At,lt!==mt?(St=s.bounds.left+.5*s.bounds.width,Qt=s.bounds.top+.5*s.bounds.height,Pt=mt/lt,Vt=1/Pt,r.ctx.save(),r.ctx.translate(St,Qt),r.ctx.transform(1,0,0,Pt,0,0),r.ctx.translate(-St,-Qt),r.ctx.fillRect(dt,Vt*(ht-Qt)+Qt,rt,Tt*Vt),r.ctx.restore()):r.ctx.fill())),he.label=6;case 6:return i--,[2]}})},r=this,a=0,l=s.styles.backgroundImage.slice(0).reverse(),u.label=1;case 1:return a<l.length?(h=l[a],[5,A(h)]):[3,4];case 2:u.sent(),u.label=3;case 3:return a++,[3,1];case 4:return[2]}})})},t.prototype.renderSolidBorder=function(s,i,A){return _s(this,void 0,void 0,function(){return gs(this,function(r){return this.path(Lg(A,i)),this.ctx.fillStyle=es(s),this.ctx.fill(),[2]})})},t.prototype.renderDoubleBorder=function(s,i,A,r){return _s(this,void 0,void 0,function(){var a,l;return gs(this,function(h){switch(h.label){case 0:return i<3?[4,this.renderSolidBorder(s,A,r)]:[3,2];case 1:return h.sent(),[2];case 2:return a=ZT(r,A),this.path(a),this.ctx.fillStyle=es(s),this.ctx.fill(),l=tI(r,A),this.path(l),this.ctx.fill(),[2]}})})},t.prototype.renderNodeBackgroundAndBorders=function(s){return _s(this,void 0,void 0,function(){var i,A,r,a,l,h,u,m,g=this;return gs(this,function(v){switch(v.label){case 0:return this.applyEffects(s.getEffects(2)),i=s.container.styles,A=!Hi(i.backgroundColor)||i.backgroundImage.length,r=[{style:i.borderTopStyle,color:i.borderTopColor,width:i.borderTopWidth},{style:i.borderRightStyle,color:i.borderRightColor,width:i.borderRightWidth},{style:i.borderBottomStyle,color:i.borderBottomColor,width:i.borderBottomWidth},{style:i.borderLeftStyle,color:i.borderLeftColor,width:i.borderLeftWidth}],a=hI(nr(i.backgroundClip,0),s.curves),A||i.boxShadow.length?(this.ctx.save(),this.path(a),this.ctx.clip(),Hi(i.backgroundColor)||(this.ctx.fillStyle=es(i.backgroundColor),this.ctx.fill()),[4,this.renderBackgroundImage(s.container)]):[3,2];case 1:v.sent(),this.ctx.restore(),i.boxShadow.slice(0).reverse().forEach(function(y){g.ctx.save();var C=Ac(s.curves),x=y.inset?0:aI,F=jT(C,-x+(y.inset?1:-1)*y.spread.number,(y.inset?1:-1)*y.spread.number,y.spread.number*(y.inset?-2:2),y.spread.number*(y.inset?-2:2));y.inset?(g.path(C),g.ctx.clip(),g.mask(F)):(g.mask(C),g.ctx.clip(),g.path(F)),g.ctx.shadowOffsetX=y.offsetX.number+x,g.ctx.shadowOffsetY=y.offsetY.number,g.ctx.shadowColor=es(y.color),g.ctx.shadowBlur=y.blur.number,g.ctx.fillStyle=y.inset?es(y.color):"rgba(0,0,0,1)",g.ctx.fill(),g.ctx.restore()}),v.label=2;case 2:l=0,h=0,u=r,v.label=3;case 3:return h<u.length?(m=u[h],m.style!==0&&!Hi(m.color)&&m.width>0?m.style!==2?[3,5]:[4,this.renderDashedDottedBorder(m.color,m.width,l,s.curves,2)]:[3,11]):[3,13];case 4:return v.sent(),[3,11];case 5:return m.style!==3?[3,7]:[4,this.renderDashedDottedBorder(m.color,m.width,l,s.curves,3)];case 6:return v.sent(),[3,11];case 7:return m.style!==4?[3,9]:[4,this.renderDoubleBorder(m.color,m.width,l,s.curves)];case 8:return v.sent(),[3,11];case 9:return[4,this.renderSolidBorder(m.color,l,s.curves)];case 10:v.sent(),v.label=11;case 11:l++,v.label=12;case 12:return h++,[3,3];case 13:return[2]}})})},t.prototype.renderDashedDottedBorder=function(s,i,A,r,a){return _s(this,void 0,void 0,function(){var l,h,u,m,g,v,y,C,x,F,I,T,U,D,O,R,O,R;return gs(this,function(st){return this.ctx.save(),l=eI(r,A),h=Lg(r,A),a===2&&(this.path(h),this.ctx.clip()),tn(h[0])?(u=h[0].start.x,m=h[0].start.y):(u=h[0].x,m=h[0].y),tn(h[1])?(g=h[1].end.x,v=h[1].end.y):(g=h[1].x,v=h[1].y),A===0||A===2?y=Math.abs(u-g):y=Math.abs(m-v),this.ctx.beginPath(),a===3?this.formatPath(l):this.formatPath(h.slice(0,2)),C=i<3?i*3:i*2,x=i<3?i*2:i,a===3&&(C=i,x=i),F=!0,y<=C*2?F=!1:y<=C*2+x?(I=y/(2*C+x),C*=I,x*=I):(T=Math.floor((y+x)/(C+x)),U=(y-T*C)/(T-1),D=(y-(T+1)*C)/T,x=D<=0||Math.abs(x-U)<Math.abs(x-D)?U:D),F&&(a===3?this.ctx.setLineDash([0,C+x]):this.ctx.setLineDash([C,x])),a===3?(this.ctx.lineCap="round",this.ctx.lineWidth=i):this.ctx.lineWidth=i*2+1.1,this.ctx.strokeStyle=es(s),this.ctx.stroke(),this.ctx.setLineDash([]),a===2&&(tn(h[0])&&(O=h[3],R=h[0],this.ctx.beginPath(),this.formatPath([new wt(O.end.x,O.end.y),new wt(R.start.x,R.start.y)]),this.ctx.stroke()),tn(h[1])&&(O=h[1],R=h[2],this.ctx.beginPath(),this.formatPath([new wt(O.end.x,O.end.y),new wt(R.start.x,R.start.y)]),this.ctx.stroke())),this.ctx.restore(),[2]})})},t.prototype.render=function(s){return _s(this,void 0,void 0,function(){var i;return gs(this,function(A){switch(A.label){case 0:return this.options.backgroundColor&&(this.ctx.fillStyle=es(this.options.backgroundColor),this.ctx.fillRect(this.options.x,this.options.y,this.options.width,this.options.height)),i=JT(s),[4,this.renderStack(i)];case 1:return A.sent(),this.applyEffects([]),[2,this.canvas]}})})},t})(o0),cI=function(e){return e instanceof Gv||e instanceof Wv?!0:e instanceof Uf&&e.type!==sc&&e.type!==ec},hI=function(e,t){switch(e){case 0:return Ac(t);case 2:return qT(t);case 1:default:return rc(t)}},uI=function(e){switch(e){case 1:return"center";case 2:return"right";case 0:default:return"left"}},dI=["-apple-system","system-ui"],fI=function(e){return/iPhone OS 15_(0|1)/.test(window.navigator.userAgent)?e.filter(function(t){return dI.indexOf(t)===-1}):e},pI=(function(e){bn(t,e);function t(s,i){var A=e.call(this,s,i)||this;return A.canvas=i.canvas?i.canvas:document.createElement("canvas"),A.ctx=A.canvas.getContext("2d"),A.options=i,A.canvas.width=Math.floor(i.width*i.scale),A.canvas.height=Math.floor(i.height*i.scale),A.canvas.style.width=i.width+"px",A.canvas.style.height=i.height+"px",A.ctx.scale(A.options.scale,A.options.scale),A.ctx.translate(-i.x,-i.y),A.context.logger.debug("EXPERIMENTAL ForeignObject renderer initialized ("+i.width+"x"+i.height+" at "+i.x+","+i.y+") with scale "+i.scale),A}return t.prototype.render=function(s){return _s(this,void 0,void 0,function(){var i,A;return gs(this,function(r){switch(r.label){case 0:return i=Pd(this.options.width*this.options.scale,this.options.height*this.options.scale,this.options.scale,this.options.scale,s),[4,mI(i)];case 1:return A=r.sent(),this.options.backgroundColor&&(this.ctx.fillStyle=es(this.options.backgroundColor),this.ctx.fillRect(0,0,this.options.width*this.options.scale,this.options.height*this.options.scale)),this.ctx.drawImage(A,-this.options.x*this.options.scale,-this.options.y*this.options.scale),[2,this.canvas]}})})},t})(o0),mI=function(e){return new Promise(function(t,s){var i=new Image;i.onload=function(){t(i)},i.onerror=s,i.src="data:image/svg+xml;charset=utf-8,"+encodeURIComponent(new XMLSerializer().serializeToString(e))})},gI=(function(){function e(t){var s=t.id,i=t.enabled;this.id=s,this.enabled=i,this.start=Date.now()}return e.prototype.debug=function(){for(var t=[],s=0;s<arguments.length;s++)t[s]=arguments[s];this.enabled&&(typeof window<"u"&&window.console&&typeof console.debug=="function"?console.debug.apply(console,Xa([this.id,this.getTime()+"ms"],t)):this.info.apply(this,t))},e.prototype.getTime=function(){return Date.now()-this.start},e.prototype.info=function(){for(var t=[],s=0;s<arguments.length;s++)t[s]=arguments[s];this.enabled&&typeof window<"u"&&window.console&&typeof console.info=="function"&&console.info.apply(console,Xa([this.id,this.getTime()+"ms"],t))},e.prototype.warn=function(){for(var t=[],s=0;s<arguments.length;s++)t[s]=arguments[s];this.enabled&&(typeof window<"u"&&window.console&&typeof console.warn=="function"?console.warn.apply(console,Xa([this.id,this.getTime()+"ms"],t)):this.info.apply(this,t))},e.prototype.error=function(){for(var t=[],s=0;s<arguments.length;s++)t[s]=arguments[s];this.enabled&&(typeof window<"u"&&window.console&&typeof console.error=="function"?console.error.apply(console,Xa([this.id,this.getTime()+"ms"],t)):this.info.apply(this,t))},e.instances={},e})(),wI=(function(){function e(t,s){var i;this.windowBounds=s,this.instanceName="#"+e.instanceCount++,this.logger=new gI({id:this.instanceName,enabled:t.logging}),this.cache=(i=t.cache)!==null&&i!==void 0?i:new HT(this,t)}return e.instanceCount=1,e})(),vI=function(e,t){return t===void 0&&(t={}),BI(e,t)};typeof window<"u"&&e0.setContext(window);var BI=function(e,t){return _s(void 0,void 0,void 0,function(){var s,i,A,r,a,l,h,u,m,g,v,y,C,x,F,I,T,U,D,O,st,R,st,Y,L,J,dt,ht,rt,Tt,It,Ht,tt,ct,lt,mt,At,St,Qt,Pt;return gs(this,function(Vt){switch(Vt.label){case 0:if(!e||typeof e!="object")return[2,Promise.reject("Invalid element provided as first argument")];if(s=e.ownerDocument,!s)throw new Error("Element is not attached to a Document");if(i=s.defaultView,!i)throw new Error("Document is not attached to a Window");return A={allowTaint:(Y=t.allowTaint)!==null&&Y!==void 0?Y:!1,imageTimeout:(L=t.imageTimeout)!==null&&L!==void 0?L:15e3,proxy:t.proxy,useCORS:(J=t.useCORS)!==null&&J!==void 0?J:!1},r=vd({logging:(dt=t.logging)!==null&&dt!==void 0?dt:!0,cache:t.cache},A),a={windowWidth:(ht=t.windowWidth)!==null&&ht!==void 0?ht:i.innerWidth,windowHeight:(rt=t.windowHeight)!==null&&rt!==void 0?rt:i.innerHeight,scrollX:(Tt=t.scrollX)!==null&&Tt!==void 0?Tt:i.pageXOffset,scrollY:(It=t.scrollY)!==null&&It!==void 0?It:i.pageYOffset},l=new ni(a.scrollX,a.scrollY,a.windowWidth,a.windowHeight),h=new wI(r,l),u=(Ht=t.foreignObjectRendering)!==null&&Ht!==void 0?Ht:!1,m={allowTaint:(tt=t.allowTaint)!==null&&tt!==void 0?tt:!1,onclone:t.onclone,ignoreElements:t.ignoreElements,inlineImages:u,copyStyles:u},h.logger.debug("Starting document clone with size "+l.width+"x"+l.height+" scrolled to "+-l.left+","+-l.top),g=new Pg(h,e,m),v=g.clonedReferenceElement,v?[4,g.toIFrame(s,l)]:[2,Promise.reject("Unable to find element in cloned iframe")];case 1:return y=Vt.sent(),C=Pf(v)||yT(v)?jx(v.ownerDocument):yc(h,v),x=C.width,F=C.height,I=C.left,T=C.top,U=yI(h,v,t.backgroundColor),D={canvas:t.canvas,backgroundColor:U,scale:(lt=(ct=t.scale)!==null&&ct!==void 0?ct:i.devicePixelRatio)!==null&&lt!==void 0?lt:1,x:((mt=t.x)!==null&&mt!==void 0?mt:0)+I,y:((At=t.y)!==null&&At!==void 0?At:0)+T,width:(St=t.width)!==null&&St!==void 0?St:Math.ceil(x),height:(Qt=t.height)!==null&&Qt!==void 0?Qt:Math.ceil(F)},u?(h.logger.debug("Document cloned, using foreign object rendering"),st=new pI(h,D),[4,st.render(v)]):[3,3];case 2:return O=Vt.sent(),[3,5];case 3:return h.logger.debug("Document cloned, element located at "+I+","+T+" with size "+x+"x"+F+" using computed rendering"),h.logger.debug("Starting DOM parsing"),R=zv(h,v),U===R.styles.backgroundColor&&(R.styles.backgroundColor=ei.TRANSPARENT),h.logger.debug("Starting renderer for element at "+D.x+","+D.y+" with size "+D.width+"x"+D.height),st=new lI(h,D),[4,st.render(R)];case 4:O=Vt.sent(),Vt.label=5;case 5:return(!((Pt=t.removeContainer)!==null&&Pt!==void 0)||Pt)&&(Pg.destroy(y)||h.logger.error("Cannot detach cloned iframe as it is not in the DOM anymore")),h.logger.debug("Finished rendering"),[2,O]}})})},yI=function(e,t,s){var i=t.ownerDocument,A=i.documentElement?Ro(e,getComputedStyle(i.documentElement).backgroundColor):ei.TRANSPARENT,r=i.body?Ro(e,getComputedStyle(i.body).backgroundColor):ei.TRANSPARENT,a=typeof s=="string"?Ro(e,s):s===null?ei.TRANSPARENT:4294967295;return t===i.documentElement?Hi(A)?Hi(r)?a:r:A:a};let Hl=null,tA=null;const CI=600;async function bI(){const e=document.getElementById("button-grid");if(!e)return _.warn("PrintService","Button grid element not found",null,"print"),null;try{const t=Math.min(window.devicePixelRatio||1,2),s=await vI(e,{scale:t,backgroundColor:"#ffffff",logging:!1,useCORS:!0}),i=FI(s);return _.debug("PrintService",`Captured button grid: ${i.width}x${i.height}`,null,"print"),i}catch(t){return _.error("PrintService","Failed to capture button grid",t,"print"),null}}function _I(){const e=document.getElementById("notation-grid"),t=document.getElementById("pitch-paint-canvas");if(document.getElementById("hover-canvas"),!e)return _.warn("PrintService","Notation grid canvas not found",null,"print"),null;const s=document.createElement("canvas");s.width=e.width,s.height=e.height;const i=s.getContext("2d");return i.drawImage(e,0,0),t&&t.width>0&&t.height>0&&(i.drawImage(t,0,0),_.debug("PrintService","Included paint layer in capture",null,"print")),_.debug("PrintService",`Captured pitch grid: ${s.width}x${s.height}`,null,"print"),s}function xI(){const e=document.getElementById("drum-grid");if(!e||e.width===0)return _.debug("PrintService","Drum grid not found or empty",null,"print"),null;const t=document.createElement("canvas");return t.width=e.width,t.height=e.height,t.getContext("2d").drawImage(e,0,0),_.debug("PrintService",`Captured drum grid: ${t.width}x${t.height}`,null,"print"),t}function EI(e){const t=document.createElement("canvas");t.width=e.width,t.height=e.height;const s=t.getContext("2d");s.drawImage(e,0,0);const i=s.getImageData(0,0,t.width,t.height),A=i.data;for(let r=0;r<A.length;r+=4){const a=A[r]*.299+A[r+1]*.587+A[r+2]*.114;A[r]=a,A[r+1]=a,A[r+2]=a}return s.putImageData(i,0,0),t}async function SI(e,t){_.debug("PrintService","Generating score canvas...",{printOptions:e,targetDimensions:t},"print");const s=[];if(e.includeButtonGrid){const D=await a0();D&&s.push({canvas:D,name:"buttons"})}const i=_I();if(i&&s.push({canvas:i,name:"pitch"}),e.includeDrums){const D=xI();D&&s.push({canvas:D,name:"drums"})}if(s.length===0)return _.warn("PrintService","No content captured for printing",null,"print"),null;e.colorMode==="bw"&&(s.forEach(D=>{D.canvas=EI(D.canvas)}),_.debug("PrintService","Applied black & white filter",null,"print"));const A=Math.max(...s.map(D=>D.canvas.width)),r=s.reduce((D,O)=>D+O.canvas.height,0),a=e.cropTop||0,l=e.cropBottom||1,h=e.cropLeft||0,u=e.cropRight||1,m=r*(l-a),g=A*(u-h),v=r*a,y=A*h;_.debug("PrintService",`Applying crop: top=${a.toFixed(2)}, bottom=${l.toFixed(2)}, left=${h.toFixed(2)}, right=${u.toFixed(2)}`,null,"print");const C=Math.min(t.width/g,t.height/m),x=document.createElement("canvas");x.width=g*C,x.height=m*C;const F=x.getContext("2d");F.fillStyle="#FFFFFF",F.fillRect(0,0,x.width,x.height);const I=document.createElement("canvas");I.width=A,I.height=r;const T=I.getContext("2d");let U=0;return s.forEach(({canvas:D,name:O})=>{T.drawImage(D,0,U),_.debug("PrintService",`Drew ${O} at y=${U}, height=${D.height}`,null,"print"),U+=D.height}),F.drawImage(I,y,v,g,m,0,0,x.width,x.height),_.debug("PrintService",`Generated composite canvas: ${x.width}x${x.height}`,null,"print"),x}const Pi={generateScoreCanvas:SI,async generateAndPrint(){const e=d.state.printOptions,t=300,s=(e.orientation==="landscape"?10.5:8)*t,i=(e.orientation==="landscape"?8:10.5)*t;_.info("PrintService","Generating print canvas at high resolution",{width:s,height:i,options:e},"print");const A=await this.generateScoreCanvas(e,{width:s,height:i});if(!A){_.error("PrintService","Failed to generate print canvas",null,"print");return}const r=document.getElementById("print-staging-area");r.innerHTML="";const a=document.getElementById("print-style-rules");a.textContent=`@page { size: ${e.orientation}; margin: 0.25in; }`;const l=document.createElement("img");l.src=A.toDataURL("image/png"),l.style.width="100%",l.style.height="auto",r.appendChild(l),_.info("PrintService","Opening print dialog",null,"print"),setTimeout(()=>window.print(),100)},async prefetchButtonGridSnapshot(){try{await a0()}catch(e){_.warn("PrintService","Button grid prefetch failed",e,"print")}},invalidateButtonGridSnapshot(){l0()}};function FI(e){if(!e)return e;const t=document.getElementById("notation-grid"),s=(t==null?void 0:t.width)||e.width;if(!s||s===e.width)return e;const i=s/e.width,A=Math.max(1,Math.round(e.height*i)),r=document.createElement("canvas");return r.width=s,r.height=A,(r.getContext("2d",{willReadFrequently:!0})||r.getContext("2d")).drawImage(e,0,0,r.width,r.height),r}async function a0(){return Hl||tA||(tA=(async()=>{await TI();const e=await bI();return Hl=e,tA=null,e})().catch(e=>{throw tA=null,e}),tA)}function TI(){return new Promise(e=>{typeof window.requestIdleCallback=="function"?requestIdleCallback(e,{timeout:CI}):requestAnimationFrame(()=>e())})}function l0(){Hl=null,tA=null}typeof window<"u"&&window.addEventListener("resize",()=>l0());function yn(e,t){if(!e)return`rgba(204, 204, 204, ${t})`;const s=parseInt(e.slice(gw,om),Il),i=parseInt(e.slice(om,am),Il),A=parseInt(e.slice(am,jC),Il);return`rgba(${s}, ${i}, ${A}, ${t})`}function Qc(e,t){if(!e||typeof e!="string")return YC;const s=parseInt(e.slice(gw),Il),i=t<0?JC:ZC,A=t<0?t*-1:t,r=s>>16,a=s>>8&255,l=s&255;return"#"+(16777216+(Math.round((i-r)*A)+r)*65536+(Math.round((i-a)*A)+a)*256+(Math.round((i-l)*A)+l)).toString(16).slice(1)}const II=`<svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24">\r
  <circle cx="12" cy="12" r="10" stroke="currentColor" stroke-width="1.5" fill="none"/>\r
  <path d="M 12 12 L 22 12 A 10 10 0 0 0 12 2 Z" fill="currentColor"/>\r
</svg>`,QI=`<svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24">\r
  <circle cx="12" cy="12" r="10" stroke="currentColor" stroke-width="1.5" fill="none"/>\r
  <path d="M 12 12 L 22 12 A 10 10 0 0 0 12 2 Z" fill="currentColor" transform="rotate(90, 12, 12)"/>\r
</svg>`,MI=`<svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24">\r
  <circle cx="12" cy="12" r="10" stroke="currentColor" stroke-width="1.5" fill="none"/>\r
  <path d="M 12 12 L 22 12 A 10 10 0 0 0 12 2 Z" fill="currentColor" transform="rotate(180, 12, 12)"/>\r
</svg>`,UI=`<svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24">\r
  <circle cx="12" cy="12" r="10" stroke="currentColor" stroke-width="1.5" fill="none"/>\r
  <path d="M 12 12 L 22 12 A 10 10 0 0 0 12 2 Z" fill="currentColor" transform="rotate(270, 12, 12)"/>\r
</svg>`;_.moduleLoaded("HarmonicBins with Columnar Structure");function Nd(e,...t){}const Rl={0:II,90:QI,180:MI,270:UI},on=Cr;let ds,ze,Ne=new Float32Array(on).fill(0),Yt,xs=new Float32Array(on).fill(0);const kf=[],Vd=[];let ar=!1,Zs=null;const JA=new Array(on).fill(null);let wl=!1;function To(e,t){const{blend:s,cutoff:i,resonance:A}=t,r=(i-1)/30,a=20,l=e-r,h=r-e;let u=1/(1+Math.pow(Math.max(0,l*a),2)),m=1/(1+Math.pow(Math.max(0,h*a),2));const g=.01;u<g&&(u=0),m<g&&(m=0);const v=u*m;let y;s<=1?y=m*(1-s)+v*s:y=v*(2-s)+u*(s-1);const C=1-(A||0)/105,x=Math.max(.01,.2*C*C),F=Math.exp(-Math.pow((e-r)/x,2)),I=(A||0)/100*.6,T=y+F*I,U=Math.max(0,Math.min(1,T));return U<g?0:U}function PI(e,t){const s=t/100;return 1-s+s*e}const vl=new Float32Array(on).fill(1);new Float32Array(on).fill(0);function sa(e,t){const s=t.mix||0;if(s===0)return new Float32Array(e);const i=new Float32Array(e.length),A=s/100;for(let r=0;r<e.length;r++){const a=e[r],l=(r+.5)/on,h=To(l,t);if(h<a){const m=(a-h)*A;i[r]=a-m}else i[r]=a;i[r]=Math.max(0,i[r])}return i}function ac(e){const t=d.state.timbres[e];if(!t)return new Float32Array(on);const s=t.filter;return s&&s.enabled!==!1&&(s.mix||0)>0?sa(t.coeffs,s):new Float32Array(t.coeffs)}function Wd(){var l;if((!ds||!ze||!Zs)&&(ds=document.getElementById("filter-overlay-canvas"),Zs=document.querySelector(".harmonic-bins-grid"),ds&&(ze=ds.getContext("2d"))),!ds||!ze||!Zs)return;Zs.getBoundingClientRect();const{width:e,height:t}=ds;ze.clearRect(0,0,e,t);const i=t*.95,A=t,r=(l=d.state.timbres[Yt])==null?void 0:l.filter,a=r&&r.enabled!==!1;if(r&&a){const h=r.mix||0;if(h===0){vl.fill(1);return}const u=[];for(let C=0;C<on;C++){const x=(C+.5)/on,F=To(x,r);vl[C]=PI(F,h),u.push({bin:C+1,rawFilterAmp:F.toFixed(3),afterMix:vl[C].toFixed(3)})}ze.beginPath();const m=2;for(let C=0;C<=e;C+=m){const x=C/e,F=To(x,r),I=A-F*i;C===0?ze.moveTo(C,I):ze.lineTo(C,I)}const v=.4+h/100*.6;ze.strokeStyle=yn(Qc(Yt,-.3),v),ze.lineWidth=2.5,ze.stroke();const y=h/100;if(y>0){ze.beginPath(),ze.moveTo(0,0),ze.lineTo(e,0);const C=To(1,r),x=A-C*i;ze.lineTo(e,x);for(let F=e;F>=0;F-=2){const I=F/e,T=To(I,r),U=A-T*i;ze.lineTo(F,U)}ze.closePath(),ze.fillStyle=`rgba(255, 255, 255, ${y})`,ze.fill()}}else vl.fill(1)}function Wo(){kf.forEach((e,t)=>{const s=e.sliderTrack.querySelector(".slider-fill"),i=e.sliderTrack.querySelector(".harmonic-label-internal"),A=Ne[t];if(s.style.height=`${A*100}%`,A>0){const a=Qc(Yt,-.1);s.style.backgroundColor=yn(a,1)}else s.style.backgroundColor="transparent";const r=s.querySelector("canvas");r&&r.remove(),A>.1?(i.style.color="rgba(255, 255, 255, 0.35)",i.style.textShadow="0 0 2px rgba(0,0,0,0.3)"):(i.style.color="rgba(51, 51, 51, 0.5)",i.style.textShadow="0 0 1px rgba(255,255,255,0.3)")}),Wd()}function Rg(e,t=null){var h,u,m,g;if(Nd("log","[BINS DRAG] handleBinPointerEvent called",{clientX:e.clientX,clientY:e.clientY}),_.debug("HarmonicBins","handleBinPointerEvent called",{target:e.target.className},"filter"),e.target.classList.contains("phase-button")||e.target.closest(".phase-button")||e.target.tagName==="path"||e.target.tagName==="svg"){_.debug("HarmonicBins","Blocking phase button interaction in handleBinPointerEvent",null,"filter");return}if(t===null){const v=Zs.getBoundingClientRect(),y=e.clientX-v.left,C=v.width/on;t=Math.floor(y/C),t=Math.max(0,Math.min(on-1,t))}_.debug("HarmonicBins","handleBinPointerEvent - binIndex",{binIndex:t},"filter");const i=kf[t].sliderTrack.getBoundingClientRect(),A=e.clientY-i.top,r=i.height;Ne[t];const a=(r-A)/r,l=Math.max(0,Math.min(1,a));if(Nd("log","[BINS DRAG] Setting bin",t+1,"value:",l.toFixed(3)),(((u=(h=d.state.timbres[Yt])==null?void 0:h.adsr)==null?void 0:u.release)||0)*1e3,l===0){_.debug("HarmonicBins","Setting coefficient to zero immediately for bin",{binIndex:t},"filter");const v=new Float32Array(d.state.timbres[Yt].coeffs);v[t]=0,Ne[t]=0,d.setHarmonicCoefficients(Yt,v),JA[t]&&(clearTimeout(JA[t]),JA[t]=null),ar||(Kt.triggerAttack("C4",Yt),d.emit("spacebarPlayback",{color:Yt,isPlaying:!0}),ar=!0);const y=(m=d.state.timbres[Yt])==null?void 0:m.filter;y&&y.enabled!==!1&&(y.mix||0)>0&&sa(v,y),window.staticWaveformVisualizer&&window.staticWaveformVisualizer.generateWaveform&&window.staticWaveformVisualizer.generateWaveform(),_.debug("HarmonicBins",`Set coefficient H${t+1} to 0 for color ${Yt}`,null,"filter")}else{JA[t]&&(clearTimeout(JA[t]),JA[t]=null),ar||(Kt.triggerAttack("C4",Yt),d.emit("spacebarPlayback",{color:Yt,isPlaying:!0}),ar=!0),_.debug("HarmonicBins","BEFORE creating newCoeffs - store coeffs",{coeffs:d.state.timbres[Yt].coeffs},"filter");const v=new Float32Array(d.state.timbres[Yt].coeffs);_.debug("HarmonicBins","AFTER copying to newCoeffs",{newCoeffs:v},"filter"),v[t]=l,Ne[t]=l,_.debug("HarmonicBins",`AFTER setting newCoeffs[${t}] = ${l}`,{newCoeffs:v},"filter"),d.setHarmonicCoefficients(Yt,v);const y=(g=d.state.timbres[Yt])==null?void 0:g.filter;y&&y.enabled!==!1&&(y.mix||0)>0&&sa(v,y),window.staticWaveformVisualizer&&window.staticWaveformVisualizer.generateWaveform&&window.staticWaveformVisualizer.generateWaveform(),_.debug("HarmonicBins",`Updated coefficient H${t+1} to ${l} for color ${Yt}`,null,"filter"),_.debug("HarmonicBins","All coefficients",{newCoeffs:v},"filter")}Wo()}function Gd(e,t,s){const i=s.coeffs,A=s.phases||new Float32Array(i.length).fill(0);let r=!0,a=!0;if(e.length!==i.length)r=!1;else for(let h=0;h<e.length;h++)if(Math.abs(e[h]-i[h])>.001){r=!1;break}if(t.length!==A.length)a=!1;else for(let h=0;h<t.length;h++)if(Math.abs(t[h]-A[h])>.001){a=!1;break}return r&&a}function Og(e){if(!e)return;Yt=e;const t=d.state.timbres[e];t&&(t.filter?t.filter.enabled===void 0&&(t.filter.enabled=!0):t.filter={enabled:!0,blend:0,cutoff:16,resonance:0,type:"lowpass",mix:0},_.debug("HarmonicBins","updateForNewColor - timbre.coeffs",{coeffs:t.coeffs},"filter"),_.debug("HarmonicBins","updateForNewColor - timbre.phases",{phases:t.phases},"filter"),Ne&&Array.from(Ne),xs&&Array.from(xs),Ne=new Float32Array(t.coeffs),t.phases?xs=new Float32Array(t.phases):xs=new Float32Array(Ne.length).fill(0),Gd(Ne,xs,t),_.debug("HarmonicBins","updateForNewColor - final coeffs",{coeffs:Ne},"filter"),_.debug("HarmonicBins","updateForNewColor - final phases",{phases:xs},"filter"),Vd.forEach(({phaseBtn:s},i)=>{if(!s)return;let r=(xs[i]||0)%(2*Math.PI);r<0&&(r+=2*Math.PI);const a=.1;let l=0;Math.abs(r-Math.PI/2)<a?l=90:Math.abs(r-Math.PI)<a?l=180:Math.abs(r-3*Math.PI/2)<a&&(l=270),s.innerHTML=Rl[l]}),Wo())}function kI(){var l;const e=document.querySelector(".filter-container"),t=e==null?void 0:e.querySelector(".filter-bins-wrapper"),s=e==null?void 0:e.querySelector(".filter-vertical-blend-wrapper");if(!e||!t||!s){_.error("HarmonicBins","Missing required elements - aborting init",null,"audio");return}Zs=document.createElement("div"),Zs.className="harmonic-bins-grid";for(let h=0;h<on;h++){const u=document.createElement("div");u.className="slider-column";const m=document.createElement("div");m.className="slider-track";const g=document.createElement("div");g.className="slider-fill",m.appendChild(g);const v=document.createElement("div");v.className="harmonic-label-internal",v.textContent=`${h+1}`,m.appendChild(v),u.appendChild(m);const y=document.createElement("button");y.className="phase-button",y.innerHTML=Rl[0],y.dataset.binIndex=h,y.addEventListener("pointerenter",()=>{var C,x,F,I;if(wl){const U=$.now();if(d.state.timbres[Yt],(F=(x=(C=Kt.synths)==null?void 0:C[Yt])==null?void 0:x.activeNotes)!=null&&F.C4){const D=Kt.synths[Yt].activeNotes.C4;(I=D.oscillators)!=null&&I[h]&&D.oscillators[h].volume.linearRampTo(-1/0,.015,U)}setTimeout(()=>{var R;const D=new Float32Array(d.state.timbres[Yt].coeffs);D[h]=0,Ne[h]=0,d.setHarmonicCoefficients(Yt,D);const O=(R=d.state.timbres[Yt])==null?void 0:R.filter;O&&O.enabled!==!1&&(O.mix||0)>0&&sa(D,O),Wo()},.015*1e3)}}),y.addEventListener("click",C=>{if(wl){C.preventDefault();return}_.debug("HarmonicBins","Phase button click handler started",null,"filter"),_.debug("HarmonicBins","Current coeffs before phase change",{coeffs:Ne},"filter"),C.preventDefault();const x=new Float32Array(xs),F=new Float32Array(xs);let T=(F[h]||0)%(2*Math.PI);T<0&&(T+=2*Math.PI);const U=.1;let D=0;Math.abs(T)<U?D=Math.PI/2:Math.abs(T-Math.PI/2)<U?D=Math.PI:Math.abs(T-Math.PI)<U?D=3*Math.PI/2:D=0,F[h]=D,xs=F,window.staticWaveformVisualizer&&window.staticWaveformVisualizer.startPhaseTransition&&window.staticWaveformVisualizer.startPhaseTransition(x,F,h),d.setHarmonicPhases(Yt,F);const O=D===0?0:Math.abs(D-Math.PI/2)<U?90:Math.abs(D-Math.PI)<U?180:270;y.innerHTML=Rl[O],_.debug("HarmonicBins",`Phase button clicked for H${h+1}, new phase: ${O}`,null,"filter")}),u.appendChild(y),Zs.appendChild(u),kf.push({column:u,label:v,sliderTrack:m,sliderFill:g,phaseBtn:y}),Vd.push({phaseBtn:y})}Zs.addEventListener("pointerdown",h=>{if(Nd("log","[BINS DRAG] Pointerdown event fired",{target:h.target,className:h.target.className}),h.target.classList.contains("phase-button")||h.target.closest(".phase-button")){_.debug("HarmonicBins","Pointerdown blocked - phase button clicked",null,"filter");return}_.debug("HarmonicBins","Pointerdown - handling bin interaction",null,"filter"),h.preventDefault(),wl=!0,Kt.triggerAttack("C4",Yt),d.emit("spacebarPlayback",{color:Yt,isPlaying:!0}),ar=!0,Rg(h);const u=g=>Rg(g),m=()=>{var v;window.removeEventListener("pointermove",u),window.removeEventListener("pointerup",m),wl=!1;const g=!!((v=window.staticWaveformVisualizer)!=null&&v.generateWaveform);d.recordState(),Kt.triggerRelease("C4",Yt),d.emit("spacebarPlayback",{color:Yt,isPlaying:!1}),ar=!1,g?setTimeout(()=>{window.staticWaveformVisualizer.generateWaveform()},0):_.warn("HarmonicBins","Static waveform visualizer not ready when drag ended",null,"audio")};window.addEventListener("pointermove",u),window.addEventListener("pointerup",m)}),ds=document.createElement("canvas"),ds.id="filter-overlay-canvas",ds.className="filter-overlay-canvas",ds.style.pointerEvents="none",ze=ds.getContext("2d"),Zs.appendChild(ds);const i=document.createElement("div");i.className="vertical-blend-wrapper";const A=document.createElement("div");A.id="vertical-blend-track";const r=document.createElement("div");r.id="vertical-blend-thumb",r.textContent="M",A.appendChild(r),i.appendChild(A),t.appendChild(Zs),s.appendChild(i);const a=()=>{const h=ds.getBoundingClientRect();(ds.width!==h.width||ds.height!==h.height)&&(ds.width=h.width,ds.height=h.height,Wd())};Yt=((l=d.state.selectedNote)==null?void 0:l.color)||"#4a90e2",Og(Yt),d.on("timbreChanged",h=>{if(h===Yt){_.debug("HarmonicBins","timbreChanged event - checking what changed",null,"filter");const u=d.state.timbres[h],m=u.coeffs,g=u.phases;let v=!1;if(_.debug("HarmonicBins","Comparing coefficients...",null,"filter"),_.debug("HarmonicBins","Local coeffs",{coeffs:Ne},"filter"),_.debug("HarmonicBins","Store coeffs",{newCoeffs:m},"filter"),!Ne||Ne.length!==m.length)_.debug("HarmonicBins","Array length mismatch - coeffsChanged = true",null,"filter"),v=!0;else for(let y=0;y<m.length;y++){const C=Math.abs(Ne[y]-m[y]);if(C>.001){_.debug("HarmonicBins",`Coefficient ${y} changed: ${Ne[y]} -> ${m[y]} (diff: ${C})`,null,"filter"),v=!0;break}}_.debug("HarmonicBins","Force syncing local coeffs with store",null,"filter"),Gd(Ne||new Float32Array(12),xs||new Float32Array(12),u),Ne=new Float32Array(m),g?xs=new Float32Array(g):xs=new Float32Array(Ne.length).fill(0),Gd(Ne,xs,u),v?(_.debug("HarmonicBins","Coefficients changed - updating visuals",null,"filter"),Wo()):(_.debug("HarmonicBins","No coefficient changes detected - but local coeffs synced",null,"filter"),Wd()),Vd.forEach(({phaseBtn:y},C)=>{if(!y)return;let F=(xs[C]||0)%(2*Math.PI);F<0&&(F+=2*Math.PI);const I=.1;let T=0;Math.abs(F-Math.PI/2)<I?T=90:Math.abs(F-Math.PI)<I?T=180:Math.abs(F-3*Math.PI/2)<I&&(T=270),y.innerHTML=Rl[T]})}}),d.on("noteChanged",({newNote:h})=>{h.color&&h.color!==Yt&&Og(h.color)}),d.on("filterChanged",h=>{if(h===Yt){Wo();const u=d.state.timbres[Yt],m=u==null?void 0:u.filter;m&&m.enabled!==!1&&(m.mix||0)>0?sa(u.coeffs,m):new Float32Array(u.coeffs)}}),new ResizeObserver(a).observe(Zs),a(),_.info("HarmonicBins","Initialized with columnar div structure and perfect alignment",null,"filter")}_.moduleLoaded("SynthEngine");const lc=32,c0=1/Math.sqrt(lc),DI=200,LI=50,HI=16,RI=-3,OI=500,NI=2e3,Qn={};let Ei,ZA,Ku,Bl,cc,bs={},lr=0,go=lc,Ol=null,Nl=null,qu=0;function VI(){if(!Ei)return;const e=$.now();if(lr===0){go=.01*lc+(1-.01)*go;return}const t=1-Math.exp(-.016/(DI/1e3)),s=Math.max(1,lr);go=t*s+(1-t)*go;const i=Math.sqrt(lc/go),A=c0*i;Ei.gain.rampTo(A,LI/1e3,e)}function h0(){Ol!==null&&(clearInterval(Ol),Ol=null)}function WI(){h0(),Ol=setInterval(()=>VI(),HI)}function u0(){Nl!==null&&(clearInterval(Nl),Nl=null)}function GI(){u0(),cc&&(qu=0,Nl=setInterval(()=>{const e=cc.getValue();if(e>RI){const t=Date.now();t-qu>=NI&&(qu=t,_.warn("SynthEngine","Limiter input approaching clipping threshold",{level:e},"audio"))}},OI))}class KI extends $.Synth{constructor(t){super(t),this.presetGain=new $.Gain(t.gain||1),this.vibratoLFO=new $.LFO(0,0),this.vibratoDepth=new $.Scale(-1,1),this.vibratoGain=new $.Gain(0),this.vibratoLFO.connect(this.vibratoDepth),this.vibratoDepth.connect(this.vibratoGain),this.vibratoGain.connect(this.oscillator.frequency),this.tremoloLFO=new $.LFO(0,0),this.tremoloDepth=new $.Scale(0,1),this.tremoloGain=new $.Gain(1),this.tremoloLFO.connect(this.tremoloDepth),this.tremoloDepth.connect(this.tremoloGain.gain),this.hpFilter=new $.Filter({type:"highpass"}),this.lpFilterForBP=new $.Filter({type:"lowpass"}),this.lpFilterSolo=new $.Filter({type:"lowpass"}),this.hpOutput=new $.Gain,this.bpOutput=new $.Gain,this.lpOutput=new $.Gain,this.hp_bp_fade=new $.CrossFade(0),this.main_fade=new $.CrossFade(0),this.wetDryFade=new $.CrossFade(0),this.oscillator.connect(this.presetGain),this.presetGain.connect(this.wetDryFade.a),this.presetGain.connect(this.hpFilter),this.hpFilter.connect(this.hpOutput),this.hpFilter.connect(this.lpFilterForBP),this.lpFilterForBP.connect(this.bpOutput),this.presetGain.connect(this.lpFilterSolo),this.lpFilterSolo.connect(this.lpOutput),this.hpOutput.connect(this.hp_bp_fade.a),this.bpOutput.connect(this.hp_bp_fade.b),this.lpOutput.connect(this.main_fade.b),this.hp_bp_fade.connect(this.main_fade.a),this.main_fade.connect(this.wetDryFade.b),this.wetDryFade.connect(this.tremoloGain),this.tremoloGain.connect(this.envelope),t.filter&&this._setFilter(t.filter),t.vibrato?this._setVibrato(t.vibrato):this._setVibrato({speed:0,span:0}),t.tremelo?this._setTremolo(t.tremelo):this._setTremolo({speed:0,span:0})}_setPresetGain(t){this.presetGain&&(this.presetGain.gain.value=t)}_setVibrato(t,s=$.now()){if(this.vibratoLFO&&this.vibratoGain){const i=t.speed/100*16;if(t.speed===0||t.span===0){this.vibratoLFO.stop(s),this.vibratoLFO.frequency.value=0,this.vibratoGain.gain.value=0;return}this.vibratoLFO.state!=="started"&&this.vibratoLFO.start(s),this.vibratoLFO.frequency.value=i;const r=t.span/100*50,a=r/1200,u=440*(Math.pow(2,a)-1);this.vibratoGain.gain.value=u,_.debug("SynthEngine","Audio vibrato gain set",{hzDeviation:u,centsAmplitude:r},"audio")}}_setTremolo(t,s=$.now()){if(this.tremoloLFO&&this.tremoloGain){const i=t.speed/100*16;if(t.speed===0||t.span===0){this.tremoloLFO.stop(s),this.tremoloLFO.frequency.value=0,this.tremoloGain.gain.cancelScheduledValues(s),this.tremoloGain.gain.value=1;return}this.tremoloLFO.state!=="started"&&this.tremoloLFO.start(s),this.tremoloLFO.frequency.value=i;const A=t.span/100,r=Math.max(0,1-A),a=1;this.tremoloDepth.min=r,this.tremoloDepth.max=a}}_setFilter(t){this.wetDryFade.fade.value=t.enabled?1:0;const s=$.Midi(t.cutoff+35).toFrequency(),i=t.resonance/100*12+.1;this.hpFilter.set({frequency:s,Q:i}),this.lpFilterForBP.set({frequency:s,Q:i}),this.lpFilterSolo.set({frequency:s,Q:i});const A=t.blend;A<=1?(this.main_fade.fade.value=0,this.hp_bp_fade.fade.value=A):(this.main_fade.fade.value=A-1,this.hp_bp_fade.fade.value=1)}}const Kt={init(){typeof this.stopBackgroundMonitors=="function"&&this.stopBackgroundMonitors(),Ei=new $.Gain(c0),ZA=new $.Volume(0),Ku=new $.Compressor({threshold:-12,ratio:3,attack:.01,release:.1,knee:6}),Bl=new $.Limiter(-3),cc=new $.Meter,Ei.connect(ZA),ZA.connect(Ku),Ku.connect(Bl),Bl.toDestination(),Bl.connect(cc),GI();for(const e in d.state.timbres){const t=d.state.timbres[e],s=ac(e),i=s.reduce((h,u)=>h+Math.abs(u),0),A=i>1?s.map(h=>h/i):s,r=t.gain||1,a=new $.PolySynth({voice:KI,options:{oscillator:{type:"custom",partials:Array.from(A)},envelope:t.adsr,filter:t.filter,vibrato:t.vibrato,tremelo:t.tremelo,gain:r}}).connect(Ei);window.audioEffectsManager&&window.audioEffectsManager.applySynthEffects(a,e,Ei);const l=a.triggerAttack;a.triggerAttack=function(...h){const u=l.apply(this,h);return setTimeout(()=>{const m=this._activeVoices;window.audioEffectsManager?m&&m.size>0?m.forEach(g=>{g.effectsApplied||(window.audioEffectsManager.applyEffectsToVoice(g,e),g.effectsApplied=!0)}):this._voices&&Array.isArray(this._voices)&&this._voices.forEach(g=>{g&&!g.effectsApplied&&(window.audioEffectsManager.applyEffectsToVoice(g,e),g.effectsApplied=!0)}):m&&m.size>0?m.forEach(g=>{g._setVibrato&&g.vibratoApplied!==!0&&(g._setVibrato(this._currentVibrato),g.vibratoApplied=!0),g._setTremolo&&g.tremoloApplied!==!0&&(g._setTremolo(this._currentTremolo),g.tremoloApplied=!0)}):this._voices&&Array.isArray(this._voices)&&this._voices.forEach(g=>{g&&g._setVibrato&&g.vibratoApplied!==!0&&(g._setVibrato(this._currentVibrato),g.vibratoApplied=!0),g&&g._setTremolo&&g.tremoloApplied!==!0&&(g._setTremolo(this._currentTremolo),g.tremoloApplied=!0)})},10),u},a._currentVibrato=t.vibrato,a._currentTremolo=t.tremelo,a._currentFilter=t.filter,Qn[e]=a,_.debug("SynthEngine",`Created filtered synth for color: ${e}`,null,"audio")}d.on("timbreChanged",e=>{this.updateSynthForColor(e)}),d.on("filterChanged",e=>{this.updateSynthForColor(e)}),d.on("audioEffectChanged",({color:e})=>{this.updateSynthForColor(e)}),d.on("volumeChanged",e=>this.setVolume(e)),WI(),_.info("SynthEngine","Initialized with multi-timbral support",null,"audio"),window.synthEngine=this},updateSynthForColor(e){const t=d.state.timbres[e],s=Qn[e];if(!s||!t)return;t.vibrato||(t.vibrato={speed:0,span:0},_.debug("SynthEngine",`Initialized vibrato for color ${e}`,t.vibrato,"audio")),t.tremelo||(t.tremelo={speed:0,span:0},_.debug("SynthEngine",`Initialized tremolo for color ${e}`,t.tremelo,"audio")),_.debug("SynthEngine",`Updating timbre for color ${e}`,null,"audio");const i=ac(e),A=i.reduce((l,h)=>l+Math.abs(h),0),r=A>1?i.map(l=>l/A):i;s.set({oscillator:{partials:Array.from(r)},envelope:t.adsr}),window.audioEffectsManager&&window.audioEffectsManager.applySynthEffects(s,e,Ei),s._currentVibrato=t.vibrato,s._currentTremolo=t.tremelo,s._currentFilter=t.filter;const a=s._activeVoices;a&&a.size>0?a.forEach(l=>{if(l._setFilter&&l._setFilter(t.filter),l._setVibrato&&(l._setVibrato(t.vibrato),l.vibratoApplied=!0),l._setTremolo&&(l._setTremolo(t.tremelo),l.tremoloApplied=!0),l._setPresetGain){const h=t.gain||1;l._setPresetGain(h)}}):s._voices&&Array.isArray(s._voices)&&s._voices.forEach(l=>{if(l&&l._setVibrato&&(l._setVibrato(t.vibrato),l.vibratoApplied=!0),l&&l._setTremolo&&(l._setTremolo(t.tremelo),l.tremoloApplied=!0),l&&l._setFilter&&l._setFilter(t.filter),l&&l._setPresetGain){const h=t.gain||1;l._setPresetGain(h)}})},setVolume(e){ZA&&(ZA.volume.value=e)},async playNote(e,t,s=$.now()){var a;await(window.initAudio||(()=>$.start()))();const A=(a=d.state.selectedNote)==null?void 0:a.color,r=A?Qn[A]:null;r&&r.triggerAttackRelease(e,t,s)},triggerAttack(e,t,s=$.now(),i=!1){const A=Qn[t];if(A)if(lr++,i&&window.getDrumVolume){const r=window.getDrumVolume(),a=A.volume.value,l=a+20*Math.log10(r);A.volume.value=l,A.triggerAttack(e,s),setTimeout(()=>{A&&A.volume&&(A.volume.value=a)},100)}else A.triggerAttack(e,s)},triggerRelease(e,t,s=$.now()){const i=Qn[t];i&&(i.triggerRelease(e,s),lr=Math.max(0,lr-1))},releaseAll(){for(const e in Qn)Qn[e].releaseAll();lr=0},createWaveformAnalyzer(e){const t=Qn[e];return t?(bs[e]||(bs[e]=new $.Analyser("waveform",1024),t.connect(bs[e]),_.debug("SynthEngine",`Created waveform analyzer for color: ${e}`,null,"waveform")),bs[e]):(_.warn("SynthEngine",`No synth found for color: ${e}`,null,"audio"),null)},getWaveformAnalyzer(e){return bs[e]||null},getAllWaveformAnalyzers(){const e=new Map;for(const t in bs)bs[t]&&e.set(t,bs[t]);return e},removeWaveformAnalyzer(e){bs[e]&&(bs[e].dispose(),delete bs[e],_.debug("SynthEngine",`Removed waveform analyzer for color: ${e}`,null,"waveform"))},disposeAllWaveformAnalyzers(){for(const e in bs)bs[e]&&bs[e].dispose();bs={},_.debug("SynthEngine","Disposed all waveform analyzers",null,"waveform")},getSynth(e){return Qn[e]||null},getAllSynths(){return{...Qn}},getMainVolumeNode(){return ZA||null},getMasterGainNode(){return Ei||null},stopBackgroundMonitors(){u0(),h0()},teardown(){this.stopBackgroundMonitors(),this.disposeAllWaveformAnalyzers(),_.debug("SynthEngine","Stopped SynthEngine background monitors",null,"audio")}},Ms={adsrComponent:null};class qI{constructor(){this.elements=new Map,this.initialized=!1}init(){this.initialized||(this.cacheElement("notationGrid","notation-grid"),this.cacheElement("playheadCanvas","playhead-canvas"),this.cacheElement("hoverCanvas","hover-canvas"),this.cacheElement("drumGrid","drum-grid"),this.cacheElement("drumHoverCanvas","drum-hover-canvas"),this.cacheElement("pitchPaintCanvas","pitch-paint-canvas"),this.cacheElement("appContainer","app-container"),this.cacheElement("pitchGridWrapper","pitch-grid-wrapper"),this.cacheElement("drumGridWrapper","drum-grid-wrapper"),this.cacheElement("eraserButton","eraser-tool-button"),this.cacheElement("playButton","play-button"),this.cacheElement("stopButton","stop-button"),this.cacheElement("clearButton","clear-button"),this.cacheElement("loopButton","loop-button"),this.cacheElement("undoButton","undo-button"),this.cacheElement("redoButton","redo-button"),this.cacheElement("noteBankContainer","note-bank-container"),this.cacheElement("tonicModeGrid","tonic-mode-grid"),this.cacheElement("degreeVisibilityToggle","degree-visibility-toggle"),this.cacheElement("degreeModeToggle","degree-mode-toggle"),this.cacheElement("flatBtn","flat-toggle-btn"),this.cacheElement("sharpBtn","sharp-toggle-btn"),this.cacheElement("frequencyBtn","hz-toggle-btn"),this.cacheElement("focusColoursToggle","focus-colours-toggle"),this.cacheElement("harmonyContainerMain","chordShape-container"),this.cacheElement("tempoSlider","tempo-slider"),this.cacheElement("volumeSlider","vertical-volume-slider"),this.initialized=!0)}cacheElement(t,s){const i=document.getElementById(s);i&&this.elements.set(t,i)}get(t){return this.initialized&&this.elements.get(t)||null}getMultiple(...t){const s={};return t.forEach(i=>{s[i]=this.get(i)}),s}has(t){return this.elements.has(t)}refresh(){this.elements.clear(),this.initialized=!1,this.init()}getStats(){const t=this.elements.size,s=Array.from(this.elements.values()).filter(i=>i!==null).length;return{totalCached:t,foundElements:s,missingElements:t-s}}}const uA=new qI;let d0=[],f0=0,vn=[0],p0=0;function zI(e=[],t=0){vn=[0];let s=0;for(let i=0;i<e.length;i++)vn[i]=s,s+=(e[i]||0)*t;vn[e.length]=s,p0=Math.max(0,e.length-2)}function $I({timeMap:e=[],musicalEndTime:t=0,columnWidths:s=[],cellWidth:i=0}={}){d0=Array.isArray(e)?[...e]:[],f0=Number(t)||0,zI(s,i)}function Kd(){return d0}function XI(){return f0}function Er(e){return!Array.isArray(vn)||vn.length===0||e<=0?0:e>=vn.length?vn[vn.length-1]??0:vn[e]??vn[vn.length-1]??0}function Df(e){return Er(e+1)-Er(e)}function YI(){return p0}class jI{constructor(){this.canvas=null,this.ctx=null,this.animationFrameId=null,this._lastColumnIndex=null,this._lastColumnProgress=0,this._lastDebugLogTime=0,this.activeAnimations=new Map,this.popDuration={scaleUp:100,scaleDown:300},this.popScale=1.5}initialize(){this.canvas=document.getElementById("drum-playhead-canvas"),this.canvas&&(this.ctx=this.canvas.getContext("2d"),d.on("playbackStateChanged",()=>this.handlePlaybackStateChange()),d.on("tempoChanged",()=>this.invalidateTimeMap()))}handlePlaybackStateChange(){d.state.isPlaying&&!d.state.isPaused?this.startRendering():this.stopRendering()}invalidateTimeMap(){}startRendering(){this.animationFrameId||this.render()}stopRendering(){this.animationFrameId&&(cancelAnimationFrame(this.animationFrameId),this.animationFrameId=null),this.ctx&&this.ctx.clearRect(0,0,ke(this.canvas),le(this.canvas))}render(){if(!d.state.isPlaying||d.state.isPaused||!this.ctx){this.animationFrameId=null;return}this.ctx.clearRect(0,0,ke(this.canvas),le(this.canvas));const t=this.calculateXFromTime($.Transport.seconds);if(t===null){this.animationFrameId=requestAnimationFrame(()=>this.render());return}this.ctx.strokeStyle="#FF6B35",this.ctx.lineWidth=3,this.ctx.shadowColor="#FF6B35",this.ctx.shadowBlur=6,this.ctx.beginPath(),this.ctx.moveTo(t,0),this.ctx.lineTo(t,le(this.canvas)),this.ctx.stroke(),this.ctx.shadowBlur=0,this.debugPlayhead($.Transport.seconds,t),this.animationFrameId=requestAnimationFrame(()=>this.render())}calculateXFromTime(t){this._lastColumnIndex=null,this._lastColumnProgress=0;const s=Kd();if(!Array.isArray(s)||s.length<2)return null;for(let i=0;i<s.length-1;i++)if(t>=s[i]&&t<s[i+1]){const A=s[i],r=s[i+1]-A,a=t-A,l=Er(i),h=Df(i);return this._lastColumnIndex=i,this._lastColumnProgress=r>0?a/r:0,l+(r>0?a/r*h:0)}return null}debugPlayhead(t,s){if(!window.__DEBUG_PLAYHEAD_SYNC__)return;const i=performance.now();if(i-this._lastDebugLogTime<250)return;this._lastDebugLogTime=i;const A=Kd(),r=this._lastColumnIndex,a=Array.isArray(A)&&r!==null&&r>=0?A[r]:void 0,l=Array.isArray(A)&&r!==null&&r+1<A.length?A[r+1]:void 0,h=Array.isArray(A)?A[A.length-1]??0:0,u=XI(),m={transportSeconds:Number(t.toFixed(3)),drumX:Number((s??0).toFixed(2)),columnIndex:r,columnProgress:Number(this._lastColumnProgress.toFixed(3)),drumStartTime:Number((a==null?void 0:a.toFixed(3))??NaN),transportStartTime:Number((a==null?void 0:a.toFixed(3))??NaN),startDelta:0,drumEndTime:Number((l==null?void 0:l.toFixed(3))??NaN),transportEndTime:Number((l==null?void 0:l.toFixed(3))??NaN),endDelta:0,drumTimelineEnd:Number(h.toFixed(3)),transportTimelineEnd:Number((u??0).toFixed(3)),timelineDelta:Number((h-(u??0)).toFixed(3)),toneLoopStart:Number(($.Transport.loopStart??0).toFixed(3)),toneLoopEnd:Number(($.Transport.loopEnd??0).toFixed(3)),storeLooping:d.state.isLooping};_.debug("DrumPlayheadRenderer","Playhead diagnostics",m,"canvas")}triggerNotePop(t,s){const i=`${t}-${s}`;this.activeAnimations.set(i,{startTime:performance.now(),phase:"scaleUp"}),window.drumGridRenderer&&window.drumGridRenderer.render()}getAnimationScale(t,s){const i=`${t}-${s}`,A=this.activeAnimations.get(i);if(!A)return 1;const r=performance.now(),a=r-A.startTime;if(A.phase==="scaleUp"){if(a>=this.popDuration.scaleUp)return A.phase="scaleDown",A.startTime=r,this.popScale;{const l=a/this.popDuration.scaleUp;return 1+(this.popScale-1)*l}}else if(A.phase==="scaleDown"){if(a>=this.popDuration.scaleDown)return this.activeAnimations.delete(i),1;{const l=a/this.popDuration.scaleDown;return this.popScale-(this.popScale-1)*l}}return 1}hasActiveAnimations(){return this.activeAnimations.size>0}cleanupAnimations(){const t=performance.now();for(const[s,i]of this.activeAnimations.entries()){const A=t-i.startTime,r=i.phase==="scaleUp"?this.popDuration.scaleUp:this.popDuration.scaleUp+this.popDuration.scaleDown;A>r&&this.activeAnimations.delete(s)}}}const Ri=new jI;_.moduleLoaded("StampPlacements","stamps");function JI(e,t,s,i="#4a90e2"){return Bc(e)?d.addStampPlacement(e,t,s,i):(_.warn("StampPlacements",`Invalid stamp ID: ${e}`,{stampId:e},"stamps"),null)}function ZI(e,t,s,i){return d.eraseStampsInArea(e,t,s,i)}function tQ(){d.clearAllStamps()}function m0(){return d.getStampPlaybackData()}_.moduleLoaded("StampScheduler","stamps");const Ng=["0","16n","8n",{"8n":1,"16n":1}];function g0(e,t=null){const s=Bc(e);if(!s)return _.warn("StampScheduler",`Unknown stamp ID: ${e}`,{stampId:e},"stamps"),[];const i=[];return s.ovals.forEach(A=>{var l;const r=`oval_${A}`,a=((l=t==null?void 0:t.shapeOffsets)==null?void 0:l[r])||0;i.push({offset:Ng[A],duration:"8n",type:"oval",slot:A,shapeKey:r,rowOffset:a})}),s.diamonds.forEach(A=>{var l;const r=`diamond_${A}`,a=((l=t==null?void 0:t.shapeOffsets)==null?void 0:l[r])||0;i.push({offset:Ng[A],duration:"16n",type:"diamond",slot:A,shapeKey:r,rowOffset:a})}),i}_.moduleLoaded("TripletPlacements","triplets");function eQ(e,t,s,i="#4a90e2"){const A=ca(e);if(!A)return _.warn("TripletPlacements",`Invalid triplet stamp ID: ${e}`,{tripletStampId:e},"triplets"),null;const r=dx[A.span];if(!sQ(t,r,s))return _.debug("TripletPlacements",`Cannot place triplet at cell ${t}, row ${s} - collision detected`,{tripletStampId:e,startCellIndex:t,row:s,span:r},"triplets"),null;const a={id:`triplet_${Date.now()}_${Math.random().toString(36).substr(2,9)}`,stampId:e,startCellIndex:t,span:r,row:s,color:i,timestamp:Date.now()};return d.addTripletPlacement(a)}function sQ(e,t,s){const i=d.state;if(i.stampPlacements){for(const A of i.stampPlacements)if(A.row===s){const r=Math.floor(A.startColumn/2),a=Math.floor(A.endColumn/2);for(let l=0;l<t;l++){const h=e+l;if(h>=r&&h<=a)return!1}}}if(i.tripletPlacements){for(const A of i.tripletPlacements)if(A.row===s){const r=A.startCellIndex+A.span-1;if(!(e+t-1<A.startCellIndex||e>r))return!1}}return!0}function nQ(e,t,s,i){const A=d.state;if(!A.tripletPlacements)return!1;const r=Math.floor(e/2),a=Math.floor(t/2),l=[];for(const h of A.tripletPlacements)h.row>=s&&h.row<=i&&(h.startCellIndex+h.span-1<r||h.startCellIndex>a||l.push(h.id));return l.length>0?(l.forEach(h=>d.removeTripletPlacement(h)),_.debug("TripletPlacements",`Erased ${l.length} triplet groups`,{removedIds:l,eraseArea:{eraseStartCell:r,eraseEndCell:a,eraseStartRow:s,eraseEndRow:i}},"triplets"),!0):!1}function w0(){const e=d.state;return e.tripletPlacements?e.tripletPlacements.map(t=>({startCellIndex:t.startCellIndex,stampId:t.stampId,row:t.row,color:t.color,span:t.span,placement:t})):[]}function iQ(){d.clearAllTripletPlacements(),_.info("TripletPlacements","Cleared all triplet placements",null,"triplets")}_.moduleLoaded("TripletScheduler","triplets");function v0(e,t=null){const s=ca(e);if(!s)return _.warn("TripletScheduler",`Unknown triplet stamp ID: ${e}`,{tripletStampId:e},"triplets"),[];const i=[],A=s.span==="eighth"?"8t":"4t",r=A;return s.hits.forEach(a=>{var m;const l=`triplet_${a}`,h=((m=t==null?void 0:t.shapeOffsets)==null?void 0:m[l])||0;let u;if(a===0)u="0";else if(a===1)u=A;else if(a===2){const g=$.Time(A).toSeconds();u=$.Time(g*2).toNotation()}else{const g=$.Time(A).toSeconds();u=$.Time(g*a).toNotation()}i.push({offset:u,duration:r,type:s.span==="eighth"?"triplet-eighth":"triplet-quarter",slot:a,shapeKey:l,rowOffset:h}),_.debug("TripletScheduler",`Triplet stamp ${e} ${s.span} at slot ${a} with offset "${u}", rowOffset: ${h}`,"triplets")}),_.debug("TripletScheduler",`Total events for triplet stamp ${e}:`,i.length,"triplets"),i}const B0="",y0="",Vg=1e-4;function zu(e){const t=d.state.fullRowData[e];return t?t.toneNote.replace(B0,"b").replace(y0,"#"):"C4"}_.moduleLoaded("TransportService");let gn,Go,ne=[],pr=0,mr=0;const AQ=1e-4,qd=new Map;function C0(){qd.clear()}function rQ(e,t){let s=Number.isFinite(t)?t:$.now();const i=qd.get(e)??-1/0;return s>i||(s=i+AQ),qd.set(e,s),s}function gr(){if(mr>pr){const e=Math.abs($.Transport.loopStart-pr),t=Math.abs($.Transport.loopEnd-mr);(e>Vg||t>Vg)&&($.Transport.loopStart=pr,$.Transport.loopEnd=mr),$.Transport.loop!==d.state.isLooping&&($.Transport.loop=d.state.isLooping)}}function b0(e,t){const s=Math.max(da(),.001),i=Number.isFinite(e)?e:0;let A=Number.isFinite(t)?t:i+s;A<=i&&(A=i+s),pr=i,mr=A,$.Transport&&($.Transport.loopStart=i,$.Transport.loopEnd=A),gr()}function oQ(){const e=_0(),t=Mc();b0(e,t)}function da(){return 60/(d.state.tempo*2)}function _0(){if(!d.state.hasAnacrusis)return ne[2]||0;for(let e=0;e<d.state.macrobeatBoundaryStyles.length;e++)if(d.state.macrobeatBoundaryStyles[e]==="solid"){const t=An(d.state,e+1);if(t)return ne[t.startColumn]||0}return ne[2]||0}function zd(){var A;_.debug("transportService","calculateTimeMap",{tempo:`${d.state.tempo} BPM`}),ne=[];const e=da(),{columnWidths:t}=d.state,s=Ai(d.state);aQ(e,t,s),_.timing("transportService","calculateTimeMap",{totalDuration:`${(A=ne[ne.length-1])==null?void 0:A.toFixed(2)}s`});const i=Mc();$I({timeMap:ne,musicalEndTime:i,columnWidths:d.state.columnWidths,cellWidth:d.state.cellWidth}),oQ(),typeof window<"u"&&(window.__transportTimeMap=[...ne],window.__transportMusicalEnd=i)}function Mc(){var A;const e=ne.length>0?ne[ne.length-1]:0,t=((A=d.state.columnWidths)==null?void 0:A.length)??0;if(t<2)return e;const s=t-2,i=ne[s];return typeof i=="number"&&Number.isFinite(i)?i:e}function aQ(e,t,s){const i=Math.max(0,t.length-2);let A=0;for(let r=0;r<=i;r++){ne[r]=A;const a=r>=i,l=s.some(h=>h.columnIndex===r);!a&&!l&&(A+=(t[r]||0)*e)}ne.length=i+1}function lQ(e,t,s){let i=0;for(let A=0;A<e;A++){const r=t[A]||0;i+=r*s}return i}function cQ(e){const{modulationMarkers:t}=d.state;if(!t||t.length===0)return ne[e];const s=da(),i=d.state.baseMicrobeatPx||d.state.cellWidth||40,A=Rw(t,i,d.state),r=lQ(e,d.state.columnWidths,i);return I_(r,A,s)}function hQ(e){const t=d.state.fullRowData;return t&&t[e.row]?t[e.row].toneNote.replace(B0,"b").replace(y0,"#"):"C4"}function $u(){var h,u,m;_.debug("transportService","scheduleNotes","Clearing previous transport events and rescheduling all notes"),$.Transport.cancel(),C0(),zd(),(h=Ms.adsrComponent)==null||h.playheadManager.clearAll();const e=ne[2]||0,t=d.state.modulationMarkers&&d.state.modulationMarkers.length>0;d.state.placedNotes.length,(u=d.state.lassoSelection)!=null&&u.isActive;const s=(m=d.state.lassoSelection)==null?void 0:m.isActive,i=s?new Set(d.state.lassoSelection.selectedItems.filter(g=>g.type==="note").map(g=>g.id)):null;d.state.placedNotes.forEach(g=>{var I;if(s){const T=`note-${g.row}-${g.columnIndex}-${g.color}-${g.shape}`;if(!i.has(T))return}const v=ne[g.startColumnIndex];if(t&&cQ(g.startColumnIndex),v===void 0)return;if(v<e){_.debug("transportService",`Skipping note at column ${g.startColumnIndex} (regular time ${v}) - before anacrusis offset (${e})`);return}const y=v;let C;const x=ne[g.endColumnIndex+1];if(x===void 0){_.warn("TransportService",`Skipping note with invalid endColumnIndex: ${g.endColumnIndex+1} (note ends at ${g.endColumnIndex})`,{noteId:g.uuid,startColumnIndex:g.startColumnIndex,endColumnIndex:g.endColumnIndex,lookupIndex:g.endColumnIndex+1,timeMapLength:ne.length,maxValidIndex:ne.length-1,noteShape:g.shape},"audio");return}const F=x-v;if(g.shape==="circle"?(C=F,da()):C=F,g.isDrum)$.Transport.schedule(T=>{var D;if(d.state.isPaused)return;const U=rQ(g.drumTrack,T);(D=Go==null?void 0:Go.player(g.drumTrack))==null||D.start(U),Ri.triggerNotePop(g.startColumnIndex,g.drumTrack)},y);else{const T=hQ(g),U=g.color,D=((I=d.state.fullRowData[g.row])==null?void 0:I.hex)||"#888888",O=g.uuid,R=d.state.timbres[U];if(!R){_.warn("TransportService",`Timbre not found for color ${U}. Skipping note ${O}`,null,"audio");return}$.Transport.schedule(Y=>{var L;d.state.isPaused||(Kt.triggerAttack(T,U,Y),(L=Ms.adsrComponent)==null||L.playheadManager.trigger(O,"attack",D,R.adsr),d.emit("noteAttack",{noteId:O,color:U}))},y);const st=y+C;$.Transport.schedule(Y=>{var L;Kt.triggerRelease(T,U,Y),(L=Ms.adsrComponent)==null||L.playheadManager.trigger(O,"release",D,R.adsr),d.emit("noteRelease",{noteId:O,color:U})},st)}});const A=m0(),r=s?new Set(d.state.lassoSelection.selectedItems.filter(g=>g.type==="stamp").map(g=>g.id)):null;A.forEach(g=>{var C;if(s){const x=`stamp-${g.row}-${g.column}-${g.stampId}`;if(!r.has(x))return}const v=ne[g.column];if(v===void 0)return;if(v<e){_.debug("TransportService",`Skipping stamp at column ${g.column} - before anacrusis offset`);return}const y=g0(g.stampId,g.placement);y.forEach(x=>{const F=$.Time(x.offset).toSeconds(),I=$.Time(x.duration).toSeconds(),T=v+F,U=T+I,D=g.row+x.rowOffset,O=zu(D);$.Transport.schedule(R=>{d.state.isPaused||Kt.triggerAttack(O,g.color,R)},T),$.Transport.schedule(R=>{d.state.isPaused||Kt.triggerRelease(O,g.color,R)},U)}),_.debug("TransportService",`Scheduled stamp ${g.stampId} with ${y.length} events at column ${g.column}`,{stampId:g.stampId,column:g.column,basePitch:g.pitch,baseRow:g.row,startTime:v,events:y.length,hasShapeOffsets:!!((C=g.placement)!=null&&C.shapeOffsets)},"audio")});const a=w0(),l=s?new Set(d.state.lassoSelection.selectedItems.filter(g=>g.type==="triplet").map(g=>g.id)):null;a.forEach(g=>{var x,F,I;if(s){const T=`triplet-${g.row}-${g.column}-${g.tripletId}`;if(!l.has(T))return}const v=g.startCellIndex*2,y=ne[v];if(y===void 0)return;if(y<e){_.debug("TransportService",`Skipping triplet at cell ${g.startCellIndex} - before anacrusis offset`);return}_.debug("TransportService","[TRANSPORT DEBUG] Scheduling triplet",{stampId:g.stampId,baseRow:g.row,hasPlacement:!!g.placement,hasShapeOffsets:!!((x=g.placement)!=null&&x.shapeOffsets),shapeOffsets:(F=g.placement)==null?void 0:F.shapeOffsets});const C=v0(g.stampId,g.placement);C.forEach(T=>{const U=$.Time(T.offset).toSeconds(),D=$.Time(T.duration).toSeconds(),O=y+U,R=O+D,st=g.row+T.rowOffset,Y=zu(st);_.debug("TransportService","[TRANSPORT DEBUG] Scheduling shape",{slot:T.slot,rowOffset:T.rowOffset,baseRow:g.row,shapeRow:st,shapePitch:Y}),$.Transport.schedule(L=>{d.state.isPaused||Kt.triggerAttack(Y,g.color,L)},O),$.Transport.schedule(L=>{d.state.isPaused||Kt.triggerRelease(Y,g.color,L)},R)}),_.debug("TransportService",`Scheduled triplet ${g.stampId} with ${C.length} events at cell ${g.startCellIndex}`,{stampId:g.stampId,cellIndex:g.startCellIndex,basePitch:zu(g.row),baseRow:g.row,startTime:y,events:C.length,hasShapeOffsets:!!((I=g.placement)!=null&&I.shapeOffsets)},"audio")}),_.debug("TransportService","scheduleNotes",`Finished scheduling ${d.state.placedNotes.length} notes, ${A.length} stamps, and ${a.length} triplets`,"audio"),d.state.placedNotes.length,A.length,a.length}function Xu(){var u,m;const e=uA.get("playheadCanvas");if(!e)return;const t=e.getContext("2d"),s=d.state.tempo,i=1e-4,A=.5,r=g=>(g==null?void 0:g.xPosition)??477.5,a=typeof((m=(u=$.Transport)==null?void 0:u.bpm)==null?void 0:m.value)=="number"?$.Transport.bpm.value:s;let l=s!==0?a/s:1;function h(){if($.Transport.state!=="started"||!e)return;const g=$.Transport.loopEnd??0,v=d.state.isLooping,y=Mc(),C=v&&g>0?g:y,x=$.Transport.seconds,F=x>=C-.001;if(!v&&F){_.info("TransportService","Playback reached end. Stopping playhead.",{currentTime:x,playbackEnd:C,isLooping:v},"transport"),$.Transport.loopStart,$.Transport.loopEnd,cr.stop();return}if(d.state.isPaused){gn=requestAnimationFrame(h);return}const I=ke(e),T=le(e);t.clearRect(0,0,I,T);let U=x;if(v){const L=$.Transport.loopEnd-$.Transport.loopStart;L>0&&(U=(x-$.Transport.loopStart)%L+$.Transport.loopStart)}const D=Er(YI());let O=0;for(let L=0;L<ne.length-1;L++)if(ne[L]!==void 0&&U>=ne[L]&&U<ne[L+1]){const J=ne[L],ht=ne[L+1]-J,rt=U-J,Tt=Er(L),It=Df(L),Ht=ht>0?rt/ht:0;O=Tt+Ht*It;break}const R=Math.min(O,D),Y=(Array.isArray(d.state.modulationMarkers)?d.state.modulationMarkers:[]).filter(L=>(L==null?void 0:L.active)&&typeof L.ratio=="number"&&L.ratio!==0).sort((L,J)=>r(L)-r(J));if(Y.length>0){let L=1;for(const J of Y){const dt=r(J);if(R+A>=dt)L*=1/J.ratio;else break}if((!Number.isFinite(L)||L<=0)&&(L=1),Math.abs(L-l)>i){const J=s*L;$.Transport.bpm.value=J,gr(),l=L;const dt={targetMultiplier:Number(L.toFixed(6)),newTempo:Number(J.toFixed(3)),markerCount:Y.length,finalXPos:Number(R.toFixed(2))};_.debug("TransportService",`Tempo multiplier updated to ${L.toFixed(3)} (${J.toFixed(2)} BPM)`,dt,"transport")}}else if(Math.abs(l-1)>i){$.Transport.bpm.value=s,gr(),l=1;const L={targetMultiplier:1,newTempo:Number(s.toFixed(3)),markerCount:Y.length,finalXPos:Number(R.toFixed(2))};_.debug("TransportService",`Tempo reset to base ${s} BPM`,L,"transport")}if(R>0){t.strokeStyle="rgba(255,0,0,0.8)",t.lineWidth=2,t.beginPath(),t.moveTo(R,0);const L=le(e);t.lineTo(R,L),t.stroke()}gn=requestAnimationFrame(h)}h()}const cr={init(){const e=new $.Volume(0);if(Go=new $.Players({H:"https://tonejs.github.io/audio/drum-samples/CR78/hihat.mp3",M:"https://tonejs.github.io/audio/drum-samples/CR78/snare.mp3",L:"https://tonejs.github.io/audio/drum-samples/CR78/kick.mp3"}).connect(e),window.synthEngine){const t=window.synthEngine.getMainVolumeNode&&window.synthEngine.getMainVolumeNode();t?e.connect(t):e.toDestination()}else e.toDestination();window.drumVolumeNode=e,window.transportService={drumPlayers:Go},$.Transport.bpm.value=d.state.tempo,d.on("rhythmStructureChanged",()=>this.handleStateChange()),d.on("notesChanged",()=>this.handleStateChange()),d.on("stampPlacementsChanged",()=>this.handleStateChange()),d.on("modulationMarkersChanged",()=>this.handleStateChange()),d.on("tempoChanged",t=>{if(_.event("TransportService",`tempoChanged triggered with new value: ${t} BPM`,null,"transport"),$.Transport.state==="started"){_.info("TransportService","Tempo changed WHILE PLAYING. Resynchronizing transport...",null,"transport");const s=$.Transport.position;_.debug("TransportService",`Saved musical position: ${s}`,null,"transport"),$.Transport.pause(),_.debug("TransportService","Transport paused",null,"transport"),gn&&(cancelAnimationFrame(gn),gn=null),$.Transport.bpm.value=t,gr(),_.debug("TransportService",`New BPM set to ${$.Transport.bpm.value}`,null,"transport"),$u(),$.Transport.start(void 0,s),_.debug("TransportService",`Transport restarted at musical position ${s}`,null,"transport"),d.state.paint.isMicPaintActive||Xu()}else _.debug("TransportService","Tempo changed while stopped/paused. Updating BPM for next run",null,"transport"),$.Transport.bpm.value=t,gr(),zd()}),d.on("loopingChanged",t=>{$.Transport.loop=t,t&&$.Transport.loopEnd<=$.Transport.loopStart&&($.Transport.loopEnd=$.Transport.loopStart+Math.max(da(),.001)),t?(pr=$.Transport.loopStart,mr=$.Transport.loopEnd):(pr=0,mr=0),$.Transport.loopStart,$.Transport.loopEnd}),$.Transport.on("stop",()=>{var t;_.event("TransportService","Tone.Transport 'stop' fired. Resetting playback state",null,"transport"),d.setPlaybackState(!1,!1),(t=Ms.adsrComponent)==null||t.playheadManager.clearAll(),gn&&(cancelAnimationFrame(gn),gn=null)}),_.info("TransportService","Initialized",null,"transport")},handleStateChange(){if($.Transport.state==="started"){_.debug("TransportService","handleStateChange: Notes or rhythm changed during playback. Rescheduling",null,"transport");const t=$.Transport.position;$.Transport.pause(),$u(),$.Transport.start(void 0,t)}else zd()},start(){_.info("TransportService","Starting playback",null,"transport"),d.state.tempo,d.state.isLooping,d.state.placedNotes.length,(window.initAudio||(()=>$.start()))().then(()=>{$u(),d.state.placedNotes.length,m0().length,w0().length,ne.length>0&&ne[ne.length-1];const t=Mc(),s=ne[2]||0,i=_0();b0(i,t),$.Transport.bpm.value=d.state.tempo,_.debug("TransportService",`Transport configured. Loop: ${$.Transport.loop}, BPM: ${$.Transport.bpm.value}, StartOffset: ${s}, LoopStart: ${i}`,null,"transport"),$.Transport.loopStart,$.Transport.loopEnd,$.Transport.start($.now(),s),window.PaintPlaybackService&&window.PaintPlaybackService.onTransportStart&&window.PaintPlaybackService.onTransportStart(),d.state.paint.isMicPaintActive?(d.emit("playbackStateChanged",{isPlaying:!0,isPaused:!1}),_.debug("TransportService","Paint playhead is active, skipping regular playhead animation",null,"transport")):Xu(),d.emit("playbackStarted")})},resume(){_.info("TransportService","Resuming playback",null,"transport"),(window.initAudio||(()=>$.start()))().then(()=>{$.Transport.start(),window.PaintPlaybackService&&window.PaintPlaybackService.onTransportStart&&window.PaintPlaybackService.onTransportStart(),d.state.paint.isMicPaintActive||Xu(),d.emit("playbackResumed")})},pause(){_.info("TransportService","Pausing playback",null,"transport"),$.Transport.pause(),gn&&(cancelAnimationFrame(gn),gn=null),d.emit("playbackPaused")},stop(){_.info("TransportService","Stopping playback and clearing visuals",null,"transport"),$.Transport.stop(),window.PaintPlaybackService&&window.PaintPlaybackService.onTransportStop&&window.PaintPlaybackService.onTransportStop(),$.Transport.cancel(),C0(),$.Transport.bpm.value=d.state.tempo,gr(),d.state.tempo,Kt.releaseAll();const e=uA.get("playheadCanvas");e&&e.getContext("2d").clearRect(0,0,ke(e),le(e)),d.state.paint.isMicPaintActive&&d.emit("playbackStateChanged",{isPlaying:!1,isPaused:!1}),d.emit("playbackStopped")}},uQ=/(Android|webOS|iPhone|iPad|iPod|BlackBerry|IEMobile|Opera Mini)/i,x0=900;let Wg=!1,Vl=x0,Yu=!1;const dQ=Object.freeze({isMobile:!1,isTouch:!1,isCoarsePointer:!1,orientation:"landscape",width:0,height:0});function Lf(){return typeof window<"u"?window:null}function fQ(){const e=Lf();if(!e)return{...dQ};const{innerWidth:t=0,innerHeight:s=0}=e,i=e.matchMedia?e.matchMedia("(orientation: portrait)"):null,A=i?i.matches?"portrait":"landscape":s>=t?"portrait":"landscape",r=!!(e.matchMedia&&e.matchMedia("(pointer: coarse)").matches),a=!!(e.matchMedia&&e.matchMedia("(hover: none)").matches),l=typeof navigator<"u"?navigator:null,h=(l==null?void 0:l.maxTouchPoints)??(l==null?void 0:l.msMaxTouchPoints)??0,u="ontouchstart"in e||h>0,m=l!=null&&l.userAgent?uQ.test(l.userAgent):!1,g=t>0?t<=Vl:!1;return{isMobile:!!(m||u&&(r||a||g)),isTouch:u,isCoarsePointer:r,orientation:A,width:t,height:s}}function pQ(e){if(typeof document>"u")return;[document.documentElement,document.body].filter(Boolean).forEach(s=>{s.classList.toggle("is-mobile",!!e.isMobile),s.classList.toggle("is-touch",!!e.isTouch),s.classList.toggle("orientation-portrait",e.orientation==="portrait"),s.classList.toggle("orientation-landscape",e.orientation==="landscape")})}function yl(){if(Yu)return;const e=Lf();e&&(Yu=!0,e.requestAnimationFrame(()=>{Yu=!1;const t=fQ();d.setDeviceProfile(t),pQ(t)}))}function mQ(e,t){return e?typeof e.addEventListener=="function"?(e.addEventListener("change",t),()=>e.removeEventListener("change",t)):typeof e.addListener=="function"?(e.addListener(t),()=>e.removeListener(t)):()=>{}:()=>{}}function gQ(e={}){const t=Lf();if(!t||Wg)return;Vl=e.maxMobileWidth??x0,Wg=!0;const s=()=>yl(),i=()=>yl();t.addEventListener("resize",s),t.addEventListener("orientationchange",i),[t.matchMedia&&t.matchMedia("(pointer: coarse)"),t.matchMedia&&t.matchMedia("(hover: none)"),t.matchMedia&&t.matchMedia(`(max-width: ${Vl}px)`),t.matchMedia&&t.matchMedia("(orientation: portrait)")].filter(Boolean).forEach(r=>{mQ(r,yl)}),yl(),_.debug("DeviceProfileService",`Initialized (breakpoint <= ${Vl}px)`,null,"ui")}const wQ="modulepreload",vQ=function(e){return"/Student-Notation/"+e},Gg={},E0=function(t,s,i){let A=Promise.resolve();if(s&&s.length>0){let a=function(u){return Promise.all(u.map(m=>Promise.resolve(m).then(g=>({status:"fulfilled",value:g}),g=>({status:"rejected",reason:g}))))};document.getElementsByTagName("link");const l=document.querySelector("meta[property=csp-nonce]"),h=(l==null?void 0:l.nonce)||(l==null?void 0:l.getAttribute("nonce"));A=a(s.map(u=>{if(u=vQ(u),u in Gg)return;Gg[u]=!0;const m=u.endsWith(".css"),g=m?'[rel="stylesheet"]':"";if(document.querySelector(`link[href="${u}"]${g}`))return;const v=document.createElement("link");if(v.rel=m?"stylesheet":wQ,m||(v.as="script"),v.crossOrigin="",v.href=u,h&&v.setAttribute("nonce",h),document.head.appendChild(v),m)return new Promise((y,C)=>{v.addEventListener("load",y),v.addEventListener("error",()=>C(new Error(`Unable to preload CSS for ${u}`)))})}))}function r(a){const l=new Event("vite:preloadError",{cancelable:!0});if(l.payload=a,window.dispatchEvent(l),!l.defaultPrevented)throw a}return A.then(a=>{for(const l of a||[])l.status==="rejected"&&r(l.reason);return t().catch(r)})},BQ=()=>{const e="/Student-Notation/";return e.endsWith("/")?e:`${e}/`},yQ=`${BQ()}assets/`;function CQ(e=""){const t=e.replace(/^\/+/,"");return`${yQ}${t}`}function Ii(e){return CQ(`icons/${e}`)}class bQ{constructor(){this.tasks=[],this.completedTasks=0,this.totalTasks=0,this.startTime=null,this.loadingScreen=null,this.progressBar=null,this.progressText=null,this.statusText=null,this.initialized=!1,this.cache={fonts:new Map,icons:new Map,modules:new Map},this.diagnostics=[]}createLoadingScreen(){this.loadingScreen||(this.loadingScreen=document.createElement("div"),this.loadingScreen.id="app-loading-screen",this.loadingScreen.innerHTML=`
            <div class="loading-container">
                <div class="loading-logo">
                    <svg viewBox="0 0 100 100" class="logo-svg">
                        <circle cx="50" cy="50" r="45" class="logo-circle" />
                        <path d="M 30 50 Q 50 30, 70 50 T 70 70" class="logo-path" />
                    </svg>
                </div>
                <h1 class="loading-title">Student Notation</h1>
                <div class="loading-progress-container">
                    <div class="loading-progress-bar">
                        <div class="loading-progress-fill" id="loading-progress-fill"></div>
                    </div>
                    <div class="loading-progress-text" id="loading-progress-text">0%</div>
                </div>
                <div class="loading-status" id="loading-status">Initializing...</div>
            </div>
        `,document.body.appendChild(this.loadingScreen),this.progressBar=document.getElementById("loading-progress-fill"),this.progressText=document.getElementById("loading-progress-text"),this.statusText=document.getElementById("loading-status"))}registerTask(t,s=1){this.tasks.push({name:t,weight:s,completed:!1}),this.totalTasks+=s}completeTask(t){const s=this.tasks.find(i=>i.name===t&&!i.completed);s&&(s.completed=!0,this.completedTasks+=s.weight,this.updateProgress())}updateProgress(){if(!this.progressBar||!this.progressText)return;const t=this.totalTasks>0?this.completedTasks/this.totalTasks*100:0,s=Math.round(t);this.progressBar.style.width=`${s}%`,this.progressText.textContent=`${s}%`}updateStatus(t){this.statusText&&(this.statusText.textContent=t)}recordDiagnostic(t,s,i=null){this.diagnostics.push({level:t,message:s,data:i,timestamp:Date.now()})}getDiagnostics(){return[...this.diagnostics]}async preloadFont(t,s,i="normal",A="normal"){const r=`${t}-${i}-${A}`;if(this.cache.fonts.has(r))return this.cache.fonts.get(r);try{const l=await new FontFace(t,`url(${s})`,{weight:i,style:A}).load();return document.fonts.add(l),this.cache.fonts.set(r,l),l}catch(a){return this.recordDiagnostic("warn",`Failed to preload font ${t}`,a),null}}async preloadImage(t){return this.cache.icons.has(t)?this.cache.icons.get(t):new Promise(s=>{const i=new Image;i.onload=()=>{this.cache.icons.set(t,i),s(i)},i.onerror=()=>{this.recordDiagnostic("warn",`Failed to preload image: ${t}`),s(null)},i.src=t})}async preloadResources(){const t=[];t.push(this.preloadFont("Atkinson Hyperlegible","../../fonts/atkinsonHyperlegibleNextRegular.otf"));const s=[Ii("play.svg"),Ii("pause.svg"),Ii("stop.svg"),Ii("settings.svg"),Ii("volume.svg")];t.push(...s.map(i=>this.preloadImage(i)));try{await Promise.race([Promise.all(t),new Promise(i=>setTimeout(i,3e3))])}catch(i){this.recordDiagnostic("warn","Some resources failed to preload",i)}}async initializeAudioContext(){try{const t=await E0(()=>Promise.resolve().then(()=>kC),void 0);return this.cache.modules.set("tone",t),t}catch(t){throw this.recordDiagnostic("error","Failed to initialize audio context",t),t}}async init(){if(!this.initialized){this.startTime=Date.now(),this.createLoadingScreen();try{this.updateStatus("Loading fonts..."),await this.preloadResources(),await this.delay(50),await this.delay(50),this.updateStatus("Preparing..."),await this.delay(50),this.initialized=!0}catch(t){throw this.recordDiagnostic("error","[LOADING] Resource preloading failed",t),this.showError(t),t}}}async complete(){this.loadingScreen&&(this.updateStatus("Ready!"),await this.delay(200),await this.fadeOut())}delay(t){return new Promise(s=>setTimeout(s,t))}async fadeOut(){this.loadingScreen&&(this.loadingScreen.classList.add("fade-out"),await this.delay(600),this.loadingScreen.parentNode&&this.loadingScreen.parentNode.removeChild(this.loadingScreen),this.loadingScreen=null)}showError(t){this.statusText&&(this.statusText.textContent=`Error: ${t.message}`,this.statusText.style.color="#ff4444",this.loadingScreen&&this.loadingScreen.classList.add("error"))}getCached(t,s){var i;return(i=this.cache[t])==null?void 0:i.get(s)}}const ms=new bQ;let Uc=!1,Hf=[],Wl=null;function S0(){Uc=!0}function _Q(){Uc=!1}function F0(e){try{return JSON.parse(JSON.stringify(e,(t,s)=>s instanceof Float32Array?{__type:"Float32Array",data:Array.from(s)}:s))}catch{return null}}function $d(e,t,s="root"){const i=[];if(!e||!t)return i;if(typeof e!=typeof t)return i.push({path:s,type:"type_change",oldValue:typeof e,newValue:typeof t,timestamp:Date.now()}),i;if(typeof e!="object")return e!==t&&i.push({path:s,type:"value_change",oldValue:e,newValue:t,timestamp:Date.now()}),i;if(Array.isArray(e)){if(!Array.isArray(t))return i.push({path:s,type:"array_to_non_array",oldLength:e.length,newType:typeof t,timestamp:Date.now()}),i;e.length!==t.length&&i.push({path:s,type:"array_length_change",oldLength:e.length,newLength:t.length,timestamp:Date.now()});const r=Math.max(e.length,t.length);for(let a=0;a<r;a++){const l=$d(e[a],t[a],`${s}[${a}]`);i.push(...l)}return i}const A=new Set([...Object.keys(e),...Object.keys(t)]);for(const r of A)if(!(r in e))i.push({path:`${s}.${r}`,type:"property_added",newValue:t[r],timestamp:Date.now()});else if(!(r in t))i.push({path:`${s}.${r}`,type:"property_removed",oldValue:e[r],timestamp:Date.now()});else{const a=$d(e[r],t[r],`${s}.${r}`);i.push(...a)}return i}function xQ(e){Uc&&(Wl=F0(e))}function EQ(e,t="unknown"){if(!Uc||!Wl)return;const s=F0(e),i=$d(Wl,s);if(i.length>0){const A=i.filter(r=>!r.path.includes("paint.paintHistory")&&!r.path.includes("tempo")&&!r.path.includes("isPlaying")&&!r.path.includes("fullRowData")&&!r.path.includes("columnWidths"));A.length>0&&Hf.push({action:t,mutations:A,timestamp:Date.now()})}Wl=s}function SQ(){return[...Hf]}function FQ(){Hf=[]}window.stateGuard={enable:S0,disable:_Q,getLog:SQ,clearLog:FQ};_.moduleLoaded("RhythmPlaybackService");class TQ{constructor(){this.scheduledEvents=[],this.isInitialized=!1}async initialize(){this.isInitialized||(await $.start(),this.isInitialized=!0,_.info("RhythmPlaybackService","Initialized"),window.rhythmPlaybackService=this)}playRhythmPattern(t,s,i,A="oval",r=null){if(!this.isInitialized){_.warn("RhythmPlaybackService","Not initialized, call initialize() first");return}this.stopCurrentPattern();const a=g0(t,r);if(!a||a.length===0){_.warn("RhythmPlaybackService",`No events found for stamp ${t}`);return}_.debug("RhythmPlaybackService",`Playing pattern for stamp ${t}: ${a.length} notes`,{stampId:t,basePitch:s,color:i,events:a,hasShapeOffsets:!!(r!=null&&r.shapeOffsets)});const l=$.now(),h=r==null?void 0:r.row;a.forEach((u,m)=>{try{const g=$.Time(u.offset).toSeconds(),v=l+g,y=$.Time(u.duration).toSeconds(),C=A==="circle"?y*2:y,x=v+C;let F=s;if(h!==void 0&&u.rowOffset!==0){const I=h+u.rowOffset,T=d.state.fullRowData[I];T&&(F=T.toneNote.replace("","b").replace("","#"))}Kt.triggerAttack(F,i,v),Kt.triggerRelease(F,i,x),this.scheduledEvents.push({pitch:F,color:i,attackTime:v,releaseTime:x})}catch(g){_.warn("RhythmPlaybackService",`Error scheduling note ${m+1}`,g)}}),_.info("RhythmPlaybackService",`Scheduled ${a.length} notes for rhythm pattern ${t}`)}stopCurrentPattern(){this.scheduledEvents.length!==0&&(_.debug("RhythmPlaybackService",`Clearing ${this.scheduledEvents.length} scheduled events`),Kt.releaseAll(),this.scheduledEvents=[])}getStampAtPosition(t,s){return d.state.stampPlacements&&d.state.stampPlacements.find(A=>{const r=A.row===s,a=t>=A.startColumn&&t<=A.endColumn;return r&&a})||null}playTripletPattern(t,s,i,A=null){if(!this.isInitialized){_.warn("RhythmPlaybackService","Not initialized, call initialize() first");return}this.stopCurrentPattern();const r=v0(t,A);if(!r||r.length===0){_.warn("RhythmPlaybackService",`No events found for triplet ${t}`);return}_.debug("RhythmPlaybackService",`Playing triplet pattern ${t}: ${r.length} notes`,{tripletStampId:t,basePitch:s,color:i,events:r,hasShapeOffsets:!!(A!=null&&A.shapeOffsets)});const a=$.now(),l=A==null?void 0:A.row;r.forEach((h,u)=>{try{const m=$.Time(h.offset).toSeconds(),g=a+m,v=$.Time(h.duration).toSeconds(),y=g+v;let C=s;if(l!==void 0&&h.rowOffset!==0){const x=l+h.rowOffset,F=d.state.fullRowData[x];F&&(C=F.toneNote.replace("?T-","b").replace("?T_","#"))}Kt.triggerAttack(C,i,g),Kt.triggerRelease(C,i,y),this.scheduledEvents.push({pitch:C,color:i,attackTime:g,releaseTime:y})}catch(m){_.warn("RhythmPlaybackService",`Error scheduling triplet note ${u+1}`,m)}}),_.info("RhythmPlaybackService",`Scheduled ${r.length} notes for triplet pattern ${t}`)}getTripletAtPosition(t,s){return d.state.tripletPlacements&&d.state.tripletPlacements.find(i=>i.row===s&&t>=i.startCellIndex&&t<i.startCellIndex+i.span)||null}dispose(){this.stopCurrentPattern(),this.isInitialized=!1,_.info("RhythmPlaybackService","Disposed")}}const Un=new TQ,T0=[];function Se(...e){T0.push(e)}const I0={enableModulationTool(){d.setSelectedTool("modulation"),Se("[MODULATION TEST] Modulation tool enabled. Click on the grid to place markers."),Se("[MODULATION TEST] Click marker labels to toggle 2:3  3:2"),Se("[MODULATION TEST] Drag marker barlines to move them")},addTestMarker(){const t=this.findNearestGridLine(200),s=this.findMeasureIndexForX(t.x),i=d.addModulationMarker(s,en.COMPRESSION_2_3,t.x,t.columnIndex);return Se("[MODULATION TEST] Added test marker at measure",s,"columnIndex=",t.columnIndex,"x=",t.x,"(snapped from",200,")"),i},addTestMarker2(){const t=this.findNearestGridLine(400),s=this.findMeasureIndexForX(t.x),i=d.addModulationMarker(s,en.EXPANSION_3_2,t.x,t.columnIndex);return Se("[MODULATION TEST] Added test marker 2 at measure",s,"columnIndex=",t.columnIndex,"x=",t.x,"(snapped from",400,")"),i},findNearestGridLine(e){const t=d.state;let s=0,i=0,A=1/0,r=0;for(let a=0;a<t.columnWidths.length;a++){const l=Math.abs(r-e);l<A&&(A=l,i=r,s=a);const h=t.columnWidths[a]||0;r+=h*t.cellWidth}return Se("[MODULATION TEST] findNearestGridLine:",{targetX:e,closestColumnIndex:s,closestX:i,minDistance:A}),{columnIndex:s,x:i}},findMeasureIndexForX(e){const t=d.state.cellWidth||40,s=5,i=Math.round(e/t);return Math.max(1,Math.round(i/s))},clearAllMarkers(){[...d.state.modulationMarkers||[]].forEach(t=>{d.removeModulationMarker(t.id)}),Se("[MODULATION TEST] Cleared all markers")},testMapping(){const e=d.state.baseMicrobeatPx||d.state.cellWidth||40;if(Se("[MODULATION TEST] Base microbeat pixels:",e),Se("[MODULATION TEST] Modulation markers:",d.state.modulationMarkers),window.getModulationMapping){const t=window.getModulationMapping();Se("[MODULATION TEST] Coordinate mapping:",t),[0,100,200,300,400,500].forEach(i=>{const A=t.canvasXToMicrobeat(i),r=t.microbeatToCanvasX(A);Se(`[MODULATION TEST] x=${i}  microbeat=${A.toFixed(3)}  x=${r.toFixed(1)}`)})}},testVisualExpansion(){Se("[MODULATION TEST] Testing visual grid expansion..."),this.clearAllMarkers();const e=this.addTestMarker2();Se("[MODULATION TEST] Added 3:2 expansion marker:",e),typeof window<"u"&&window.LayoutService&&(Se("[MODULATION TEST] Manually triggering layout recalculation..."),window.LayoutService.recalculateLayout()),setTimeout(()=>{Se("[MODULATION TEST] Grid should now show expansion after x=400"),Se("[MODULATION TEST] Container should be wider to accommodate expansion"),Se("[MODULATION TEST] Check console for [LAYOUT], [GETCOLX], [GRIDLINES], and [NOTES] logs")},100)},testVisualCompression(){Se("[MODULATION TEST] Testing visual grid compression..."),this.clearAllMarkers();const e=this.addTestMarker();Se("[MODULATION TEST] Added 2:3 compression marker:",e),typeof window<"u"&&window.LayoutService&&(Se("[MODULATION TEST] Manually triggering layout recalculation..."),window.LayoutService.recalculateLayout()),setTimeout(()=>{Se("[MODULATION TEST] Grid should now show compression after x=200"),Se("[MODULATION TEST] Container should adjust to accommodate compression"),Se("[MODULATION TEST] Check console for [LAYOUT], [GETCOLX], [GRIDLINES], and [NOTES] logs")},100)},logState(){Se("[MODULATION TEST] Current state:",{selectedTool:d.state.selectedTool,modulationMarkers:d.state.modulationMarkers,baseMicrobeatPx:d.state.baseMicrobeatPx,cellWidth:d.state.cellWidth})}};typeof window<"u"&&(window.ModulationTest=I0,window.ModulationTestLogs=T0);function IQ(){const e=document.getElementById("anacrusis-on-btn"),t=document.getElementById("anacrusis-off-btn");!e||!t||(e.addEventListener("click",()=>d.setAnacrusis(!0)),t.addEventListener("click",()=>d.setAnacrusis(!1)),d.on("anacrusisChanged",s=>{e.classList.toggle("active",s),t.classList.toggle("active",!s)}),e.classList.toggle("active",d.state.hasAnacrusis),t.classList.toggle("active",!d.state.hasAnacrusis))}function QQ(){const e=document.getElementById("hide-drumgrid-toggle"),t=document.getElementById("drum-grid-wrapper");let s=!0;e&&t&&e.addEventListener("click",()=>{s=!s,t.style.display=s?"flex":"none",e.querySelector(".sidebar-button-text").textContent=s?"Hide Drum Grid":"Show Drum Grid",setTimeout(()=>yt.recalculateLayout(),10)})}function MQ(){const e=document.getElementById("settings-button"),t=document.getElementById("sidebar"),s=document.getElementById("sidebar-overlay"),i=document.getElementById("volume-icon-button"),A=document.getElementById("volume-popup"),r=document.getElementById("vertical-volume-slider"),a=()=>document.body.classList.toggle("sidebar-open");if(e&&t&&s&&(e.addEventListener("click",a),s.addEventListener("click",a)),i&&A&&r){const l="app.volumeSliderValue",h=v=>Math.min(100,Math.max(0,v)),u=()=>{try{const v=window.localStorage.getItem(l);if(v!==null){const y=Number(v);if(!Number.isNaN(y))return h(y)}}catch{}return 70},m=v=>{try{window.localStorage.setItem(l,String(h(v)))}catch{}},g=u();r.value=g,i.addEventListener("click",v=>{v.stopPropagation();const y=A.classList.toggle("visible");i.classList.toggle("active",y)}),r.addEventListener("input",function(){const v=parseInt(this.value,10),y=v===0?-1/0:v/100*37.5-50;d.emit("volumeChanged",y),m(v)}),document.addEventListener("click",v=>{!A.contains(v.target)&&v.target!==i&&(A.classList.remove("visible"),i.classList.remove("active"))}),r.dispatchEvent(new Event("input"))}IQ(),QQ()}function Q0(){const e=new Date,t=e.toLocaleDateString("en-US",{month:"long"}),s=e.getDate();return`SN-score-${t}${s}.csv`}async function UQ(e){try{const t={suggestedName:Q0(),types:[{description:"Student Notation CSV File",accept:{"text/csv":[".csv"]}}]},i=await(await window.showSaveFilePicker(t)).createWritable();await i.write(e),await i.close()}catch(t){t.name!=="AbortError"&&_.error("FileActionsInitializer","Error saving file with picker",t,"toolbar")}}function PQ(e){const t=document.createElement("a"),s=URL.createObjectURL(e);t.setAttribute("href",s),t.setAttribute("download",Q0()),document.body.appendChild(t),t.click(),document.body.removeChild(t),URL.revokeObjectURL(s)}function kQ(){return d.state.placedNotes.map(e=>[e.row,e.startColumnIndex,e.endColumnIndex,e.color,e.shape,e.tonicNumber||"",e.isDrum,e.drumTrack||""].join(",")).join(`
`)}function DQ(){var e,t,s,i;(e=document.getElementById("save-as-button"))==null||e.addEventListener("click",async()=>{const A=kQ(),r=new Blob([A],{type:"text/csv;charset=utf-8;"});window.showSaveFilePicker?await UQ(r):PQ(r)}),(t=document.getElementById("import-button"))==null||t.addEventListener("click",()=>{const A=document.createElement("input");A.type="file",A.accept=".csv,.txt",A.onchange=r=>{const a=r.target.files[0];if(!a)return;const l=new FileReader;l.onload=h=>{const m=h.target.result.split(`
`).filter(g=>g.trim()).map(g=>{const v=g.split(",");return{row:parseInt(v[0]),startColumnIndex:parseInt(v[1]),endColumnIndex:parseInt(v[2]),color:v[3],shape:v[4],tonicNumber:v[5]?parseInt(v[5]):null,isDrum:v[6]==="true",drumTrack:v[7]||null}});d.loadNotes(m)},l.readAsText(a)},A.click()}),(s=document.getElementById("print-button"))==null||s.addEventListener("click",()=>{document.body.classList.remove("sidebar-open"),d.emit("printPreviewStateChanged",!0)}),(i=document.getElementById("reset-canvas-button"))==null||i.addEventListener("click",()=>{window.confirm("Are you sure you want to reset the canvas? This will clear all your work and cannot be undone.")&&d.clearSavedState()})}class LQ{constructor(){var t,s,i,A,r;this.overlay=document.getElementById("notification-overlay"),this.modal=(t=this.overlay)==null?void 0:t.querySelector(".notification-modal"),this.title=(s=this.overlay)==null?void 0:s.querySelector(".notification-title"),this.message=(i=this.overlay)==null?void 0:i.querySelector(".notification-message"),this.actionsContainer=(A=this.overlay)==null?void 0:A.querySelector(".notification-actions"),this.closeButton=(r=this.overlay)==null?void 0:r.querySelector(".notification-close"),this.setupEventListeners()}setupEventListeners(){var t;this.overlay&&((t=this.closeButton)==null||t.addEventListener("click",()=>this.hide()),this.overlay.addEventListener("click",s=>{s.target===this.overlay&&this.hide()}),document.addEventListener("keydown",s=>{var i;s.key==="Escape"&&((i=this.overlay)!=null&&i.classList.contains("visible"))&&this.hide()}))}show(t={}){if(!this.overlay)return;const{title:s="Notice",message:i="",buttons:A=[{text:"OK",primary:!0,action:()=>this.hide()}]}=t;this.title&&(this.title.textContent=s),this.message&&(this.message.textContent=i),this.actionsContainer&&(this.actionsContainer.innerHTML="",A.forEach(r=>{const a=document.createElement("button");a.className=`notification-button ${r.primary?"":"secondary"}`,a.textContent=r.text,a.addEventListener("click",()=>{r.action?r.action():this.hide()}),this.actionsContainer.appendChild(a)})),this.overlay.classList.add("visible"),setTimeout(()=>{var a;const r=(a=this.actionsContainer)==null?void 0:a.querySelector(".notification-button");r==null||r.focus()},100)}hide(){this.overlay&&this.overlay.classList.remove("visible")}alert(t,s="Notice"){this.show({title:s,message:t,buttons:[{text:"OK",primary:!0,action:()=>this.hide()}]})}confirm(t,s="Confirm"){return new Promise(i=>{this.show({title:s,message:t,buttons:[{text:"Cancel",primary:!1,action:()=>{this.hide(),i(!1)}},{text:"OK",primary:!0,action:()=>{this.hide(),i(!0)}}]})})}}const Kg=new LQ;function Cl(e,...t){}const Xd=40,HQ=Xd;class qg{constructor(t,s,i,A){this.element=t,this.viewportEl=t==null?void 0:t.querySelector(".clef-wheel-viewport"),this.optionsEl=t==null?void 0:t.querySelector(".clef-wheel-options"),this.onChange=A,this.options=s,this.selectedIndex=0,this.pointerActive=!1,this.pointerId=null,this.deltaBuffer=0,this.silent=!1,this.optionHeight=Xd,this.resizeObserver=null,this.debugLabel=(t==null?void 0:t.id)||"clef-wheel",!(!t||!this.viewportEl||!this.optionsEl)&&(this.renderOptions(),this.setIndex(i,{silent:!0}),this.attachEvents(),this.observeSize())}renderOptions(){this.optionsEl.innerHTML="",this.optionNodes=this.options.map((t,s)=>{const i=document.createElement("div");return i.className="clef-wheel-option",i.dataset.index=s.toString(),i.textContent=t.label,this.optionsEl.appendChild(i),i})}attachEvents(){this.element.addEventListener("wheel",s=>{s.preventDefault(),s.stopPropagation();const i=Math.sign(s.deltaY);i!==0&&this.increment(i)},{passive:!1}),this.element.addEventListener("keydown",s=>{s.key==="ArrowUp"?(s.preventDefault(),this.increment(-1)):s.key==="ArrowDown"?(s.preventDefault(),this.increment(1)):s.key==="Home"?(s.preventDefault(),this.setIndex(0)):s.key==="End"&&(s.preventDefault(),this.setIndex(this.options.length-1))}),this.element.addEventListener("pointerdown",s=>{if(this.pointerActive=!0,this.pointerId=s.pointerId,this.lastPointerY=s.clientY,this.deltaBuffer=0,typeof this.element.setPointerCapture=="function")try{this.element.setPointerCapture(this.pointerId)}catch{}}),this.element.addEventListener("pointermove",s=>{if(!this.pointerActive||s.pointerId!==this.pointerId)return;const i=s.clientY-this.lastPointerY;if(this.lastPointerY=s.clientY,i===0)return;this.deltaBuffer+=i;const A=this.optionHeight||HQ;for(;Math.abs(this.deltaBuffer)>=A;){const r=-Math.sign(this.deltaBuffer);this.increment(r),this.deltaBuffer-=Math.sign(this.deltaBuffer)*A}});const t=s=>{this.pointerActive&&s.pointerId===this.pointerId&&(this.pointerActive=!1,this.pointerId=null,this.deltaBuffer=0,this.element.hasPointerCapture(s.pointerId)&&this.element.releasePointerCapture(s.pointerId))};this.element.addEventListener("pointerup",t),this.element.addEventListener("pointercancel",t),this.element.addEventListener("pointerleave",s=>{this.pointerActive&&s.pointerId===this.pointerId&&(this.pointerActive=!1,this.pointerId=null,this.deltaBuffer=0,this.element.hasPointerCapture(s.pointerId)&&this.element.releasePointerCapture(s.pointerId))})}observeSize(){this.element&&(typeof ResizeObserver=="function"?(this.resizeObserver=new ResizeObserver(t=>{for(const s of t)s.target===this.element&&s.contentRect.height>0&&this.updateVisuals()}),this.resizeObserver.observe(this.element)):window.addEventListener("resize",()=>this.updateVisuals()))}getIndex(){return this.selectedIndex}increment(t){if(t===0||!this.options||this.options.length===0)return;const s=this.selectedIndex+t;this.setIndex(s)}setIndex(t,{silent:s=!1}={}){if(!this.optionsEl)return;const i=Math.max(0,Math.min(this.options.length-1,t));if(i===this.selectedIndex){this.updateVisuals();return}this.selectedIndex=i,this.updateVisuals(),!s&&typeof this.onChange=="function"&&this.onChange(i,this.options[i])}updateVisuals(){var l,h;if(!this.optionsEl||!this.viewportEl)return;const t=this.viewportEl.clientHeight||0,s=(l=this.optionNodes)==null?void 0:l[this.selectedIndex],i=(h=this.optionNodes)==null?void 0:h[0],A=(s==null?void 0:s.offsetHeight)||(i==null?void 0:i.offsetHeight)||Xd;if(this.optionHeight=A,this.optionNodes&&this.optionNodes.forEach((u,m)=>{const g=Math.abs(m-this.selectedIndex),v=Math.min(g,3);u.dataset.distance=String(v)}),t===0||A===0)return;const r=Math.max(0,(t-A)/2);this.optionsEl.style.paddingTop=`${r}px`,this.optionsEl.style.paddingBottom=`${r}px`;let a=0;if(s){const u=s.offsetTop+A/2;a=t/2-u}else a=t/2-(r+A/2);this.optionsEl.style.transform=`translateY(${a}px)`}}class RQ{constructor(){this.initialized=!1,this.topPicker=null,this.bottomPicker=null,this.suppressStoreSync=!1,this.snapToggle=null,this.lockToggle=null,this.presetContainer=null,this.presetButtons=[],this.activePresetId=null,this.presetRanges={}}init(){if(this.initialized)return;if(this.topWheel=document.getElementById("clef-top-wheel"),this.bottomWheel=document.getElementById("clef-bottom-wheel"),this.rangeLabel=document.getElementById("clef-range-label"),this.rangeCount=document.getElementById("clef-range-count"),this.fullRangeButton=document.getElementById("clef-full-range-button"),this.trebleButton=document.getElementById("clef-treble-button"),this.altoButton=document.getElementById("clef-alto-button"),this.bassButton=document.getElementById("clef-bass-button"),this.lockToggle=document.getElementById("clef-lock-toggle"),this.lockToggle?logger.info("ClefRangeController","Lock Range toggle found",{checked:this.lockToggle.checked},"ui"):logger.warn("ClefRangeController","Lock Range toggle not found in DOM",null,"ui"),this.presetContainer=document.querySelector(".clef-preset-buttons"),this.presetButtons=Array.from(document.querySelectorAll(".clef-preset-button")),!this.topWheel||!this.bottomWheel){logger.warn("ClefRangeController","Clef tab elements not found; skipping initialization",null,"ui");return}this.masterOptions=pe.map((s,i)=>({index:i,label:s.pitch,toneNote:s.toneNote,frequency:s.frequency}));const t=this.normaliseRange(d.state.pitchRange,this.masterOptions.length);if(this.topPicker=new qg(this.topWheel,this.masterOptions,t.topIndex,s=>this.handleTopSelection(s)),this.bottomPicker=new qg(this.bottomWheel,this.masterOptions,t.bottomIndex,s=>this.handleBottomSelection(s)),this.fullRangeButton&&this.fullRangeButton.addEventListener("click",()=>this.setPresetRange("full")),this.trebleButton&&this.trebleButton.addEventListener("click",()=>this.setPresetRange("treble")),this.altoButton&&this.altoButton.addEventListener("click",()=>this.setPresetRange("alto")),this.bassButton&&this.bassButton.addEventListener("click",()=>this.setPresetRange("bass")),this.lockToggle){const s=d.state.isPitchRangeLocked!==!1;this.lockToggle.checked=s,this.lockToggle.addEventListener("change",()=>{this.handleLockToggle(this.lockToggle.checked)})}d.on("pitchRangeChanged",s=>{this.syncFromStore(s)}),d.on("pitchRangeLockChanged",s=>{this.lockToggle&&(this.lockToggle.checked=s),this.updatePresetStyles()}),this.computePresetRanges(),this.currentRange=t,this.lastTopIndex=t.topIndex,this.lastBottomIndex=t.bottomIndex,this.updatePresetHighlightFromRange(t),this.updateSummary(),this.initialized=!0,logger.moduleLoaded("ClefRangeController","ui")}normaliseRange(t,s){const i={topIndex:0,bottomIndex:s-1};if(!t)return i;const A=Math.max(0,Math.min(s-1,t.topIndex)),r=Math.max(A,Math.min(s-1,t.bottomIndex));return{topIndex:A,bottomIndex:r}}handleTopSelection(t){const s=this.bottomPicker.getIndex(),i=Math.max(t,s);i!==s&&this.bottomPicker.setIndex(i,{silent:!0}),this.commitRangeChange(t,i)}handleBottomSelection(t){const s=this.topPicker.getIndex(),i=Math.min(t,s);i!==s&&this.topPicker.setIndex(i,{silent:!0}),this.commitRangeChange(i,t)}computePresetRanges(){const t={};t.full={topIndex:0,bottomIndex:this.masterOptions.length>0?this.masterOptions.length-1:0};const s=(i,A)=>{const r=this.findNoteIndex(i),a=this.findNoteIndex(A);return r===-1||a===-1?null:{topIndex:Math.min(r,a),bottomIndex:Math.max(r,a)}};t.treble=s("A/G5","C4"),t.alto=s("B/A4","D3"),t.bass=s("D/C4","F2"),this.presetRanges=t}updatePresetHighlightFromRange(t){if(!t)return;let s=null;Object.entries(this.presetRanges||{}).forEach(([i,A])=>{A&&A.topIndex===t.topIndex&&A.bottomIndex===t.bottomIndex&&(s=i)}),this.activePresetId=s,this.updatePresetStyles()}updatePresetStyles(){var s;const t=d.state.isPitchRangeLocked!==!1;this.presetContainer&&this.presetContainer.classList.toggle("locked",t),(s=this.presetButtons)!=null&&s.length&&this.presetButtons.forEach(i=>{var a;const A=(a=i.dataset)!=null&&a.preset?i.dataset.preset:(i.id||"").replace(/^clef-/,"").replace(/-button$/,"").replace(/-range$/,"").replace(/-/g,""),r=this.activePresetId&&A===this.activePresetId;i.classList.toggle("active",!!r)})}commitRangeChange(t,s){const i=this.currentRange||d.state.pitchRange||{topIndex:0},A=Math.max(0,Math.min(this.masterOptions.length-1,t)),r=Math.max(A,Math.min(this.masterOptions.length-1,s));if(Cl("log","[CommitRange] Current range:",this.currentRange),this.currentRange&&this.currentRange.topIndex===A&&this.currentRange.bottomIndex===r)return;let a=null;if(yt!=null&&yt.getViewportInfo){const u=yt.getViewportInfo();u&&(a=(i.topIndex??0)+u.startRank)}this.currentRange={topIndex:A,bottomIndex:r},this.lastTopIndex=A,this.lastBottomIndex=r,this.updateSummary(),this.updatePresetHighlightFromRange(this.currentRange);const l=d.state.isPitchRangeLocked!==!1,h=l;!l&&d.state.snapZoomToRange&&d.setSnapZoomToRange(!1),d.setPitchRange({topIndex:A,bottomIndex:r},{maintainGlobalStart:a,trimOutsideRange:h,preserveContent:!h}),l?(Cl("log",`[CommitRange] Snap zoom currently: ${d.state.snapZoomToRange}`),d.state.snapZoomToRange||d.setSnapZoomToRange(!0),Cl("log",`[CommitRange] Snap zoom now: ${d.state.snapZoomToRange}`),yt&&typeof yt.snapZoomToCurrentRange=="function"&&d.state.snapZoomToRange?yt.snapZoomToCurrentRange():yt&&typeof yt.recalculateLayout=="function"&&yt.recalculateLayout()):yt&&typeof yt.recalculateLayout=="function"&&yt.recalculateLayout()}handleLockToggle(t){var A;const s=!!t;d.setPitchRangeLock(s);const i=this.currentRange||this.normaliseRange(d.state.pitchRange,this.masterOptions.length);s?this.commitRangeChange(i.topIndex,i.bottomIndex):(d.setSnapZoomToRange(!1),(A=yt.recalculateLayout)==null||A.call(yt))}syncFromStore(t){if(!this.initialized||!t)return;const s=this.normaliseRange(t,this.masterOptions.length);this.currentRange=s,this.topPicker&&this.topPicker.getIndex()!==s.topIndex&&this.topPicker.setIndex(s.topIndex,{silent:!0}),this.bottomPicker&&this.bottomPicker.getIndex()!==s.bottomIndex&&this.bottomPicker.setIndex(s.bottomIndex,{silent:!0}),this.updateSummary(t.metadata),this.updatePresetHighlightFromRange(s)}updateSummary(t){if(!this.currentRange)return;const s=this.masterOptions[this.currentRange.topIndex],i=this.masterOptions[this.currentRange.bottomIndex],A=this.currentRange.bottomIndex-this.currentRange.topIndex+1;if(this.rangeLabel&&(this.rangeLabel.textContent=`${s.label}  ${i.label}`),this.rangeCount&&(this.rangeCount.textContent=`${A} ${A===1?"pitch":"pitches"}`),t){const{removedNotes:r=0,removedStamps:a=0,removedTriplets:l=0}=t,h=r+a+l;h>0&&logger.info("ClefRangeController",`Range change removed: ${h} items`,t,"ui")}}resetRange(){this.topPicker.setIndex(0,{silent:!0}),this.bottomPicker.setIndex(this.masterOptions.length-1,{silent:!0}),this.commitRangeChange(0,this.masterOptions.length-1)}findNoteIndex(t){return this.masterOptions.findIndex(s=>s.label===t)}animateWheelToIndex(t,s,i=300){const A=t.getIndex(),r=s-A,a=performance.now(),l=h=>{const u=h-a,m=Math.min(u/i,1),g=1-Math.pow(1-m,3),v=Math.round(A+r*g);t.setIndex(v,{silent:m<1}),m<1?requestAnimationFrame(l):(t.selectedIndex=s,t.updateVisuals(),typeof t.onChange=="function"&&t.onChange(s,t.options[s]))};requestAnimationFrame(l)}setPresetRange(t){let s,i;switch(t){case"full":this.activePresetId=t,this.updatePresetStyles(),this.animateRangeTransition(0,this.masterOptions.length-1);return;case"treble":s="A/G5",i="C4";break;case"alto":s="B/A4",i="D3";break;case"bass":s="D/C4",i="F2";break;default:return}const A=this.findNoteIndex(s),r=this.findNoteIndex(i);if(A===-1||r===-1){logger.warn("ClefRangeController",`Preset notes not found: ${s} or ${i}`,null,"ui");return}this.activePresetId=t,this.updatePresetStyles(),this.animateRangeTransition(A,r)}animateRangeTransition(t,s,i=500){const A=this.topPicker.getIndex(),r=this.bottomPicker.getIndex(),a=t-A,l=s-r,h=performance.now();let u=0;d.state.snapZoomToRange&&d.setSnapZoomToRange(!1);const g=yt.getCurrentZoomLevel?yt.getCurrentZoomLevel():1,y=this.calculateTargetZoom(t,s)-g,C=d.state.isPitchRangeLocked!==!1,x=F=>{const I=F-h,T=Math.min(I/i,1),U=T<.5?4*T*T*T:1-Math.pow(-2*T+2,3)/2,D=Math.round(A+a*U),O=Math.round(r+l*U),R=g+y*U;u++,(u%10===0||T===1)&&Cl("log",`[AnimateRange] Frame ${u}: progress=${(T*100).toFixed(1)}%, top=${D}, bottom=${O}, zoom=${Math.round(R*100)}%`),this.topPicker.setIndex(D,{silent:!0}),this.bottomPicker.setIndex(O,{silent:!0}),d.state.pitchRange={topIndex:D,bottomIndex:O},pe&&pe.length>0&&(d.state.fullRowData=pe.slice(D,O+1)),this.currentRange={topIndex:D,bottomIndex:O},this.updateSummary(),yt.setZoomLevel&&yt.setZoomLevel(R),document.dispatchEvent(new CustomEvent("canvasResized",{detail:{source:"clefRangeAnimation"}})),T<1?requestAnimationFrame(x):(this.topPicker.selectedIndex=t,this.bottomPicker.selectedIndex=s,this.topPicker.updateVisuals(),this.bottomPicker.updateVisuals(),this.currentRange={topIndex:t,bottomIndex:s},this.lastTopIndex=t,this.lastBottomIndex=s,this.updateSummary(),this.updatePresetHighlightFromRange(this.currentRange),C?(d.setPitchRange({topIndex:t,bottomIndex:s}),d.setSnapZoomToRange(!0)):(d.setSnapZoomToRange(!1),d.setPitchRange({topIndex:t,bottomIndex:s},{trimOutsideRange:!1,preserveContent:!0})))};requestAnimationFrame(x)}calculateTargetZoom(t,s){const i=s-t+1;if(i===0)return 1;const A=document.getElementById("pitch-grid-container"),r=(A==null?void 0:A.clientHeight)||window.innerHeight*.7;if(!r||r<=0)return 1;const l=2*r/(i*30);return Math.max(.1,Math.min(5,l))}applyViewPresetRange(t,s){const i=this.calculateTargetZoom(t,s);yt.setPendingStartRow&&yt.setPendingStartRow(t),yt.setZoomLevel?yt.setZoomLevel(i):yt.recalculateLayout&&yt.recalculateLayout()}refreshWheelVisuals(){this.topPicker&&this.topPicker.updateVisuals(),this.bottomPicker&&this.bottomPicker.updateVisuals()}}const zg=new RQ,OQ={X:["1P","3M","5P"],x:["1P","3m","5P"],"x":["1P","3m","5d"],"X+":["1P","3M","6m"],X7:["1P","3M","5P","7m"],"x":["1P","3m","5P","7m"],"Xmaj":["1P","3M","5P","7M"],"":["1P","3m","5d","7m"],"x":["1P","3m","5d","6M"],"X":["1P","3M","5P","6M"],Xsus2:["1P","2M","5P"],Xsus4:["1P","4P","5P"]},NQ={"xmaj":["1P","3m","5P","7M"],Xadd9:["1P","3M","5P","9M"],xadd9:["1P","3m","5P","9M"],"X6/9":["1P","3M","5P","6M","9M"],X9:["1P","3M","5P","7m","9M"],X11:["1P","3M","5P","7m","9M","11P"],X13:["1P","3M","5P","7m","9M","13M"],Xmaj9:["1P","3M","5P","7M","9M"],"x":["1P","3m","5P","7m","9M"],"x":["1P","3m","5P","6M"],"x":["1P","3m","5P","7m","9M","11P"],"Xmaj711":["1P","3M","5P","7M","11A"]},M0={...OQ,...NQ},Yd={M6:["6M"],A6:["6A"],m7:["7m"],M7:["7M"],d5:["5d"],P5:["5P"],A5:["5A"],m6:["6m"],m3:["3m"],M3:["3M"],P4:["4P"],A4:["4A"],U:["1P"],m2:["2m"],M2:["2M"],A2:["2A"]},VQ={"9m":"2m","9M":"2M","9A":"2A","11P":"4P","11A":"4A","13m":"6m","13M":"6M","13A":"6A"};function jd(e){return VQ[e]||e}function $g(){return Object.keys(d.state.tonicSignGroups).length>0}function Xg(){const e=document.getElementById("degree-mode-toggle");if(e){const t=d.state.degreeDisplayMode==="off";e.classList.toggle("disabled",t)}}function Yg(){const e=document.querySelector("#chords-panel .chords-grid");if(e&&e.querySelectorAll(".harmony-preset-button").forEach(t=>{t.classList.remove("selected","partial-match")}),d.state.activeChordIntervals&&e){const t=d.state.activeChordIntervals,s=t.toString(),i=t.map(jd);for(const A of e.querySelectorAll(".harmony-preset-button")){const r=M0[A.textContent.trim()];if(!r)continue;const a=r.toString(),l=r.map(jd);if(a===s){A.classList.add("selected");continue}i.every(u=>l.includes(u))&&A.classList.add("partial-match")}}}function jg(){const e=document.querySelector("#chords-panel .intervals-4x4-grid");if(e&&(e.querySelectorAll(".harmony-preset-button").forEach(t=>t.classList.remove("selected")),d.state.activeChordIntervals)){const s=d.state.activeChordIntervals.map(jd);e.querySelectorAll(".harmony-preset-button").forEach(i=>{const A=i.textContent.trim(),r=Yd[A];r&&s.includes(r[0])&&i.classList.add("selected")})}}const bl=(e,t=50)=>{const s=parseInt(e.slice(1,3),16),i=parseInt(e.slice(3,5),16),A=parseInt(e.slice(5,7),16),r=Math.min(255,Math.floor(s+(255-s)*(t/100))),a=Math.min(255,Math.floor(i+(255-i)*(t/100))),l=Math.min(255,Math.floor(A+(255-A)*(t/100)));return`#${r.toString(16).padStart(2,"0")}${a.toString(16).padStart(2,"0")}${l.toString(16).padStart(2,"0")}`};function WQ(){const{noteBankContainer:e,eraserButton:t,degreeVisibilityToggle:s,degreeModeToggle:i,flatBtn:A,sharpBtn:r,frequencyBtn:a,focusColoursToggle:l}=uA.getMultiple("noteBankContainer","eraserButton","degreeVisibilityToggle","degreeModeToggle","flatBtn","sharpBtn","frequencyBtn","focusColoursToggle"),h=document.querySelector(".pitch-tabs-container"),u=document.getElementById("inversion-toggle"),m=document.getElementById("chord-position-toggle-6");zg.init(),e&&e.querySelectorAll(".note").forEach(L=>{L.addEventListener("click",()=>{d.setSelectedNote(L.dataset.type,L.closest(".note-pair").dataset.color),d.setSelectedTool("note")})}),t&&t.addEventListener("click",()=>d.setSelectedTool("eraser"));const g=Array.from(document.querySelectorAll(".tonic-mode-button")),v=(L=d.state.selectedToolTonicNumber)=>{if(!g.length)return;const J=g[0]?parseInt(g[0].dataset.tonic,10):1,dt=parseInt(L,10),ht=Number.isNaN(dt)?J:dt;g.forEach(rt=>{const It=parseInt(rt.dataset.tonic,10)===ht;rt.classList.toggle("selected",It),rt.setAttribute("aria-pressed",It?"true":"false")})};g.length&&(g.forEach(L=>{L.addEventListener("click",()=>{const J=L.getAttribute("data-tonic");J&&(d.setSelectedTool("tonicization",J),v(parseInt(J,10)))})}),v());const y=document.querySelector("#chords-panel .chords-grid");function C(L,J,dt){L&&L.querySelectorAll(".harmony-preset-button").forEach(ht=>{ht.addEventListener("click",()=>{const rt=J[ht.textContent];rt&&rt.length>0?(d.setActiveChordIntervals(rt),d.setSelectedTool("chord")):_.error("ToolSelector",`Failed to retrieve valid intervals for ${dt} chord: "${ht.textContent}"`,null,"toolbar"),ht.blur()}),ht.addEventListener("dblclick",()=>{ht.classList.contains("selected")&&d.setSelectedTool("note"),ht.blur()})})}C(y,M0,"chords");const x=document.querySelectorAll(".pitch-tab-button"),F=document.querySelectorAll(".pitch-tab-panel");if(x.length>0){x.forEach(ht=>{ht.addEventListener("click",()=>{const rt=ht.dataset.pitchTab;x.forEach(It=>It.classList.remove("active")),ht.classList.add("active"),F.forEach(It=>It.classList.remove("active"));const Tt=document.getElementById(`${rt}-panel`);Tt&&Tt.classList.add("active"),localStorage.setItem("selectedPitchTab",rt),rt==="chords"&&U(),rt==="range"&&setTimeout(()=>{zg.refreshWheelVisuals()},0)})});const L=localStorage.getItem("selectedPitchTab")||"chords",J=document.querySelector(`[data-pitch-tab="${L}"]`),dt=document.getElementById(`${L}-panel`);J&&dt&&(x.forEach(ht=>ht.classList.remove("active")),F.forEach(ht=>ht.classList.remove("active")),J.classList.add("active"),dt.classList.add("active"))}if(u){u.addEventListener("click",()=>{const J=!d.state.isIntervalsInverted;d.setIntervalsInversion(J),u.blur()});const L=J=>{u.classList.toggle("active",J)};d.on("intervalsInversionChanged",L),L(d.state.isIntervalsInverted)}if(m){m.addEventListener("click",()=>{const J=d.state.chordPositionState,dt=I(),ht=(J+1)%dt;d.setChordPosition(ht),m.blur()});const L=J=>{m.classList.remove("state-1","state-2","state-3","state-4","state-5"),J===1?m.classList.add("state-1"):J===2?m.classList.add("state-2"):J===3?m.classList.add("state-3"):J===4?m.classList.add("state-4"):J===5&&m.classList.add("state-5")};d.on("chordPositionChanged",J=>{L(J)}),L(d.state.chordPositionState)}function I(){const L=d.state.activeChordIntervals;return!L||L.length===0?3:L.length}function T(){const L=d.state.activeChordIntervals;return!L||L.length===0?3:L.length}function U(){if(!m)return;const L=T();for(let dt=0;dt<=5;dt++)m.classList.remove(`disabled-state-${dt}`);L<4?m.classList.add("disabled-state-3","disabled-state-4","disabled-state-5"):L===4?m.classList.add("disabled-state-4","disabled-state-5"):L===5&&m.classList.add("disabled-state-5");const J=L-1;d.state.chordPositionState>J&&d.setChordPosition(0)}const D=document.querySelector("#chords-panel .intervals-4x4-grid");D&&D.querySelectorAll(".harmony-preset-button").forEach(L=>{L.addEventListener("click",()=>{const J=L.textContent.trim(),dt=Yd[J];if(dt&&dt.length>0){const ht=dt[0];let rt=d.state.selectedTool==="chord"&&d.state.activeChordIntervals?[...d.state.activeChordIntervals]:["1P"];rt.includes(ht)?ht!=="1P"&&(rt=rt.filter(It=>It!==ht)):rt.push(ht),rt.includes("1P")||rt.unshift("1P");const Tt=["1P","2m","2M","2A","3m","3M","4P","4A","5d","5P","5A","6m","6M","6A","7m","7M","9M","11P","11A","13M"];rt.sort((It,Ht)=>{const tt=Tt.indexOf(It),ct=Tt.indexOf(Ht);return tt-ct}),d.setActiveChordIntervals(rt),d.setSelectedTool("chord"),_.debug("ToolSelector",`Interval ${J} toggled`,rt,"toolbar")}else _.error("ToolSelector",`Failed to retrieve valid interval for symbol: "${J}"`,null,"toolbar"),_.error("ToolSelector","Available interval shapes",Object.keys(Yd),"toolbar");L.blur()}),L.addEventListener("dblclick",()=>{d.setActiveChordIntervals(["1P"]),d.setSelectedTool("chord"),L.blur()})}),s&&s.addEventListener("click",()=>{if(d.state.degreeDisplayMode==="off"){if(!$g()){Kg.alert("Please place a tonal center on the canvas before showing degrees.","Tonal Center Required");return}const dt=i.classList.contains("active")?"modal":"diatonic";d.setDegreeDisplayMode(dt)}else d.setDegreeDisplayMode("off");s.blur()}),i&&i.addEventListener("click",()=>{if(i.classList.contains("disabled"))return;i.classList.toggle("active");const J=i.classList.contains("active")?"modal":"diatonic";d.setDegreeDisplayMode(J),i.blur()}),A&&A.addEventListener("click",()=>{console.log(" FLAT BUTTON CLICKED - Before state:",{sharp:d.state.accidentalMode.sharp,flat:d.state.accidentalMode.flat,showFrequencyLabels:d.state.showFrequencyLabels,flatBtnClasses:A.classList.toString()}),d.state.showFrequencyLabels&&d.toggleFrequencyLabels(),d.toggleAccidentalMode("flat"),A.blur(),console.log(" FLAT BUTTON CLICKED - After state:",{sharp:d.state.accidentalMode.sharp,flat:d.state.accidentalMode.flat,flatBtnClasses:A.classList.toString()})}),r&&r.addEventListener("click",()=>{console.log(" SHARP BUTTON CLICKED - Before state:",{sharp:d.state.accidentalMode.sharp,flat:d.state.accidentalMode.flat,showFrequencyLabels:d.state.showFrequencyLabels,sharpBtnClasses:r.classList.toString()}),d.state.showFrequencyLabels&&d.toggleFrequencyLabels(),d.toggleAccidentalMode("sharp"),r.blur(),console.log(" SHARP BUTTON CLICKED - After state:",{sharp:d.state.accidentalMode.sharp,flat:d.state.accidentalMode.flat,sharpBtnClasses:r.classList.toString()})}),a&&a.addEventListener("click",()=>{d.toggleFrequencyLabels(),a.blur()});const O=L=>{[A,r].forEach(J=>{J&&(J.classList.toggle("accidental-btn--disabled",L),J.setAttribute("aria-disabled",L?"true":"false"))})},R=L=>{a&&(a.classList.toggle("active",L),a.setAttribute("aria-pressed",L?"true":"false")),O(L)};if(l&&l.addEventListener("change",()=>{if(!d.state.focusColours&&!$g()){Kg.alert("Please place a tonal center on the canvas before enabling focus colours.","Tonal Center Required"),l.checked=!1;return}d.toggleFocusColours()}),d.on("toolChanged",({newTool:L})=>{var J;if(t==null||t.classList.remove("selected"),h&&h.classList.remove("active-tool"),L==="eraser")t==null||t.classList.add("selected");else if(L!=="tonicization"){if(L==="chord")h==null||h.classList.add("active-tool");else if(L==="note"){const dt=d.state.selectedNote;if(dt){const ht=document.querySelector(`.note-pair[data-color='${dt.color}']`);ht==null||ht.classList.add("selected"),(J=ht==null?void 0:ht.querySelector(`.note[data-type='${dt.shape}']`))==null||J.classList.add("selected")}}}v()}),d.on("activeChordIntervalsChanged",()=>{Yg(),jg(),U()}),d.on("noteChanged",({newNote:L})=>{var ht;document.querySelectorAll(".note, .note-pair").forEach(rt=>rt.classList.remove("selected"));const J=document.querySelector(`.note-pair[data-color='${L.color}']`);if(J==null||J.classList.add("selected"),(ht=J==null?void 0:J.querySelector(`.note[data-type='${L.shape}']`))==null||ht.classList.add("selected"),h){const rt=bl(L.color,50),Tt=bl(rt,60);h.style.setProperty("--c-accent",L.color),h.style.setProperty("--c-accent-light",Tt)}const dt=document.querySelector(".tab-sidebar");dt&&dt.style.setProperty("--c-accent",L.color)}),d.on("degreeDisplayModeChanged",L=>{s&&s.classList.toggle("active",L!=="off"),i&&i.classList.toggle("active",L==="modal"),Xg()}),d.on("accidentalModeChanged",L=>{const{sharp:J,flat:dt}=L;console.log(" EVENT: accidentalModeChanged fired",{sharp:J,flat:dt,sharpBtnBefore:r==null?void 0:r.classList.toString(),flatBtnBefore:A==null?void 0:A.classList.toString()}),r==null||r.classList.toggle("active",J),A==null||A.classList.toggle("active",dt),console.log(" EVENT: accidentalModeChanged - UI updated",{sharpBtnAfter:r==null?void 0:r.classList.toString(),flatBtnAfter:A==null?void 0:A.classList.toString()})}),d.on("frequencyLabelsChanged",R),R(d.state.showFrequencyLabels),h&&d.state.selectedNote){const L=d.state.selectedNote.color,J=bl(L,50),dt=bl(J,60);h.style.setProperty("--c-accent",L),h.style.setProperty("--c-accent-light",dt)}const st=document.querySelector(".tab-sidebar");st&&d.state.selectedNote&&st.style.setProperty("--c-accent",d.state.selectedNote.color),setTimeout(()=>U(),50),Xg();const Y=d.state.degreeDisplayMode;s&&s.classList.toggle("active",Y!=="off"),i&&(i.classList.toggle("active",Y==="modal"),i.classList.toggle("disabled",Y==="off")),Yg(),jg(),U()}function GQ(){const e=document.getElementById("play-button"),t=document.getElementById("stop-button"),s=document.getElementById("clear-button"),i=document.getElementById("loop-button"),A=document.getElementById("undo-button"),r=document.getElementById("redo-button");e&&e.addEventListener("click",()=>{const{isPlaying:l,isPaused:h}=d.state;l&&h?(d.setPlaybackState(!0,!1),cr.resume()):l&&!h?(d.setPlaybackState(!0,!0),cr.pause()):(d.setPlaybackState(!0,!1),cr.start()),e.blur()}),t&&t.addEventListener("click",()=>{d.setPlaybackState(!1,!1),cr.stop(),t.blur()}),s&&s.addEventListener("click",()=>{s.classList.add("flash"),setTimeout(()=>s.classList.remove("flash"),300),d.clearAllNotes(),tQ(),iQ(),s.blur()}),i&&i.addEventListener("click",()=>{d.setLooping(!d.state.isLooping)}),A&&A.addEventListener("click",()=>{d.undo(),A.blur()}),r&&r.addEventListener("click",()=>{d.redo(),r.blur()}),d.on("playbackStateChanged",({isPlaying:l,isPaused:h})=>{if(e){const u=`<img src="${Ii("play.svg")}" alt="Play">`,m=`<img src="${Ii("pause.svg")}" alt="Pause">`;e.innerHTML=l&&!h?m:u}}),d.on("loopingChanged",l=>{i&&i.classList.toggle("active",l)});const a=()=>{A&&(A.disabled=d.state.historyIndex<=0),r&&(r.disabled=d.state.historyIndex>=d.state.history.length-1)};d.on("historyChanged",a),a()}const dA=Cr,Mn={blend:2,cutoff:31,resonance:0,type:"lowpass"};function fa(){return{coeffs:new Float32Array(dA).fill(0),phases:new Float32Array(dA).fill(0)}}function KQ(){const e=fa();return e.coeffs[0]=1,e}function qQ(){const e=fa();for(let t=1;t<=dA;t+=2){const s=t-1;e.coeffs[s]=1/t,e.phases[s]=0}return e}function zQ(){const e=fa();for(let t=1;t<=dA;t+=2){const s=t-1;e.coeffs[s]=1/(t*t),e.phases[s]=Math.PI/2}return e}function $Q(){const e=fa();for(let t=1;t<=dA;t++){const s=t-1;e.coeffs[s]=1/t,e.phases[s]=t&1?0:Math.PI}return e}const XQ={strings:{amps:[.995,.94,.425,.48,0,.365,.04,.085,0,.09,0,0],phases:[0,Math.PI/2,0,Math.PI/2,0,Math.PI/2,0,Math.PI/2,0,Math.PI/2,0,0]},piano:{amps:[1,.7,.6,.5,.4,.32,.25,.2,.17,.14,.12,.1],phases:Array(12).fill(0)},marimba:{amps:[1,.2,.15,.7,.05,.18,.03,.05,.02,.01,0,0],phases:Array(12).fill(0)},woodwind:{amps:[1,.05,.5,.05,.3,.05,.2,.05,.12,.05,.08,.05],phases:Array(12).fill(0)}};function _l(e){const t=fa(),s=XQ[e],i=Math.min(dA,s.amps.length);for(let A=0;A<i;A++)t.coeffs[A]=s.amps[A]||0,t.phases[A]=s.phases[A]||0;return t}const wo={attack:.1,decay:.2,sustain:.8,release:.3},YQ={sine:{name:"sine",gain:1,adsr:wo,...KQ(),filter:{...Mn}},triangle:{name:"triangle",gain:.81,adsr:wo,...zQ(),filter:{...Mn}},square:{name:"square",gain:4/Math.PI,adsr:wo,...qQ(),filter:{...Mn}},sawtooth:{name:"sawtooth",gain:2/Math.PI,adsr:wo,...$Q(),filter:{...Mn}},trapezium:{name:"trapezium",gain:4/Math.PI,adsr:wo,coeffs:new Float32Array([.993,0,.314,0,.168,0,.101,0,.06,0,.033,0]),phases:new Float32Array(dA).fill(0),filter:{...Mn}},impulse:{name:"impulse",gain:.18,adsr:{attack:.01,decay:.3,sustain:0,release:.2},coeffs:new Float32Array([1,.9,.8,.7,.6,.5,.4,.3,.2,.1,0,0]),phases:new Float32Array([0,Math.PI*1.5,Math.PI,Math.PI/2,0,Math.PI*1.5,Math.PI,Math.PI/2,0,Math.PI*1.5,Math.PI,0]),filter:{...Mn}},strings:{name:"strings",gain:.49,adsr:{attack:.08,decay:.4,sustain:.7,release:.5},..._l("strings"),filter:{...Mn,cutoff:28}},piano:{name:"piano",gain:.8,adsr:{attack:.01,decay:1.5,sustain:0,release:.4},..._l("piano"),filter:{...Mn,cutoff:28}},marimba:{name:"marimba",gain:.9,adsr:{attack:.01,decay:.8,sustain:0,release:.4},..._l("marimba"),filter:{...Mn,cutoff:25}},woodwind:{name:"woodwind",gain:.6,adsr:{attack:.1,decay:.2,sustain:.8,release:.3},..._l("woodwind"),filter:{...Mn}}};class ju{constructor(t,s={}){if(this.parent=typeof t=="string"?document.querySelector(t):t,!this.parent)throw new Error("DraggableNumber: parent element not found");const i={size:[60,30],value:0,min:0,max:2e4,step:1,decimalPlaces:2,colors:{fill:"#e7e7e7",dark:"#333",light:"#fff",accent:"#b35"}};this.settings={...i,...s,colors:{...i.colors,...s.colors||{}}},this._em=new JQ,this._value=new jQ(this.settings.min,this.settings.max,this.settings.step,this.settings.value),this.decimalPlaces=this.settings.decimalPlaces,this.colors=this.settings.colors,this.element=document.createElement("input"),this.element.type="text",this.parent.appendChild(this.element);const[A,r]=this.settings.size;this._minDimension=Math.min(A,r),this.settings.useAppStyling?(this.element.className="draggable-number-input",this.element.style.cssText=[`width:${A}px`,`height:${r}px`,"background-color: var(--c-bg)","color: var(--c-text)","border: 1px solid var(--c-border)","border-radius: var(--border-radius-sm)","font-family: var(--main-font)","font-weight: 400","font-size: 14px","text-align: center","outline: none","padding: 0","box-sizing: border-box","user-select: text"].join(";")):this.element.style.cssText=[`width:${A}px`,`height:${r}px`,`background-color:${this.colors.fill}`,`color:${this.colors.dark}`,"font-family: system-ui, -apple-system, Segoe UI, Roboto, Arial, sans-serif","font-weight:500",`font-size:${this._minDimension/2}px`,"border: none","outline: none",`padding:${this._minDimension/4}px ${this._minDimension/4}px`,"box-sizing:border-box","user-select:text"].join(";"),tM(this.element,a=>/^-?\d*\.?\d*$/.test(a)),this.actual=0,this.hasMoved=!1,this.clicked=!1,this.element.value=Jg(this._value.value,this.decimalPlaces),this._bind()}on(t,s){return this._em.on(t,s),()=>this._em.off(t,s)}emit(t,s){this._em.emit(t,s)}get value(){return this._value.value}set value(t){this._value.update(t),this.emit("change",this._value.value),this._render()}get min(){return this._value.min}set min(t){this._value.min=t,this._render()}get max(){return this._value.max}set max(t){this._value.max=t,this._render()}get step(){return this._value.step}set step(t){this._value.step=t,this._render()}passiveUpdate(t){this._value.update(t),this._render()}link(t){this.min=t.min,this.max=t.max,this.step=t.step,typeof t.on=="function"&&t.on("change",s=>this.passiveUpdate(s)),this.on("change",s=>{"value"in t&&(t.value=s)}),this.value=t.value}_bind(){this.element.addEventListener("blur",()=>{this.settings.useAppStyling?(this.element.style.backgroundColor="var(--c-bg)",this.element.style.color="var(--c-text)"):(this.element.style.backgroundColor=this.colors.fill,this.element.style.color=this.colors.dark);const t=parseFloat(this.element.value);!Number.isNaN(t)&&t!==this.value?this.value=t:this._render()}),this.element.addEventListener("keydown",t=>{if(t.key==="Enter"){this.element.blur();const s=parseFloat(this.element.value);Number.isNaN(s)||(this.value=s)}},!0),this.element.addEventListener("mousedown",t=>this._onMouseDown(t)),this.element.addEventListener("dragstart",t=>t.preventDefault())}_onMouseDown(t){this.hasMoved=!1,this.clicked=!0,this.element.readOnly=!0,this.actual=this.value,this._start={y:t.clientY};const s=this.element.getBoundingClientRect(),i=(t.clientX-s.left)/s.width;this._changeFactor=ZQ(i);const A=a=>this._onMouseMove(a),r=()=>this._onMouseUp(A,r);window.addEventListener("mousemove",A),window.addEventListener("mouseup",r)}_onMouseMove(t){if(!this.clicked)return;this.hasMoved=!0;const s=t.clientY-this._start.y,A=Rf(this.max-this.min,0,1e3)/200*Math.pow(this._changeFactor,2),r=this.actual-s*A;this._value.update(r),this._render(),this._value.changed&&this.emit("change",this._value.value)}_onMouseUp(t,s){this.clicked=!1,window.removeEventListener("mousemove",t),window.removeEventListener("mouseup",s),this.hasMoved?document.body.focus():(this.element.readOnly=!1,this.element.focus(),this.element.setSelectionRange(0,this.element.value.length),this.settings.useAppStyling?(this.element.style.backgroundColor="var(--c-accent)",this.element.style.color="var(--c-surface)"):(this.element.style.backgroundColor=this.colors.accent,this.element.style.color=this.colors.light))}_render(){this.element.value=Jg(this._value.value,this.decimalPlaces)}}class jQ{constructor(t,s,i,A){this.min=Number(t),this.max=Number(s),this.step=Number(i)||1,this._value=0,this.changed=!1,this.update(A)}get value(){return this._value}update(t){const s=Rf(Number(t),this.min,this.max),i=this._stepTo(s),A=this._value;this._value=i,this.changed=i!==A}_stepTo(t){if(!isFinite(this.step)||this.step<=0)return t;const s=Math.round((t-this.min)/this.step);return this.min+s*this.step}}class JQ{constructor(){this._m=new Map}on(t,s){const i=this._m.get(t)||[];i.push(s),this._m.set(t,i)}off(t,s){const i=this._m.get(t);if(!i)return;const A=i.indexOf(s);A>=0&&i.splice(A,1)}emit(t,s){const i=this._m.get(t);if(i)for(const A of i.slice())A(s)}}function Rf(e,t,s){return Math.max(t,Math.min(s,e))}function ZQ(e){return 1-Rf(e,0,1)}function Jg(e,t=2){return isFinite(e)?Number(e).toFixed(Math.max(0,t)).replace(/\.0+$/,"").replace(/(\.\d*?)0+$/,"$1"):""}function tM(e,t){let s=e.value;e.addEventListener("input",()=>{t(e.value)?s=e.value:e.value=s})}class eM{constructor(){this.isActive=!1,this.pulseIntervals=new Map,this.tempoElements=new Map,this.popDuration={scaleUp:40,scaleDown:80},this.popScale=1.4,this.activeAnimations=new Map,this.initElements()}initElements(){[{type:"eighth",containerId:"eighth-note-tempo",bpmMultiplier:2},{type:"quarter",containerId:"quarter-note-tempo",bpmMultiplier:1},{type:"dottedQuarter",containerId:"dotted-quarter-tempo",bpmMultiplier:.666}].forEach(({type:s,containerId:i,bpmMultiplier:A})=>{const r=document.getElementById(i),a=r==null?void 0:r.parentElement,l=a==null?void 0:a.querySelector(".tempo-label-icon");r&&l?this.tempoElements.set(s,{container:r,icon:l,bpmMultiplier:A,originalTransform:r.style.transform||"",originalIconTransform:l.style.transform||""}):_.warn("TempoVisualizer",`Could not find elements for ${s} tempo`,{container:!!r,icon:!!l,tempoGroup:!!a},"toolbar")})}start(){this.isActive||(this.isActive=!0,this.tempoElements.size===0&&this.initElements(),this.tempoElements.forEach((t,s)=>{this.startPulseForType(s)}))}stop(){this.isActive&&(this.isActive=!1,this.pulseIntervals.forEach(t=>{clearInterval(t)}),this.pulseIntervals.clear(),this.activeAnimations.clear(),this.tempoElements.forEach(t=>{t.container.style.transform=t.originalTransform,t.icon.style.transform=t.originalIconTransform}))}startPulseForType(t){const s=this.tempoElements.get(t);if(!s)return;const r=60/(d.state.tempo*s.bpmMultiplier)*1e3;this.triggerPulse(t);const a=setInterval(()=>{this.isActive&&this.triggerPulse(t)},r);this.pulseIntervals.set(t,a)}triggerPulse(t){const i={startTime:performance.now(),phase:"scaleUp"};this.activeAnimations.set(t,i);const A=this.isActive;this.isActive=!0,this.activeAnimations.size===1&&this.animationLoop(),A||setTimeout(()=>{this.activeAnimations.size===0&&(this.isActive=!1)},this.popDuration.scaleUp+this.popDuration.scaleDown+50)}animationLoop(){if(this.activeAnimations.size===0||!this.isActive)return;const t=performance.now();this.activeAnimations.forEach((s,i)=>{const A=this.calculateScale(s,t);this.applyScale(i,A),A===1&&s.phase==="complete"&&this.activeAnimations.delete(i)}),this.activeAnimations.size>0&&requestAnimationFrame(()=>this.animationLoop())}calculateScale(t,s){const i=s-t.startTime;if(t.phase==="scaleUp"){if(i>=this.popDuration.scaleUp)return t.phase="scaleDown",t.startTime=s,this.popScale;{const A=Math.min(i/this.popDuration.scaleUp,1);return 1+(this.popScale-1)*A}}else if(t.phase==="scaleDown"){if(i>=this.popDuration.scaleDown)return t.phase="complete",1;{const A=Math.min(i/this.popDuration.scaleDown,1);return this.popScale-(this.popScale-1)*A}}return 1}applyScale(t,s){const i=this.tempoElements.get(t);if(!i)return;const A=`scale(${s})`;i.container.style.transform=i.originalTransform+" "+A,i.icon.style.transform=i.originalIconTransform+" "+A;const r=s<this.popScale?"transform 0.08s ease-out":"none";i.container.style.transition=r,i.icon.style.transition=r}updateTempo(){this.isActive&&(this.stop(),this.start())}}const tr=new eM;function sM(){var v;const e=document.getElementById("tempo-slider");e||_.warn("AudioControlsInitializer","Tempo slider not found during initial load - will retry when rhythm tab is accessed",null,"toolbar");const t={size:[45,24],step:1,decimalPlaces:0,useAppStyling:!0},s=new ju("#eighth-note-tempo",{...t,value:180,min:60,max:480}),i=new ju("#quarter-note-tempo",{...t,value:90,min:30,max:240}),A=new ju("#dotted-quarter-tempo",{...t,value:60,min:20,max:160});function r(y){const C=Math.round(y),x=e||document.getElementById("tempo-slider");x&&parseInt(x.value,10)!==C&&(x.value=C);const F=C*2,I=Math.round(C/1.5);s.value!==F&&s.passiveUpdate(F),i.value!==C&&i.passiveUpdate(C),A.value!==I&&A.passiveUpdate(I),d.state.tempo!==C&&(d.setTempo(C),tr.updateTempo())}let a=!1;if(e){const y=()=>{const C=document.querySelector(".tempo-content-box"),x=document.querySelector(".tempo-container"),F=document.querySelector(".tempo-column-2");_.debug("AudioControlsInitializer","[Tempo Slider Heights]",{slider:{offsetHeight:e.offsetHeight,clientHeight:e.clientHeight,scrollHeight:e.scrollHeight,computedHeight:getComputedStyle(e).height,computedMaxHeight:getComputedStyle(e).maxHeight},tempoColumn2:F?{offsetHeight:F.offsetHeight,clientHeight:F.clientHeight,computedHeight:getComputedStyle(F).height}:"not found",tempoContainer:x?{offsetHeight:x.offsetHeight,clientHeight:x.clientHeight,computedHeight:getComputedStyle(x).height,computedFlex:getComputedStyle(x).flex}:"not found",tempoContentBox:C?{offsetHeight:C.offsetHeight,clientHeight:C.clientHeight,computedHeight:getComputedStyle(C).height}:"not found"})};setTimeout(y,100),setTimeout(y,500),e.addEventListener("mousedown",()=>{a=!0,tr.start()}),e.addEventListener("touchstart",()=>{a=!0,tr.start()}),e.addEventListener("input",C=>{const x=parseInt(C.target.value,10);r(x)}),e.addEventListener("mouseup",function(){this.blur()}),r(d.state.tempo)}else _.warn("AudioControlsInitializer","Tempo slider not found - will initialize when rhythm tab is opened",null,"toolbar");s.on("change",y=>{!isNaN(y)&&y>0&&r(y/2)}),i.on("change",y=>{!isNaN(y)&&y>0&&r(y)}),A.on("change",y=>{!isNaN(y)&&y>0&&r(y*1.5)}),r(d.state.tempo),document.addEventListener("mouseup",()=>{a&&(a=!1,tr.stop())}),document.addEventListener("touchend",()=>{a&&(a=!1,tr.stop())}),document.addEventListener("touchcancel",()=>{a&&(a=!1,tr.stop())});const l=document.querySelector(".preset-effects-container");document.querySelectorAll(".preset-button").forEach(y=>{const C=y.id.replace("preset-",""),x=YQ[C];x&&y.addEventListener("click",()=>{var I;const F=(I=d.state.selectedNote)==null?void 0:I.color;F&&(d.applyPreset(F,x),setTimeout(()=>{try{m(F)}catch{}},10)),y.blur()})});const h=(y,C=20)=>{const x=parseInt(y.slice(1,3),16),F=parseInt(y.slice(3,5),16),I=parseInt(y.slice(5,7),16),T=Math.max(0,Math.floor(x*(1-C/100))),U=Math.max(0,Math.floor(F*(1-C/100))),D=Math.max(0,Math.floor(I*(1-C/100)));return`#${T.toString(16).padStart(2,"0")}${U.toString(16).padStart(2,"0")}${D.toString(16).padStart(2,"0")}`},u=(y,C=50)=>{const x=parseInt(y.slice(1,3),16),F=parseInt(y.slice(3,5),16),I=parseInt(y.slice(5,7),16),T=Math.min(255,Math.floor(x+(255-x)*(C/100))),U=Math.min(255,Math.floor(F+(255-F)*(C/100))),D=Math.min(255,Math.floor(I+(255-I)*(C/100)));return`#${T.toString(16).padStart(2,"0")}${U.toString(16).padStart(2,"0")}${D.toString(16).padStart(2,"0")}`},m=y=>{if(!y||!l)return;const C=d.state.timbres[y],x=d.state.colorPalette[y]||{primary:y,light:y},F=x.light,I=x.primary;document.querySelectorAll(".preset-button").forEach(U=>{const D=U.id.replace("preset-",""),O=C&&C.activePresetName===D;U.classList.toggle("selected",O)});const T=u(F,60);l.style.setProperty("--c-accent",I),l.style.setProperty("--c-accent-light",T),l.style.setProperty("--c-accent-hover",h(I,20))};d.on("noteChanged",({newNote:y})=>{y.color?m(y.color):(document.querySelectorAll(".preset-button").forEach(C=>C.classList.remove("selected")),l&&(l.style.setProperty("--c-accent","#4A90E2"),l.style.setProperty("--c-accent-hover","#357ABD")))}),d.on("timbreChanged",y=>{var C;y===((C=d.state.selectedNote)==null?void 0:C.color)&&m(y)}),d.on("tempoChanged",y=>{r(y)});const g=(v=d.state.selectedNote)==null?void 0:v.color;g&&m(g)}function nM(){const e=document.getElementById("grid-zoom-in"),t=document.getElementById("grid-zoom-out"),s=document.getElementById("macrobeat-increase"),i=document.getElementById("macrobeat-decrease");e&&e.addEventListener("click",()=>{d.emit("zoomIn"),e.blur()}),t&&t.addEventListener("click",()=>{d.emit("zoomOut"),t.blur()}),s&&s.addEventListener("click",()=>d.increaseMacrobeatCount()),i&&i.addEventListener("click",()=>d.decreaseMacrobeatCount())}function iM(){const e=document.getElementById("modulation-2-3-btn"),t=document.getElementById("modulation-3-2-btn"),s=document.getElementById("modulation-clear-btn");if(!e||!t||!s){_.warn("ModulationInitializer","Modulation control buttons not found in DOM",null,"ui");return}let i=null;e.addEventListener("click",()=>{i===en.COMPRESSION_2_3?(i=null,e.classList.remove("active"),d.setSelectedTool("note"),_.info("ModulationInitializer","2:3 modulation tool deactivated",null,"ui")):(i=en.COMPRESSION_2_3,e.classList.add("active"),t.classList.remove("active"),d.setSelectedTool("modulation"),d.state.selectedModulationRatio=i,_.info("ModulationInitializer","2:3 modulation tool activated",null,"ui"))}),t.addEventListener("click",()=>{i===en.EXPANSION_3_2?(i=null,t.classList.remove("active"),d.setSelectedTool("note"),_.info("ModulationInitializer","3:2 modulation tool deactivated",null,"ui")):(i=en.EXPANSION_3_2,t.classList.add("active"),e.classList.remove("active"),d.setSelectedTool("modulation"),d.state.selectedModulationRatio=i,_.info("ModulationInitializer","3:2 modulation tool activated",null,"ui"))}),s.addEventListener("click",()=>{const r=(d.state.modulationMarkers||[]).length;if(r===0){_.info("ModulationInitializer","No modulation markers to clear",null,"ui");return}d.clearModulationMarkers(),_.info("ModulationInitializer",`Cleared ${r} modulation markers`,null,"ui")}),d.on("toolChanged",r=>{(r.newTool||r)!=="modulation"&&(i=null,e.classList.remove("active"),t.classList.remove("active"))}),d.on("modulationMarkersChanged",()=>{const r=(d.state.modulationMarkers||[]).length;r===0?(s.disabled=!0,s.style.opacity="0.5"):(s.disabled=!1,s.style.opacity="1"),s.textContent=r>0?`Clear (${r})`:"Clear"});const A=(d.state.modulationMarkers||[]).length;A===0&&(s.disabled=!0,s.style.opacity="0.5"),s.textContent=A>0?`Clear (${A})`:"Clear",_.info("ModulationInitializer","Modulation controls initialized",null,"ui")}_.moduleLoaded("ToolbarComponent","toolbar");const AM={init(){MQ(),DQ(),WQ(),GQ(),sM(),nM(),iM(),_.info("ToolbarComponent","All controls initialized",null,"toolbar")}};let xl=null;const rM=()=>(xl||(xl=new Image,xl.src=Ii("volume.svg")),xl);function _i(e,t){return t.modulationMarkers&&t.modulationMarkers.length>0?Bt(e,t):yt.getColumnX(e)}function U0(e,t,s,i,A,r,a=1){const l=s+A/2,h=i+r/2,u=Math.min(A,r)*.4*a;if(e.beginPath(),t===0)e.moveTo(l,h-u),e.lineTo(l-u,h+u),e.lineTo(l+u,h+u),e.closePath();else if(t===1)e.moveTo(l,h-u),e.lineTo(l+u,h),e.lineTo(l,h+u),e.lineTo(l-u,h),e.closePath();else{for(let g=0;g<5;g++){const v=2*Math.PI/5*g-Math.PI/2,y=l+u*Math.cos(v),C=h+u*Math.sin(v);g===0?e.moveTo(y,C):e.lineTo(y,C)}e.closePath()}e.fill()}function oM(e,t,s,i,A="normal"){const r=rM();if(A!=="normal"){const a=i*1.3;e.beginPath(),e.arc(t,s,a/2,0,Math.PI*2),A==="hover"?e.fillStyle="rgba(74, 144, 226, 0.2)":A==="active"&&(e.fillStyle="rgba(74, 144, 226, 0.4)"),e.fill()}if(r.complete&&r.naturalWidth>0)A==="hover"?e.filter="brightness(1.2)":A==="active"&&(e.filter="brightness(0.8)"),e.drawImage(r,t-i/2,s-i/2,i,i),e.filter="none";else{let a="#6c757d",l="#6c757d";A==="hover"?(a="#4a90e2",l="#4a90e2"):A==="active"&&(a="#357abd",l="#357abd"),e.fillStyle=a,e.strokeStyle=l,e.lineWidth=1;const h=i*.4,u=i*.6,m=i*.3;e.fillRect(t-h/2,s-u/2,h,u),e.beginPath(),e.moveTo(t+h/2,s-u/3),e.lineTo(t+h/2+m,s-u/2),e.lineTo(t+h/2+m,s+u/2),e.lineTo(t+h/2,s+u/3),e.closePath(),e.fill();for(let g=1;g<=2;g++)e.beginPath(),e.arc(t+h/2+m+i*.1,s,i*.2*g,-Math.PI/4,Math.PI/4,!1),e.stroke()}}function aM(e,t){const{columnWidths:s,macrobeatGroupings:i,macrobeatBoundaryStyles:A,placedTonicSigns:r}=t,a=s.length-2,l=[];let h=2;for(let u=0;u<i.length;u++){for(;r.some(m=>m.columnIndex===h);)h+=2;h+=i[u],l.push(h)}for(let u=0;u<=a;u++){const m=_i(u,t),g=ke(e.canvas);if(m<0||m>g)continue;let v;const y=u===2||u===a,C=$w(u,r),x=r.some(T=>u===T.columnIndex+2),F=l.includes(u);if(Xw(u,r)){if(y||C||x)v={lineWidth:2,strokeStyle:"#adb5bd",dash:[]};else if(F){const T=l.indexOf(u);if(T!==-1){const U=A[T];if(U==="anacrusis")continue;v={lineWidth:1,strokeStyle:"#adb5bd",dash:U==="solid"?[]:[5,5]}}else continue}else continue;e.beginPath(),e.moveTo(m,0),e.lineTo(m,le(e.canvas)),e.lineWidth=v.lineWidth,e.strokeStyle=v.strokeStyle,e.setLineDash(v.dash),e.stroke()}}e.setLineDash([])}function lM(e,t){const{placedNotes:s,columnWidths:i,cellWidth:A,cellHeight:r,placedTonicSigns:a}=t;e.clearRect(0,0,ke(e.canvas),le(e.canvas));const l=e.canvas;l.getBoundingClientRect(),window.getComputedStyle(l);const h=Math.max(br,_r*r),u=i.length,m=["H","M","L"];e.font=`${Math.floor(h*.7)}px 'Atkinson Hyperlegible', sans-serif`,e.textAlign="center",e.textBaseline="middle",e.fillStyle="#6c757d";const g=_i(1,t)+_i(1,t)*.3;m.forEach((F,I)=>{e.fillText(F,g,I*h+h/2)});const v=_i(1,t)-_i(1,t)*.3,y=3*h/2,C=t.volumeIconState||"normal";oM(e,v,y,h*.6,C);const x=_i(2,t);for(let F=0;F<4;F++){const I=F*h;e.beginPath(),e.moveTo(x,I),e.lineTo(ke(e.canvas),I),e.strokeStyle="#ced4da",e.lineWidth=1,e.stroke()}aM(e,t);for(let F=2;F<u-2;F++){if(a.some(U=>U.columnIndex===F))continue;const I=_i(F,t);let T;t.modulationMarkers&&t.modulationMarkers.length>0?T=_i(F+1,t)-I:T=i[F]*A;for(let U=0;U<3;U++){const D=U*h,O=m[U],R=s.find(st=>st.isDrum&&st.drumTrack===O&&st.startColumnIndex===F);if(R){e.fillStyle=R.color;const st=Ri.getAnimationScale(F,O);U0(e,U,I,D,T,h,st)}else e.fillStyle="#ced4da",e.beginPath(),e.arc(I+T/2,D+h/2,2,0,Math.PI*2),e.fill()}}nv(e,t)}const Gs={getColumnIndex(e){const{columnWidths:t,cellWidth:s,modulationMarkers:i}=d.state;if(s===0)return 0;if(i&&i.length>0){const r={...d.state,modulationMarkers:i,cellWidth:s,columnWidths:t,baseMicrobeatPx:s};for(let a=0;a<t.length;a++){const l=Bt(a+1,r);if(e<l)return a}}else{let r=0;for(let a=0;a<t.length;a++)if(r+=t[a]*s,e<r)return a}return t.length-1},getPitchRowIndex(e){const t=yt.getViewportInfo();if(!t||!t.halfUnit||t.halfUnit===0)return-1;const s=Math.floor((e+t.halfUnit*.5)/t.halfUnit);return t.startRank+s},getDrumRowIndex(e){const t=Math.max(br,_r*d.state.cellHeight);return t===0?-1:Math.floor(e/t)}};let Fe,hc=!1,na=!1,Gl=1,Yn=null,si="normal",Zg=0;const cM=500;function Sr(e){if(d.state.modulationMarkers&&d.state.modulationMarkers.length>0){const s={modulationMarkers:d.state.modulationMarkers,columnWidths:d.state.columnWidths,cellWidth:d.state.cellWidth,baseMicrobeatPx:d.state.baseMicrobeatPx||d.state.cellWidth||40};return Bt(e,s)}else return yt.getColumnX(e)}function P0(e){if(d.state.modulationMarkers&&d.state.modulationMarkers.length>0){const s=Sr(e);return Sr(e+1)-s}else return d.state.columnWidths[e]*d.state.cellWidth}function Jd(e,t,s){if(!Fe)return;const i=Sr(e),A=Math.max(br,_r*d.state.cellHeight),r=t*A,a=P0(e);Fe.fillStyle=s,Fe.fillRect(i,r,a,A)}function hM(e,t){if(!Fe)return;const s=Sr(e),i=Math.max(br,_r*d.state.cellHeight),A=t*i,r=P0(e),a=["H","M","L"][t],l=Ri.getAnimationScale(e,a);Fe.globalAlpha=.4,Fe.fillStyle=d.state.selectedTool.color||"#212529",U0(Fe,t,s,A,r,i,l),Fe.globalAlpha=1}function uM(e){const t=e.target.getBoundingClientRect(),s=e.clientX-t.left,i=e.clientY-t.top,A=Sr(2),r=s<A,a=si;if(si=r?"hover":"normal",a!==si&&window.drumGridRenderer&&window.drumGridRenderer.render(),r){Fe&&Fe.clearRect(0,0,ke(Fe.canvas),le(Fe.canvas));return}const l=document.getElementById("canvas-container").scrollLeft,h=Gs.getColumnIndex(s+l),u=Gs.getDrumRowIndex(i);if(!Fe||h<2||h>=d.state.columnWidths.length-2||u<0||u>2){Of();return}Fe.clearRect(0,0,ke(Fe.canvas),le(Fe.canvas));const m=["H","M","L"][u];hc?(d.eraseDrumNoteAt(h,m,!1)&&(na=!0),Jd(h,u,"rgba(220, 53, 69, 0.3)")):(Jd(h,u,"rgba(74, 144, 226, 0.2)"),hM(h,u))}function Of(){Fe&&Fe.clearRect(0,0,ke(Fe.canvas),le(Fe.canvas)),si!=="normal"&&(si="normal",window.drumGridRenderer&&window.drumGridRenderer.render())}function dM(e){var u;e.preventDefault();const t=e.target.getBoundingClientRect(),s=e.clientX-t.left,i=e.clientY-t.top,A=Sr(2);if(s<A){si="active",window.drumGridRenderer&&window.drumGridRenderer.render();const m=document.querySelector(".drum-volume-control");if(m){const g=m.style.display==="flex";m.style.display=g?"none":"flex"}return}const r=document.getElementById("canvas-container").scrollLeft,a=Gs.getColumnIndex(s+r);if(a<2||a>=d.state.columnWidths.length-2)return;const l=Gs.getDrumRowIndex(i);if(l<0||l>2)return;const h=["H","M","L"][l];if(e.button===2){hc=!0,na=!1,(u=document.getElementById("eraser-tool-button"))==null||u.classList.add("erasing-active"),d.eraseDrumNoteAt(a,h,!1)&&(na=!0),Fe.clearRect(0,0,ke(Fe.canvas),le(Fe.canvas)),Jd(a,l,"rgba(220, 53, 69, 0.3)");return}if(e.button===0){const{color:m}=d.state.selectedTool,g={isDrum:!0,drumTrack:h,startColumnIndex:a,endColumnIndex:a,color:m||"#000000",shape:h==="H"?"triangle":h==="M"?"square":"pentagon"};d.toggleDrumNote(g),window.transportService&&window.transportService.drumPlayers&&(window.transportService.drumPlayers.player(h).start(),Ri.triggerNotePop(a,h))}}function fM(){var e;hc&&(na&&d.recordState(),hc=!1,na=!1,(e=document.getElementById("eraser-tool-button"))==null||e.classList.remove("erasing-active")),si==="active"&&(si="normal",window.drumGridRenderer&&window.drumGridRenderer.render()),Of()}function pM(){const e=document.getElementById("drum-grid-wrapper");if(!e)return;const t=document.createElement("div");t.className="drum-volume-control",t.style.cssText=`
        position: absolute;
        top: 10px;
        left: 10px;
        background: rgba(255, 255, 255, 0.9);
        border: 1px solid #ccc;
        border-radius: 4px;
        padding: 8px;
        display: none;
        align-items: center;
        gap: 8px;
        font-size: 12px;
        box-shadow: 0 2px 4px rgba(0,0,0,0.1);
        z-index: 10;
    `,Yn=document.createElement("input"),Yn.type="range",Yn.min="0",Yn.max="100",Yn.value="100",Yn.className="drum-volume-slider",Yn.style.cssText="width: 80px; margin: 0;",Yn.addEventListener("input",A=>{if(Gl=A.target.value/100,window.drumVolumeNode){const r=Gl===0?-60:20*Math.log10(Gl);window.drumVolumeNode.volume.value=r;const a=Date.now();window.transportService&&window.transportService.drumPlayers&&a-Zg>=cM&&(window.transportService.drumPlayers.player("M").start("+0.1"),Zg=a)}}),t.appendChild(Yn),e.appendChild(t);const s=()=>{t.style.display="flex"},i=()=>{t.style.display="none"};e.addEventListener("mouseenter",A=>{const r=e.getBoundingClientRect();A.clientX-r.left<60&&s()}),t.addEventListener("mouseenter",s),t.addEventListener("mouseleave",i),e.addEventListener("mouseleave",i)}function mM(){return Gl}function gM(){return si}window.getDrumVolume=mM;function wM(){const e=document.getElementById("drum-grid"),t=document.getElementById("drum-hover-canvas");!e||!t||(Fe=t.getContext("2d"),e.addEventListener("mousedown",dM),e.addEventListener("mousemove",uM),e.addEventListener("mouseleave",Of),e.addEventListener("contextmenu",s=>s.preventDefault()),window.addEventListener("mouseup",fM),pM())}function tw(){const e=Cf.getDrumContext();if(!e||!e.canvas)return;const t={placedNotes:y_(d.state),placedTonicSigns:Ai(d.state),columnWidths:d.state.columnWidths,cellWidth:d.state.cellWidth,cellHeight:d.state.cellHeight,macrobeatGroupings:d.state.macrobeatGroupings,macrobeatBoundaryStyles:d.state.macrobeatBoundaryStyles,modulationMarkers:d.state.modulationMarkers,baseMicrobeatPx:d.state.cellWidth,volumeIconState:gM()};lM(e,t)}const js={animationFrameId:null,render(){tw(),Ri.hasActiveAnimations()?js.animationFrameId||js.startAnimationLoop():js.stopAnimationLoop()},startAnimationLoop(){if(js.animationFrameId)return;const e=()=>{Ri.cleanupAnimations(),tw(),Ri.hasActiveAnimations()?js.animationFrameId=requestAnimationFrame(e):js.animationFrameId=null};js.animationFrameId=requestAnimationFrame(e)},stopAnimationLoop(){js.animationFrameId&&(cancelAnimationFrame(js.animationFrameId),js.animationFrameId=null)}};window.drumGridRenderer=js;let El=!1,ir="C4",uc=null,Is=[];function vM(e){const t=d.state.fullRowData[e.row];return t?t.toneNote:"C4"}function ew(){const e=d.state.placedNotes.slice().reverse().find(t=>!t.isDrum);ir=e?vM(e):"C4"}function sw(e){const{activeChordIntervals:t}=d.state;return!e||!t||!t.length?[]:t.map(s=>{const i=Mo(e,s);return Ql(i)})}function BM(){ew(),d.on("notesChanged",ew),document.addEventListener("keydown",e=>{var l,h;if(e.code!=="Space"||El)return;const t=document.activeElement,s=t.tagName.toLowerCase(),i=t.contentEditable==="true";if(["input","textarea"].includes(s)||i)return;e.preventDefault(),El=!0;const A=(l=d.state.selectedNote)==null?void 0:l.color;let r,a=[];if(uc&&A){const u=d.state.fullRowData[uc.row];r=u?u.toneNote:ir,d.state.selectedTool==="chord"?a=sw(r):a=[r]}else A&&ir&&(r=ir,d.state.selectedTool==="chord"?a=sw(ir):a=[ir]);if(a.length>0){Is={pitches:[...a],rootNote:r,color:A},a.forEach(y=>{Kt.triggerAttack(y,A)});const u=d.state.fullRowData.find(y=>y.toneNote===r),m=u?u.hex:"#888888",g=d.state.timbres[A].adsr;(h=Ms.adsrComponent)==null||h.playheadManager.trigger("spacebar","attack",m,g),d.emit("spacebarPlayback",{note:r,color:A,isPlaying:!0});const v=`spacebar-${Date.now()}`;d.emit("noteAttack",{noteId:v,color:A}),Is.noteId=v}}),document.addEventListener("keyup",e=>{var t;if(!(e.code!=="Space"||!El)&&(e.preventDefault(),El=!1,Is.pitches&&Is.pitches.length>0)){Is.pitches.forEach(r=>{Kt.triggerRelease(r,Is.color)});const s=d.state.fullRowData.find(r=>r.toneNote===Is.rootNote),i=s?s.hex:"#888888",A=d.state.timbres[Is.color].adsr;(t=Ms.adsrComponent)==null||t.playheadManager.trigger("spacebar","release",i,A),d.emit("spacebarPlayback",{note:Is.rootNote,color:Is.color,isPlaying:!1}),Is.noteId&&d.emit("noteRelease",{noteId:Is.noteId,color:Is.color}),Is=[]}})}function k0(e,t){var i;uc={col:e,row:t};const s=(i=d.state.selectedNote)==null?void 0:i.color;s&&d.emit("ghostNoteUpdated",{color:s})}function D0(){uc=null,d.emit("ghostNoteCleared")}_.moduleLoaded("StampsToolbar","stamps");const Nf={selectedStampId:1,init(){this.render(),this.bindEvents(),_.info("StampsToolbar","Stamps toolbar initialized",null,"stamps")},render(){const e=document.getElementById("stamps-toolbar-container");if(!e){_.warn("StampsToolbar","Container not found",null,"stamps");return}e.innerHTML="";const t=document.createElement("div");t.className="stamps-grid",[[1,2,3,4],[5,8,14,6,9,7],[10,13,12,11,15]].forEach((i,A)=>{const r=document.createElement("div");r.className=`stamps-row stamps-row-${A+1}`,i.forEach(a=>{const l=fd.find(h=>h.id===a);if(l){const h=this.createStampButton(l,a-1);r.appendChild(h)}}),t.appendChild(r)}),e.appendChild(t),this.setInitialSelection(this.selectedStampId)},createStampButton(e){const t=document.createElement("button");t.className="stamp-button",t.setAttribute("data-stamp-id",e.id),t.setAttribute("title",`${e.id}: ${e.label}`);const s=this.createStampPreview(e);return t.appendChild(s),t},createStampPreview(e){const t=Sf.renderToSVG(e,100,100);return t.setAttribute("width","40"),t.setAttribute("height","40"),t},bindEvents(){const e=document.getElementById("stamps-toolbar-container");if(!e)return;e.addEventListener("click",s=>{const i=s.target.closest(".stamp-button");if(i){const A=parseInt(i.getAttribute("data-stamp-id"));this.selectStamp(A)}}),this.updateStampColors=s=>{if(!s||!e)return;const i=(u,m=50)=>{const g=parseInt(u.slice(1,3),16),v=parseInt(u.slice(3,5),16),y=parseInt(u.slice(5,7),16),C=Math.min(255,Math.floor(g+(255-g)*(m/100))),x=Math.min(255,Math.floor(v+(255-v)*(m/100))),F=Math.min(255,Math.floor(y+(255-y)*(m/100)));return`#${C.toString(16).padStart(2,"0")}${x.toString(16).padStart(2,"0")}${F.toString(16).padStart(2,"0")}`},A=(u,m=20)=>{const g=parseInt(u.slice(1,3),16),v=parseInt(u.slice(3,5),16),y=parseInt(u.slice(5,7),16),C=Math.max(0,Math.floor(g*(1-m/100))),x=Math.max(0,Math.floor(v*(1-m/100))),F=Math.max(0,Math.floor(y*(1-m/100)));return`#${C.toString(16).padStart(2,"0")}${x.toString(16).padStart(2,"0")}${F.toString(16).padStart(2,"0")}`},r=d.state.colorPalette[s]||{primary:s,light:s},a=i(r.light,60),l=r.primary,h=A(l,20);e.style.setProperty("--c-accent",l),e.style.setProperty("--c-accent-light",a),e.style.setProperty("--c-accent-hover",h),_.info("StampsToolbar",`Updated colors for ${s}`,{primary:l,light:a,hover:h},"stamps")},d.on("noteChanged",({newNote:s})=>{s.color&&this.updateStampColors(s.color)});const t=d.state.selectedNote;t&&t.color&&this.updateStampColors(t.color),d.on("toolChanged",({newTool:s})=>{s!=="stamp"&&this.clearSelection()}),d.on("tripletToolSelected",()=>{this.clearSelection()})},setInitialSelection(e){this.selectedStampId=e;const t=document.getElementById("stamps-toolbar-container");t&&t.querySelectorAll(".stamp-button").forEach(s=>{s.classList.toggle("active",parseInt(s.getAttribute("data-stamp-id"))===e)}),_.info("StampsToolbar",`Initial stamp selection set to ${e} (no tool change during init)`,{stampId:e},"stamps")},selectStamp(e){this.selectedStampId=e;const t=document.getElementById("stamps-toolbar-container");t&&t.querySelectorAll(".stamp-button").forEach(s=>{s.classList.toggle("active",parseInt(s.getAttribute("data-stamp-id"))===e)}),_.debug("StampsToolbar","Selecting stamp tool via proper action",null,"stamps"),d.setSelectedTool("stamp"),d.emit("stampSelected",e),d.emit("stampToolSelected"),_.info("StampsToolbar",`Selected stamp ${e} and switched to stamp tool`,{stampId:e},"stamps")},clearSelection(){this.selectedStampId=null;const e=document.getElementById("stamps-toolbar-container");e&&e.querySelectorAll(".stamp-button").forEach(t=>{t.classList.remove("active")})},getSelectedStamp(){return fd.find(e=>e.id===this.selectedStampId)}};function yM({kind:e,cx:t,cy:s,stroke:i="currentColor",strokeWidth:A=4,scale:r=1}){const a=20*r,l=60*r,h=document.createElementNS("http://www.w3.org/2000/svg","ellipse");return h.setAttribute("cx",t),h.setAttribute("cy",s),h.setAttribute("fill","none"),h.setAttribute("stroke",i),h.setAttribute("stroke-width",A),h.setAttribute("stroke-linecap","round"),e==="circleWide"?(h.setAttribute("rx",a*2),h.setAttribute("ry",l)):(h.setAttribute("rx",a),h.setAttribute("ry",l)),h}function CM(e,t=48,s=48){const i=document.createElementNS("http://www.w3.org/2000/svg","svg"),A=e.span==="quarter",r=A?200:100;i.setAttribute("viewBox",`0 0 ${r} 100`),i.setAttribute("width",t),i.setAttribute("height",s),i.setAttribute("aria-label",e.label),i.style.color="#000000";const a=50,l=e.span==="eighth"?"ovalWide":"circleWide";let h;return A?h=[33.33,100,166.67]:h=[16.67,50,83.33],e.hits.forEach(u=>{const m=yM({kind:l,cx:h[u],cy:a,stroke:"currentColor",strokeWidth:3,scale:.8});i.appendChild(m)}),i}_.moduleLoaded("TripletsToolbar","triplets");const Pc={selectedTripletStampId:null,init(){this.render(),this.bindEvents(),_.info("TripletsToolbar","Triplets toolbar initialized",null,"triplets")},render(){const e=document.getElementById("triplets-toolbar-container");if(!e){_.warn("TripletsToolbar","Container not found",null,"triplets");return}e.innerHTML="";const t=document.createElement("div");t.className="triplets-main-container";const s=document.createElement("div");s.className="triplets-sections";const i=this.createSection("Eighth Triplets",pd.slice(0,7));s.appendChild(i);const A=this.createQuarterTripletsSection(pd.slice(7,14));s.appendChild(A),t.appendChild(s),e.appendChild(t)},createSection(e,t){const s=document.createElement("div");s.className="triplets-section";const i=document.createElement("div");return i.className="triplets-grid",t.forEach(A=>{const r=this.createTripletButton(A);i.appendChild(r)}),s.appendChild(i),s},createQuarterTripletsSection(e){const t=document.createElement("div");t.className="triplets-section";const s=document.createElement("div");s.className="triplets-grid triplets-quarter-row",[e[0],e[1],e[2]].forEach(A=>{const r=this.createTripletButton(A);s.appendChild(r)});const i=document.createElement("div");return i.className="triplets-grid triplets-quarter-row",[e[3],e[4],e[5],e[6]].forEach(A=>{const r=this.createTripletButton(A);i.appendChild(r)}),t.appendChild(s),t.appendChild(i),t},createTripletButton(e){const t=document.createElement("button");t.className="triplet-button",t.setAttribute("data-triplet-stamp-id",e.id),t.setAttribute("title",e.label),e.span==="quarter"&&t.classList.add("triplet-button-wide");const i=e.span==="quarter"?80:40,A=CM(e,i,40);return t.appendChild(A),t},bindEvents(){const e=document.getElementById("triplets-toolbar-container");if(!e)return;e.addEventListener("click",s=>{const i=s.target.closest(".triplet-button");if(i){const A=parseInt(i.getAttribute("data-triplet-stamp-id"));this.selectTripletStamp(A)}}),this.updateTripletColors=s=>{if(!s||!e)return;const i=(u,m=50)=>{const g=parseInt(u.slice(1,3),16),v=parseInt(u.slice(3,5),16),y=parseInt(u.slice(5,7),16),C=Math.min(255,Math.floor(g+(255-g)*(m/100))),x=Math.min(255,Math.floor(v+(255-v)*(m/100))),F=Math.min(255,Math.floor(y+(255-y)*(m/100)));return`#${C.toString(16).padStart(2,"0")}${x.toString(16).padStart(2,"0")}${F.toString(16).padStart(2,"0")}`},A=(u,m=20)=>{const g=parseInt(u.slice(1,3),16),v=parseInt(u.slice(3,5),16),y=parseInt(u.slice(5,7),16),C=Math.max(0,Math.floor(g*(1-m/100))),x=Math.max(0,Math.floor(v*(1-m/100))),F=Math.max(0,Math.floor(y*(1-m/100)));return`#${C.toString(16).padStart(2,"0")}${x.toString(16).padStart(2,"0")}${F.toString(16).padStart(2,"0")}`},r=d.state.colorPalette[s]||{primary:s,light:s},a=i(r.light,60),l=r.primary,h=A(l,20);e.style.setProperty("--c-accent",l),e.style.setProperty("--c-accent-light",a),e.style.setProperty("--c-accent-hover",h),_.info("TripletsToolbar",`Updated colors for ${s}`,{primary:l,light:a,hover:h},"triplets")},d.on("noteChanged",({newNote:s})=>{s.color&&this.updateTripletColors(s.color)});const t=d.state.selectedNote;t&&t.color&&this.updateTripletColors(t.color),d.on("toolChanged",({newTool:s})=>{s!=="triplet"&&this.clearSelection()}),d.on("stampToolSelected",()=>{this.clearSelection()})},selectTripletStamp(e){this.selectedTripletStampId=e;const t=document.getElementById("triplets-toolbar-container");t&&t.querySelectorAll(".triplet-button").forEach(s=>{s.classList.toggle("active",parseInt(s.getAttribute("data-triplet-stamp-id"))===e)}),d.setSelectedTool("triplet"),d.emit("tripletStampSelected",e),d.emit("tripletToolSelected"),_.info("TripletsToolbar",`Selected triplet stamp ${e} and switched to triplet tool`,{stampId:e},"triplets")},clearSelection(){this.selectedTripletStampId=null;const e=document.getElementById("triplets-toolbar-container");e&&e.querySelectorAll(".triplet-button").forEach(t=>{t.classList.remove("active")})},getSelectedTripletStamp(){return this.selectedTripletStampId?ca(this.selectedTripletStampId):null}};function bM(e,t,s,i){var u,m;const A=Bc(s.stampId);if(!A)return null;const r=Bt(s.startColumn,i);Nt(s.row,i)-i.cellHeight/2;const a=i.cellWidth*2,l=i.cellHeight,h=[.125,.375,.625,.875].map(g=>r+g*a);for(const g of A.diamonds){const v=`diamond_${g}`,y=((u=s.shapeOffsets)==null?void 0:u[v])||0,C=s.row+y,x=Nt(C,i),F=h[g],I=Math.sqrt(Math.pow(e-F,2)+Math.pow(t-x,2)),T=Math.min(a*.2,l*1);if(I<T)return{type:"diamond",slot:g,shapeKey:v,cx:F,cy:x,placement:s}}for(const g of A.ovals){const v=`oval_${g}`,y=((m=s.shapeOffsets)==null?void 0:m[v])||0,C=s.row+y,x=Nt(C,i),F=g===0?r+.25*a:r+.75*a,I=Math.sqrt(Math.pow(e-F,2)+Math.pow(t-x,2)),T=Math.min(a*.25,l*1);if(I<T)return{type:"oval",slot:g,shapeKey:v,cx:F,cy:x,placement:s}}return null}function L0(e,t,s,i){for(const A of s){const r=bM(e,t,A,i);if(r)return r}return null}function _M(e,t,s,i){var u;const A=ca(s.stampId);if(!A)return null;const r=s.startCellIndex*2,a=Bt(r,i),l=i.cellWidth*2*s.span,h=i.cellHeight;for(const m of A.hits){const g=`triplet_${m}`,v=((u=s.shapeOffsets)==null?void 0:u[g])||0,y=s.row+v,C=Nt(y,i),x=ev[m],F=a+l*x/100,I=Math.sqrt(Math.pow(e-F,2)+Math.pow(t-C,2)),T=Math.min(l*.15,h*1);if(I<T)return{type:"triplet",slot:m,shapeKey:g,cx:F,cy:C,placement:s}}return null}function H0(e,t,s,i){for(const A of s){const r=_M(e,t,A,i);if(r)return r}return null}let jt,ia=!1,zt=null,ss=[],Xe=[],Aa=!1,dc=!1,Kl=null,ki=null,cA=[],Ws=!1,Bn=null,Pn=null,ra=!1,kn=null,oa=!1,Zd=null;const xM=275,EM="rgba(74, 144, 226, 0.25)";let ql=null,Pe=null,Oi=!1;function Oe(e){const t=d.state.fullRowData[e];return t?t.toneNote:null}function kc(e,t){const i=(d.state.selectedTool==="note"||d.state.selectedTool==="chord")&&d.state.selectedNote&&d.state.selectedNote.shape==="circle"?d.state.columnWidths.length-3:d.state.columnWidths.length-2;return e<2||e>=i?!1:Oe(t)!==null}function SM(e){const{macrobeatGroupings:t,columnWidths:s,macrobeatBoundaryStyles:i}=d.state;if(e<2||e>=s.length-2)return null;let A=-1;for(let h=0;h<t.length;h++){const{startColumn:u,endColumn:m}=An(d.state,h);if(e>=u&&e<=m){A=h;break}}if(A===-1)return null;let r=0;for(let h=A-1;h>=0;h--)if(i[h]==="solid"){r=h+1;break}const a=r-1;return{drawColumn:An(d.state,r).startColumn,preMacrobeatIndex:a}}function R0(e){const{activeChordIntervals:t,isIntervalsInverted:s,chordPositionState:i}=d.state;if(!e||!t||t.length===0)return[];if(s&&t.length===2&&t[0]==="1P"){const a="-"+t[1],l=Mo(e,a),h=Ql(l),u=h.includes("#")&&Zn(h).includes("b")?Zn(h):h;return[e,u]}const A=t.map(r=>{const a=Mo(e,r),l=Ql(a);if(l.includes("#")){const h=Zn(l);if(h.includes("b"))return h}return l});if(t.length>=3&&i>0){const r=[...A];for(let v=0;v<i;v++){const y=r.shift(),C=Mo(y,"8P");r.push(Ql(C))}const a=r[0],l=e,h=Fi(a),u=Fi(l);let m=0,g=h;for(;g>u;)g-=12,m-=12;for(;g+12<=u;)g+=12,m+=12;return r.map(v=>{const y=Fi(v)+m;return o_(y)})}return A}function Ko(e,t,s){if(!jt)return;const i={...d.state,zoomLevel:yt.getViewportInfo().zoomLevel},A=Bt(e,i),a=Nt(t,d.state)-d.state.cellHeight/2,l=d.state.selectedTool;let h;if(d.state.modulationMarkers&&d.state.modulationMarkers.length>0?h=Bt(e+1,i)-A:h=d.state.columnWidths[e]*d.state.cellWidth,l==="eraser"||Aa)d.state.modulationMarkers&&d.state.modulationMarkers.length>0?h=Bt(e+2,i)-A:h=d.state.cellWidth*2;else if(l==="note"&&d.state.selectedNote&&d.state.selectedNote.shape==="circle")d.state.modulationMarkers&&d.state.modulationMarkers.length>0?h=Bt(e+2,i)-A:h=d.state.cellWidth*2;else if(l==="stamp")d.state.modulationMarkers&&d.state.modulationMarkers.length>0?h=Bt(e+2,i)-A:h=d.state.cellWidth*2;else if(l==="triplet"){const u=Pc.getSelectedTripletStamp();if(u){const g=2*(u.span==="eighth"?1:2);d.state.modulationMarkers&&d.state.modulationMarkers.length>0?h=Bt(e+g,i)-A:h=d.state.cellWidth*g}else h=d.state.cellWidth*2}else l==="tonicization"&&(d.state.modulationMarkers&&d.state.modulationMarkers.length>0?h=Bt(e+2,i)-A:h=d.state.cellWidth*2);jt.fillStyle=s,jt.fillRect(A,a,h,d.state.cellHeight)}function O0(e,t,s=!1){if(!jt||!d.state.selectedNote)return;const i=d.state.selectedTool,{shape:A,color:r}=d.state.selectedNote;if(jt.globalAlpha=s?.2:.4,i==="tonicization"){const a={row:t,columnIndex:e,tonicNumber:d.state.selectedToolTonicNumber},l={...d.state,zoomLevel:yt.getViewportInfo().zoomLevel};Ef(jt,l,a)}else if(i==="note"){const a=A==="circle"?e+1:e,l={row:t,startColumnIndex:e,endColumnIndex:a,color:r,shape:A,isDrum:!1},h={...d.state,zoomLevel:yt.getViewportInfo().zoomLevel};A==="oval"?xf(jt,h,l,t):_f(jt,h,l,t)}jt.globalAlpha=1}function N0(e,t){var h,u;if(d.state.selectedTool!=="note"||!bf(e,d.state)||!d.state.selectedNote)return!1;const{shape:s,color:i}=d.state.selectedNote,A=s==="circle"?e+1:e,r={row:t,startColumnIndex:e,endColumnIndex:A,color:i,shape:s,isDrum:!1},a=d.addNote(r);if(!a)return!1;zt=a,a.uuid&&d.emit("noteInteractionStart",{noteId:a.uuid,color:a.color}),ia=!0,Bn=t;const l=Oe(t);if(l){Xe=[l],Kt.triggerAttack(l,zt.color);const m=((h=d.state.fullRowData[t])==null?void 0:h.hex)||"#888888";(u=Ms.adsrComponent)==null||u.playheadManager.trigger(zt.uuid,"attack",m,d.state.timbres[zt.color].adsr);const g=window.staticWaveformVisualizer;g&&(g.currentColor=zt.color,g.generateWaveform(),g.startSingleNoteVisualization(zt.color))}return!0}function FM(){if(d.state.selectedTool!=="note")return!1;const e=d.state.deviceProfile;if(e&&typeof e.isMobile=="boolean")return e.isMobile;if(typeof window<"u"&&typeof window.matchMedia=="function")try{return window.matchMedia("(pointer: coarse)").matches}catch{return!1}return!1}function V0(e){var l;if(!Zd)return null;const t=Zd.getBoundingClientRect(),s=e.clientX-t.left,i=e.clientY-t.top,A=((l=document.getElementById("canvas-container"))==null?void 0:l.scrollLeft)||0,r=Gs.getColumnIndex(s+A),a=Gs.getPitchRowIndex(i);return{x:s,y:i,colIndex:r,rowIndex:a}}function tf(e,t){if(!e)return null;for(let s=0;s<e.length;s++){const i=e.item(s);if(i&&i.identifier===t)return i}return null}function W0(){!jt||!Pe||(jt.clearRect(0,0,ke(jt.canvas),le(jt.canvas)),Ko(Pe.colIndex,Pe.rowIndex,EM),O0(Pe.colIndex,Pe.rowIndex),k0(Pe.colIndex,Pe.rowIndex))}function TM(){if(Pe){if(!kc(Pe.colIndex,Pe.rowIndex)){aa({clearOverlay:!1});return}Oi=!0,W0()}}function aa({clearOverlay:e=!1}={}){ql&&(clearTimeout(ql),ql=null),e&&Oi&&Dc(),Pe=null,Oi=!1}function IM(e){var i;if(!FM()||Pe)return;const t=(i=e.changedTouches)==null?void 0:i[0];if(!t)return;const s=V0(t);!s||!kc(s.colIndex,s.rowIndex)||(e.preventDefault(),Pe={identifier:t.identifier,colIndex:s.colIndex,rowIndex:s.rowIndex},ql=window.setTimeout(()=>{TM()},xM))}function QM(e){if(!Pe)return;const t=tf(e.changedTouches,Pe.identifier)||tf(e.touches,Pe.identifier);if(!t)return;const s=V0(t);if(!s){aa({clearOverlay:Oi});return}if(!kc(s.colIndex,s.rowIndex)){aa({clearOverlay:Oi});return}e.preventDefault(),Pe.colIndex=s.colIndex,Pe.rowIndex=s.rowIndex,Oi&&W0()}function MM(e){if(!Pe||!tf(e.changedTouches,Pe.identifier))return;e.preventDefault();const s=Oi,i=Pe.colIndex,A=Pe.rowIndex;if(aa(),!s||d.state.selectedTool!=="note")return;N0(i,A)?G0():Dc()}function UM(){aa({clearOverlay:Oi})}function PM(e){var l,h,u,m,g;const t=e.target.getBoundingClientRect(),s=e.clientX-t.left,i=e.clientY-t.top,A=document.getElementById("canvas-container").scrollLeft,r=Gs.getColumnIndex(s+A),a=Gs.getPitchRowIndex(i);if(kc(r,a)){if(e.button===2){e.preventDefault(),Aa=!0,Ws=!1,d.state.selectedTool!=="eraser"&&(Kl=d.state.selectedTool,d.setSelectedTool("eraser")),(l=uA.get("eraserButton"))==null||l.classList.add("erasing-active"),d.eraseInPitchArea(r,a,2,!1)&&(Ws=!0),d.eraseTonicSignAt(r,!1)&&(Ws=!0);const v=r+2-1,y=a-1,C=a+1;d.eraseStampsInArea(r,v,y,C)&&(Ws=!0),d.eraseTripletsInArea(r,v,y,C)&&(Ws=!0);const x=e.target.getBoundingClientRect(),F=e.clientX-x.left,I=e.clientY-x.top;re.eraseAtPoint(F,I)&&(Ws=!0),jt.clearRect(0,0,ke(jt.canvas),le(jt.canvas)),Ko(r,a,"rgba(220, 53, 69, 0.3)");return}if(e.button===0){const v=s+A;for(const x of d.state.modulationMarkers||[]);const y=d.state.placedNotes.find(x=>!x.isDrum&&x.row===a&&r>=x.startColumnIndex&&r<=x.endColumnIndex);if(y&&d.state.selectedTool==="note"){const x=Un.getStampAtPosition(r,a),F=Oe(a);if(x&&F){const I=window.staticWaveformVisualizer;I&&(I.currentColor=y.color,I.generateWaveform(),I.startSingleNoteVisualization(y.color)),Un.playRhythmPattern(x.stampId,F,y.color,y.shape,x),Xe=[F],zt=y}else if(F){const I=window.staticWaveformVisualizer;I&&(I.currentColor=y.color,I.generateWaveform(),I.startSingleNoteVisualization(y.color)),Kt.triggerAttack(F,y.color);const T=((h=d.state.fullRowData[a])==null?void 0:h.hex)||"#888888";(u=Ms.adsrComponent)==null||u.playheadManager.trigger(y.uuid,"attack",T,d.state.timbres[y.color].adsr),Xe=[F],zt=y}return}const C=d.state.selectedTool;if(C==="chord"){if(!bf(r,d.state))return;const x=Oe(a);if(!x)return;const F=R0(x),{shape:I,color:T}=d.state.selectedNote;Xe=[...F],Xe.forEach(D=>{Kt.triggerAttack(D,T)});const U=((m=d.state.fullRowData[a])==null?void 0:m.hex)||"#888888";(g=Ms.adsrComponent)==null||g.playheadManager.trigger("chord_preview","attack",U,d.state.timbres[T].adsr),ss=[],F.forEach(D=>{const O=d.state.fullRowData.findIndex(R=>R.toneNote===D);if(O!==-1){const R=I==="circle"?r+1:r,st={row:O,startColumnIndex:r,endColumnIndex:R,color:T,shape:I,isDrum:!1},Y=d.addNote(st);Y&&(ss.push(Y),Y.uuid&&d.emit("noteInteractionStart",{noteId:Y.uuid,color:Y.color}))}}),ia=!0,Bn=a;return}if(C==="tonicization"){if(ki&&cA.length>0){const x=cA.map(F=>({row:F,tonicNumber:d.state.selectedToolTonicNumber,preMacrobeatIndex:ki.preMacrobeatIndex,columnIndex:ki.drawColumn}));d.addTonicSignGroup(x),ki=null,cA=[]}return}if(C==="eraser"){dc=!0,d.eraseInPitchArea(r,a,2,!1);const x=r+2-1,F=a-1,I=a+1;ZI(r,x,F,I),nQ(r,x,F,I);return}if(C==="stamp"){const x=d.getAllStampPlacements(),F=s+A,I={...d.state},T=L0(F,i,x,I);if(T){Pn={...T,startRow:d.getShapeRow(T.placement,T.shapeKey),startMouseY:i},ra=!0;return}const U=Un.getStampAtPosition(r,a);if(U){const O=Oe(a);if(O){const R=d.state.placedNotes.find(Y=>!Y.isDrum&&Y.row===a&&r>=Y.startColumnIndex&&r<=Y.endColumnIndex),st=R?R.shape:"oval";Un.playRhythmPattern(U.stampId,O,U.color,st,U),Xe=[O]}return}const D=Nf.getSelectedStamp();if(D){const{color:O,shape:R}=d.state.selectedNote;JI(D.id,r,a,O);const st=Oe(a);st&&(Un.playRhythmPattern(D.id,st,O,R),Xe=[st]),d.recordState()}return}if(C==="triplet"){const x=d.getAllTripletPlacements(),F=s+A,I={...d.state},T=H0(F,i,x,I);if(T){kn={...T,startRow:d.getTripletShapeRow(T.placement,T.shapeKey),startMouseY:i},oa=!0;return}const U=Math.floor(r/2),D=Un.getTripletAtPosition(U,a);if(D){const R=Oe(a);R&&(Un.playTripletPattern(D.stampId,R,D.color,D),Xe=[R]);return}const O=Pc.getSelectedTripletStamp();if(O&&d.state.selectedNote){const R=eQ(O.id,U,a,d.state.selectedNote.color),st=Oe(a);st&&R&&(Un.playTripletPattern(O.id,st,d.state.selectedNote.color,R),Xe=[st]),d.recordState()}return}if(C==="modulation"){const x=d.state.selectedModulationRatio;if(!x){_.warn("PitchGridInteractor","No modulation ratio selected before placement",null,"grid");return}const F=K0(v);if(!F){_.warn("PitchGridInteractor","Modulation placement must be near a measure boundary",{clickX:v},"grid");return}_.debug("PitchGridInteractor","Placing modulation marker at boundary",{measureIndex:F.measureIndex,ratio:x,clickX:v,boundaryX:F.xPosition},"grid");const I=d.addModulationMarker(F.measureIndex,x,F.xPosition,null,F.macrobeatIndex);_.debug("PitchGridInteractor","Modulation marker placed",{markerId:I,measureIndex:F.measureIndex,ratio:x},"grid");return}C==="note"&&N0(r,a)}}}function kM(e){var g,v,y,C,x,F;const t=e.target.getBoundingClientRect(),s=e.clientX-t.left,i=e.clientY-t.top,A=document.getElementById("canvas-container").scrollLeft,r=Gs.getColumnIndex(s+A),a=Gs.getPitchRowIndex(i);if(!jt)return;if(jt.clearRect(0,0,ke(jt.canvas),le(jt.canvas)),ra&&Pn){const I=Gs.getPitchRowIndex(i),T=I-Pn.placement.row;if(d.updateStampShapeOffset(Pn.placement.id,Pn.shapeKey,T),I!==Pn.startRow){const U=Oe(I);if(U){const D=Pn.placement.color||((g=d.state.selectedNote)==null?void 0:g.color);Kt.triggerAttack(U,D),setTimeout(()=>Kt.triggerRelease(U,D),100)}Pn.startRow=I}e.target.style.cursor="ns-resize";return}if(oa&&kn){const I=Gs.getPitchRowIndex(i),T=I-kn.placement.row;if(d.updateTripletShapeOffset(kn.placement.id,kn.shapeKey,T),I!==kn.startRow){const U=Oe(I);if(U){const D=kn.placement.color||((v=d.state.selectedNote)==null?void 0:v.color);Kt.triggerAttack(U,D),setTimeout(()=>Kt.triggerRelease(U,D),100)}kn.startRow=I}e.target.style.cursor="ns-resize";return}const l=d.state.selectedTool;if(l==="stamp"&&!ra){const I=s+A,T=d.getAllStampPlacements(),U={...d.state};L0(I,i,T,U)?e.target.style.cursor="ns-resize":e.target.style.cursor="default"}if(l==="triplet"&&!oa){const I=s+A,T=d.getAllTripletPlacements(),U={...d.state};H0(I,i,T,U)?e.target.style.cursor="ns-resize":e.target.style.cursor="default"}const h=s+A;for(const I of d.state.modulationMarkers||[]);if(d.state.selectedTool==="modulation"){const I=K0(h);I&&DM(jt,I.xPosition,d.state.selectedModulationRatio)}e.target;const m=(d.state.selectedTool==="note"||d.state.selectedTool==="chord")&&d.state.selectedNote&&d.state.selectedNote.shape==="circle"?d.state.columnWidths.length-3:d.state.columnWidths.length-2;if(r<2||r>=m||Oe(a)===null){ki=null,cA=[],D0();return}if(k0(r,a),ia&&(zt||ss.length>0)){const I=r,T=a;if(zt){if(zt.shape==="circle"){if(I!==zt.endColumnIndex&&d.updateNoteTail(zt,I),T!==Bn&&T!==zt.row){const U=Oe(T);if(U){const D=Oe(zt.row);D&&Kt.triggerRelease(D,zt.color),d.updateNoteRow(zt,T),Kt.triggerAttack(U,zt.color),Xe=[U];const O=((y=d.state.fullRowData[T])==null?void 0:y.hex)||"#888888";(C=Ms.adsrComponent)==null||C.playheadManager.trigger(zt.uuid,"attack",O,d.state.timbres[zt.color].adsr),Bn=T}}}else if(zt.shape==="oval"){const U=r;if(U!==zt.startColumnIndex&&d.updateNotePosition(zt,U),T!==zt.row){const D=Oe(T);if(D){const O=Oe(zt.row);O&&Kt.triggerRelease(O,zt.color),d.updateNoteRow(zt,T),Kt.triggerAttack(D,zt.color),Xe=[D];const R=((x=d.state.fullRowData[T])==null?void 0:x.hex)||"#888888";(F=Ms.adsrComponent)==null||F.playheadManager.trigger(zt.uuid,"attack",R,d.state.timbres[zt.color].adsr)}}}}else if(ss.length>0){const U=ss[0];if(U.shape==="circle"){const D=ss.filter(O=>I!==O.endColumnIndex);if(D.length>0&&d.updateMultipleNoteTails(D,I),T!==Bn){const O=T-Bn;Xe.forEach(Y=>{Kt.triggerRelease(Y,ss[0].color)});const R=ss.map(Y=>Y.row+O);if(R.every(Y=>Oe(Y)!==null)){d.updateMultipleNoteRows(ss,R);const Y=R.map(L=>Oe(L)).filter(L=>L);Y.forEach(L=>{Kt.triggerAttack(L,ss[0].color)}),Xe=Y,Bn=T}}}else if(U.shape==="oval"){const D=r,O=ss.filter(st=>D!==st.startColumnIndex);O.length>0&&d.updateMultipleNotePositions(O,D);const R=T-(Bn!==null?Bn:ss[0].row);if(R!==0){Xe.forEach(L=>{Kt.triggerRelease(L,ss[0].color)});const st=ss.map(L=>L.row+R);if(st.every(L=>Oe(L)!==null)){d.updateMultipleNoteRows(ss,st);const L=st.map(J=>Oe(J)).filter(J=>J);L.forEach(J=>{Kt.triggerAttack(J,ss[0].color)}),Xe=L,Bn=T}}}}return}if(d.state.selectedTool==="chord"){const I=Oe(a);if(I){const T=R0(I),{shape:U,color:D}=d.state.selectedNote;jt.globalAlpha=.4,T.forEach(O=>{const R=d.state.fullRowData.findIndex(st=>st.toneNote===O);if(R>-1){const st=U==="circle"?r+1:r,Y={row:R,startColumnIndex:r,endColumnIndex:st,color:D,shape:U,isDrum:!1},L={...d.state,zoomLevel:yt.getViewportInfo().zoomLevel};U==="oval"?xf(jt,L,Y,R):_f(jt,L,Y,R)}}),jt.globalAlpha=1}return}if(Aa){d.eraseInPitchArea(r,a,2,!1)&&(Ws=!0),d.eraseTonicSignAt(r,!1)&&(Ws=!0);const I=r+2-1,T=a-1,U=a+1;d.eraseStampsInArea(r,I,T,U)&&(Ws=!0),d.eraseTripletsInArea(r,I,T,U)&&(Ws=!0);const D=e.target.getBoundingClientRect(),O=e.clientX-D.left,R=e.clientY-D.top;re.eraseAtPoint(O,R)&&(Ws=!0),Ko(r,a,"rgba(220, 53, 69, 0.3)");return}if(dc){d.eraseInPitchArea(r,a,2,!1);const I=r+2-1,T=a-1,U=a+1;d.eraseStampsInArea(r,I,T,U),d.eraseTripletsInArea(r,I,T,U),Ko(r,a,"rgba(220, 53, 69, 0.3)");return}if(d.state.selectedTool==="tonicization"){const I=SM(r);if(I){const T=Oe(a);if(T){const U=d.state.fullRowData.map((O,R)=>({...O,index:R})).filter(O=>O.toneNote&&O.toneNote.replace(/\d+$/,"")===T.replace(/\d+$/,"")).map(O=>O.index);ki=I,cA=U,jt.globalAlpha=.5;const D={...d.state,zoomLevel:yt.getViewportInfo().zoomLevel};U.forEach(O=>{const R={row:O,columnIndex:I.drawColumn,tonicNumber:d.state.selectedToolTonicNumber};Ef(jt,D,R)}),jt.globalAlpha=1}}else ki=null,cA=[]}else{const I=d.state.selectedTool==="note"||d.state.selectedTool==="chord"?bf(r,d.state):!0,T=d.state.selectedTool==="eraser"?"rgba(220, 53, 69, 0.3)":I?"rgba(74, 144, 226, 0.2)":"rgba(220, 53, 69, 0.15)";if(Ko(r,a,T),d.state.selectedTool==="stamp"){const D=Nf.getSelectedStamp();if(D){const O={cellWidth:d.state.cellWidth,cellHeight:d.state.cellHeight,columnWidths:d.state.columnWidths,previewColor:"#4a90e2"};ux(jt,r,a,D,O)}}else if(d.state.selectedTool==="triplet"){const D=Pc.getSelectedTripletStamp();if(D){const O=Math.floor(r/2),R={cellWidth:d.state.cellWidth,cellHeight:d.state.cellHeight,columnWidths:d.state.columnWidths,previewColor:"#4a90e2"};gx(jt,O,a,D,R)}}else I&&O0(r,a)}}function Dc(){jt&&jt.clearRect(0,0,ke(jt.canvas),le(jt.canvas)),ki=null,cA=[],D0()}function G0(){var e,t,s,i,A;if(ra&&Pn){ra=!1,Pn=null,d.recordState();const r=document.getElementById("notation-grid");r&&(r.style.cursor="default");return}if(oa&&kn){oa=!1,kn=null,d.recordState();const r=document.getElementById("notation-grid");r&&(r.style.cursor="default");return}if(Xe.length>0){Un.stopCurrentPattern();const r=(e=d.state.selectedNote)==null?void 0:e.color;if(r&&Xe.forEach(h=>{Kt.triggerRelease(h,r)}),!!zt){const h=((t=d.state.fullRowData[zt.row])==null?void 0:t.hex)||"#888888";(s=Ms.adsrComponent)==null||s.playheadManager.trigger(zt.uuid,"release",h,d.state.timbres[r].adsr)}else{const h=Xe[0],u=d.state.fullRowData.find(m=>m.toneNote===h);if(u){const m=u.hex;(i=Ms.adsrComponent)==null||i.playheadManager.trigger("chord_preview","release",m,d.state.timbres[r].adsr)}}Xe=[];const l=window.staticWaveformVisualizer;l&&l.stopLiveVisualization()}ia&&d.recordState(),ia=!1,Bn=null,zt&&zt.uuid&&d.emit("noteInteractionEnd",{noteId:zt.uuid}),ss.forEach(r=>{r.uuid&&d.emit("noteInteractionEnd",{noteId:r.uuid})}),zt=null,ss=[],dc&&(d.recordState(),dc=!1),Aa&&(Ws&&d.recordState(),Aa=!1,Ws=!1,Kl&&(d.setSelectedTool(Kl),Kl=null),(A=uA.get("eraserButton"))==null||A.classList.remove("erasing-active")),Dc()}function K0(e){const{macrobeatBoundaryStyles:t}=d.state,s=100,i=[],A=d.state.modulationMarkers&&d.state.modulationMarkers.length>0;_.debug("PitchGridInteractor","Boundary calculation modulation state",{hasModulation:A},"grid");for(let h=0;h<t.length;h++)if(t[h]==="solid"){const u=An(d.state,h);if(u){const m=A?Bt(u.endColumn+1,{...d.state,modulationMarkers:d.state.modulationMarkers,cellWidth:d.state.cellWidth,columnWidths:d.state.columnWidths,baseMicrobeatPx:d.state.cellWidth}):yt.getColumnX(u.endColumn+1);_.debug("PitchGridInteractor","Computed measure boundary",{boundaryIndex:h,endColumn:u.endColumn,calculatedX:m,method:A?"modulated":"base"},"grid"),i.push({measureIndex:h+1,xPosition:m,macrobeatIndex:h})}}const r=A?Bt(2,{...d.state,modulationMarkers:d.state.modulationMarkers,cellWidth:d.state.cellWidth,columnWidths:d.state.columnWidths,baseMicrobeatPx:d.state.cellWidth}):yt.getColumnX(2);_.debug("PitchGridInteractor","Start boundary position",{startBoundaryX:r,method:A?"modulated":"base"},"grid"),i.unshift({measureIndex:0,xPosition:r,macrobeatIndex:-1}),_.debug("PitchGridInteractor","Available measure boundaries",{boundaries:i},"grid"),_.debug("PitchGridInteractor","Modulation click context",{clickX:e,tolerance:s},"grid");let a=null,l=1/0;return i.forEach(h=>{const u=Math.abs(e-h.xPosition);_.debug("PitchGridInteractor","Boundary distance check",{boundaryX:h.xPosition,distance:u},"grid"),u<=s&&u<l&&(l=u,a=h)}),a?_.debug("PitchGridInteractor","Found closest boundary",{boundary:a,distance:l},"grid"):_.debug("PitchGridInteractor","No boundary found within tolerance",{tolerance:s},"grid"),a}function DM(e,t,s){if(!s)return;const i=Hw(s),A=Lw(s);e.save();const r=3,a=2,l=le(e.canvas);e.strokeStyle=i,e.lineWidth=a,e.globalAlpha=.7,e.setLineDash([]);for(let h=-1;h<=1;h++){const u=t+h*r;e.beginPath(),e.moveTo(u,0),e.lineTo(u,l),e.stroke()}e.globalAlpha=.8,e.font="12px Arial, sans-serif",e.textAlign="center",e.textBaseline="top",e.fillStyle=i,e.fillText(`Preview: ${A}`,t,10),e.restore()}function LM(){const e=document.getElementById("notation-grid"),t=document.getElementById("hover-canvas");if(!e||!t){_.error("PitchGridInteractor","Could not find required canvas elements.",{hasPitchCanvas:!!e,hasHoverCanvas:!!t},"grid");return}jt=t.getContext("2d"),Zd=e,e.addEventListener("mousedown",PM),e.addEventListener("mousemove",kM),e.addEventListener("mouseleave",Dc),e.addEventListener("contextmenu",s=>s.preventDefault()),e.addEventListener("touchstart",IM,{passive:!1}),e.addEventListener("touchmove",QM,{passive:!1}),e.addEventListener("touchend",MM,{passive:!1}),e.addEventListener("touchcancel",UM,{passive:!1}),window.addEventListener("mouseup",G0)}const ef={init(){LM(),wM(),document.addEventListener("canvasResized",()=>{this.renderPitchGrid(),this.renderDrumGrid()}),d.on("animationUpdate",e=>{e.type==="vibrato"&&e.activeColors&&e.activeColors.length>0?this.renderPitchGrid():e.type==="envelopeFill"||e.hasEnvelopeFills?this.renderPitchGrid():e.type==="combined"&&e.vibratoColors&&e.vibratoColors.length>0&&this.renderPitchGrid()})},renderPitchGrid:iA.render,renderDrumGrid:js.render},HM=16,RM={init(){this.overlay=document.getElementById("print-preview-overlay"),this.overlay&&(this.canvas=document.getElementById("print-preview-canvas"),this.ctx=this.canvas.getContext("2d"),this.cropOverlay=document.getElementById("print-crop-overlay"),this.cropCtx=this.cropOverlay.getContext("2d"),this.canvasWrapper=this.canvas.parentElement,this.orientationBtn=document.getElementById("print-orientation-toggle"),this.colorBtn=document.getElementById("print-color-mode-toggle"),this.drumsBtn=document.getElementById("print-drums-toggle"),this.buttonsBtn=document.getElementById("print-buttons-toggle"),this.isDragging=!1,this.dragHandle=null,this.handleSize=20,this.handlePadding=5,document.getElementById("print-close-button").addEventListener("click",()=>this.hide()),document.getElementById("print-confirm-button").addEventListener("click",()=>{Pi.generateAndPrint(),this.hide()}),this.orientationBtn.addEventListener("click",()=>this.handleToggle("orientation",["landscape","portrait"])),this.colorBtn.addEventListener("click",()=>this.handleToggle("colorMode",["color","bw"])),this.drumsBtn.addEventListener("click",()=>this.handleToggle("includeDrums",[!0,!1])),this.buttonsBtn.addEventListener("click",()=>this.handleToggle("includeButtonGrid",[!0,!1])),this.cropOverlay.addEventListener("mousedown",e=>this.onCropMouseDown(e)),this.cropOverlay.addEventListener("mousemove",e=>this.onCropMouseMove(e)),this.cropOverlay.addEventListener("mouseup",()=>this.onCropMouseUp()),this.cropOverlay.addEventListener("mouseleave",()=>this.onCropMouseUp()),d.on("printPreviewStateChanged",e=>e?this.show():this.hide()),d.on("printOptionsChanged",()=>this.render()),d.on("notesChanged",()=>{d.state.isPrintPreviewActive&&this.render()}),new ResizeObserver(()=>{d.state.isPrintPreviewActive&&this.render()}).observe(this.canvasWrapper))},show(){d.state.isPrintPreviewActive||d.setPrintPreviewActive(!0),this.overlay.classList.remove("hidden"),d.setPrintOptions({cropTop:0,cropBottom:1,cropLeft:0,cropRight:1}),d.state.printOptions.includeButtonGrid&&Pi.prefetchButtonGridSnapshot(),this.render()},hide(){d.state.isPrintPreviewActive&&d.setPrintPreviewActive(!1),this.overlay.classList.add("hidden")},handleToggle(e,t){const i=d.state.printOptions[e]===t[0]?t[1]:t[0];d.setPrintOptions({[e]:i}),e==="includeButtonGrid"&&i===!0&&Pi.prefetchButtonGridSnapshot()},updateControls(){const{orientation:e,colorMode:t,includeDrums:s,includeButtonGrid:i}=d.state.printOptions;this.orientationBtn.textContent=e.charAt(0).toUpperCase()+e.slice(1),this.colorBtn.textContent=t==="color"?"Color":"B&W",this.drumsBtn.textContent=s?"Include":"Exclude",this.buttonsBtn.textContent=i?"Include":"Exclude",this.drumsBtn.classList.toggle("active",s),this.buttonsBtn.classList.toggle("active",i),this.colorBtn.classList.toggle("active",t==="color")},async render(){if(!d.state.isPrintPreviewActive)return;this.updateControls();const e=this.canvasWrapper.clientWidth,t=this.canvasWrapper.clientHeight;if(e===0||t===0)return;const s=d.state.printOptions.orientation,i=s==="landscape"?10.5:8,A=s==="landscape"?8:10.5,r=.25,a=i/A,l=HM*2;let h=Math.max(e-l,100),u=Math.max(t-l,100);h/u>a?h=u*a:u=h/a;const m=r/i*h,g=h-2*m,v=u-2*m,y={...d.state.printOptions,cropTop:0,cropBottom:1,cropLeft:0,cropRight:1},C=await Pi.generateScoreCanvas(y,{width:g,height:v});C&&(this.canvas.width=h,this.canvas.height=u,this.ctx.fillStyle="#FFFFFF",this.ctx.fillRect(0,0,h,u),this.ctx.strokeStyle="#E0E0E0",this.ctx.lineWidth=1,this.ctx.strokeRect(m,m,g,v),this.ctx.drawImage(C,m,m),this.drawCornerMarks(m,g,v),this.renderCropOverlay(h,u,m,v))},drawCornerMarks(e,t,s){this.ctx.strokeStyle="#CCCCCC",this.ctx.lineWidth=1;const i=10,A=e+t,r=e+s;this.ctx.beginPath(),this.ctx.moveTo(e,e-i),this.ctx.lineTo(e,e+i),this.ctx.moveTo(e-i,e),this.ctx.lineTo(e+i,e),this.ctx.moveTo(A,e-i),this.ctx.lineTo(A,e+i),this.ctx.moveTo(A-i,e),this.ctx.lineTo(A+i,e),this.ctx.moveTo(e,r-i),this.ctx.lineTo(e,r+i),this.ctx.moveTo(e-i,r),this.ctx.lineTo(e+i,r),this.ctx.moveTo(A,r-i),this.ctx.lineTo(A,r+i),this.ctx.moveTo(A-i,r),this.ctx.lineTo(A+i,r),this.ctx.stroke()},renderCropOverlay(e,t,s,i){const A=this.canvas.getBoundingClientRect(),r=this.canvasWrapper.getBoundingClientRect();this.cropOverlay.width=e,this.cropOverlay.height=t,this.cropOverlay.style.left=`${A.left-r.left}px`,this.cropOverlay.style.top=`${A.top-r.top}px`,this.cropOverlay.style.width=`${e}px`,this.cropOverlay.style.height=`${t}px`;const{cropTop:a,cropBottom:l,cropLeft:h,cropRight:u}=d.state.printOptions,m=s,g=s,v=e-2*s,y=i,C=v,x=m+a*y,F=m+l*y,I=g+h*C,T=g+u*C;this.cropCtx.clearRect(0,0,e,t),this.cropCtx.fillStyle="rgba(0, 0, 0, 0.5)",a>0&&this.cropCtx.fillRect(0,0,e,x),l<1&&this.cropCtx.fillRect(0,F,e,t-F),h>0&&this.cropCtx.fillRect(0,x,I,F-x),u<1&&this.cropCtx.fillRect(T,x,e-T,F-x),this.drawVerticalHandle(x,e,"top"),this.drawVerticalHandle(F,e,"bottom"),this.drawHorizontalHandle(I,t,"left"),this.drawHorizontalHandle(T,t,"right"),this.cropState={pageWidth:e,pageHeight:t,contentTop:m,contentLeft:g,contentHeight:y,contentWidth:C,cropTopY:x,cropBottomY:F,cropLeftX:I,cropRightX:T}},drawVerticalHandle(e,t){const i=(t-60)/2;this.cropCtx.fillStyle="#4a90e2",this.cropCtx.fillRect(0,e-1,t,2),this.cropCtx.fillStyle="#4a90e2",this.cropCtx.fillRect(i,e-this.handleSize/2,60,this.handleSize),this.cropCtx.strokeStyle="#FFFFFF",this.cropCtx.lineWidth=2,this.cropCtx.strokeRect(i,e-this.handleSize/2,60,this.handleSize),this.cropCtx.strokeStyle="#FFFFFF",this.cropCtx.lineWidth=1;const A=3,r=6,a=30,l=(t-a)/2;for(let h=0;h<A;h++){const u=e+(h-1)*r;this.cropCtx.beginPath(),this.cropCtx.moveTo(l,u),this.cropCtx.lineTo(l+a,u),this.cropCtx.stroke()}},drawHorizontalHandle(e,t){const i=(t-60)/2;this.cropCtx.fillStyle="#4a90e2",this.cropCtx.fillRect(e-1,0,2,t),this.cropCtx.fillStyle="#4a90e2",this.cropCtx.fillRect(e-this.handleSize/2,i,this.handleSize,60),this.cropCtx.strokeStyle="#FFFFFF",this.cropCtx.lineWidth=2,this.cropCtx.strokeRect(e-this.handleSize/2,i,this.handleSize,60),this.cropCtx.strokeStyle="#FFFFFF",this.cropCtx.lineWidth=1;const A=3,r=6,a=30,l=(t-a)/2;for(let h=0;h<A;h++){const u=e+(h-1)*r;this.cropCtx.beginPath(),this.cropCtx.moveTo(u,l),this.cropCtx.lineTo(u,l+a),this.cropCtx.stroke()}},onCropMouseDown(e){if(!this.cropState)return;const t=this.cropOverlay.getBoundingClientRect(),s=e.clientX-t.left,i=e.clientY-t.top;if(Math.abs(i-this.cropState.cropTopY)<this.handleSize+this.handlePadding){this.isDragging=!0,this.dragHandle="top",this.cropOverlay.style.cursor="ns-resize";return}if(Math.abs(i-this.cropState.cropBottomY)<this.handleSize+this.handlePadding){this.isDragging=!0,this.dragHandle="bottom",this.cropOverlay.style.cursor="ns-resize";return}if(Math.abs(s-this.cropState.cropLeftX)<this.handleSize+this.handlePadding){this.isDragging=!0,this.dragHandle="left",this.cropOverlay.style.cursor="ew-resize";return}if(Math.abs(s-this.cropState.cropRightX)<this.handleSize+this.handlePadding){this.isDragging=!0,this.dragHandle="right",this.cropOverlay.style.cursor="ew-resize";return}},onCropMouseMove(e){if(!this.cropState)return;const t=this.cropOverlay.getBoundingClientRect(),s=e.clientX-t.left,i=e.clientY-t.top;if(this.isDragging&&this.dragHandle){if(this.dragHandle==="top"||this.dragHandle==="bottom"){const A=i-this.cropState.contentTop,r=Math.max(0,Math.min(1,A/this.cropState.contentHeight));if(this.dragHandle==="top"){const a=d.state.printOptions.cropBottom;r<a-.05&&d.setPrintOptions({cropTop:r})}else if(this.dragHandle==="bottom"){const a=d.state.printOptions.cropTop;r>a+.05&&d.setPrintOptions({cropBottom:r})}}else if(this.dragHandle==="left"||this.dragHandle==="right"){const A=s-this.cropState.contentLeft,r=Math.max(0,Math.min(1,A/this.cropState.contentWidth));if(this.dragHandle==="left"){const a=d.state.printOptions.cropRight;r<a-.05&&d.setPrintOptions({cropLeft:r})}else if(this.dragHandle==="right"){const a=d.state.printOptions.cropLeft;r>a+.05&&d.setPrintOptions({cropRight:r})}}}else{const A=Math.abs(i-this.cropState.cropTopY)<this.handleSize+this.handlePadding,r=Math.abs(i-this.cropState.cropBottomY)<this.handleSize+this.handlePadding,a=Math.abs(s-this.cropState.cropLeftX)<this.handleSize+this.handlePadding,l=Math.abs(s-this.cropState.cropRightX)<this.handleSize+this.handlePadding;A||r?this.cropOverlay.style.cursor="ns-resize":a||l?this.cropOverlay.style.cursor="ew-resize":this.cropOverlay.style.cursor="default"}},onCropMouseUp(){this.isDragging=!1,this.dragHandle=null,this.cropOverlay.style.cursor="default"}};async function OM(){AM.init(),ef.init(),RM.init(),Nf.init(),Pc.init()}const mn={};function NM(){return mn.container=document.querySelector("#adsr-envelope"),mn.parentContainer=mn.container.closest(".adsr-container"),mn.sustainTrack=document.getElementById("sustain-slider-track"),mn.sustainThumb=document.getElementById("sustain-slider-thumb"),mn.multiSliderContainer=document.getElementById("multi-thumb-slider-container"),mn.thumbA=document.getElementById("thumb-a"),mn.thumbD=document.getElementById("thumb-d"),mn.thumbR=document.getElementById("thumb-r"),mn}const VM={init:NM,get elements(){return mn}};function q0(){return $0*d.state.adsrTimeAxisScale}function z0(e,t){const{sustain:s}=d.state.timbres[t.currentColor].adsr,i=.01;e.d=Math.max(e.a+i,e.d),e.r=Math.max(e.d+i,e.r);const A=e.a,r=e.d-e.a,a=e.r-e.d;if(isNaN(A)||isNaN(r)||isNaN(a)){_.error("AdsrInteractions","NaN value detected before setting ADSR. Aborting update.",{newAttack:A,newDecay:r,newRelease:a},"audio");return}d.setADSR(t.currentColor,{attack:A,decay:r,release:a,sustain:s})}function WM(e,t){let s=!1;const i=a=>{var y;if(!s)return;const l=e.sustainTrack.getBoundingClientRect();let u=100-(a.clientY-l.top)/l.height*100;u=Math.max(0,Math.min(100,u));const g=(((y=window.staticWaveformVisualizer)==null?void 0:y.getNormalizedAmplitude())||1)*100;u=Math.min(u,g);const v=d.state.timbres[t.currentColor];d.setADSR(t.currentColor,{...v.adsr,sustain:u/100})},A=a=>{s=!0,i(a)},r=()=>{s=!1};e.sustainTrack.addEventListener("pointerdown",A),document.addEventListener("pointermove",i),document.addEventListener("pointerup",r)}function GM(e,t){let s=null;const i=a=>{if(!s)return;const l=e.multiSliderContainer.getBoundingClientRect();let u=(a.clientX-l.left)/l.width*100;u=Math.max(0,Math.min(100,u));const m=u/100*q0(),{attack:g,decay:v,release:y}=d.state.timbres[t.currentColor].adsr,C={a:g,d:g+v,r:g+v+y};s.id==="thumb-a"&&(C.a=m),s.id==="thumb-d"&&(C.d=m),s.id==="thumb-r"&&(C.r=m),z0(C,t)},A=a=>{a.target.classList.contains("time-slider-thumb")&&(s=a.target,i(a))},r=()=>{s=null};e.multiSliderContainer.addEventListener("pointerdown",A),document.addEventListener("pointermove",i),document.addEventListener("pointerup",r)}function KM(e,t){let s=null;const i=a=>{var D;if(!s)return;const l=t.svgContainer,h=l.createSVGPoint();h.x=a.clientX,h.y=a.clientY;const u=h.matrixTransform(l.getScreenCTM().inverse());let m=u.x/t.width*100,g=1-u.y/t.height;m=Math.max(0,Math.min(100,m)),g=Math.max(0,Math.min(1,g));const v=m/100*q0(),y=d.state.timbres[t.currentColor],{attack:C,decay:x,release:F}=y.adsr;let I=y.adsr.sustain;const T={a:C,d:C+x,r:C+x+F};switch(s.id){case"attack-node":T.a=v;break;case"decay-sustain-node":{T.d=v;const O=((D=window.staticWaveformVisualizer)==null?void 0:D.getNormalizedAmplitude())||1;I=Math.min(g,O);break}case"release-node":T.r=v;break}const U=d.state.timbres[t.currentColor].adsr.sustain;I!==U&&d.setADSR(t.currentColor,{attack:C,decay:x,release:F,sustain:I}),z0(T,t)},A=a=>{a.target.classList.contains("adsr-node")&&(s=a.target,s.style.cursor="grabbing",i(a))},r=()=>{s&&(s.style.cursor="grab",s=null)};t.nodeLayer.addEventListener("pointerdown",A),document.addEventListener("pointermove",i),document.addEventListener("pointerup",r)}function qM(e){const t=e.ui;WM(t,e),GM(t,e),KM(t,e)}function zM(e,{width:t,height:s},i){for(;e.firstChild;)e.removeChild(e.firstChild);if(i>0){for(let l=1;l<=5;l++)if(l<=i){const h=l/i*t,u=document.createElementNS("http://www.w3.org/2000/svg","text");u.setAttribute("x",h),u.setAttribute("y",s-5),u.setAttribute("fill","#d0d0d0"),u.setAttribute("font-size","24"),u.setAttribute("font-weight","bold"),u.setAttribute("text-anchor","middle"),u.setAttribute("dominant-baseline","auto"),u.setAttribute("opacity","0.3"),u.textContent=`${l}s`,e.appendChild(u)}}const A=d.state.tempo;if(A<=0||i<=0)return;const r=30/A;let a=0;for(let l=r;l<i;l+=r){const h=l/i*t,u=document.createElementNS("http://www.w3.org/2000/svg","line");u.setAttribute("x1",h),u.setAttribute("y1",0),u.setAttribute("x2",h),u.setAttribute("y2",s);const m=(a+1)%2===0;u.setAttribute("stroke",m?"#adb5bd":"#ced4da"),u.setAttribute("stroke-width",m?"1":"0.5"),u.setAttribute("stroke-dasharray","3,3"),e.appendChild(u),a++}}function $M(e,t,s,{height:i,width:A},r,a,l){for(;e.firstChild;)e.removeChild(e.firstChild);for(;t.firstChild;)t.removeChild(t.firstChild);if(s.length===0)return;const h=d.state.colorPalette[r]||{primary:r,light:r},u=h.primary,m=h.light;let g={time:0,feedback:0},v={decay:0,roomSize:0};window.effectsCoordinator&&(g=window.effectsCoordinator.getEffectParameters(r,"delay"),v=window.effectsCoordinator.getEffectParameters(r,"reverb")),l&&l.clearRect(0,0,A,i);const y=(R,st=1)=>{if(!l||v.decay===0||v.roomSize===0||!a)return;const Y=v.decay/100*5*(A/a),L=v.roomSize/100*st;l.filter="blur(30px)";const J=parseInt(m.slice(1,3),16),dt=parseInt(m.slice(3,5),16),ht=parseInt(m.slice(5,7),16),rt=60;for(let Tt=0;Tt<rt;Tt++){const It=Tt/rt,Ht=(Tt+1)/rt,tt=R[1].y+(R[3].y-R[1].y)*It,ct=R[1].y+(R[3].y-R[1].y)*Ht,lt=R[1].x+(R[3].x-R[1].x)*It,mt=R[1].x+(R[3].x-R[1].x)*Ht,At=l.createLinearGradient(lt,tt,lt+Y,tt);At.addColorStop(0,`rgba(${J}, ${dt}, ${ht}, ${L})`),At.addColorStop(1,`rgba(${J}, ${dt}, ${ht}, 0)`),l.fillStyle=At,l.beginPath(),l.moveTo(lt,tt),l.lineTo(lt+Y,tt),l.lineTo(mt+Y,ct),l.lineTo(mt,ct),l.closePath(),l.fill()}l.filter="none"};if(y(s,1),g.time>0&&g.feedback>0&&a){const R=Math.max(.01,g.time/100*.5),st=Math.min(.95,g.feedback/100),Y=.05;let L=st,J=0;for(;L>Y&&J<10;){J++;const dt=R*J/a*A,ht=s.map(rt=>({x:rt.x+dt,y:rt.y}));if(ht[0].x<A){y(ht,L);const rt=document.createElementNS("http://www.w3.org/2000/svg","polygon"),Tt=`${ht[0].x},${i} `+ht.map(Ht=>`${Ht.x},${Ht.y}`).join(" ")+` ${Math.min(ht[3].x,A)},${i}`;rt.setAttribute("points",Tt),rt.setAttribute("fill",yn(m,.7*L)),rt.setAttribute("class","delay-echo"),e.appendChild(rt);const It=document.createElementNS("http://www.w3.org/2000/svg","polyline");It.setAttribute("points",ht.map(Ht=>`${Ht.x},${Ht.y}`).join(" ")),It.setAttribute("stroke-width",2),It.setAttribute("fill","none"),It.setAttribute("stroke",yn(u,L)),It.setAttribute("class","delay-echo"),e.appendChild(It)}L*=st}}const C=document.createElementNS("http://www.w3.org/2000/svg","polygon"),x=`0,${i} `+s.map(R=>`${R.x},${R.y}`).join(" ")+` ${A},${i}`;C.setAttribute("points",x),C.setAttribute("fill",yn(m,.7)),e.appendChild(C);const F=document.createElementNS("http://www.w3.org/2000/svg","line");F.setAttribute("x1",s[0].x),F.setAttribute("y1",s[0].y),F.setAttribute("x2",s[1].x),F.setAttribute("y2",s[1].y),F.setAttribute("stroke",u),F.setAttribute("stroke-width",2),e.appendChild(F);const I=document.createElementNS("http://www.w3.org/2000/svg","line");I.setAttribute("x1",s[1].x),I.setAttribute("y1",s[1].y),I.setAttribute("x2",s[2].x),I.setAttribute("y2",s[2].y),I.setAttribute("stroke",u),I.setAttribute("stroke-width",2),e.appendChild(I);const T=v.decay>0&&v.roomSize>0?Math.max(.3,1-v.decay/100*(v.roomSize/100)*.7):1,U=document.createElementNS("http://www.w3.org/2000/svg","line");U.setAttribute("x1",s[2].x),U.setAttribute("y1",s[2].y),U.setAttribute("x2",s[3].x),U.setAttribute("y2",s[3].y),U.setAttribute("stroke",yn(u,T)),U.setAttribute("stroke-width",2),e.appendChild(U);const D=["attack-node","decay-sustain-node","release-node"];[s[1],s[2],s[3]].forEach((R,st)=>{const Y=document.createElementNS("http://www.w3.org/2000/svg","circle");Y.setAttribute("id",D[st]),Y.setAttribute("class","adsr-node"),Y.setAttribute("cx",R.x),Y.setAttribute("cy",R.y),Y.setAttribute("r",8),Y.setAttribute("fill",u),Y.setAttribute("stroke",Qc(u,-.3)),Y.setAttribute("stroke-width",2),Y.style.cursor="grab";const L=document.createElementNS("http://www.w3.org/2000/svg","title");Y.appendChild(L),t.appendChild(Y)})}function XM(e,t){const s=Qc(t,-.2);e.style.setProperty("--c-accent",t),e.style.setProperty("--c-accent-hover",s)}const Ge={};let ii=null,fA=!1;function YM(e,t){const s=document.createElementNS("http://www.w3.org/2000/svg","g");s.setAttribute("data-playhead-id",e);const i=document.createElementNS("http://www.w3.org/2000/svg","line");i.setAttribute("stroke",t),i.setAttribute("stroke-width",2),i.setAttribute("stroke-dasharray","3,3"),s.appendChild(i);const A=document.createElementNS("http://www.w3.org/2000/svg","circle");return A.setAttribute("r",5),A.setAttribute("fill",t),s.appendChild(A),s}function jM(e,t,s,i=null){if(!(!ii||!i)){if(t==="attack"){Ge[e]&&(cancelAnimationFrame(Ge[e].requestId),Ge[e].group.remove());const A=YM(e,s);ii.playheadLayer.appendChild(A),Ge[e]={group:A,phase:t,color:s,adsr:i,requestId:null,startTimestamp:$.now(),elapsed:0},Vf(e)}else if(t==="release"){if(fA)return;const A=Ge[e];if(!A)return;cancelAnimationFrame(A.requestId),A.phase="release",A.adsr=i,A.startTimestamp=$.now(),A.elapsed=0,Gf(e)}}}function Vf(e){if(!Ge[e]||fA)return;const t=Ge[e];if(!t.adsr)return;const{attack:s,decay:i}=t.adsr,A=ii.calculateEnvelopePoints(t.adsr);if(A.length<4)return;const[r,a,l]=A,h=$.now()-t.startTimestamp;t.elapsed=h;const u=s+i,m=Math.min(h,u);let g,v;if(m<=s){const x=s>0?m/s:1;g=r.x+x*(a.x-r.x),v=r.y+x*(a.y-r.y)}else{const x=m-s,F=i>0?x/i:1;g=a.x+F*(l.x-a.x),v=a.y+F*(l.y-a.y)}const[y,C]=t.group.children;y.setAttribute("x1",g),y.setAttribute("y1",0),y.setAttribute("x2",g),y.setAttribute("y2",ii.height),C.setAttribute("cx",g),C.setAttribute("cy",v),m<u?t.requestId=requestAnimationFrame(()=>Vf(e)):(t.phase="sustain",Wf(e))}function Wf(e){if(!Ge[e]||fA)return;const t=Ge[e];if(!t.adsr)return;const s=ii.calculateEnvelopePoints(t.adsr);if(s.length<4)return;const[,,i]=s,[A,r]=t.group.children;A.setAttribute("x1",i.x),A.setAttribute("y1",0),A.setAttribute("x2",i.x),A.setAttribute("y2",ii.height),r.setAttribute("cx",i.x),r.setAttribute("cy",i.y),t.requestId=requestAnimationFrame(()=>Wf(e))}function Gf(e){if(!Ge[e]||fA)return;const t=Ge[e];if(!t.adsr)return;const{release:s}=t.adsr,i=ii.calculateEnvelopePoints(t.adsr);if(i.length<4)return;const[,,A,r]=i,a=$.now()-t.startTimestamp;t.elapsed=a;const l=Math.min(a,s),h=s>0?l/s:1,u=A.x+h*(r.x-A.x),m=A.y+h*(r.y-A.y),[g,v]=t.group.children;g.setAttribute("x1",u),g.setAttribute("y1",0),g.setAttribute("x2",u),g.setAttribute("y2",ii.height),v.setAttribute("cx",u),v.setAttribute("cy",m),l<s?t.requestId=requestAnimationFrame(()=>Gf(e)):(t.group.remove(),delete Ge[e])}function JM(){fA=!0;for(const e in Ge){const t=Ge[e];t.requestId&&(cancelAnimationFrame(t.requestId),t.requestId=null)}}function ZM(){fA=!1;for(const e in Ge){const t=Ge[e];t.startTimestamp=$.now()-t.elapsed,t.phase==="attack"?Vf(e):t.phase==="sustain"?Wf(e):t.phase==="release"&&Gf(e)}}function tU(){fA=!1;for(const e in Ge){const t=Ge[e];cancelAnimationFrame(t.requestId),t.group.remove()}for(const e in Ge)delete Ge[e]}function eU(e){return ii=e,{trigger:jM,pause:JM,resume:ZM,clearAll:tU}}const $0=2.5;class sU{constructor(){var t;this.ui=VM.init(),this.currentColor=((t=d.state.selectedNote)==null?void 0:t.color)||"#4a90e2",this.attack=0,this.decay=0,this.sustain=0,this.release=0,this.width=0,this.height=0,this.createSVGLayers(),this.resize(),this.playheadManager=eU(this),Ms.adsrComponent=this,qM(this),this.listenForStoreChanges(),this.initControls(),this.ui.container&&new ResizeObserver(()=>this.resize()).observe(this.ui.container),this.updateFromStore(),this.updateComponentWidth(d.state.adsrComponentWidth),_.info("ADSR Component","Initialized",null,"adsr")}resize(){if(this.ui.container){if(this.width=this.ui.container.clientWidth,this.height=this.ui.container.clientHeight,this.reverbCanvas){const t=window.devicePixelRatio||1;this.reverbCanvas.width=this.width*t,this.reverbCanvas.height=this.height*t,this.reverbCtx.scale(t,t)}this.svgContainer&&this.svgContainer.setAttribute("viewBox",`0 0 ${this.width} ${this.height}`),this.render()}}updateFromStore(){const t=d.state.timbres[this.currentColor];t&&({attack:this.attack,decay:this.decay,sustain:this.sustain,release:this.release}=t.adsr,this.render(),this.updateControls())}getCurrentMaxTime(){return $0*d.state.adsrTimeAxisScale}updateComponentWidth(t){if(this.ui.parentContainer){const i=.5+d.state.adsrTimeAxisScale*.2,A=t*i;this.ui.parentContainer.style.setProperty("width",`${A}%`,"important"),this.resize()}}updateTimeScaleWidth(){const t=d.state.adsrComponentWidth;this.updateComponentWidth(t)}initControls(){const t=document.getElementById("adsr-time-scale"),s=document.getElementById("adsr-time-scale-value");t&&s&&(t.value=d.state.adsrTimeAxisScale,s.textContent=`${d.state.adsrTimeAxisScale}x`,t.addEventListener("input",r=>{const a=parseFloat(r.target.value);d.setAdsrTimeAxisScale(a),s.textContent=`${a}x`}));const i=document.getElementById("adsr-width-scale"),A=document.getElementById("adsr-width-scale-value");i&&A&&(i.value=d.state.adsrComponentWidth,A.textContent=`${d.state.adsrComponentWidth}%`,i.addEventListener("input",r=>{const a=parseInt(r.target.value);d.setAdsrComponentWidth(a),A.textContent=`${a}%`}))}listenForStoreChanges(){d.on("noteChanged",({newNote:t})=>{t.color&&t.color!==this.currentColor&&(this.currentColor=t.color,this.updateFromStore())}),d.on("timbreChanged",t=>{t===this.currentColor&&this.updateFromStore()}),d.on("tempoChanged",()=>this.render()),d.on("adsrTimeAxisScaleChanged",()=>{this.render(),this.updateSliders(),this.updateTimeScaleWidth()}),d.on("adsrComponentWidthChanged",t=>{this.updateComponentWidth(t)}),d.on("tremoloAmplitudeUpdate",({activeColors:t})=>{t&&t.includes(this.currentColor)&&this.render()}),d.on("playbackStateChanged",({isPlaying:t,isPaused:s})=>{t?s?this.playheadManager.pause():this.playheadManager.resume():this.playheadManager.clearAll()}),d.on("audioEffectChanged",({effectType:t,color:s})=>{s===this.currentColor&&(t==="delay"||t==="reverb")&&this.render()})}createSVGLayers(){this.ui.container&&(this.reverbCanvas=document.createElement("canvas"),this.reverbCanvas.className="adsr-reverb-canvas",this.reverbCanvas.style.position="absolute",this.reverbCanvas.style.top="0",this.reverbCanvas.style.left="0",this.reverbCanvas.style.width="100%",this.reverbCanvas.style.height="100%",this.reverbCanvas.style.pointerEvents="none",this.ui.container.appendChild(this.reverbCanvas),this.reverbCtx=this.reverbCanvas.getContext("2d"),this.svgContainer=document.createElementNS("http://www.w3.org/2000/svg","svg"),this.svgContainer.setAttribute("width","100%"),this.svgContainer.setAttribute("height","100%"),this.ui.container.appendChild(this.svgContainer),this.gridLayer=document.createElementNS("http://www.w3.org/2000/svg","g"),this.svgContainer.appendChild(this.gridLayer),this.envelopeLayer=document.createElementNS("http://www.w3.org/2000/svg","g"),this.svgContainer.appendChild(this.envelopeLayer),this.nodeLayer=document.createElementNS("http://www.w3.org/2000/svg","g"),this.svgContainer.appendChild(this.nodeLayer),this.playheadLayer=document.createElementNS("http://www.w3.org/2000/svg","g"),this.svgContainer.appendChild(this.playheadLayer))}calculateEnvelopePoints(t=this){var C;const{attack:s,decay:i,sustain:A,release:r}=t;if(!this.width||!this.height)return[];const a=x=>x/this.getCurrentMaxTime()*this.width;let l=1;window.animationEffectsManager&&window.animationEffectsManager.shouldTremoloBeRunning()&&(l=window.animationEffectsManager.getADSRTremoloAmplitudeMultiplier(this.currentColor));const h=((C=window.staticWaveformVisualizer)==null?void 0:C.calculatedAmplitude)??1,u=h*l;_.debug("AdsrComponent","[ADSR] Amplitude calculation",{originalAmplitude:h,tremoloMultiplier:l,normalizedAmplitude:u});const m={x:0,y:this.height},g={x:a(s),y:this.height*(1-u)},v={x:a(s+i),y:this.height*(1-Math.min(A*u,u))},y={x:a(s+i+r),y:this.height};return[m,g,v,y]}render(){if(!this.ui||!this.width||!this.height)return;const t={width:this.width,height:this.height},s=this.calculateEnvelopePoints(),i=this.getCurrentMaxTime();zM(this.gridLayer,t,i),$M(this.envelopeLayer,this.nodeLayer,s,t,this.currentColor,i,this.reverbCtx),XM(this.ui.parentContainer,this.currentColor)}updateControls(){var x;if(!this.ui.sustainThumb)return;let t=1;window.animationEffectsManager&&window.animationEffectsManager.shouldTremoloBeRunning()&&(t=window.animationEffectsManager.getADSRTremoloAmplitudeMultiplier(this.currentColor));const i=(((x=window.staticWaveformVisualizer)==null?void 0:x.calculatedAmplitude)||1)*t,A=i*100;if(this.sustain>i){const F=d.state.timbres[this.currentColor];d.setADSR(this.currentColor,{...F.adsr,sustain:i}),this.sustain=i}const r=this.sustain*100;this.ui.sustainThumb.style.bottom=`${r}%`,this.ui.sustainTrack.style.setProperty("--sustain-progress",`${r}%`);const a=100-A;this.ui.sustainTrack.style.setProperty("--ineligible-height",`${a}%`);const l=this.attack/this.getCurrentMaxTime()*100,h=(this.attack+this.decay)/this.getCurrentMaxTime()*100,u=(this.attack+this.decay+this.release)/this.getCurrentMaxTime()*100;this.ui.thumbA.style.left=`${l}%`,this.ui.thumbD.style.left=`${h}%`,this.ui.thumbR.style.left=`${u}%`,this.ui.multiSliderContainer.style.setProperty("--adr-progress",`${u}%`);const m=F=>`${F.toFixed(3)}s`,g=F=>`${(F*100).toFixed(0)}%`;this.ui.thumbA.title=`Attack: ${m(this.attack)}`,this.ui.thumbD.title=`Decay: ${m(this.decay)}`,this.ui.thumbR.title=`Release: ${m(this.release)}`,this.ui.sustainThumb.title=`Sustain: ${g(this.sustain)}`;const v=this.nodeLayer.querySelector("#attack-node > title");v&&(v.textContent=`Attack: ${m(this.attack)}`);const y=this.nodeLayer.querySelector("#decay-sustain-node > title");y&&(y.textContent=`Decay: ${m(this.decay)}
Sustain: ${g(this.sustain)}`);const C=this.nodeLayer.querySelector("#release-node > title");C&&(C.textContent=`Release: ${m(this.release)}`)}}function nU(){return document.getElementById("adsr-envelope")?new sU:null}function sf(e,...t){}let hr,wr,Di,vr,wn,ur,rA,nf=!1,Af=!1,rf=!1,Cn;const fc=1,X0=31,Y0=0,pc=2;function Ju(){if(!Cn)return;const e=d.state.timbres[Cn];if(!e)return;e.filter?e.filter.enabled===void 0&&(e.filter.enabled=!0):e.filter={enabled:!0,blend:0,cutoff:16,resonance:0,type:"lowpass",mix:0};const{cutoff:t,blend:s,mix:i}=e.filter;if(hr&&wr){const A=(pc-s)/(pc-Y0);hr.style.left=`${A*100}%`,wr.style.setProperty("--progress",`${A*100}%`)}if(ur&&rA){const A=(i||0)/100;ur.style.bottom=`${A*100}%`,rA.style.setProperty("--blend-progress",`${A*100}%`)}if(Di&&vr){const A=(t-fc)/(X0-fc);Di.style.left=`${A*100}%`,Di.style.top="50%",Di.style.transform="translate(-50%, -50%)",vr.style.setProperty("--progress",`${A*100}%`)}wn&&wn.style.setProperty("--c-accent",Cn)}function iU(e){if(!nf)return;const t=vr.getBoundingClientRect(),s=e.clientX-t.left,i=t.width;let A=s/i;A=Math.max(0,Math.min(1,A));const r=A*(X0-fc)+fc;d.setFilterSettings(Cn,{cutoff:r})}function AU(e){if(!Af)return;const t=wr.getBoundingClientRect(),s=e.clientX-t.left,i=t.width;let A=s/i;A=Math.max(0,Math.min(1,A));const r=pc-A*(pc-Y0);d.setFilterSettings(Cn,{blend:r})}function rU(e){if(!rf)return;const t=rA.getBoundingClientRect(),s=e.clientY-t.top,i=t.height;let A=1-s/i;A=Math.max(0,Math.min(1,A));const r=A*100;d.setFilterSettings(Cn,{mix:r})}function oU(){var t;if(wn=document.querySelector(".filter-container"),hr=document.getElementById("thumb-b"),wr=document.getElementById("blend-slider-container"),Di=document.getElementById("thumb-c"),vr=document.getElementById("cutoff-slider-container"),!wn||!hr||!Di){_.error("FilterControls","Missing required elements",{container:wn,blendThumb:hr,cutoffThumb:Di},"filter");return}const e=wn==null?void 0:wn.querySelector(".blend-slider-container");e&&wr&&(e.getBoundingClientRect(),wr.getBoundingClientRect()),vr&&vr.getBoundingClientRect(),aU(),hr.addEventListener("pointerdown",s=>{s.preventDefault(),Af=!0,document.body.style.cursor="ew-resize";const i=r=>{sf("log","[BLEND SLIDER] Moving",{clientX:r.clientX}),AU(r)},A=()=>{Af=!1,document.body.style.cursor="default",window.removeEventListener("pointermove",i),window.removeEventListener("pointerup",A),d.recordState()};window.addEventListener("pointermove",i),window.addEventListener("pointerup",A)}),Di.addEventListener("pointerdown",s=>{s.preventDefault(),nf=!0,document.body.style.cursor="ew-resize";const i=r=>{sf("log","[CUTOFF SLIDER] Moving",{clientX:r.clientX}),iU(r)},A=()=>{nf=!1,document.body.style.cursor="default",window.removeEventListener("pointermove",i),window.removeEventListener("pointerup",A),d.recordState()};window.addEventListener("pointermove",i),window.addEventListener("pointerup",A)}),d.on("noteChanged",({newNote:s})=>{s.color&&s.color!==Cn&&(Cn=s.color,Ju())}),d.on("timbreChanged",s=>{s===Cn&&Ju()}),Cn=((t=d.state.selectedNote)==null?void 0:t.color)||"#4a90e2",Ju(),setTimeout(()=>{const s=wn==null?void 0:wn.querySelector(".blend-slider-container");s&&s.getBoundingClientRect()},100)}function aU(){if(rA=document.getElementById("vertical-blend-track"),ur=document.getElementById("vertical-blend-thumb"),!rA||!ur){_.error("FilterControls","Vertical blend slider elements not found",null,"filter");return}ur.addEventListener("pointerdown",e=>{e.preventDefault(),rf=!0,document.body.style.cursor="ns-resize";const t=i=>{sf("log","[VERTICAL BLEND] Moving",{clientY:i.clientY}),rU(i)},s=()=>{rf=!1,document.body.style.cursor="default",window.removeEventListener("pointermove",t),window.removeEventListener("pointerup",s),d.recordState()};window.addEventListener("pointermove",t),window.addEventListener("pointerup",s)}),rA.addEventListener("click",e=>{if(e.target===ur)return;const t=rA.getBoundingClientRect(),s=e.clientY-t.top,i=t.height;let A=1-s/i;A=Math.max(0,Math.min(1,A));const r=A*100;d.setFilterSettings(Cn,{mix:r}),d.recordState()})}_.moduleLoaded("DynamicWaveformVisualizer");class lU{constructor(){this.canvas=null,this.ctx=null,this.currentColor=null,this.isPlaybackActive=!1,this.liveAnalysers=new Map,this.liveWaveforms=new Map,this.playbackAnimationId=null,this.animationSpeed=100,this.frameSkipCounter=0,_.info("DynamicWaveformVisualizer","Initialized for live waveform visualization",null,"waveform")}initialize(t,s){var i;return this.canvas=t,this.ctx=s,this.currentColor=((i=d.state.selectedNote)==null?void 0:i.color)||"#4a90e2",this.setupEventListeners(),_.info("DynamicWaveformVisualizer","Initialized with canvas context",null,"waveform"),!0}setupEventListeners(){d.on("noteChanged",({newNote:t})=>{t.color&&t.color!==this.currentColor&&(this.currentColor=t.color)}),d.on("playbackStateChanged",({isPlaying:t,isPaused:s})=>{t&&!s?this.startLiveVisualization():this.stopLiveVisualization()}),d.on("spacebarPlayback",({color:t,isPlaying:s})=>{s?this.startSingleNoteVisualization(t):this.stopLiveVisualization()}),d.on("tremoloAmplitudeUpdate",({activeColors:t})=>{this.isPlaybackActive&&t&&t.some(s=>this.liveWaveforms.has(s))&&_.debug("DynamicWaveformVisualizer","Tremolo update received for active colors",t,"waveform")}),_.info("DynamicWaveformVisualizer","Event subscriptions established",null,"waveform")}setAnimationSpeed(t){this.animationSpeed=t,this.frameSkipCounter=0}startLiveVisualization(){this.isPlaybackActive||(this.isPlaybackActive=!0,this.setupLiveAnalysers(),this.updateContainerState(!0),this.animateLiveWaveforms(),_.debug("DynamicWaveformVisualizer","Started live visualization",null,"waveform"))}startSingleNoteVisualization(t){this.isPlaybackActive||(this.isPlaybackActive=!0,this.setupSingleAnalyser(t),this.updateContainerState(!0),this.animateLiveWaveforms(),_.debug("DynamicWaveformVisualizer",`Started single note visualization for ${t}`,null,"waveform"))}stopLiveVisualization(){this.isPlaybackActive=!1,this.liveAnalysers.forEach((t,s)=>{window.synthEngine&&window.synthEngine.removeWaveformAnalyzer(s)}),this.liveAnalysers.clear(),this.liveWaveforms.clear(),this.playbackAnimationId&&(cancelAnimationFrame(this.playbackAnimationId),this.playbackAnimationId=null),this.updateContainerState(!1),_.debug("DynamicWaveformVisualizer","Stopped live visualization",null,"waveform")}updateContainerState(t){var i;const s=(i=this.canvas)==null?void 0:i.parentElement;s&&(t?(s.classList.add("live-mode"),d.state.isPlaying&&!d.state.isPaused&&s.classList.add("pulsing")):s.classList.remove("live-mode","pulsing"))}setupLiveAnalysers(){const t=window.synthEngine;if(!t){_.warn("DynamicWaveformVisualizer","SynthEngine not available for live analysis",null,"waveform");return}this.getActivePlayingColors().forEach(i=>{const A=t.createWaveformAnalyzer(i);A&&(this.liveAnalysers.set(i,A),this.liveWaveforms.set(i,new Float32Array(1024)),_.debug("DynamicWaveformVisualizer",`Created analyser for ${i}`,null,"waveform"))})}setupSingleAnalyser(t){const s=window.synthEngine;if(!s)return;const i=s.createWaveformAnalyzer(t);i&&(this.liveAnalysers.set(t,i),this.liveWaveforms.set(t,new Float32Array(1024)),_.debug("DynamicWaveformVisualizer",`Created single analyser for ${t}`,null,"waveform"))}getActivePlayingColors(){const t=new Set;d.state.isPlaying&&d.state.placedNotes.forEach(i=>{!i.isDrum&&i.color&&t.add(i.color)}),t.size===0&&this.currentColor&&t.add(this.currentColor);const s=Array.from(t);return _.debug("DynamicWaveformVisualizer","Active playing colors detected",s,"waveform"),s}animateLiveWaveforms(){if(!this.isPlaybackActive)return;this.frameSkipCounter++;const t=Math.floor(100/this.animationSpeed);if(this.frameSkipCounter%t!==0){this.playbackAnimationId=requestAnimationFrame(()=>this.animateLiveWaveforms());return}this.liveAnalysers.forEach((s,i)=>{const A=s.getValue();this.liveWaveforms.set(i,A)}),this.onWaveformUpdate&&this.onWaveformUpdate(),this.playbackAnimationId=requestAnimationFrame(()=>this.animateLiveWaveforms())}drawLiveWaveforms(t,s,i){const A=Array.from(this.liveWaveforms.keys());if(A.length===1){const r=A[0],a=this.liveWaveforms.get(r);this.drawSingleLiveWaveform(a,r,t,s,i)}else A.length>1&&A.forEach(r=>{const a=this.liveWaveforms.get(r);this.drawLayeredLiveWaveform(a,r,t,s,i,A.length)})}drawSingleLiveWaveform(t,s,i,A,r){if(!t||t.length===0)return;let a=r,l=1;window.animationEffectsManager&&s&&(l=window.animationEffectsManager.getTremoloAmplitudeMultiplier(s),a=a*l);let h=0;if(window.animationEffectsManager&&window.animationEffectsManager.vibratoCanvasEffect){const y=window.animationEffectsManager.vibratoCanvasEffect,C=y.animations.get(s);C&&y.shouldBeRunning()&&(h=Math.sin(C.phase)*C.amplitude*.4)}let u=0;for(let y=0;y<t.length;y++)u=Math.max(u,Math.abs(t[y]));const m=u>1?1/u:1;this.ctx.strokeStyle=s,this.ctx.lineWidth=2,this.ctx.beginPath();const v=t.length/i*(1+h);for(let y=0;y<i;y++){const C=h*i*.3,x=y+C,F=Math.floor(x*v),I=Math.max(0,Math.min(t.length-1,F)),T=(t[I]||0)*m,U=A-T*a;y===0?this.ctx.moveTo(y,U):this.ctx.lineTo(y,U)}this.ctx.stroke(),_.debug("DynamicWaveformVisualizer",`Drew single live waveform for ${s} with tremolo and vibrato stretch`,{tremoloMultiplier:a/r,vibratoStretch:h},"waveform")}drawLayeredLiveWaveform(t,s,i,A,r,a){if(!t||t.length===0)return;let l=r;if(window.animationEffectsManager&&s){const x=window.animationEffectsManager.getTremoloAmplitudeMultiplier(s);l=l*x}let h=0;if(window.animationEffectsManager&&window.animationEffectsManager.vibratoCanvasEffect){const x=window.animationEffectsManager.vibratoCanvasEffect,F=x.animations.get(s);F&&x.shouldBeRunning()&&(h=Math.sin(F.phase)*F.amplitude*.4)}let u=0;for(let x=0;x<t.length;x++)u=Math.max(u,Math.abs(t[x]));const m=u>1?1/u:1,g=Math.max(.4,1/a),v=yn(s,g*2);yn(s,g*.5),this.ctx.strokeStyle=v,this.ctx.lineWidth=1.5,this.ctx.beginPath();const C=t.length/i*(1+h);for(let x=0;x<i;x++){const F=h*i*.3,I=x+F,T=Math.floor(I*C),U=Math.max(0,Math.min(t.length-1,T)),D=(t[U]||0)*m,O=A-D*l*.7;x===0?this.ctx.moveTo(x,O):this.ctx.lineTo(x,O)}this.ctx.stroke()}isLiveMode(){return this.isPlaybackActive}getLiveColors(){return Array.from(this.liveWaveforms.keys())}dispose(){this.stopLiveVisualization(),_.info("DynamicWaveformVisualizer","Disposed",null,"waveform")}}_.moduleLoaded("StaticWaveformVisualizer");class cU{constructor(){this.canvas=null,this.ctx=null,this.currentColor=null,this.animationFrameId=null,this.waveformData=new Float32Array(512),this.isInitialized=!1,this.isTransitioning=!1,this.transitionStartTime=0,this.transitionDuration=300,this.fromWaveform=null,this.toWaveform=null,this.transitionAnimationId=null,this.dynamicVisualizer=new lU,this.animationSpeed=100,this.frameSkipCounter=0,_.info("StaticWaveformVisualizer","Initialized with dynamic visualizer integration",null,"waveform")}initialize(){var s;if(this.canvas=document.getElementById("static-waveform-canvas"),!this.canvas)return!1;this.ctx=this.canvas.getContext("2d"),this.currentColor=((s=d.state.selectedNote)==null?void 0:s.color)||"#4a90e2";const t=this.canvas.parentElement;return t&&new ResizeObserver(()=>this.resize()).observe(t),this.resize(),this.setupEventListeners(),this.dynamicVisualizer.initialize(this.canvas,this.ctx),this.dynamicVisualizer.onWaveformUpdate=()=>this.draw(),this.generateWaveform(),this.isInitialized=!0,!0}resize(){if(!this.canvas||!this.ctx)return;const t=this.canvas.parentElement;if(!t)return;const{clientWidth:s,clientHeight:i}=t,A=this.canvas.width,r=this.canvas.height;if((s===0||i===0)&&this.canvas.width>0&&this.canvas.height>0)return;const l=Math.abs(s-A),h=Math.abs(i-r);(l>2||h>2)&&(this.canvas.width=s,this.canvas.height=i,this.draw())}setupEventListeners(){d.on("noteChanged",({newNote:t})=>{t.color&&t.color!==this.currentColor&&(this.currentColor=t.color,this.generateWaveform())}),d.on("timbreChanged",t=>{t===this.currentColor&&this.generateWaveform()}),d.on("waveformExtendedViewChanged",()=>{this.generateWaveform(),this.updateToggleButton()}),document.querySelectorAll(".tab-button").forEach(t=>{t.addEventListener("click",()=>{t.dataset.tab==="timbre"&&setTimeout(()=>{this.resize()},100)})}),this.setupSpeedControls(),this.setupExtendToggle()}setupSpeedControls(){const t=document.querySelectorAll(".waveform-speed-btn");t.forEach(s=>{s.addEventListener("click",()=>{const i=parseInt(s.dataset.speed);s.classList.contains("active")?(s.classList.remove("active"),this.setAnimationSpeed(100)):(t.forEach(A=>A.classList.remove("active")),s.classList.add("active"),this.setAnimationSpeed(i))})})}setAnimationSpeed(t){this.animationSpeed=t,this.frameSkipCounter=0,this.dynamicVisualizer.setAnimationSpeed(t)}setupExtendToggle(){const t=document.getElementById("waveform-extend-toggle");t&&(t.addEventListener("click",()=>{d.toggleWaveformExtendedView()}),this.updateToggleButton())}updateToggleButton(){const t=document.getElementById("waveform-extend-toggle");if(t){const s=d.state.waveformExtendedView;t.classList.toggle("extended",s),t.textContent=s?"480 View":"360 View",t.title=s?"Switch to 360 waveform view":"Switch to 480 waveform view (shows extra 120)"}}generateWaveform(){if(this.isTransitioning||!this.currentColor)return;const t=d.state.timbres[this.currentColor];if(!t||!t.coeffs)return;const s=ac(this.currentColor),i=t.phases||[],A=this.waveformData.length,r=1,a=[];for(let h=0;h<s.length;h++)s[h]>.001&&a.push(`${h===0?"F0":"H"+(h+1)}: ${s[h].toFixed(3)}`);this.waveformData.fill(0);let l=0;for(let h=0;h<A;h++){const m=(d.state.waveformExtendedView?480:360)/360,g=h/A*m*2*Math.PI;let v=0;for(let y=0;y<Cr;y++){const C=s[y]||0;if(C>.001){const x=i[y]||0,F=y+1;v+=C*Math.sin(F*g+x)}}this.waveformData[h]=v*r,l=Math.max(l,Math.abs(v*r))}if(this.calculatedAmplitude=Math.min(1,l),l>1){const h=1/l;for(let u=0;u<this.waveformData.length;u++)this.waveformData[u]*=h}this.draw()}startPhaseTransition(t,s){this.isTransitioning&&this.transitionAnimationId&&cancelAnimationFrame(this.transitionAnimationId),this.fromWaveform=new Float32Array(this.waveformData),this.generateTargetWaveform(s),this.toWaveform=new Float32Array(this.waveformData),this.waveformData=this.fromWaveform,this.isTransitioning=!0,this.transitionStartTime=performance.now(),this.animateTransition()}generateTargetWaveform(t){if(!this.currentColor)return;const s=d.state.timbres[this.currentColor];if(!s||!s.coeffs)return;const i=ac(this.currentColor),A=this.waveformData.length,r=1;this.waveformData.fill(0);let a=0;for(let l=0;l<A;l++){const u=(d.state.waveformExtendedView?480:360)/360,m=l/A*u*2*Math.PI;let g=0;for(let v=0;v<Cr;v++){const y=i[v]||0;if(y>.001){const C=t[v]||0,x=v+1;g+=y*Math.sin(x*m+C)}}this.waveformData[l]=g*r,a=Math.max(a,Math.abs(g*r))}if(this.calculatedAmplitude=Math.min(1,a),a>1){const l=1/a;for(let h=0;h<this.waveformData.length;h++)this.waveformData[h]*=l}}animateTransition(){if(!this.isTransitioning)return;const t=performance.now()-this.transitionStartTime,s=Math.min(t/this.transitionDuration,1),i=1-Math.pow(1-s,3);for(let A=0;A<this.waveformData.length;A++)this.waveformData[A]=this.fromWaveform[A]+(this.toWaveform[A]-this.fromWaveform[A])*i;this.draw(),s>=1?(this.isTransitioning=!1,this.fromWaveform=null,this.toWaveform=null,this.transitionAnimationId=null):this.transitionAnimationId=requestAnimationFrame(()=>this.animateTransition())}normalizeWaveform(){let t=0;for(let s=0;s<this.waveformData.length;s++)t=Math.max(t,Math.abs(this.waveformData[s]));if(t>0){const s=.9/t;for(let i=0;i<this.waveformData.length;i++)this.waveformData[i]*=s}}draw(){if(!this.ctx||!this.canvas)return;const{width:t,height:s}=this.canvas,i=s/2,A=s/2;this.ctx.fillStyle="#FFFFFF",this.ctx.fillRect(0,0,t,s),this.drawGrid(t,s,i,A),this.dynamicVisualizer.isLiveMode()?this.dynamicVisualizer.drawLiveWaveforms(t,i,A):this.drawWaveform(t,i,A),t>200&&s>100&&this.drawLabels(t,s)}drawGrid(t,s,i,A){this.ctx.strokeStyle="#ced4da",this.ctx.lineWidth=1,this.ctx.setLineDash([2,2]),this.ctx.beginPath(),this.ctx.moveTo(0,i),this.ctx.lineTo(t,i),this.ctx.stroke();const r=d.state.waveformExtendedView?480:360;if((d.state.waveformExtendedView?[90,180,270,360,450]:[90,180,270]).forEach(m=>{const g=t/r*m;this.ctx.beginPath(),this.ctx.moveTo(g,0),this.ctx.lineTo(g,s),this.ctx.stroke()}),d.state.waveformExtendedView){const m=t/480*360;this.ctx.fillStyle="rgba(128, 128, 128, 0.15)",this.ctx.fillRect(m,0,t-m,s)}[.5].forEach(m=>{const g=i-A*m,v=i+A*m;this.ctx.beginPath(),this.ctx.moveTo(0,g),this.ctx.lineTo(t,g),this.ctx.moveTo(0,v),this.ctx.lineTo(t,v),this.ctx.stroke()}),this.ctx.setLineDash([]),this.ctx.strokeStyle="#999999",this.ctx.lineWidth=1;const h=i-A,u=i+A;this.ctx.beginPath(),this.ctx.moveTo(0,h),this.ctx.lineTo(t,h),this.ctx.stroke(),this.ctx.beginPath(),this.ctx.moveTo(0,u),this.ctx.lineTo(t,u),this.ctx.stroke()}drawWaveform(t,s,i){if(this.waveformData.length===0)return;const A=this.currentColor||"#4A90E2";this.ctx.strokeStyle=A,this.ctx.lineWidth=2,this.ctx.beginPath();const r=this.waveformData.length/t;for(let l=0;l<t;l++){const h=Math.floor(l*r),u=this.waveformData[h]||0,m=s-u*i;l===0?this.ctx.moveTo(l,m):this.ctx.lineTo(l,m)}this.ctx.stroke(),this.ctx.lineTo(t,s),this.ctx.lineTo(0,s),this.ctx.closePath();const a=this.ctx.createLinearGradient(0,s-i,0,s+i);a.addColorStop(0,yn(A,.3)),a.addColorStop(.5,yn(A,.1)),a.addColorStop(1,yn(A,.3)),this.ctx.fillStyle=a,this.ctx.fill()}drawLabels(t,s){this.ctx.fillStyle="#666666",this.ctx.font='12px -apple-system, BlinkMacSystemFont, "Segoe UI", Roboto, sans-serif',this.ctx.textAlign="center";const i=d.state.waveformExtendedView?480:360,A=d.state.waveformExtendedView?["0","90","180","270","360","450"]:["0","90","180","270","360"],r=d.state.waveformExtendedView?[0,90,180,270,360,450]:[0,90,180,270,360];A.forEach((a,l)=>{const h=t/i*r[l]+10;this.ctx.fillText(a,h,s/2+4)}),this.ctx.textAlign="left",this.ctx.fillText("+1.0",5,15),this.ctx.fillText("-1.0",5,s-8)}getNormalizedAmplitude(){return this.calculatedAmplitude||0}getADSRTremoloAmplitude(){const t=this.calculatedAmplitude||0;if(window.animationEffectsManager&&this.currentColor){const s=window.animationEffectsManager.getADSRTremoloAmplitudeMultiplier(this.currentColor);return t*s}return t}startSingleNoteVisualization(t){return this.dynamicVisualizer.startSingleNoteVisualization(t)}stopLiveVisualization(){return this.dynamicVisualizer.stopLiveVisualization()}startLiveVisualization(){return this.dynamicVisualizer.startLiveVisualization()}dispose(){this.dynamicVisualizer.dispose(),this.animationFrameId&&(cancelAnimationFrame(this.animationFrameId),this.animationFrameId=null),this.transitionAnimationId&&(cancelAnimationFrame(this.transitionAnimationId),this.transitionAnimationId=null),this.isTransitioning=!1,this.fromWaveform=null,this.toWaveform=null,this.isInitialized=!1}}const j0=new cU;window.staticWaveformVisualizer=j0;function hU(){return j0.initialize()}class J0{constructor(t){this.effectName=t,this.animations=new Map,this.activeNoteAnimations=new Map,this.ghostNoteAnimation=null,this.activeSoundingNotes=new Map,this.isPlaybackActive=!1,this.hasActiveInteraction=!1,this.hasDialInteraction=!1,_.info(`${t}AnimationEffect`,"Base initialized",null,"animation")}initBase(){d.on("visualEffectChanged",({effectType:t,parameter:s,value:i,color:A,effectParams:r})=>{t===this.effectName.toLowerCase()&&this.updateAnimationParameters(A,r)}),d.on("playbackStarted",()=>{this.isPlaybackActive=!0,window.animationEffectsManager&&window.animationEffectsManager.updateAnimationState&&window.animationEffectsManager.updateAnimationState()}),d.on("playbackStopped",()=>{this.isPlaybackActive=!1,this.activeNoteAnimations.clear(),this.activeSoundingNotes.clear(),window.animationEffectsManager&&window.animationEffectsManager.updateAnimationState&&window.animationEffectsManager.updateAnimationState()}),d.on("noteInteractionStart",({noteId:t,color:s})=>this.onNoteInteractionStart(t,s)),d.on("noteInteractionEnd",({noteId:t})=>this.onNoteInteractionEnd(t)),d.on("ghostNoteUpdated",({color:t})=>this.onGhostNoteUpdated(t)),d.on("ghostNoteCleared",()=>this.onGhostNoteCleared()),d.on("spacebarPlayback",({color:t,isPlaying:s})=>{s?this.isPlaybackActive=!0:this.isPlaybackActive=!1,window.animationEffectsManager&&window.animationEffectsManager.updateAnimationState&&window.animationEffectsManager.updateAnimationState()}),d.on("noteAttack",({noteId:t,color:s})=>this.onNoteAttack(t,s)),d.on("noteRelease",({noteId:t,color:s})=>this.onNoteRelease(t,s)),d.on("effectDialInteractionStart",({effectType:t,color:s})=>{t===this.effectName.toLowerCase()&&this.onDialInteractionStart(s)}),d.on("effectDialInteractionEnd",({effectType:t,color:s})=>{t===this.effectName.toLowerCase()&&this.onDialInteractionEnd(s)}),_.info(`${this.effectName}AnimationEffect`,"Base event subscriptions established",null,"animation")}updateAnimationParameters(t,s){throw new Error("updateAnimationParameters must be implemented by subclass")}updateAnimationPhases(t){throw new Error("updateAnimationPhases must be implemented by subclass")}shouldAnimateColor(t){return!!this.animations.get(t)}shouldAnimateNote(t){if(!this.shouldAnimateColor(t.color))return!1;if(this.hasDialInteraction&&this.activeNoteAnimations.has("dial-preview")){const i=this.activeNoteAnimations.get("dial-preview");if(t.color===i)return!0}return!!(this.isPlaybackActive&&t.uuid&&this.activeSoundingNotes.has(t.uuid)||this.hasActiveInteraction&&t.uuid&&this.activeNoteAnimations.has(t.uuid)||!t.uuid&&this.ghostNoteAnimation&&this.ghostNoteAnimation.color===t.color&&this.isPlaybackActive)}shouldBeRunning(){const t=this.animations.size>0;return t?this.isPlaybackActive||this.hasActiveInteraction||this.hasDialInteraction||this.ghostNoteAnimation!==null||t:!1}onNoteInteractionStart(t,s){this.shouldAnimateColor(s)&&(this.activeNoteAnimations.set(t,s),this.hasActiveInteraction=!0,_.debug(`${this.effectName}AnimationEffect`,`Started interaction animation for note ${t} (${s})`,null,"animation"),window.animationEffectsManager&&window.animationEffectsManager.updateAnimationState&&window.animationEffectsManager.updateAnimationState())}onNoteInteractionEnd(t){this.activeNoteAnimations.delete(t),this.hasActiveInteraction=this.activeNoteAnimations.size>0,_.debug(`${this.effectName}AnimationEffect`,`Ended interaction animation for note ${t}`,null,"animation"),window.animationEffectsManager&&window.animationEffectsManager.updateAnimationState&&window.animationEffectsManager.updateAnimationState()}onGhostNoteUpdated(t){this.shouldAnimateColor(t)?(this.ghostNoteAnimation={color:t,active:!0},_.debug(`${this.effectName}AnimationEffect`,`Ghost note animation updated for color ${t}`,null,"animation")):this.ghostNoteAnimation=null}onGhostNoteCleared(){this.ghostNoteAnimation=null,_.debug(`${this.effectName}AnimationEffect`,"Ghost note animation cleared",null,"animation")}onNoteAttack(t,s){this.shouldAnimateColor(s)&&(this.activeSoundingNotes.set(t,s),_.debug(`${this.effectName}AnimationEffect`,`Note attack: ${t} (${s}) added to active sounding notes`,null,"animation"),window.animationEffectsManager&&window.animationEffectsManager.updateAnimationState&&window.animationEffectsManager.updateAnimationState())}onNoteRelease(t,s){this.activeSoundingNotes.delete(t),_.debug(`${this.effectName}AnimationEffect`,`Note release: ${t} (${s}) removed from active sounding notes`,null,"animation"),window.animationEffectsManager&&window.animationEffectsManager.updateAnimationState&&window.animationEffectsManager.updateAnimationState()}onDialInteractionStart(t){this.shouldAnimateColor(t)&&(this.hasDialInteraction=!0,this.activeNoteAnimations.set("dial-preview",t),_.debug(`${this.effectName}AnimationEffect`,`Dial interaction started for ${t}`,null,"animation"),window.animationEffectsManager&&window.animationEffectsManager.updateAnimationState&&window.animationEffectsManager.updateAnimationState())}onDialInteractionEnd(t){this.hasDialInteraction=!1,this.activeNoteAnimations.delete("dial-preview"),_.debug(`${this.effectName}AnimationEffect`,`Dial interaction ended for ${t}`,null,"animation"),window.animationEffectsManager&&window.animationEffectsManager.updateAnimationState&&window.animationEffectsManager.updateAnimationState()}getActiveColors(){const t=new Set;for(const[s,i]of this.activeSoundingNotes.entries())this.shouldAnimateColor(i)&&t.add(i);for(const[s,i]of this.activeNoteAnimations.entries())this.shouldAnimateColor(i)&&t.add(i);return this.ghostNoteAnimation&&this.shouldAnimateColor(this.ghostNoteAnimation.color)&&t.add(this.ghostNoteAnimation.color),Array.from(t)}disposeBase(){this.animations.clear(),this.activeNoteAnimations.clear(),this.activeSoundingNotes.clear(),this.ghostNoteAnimation=null,_.info(`${this.effectName}AnimationEffect`,"Base disposed",null,"animation")}}_.moduleLoaded("VibratoCanvasEffect");class uU extends J0{constructor(){super("Vibrato"),_.info("VibratoCanvasEffect","Initialized for canvas note positions",null,"animation")}init(){return this.initBase(),_.info("VibratoCanvasEffect","Ready for canvas animation",null,"animation"),!0}updateAnimationParameters(t,s){const{speed:i,span:A}=s;if(i===0||A===0)this.animations.delete(t),_.debug("VibratoCanvasEffect",`Disabled vibrato animation for ${t}`,null,"animation");else{const r=this.animations.get(t),a=i/100*16,l=A/100*.5,h={frequency:a,amplitude:l,phase:(r==null?void 0:r.phase)||0,lastUpdate:performance.now()};this.animations.set(t,h),_.debug("VibratoCanvasEffect",`Updated vibrato animation for ${t}`,{frequency:a,amplitude:l,preservedPhase:!!r},"animation")}}updateAnimationPhases(t){this.animations.forEach((s,i)=>{const A=(t-s.lastUpdate)/1e3;s.phase+=s.frequency*A*2*Math.PI,s.lastUpdate=t,s.phase>4*Math.PI&&(s.phase-=4*Math.PI)})}getVibratoYOffset(t){const s=this.animations.get(t);if(!s||window.animationEffectsManager&&!window.animationEffectsManager.shouldVibratoBeRunning())return 0;const i=Math.sin(s.phase),A=-i*s.amplitude;return _.debug("VibratoCanvasEffect","Visual vibrato",{sine:i.toFixed(3),offset:A.toFixed(3),phase:s.phase.toFixed(3)},"effects"),A}shouldBeRunning(){return this.animations.size>0?this.isPlaybackActive||this.hasActiveInteraction||this.hasDialInteraction||this.ghostNoteAnimation!==null&&this.isPlaybackActive:!1}shouldAnimateColor(t){const s=this.animations.get(t);return s?s.frequency>0&&s.amplitude>0:!1}dispose(){this.disposeBase(),_.info("VibratoCanvasEffect","Disposed",null,"animation")}}_.moduleLoaded("TremoloWaveformEffect");class dU extends J0{constructor(){super("Tremolo"),_.info("TremoloWaveformEffect","Initialized for waveform/ADSR amplitude",null,"animation")}init(){return this.initBase(),_.info("TremoloWaveformEffect","Ready for waveform/ADSR animation",null,"animation"),!0}updateAnimationParameters(t,s){var r;const{speed:i,span:A}=s;if(i===0||A===0)this.animations.delete(t),_.debug("TremoloWaveformEffect",`Disabled tremolo animation for ${t}`,null,"animation");else{const a=this.animations.get(t),l=i/100*16,h=A/100,u={frequency:l,span:h,phase:(a==null?void 0:a.phase)||0,lastUpdate:(r=window.Tone)!=null&&r.now?window.Tone.now()*1e3:performance.now()};this.animations.set(t,u),_.debug("TremoloWaveformEffect",`Updated tremolo animation for ${t}`,{frequency:l,span:h,preservedPhase:!!a},"animation")}}updateAnimationPhases(t){var A,r,a;let s=0;const i=(A=window.Tone)!=null&&A.now?window.Tone.now()*1e3:t;if(this.animations.forEach((l,h)=>{const u=(i-l.lastUpdate)/1e3,m=l.phase;l.phase+=l.frequency*u*2*Math.PI,l.lastUpdate=i,s++,Math.abs(l.phase-m)<.001&&_.warn("TremoloWaveformEffect",`Phase not advancing for ${h}`,{deltaSeconds:Number(u.toFixed(4)),frequency:l.frequency},"animation"),l.phase>4*Math.PI&&(l.phase-=4*Math.PI)}),s>0&&Math.random()<.05){const l=(r=window.Tone)!=null&&r.now?"Tone.js":"performance";_.debug("TremoloWaveformEffect","Timing sample",{hasTone:!!window.Tone,hasToneNow:!!((a=window.Tone)!=null&&a.now),toneTime:i,currentTime:t,timingSource:l},"animation")}}getTremoloAmplitudeMultiplier(t){var C,x;const s=this.animations.get(t);if(!s||window.animationEffectsManager&&!window.animationEffectsManager.shouldTremoloBeRunning())return 1;const i=((C=window.staticWaveformVisualizer)==null?void 0:C.calculatedAmplitude)||1,A=Math.sin(s.phase),r=s.span,a=i,l=i*(1-r),h=(a+l)/2,u=(a-l)/2,g=(h+A*u)/i,y=(((x=window.Tone)==null?void 0:x.now())*1e3||performance.now())-s.lastUpdate;if(y>100&&s.span>0){const F=s.frequency*(y/1e3)*2*Math.PI;F>.1&&_.warn("TremoloWaveformEffect",`Phase stagnation detected for ${t}`,{phase:Number(s.phase.toFixed(3)),millisecondsSinceUpdate:Number(y.toFixed(1)),expectedAdvancement:Number(F.toFixed(3))},"animation")}return Math.max(0,Math.min(1,g))}getADSRTremoloAmplitudeMultiplier(t){return this.getTremoloAmplitudeMultiplier(t)}shouldAnimateColor(t){const s=this.animations.get(t);return s?s.frequency>0&&s.span>0:!1}dispose(){this.disposeBase(),_.info("TremoloWaveformEffect","Disposed",null,"animation")}}_.moduleLoaded("EnvelopeFillEffect");class fU{constructor(){this.activeFills=new Map,this.instanceId=Math.random().toString(36).substring(7),_.info("EnvelopeFillEffect","Initialized",null,"animation")}init(){d.on("noteAttack",({noteId:t,color:s})=>{const i=d.state.timbres[s];if(!i){_.warn("EnvelopeFillEffect","No timbre found for color",{color:s},"effects");return}this.activeFills.set(t,{fillLevel:0,color:s,startTime:$.now(),adsr:i.adsr,phase:"attack"}),_.debug("EnvelopeFillEffect",`Started fill animation for note ${t}`,null,"animation"),window.animationEffectsManager&&window.animationEffectsManager.updateAnimationState&&window.animationEffectsManager.updateAnimationState()}),d.on("noteRelease",({noteId:t,color:s})=>{const i=this.activeFills.get(t);i?(i.phase="release",i.releaseStartTime=$.now(),i.releaseStartLevel=i.fillLevel,_.debug("EnvelopeFillEffect",`Started release phase for note ${t}`,null,"animation")):_.warn("EnvelopeFillEffect","No fill data found for release",{noteId:t},"effects")}),d.on("playbackStopped",()=>{this.activeFills.clear(),window.animationEffectsManager&&window.animationEffectsManager.updateAnimationState&&window.animationEffectsManager.updateAnimationState(),d.emit("animationUpdate",{type:"envelopeFill",activeColors:[],hasEnvelopeFills:!1})}),_.info("EnvelopeFillEffect","Event subscriptions established",null,"animation")}updateAnimationPhases(t){const s=$.now();for(const[i,A]of this.activeFills.entries()){const{adsr:r,startTime:a,phase:l,releaseStartTime:h,releaseStartLevel:u}=A,m=s-a;if(l==="attack"){const g=r.attack||.01;m<g?A.fillLevel=m/g:(A.phase="decay",A.decayStartTime=s)}else if(l==="decay"){const g=r.decay||.1,v=s-A.decayStartTime,y=r.sustain!==void 0?r.sustain:.5;if(v<g){const C=v/g;A.fillLevel=1-C*(1-y)}else A.phase="sustain",A.fillLevel=y}else if(l==="sustain"){const g=r.sustain!==void 0?r.sustain:.5;A.fillLevel=g}else if(l==="release"){const g=r.release||.5,v=s-h;if(v<g){const y=v/g;A.fillLevel=u*(1-y)}else this.activeFills.delete(i),_.debug("EnvelopeFillEffect",`Completed fill animation for note ${i}`,null,"animation"),this.activeFills.size===0&&window.animationEffectsManager&&window.animationEffectsManager.updateAnimationState&&window.animationEffectsManager.updateAnimationState()}}}getFillLevel(t){if(!t.uuid)return 0;const s=this.activeFills.get(t.uuid);return s?s.fillLevel:0}shouldFillNote(t){return t.uuid?this.activeFills.has(t.uuid):!1}shouldBeRunning(){return this.activeFills.size>0}dispose(){this.activeFills.clear(),_.info("EnvelopeFillEffect","Disposed",null,"animation")}}_.moduleLoaded("AnimationEffectsManager");class pU{constructor(){this.vibratoEffect=new uU,this.tremoloEffect=new dU,this.envelopeFillEffect=new fU,this.isRunning=!1,this.animationFrameId=null,this.lastTime=0,this.lastRenderTrigger=0,_.info("AnimationEffectsManager","Initialized with single animation loop",null,"animation")}init(){return this.vibratoEffect.init(),this.tremoloEffect.init(),this.envelopeFillEffect.init(),d.on("visualEffectChanged",({effectType:t,parameter:s,value:i,color:A})=>{(t==="vibrato"||t==="tremolo")&&(setTimeout(()=>this.updateAnimationState(),0),t==="tremolo"&&setTimeout(()=>this.triggerTremoloAmplitudeUpdate(),0))}),_.info("AnimationEffectsManager","Event subscriptions established",null,"animation"),!0}animate(t){this.isRunning&&(this.lastTime=t,this.vibratoEffect.updateAnimationPhases(t),this.tremoloEffect.updateAnimationPhases(t),this.envelopeFillEffect.updateAnimationPhases(t),this.triggerVisualUpdates(t),this.animationFrameId=requestAnimationFrame(s=>this.animate(s)))}start(){this.isRunning||(this.isRunning=!0,this.lastTime=performance.now(),this.animationFrameId=requestAnimationFrame(t=>this.animate(t)),_.debug("AnimationEffectsManager","Single animation loop started",null,"animation"))}stop(){this.isRunning&&(this.isRunning=!1,this.animationFrameId&&(cancelAnimationFrame(this.animationFrameId),this.animationFrameId=null),this.triggerFinalUpdates(),_.debug("AnimationEffectsManager","Animation loop stopped",null,"animation"))}shouldTremoloBeRunning(){if(!(this.tremoloEffect.animations.size>0))return!1;const s=this.tremoloEffect.activeSoundingNotes.size>0,i=this.tremoloEffect.hasDialInteraction;return s||i}shouldVibratoBeRunning(){return this.vibratoEffect.animations.size>0?this.vibratoEffect.isPlaybackActive||this.vibratoEffect.hasActiveInteraction||this.vibratoEffect.hasDialInteraction||this.vibratoEffect.ghostNoteAnimation!==null:!1}shouldEnvelopeFillBeRunning(){return this.envelopeFillEffect.shouldBeRunning()}updateAnimationState(){const t=this.shouldVibratoBeRunning(),s=this.shouldTremoloBeRunning(),i=this.shouldEnvelopeFillBeRunning(),A=t||s||i;A&&!this.isRunning?this.start():!A&&this.isRunning&&this.stop()}triggerVisualUpdates(t){if(!this.lastRenderTrigger||t-this.lastRenderTrigger>=16.67){this.lastRenderTrigger=t;const s=this.vibratoEffect.getActiveColors(),i=this.tremoloEffect.getActiveColors(),A=this.envelopeFillEffect.activeFills.size>0;(s.length>0||A)&&d.emit("animationUpdate",{type:s.length>0?"vibrato":"envelopeFill",activeColors:s,hasEnvelopeFills:A}),i.length>0&&d.emit("tremoloAmplitudeUpdate",{activeColors:i})}}triggerFinalUpdates(){const t=Array.from(this.vibratoEffect.animations.keys());t.length>0&&d.emit("animationUpdate",{type:"vibrato",activeColors:t});const s=Array.from(this.tremoloEffect.animations.keys());s.length>0&&d.emit("tremoloAmplitudeUpdate",{activeColors:s})}shouldAnimateNote(t){return this.vibratoEffect.shouldAnimateNote(t)}getVibratoYOffset(t){return this.vibratoEffect.getVibratoYOffset(t)}getTremoloAmplitudeMultiplier(t){return this.tremoloEffect.getTremoloAmplitudeMultiplier(t)}getADSRTremoloAmplitudeMultiplier(t){return this.tremoloEffect.getADSRTremoloAmplitudeMultiplier(t)}getFillLevel(t){return this.envelopeFillEffect.getFillLevel(t)}shouldFillNote(t){return this.envelopeFillEffect.shouldFillNote(t)}triggerTremoloAmplitudeUpdate(){const t=this.tremoloEffect.getActiveColors();t.length>0&&d.emit("tremoloAmplitudeUpdate",{activeColors:t})}getAllActiveColors(){const t=this.vibratoEffect.getActiveColors(),s=this.tremoloEffect.getActiveColors();return[...new Set([...t,...s])]}dispose(){this.stop(),this.vibratoEffect.dispose(),this.tremoloEffect.dispose(),this.envelopeFillEffect.dispose(),_.info("AnimationEffectsManager","Disposed",null,"animation")}}const nw=new pU;_.moduleLoaded("VibratoAudioEffect");class mU{constructor(){this.currentSettings=new Map,_.info("VibratoAudioEffect","Initialized",null,"audio")}init(){return _.info("VibratoAudioEffect","Ready for audio processing",null,"audio"),!0}updateParameters(t,s){const{speed:i,span:A}=t;this.currentSettings.set(s,{speed:i,span:A}),_.debug("VibratoAudioEffect",`Updated parameters for ${s}`,{speed:i,span:A},"audio")}applyToVoice(t,s){if(!t||!t._setVibrato)return;const i=this.currentSettings.get(s);if(!i){_.debug("VibratoAudioEffect",`No vibrato settings found for color ${s}`,null,"audio");return}try{t._setVibrato(i),t.vibratoApplied=!0,_.debug("VibratoAudioEffect",`Applied vibrato to voice for ${s}`,i,"audio")}catch(A){_.warn("VibratoAudioEffect",`Failed to apply vibrato to voice for ${s}`,A,"audio")}}getCurrentSettings(t){return this.currentSettings.get(t)||{speed:0,span:0}}getEffectInstance(){return null}createVibratoSettings(t,s){if(t===0||s===0)return null;const i=t/100*16,A=s/100*50;return{frequency:i,depth:A}}disableForColor(t){this.updateParameters({speed:0,span:0},t)}dispose(){this.currentSettings.clear(),_.info("VibratoAudioEffect","Disposed",null,"audio")}}_.moduleLoaded("TremoloAudioEffect");class gU{constructor(){this.currentSettings=new Map,_.info("TremoloAudioEffect","Initialized",null,"audio")}init(){return _.info("TremoloAudioEffect","Ready for audio processing",null,"audio"),!0}updateParameters(t,s){const{speed:i,span:A}=t;this.currentSettings.set(s,{speed:i,span:A}),_.debug("TremoloAudioEffect",`Updated parameters for ${s}`,{speed:i,span:A},"audio")}applyToVoice(t,s){if(!t||!t._setTremolo)return;const i=this.currentSettings.get(s);if(!i){_.debug("TremoloAudioEffect",`No tremolo settings found for color ${s}`,null,"audio");return}try{t._setTremolo(i),t.tremoloApplied=!0,_.debug("TremoloAudioEffect",`Applied tremolo to voice for ${s}`,i,"audio")}catch(A){_.warn("TremoloAudioEffect",`Failed to apply tremolo to voice for ${s}`,A,"audio")}}getCurrentSettings(t){return this.currentSettings.get(t)||{speed:0,span:0}}getEffectInstance(){return null}createTremoloSettings(t,s){if(t===0||s===0)return null;const i=t/100*16,A=s/100;return{frequency:i,depth:A}}disableForColor(t){this.updateParameters({speed:0,span:0},t)}dispose(){this.currentSettings.clear(),_.info("TremoloAudioEffect","Disposed",null,"audio")}}_.moduleLoaded("ReverbAudioEffect");class wU{constructor(){this.currentSettings=new Map,this.reverbInstances=new Map,_.info("ReverbAudioEffect","Initialized",null,"audio")}init(){return _.info("ReverbAudioEffect","Ready for audio processing",null,"audio"),!0}async updateParameters(t,s){const{decay:i,roomSize:A,wet:r=10}=t;this.currentSettings.set(s,{decay:i,roomSize:A,wet:r}),_.debug("ReverbAudioEffect",`Updated parameters for ${s}`,{decay:i,roomSize:A,wet:r},"audio");let a=this.reverbInstances.get(s);a?this.updateReverbInstance(a,i,A,r):(i>0||A>0)&&(a=await this.createReverbInstance(i,A,r),a&&(this.reverbInstances.set(s,a),_.debug("ReverbAudioEffect",`Created new reverb instance for ${s}`,{decay:i,roomSize:A,wet:r},"audio"),window.synthEngine&&window.synthEngine.updateSynthForColor(s)))}async applyToVoice(t,s){if(!t)return;const i=this.currentSettings.get(s);if(!(!i||i.decay===0&&i.roomSize===0))try{let A=this.reverbInstances.get(s);if(A||(A=await this.createReverbInstance(i.decay,i.roomSize,i.wet),this.reverbInstances.set(s,A)),t&&t.output&&(typeof t.isDisposed!="function"||!t.isDisposed()))try{t.connect(A)}catch{t.output&&t.output.connect(A)}_.debug("ReverbAudioEffect",`Applied reverb to voice for ${s}`,i,"audio")}catch(A){_.warn("ReverbAudioEffect",`Failed to apply reverb to voice for ${s}`,A,"audio")}}getCurrentSettings(t){return this.currentSettings.get(t)||{decay:0,roomSize:0}}getEffectInstance(t){return this.getCurrentSettings(t).wet>0?this.reverbInstances.get(t):null}async createReverbInstance(t,s,i=10){if(t===0&&s===0)return null;const A=Math.max(.1,t/100*8),r=1+s/100*1.5,a=A*r,l=i/100,h=new $.Reverb({decay:a,wet:l});return h._wetAmount=l,await h.ready,_.debug("ReverbAudioEffect","Created reverb instance",{decayTime:a,wetAmount:l,roomSize:s},"audio"),h}updateReverbInstance(t,s,i,A=10){if(t)try{const r=Math.max(.1,s/100*8),a=1+i/100*1.5,l=r*a,h=A/100;t.decay=l,t._crossFade&&(t._crossFade.fade.value=h),t._wetAmount=h,_.debug("ReverbAudioEffect","Updated reverb instance",{decayTime:l,wetAmount:h,roomSize:i},"audio")}catch(r){_.warn("ReverbAudioEffect","Failed to update reverb instance",r,"audio")}}createReverbSettings(t,s,i=25){if(t===0&&s===0)return null;const A=Math.max(.1,t/100*10),r=i/100;return{decay:A,roomSize:s/100,wet:r}}disableForColor(t){this.updateParameters({decay:0,roomSize:0,wet:0},t);const s=this.reverbInstances.get(t);s&&(s._crossFade&&s._crossFade.dispose(),s.dispose(),this.reverbInstances.delete(t))}dispose(){this.reverbInstances.forEach((t,s)=>{try{t._crossFade&&t._crossFade.dispose(),t.dispose()}catch(i){_.warn("ReverbAudioEffect",`Failed to dispose reverb for ${s}`,i,"audio")}}),this.currentSettings.clear(),this.reverbInstances.clear(),_.info("ReverbAudioEffect","Disposed",null,"audio")}}_.moduleLoaded("DelayAudioEffect");class vU{constructor(){this.currentSettings=new Map,this.delayInstances=new Map,_.info("DelayAudioEffect","Initialized",null,"audio")}init(){return _.info("DelayAudioEffect","Ready for audio processing",null,"audio"),!0}updateParameters(t,s){const{time:i,feedback:A,wet:r=15}=t;this.currentSettings.set(s,{time:i,feedback:A,wet:r}),_.debug("DelayAudioEffect",`Updated parameters for ${s}`,{time:i,feedback:A,wet:r},"audio");let a=this.delayInstances.get(s);a?this.updateDelayInstance(a,i,A,r):(i>0||A>0)&&(a=this.createDelayInstance(i,A,r),a&&(this.delayInstances.set(s,a),_.debug("DelayAudioEffect",`Created new delay instance for ${s}`,{time:i,feedback:A,wet:r},"audio"),window.synthEngine&&window.synthEngine.updateSynthForColor(s)))}applyToVoice(t,s){if(!t)return;const i=this.currentSettings.get(s);if(!(!i||i.time===0&&i.feedback===0))try{let A=this.delayInstances.get(s);if(A||(A=this.createDelayInstance(i.time,i.feedback,i.wet),this.delayInstances.set(s,A)),t&&t.output&&(typeof t.isDisposed!="function"||!t.isDisposed()))try{t.connect(A)}catch{t.output&&t.output.connect(A)}_.debug("DelayAudioEffect",`Applied delay to voice for ${s}`,i,"audio")}catch(A){_.warn("DelayAudioEffect",`Failed to apply delay to voice for ${s}`,A,"audio")}}getCurrentSettings(t){return this.currentSettings.get(t)||{time:0,feedback:0}}getEffectInstance(t){const s=this.getCurrentSettings(t);return s.time>0&&s.wet>0?this.delayInstances.get(t):null}createDelayInstance(t,s,i=30){if(t===0&&s===0)return null;const A=Math.max(.01,t/100*.5),r=Math.min(.95,s/100),a=i/100,l=new $.FeedbackDelay({delayTime:A,feedback:r,wet:a});return l._wetAmount=a,_.debug("DelayAudioEffect","Created delay instance",{delayTime:A,feedbackAmount:r,wetAmount:a},"audio"),l}updateDelayInstance(t,s,i,A=15){if(t)try{const r=Math.max(.01,s/100*.5),a=Math.min(.95,i/100),l=A/100;t.delayTime.value=r,t.feedback.value=a,t._crossFade&&(t._crossFade.fade.value=l),t._wetAmount=l,_.debug("DelayAudioEffect","Updated delay instance",{delayTime:r,feedbackAmount:a,wetAmount:l},"audio")}catch(r){_.warn("DelayAudioEffect","Failed to update delay instance",r,"audio")}}createDelaySettings(t,s,i=30){if(t===0&&s===0)return null;const A=Math.max(.01,t/100*.5),r=Math.min(.95,s/100),a=i/100;return{delayTime:A,feedback:r,wet:a}}disableForColor(t){this.updateParameters({time:0,feedback:0,wet:0},t);const s=this.delayInstances.get(t);s&&(s._crossFade&&s._crossFade.dispose(),s.dispose(),this.delayInstances.delete(t))}dispose(){this.delayInstances.forEach((t,s)=>{try{t._crossFade&&t._crossFade.dispose(),t.dispose()}catch(i){_.warn("DelayAudioEffect",`Failed to dispose delay for ${s}`,i,"audio")}}),this.currentSettings.clear(),this.delayInstances.clear(),_.info("DelayAudioEffect","Disposed",null,"audio")}}_.moduleLoaded("AudioEffectsManager");class BU{constructor(){this.vibratoEffect=new mU,this.tremoloEffect=new gU,this.reverbEffect=new wU,this.delayEffect=new vU,_.info("AudioEffectsManager","Initialized with audio effect handlers",null,"audio")}init(){return this.vibratoEffect.init(),this.tremoloEffect.init(),this.reverbEffect.init(),this.delayEffect.init(),d.on("audioEffectChanged",({effectType:t,parameter:s,value:i,color:A,effectParams:r})=>{this.handleAudioEffectChange(t,s,i,A,r)}),_.info("AudioEffectsManager","Event subscriptions established",null,"audio"),!0}handleAudioEffectChange(t,s,i,A,r){switch(_.debug("AudioEffectsManager",`Processing audio effect: ${t}.${s} = ${i} for ${A}`,null,"audio"),t){case"vibrato":this.vibratoEffect.updateParameters(r,A);break;case"tremolo":this.tremoloEffect.updateParameters(r,A);break;case"reverb":this.reverbEffect.updateParameters(r,A);break;case"delay":this.delayEffect.updateParameters(r,A);break;default:_.debug("AudioEffectsManager",`Effect type ${t} not handled by audio system`,null,"audio")}}getEffectHandler(t){switch(t){case"vibrato":return this.vibratoEffect;case"tremolo":return this.tremoloEffect;case"reverb":return this.reverbEffect;case"delay":return this.delayEffect;default:return null}}applySynthEffects(t,s,i){const A=this.reverbEffect.getEffectInstance(s),r=this.delayEffect.getEffectInstance(s);this.reverbEffect.getCurrentSettings(s),this.delayEffect.getCurrentSettings(s);try{t.disconnect()}catch{}let a=t;if(A)try{A.disconnect(),a.connect(A),a=A}catch{}if(r)try{r.disconnect(),a.connect(r),a=r}catch{}try{if(a.connect(i),window.synthEngine){const l=window.synthEngine.getWaveformAnalyzer(s);l&&t.connect(l)}}catch{}}applyEffectsToVoice(t,s){this.vibratoEffect.applyToVoice(t,s),this.tremoloEffect.applyToVoice(t,s)}dispose(){this.vibratoEffect.dispose(),this.tremoloEffect.dispose(),this.reverbEffect.dispose(),this.delayEffect.dispose(),_.info("AudioEffectsManager","Disposed",null,"audio")}}const iw=new BU;_.moduleLoaded("EffectsCoordinator");class yU{constructor(){this.effectParameters=new Map,this.defaultEffects={vibrato:{speed:0,span:0},tremolo:{speed:0,span:0},reverb:{decay:0,roomSize:0},delay:{time:0,feedback:0}},_.info("EffectsCoordinator","Initialized as main coordinator",null,"effects")}init(){return Object.keys(d.state.timbres).forEach(t=>{this.initializeColorEffects(t)}),d.on("timbreCreated",({color:t})=>{this.initializeColorEffects(t)}),this.loadSavedValues(),_.info("EffectsCoordinator","Event subscriptions established",null,"effects"),!0}initializeColorEffects(t){if(!this.effectParameters.has(t)){const s={};Object.entries(this.defaultEffects).forEach(([A,r])=>{s[A]={...r}}),this.effectParameters.set(t,s);const i=d.state.timbres[t];i&&(i.vibrato&&(s.vibrato={...i.vibrato}),i.tremelo&&(s.tremolo={...i.tremelo})),_.debug("EffectsCoordinator",`Initialized effects for color ${t}`,s,"effects")}}updateParameter(t,s,i,A){if(!A){_.warn("EffectsCoordinator","Cannot update parameter: no color provided",{effectType:t,parameter:s,value:i},"effects");return}this.initializeColorEffects(A);const r=this.effectParameters.get(A);r[t]||(r[t]={...this.defaultEffects[t]}),r[t][s]=i,this.notifyAudioSystem(t,s,i,A,r[t]),this.notifyAnimationSystem(t,s,i,A,r[t]),this.updateTimbreState(t,r[t],A),this.saveValues()}notifyAudioSystem(t,s,i,A,r){d.emit("audioEffectChanged",{effectType:t,parameter:s,value:i,color:A,effectParams:{...r}}),_.debug("EffectsCoordinator",`Notified audio system: ${t}.${s} = ${i} for ${A}`,null,"effects")}notifyAnimationSystem(t,s,i,A,r){(t==="vibrato"||t==="tremolo")&&(d.emit("visualEffectChanged",{effectType:t,parameter:s,value:i,color:A,effectParams:{...r}}),_.debug("EffectsCoordinator",`Notified animation system: ${t}.${s} = ${i} for ${A}`,null,"effects"))}updateTimbreState(t,s,i){const A=d.state.timbres[i];if(!A)return;const a={vibrato:"vibrato",tremolo:"tremelo"}[t];a&&(A[a]||(A[a]={}),Object.assign(A[a],s),d.recordState())}getEffectParameters(t,s){const i=this.effectParameters.get(t);return!i||!i[s]?{...this.defaultEffects[s]}:{...i[s]}}getAllEffectParameters(t){const s=this.effectParameters.get(t);return s?{...s}:{...this.defaultEffects}}resetColorEffects(t){const s={};Object.entries(this.defaultEffects).forEach(([i,A])=>{s[i]={...A}}),this.effectParameters.set(t,s),Object.keys(s).forEach(i=>{Object.keys(s[i]).forEach(A=>{this.notifyAudioSystem(i,A,s[i][A],t,s[i]),this.notifyAnimationSystem(i,A,s[i][A],t,s[i])})}),_.info("EffectsCoordinator",`Reset all effects for color ${t}`,s,"effects")}saveValues(){const t={};Object.keys(d.state.timbres).forEach(s=>{const i=this.effectParameters.get(s);i&&(t[s]={vibrato:i.vibrato||{speed:0,span:0},tremelo:i.tremolo||{speed:0,span:0},reverb:i.reverb||{decay:0,roomSize:0},delay:i.delay||{time:0,feedback:0}})});try{localStorage.setItem("effectDialValues",JSON.stringify(t)),_.debug("EffectsCoordinator","Saved effect values to localStorage",null,"effects")}catch(s){_.warn("EffectsCoordinator","Failed to save effect values to localStorage",s,"effects")}}loadSavedValues(){try{const t=localStorage.getItem("effectDialValues");if(!t){_.debug("EffectsCoordinator","No saved effect values found",null,"effects");return}const s=JSON.parse(t);_.debug("EffectsCoordinator","Loading saved effect values",null,"effects"),Object.keys(s).forEach(i=>{const A=d.state.timbres[i],r=s[i];A&&r&&(r.vibrato&&Object.entries(r.vibrato).forEach(([a,l])=>{typeof l=="number"&&this.updateParameter("vibrato",a,l,i)}),r.tremelo&&Object.entries(r.tremelo).forEach(([a,l])=>{typeof l=="number"&&this.updateParameter("tremolo",a,l,i)}),r.reverb&&Object.entries(r.reverb).forEach(([a,l])=>{typeof l=="number"&&this.updateParameter("reverb",a,l,i)}),r.delay&&Object.entries(r.delay).forEach(([a,l])=>{typeof l=="number"&&this.updateParameter("delay",a,l,i)}))}),_.info("EffectsCoordinator","Applied saved effect values",null,"effects"),window.synthEngine&&Object.keys(s).forEach(i=>{const A=s[i];(A.reverb&&(A.reverb.decay>0||A.reverb.roomSize>0)||A.delay&&(A.delay.time>0||A.delay.feedback>0))&&(window.synthEngine.updateSynthForColor(i),_.debug("EffectsCoordinator",`Re-applied effects to synth for ${i}`,null,"effects"))})}catch(t){_.warn("EffectsCoordinator","Failed to load saved effect values",t,"effects")}}dispose(){this.effectParameters.clear(),_.info("EffectsCoordinator","Disposed",null,"effects")}}const qo=new yU;class CU{constructor(){this.currentEffect=null,this.effectControlsContainer=null,this.effectButtons=[],this.dials=[],this.currentColor=null,this.isDialInteractionActive=!1,this.effectConfigs={reverb:{name:"Reverb",controls:{decay:{label:"Time",min:0,max:100,default:0,unit:"%"},roomSize:{label:"Size",min:0,max:100,default:0,unit:"%"},wet:{label:"Mix",min:0,max:100,default:10,unit:"%"}}},delay:{name:"Delay",controls:{time:{label:"Time",min:0,max:100,default:0,unit:"%"},feedback:{label:"Echoes",min:0,max:95,default:0,unit:"%"},wet:{label:"Mix",min:0,max:100,default:15,unit:"%"}}},vibrato:{name:"Vibrato",controls:{speed:{label:"Speed",min:0,max:100,default:0,unit:"%"},span:{label:"Span",min:0,max:100,default:0,unit:"%"}}},tremolo:{name:"Tremolo",controls:{speed:{label:"Speed",min:0,max:100,default:0,unit:"%"},span:{label:"Span",min:0,max:100,default:0,unit:"%"}}}}}init(){return _.initStart("Effects Controller"),this.effectControlsContainer=document.getElementById("effect-controls"),this.effectButtons=document.querySelectorAll(".effect-button[data-effect]"),!this.effectControlsContainer||this.effectButtons.length===0?(_.initFailed("Effects Controller","Required DOM elements not found"),!1):(this.setupEventListeners(),this.initializeSelectedColorTracking(),this.setupGlobalMouseUpHandler(),_.initSuccess("Effects Controller"),!0)}setupGlobalMouseUpHandler(){document.addEventListener("mouseup",()=>{this.isDialInteractionActive&&this.onDialInteractionEnd(this.currentEffect)})}setupEventListeners(){this.effectButtons.forEach(t=>{t.addEventListener("click",s=>{const i=s.target.dataset.effect;this.selectEffect(i)})})}selectEffect(t){if(_.debug("Effects",`Selecting effect: ${t}`,null,"ui"),!this.effectConfigs[t]){_.info("Effects",`Effect ${t} not configured`,null,"ui");return}if(this.effectButtons.forEach(s=>{s.classList.remove("active"),s.dataset.effect===t&&s.classList.add("active")}),this.currentEffect===t){this.currentEffect=null,this.hideEffectControls();return}this.currentEffect=t,this.showEffectControls(t)}showEffectControls(t){const s=this.effectConfigs[t];if(!s){_.warn("Effects",`No configuration found for effect: ${t}`,null,"ui");return}this.clearControls(),this.effectControlsContainer.innerHTML='<div class="effect-controls"></div>';const i=this.effectControlsContainer.querySelector(".effect-controls");Object.entries(s.controls).forEach(([A,r])=>{const a=this.currentColor?qo.getEffectParameters(this.currentColor,t):null,l=(a==null?void 0:a[A])||0,h=document.createElement("div");h.className="effect-slider-group",h.style.cssText="margin-bottom: 15px; padding: 10px; border: 1px solid #ccc; border-radius: 5px;",i.appendChild(h);const u=document.createElement("label");u.className="effect-slider-label",u.textContent=r.label,u.style.cssText="display: block; margin-bottom: 5px; font-weight: bold; color: #333;",h.appendChild(u);const m=document.createElement("input");m.type="range",m.min=r.min,m.max=r.max,m.value=l,m.className="effect-slider",m.style.cssText="width: 100%; margin: 5px 0;",h.appendChild(m);const g=document.createElement("div");g.className="effect-slider-value";const v=r.unit?`${Math.round(l)}${r.unit}`:Math.round(l);g.textContent=v,g.style.cssText="text-align: center; font-size: 12px; color: #666;",h.appendChild(g),this.dials.push({dial:{element:m,value:l,destroy:()=>{}},control:A,effectType:t,valueDisplay:g,controlConfig:r});const y=C=>{const x=parseFloat(C.target.value),F=r.unit?`${Math.round(x)}${r.unit}`:Math.round(x);g.textContent=F,_.debug("Effects",`${t} ${A}: ${x}`,null,"audio"),this.onEffectParameterChange(t,A,x)};m.addEventListener("mousedown",C=>{this.onDialInteractionStart(t)}),m.addEventListener("mouseup",C=>{this.onDialInteractionEnd(t)}),m.addEventListener("mouseleave",C=>{C.buttons}),m.addEventListener("touchstart",C=>{this.onDialInteractionStart(t)}),m.addEventListener("touchend",C=>{this.onDialInteractionEnd(t)}),m.addEventListener("input",y),m.addEventListener("change",y)}),this.effectControlsContainer.classList.add("active")}hideEffectControls(){this.clearControls(),this.effectControlsContainer.classList.remove("active"),this.effectControlsContainer.innerHTML="",this.effectButtons.forEach(t=>t.classList.remove("active"))}clearControls(){this.dials.forEach(({dial:t})=>{t.destroy&&t.destroy()}),this.dials=[]}onEffectParameterChange(t,s,i){var r;_.debug("Effects",`Effect parameter changed: ${t}.${s} = ${i}`,null,"audio");const A=(r=d.state.selectedNote)==null?void 0:r.color;if(!A){_.warn("Effects","Cannot update effect parameter: no color selected",{effectType:t,parameter:s,value:i},"audio");return}qo.updateParameter(t,s,i,A),d.emit("effectParameterChanged",{effectType:t,parameter:s,value:i,color:A})}onDialInteractionStart(t){var i;if(this.isDialInteractionActive||t!=="vibrato"&&t!=="tremolo")return;this.isDialInteractionActive=!0;const s=(i=d.state.selectedNote)==null?void 0:i.color;if(!s){_.debug("Effects","Dial interaction started but no color selected",null,"ui");return}d.emit("effectDialInteractionStart",{effectType:t,color:s}),_.debug("Effects",`Dial interaction started for ${t} on ${s}`,null,"ui")}onDialInteractionEnd(t){var i;if(!this.isDialInteractionActive)return;this.isDialInteractionActive=!1;const s=(i=d.state.selectedNote)==null?void 0:i.color;s&&(d.emit("effectDialInteractionEnd",{effectType:t,color:s}),_.debug("Effects",`Dial interaction ended for ${t} on ${s}`,null,"ui"))}getCurrentEffect(){return this.currentEffect}getEffectParameters(t){var A;if(!this.effectConfigs[t])return null;const s=(A=d.state.selectedNote)==null?void 0:A.color;if(!s)return null;if(window.effectsCoordinator)return window.effectsCoordinator.getEffectParameters(s,t);const i={};return this.dials.forEach(({dial:r,control:a,effectType:l})=>{l===t&&(i[a]=parseFloat(r.element.value))}),i}initializeSelectedColorTracking(){var t;this.currentColor=(t=d.state.selectedNote)==null?void 0:t.color,d.on("selectedNoteChanged",()=>{var i;const s=(i=d.state.selectedNote)==null?void 0:i.color;s!==this.currentColor&&(this.currentColor=s,this.updateEffectButtonIndicators())}),d.on("audioEffectChanged",()=>{this.updateEffectButtonIndicators()}),this.updateEffectButtonIndicators()}updateEffectButtonIndicators(){!this.effectButtons||!this.currentColor||this.effectButtons.forEach(t=>{const s=t.getAttribute("data-effect");let i=!1;const A=qo.getEffectParameters(this.currentColor,s);switch(s){case"vibrato":i=A.speed>0&&A.span>0;break;case"tremolo":i=A.speed>0&&A.span>0;break;case"reverb":i=A.roomSize>0||A.decay>0||A.wet>0&&(A.roomSize>0||A.decay>0);break;case"delay":i=A.time>0||A.feedback>0||A.wet>0&&(A.time>0||A.feedback>0);break}i?(t.style.backgroundColor=this.currentColor,t.style.color="white",t.classList.add("effect-active")):(t.style.backgroundColor="",t.style.color="",t.classList.remove("effect-active"))})}}const Si=new CU;class bU{constructor(t,s={}){if(this._root=typeof t=="string"?document.querySelector(t):t,!this._root)throw new Error("Position: target not found");const{size:i=[200,200],mode:A="absolute",x:r=.5,minX:a=0,maxX:l=1,stepX:h=0,y:u=.5,minY:m=0,maxY:g=1,stepY:v=0}=s;this._events=new Map,this._emit=(I,T)=>{const U=this._events.get(I);if(U)for(const D of U)D(T)};class y{constructor(T,U,D,O){this.min=T,this.max=U,this.step=D,this.value=0,this.update(O)}update(T){const U=Math.min(this.max,Math.max(this.min,T));if(!this.step||this.step<=0)return this.value=U,this.value;const D=Math.round((U-this.min)/this.step)*this.step+this.min;return this.value=Math.min(this.max,Math.max(this.min,parseFloat(D.toFixed(12)))),this.value}updateNormal(T){const U=this.max-this.min||1;return this.update(this.min+U*Math.min(1,Math.max(0,T)))}get normalized(){const T=this.max-this.min||1;return(this.value-this.min)/T}}class C{constructor(T,U,D,O){this.mode=T,this.orient=U,this._xr=D.slice(),this._yr=O.slice(),this.value=.5,this._anchorN=.5}resize(T,U){this._xr=T.slice(),this._yr=U.slice()}set anchor(T){this._anchorN=this._posToNorm(T)}update(T){if(this.mode==="absolute")this.value=this._posToNorm(T);else{const U=this._posToNorm(T),D=U-this._anchorN;this.value=x(this.value+D),this._anchorN=U}this.value=x(this.value)}_posToNorm(T){if(this.orient==="horizontal"){const U=this._xr[1]-this._xr[0]||1;return x((T.x-this._xr[0])/U)}else{const U=this._yr[1]-this._yr[0]||1;return x(1-(T.y-this._yr[0])/U)}}}const x=I=>Math.min(1,Math.max(0,I));this._x=new y(a,l,h,r),this._y=new y(m,g,v,u),this._w=Math.max(10,Math.floor(i[0])),this._h=Math.max(10,Math.floor(i[1])),this._mode=A==="relative"?"relative":"absolute",this._hX=new C(this._mode,"horizontal",[0,this._w],[0,this._h]),this._hY=new C(this._mode,"vertical",[0,this._w],[0,this._h]),this._hX.value=this._x.normalized,this._hY.value=this._y.normalized,this._style={bg:"rgba(74, 144, 226, 0.1)",grid:"#dee2e6",cross:"#6c757d",handle:"#4A90E2",text:"#212529"},this._svg=document.createElementNS("http://www.w3.org/2000/svg","svg"),this._svg.setAttribute("width",this._w),this._svg.setAttribute("height",this._h),this._svg.setAttribute("viewBox",`0 0 ${this._w} ${this._h}`),this._svg.style.display="block",this._svg.style.touchAction="none",this._root.innerHTML="",this._root.appendChild(this._svg),this._bg=document.createElementNS(this._svg.namespaceURI,"rect"),this._bg.setAttribute("x",0),this._bg.setAttribute("y",0),this._bg.setAttribute("width",this._w),this._bg.setAttribute("height",this._h),this._bg.setAttribute("fill",this._style.bg),this._svg.appendChild(this._bg),this._grid=document.createElementNS(this._svg.namespaceURI,"g"),this._grid.setAttribute("stroke",this._style.grid),this._grid.setAttribute("stroke-width","1");const F=[.25,.5,.75];for(const I of F){const T=document.createElementNS(this._svg.namespaceURI,"line");T.setAttribute("x1",this._w*I),T.setAttribute("y1",0),T.setAttribute("x2",this._w*I),T.setAttribute("y2",this._h),this._grid.appendChild(T);const U=document.createElementNS(this._svg.namespaceURI,"line");U.setAttribute("x1",0),U.setAttribute("y1",this._h*I),U.setAttribute("x2",this._w),U.setAttribute("y2",this._h*I),this._grid.appendChild(U)}this._svg.appendChild(this._grid),this._xh=document.createElementNS(this._svg.namespaceURI,"line"),this._yh=document.createElementNS(this._svg.namespaceURI,"line");for(const I of[this._xh,this._yh])I.setAttribute("stroke",this._style.cross),I.setAttribute("stroke-width","2"),this._svg.appendChild(I);this._knob=document.createElementNS(this._svg.namespaceURI,"circle"),this._knob.setAttribute("r",Math.max(4,Math.min(this._w,this._h)*.04)),this._knob.setAttribute("fill",this._style.handle),this._svg.appendChild(this._knob),this._clicked=!1,this._onDown=this._onDown.bind(this),this._onMove=this._onMove.bind(this),this._onUp=this._onUp.bind(this),this._svg.addEventListener("pointerdown",this._onDown),window.addEventListener("pointerup",this._onUp),window.addEventListener("pointercancel",this._onUp),this._draw()}on(t,s){return this._events.has(t)||this._events.set(t,new Set),this._events.get(t).add(s),()=>this.off(t,s)}off(t,s){const i=this._events.get(t);i&&i.delete(s)}get x(){return this._x.value}set x(t){const s=this._x.value;this._x.update(t),this._hX.value=this._x.normalized,this._x.value!==s&&(this._emit("change",{x:this._x.value,y:this._y.value}),this._draw())}get y(){return this._y.value}set y(t){const s=this._y.value;this._y.update(t),this._hY.value=this._y.normalized,this._y.value!==s&&(this._emit("change",{x:this._x.value,y:this._y.value}),this._draw())}get minX(){return this._x.min}set minX(t){this._x.min=t,this.x=this._x.value}get maxX(){return this._x.max}set maxX(t){this._x.max=t,this.x=this._x.value}get stepX(){return this._x.step}set stepX(t){this._x.step=t,this.x=this._x.value}get minY(){return this._y.min}set minY(t){this._y.min=t,this.y=this._y.value}get maxY(){return this._y.max}set maxY(t){this._y.max=t,this.y=this._y.value}get stepY(){return this._y.step}set stepY(t){this._y.step=t,this.y=this._y.value}get mode(){return this._mode}set mode(t){this._mode=t==="relative"?"relative":"absolute",this._hX.mode=this._mode,this._hY.mode=this._mode}get normalized(){return{x:this._x.normalized,y:this._y.normalized}}resize(t,s){for(this._w=Math.max(10,Math.floor(t)),this._h=Math.max(10,Math.floor(s)),this._svg.setAttribute("width",this._w),this._svg.setAttribute("height",this._h),this._svg.setAttribute("viewBox",`0 0 ${this._w} ${this._h}`),this._hX.resize([0,this._w],[0,this._h]),this._hY.resize([0,this._w],[0,this._h]),this._bg.setAttribute("width",this._w),this._bg.setAttribute("height",this._h);this._grid.firstChild;)this._grid.removeChild(this._grid.firstChild);const i=[.25,.5,.75];for(const A of i){const r=document.createElementNS(this._svg.namespaceURI,"line");r.setAttribute("x1",this._w*A),r.setAttribute("y1",0),r.setAttribute("x2",this._w*A),r.setAttribute("y2",this._h),this._grid.appendChild(r);const a=document.createElementNS(this._svg.namespaceURI,"line");a.setAttribute("x1",0),a.setAttribute("y1",this._h*A),a.setAttribute("x2",this._w),a.setAttribute("y2",this._h*A),this._grid.appendChild(a)}this._draw()}destroy(){this._svg.removeEventListener("pointerdown",this._onDown),window.removeEventListener("pointerup",this._onUp),window.removeEventListener("pointercancel",this._onUp),window.removeEventListener("pointermove",this._onMove),this._root&&this._root.contains(this._svg)&&this._root.removeChild(this._svg),this._events.clear()}colorize(t){Object.assign(this._style,t||{}),this._bg.setAttribute("fill",this._style.bg),this._xh.setAttribute("stroke",this._style.cross),this._yh.setAttribute("stroke",this._style.cross),this._knob.setAttribute("fill",this._style.handle),this._label&&this._label.setAttribute("fill",this._style.text),this._grid.setAttribute("stroke",this._style.grid),this._draw()}_localPoint(t){const s=this._svg.getBoundingClientRect();return{x:t.clientX-s.left,y:t.clientY-s.top}}_onDown(t){var i,A;(A=(i=this._svg).setPointerCapture)==null||A.call(i,t.pointerId),this._clicked=!0;const s=this._localPoint(t);this._mode==="absolute"?(this._hX.update(s),this._hY.update(s),this._batchSetFromHandles()):(this._hX.anchor=s,this._hY.anchor=s),window.addEventListener("pointermove",this._onMove,{passive:!1}),this._emit("down",{x:this._x.value,y:this._y.value}),t.preventDefault()}_onMove(t){if(!this._clicked)return;const s=this._localPoint(t);this._hX.update(s),this._hY.update(s),this._batchSetFromHandles(),t.preventDefault()}_onUp(){this._clicked&&(this._clicked=!1,window.removeEventListener("pointermove",this._onMove),this._emit("up",{x:this._x.value,y:this._y.value}))}_batchSetFromHandles(){const t=this._hX.value,s=this._hY.value,i=this._x.updateNormal(t),A=this._y.updateNormal(s);(i!==void 0||A!==void 0)&&this._emit("change",{x:this._x.value,y:this._y.value}),this._draw()}_draw(){const t=(this._w-1)*this._x.normalized,s=(this._h-1)*(1-this._y.normalized);this._xh.setAttribute("x1",t),this._xh.setAttribute("y1",0),this._xh.setAttribute("x2",t),this._xh.setAttribute("y2",this._h),this._yh.setAttribute("x1",0),this._yh.setAttribute("y1",s),this._yh.setAttribute("x2",this._w),this._yh.setAttribute("y2",s),this._knob.setAttribute("cx",t),this._knob.setAttribute("cy",s)}}_.moduleLoaded("PositionEffectsController");class _U{constructor(){this.positions={},this.currentColor=null,this.resizeObservers=[],this.effectConfigs={reverb:{containerId:"reverb-position",xParam:"decay",yParam:"roomSize",xRange:{min:0,max:100,step:1},yRange:{min:0,max:100,step:1}},delay:{containerId:"delay-position",xParam:"time",yParam:"feedback",xRange:{min:0,max:100,step:1},yRange:{min:0,max:95,step:1}},vibrato:{containerId:"vibrato-position",xParam:"speed",yParam:"span",xRange:{min:0,max:100,step:1},yRange:{min:0,max:100,step:1}},tremolo:{containerId:"tremolo-position",xParam:"speed",yParam:"span",xRange:{min:0,max:100,step:1},yRange:{min:0,max:100,step:1}}},this.colorMappings={"#4a90e2":{bg:"rgba(74, 144, 226, 0.1)",handle:"#4a90e2",grid:"#dee2e6",cross:"#6c757d",text:"#212529"},"#2d2d2d":{bg:"rgba(45, 45, 45, 0.1)",handle:"#2d2d2d",grid:"#dee2e6",cross:"#6c757d",text:"#212529"},"#d66573":{bg:"rgba(214, 101, 115, 0.1)",handle:"#d66573",grid:"#dee2e6",cross:"#6c757d",text:"#212529"},"#68a03f":{bg:"rgba(104, 160, 63, 0.1)",handle:"#68a03f",grid:"#dee2e6",cross:"#6c757d",text:"#212529"}},_.info("PositionEffectsController","Initialized",null,"ui")}init(){return _.initStart("Position Effects Controller"),Object.entries(this.effectConfigs).forEach(([t,s])=>{this.createPositionComponent(t,s)}),this.initializeColorTracking(),this.updateColorsForCurrentSelection(),_.initSuccess("Position Effects Controller"),!0}createPositionComponent(t,s){const i=document.getElementById(s.containerId);if(!i){_.warn("PositionEffectsController",`Container not found for ${t}`,{containerId:s.containerId},"ui");return}try{const[A,r]=this.getPositionComponentSize(i),a=new bU(i,{size:[A,r],mode:"absolute",x:s.xRange.min,minX:s.xRange.min,maxX:s.xRange.max,stepX:s.xRange.step,y:s.yRange.min,minY:s.yRange.min,maxY:s.yRange.max,stepY:s.yRange.step});this.positions[t]=a,this.observePositionResize(i,a,A,r),a.on("change",({x:l,y:h})=>{this.onPositionChange(t,s.xParam,l,s.yParam,h)}),a.on("down",()=>{this.onDialInteractionStart(t)}),a.on("up",()=>{this.onDialInteractionEnd(t)}),this.loadInitialValues(t,s,a),_.debug("PositionEffectsController",`Created Position component for ${t}`,null,"ui")}catch(A){_.error("PositionEffectsController",`Failed to create Position component for ${t}`,A,"ui")}}getPositionComponentSize(t){const i=t.getBoundingClientRect();let A=(i==null?void 0:i.width)||t.clientWidth||t.offsetWidth||120,r=(i==null?void 0:i.height)||t.clientHeight||t.offsetHeight||A;return(!A||A<10)&&(A=120),(!r||r<10)&&(r=A),[Math.round(A),Math.round(r)]}observePositionResize(t,s,i,A){if(typeof ResizeObserver>"u")return;const r={currentWidth:Math.round(i)||0,currentHeight:Math.round(A)||0},a=new ResizeObserver(l=>{for(const h of l){const{width:u,height:m}=h.contentRect,g=Math.round(u),v=Math.round(m||u);!g||!v||g===r.currentWidth&&v===r.currentHeight||(r.currentWidth=g,r.currentHeight=v,s.resize(g,v))}});a.observe(t),this.resizeObservers.push(a)}loadInitialValues(t,s,i){var a;const A=(a=d.state.selectedNote)==null?void 0:a.color;if(!A){const l=s.xRange.min,h=s.yRange.min;i.x=l,i.y=h,_.debug("PositionEffectsController",`Set default values for ${t} (no color selected)`,{x:l,y:h},"ui");return}const r=Si.getEffectParameters?Si.getEffectParameters(t):null;if(r){const l=r[s.xParam]!==void 0?r[s.xParam]:s.xRange.min,h=r[s.yParam]!==void 0?r[s.yParam]:s.yRange.min;i.x=l,i.y=h,_.debug("PositionEffectsController",`Loaded values for ${t} color ${A}`,{x:l,y:h},"ui")}else{const l=s.xRange.min,h=s.yRange.min;i.x=l,i.y=h,_.debug("PositionEffectsController",`Set default values for ${t} (no effect params)`,{x:l,y:h},"ui")}}transformValue(t){return t<=1,t}isInOffZone(t,s){return t<=1&&s<=1}transformPositionValues(t,s){if(this.isInOffZone(t,s))return{x:t,y:s};const i=t<=1?Math.max(1,t):t,A=s<=1?Math.max(1,s):s;return{x:i,y:A}}onPositionChange(t,s,i,A,r){var h;if(!((h=d.state.selectedNote)==null?void 0:h.color)){_.warn("PositionEffectsController","No color selected for position change",{effectType:t,xParam:s,xValue:i,yParam:A,yValue:r},"ui");return}const l=this.transformPositionValues(i,r);_.debug("PositionEffectsController",`Position changed: ${t} ${s}=${i}->${l.x}, ${A}=${r}->${l.y}`,null,"ui"),Si.onEffectParameterChange(t,s,l.x),Si.onEffectParameterChange(t,A,l.y)}initializeColorTracking(){var t;this.currentColor=(t=d.state.selectedNote)==null?void 0:t.color,d.on("noteChanged",()=>{var i;const s=(i=d.state.selectedNote)==null?void 0:i.color;s!==this.currentColor&&(this.currentColor=s,this.updateColorsForCurrentSelection(),this.updatePositionValuesForColor())}),d.on("effectParameterChanged",({effectType:s,parameter:i,value:A,color:r})=>{_.debug("PositionEffectsController",`Effect parameter changed: ${s}.${i} = ${A} for ${r}`,null,"ui"),r===this.currentColor&&this.syncPositionFromEffects(s,i,A)}),d.on("audioEffectChanged",({effectType:s,parameter:i,value:A,color:r})=>{_.debug("PositionEffectsController",`Audio effect changed: ${s}.${i} = ${A} for ${r}`,null,"ui"),r===this.currentColor&&this.syncPositionFromEffects(s,i,A)})}updateColorsForCurrentSelection(){if(!this.currentColor||!this.colorMappings[this.currentColor])return;const t=this.colorMappings[this.currentColor];Object.values(this.positions).forEach(s=>{s&&s.colorize&&s.colorize(t)}),_.debug("PositionEffectsController",`Applied color theme for ${this.currentColor}`,t,"ui")}updatePositionValuesForColor(){this.currentColor&&Object.entries(this.effectConfigs).forEach(([t,s])=>{const i=this.positions[t];if(!i)return;const A=Si.getEffectParameters?Si.getEffectParameters(t):null;if(A){const r=A[s.xParam]!==void 0?A[s.xParam]:s.xRange.min,a=A[s.yParam]!==void 0?A[s.yParam]:s.yRange.min;i.x=r,i.y=a}})}syncPositionFromEffects(t,s,i){const A=this.positions[t],r=this.effectConfigs[t];!A||!r||(s===r.xParam?A.x=i:s===r.yParam&&(A.y=i),_.debug("PositionEffectsController",`Synced ${t}.${s} = ${i} from effects`,null,"ui"))}getPositionValues(t){const s=this.positions[t];return s?{x:s.x,y:s.y,normalized:s.normalized}:null}testPositionComponents(){_.info("PositionEffectsController","Testing Position components...",null,"ui"),Object.entries(this.positions).forEach(([t,s])=>{s?_.info("PositionEffectsController",`${t} Position component:`,{x:s.x,y:s.y,normalized:s.normalized},"ui"):_.warn("PositionEffectsController",`${t} Position component not found`,null,"ui")}),_.info("PositionEffectsController",`Current color: ${this.currentColor}`,null,"ui"),this.positions.vibrato&&(_.info("PositionEffectsController","Testing vibrato position change...",null,"ui"),this.positions.vibrato.x=75,this.positions.vibrato.y=50)}testDeadZoneElimination(){_.info("PositionEffectsController","Testing dead zone elimination...",null,"ui"),[{x:0,y:0,description:"Origin (should stay 0,0 - effect off)"},{x:.5,y:.5,description:"Inside off zone (should stay 0.5,0.5 - effect off)"},{x:1,y:1,description:"Edge of off zone (should stay 1,1 - effect off)"},{x:0,y:50,description:"X in dead zone (should become 1,50 - effect on)"},{x:50,y:0,description:"Y in dead zone (should become 50,1 - effect on)"},{x:.5,y:75,description:"X in dead zone (should become 1,75 - effect on)"},{x:25,y:.8,description:"Y in dead zone (should become 25,1 - effect on)"},{x:50,y:75,description:"Both normal (should stay 50,75 - effect on)"}].forEach(s=>{const i=this.transformPositionValues(s.x,s.y),A=this.isInOffZone(s.x,s.y);_.info("PositionEffectsController",`Test: ${s.description}`,{input:{x:s.x,y:s.y},output:i,inOffZone:A},"ui")})}onDialInteractionStart(t){var i;if(t!=="vibrato"&&t!=="tremolo")return;const s=(i=d.state.selectedNote)==null?void 0:i.color;s&&(d.emit("effectDialInteractionStart",{effectType:t,color:s}),_.debug("PositionEffectsController",`Dial interaction started for ${t} on ${s}`,null,"ui"))}onDialInteractionEnd(t){var i;const s=(i=d.state.selectedNote)==null?void 0:i.color;s&&(d.emit("effectDialInteractionEnd",{effectType:t,color:s}),_.debug("PositionEffectsController",`Dial interaction ended for ${t} on ${s}`,null,"ui"))}destroy(){Object.values(this.positions).forEach(t=>{t&&t.destroy&&t.destroy()}),this.positions={},this.resizeObservers.forEach(t=>t.disconnect()),this.resizeObservers=[],_.info("PositionEffectsController","Destroyed",null,"ui")}}const Aw=new _U;async function xU(){nU(),kI(),oU(),_.initStart("Static Waveform Visualizer"),hU()?_.initSuccess("Static Waveform Visualizer"):_.initFailed("Static Waveform Visualizer"),_.initStart("Effects Managers"),nw.init(),iw.init(),qo.init(),Si.init(),Aw.init(),window.effectsCoordinator=qo,window.animationEffectsManager=nw,window.audioEffectsManager=iw,window.effectsController=Si,window.positionEffectsController=Aw,_.initSuccess("Effects Managers")}function EU(){SU()}function SU(){const e=document.querySelectorAll(".rhythm-tab-button"),t=document.querySelectorAll(".rhythm-tab-panel");if(!e.length||!t.length)return;e.forEach(r=>{r.addEventListener("click",()=>{const a=r.getAttribute("data-rhythm-tab");e.forEach(h=>h.classList.remove("active")),t.forEach(h=>h.classList.remove("active")),r.classList.add("active");const l=document.getElementById(`${a}-panel`);l&&l.classList.add("active"),localStorage.setItem("selectedRhythmTab",a)})});const s=localStorage.getItem("selectedRhythmTab")||"controls",i=document.querySelector(`[data-rhythm-tab="${s}"]`),A=document.getElementById(`${s}-panel`);i&&A&&(e.forEach(r=>r.classList.remove("active")),t.forEach(r=>r.classList.remove("active")),i.classList.add("active"),A.classList.add("active"))}class FU{constructor(){this.gridsWrapper=null,this.pitchGridWrapper=null,this.drumGridWrapper=null,this.gridScrollbarProxy=null,this.isInitialized=!1,this.lastScrollTime=0,this.isSyncingFromProxy=!1,this.isSyncingFromWrapper=!1}init(){if(this.gridsWrapper=document.getElementById("grids-wrapper"),this.pitchGridWrapper=document.getElementById("pitch-grid-wrapper"),this.drumGridWrapper=document.getElementById("drum-grid-wrapper"),this.gridScrollbarProxy=document.getElementById("grid-scrollbar-proxy"),!this.gridsWrapper||!this.pitchGridWrapper||!this.drumGridWrapper){_.error("ScrollSyncService","Required elements not found for scroll sync",null,"scroll");return}this.setupScrollSynchronization(),this.isInitialized=!0,_.info("ScrollSyncService","Initialized with unified grids-wrapper structure",null,"scroll")}setupScrollSynchronization(){this.handleWrapperScroll=this.handleWrapperScroll.bind(this),this.handleProxyScroll=this.handleProxyScroll.bind(this),this.gridsWrapper.addEventListener("scroll",this.handleWrapperScroll,{passive:!0}),this.gridScrollbarProxy?this.gridScrollbarProxy.addEventListener("scroll",this.handleProxyScroll,{passive:!0}):_.warn("ScrollSyncService","Grid scrollbar proxy not found; falling back to native scrollbars.",null,"scroll")}handleWrapperScroll(t){if(this.isSyncingFromProxy)return;const s=Date.now();if(this.lastScrollTime=s,this.gridScrollbarProxy){const i=this.gridsWrapper.scrollLeft;Math.abs(this.gridScrollbarProxy.scrollLeft-i)>.5&&(this.isSyncingFromWrapper=!0,this.gridScrollbarProxy.scrollLeft=i,this.isSyncingFromWrapper=!1)}_.debug("ScrollSyncService",`Unified scroll: ${t.target.scrollLeft}px`,null,"scroll")}handleProxyScroll(){if(this.isSyncingFromWrapper||!this.gridScrollbarProxy)return;const t=this.gridScrollbarProxy.scrollLeft;this.gridsWrapper&&Math.abs(this.gridsWrapper.scrollLeft-t)>.5&&(this.isSyncingFromProxy=!0,this.gridsWrapper.scrollLeft=t,this.isSyncingFromProxy=!1)}syncScrollTo(t){!this.isInitialized||!this.gridsWrapper||(this.isSyncingFromProxy=!0,this.isSyncingFromWrapper=!0,this.gridsWrapper.scrollLeft=t,this.gridScrollbarProxy&&(this.gridScrollbarProxy.scrollLeft=t),this.isSyncingFromProxy=!1,this.isSyncingFromWrapper=!1)}}const TU=new FU;async function IU(){const e=yt.init();return Cf.setContexts(e),TU.init(),e}const of=["#ef8aab","#f48e7d","#e89955","#cdaa42","#a4ba57","#6ec482","#2dc8b1","#16c3da","#58b8f6","#8fa9ff","#ba9bf2","#db8fd4"];function QU(e){if(e===0||!e)return"#888888";const t=Math.round(e)%12;return of[t]}function MU(e){if(e===0||!e)return Br("#888888");const t=Math.floor(e),s=e-t;if(s<0||s>=1)return QU(e);const i=t%12,A=(i+1)%12,r=Br(of[i]),a=Br(of[A]);return UU(r,a,s)}function Br(e){const t=parseInt(e.slice(1),16);return[t>>16&255,t>>8&255,t&255]}function UU(e,t,s){return e.map((i,A)=>Math.round(i+s*(t[A]-i)))}function zl(e,t,s){return e===0||!e?Br("#888888"):t==="shapenote"?Br(s||"#4A90E2"):MU(e)}class PU{constructor(){this.canvas=null,this.ctx=null,this.animationFrameId=null,this.lastValidPitch=null,this.lastValidPitchTime=0,this.fadeOutDurationMs=100,this.isFading=!1}initialize(){this.canvas=document.getElementById("playhead-canvas"),this.canvas&&(this.ctx=this.canvas.getContext("2d"),d.on("micPaintStateChanged",t=>this.handlePaintStateChange(t)),d.on("pitchDetected",t=>this.handlePitchDetection(t)),d.on("playbackStateChanged",()=>{d.state.paint.isMicPaintActive}))}handlePaintStateChange(t){const s=document.getElementById("hover-canvas");s&&(s.style.display=t?"none":"block"),t?this.startRendering():this.stopRendering()}handlePitchDetection(t){d.state.paint.isMicPaintActive&&d.state.isPlaying&&!d.state.isPaused&&this.addPaintAtPlayhead(t)}startRendering(){this.animationFrameId||this.render()}stopRendering(){this.animationFrameId&&(cancelAnimationFrame(this.animationFrameId),this.animationFrameId=null),this.ctx&&this.ctx.clearRect(0,0,ke(this.canvas),le(this.canvas))}render(){if(!d.state.paint.isMicPaintActive||!this.ctx){this.animationFrameId=null;return}this.ctx.clearRect(0,0,ke(this.canvas),le(this.canvas)),d.state.isPlaying,d.state.isPaused,d.state.isPlaying&&d.state.isPaused,d.state.isPlaying&&!d.state.isPaused?this.renderMovingPlayhead():this.renderStationaryPlayhead(),this.animationFrameId=requestAnimationFrame(()=>this.render())}renderStationaryPlayhead(){var l,h;const{detectedPitch:t}=d.state.paint,s=performance.now();this.ctx.clearRect(0,0,ke(this.canvas),le(this.canvas));const i=this.midiToY(t.midi),A=i!==null,r=yt.getColumnX(2),a=yt.getCanvasWidth();if(A){this.lastValidPitch=t,this.lastValidPitchTime=s,this.isFading=!1;const{colorMode:u}=d.state.paint.paintSettings,m=(l=d.state.selectedNote)==null?void 0:l.color,g=zl(t.midi,u,m),v=`rgb(${g[0]}, ${g[1]}, ${g[2]})`;this.ctx.strokeStyle=v,this.ctx.globalAlpha=Math.min(t.clarity*1.2,1),this.ctx.lineWidth=4,this.ctx.shadowColor=v,this.ctx.shadowBlur=6,this.ctx.beginPath(),this.ctx.moveTo(r,i),this.ctx.lineTo(a,i),this.ctx.stroke(),this.ctx.shadowBlur=0,this.ctx.globalAlpha=1}else if(this.lastValidPitch&&s-this.lastValidPitchTime<this.fadeOutDurationMs){this.isFading=!0;const u=(s-this.lastValidPitchTime)/this.fadeOutDurationMs,m=this.easeOutCubic(1-u),g=this.midiToY(this.lastValidPitch.midi);if(g!==null){const{colorMode:v}=d.state.paint.paintSettings,y=(h=d.state.selectedNote)==null?void 0:h.color,C=zl(this.lastValidPitch.midi,v,y),x=`rgb(${C[0]}, ${C[1]}, ${C[2]})`;this.ctx.strokeStyle=x,this.ctx.globalAlpha=m*Math.min(this.lastValidPitch.clarity*1.2,1),this.ctx.lineWidth=4,this.ctx.shadowColor=x,this.ctx.shadowBlur=6*m,this.ctx.beginPath(),this.ctx.moveTo(r,g),this.ctx.lineTo(a,g),this.ctx.stroke(),this.ctx.shadowBlur=0,this.ctx.globalAlpha=1}}else this.isFading=!1,this.lastValidPitch=null}easeOutCubic(t){return 1-Math.pow(1-t,3)}renderMovingPlayhead(){var A;const t=this.calculateXFromTime($.Transport.seconds);if(t===null)return;this.ctx.strokeStyle="#FF6B35",this.ctx.lineWidth=3,this.ctx.shadowColor="#FF6B35",this.ctx.shadowBlur=6,this.ctx.beginPath(),this.ctx.moveTo(t,0),this.ctx.lineTo(t,le(this.canvas)),this.ctx.stroke(),this.ctx.shadowBlur=0;const{detectedPitch:s}=d.state.paint,i=this.midiToY(s.midi);if(i!==null){const{colorMode:r}=d.state.paint.paintSettings,a=(A=d.state.selectedNote)==null?void 0:A.color,l=zl(s.midi,r,a),h=`rgb(${l[0]}, ${l[1]}, ${l[2]})`;this.ctx.fillStyle=h,this.ctx.strokeStyle="white",this.ctx.lineWidth=2,this.ctx.shadowColor=h,this.ctx.shadowBlur=4,this.ctx.beginPath(),this.ctx.arc(t,i,8,0,2*Math.PI),this.ctx.fill(),this.ctx.stroke(),this.ctx.shadowBlur=0}}addPaintAtPlayhead(t){if(t.midi===0)return;const s=$.Transport.seconds;Kf.addPaintPoint(s,t.midi)}calculateXFromTime(t){const s=Kd();if(!Array.isArray(s)||s.length<2)return null;for(let i=0;i<s.length-1;i++)if(t>=s[i]&&t<s[i+1]){const A=s[i],r=s[i+1]-A,a=t-A,l=Er(i),h=Df(i);return l+(r>0?a/r*h:0)}return null}midiToY(t){if(t===0)return null;const{fullRowData:s}=d.state;if(!s||s.length===0)return null;const i=Math.min(...s.map(v=>Fi(v.toneNote))),A=Math.max(...s.map(v=>Fi(v.toneNote)));if(t<24||t>96||t<i||t>A)return null;let r=-1,a=-1,l=-999,h=999;for(let v=0;v<s.length;v++){const y=Fi(s[v].toneNote);y<=t&&y>l&&(r=v,l=y),y>=t&&y<h&&(a=v,h=y)}if(l===t){const v=Nt(r,d.state);return Math.max(0,Math.min(v,le(this.canvas)))}if(r>=0&&a>=0&&l!==h){const v=Nt(r,d.state),y=Nt(a,d.state),C=(t-l)/(h-l),x=v+(y-v)*C;return Math.max(0,Math.min(x,le(this.canvas)))}let u=0,m=Math.abs(Fi(s[0].toneNote)-t);for(let v=1;v<s.length;v++){const y=Fi(s[v].toneNote),C=Math.abs(y-t);C<m&&(m=C,u=v)}const g=Nt(u,d.state);return Math.max(0,Math.min(g,le(this.canvas)))}canvasYToViewportY(t){const s=yt.getViewportInfo();return Gs.canvasToViewportY(t,s)}isCanvasYVisible(t){const s=this.canvasYToViewportY(t),i=yt.getViewportInfo();return s>=0&&s<=i.viewportHeight}}const af=new PU;class kU{constructor(){this.canvas=null,this.ctx=null,this.isInitialized=!1,this.animationFrameId=null,this.lastHistoryLength=0}initialize(){if(this.canvas=document.getElementById("pitch-paint-canvas"),!this.canvas){_.error("PaintCanvas","Could not find #pitch-paint-canvas element",null,"paint");return}if(this.ctx=this.canvas.getContext("2d"),!document.getElementById("pitch-canvas-wrapper")){_.error("PaintCanvas","Could not find #pitch-canvas-wrapper element",null,"paint");return}d.on("paintHistoryChanged",()=>this.render()),d.on("layoutConfigChanged",()=>this.resize()),d.on("micPaintStateChanged",s=>{s?this.startRendering():this.stopRendering()}),this.resize(),this.isInitialized=!0}startRendering(){this.animationFrameId||(this.animationFrameId=requestAnimationFrame(()=>this.animationLoop()))}stopRendering(){this.animationFrameId&&(cancelAnimationFrame(this.animationFrameId),this.animationFrameId=null)}animationLoop(){d.state.paint.paintHistory.length!==this.lastHistoryLength&&(this.render(),this.lastHistoryLength=d.state.paint.paintHistory.length),this.animationFrameId=requestAnimationFrame(()=>this.animationLoop())}resize(){this.canvas&&this.render()}render(){if(!this.ctx)return;this.ctx.clearRect(0,0,ke(this.canvas),le(this.canvas));const t=d.state.paint.paintHistory;t.length!==0&&this.renderPaintTrail(t)}renderPaintTrail(t){if(t.length<2)return;const s=t.map(A=>{const r=af.calculateXFromTime(A.musicalTime),a=af.midiToY(A.midi);return r===null||a===null?null:{...A,x:r,y:a}}).filter(A=>A!==null);if(s.length<2)return;const i=d.state.paint.paintSettings.opacity/100;this.ctx.globalAlpha=i,this.ctx.lineCap="round",this.ctx.lineJoin="round";for(let A=1;A<s.length;A++){const r=s[A-1],a=s[A];a.timestamp-r.timestamp>200||this.drawPaintSegment(r,a)}this.ctx.globalAlpha=1}drawPaintSegment(t,s){const i=this.ctx.createLinearGradient(t.x,t.y,s.x,s.y);i.addColorStop(0,`rgb(${t.color.join(",")})`),i.addColorStop(1,`rgb(${s.color.join(",")})`),this.ctx.strokeStyle=i,this.ctx.lineWidth=(t.thickness+s.thickness)/2,this.ctx.beginPath(),this.ctx.moveTo(t.x,t.y),this.ctx.lineTo(s.x,s.y),this.ctx.stroke()}addPaintPoint(t,s){var l;const{colorMode:i}=d.state.paint.paintSettings,A=(l=d.state.selectedNote)==null?void 0:l.color,r=zl(s,i,A),a={musicalTime:t,midi:s,color:r,timestamp:performance.now(),thickness:d.state.paint.paintSettings.thickness};d.addPaintPoint(a)}clear(){d.clearPaintHistory()}}const Kf=new kU;var Zu,rw;function DU(){if(rw)return Zu;rw=1;function e(t){if(this.size=t|0,this.size<=1||(this.size&this.size-1)!==0)throw new Error("FFT size must be a power of two and bigger than 1");this._csize=t<<1;for(var s=new Array(this.size*2),i=0;i<s.length;i+=2){const u=Math.PI*i/this.size;s[i]=Math.cos(u),s[i+1]=-Math.sin(u)}this.table=s;for(var A=0,r=1;this.size>r;r<<=1)A++;this._width=A%2===0?A-1:A,this._bitrev=new Array(1<<this._width);for(var a=0;a<this._bitrev.length;a++){this._bitrev[a]=0;for(var l=0;l<this._width;l+=2){var h=this._width-l-2;this._bitrev[a]|=(a>>>l&3)<<h}}this._out=null,this._data=null,this._inv=0}return Zu=e,e.prototype.fromComplexArray=function(s,i){for(var A=i||new Array(s.length>>>1),r=0;r<s.length;r+=2)A[r>>>1]=s[r];return A},e.prototype.createComplexArray=function(){const s=new Array(this._csize);for(var i=0;i<s.length;i++)s[i]=0;return s},e.prototype.toComplexArray=function(s,i){for(var A=i||this.createComplexArray(),r=0;r<A.length;r+=2)A[r]=s[r>>>1],A[r+1]=0;return A},e.prototype.completeSpectrum=function(s){for(var i=this._csize,A=i>>>1,r=2;r<A;r+=2)s[i-r]=s[r],s[i-r+1]=-s[r+1]},e.prototype.transform=function(s,i){if(s===i)throw new Error("Input and output buffers must be different");this._out=s,this._data=i,this._inv=0,this._transform4(),this._out=null,this._data=null},e.prototype.realTransform=function(s,i){if(s===i)throw new Error("Input and output buffers must be different");this._out=s,this._data=i,this._inv=0,this._realTransform4(),this._out=null,this._data=null},e.prototype.inverseTransform=function(s,i){if(s===i)throw new Error("Input and output buffers must be different");this._out=s,this._data=i,this._inv=1,this._transform4();for(var A=0;A<s.length;A++)s[A]/=this.size;this._out=null,this._data=null},e.prototype._transform4=function(){var s=this._out,i=this._csize,A=this._width,r=1<<A,a=i/r<<1,l,h,u=this._bitrev;if(a===4)for(l=0,h=0;l<i;l+=a,h++){const F=u[h];this._singleTransform2(l,F,r)}else for(l=0,h=0;l<i;l+=a,h++){const F=u[h];this._singleTransform4(l,F,r)}var m=this._inv?-1:1,g=this.table;for(r>>=2;r>=2;r>>=2){a=i/r<<1;var v=a>>>2;for(l=0;l<i;l+=a)for(var y=l+v,C=l,x=0;C<y;C+=2,x+=r){const F=C,I=F+v,T=I+v,U=T+v,D=s[F],O=s[F+1],R=s[I],st=s[I+1],Y=s[T],L=s[T+1],J=s[U],dt=s[U+1],ht=D,rt=O,Tt=g[x],It=m*g[x+1],Ht=R*Tt-st*It,tt=R*It+st*Tt,ct=g[2*x],lt=m*g[2*x+1],mt=Y*ct-L*lt,At=Y*lt+L*ct,St=g[3*x],Qt=m*g[3*x+1],Pt=J*St-dt*Qt,Vt=J*Qt+dt*St,he=ht+mt,Lt=rt+At,Te=ht-mt,ns=rt-At,qt=Ht+Pt,se=tt+Vt,Ie=m*(Ht-Pt),ie=m*(tt-Vt),Ks=he+qt,Hn=Lt+se,is=he-qt,ri=Lt-se,pA=Te+ie,mA=ns-Ie,gA=Te-ie,oi=ns+Ie;s[F]=Ks,s[F+1]=Hn,s[I]=pA,s[I+1]=mA,s[T]=is,s[T+1]=ri,s[U]=gA,s[U+1]=oi}}},e.prototype._singleTransform2=function(s,i,A){const r=this._out,a=this._data,l=a[i],h=a[i+1],u=a[i+A],m=a[i+A+1],g=l+u,v=h+m,y=l-u,C=h-m;r[s]=g,r[s+1]=v,r[s+2]=y,r[s+3]=C},e.prototype._singleTransform4=function(s,i,A){const r=this._out,a=this._data,l=this._inv?-1:1,h=A*2,u=A*3,m=a[i],g=a[i+1],v=a[i+A],y=a[i+A+1],C=a[i+h],x=a[i+h+1],F=a[i+u],I=a[i+u+1],T=m+C,U=g+x,D=m-C,O=g-x,R=v+F,st=y+I,Y=l*(v-F),L=l*(y-I),J=T+R,dt=U+st,ht=D+L,rt=O-Y,Tt=T-R,It=U-st,Ht=D-L,tt=O+Y;r[s]=J,r[s+1]=dt,r[s+2]=ht,r[s+3]=rt,r[s+4]=Tt,r[s+5]=It,r[s+6]=Ht,r[s+7]=tt},e.prototype._realTransform4=function(){var s=this._out,i=this._csize,A=this._width,r=1<<A,a=i/r<<1,l,h,u=this._bitrev;if(a===4)for(l=0,h=0;l<i;l+=a,h++){const BA=u[h];this._singleRealTransform2(l,BA>>>1,r>>>1)}else for(l=0,h=0;l<i;l+=a,h++){const BA=u[h];this._singleRealTransform4(l,BA>>>1,r>>>1)}var m=this._inv?-1:1,g=this.table;for(r>>=2;r>=2;r>>=2){a=i/r<<1;var v=a>>>1,y=v>>>1,C=y>>>1;for(l=0;l<i;l+=a)for(var x=0,F=0;x<=C;x+=2,F+=r){var I=l+x,T=I+y,U=T+y,D=U+y,O=s[I],R=s[I+1],st=s[T],Y=s[T+1],L=s[U],J=s[U+1],dt=s[D],ht=s[D+1],rt=O,Tt=R,It=g[F],Ht=m*g[F+1],tt=st*It-Y*Ht,ct=st*Ht+Y*It,lt=g[2*F],mt=m*g[2*F+1],At=L*lt-J*mt,St=L*mt+J*lt,Qt=g[3*F],Pt=m*g[3*F+1],Vt=dt*Qt-ht*Pt,he=dt*Pt+ht*Qt,Lt=rt+At,Te=Tt+St,ns=rt-At,qt=Tt-St,se=tt+Vt,Ie=ct+he,ie=m*(tt-Vt),Ks=m*(ct-he),Hn=Lt+se,is=Te+Ie,ri=ns+Ks,pA=qt-ie;if(s[I]=Hn,s[I+1]=is,s[T]=ri,s[T+1]=pA,x===0){var mA=Lt-se,gA=Te-Ie;s[U]=mA,s[U+1]=gA;continue}if(x!==C){var oi=ns,ue=-qt,Vi=Lt,Rn=-Te,wA=-m*Ks,pa=-m*ie,Tr=-m*Ie,vA=-m*se,Lc=oi+wA,Ir=ue+pa,Qr=Vi+vA,ma=Rn-Tr,ga=l+y-x,Wi=l+v-x;s[ga]=Lc,s[ga+1]=Ir,s[Wi]=Qr,s[Wi+1]=ma}}}},e.prototype._singleRealTransform2=function(s,i,A){const r=this._out,a=this._data,l=a[i],h=a[i+A],u=l+h,m=l-h;r[s]=u,r[s+1]=0,r[s+2]=m,r[s+3]=0},e.prototype._singleRealTransform4=function(s,i,A){const r=this._out,a=this._data,l=this._inv?-1:1,h=A*2,u=A*3,m=a[i],g=a[i+A],v=a[i+h],y=a[i+u],C=m+v,x=m-v,F=g+y,I=l*(g-y),T=C+F,U=x,D=-I,O=C-F,R=x,st=I;r[s]=T,r[s+1]=0,r[s+2]=U,r[s+3]=D,r[s+4]=O,r[s+5]=0,r[s+6]=R,r[s+7]=st},Zu}var LU=DU();const HU=uw(LU);class zo{constructor(t,s){Ys(this,"_inputLength");Ys(this,"_fft");Ys(this,"_bufferSupplier");Ys(this,"_paddedInputBuffer");Ys(this,"_transformBuffer");Ys(this,"_inverseBuffer");if(t<1)throw new Error("Input length must be at least one");this._inputLength=t,this._fft=new HU(NU(2*t)),this._bufferSupplier=s,this._paddedInputBuffer=this._bufferSupplier(this._fft.size),this._transformBuffer=this._bufferSupplier(2*this._fft.size),this._inverseBuffer=this._bufferSupplier(2*this._fft.size)}static forFloat32Array(t){return new zo(t,s=>new Float32Array(s))}static forFloat64Array(t){return new zo(t,s=>new Float64Array(s))}static forNumberArray(t){return new zo(t,s=>Array(s))}get inputLength(){return this._inputLength}autocorrelate(t,s=this._bufferSupplier(t.length)){if(t.length!==this._inputLength)throw new Error(`Input must have length ${this._inputLength} but had length ${t.length}`);for(let A=0;A<t.length;A++)this._paddedInputBuffer[A]=t[A];for(let A=t.length;A<this._paddedInputBuffer.length;A++)this._paddedInputBuffer[A]=0;this._fft.realTransform(this._transformBuffer,this._paddedInputBuffer),this._fft.completeSpectrum(this._transformBuffer);const i=this._transformBuffer;for(let A=0;A<i.length;A+=2)i[A]=i[A]*i[A]+i[A+1]*i[A+1],i[A+1]=0;this._fft.inverseTransform(this._inverseBuffer,this._transformBuffer);for(let A=0;A<t.length;A++)s[A]=this._inverseBuffer[2*A];return s}}function RU(e){const t=[];let s=!1,i=-1/0,A=-1;for(let r=1;r<e.length-1;r++)e[r-1]<=0&&e[r]>0?(s=!0,A=r,i=e[r]):e[r-1]>0&&e[r]<=0?(s=!1,A!==-1&&t.push(A)):s&&e[r]>i&&(i=e[r],A=r);return t}function OU(e,t){const[s,i,A]=[e-1,e,e+1],[r,a,l]=[t[s],t[i],t[A]],h=r/2-a+l/2,u=-(r/2)*(i+A)+a*(s+A)-l/2*(s+i),m=r*i*A/2-a*s*A+l*s*i/2,g=-u/(2*h),v=h*g*g+u*g+m;return[g,v]}class $o{constructor(t,s){Ys(this,"_autocorrelator");Ys(this,"_nsdfBuffer");Ys(this,"_clarityThreshold",.9);Ys(this,"_minVolumeAbsolute",0);Ys(this,"_maxInputAmplitude",1);this._autocorrelator=new zo(t,s),this._nsdfBuffer=s(t)}static forFloat32Array(t){return new $o(t,s=>new Float32Array(s))}static forFloat64Array(t){return new $o(t,s=>new Float64Array(s))}static forNumberArray(t){return new $o(t,s=>Array(s))}get inputLength(){return this._autocorrelator.inputLength}set clarityThreshold(t){if(!Number.isFinite(t)||t<=0||t>1)throw new Error("clarityThreshold must be a number in the range (0, 1]");this._clarityThreshold=t}set minVolumeAbsolute(t){if(!Number.isFinite(t)||t<0||t>this._maxInputAmplitude)throw new Error(`minVolumeAbsolute must be a number in the range [0, ${this._maxInputAmplitude}]`);this._minVolumeAbsolute=t}set minVolumeDecibels(t){if(!Number.isFinite(t)||t>0)throw new Error("minVolumeDecibels must be a number <= 0");this._minVolumeAbsolute=this._maxInputAmplitude*10**(t/10)}set maxInputAmplitude(t){if(!Number.isFinite(t)||t<=0)throw new Error("maxInputAmplitude must be a number > 0");this._maxInputAmplitude=t}findPitch(t,s){if(this._belowMinimumVolume(t))return[0,0];this._nsdf(t);const i=RU(this._nsdfBuffer);if(i.length===0)return[0,0];const A=Math.max(...i.map(h=>this._nsdfBuffer[h])),r=i.find(h=>this._nsdfBuffer[h]>=this._clarityThreshold*A),[a,l]=OU(r,this._nsdfBuffer);return[s/a,Math.min(l,1)]}_belowMinimumVolume(t){if(this._minVolumeAbsolute===0)return!1;let s=0;for(let i=0;i<t.length;i++)s+=t[i]**2;return Math.sqrt(s/t.length)<this._minVolumeAbsolute}_nsdf(t){this._autocorrelator.autocorrelate(t,this._nsdfBuffer);let s=2*this._nsdfBuffer[0],i;for(i=0;i<this._nsdfBuffer.length&&s>0;i++)this._nsdfBuffer[i]=2*this._nsdfBuffer[i]/s,s-=t[i]**2+t[t.length-i-1]**2;for(;i<this._nsdfBuffer.length;i++)this._nsdfBuffer[i]=0}}function NU(e){return e--,e|=e>>1,e|=e>>2,e|=e>>4,e|=e>>8,e|=e>>16,e++,e}class VU{constructor(){this.mic=null,this.analyser=null,this.detector=null,this.animationFrameId=null,this.isInitialized=!1,this.lastLogTime=0,this.logThrottleMs=5e3,this.pitchHistory=[],this.maxHistoryLength=3,this.maxPitchJumpSemitones=24,this.maxJumpTimeMs=20,this.config={FFT_SIZE:2048,MIN_PITCH_HZ:75,MAX_PITCH_HZ:1300,MIN_VOLUME_DB:-50}}async initialize(){if(!this.isInitialized)try{await(window.initAudio||(()=>$.start()))(),this.mic=new $.UserMedia,this.analyser=new $.Analyser("waveform",this.config.FFT_SIZE),this.micGain=new $.Gain(2),this.detector=$o.forFloat32Array(this.analyser.size),this.micSplitter=new $.Gain(1),await this.mic.open(),this.mic.connect(this.micGain),this.micGain.connect(this.micSplitter),this.micSplitter.connect(this.analyser),this.isInitialized=!0}catch(t){throw _.error("PitchPaintService","Failed to initialize microphone",t,"paint"),d.setMicPaintActive(!1),t}}startDetection(){!this.isInitialized||d.state.paint.isDetecting||(d.setPaintDetectionState(!0),this.animationLoop())}stopDetection(){d.state.paint.isDetecting&&(d.setPaintDetectionState(!1),this.animationFrameId&&(cancelAnimationFrame(this.animationFrameId),this.animationFrameId=null))}animationLoop(){if(!d.state.paint.isDetecting){this.animationFrameId=null;return}const t=this.analyser.getValue(),s=Math.sqrt(t.reduce((h,u)=>h+u*u,0)/t.length),i=performance.now();let A=null,r=0;if(s>1e-5)try{[A,r]=this.detector.findPitch(t,$.context.sampleRate),A==null&&(A=null),r==null&&(r=0),A&&r>.1&&i-this.lastLogTime>this.logThrottleMs&&(this.lastLogTime=i)}catch{A=null,r=0}const a=d.state.paint.paintSettings.minClarity;if(A&&r>a&&A>this.config.MIN_PITCH_HZ&&A<this.config.MAX_PITCH_HZ){const h=this.frequencyToMidi(A);if(this.isPitchJumpValid(h,i)){this.addPitchToHistory(h,i);const u=this.getSmoothedPitch(),m={frequency:A,clarity:r,midi:u,pitchClass:Math.round(u)%12,timestamp:i};d.setDetectedPitch(m)}else{const u=this.getSmoothedPitch();if(u!==null){const m={frequency:A,clarity:r,midi:u,pitchClass:Math.round(u)%12,timestamp:i};d.setDetectedPitch(m)}else d.setDetectedPitch({frequency:0,clarity:0,midi:0,pitchClass:0,timestamp:i})}}else d.setDetectedPitch({frequency:0,clarity:0,midi:0,pitchClass:0,timestamp:i});this.animationFrameId=requestAnimationFrame(()=>this.animationLoop())}frequencyToMidi(t){return 12*Math.log2(t/440)+69}addPitchToHistory(t,s){this.pitchHistory.push({midi:t,timestamp:s}),this.pitchHistory.length>this.maxHistoryLength&&this.pitchHistory.shift()}isPitchJumpValid(t,s){if(this.pitchHistory.length===0)return!0;const i=this.pitchHistory[this.pitchHistory.length-1],A=s-i.timestamp,r=Math.abs(t-i.midi);return A>this.maxJumpTimeMs?!0:r>this.maxPitchJumpSemitones?(_.debug("PitchPaintService","Pitch jump rejected",{semitoneDiff:r.toFixed(1),timeDiff:A.toFixed(0)},"paint"),!1):!0}getSmoothedPitch(){return this.pitchHistory.length<3?this.pitchHistory.length>0?this.pitchHistory[this.pitchHistory.length-1].midi:null:this.pitchHistory.slice(-3).map(s=>s.midi).sort((s,i)=>s-i)[1]}testMicrophoneInput(){if(!this.isInitialized)return!1;const t=this.analyser.getValue();return Math.sqrt(t.reduce((i,A)=>i+A*A,0)/t.length)>1e-4}async dispose(){this.stopDetection(),this.mic&&(this.mic.close(),this.mic=null),this.micGain&&(this.micGain.dispose(),this.micGain=null),this.micSplitter&&(this.micSplitter.dispose(),this.micSplitter=null),this.analyser=null,this.detector=null,this.isInitialized=!1}}const oA=new VU;class WU{constructor(){this.elements={}}initialize(){this.cacheDOMElements(),this.elements.toggleBtn&&(this.setupEventListeners(),this.updateUI(),d.on("micPaintStateChanged",()=>this.updateUI()),d.on("paintHistoryChanged",()=>this.updateUI()),d.on("paintSettingsChanged",()=>this.updateUI()))}cacheDOMElements(){this.elements.toggleBtn=document.getElementById("mic-paint-toggle"),this.elements.clearBtn=document.getElementById("paint-clear-btn"),this.elements.thicknessSelect=document.getElementById("sidebar-trail-thickness"),this.elements.opacitySelect=document.getElementById("sidebar-trail-opacity"),this.elements.colorToggle=document.getElementById("paint-color-toggle"),this.elements.playbackToggle=document.getElementById("paint-playback-toggle")}setupEventListeners(){this.elements.toggleBtn.addEventListener("click",()=>this.handleMicPaintToggle()),this.elements.clearBtn.addEventListener("click",()=>this.handleClearPaint()),this.elements.thicknessSelect.addEventListener("change",t=>{const s=parseInt(t.target.value,10);d.setPaintSettings({thickness:s})}),this.elements.opacitySelect.addEventListener("change",t=>{const s=parseInt(t.target.value,10);d.setPaintSettings({opacity:s})}),this.elements.colorToggle.addEventListener("click",()=>this.handleColorToggle()),this.elements.playbackToggle.addEventListener("click",()=>this.handlePlaybackToggle())}async handleMicPaintToggle(){const t=d.state.paint.isMicPaintActive;if(this.elements.toggleBtn.disabled=!0,t)oA.stopDetection(),d.setMicPaintActive(!1);else try{await oA.initialize(),d.setMicPaintActive(!0),oA.startDetection()}catch{alert("Microphone access is required for Pitch Painting. Please check your browser permissions and try again."),d.setMicPaintActive(!1)}this.elements.toggleBtn.disabled=!1}handleClearPaint(){confirm("Are you sure you want to clear the painted pitch trail? This cannot be undone.")&&Kf.clear()}handleColorToggle(){const s=d.state.paint.paintSettings.colorMode==="chromatic"?"shapenote":"chromatic";d.setPaintSettings({colorMode:s})}handlePlaybackToggle(){const t=d.state.paint.paintSettings.playbackEnabled;d.setPaintSettings({playbackEnabled:!t})}updateUI(){const{isMicPaintActive:t,paintHistory:s,paintSettings:i}=d.state.paint;if(this.elements.toggleBtn.textContent=t?"Mic Paint (ON)":"Mic Paint (OFF)",this.elements.toggleBtn.classList.toggle("active",t),this.elements.clearBtn.disabled=s.length===0,this.elements.thicknessSelect&&this.elements.thicknessSelect.value!==i.thickness.toString()&&(this.elements.thicknessSelect.value=i.thickness.toString()),this.elements.opacitySelect&&this.elements.opacitySelect.value!==i.opacity.toString()&&(this.elements.opacitySelect.value=i.opacity.toString()),this.elements.colorToggle){const A=i.colorMode==="shapenote";this.elements.colorToggle.classList.toggle("active",A)}this.elements.playbackToggle&&this.elements.playbackToggle.classList.toggle("active",i.playbackEnabled)}}const GU=new WU;_.moduleLoaded("PaintPlaybackService");class KU{constructor(){this.paintSynth=null,this.scheduledEvents=[],this.isInitialized=!1}async initialize(){if(!this.isInitialized)try{if(this.paintSynth=new $.Synth({oscillator:{type:"sine"},envelope:{attack:.01,decay:.1,sustain:0,release:.1}}),this.paintGain=new $.Gain(.3),this.paintSynth.connect(this.paintGain),window.synthEngine&&window.synthEngine.getMainVolumeNode){const t=window.synthEngine.getMainVolumeNode();t?(this.paintGain.connect(t),_.info("PaintPlaybackService","Connected to SynthEngine master chain (with limiter)")):(this.paintGain.toDestination(),_.warn("PaintPlaybackService","SynthEngine main volume node not found, connecting directly to destination"))}else this.paintGain.toDestination(),_.warn("PaintPlaybackService","SynthEngine not available, connecting directly to destination");this.isInitialized=!0,_.info("PaintPlaybackService","Initialized with sine wave synthesis")}catch(t){throw _.error("PaintPlaybackService","Failed to initialize",t),t}}midiToFrequency(t){return 440*Math.pow(2,(t-69)/12)}schedulePaintPlayback(){if(!this.isInitialized||!d.state.paint.paintSettings.playbackEnabled)return;this.clearScheduledEvents();const t=d.state.paint.paintHistory;if(!t||t.length===0){_.debug("PaintPlaybackService","No paint history to schedule");return}_.info("PaintPlaybackService",`Scheduling ${t.length} paint points for playback`),t.forEach((s,i)=>{const A=this.midiToFrequency(s.midi),r=.2,a=$.Transport.schedule(l=>{this.paintSynth&&d.state.paint.paintSettings.playbackEnabled&&(this.paintSynth.triggerAttackRelease(A,r,l),_.debug("PaintPlaybackService",`Playing paint point ${i}: ${s.midi.toFixed(2)} MIDI (${A.toFixed(1)}Hz) at time ${s.musicalTime.toFixed(2)}s`))},s.musicalTime);this.scheduledEvents.push(a)}),_.info("PaintPlaybackService",`Scheduled ${this.scheduledEvents.length} paint events`)}clearScheduledEvents(){this.scheduledEvents.forEach(t=>{$.Transport.clear(t)}),this.scheduledEvents=[],_.debug("PaintPlaybackService","Cleared all scheduled paint events")}onTransportStart(){d.state.paint.paintSettings.playbackEnabled&&this.schedulePaintPlayback()}onTransportStop(){this.clearScheduledEvents()}setPaintVolume(t){this.paintGain&&(this.paintGain.gain.value=Math.max(0,Math.min(1,t)))}getPaintVolume(){return this.paintGain?this.paintGain.gain.value:.3}async dispose(){this.clearScheduledEvents(),this.paintSynth&&(this.paintSynth.dispose(),this.paintSynth=null),this.paintGain&&(this.paintGain.dispose(),this.paintGain=null),this.isInitialized=!1,_.info("PaintPlaybackService","Disposed")}}const ow=new KU;class qU{constructor(){this.meter=null,this.isInitialized=!1,this.meterWrapper=null,this.meterPlaceholder=null,this.meterSource=null,this.settingsPanel=null,this.settings={size:"wide",fps:30,batterySaver:!1,noiseFloor:-70,autoCalibrated:!1},this.permissionState="unknown",this.errorMessage=null}initialize(){this.isInitialized||(this.cacheDOMElements(),this.setupEventListeners(),this.updateUI(),d.on("micPaintStateChanged",t=>this.handlePitchPaintingToggle(t)),this.isInitialized=!0)}cacheDOMElements(){this.meterWrapper=document.getElementById("mic-meter-wrapper"),this.meterPlaceholder=document.getElementById("meter-placeholder"),this.settingsPanel=document.getElementById("meter-settings-panel"),this.settingsBtn=document.getElementById("meter-settings-btn"),this.sizeSelect=document.getElementById("meter-size-select"),this.fpsSelect=document.getElementById("meter-fps-select"),this.batterySaverCheckbox=document.getElementById("meter-battery-saver"),this.calibrateBtn=document.getElementById("meter-calibrate-btn"),this.resetBtn=document.getElementById("meter-reset-btn"),this.meterWrapper}setupEventListeners(){this.settingsBtn&&this.settingsBtn.addEventListener("click",()=>this.toggleSettingsPanel()),this.sizeSelect&&this.sizeSelect.addEventListener("change",t=>this.handleSizeChange(t.target.value)),this.fpsSelect&&this.fpsSelect.addEventListener("change",t=>this.handleFpsChange(parseInt(t.target.value))),this.batterySaverCheckbox&&this.batterySaverCheckbox.addEventListener("change",t=>this.handleBatterySaverChange(t.target.checked)),this.calibrateBtn&&this.calibrateBtn.addEventListener("click",()=>this.handleAutoCalibrate()),this.resetBtn&&this.resetBtn.addEventListener("click",()=>this.handleReset())}async handlePitchPaintingToggle(t){t?await this.startMeter():this.stopMeter()}async startMeter(){if(!this.meter)try{await this.ensureMicrophoneAccess();const t=$.context;if(!t||t.state==="suspended")throw new Error("Audio context not available or suspended");await this.createMeterFromExistingMic(),this.updateUI()}catch(t){this.handleMeterError(t)}}async ensureMicrophoneAccess(){this.permissionState="pending",this.updateUI();try{this.permissionState="granted"}catch{throw this.permissionState="denied",new Error("Microphone access denied. Please check your browser permissions.")}}async createMeterFromExistingMic(){if(!this.meterWrapper)throw new Error("Meter wrapper not found - cannot create meter");this.meterWrapper.innerHTML="";const t=this.getMeterDimensions(),s=(await E0(async()=>{const{default:i}=await import("./meter-C4sYlEIi.js");return{default:i}},[])).default;if(!oA||!oA.micSplitter)throw new Error("PitchPaintService microphone splitter not available");this.meter=new s({target:this.meterWrapper,size:t,fps:this.settings.fps,colors:{fill:"#1a1a1a",accent:"#00ff88"},floorDb:this.settings.noiseFloor,ceilingDb:5}),this.meter.connect(oA.micSplitter),this.meterSource=oA.micSplitter,this.meterWrapper.classList.add("active"),this.meterWrapper.classList.remove("error")}stopMeter(){this.meter&&(this.meter.disconnect(),this.meter.destroy(),this.meter=null),this.meterSource&&(this.meterSource=null),this.meterWrapper.innerHTML=`
      <div class="meter-placeholder" id="meter-placeholder">
      </div>
    `,this.meterPlaceholder=document.getElementById("meter-placeholder"),this.meterWrapper.classList.remove("active"),this.updateUI()}getMeterDimensions(){const t=this.meterWrapper.clientWidth||200,s=this.meterWrapper.clientHeight||100;if(this.meterWrapper.classList.contains("mic-meter-wrapper-inline"))return[t,36];if(this.meterWrapper.classList.contains("mic-meter-wrapper-vertical"))return[t,s];const r=this.settings.size==="compact"?48:72;return[t,r]}updateUI(){if(this.meterWrapper){if(this.meterWrapper.classList.remove("compact","wide"),this.meterWrapper.classList.add(this.settings.size),this.updateAccessibilityAttributes(),this.meterPlaceholder){let t="",s="";const i=this.meterWrapper.classList.contains("mic-meter-wrapper-inline");this.permissionState==="denied"?(t=i?"Mic access denied":"Microphone access denied. Click to retry.",s="error"):this.permissionState==="pending"?(t=i?"Requesting access...":"Requesting microphone access...",s="pending"):d.state.paint.isMicPaintActive?this.meter?(t="",s="active"):(t=i?"Starting...":"Starting meter...",s="pending"):(t="",s="disabled");const A=this.meterPlaceholder.querySelector(".meter-status-text");A&&(A.textContent=t),this.meterWrapper.classList.remove("error","pending","disabled"),s&&this.meterWrapper.classList.add(s)}this.updateSettingsUI()}}updateAccessibilityAttributes(){this.meterWrapper&&(this.meterWrapper.setAttribute("role","meter"),this.meterWrapper.setAttribute("aria-label","Microphone Level Meter"),this.meter&&this.meter.active?(this.meterWrapper.setAttribute("aria-valuenow","0"),this.meterWrapper.setAttribute("aria-valuemin",this.settings.noiseFloor.toString()),this.meterWrapper.setAttribute("aria-valuemax","5"),this.meterWrapper.setAttribute("aria-valuetext","Microphone level active")):(this.meterWrapper.removeAttribute("aria-valuenow"),this.meterWrapper.removeAttribute("aria-valuemin"),this.meterWrapper.removeAttribute("aria-valuemax"),this.meterWrapper.setAttribute("aria-valuetext","Microphone level inactive")),window.matchMedia&&window.matchMedia("(prefers-reduced-motion: reduce)").matches&&this.meterWrapper.setAttribute("data-reduced-motion","true"))}updateSettingsUI(){this.sizeSelect&&(this.sizeSelect.value=this.settings.size),this.fpsSelect&&(this.fpsSelect.value=this.settings.fps),this.batterySaverCheckbox&&(this.batterySaverCheckbox.checked=this.settings.batterySaver)}toggleSettingsPanel(){this.settingsPanel&&this.settingsPanel.classList.toggle("hidden")}handleSizeChange(t){if(this.settings.size=t,this.meter){const s=this.getMeterDimensions();this.meter.resize(s[0],s[1])}this.updateUI()}handleFpsChange(t){this.settings.fps=t}handleBatterySaverChange(t){this.settings.batterySaver=t}async handleAutoCalibrate(){if(this.meter){this.calibrateBtn.disabled=!0,this.calibrateBtn.textContent="Stay quiet...";try{await new Promise(t=>setTimeout(t,2e3)),this.settings.noiseFloor=-65,this.settings.autoCalibrated=!0,this.calibrateBtn.textContent="Calibrated ",setTimeout(()=>{this.calibrateBtn.textContent="Auto-Calibrate",this.calibrateBtn.disabled=!1},1500)}catch{this.calibrateBtn.textContent="Auto-Calibrate",this.calibrateBtn.disabled=!1}}}handleReset(){if(this.settings={size:"wide",fps:30,batterySaver:!1,noiseFloor:-70,autoCalibrated:!1},this.updateSettingsUI(),this.meter){const t=this.getMeterDimensions();this.meter.resize(t[0],t[1])}}handleMeterError(t){this.errorMessage=t.message,this.meterWrapper.classList.add("error"),(t.message.includes("denied")||t.message.includes("permission"))&&this.showPermissionRetryPrompt(),this.updateUI()}showPermissionRetryPrompt(){let t=this.meterWrapper.querySelector(".meter-permission-prompt");if(!t){t=document.createElement("div"),t.className="meter-permission-prompt",t.innerHTML=`
        <p>Microphone access is required for the level meter.</p>
        <button class="meter-retry-btn">Grant Permission</button>
        <button class="meter-help-btn">Help</button>
      `,this.meterWrapper.appendChild(t);const s=t.querySelector(".meter-retry-btn"),i=t.querySelector(".meter-help-btn");s.addEventListener("click",()=>this.retryPermission()),i.addEventListener("click",()=>this.showPermissionHelp())}}async retryPermission(){try{const t=this.meterWrapper.querySelector(".meter-permission-prompt");t&&t.remove(),this.permissionState="unknown",this.meterWrapper.classList.remove("error"),d.state.paint.isMicPaintActive&&await this.startMeter()}catch(t){this.handleMeterError(t)}}showPermissionHelp(){alert(`
To enable the microphone level meter:

1. Look for a microphone icon in your browser's address bar
2. Click it and select "Allow"
3. If you don't see the icon, go to your browser settings:
   - Chrome: Settings > Privacy and security > Site Settings > Microphone
   - Firefox: Settings > Privacy & Security > Permissions > Microphone
   - Safari: Settings > Websites > Microphone

4. Find this website and set it to "Allow"
5. Refresh the page if needed
    `)}dispose(){this.stopMeter(),this.isInitialized=!1}}const zU=new qU;async function $U(){_.initStart("Paint components"),Kf.initialize(),af.initialize(),GU.initialize(),await ow.initialize(),window.PaintPlaybackService=ow,zU.initialize(),_.initSuccess("Paint components")}class XU{constructor(){this.currentTool=null,this.toolButtons=null,this.optionsContainer=null,this.lastSelectedNote=null,this.settings={arrow:{lineStyle:"solid",strokeWeight:4,startArrowhead:"none",endArrowhead:"filled-arrow",arrowheadSize:12},text:{color:"#000000",size:16,bold:!1,italic:!1,underline:!1,background:!1,superscript:!1,subscript:!1},marker:{color:"#4a90e2",size:6},highlighter:{color:"#4a90e2",size:10},lasso:{}}}initialize(){if(this.toolButtons=document.querySelectorAll(".draw-tool-button"),this.toolPanels=document.querySelectorAll(".draw-tool-panel"),this.optionsContainers={arrow:document.getElementById("arrow-tool-options"),text:document.getElementById("text-tool-options"),marker:document.getElementById("marker-tool-options"),highlighter:document.getElementById("highlighter-tool-options"),lasso:document.getElementById("lasso-tool-options")},!this.toolButtons.length||!this.optionsContainers.arrow){_.warn("DrawToolsController","Could not find draw tool elements",null,"draw");return}this.attachEventListeners(),this.setupChordTabListeners(),this.setupMainTabListeners(),this.populateAllPanels(),this.initializePanelWidthSync(),d.on("noteChanged",({newNote:t})=>{this.lastSelectedNote=t,this.currentTool&&this.deselectAllTools()})}attachEventListeners(){this.toolButtons.forEach(t=>{t.addEventListener("click",()=>{const s=t.dataset.drawTool;this.selectTool(s)})})}setupMainTabListeners(){document.querySelectorAll(".tab-button").forEach(s=>{s.addEventListener("click",()=>{s.dataset.tab!=="pitch"&&this.currentTool&&(this.deselectAllTools(),this.restoreLastSelectedNote())})})}setupChordTabListeners(){document.querySelectorAll(".pitch-tab-button").forEach(s=>{s.addEventListener("click",()=>{s.dataset.pitchTab!=="draw"&&this.currentTool&&(this.deselectAllTools(),this.restoreLastSelectedNote())})})}restoreLastSelectedNote(){this.lastSelectedNote?(d.setSelectedNote(this.lastSelectedNote.shape,this.lastSelectedNote.color),d.setSelectedTool("note")):d.state.selectedNote&&(d.setSelectedNote(d.state.selectedNote.shape,d.state.selectedNote.color),d.setSelectedTool("note"))}deselectAllTools(){this.toolButtons.forEach(t=>t.classList.remove("active")),this.toolPanels.forEach(t=>t.classList.remove("active")),this.currentTool=null,re.setTool(null,null)}selectTool(t){this.toolButtons.forEach(i=>i.classList.remove("active")),this.toolPanels.forEach(i=>i.classList.remove("active"));const s=Array.from(this.toolButtons).find(i=>i.dataset.drawTool===t);if(s){s.classList.add("active");const i=s.closest(".draw-tool-panel");i&&i.classList.add("active")}this.currentTool=t,re.setTool(t,this.settings),d.state.selectedNote=null}populateAllPanels(){this.renderArrowOptions(),this.renderTextOptions(),this.renderMarkerOptions(),this.renderHighlighterOptions(),this.renderLassoOptions()}renderArrowOptions(){const t=this.optionsContainers.arrow;t&&(t.innerHTML=`
            <div style="display: flex; flex-direction: column; gap: var(--space-015);">
                <div class="draw-toolbar-row">
                    <button class="draw-toolbar-button" data-popup="stroke-weight" title="Stroke Weight">
                        <svg width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="${Math.min(this.settings.arrow.strokeWeight,5)}">
                            <circle cx="12" cy="12" r="8"/>
                        </svg>
                    </button>
                    <button class="draw-toolbar-button" data-popup="line-style" title="Line Style">
                        <svg width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-dasharray="${this.getLineDashArray()}">
                            <line x1="4" y1="12" x2="20" y2="12"/>
                        </svg>
                    </button>
                </div>
                <div class="draw-toolbar-row">
                    <button class="draw-toolbar-button" data-popup="start-arrowhead" title="Start Arrowhead">
                        ${this.getArrowheadIcon(this.settings.arrow.startArrowhead,"left")}
                    </button>
                    <button class="draw-toolbar-button" data-popup="end-arrowhead" title="End Arrowhead">
                        ${this.getArrowheadIcon(this.settings.arrow.endArrowhead,"right")}
                    </button>
                </div>
                <div class="draw-toolbar-row">
                    <button class="draw-toolbar-button draw-swap-button" data-action="swap-endpoints" title="Swap endpoints">
                        <svg width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                            <polyline points="17,1 21,5 17,9"></polyline>
                            <path d="M3,11V9A4,4 0 0,1 7,5H21"></path>
                            <polyline points="7,23 3,19 7,15"></polyline>
                            <path d="M21,13v2a4,4 0 0,1 -4,4H3"></path>
                        </svg>
                    </button>
                </div>
            </div>
        `,this.attachArrowToolbarListeners())}getLineDashArray(){switch(this.settings.arrow.lineStyle){case"solid":return"0";case"dashed-big":return"8,4";case"dashed-small":return"4,2";case"dotted":return"1,2";default:return"0"}}getArrowheadIcon(t,s){const i=s==="left";switch(t){case"none":return`<svg width="20" height="20" viewBox="0 0 24 24"><line x1="${i?20:4}" y1="12" x2="${i?4:20}" y2="12" stroke="currentColor" stroke-width="2"/></svg>`;case"unfilled-arrow":return`<svg width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                    <line x1="${i?20:4}" y1="12" x2="${i?4:20}" y2="12"/>
                    <polyline points="${i?"10,6 4,12 10,18":"14,6 20,12 14,18"}"/>
                </svg>`;case"filled-arrow":return`<svg width="20" height="20" viewBox="0 0 24 24" fill="currentColor" stroke="currentColor" stroke-width="2">
                    <line x1="${i?20:4}" y1="12" x2="${i?8:16}" y2="12"/>
                    <polygon points="${i?"4,12 10,6 10,18":"20,12 14,6 14,18"}"/>
                </svg>`;case"circle":return`<svg width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                    <line x1="${i?20:4}" y1="12" x2="${i?8:16}" y2="12"/>
                    <circle cx="${i?4:20}" cy="12" r="3"/>
                </svg>`;default:return""}}attachArrowToolbarListeners(){const t=this.optionsContainers.arrow;if(!t)return;t.querySelectorAll("[data-popup]").forEach(A=>{A.addEventListener("click",()=>{this.selectTool("arrow");const r=A.dataset.popup;this.showPopupMenu(r,A)})});const i=t.querySelector('[data-action="swap-endpoints"]');i&&i.addEventListener("click",()=>{const A=this.settings.arrow.startArrowhead;this.settings.arrow.startArrowhead=this.settings.arrow.endArrowhead,this.settings.arrow.endArrowhead=A,this.renderArrowOptions(),re.setTool(this.currentTool,this.settings),re.applyCurrentSettingsToSelected()})}showPopupMenu(t,s){const i=document.querySelector(".draw-popup-menu");i&&i.remove();const A=document.createElement("div");A.className="draw-popup-menu";let r="";switch(t){case"stroke-weight":{const u=this.settings.arrow.strokeWeight,m=2,g=4,v=7;r=`
                    <div style="padding: 8px; min-width: 180px;">
                        <input type="range"
                            class="draw-stroke-slider"
                            min="1"
                            max="10"
                            value="${u}"
                            style="width: 100%; margin-bottom: 8px;">
                        <div style="display: flex; gap: 4px; justify-content: center;">
                            <button class="draw-popup-option ${u===m?"active":""}" data-value="${m}">
                                <svg width="30" height="30" viewBox="0 0 30 30"><circle cx="15" cy="15" r="12" fill="none" stroke="currentColor" stroke-width="2"/></svg>
                            </button>
                            <button class="draw-popup-option ${u===g?"active":""}" data-value="${g}">
                                <svg width="30" height="30" viewBox="0 0 30 30"><circle cx="15" cy="15" r="12" fill="none" stroke="currentColor" stroke-width="4"/></svg>
                            </button>
                            <button class="draw-popup-option ${u===v?"active":""}" data-value="${v}">
                                <svg width="30" height="30" viewBox="0 0 30 30"><circle cx="15" cy="15" r="12" fill="none" stroke="currentColor" stroke-width="6"/></svg>
                            </button>
                        </div>
                    </div>
                `;break}case"line-style":r=`
                    <button class="draw-popup-option ${this.settings.arrow.lineStyle==="solid"?"active":""}" data-value="solid">
                        <svg width="30" height="20" viewBox="0 0 30 20"><line x1="2" y1="10" x2="28" y2="10" stroke="currentColor" stroke-width="2"/></svg>
                    </button>
                    <button class="draw-popup-option ${this.settings.arrow.lineStyle==="dashed-big"?"active":""}" data-value="dashed-big">
                        <svg width="30" height="20" viewBox="0 0 30 20"><line x1="2" y1="10" x2="28" y2="10" stroke="currentColor" stroke-width="2" stroke-dasharray="6,3"/></svg>
                    </button>
                    <button class="draw-popup-option ${this.settings.arrow.lineStyle==="dashed-small"?"active":""}" data-value="dashed-small">
                        <svg width="30" height="20" viewBox="0 0 30 20"><line x1="2" y1="10" x2="28" y2="10" stroke="currentColor" stroke-width="2" stroke-dasharray="3,2"/></svg>
                    </button>
                    <button class="draw-popup-option ${this.settings.arrow.lineStyle==="dotted"?"active":""}" data-value="dotted">
                        <svg width="30" height="20" viewBox="0 0 30 20"><line x1="2" y1="10" x2="28" y2="10" stroke="currentColor" stroke-width="2" stroke-dasharray="1,2"/></svg>
                    </button>
                `;break;case"start-arrowhead":case"end-arrowhead":{const u=t==="start-arrowhead",m=u?this.settings.arrow.startArrowhead:this.settings.arrow.endArrowhead;r=`
                    <div style="padding: 8px; min-width: 180px;">
                        <div style="margin-bottom: 8px; font-size: 0.85em; color: var(--c-text);">
                            Arrowhead Size
                        </div>
                        <input type="range"
                            class="draw-arrowhead-size-slider"
                            min="8"
                            max="24"
                            value="${this.settings.arrow.arrowheadSize}"
                            style="width: 100%; margin-bottom: 12px;">
                        <div style="margin-bottom: 6px; font-size: 0.85em; color: var(--c-text);">
                            Arrowhead Style
                        </div>
                        <div style="display: flex; gap: 4px; justify-content: center;">
                            <button class="draw-popup-option ${m==="none"?"active":""}" data-value="none">
                                <svg width="30" height="20" viewBox="0 0 30 20"><line x1="5" y1="10" x2="25" y2="10" stroke="currentColor" stroke-width="2"/></svg>
                            </button>
                            <button class="draw-popup-option ${m==="unfilled-arrow"?"active":""}" data-value="unfilled-arrow">
                                <svg width="30" height="20" viewBox="0 0 30 20" fill="none" stroke="currentColor" stroke-width="2">
                                    <line x1="${u?25:5}" y1="10" x2="${u?10:20}" y2="10"/>
                                    <polyline points="${u?"10,5 5,10 10,15":"20,5 25,10 20,15"}"/>
                                </svg>
                            </button>
                            <button class="draw-popup-option ${m==="filled-arrow"?"active":""}" data-value="filled-arrow">
                                <svg width="30" height="20" viewBox="0 0 30 20" fill="currentColor" stroke="currentColor" stroke-width="2">
                                    <line x1="${u?25:5}" y1="10" x2="${u?12:18}" y2="10"/>
                                    <polygon points="${u?"5,10 12,5 12,15":"25,10 18,5 18,15"}"/>
                                </svg>
                            </button>
                            <button class="draw-popup-option ${m==="circle"?"active":""}" data-value="circle">
                                <svg width="30" height="20" viewBox="0 0 30 20" fill="none" stroke="currentColor" stroke-width="2">
                                    <line x1="${u?25:5}" y1="10" x2="${u?10:20}" y2="10"/>
                                    <circle cx="${u?5:25}" cy="10" r="4"/>
                                </svg>
                            </button>
                        </div>
                    </div>
                `;break}}A.innerHTML=r,document.body.appendChild(A);const a=s.getBoundingClientRect();A.style.position="absolute",A.style.top=`${a.bottom+5}px`,A.style.left=`${a.left}px`;const l=A.querySelector(".draw-stroke-slider");l&&l.addEventListener("input",u=>{const m=Number(u.target.value);this.settings.arrow.strokeWeight=m,this.renderArrowOptions(),re.setTool(this.currentTool,this.settings),re.applyCurrentSettingsToSelected()});const h=A.querySelector(".draw-arrowhead-size-slider");h&&h.addEventListener("input",u=>{const m=Number(u.target.value);this.settings.arrow.arrowheadSize=m,re.setTool(this.currentTool,this.settings),re.applyCurrentSettingsToSelected()}),A.querySelectorAll(".draw-popup-option").forEach(u=>{u.addEventListener("click",()=>{const m=u.dataset.value;t==="stroke-weight"?(this.settings.arrow.strokeWeight=Number(m),l&&(l.value=m)):t==="line-style"?this.settings.arrow.lineStyle=m:t==="start-arrowhead"?this.settings.arrow.startArrowhead=m:t==="end-arrowhead"&&(this.settings.arrow.endArrowhead=m),this.renderArrowOptions(),A.remove(),re.setTool(this.currentTool,this.settings),re.applyCurrentSettingsToSelected()})}),setTimeout(()=>{const u=m=>{!A.contains(m.target)&&!s.contains(m.target)&&(A.remove(),document.removeEventListener("click",u))};document.addEventListener("click",u)},0)}renderTextOptions(){const t=this.optionsContainers.text;t&&(t.innerHTML=`
            <div style="display: flex; flex-direction: column; gap: var(--space-015);">
                <div class="draw-toolbar-row">
                    <button class="draw-toolbar-button" data-popup="text-color" title="Text Color">
                        <div style="width: 16px; height: 16px; border-radius: 50%; background-color: ${this.settings.text.color}; border: 2px solid var(--c-border);"></div>
                    </button>
                    <button class="draw-toolbar-button ${this.settings.text.background?"active":""}" data-action="toggle-background" title="Background Fill">
                        <svg width="20" height="20" viewBox="0 0 24 24" fill="${this.settings.text.background?"currentColor":"none"}" stroke="currentColor" stroke-width="2">
                            <rect x="4" y="4" width="16" height="16" rx="2"/>
                        </svg>
                    </button>
                </div>
                <div class="draw-toolbar-row">
                    <button class="draw-toolbar-button" data-action="decrease-size" title="Decrease Font Size">
                        <span style="font-weight: bold; font-size: 1.2em;"></span>
                    </button>
                    <div style="min-width: 35px; text-align: center; font-size: 0.85em; color: var(--c-text);">
                        ${this.settings.text.size}px
                    </div>
                    <button class="draw-toolbar-button" data-action="increase-size" title="Increase Font Size">
                        <span style="font-weight: bold; font-size: 1.2em;">+</span>
                    </button>
                </div>
                <div class="draw-toolbar-row">
                    <button class="draw-toolbar-button ${this.settings.text.superscript?"active":""}" data-action="toggle-superscript" title="Superscript">
                        <span style="font-size: 0.85em;">x<sup style="font-size: 0.7em;">2</sup></span>
                    </button>
                    <button class="draw-toolbar-button ${this.settings.text.subscript?"active":""}" data-action="toggle-subscript" title="Subscript">
                        <span style="font-size: 0.85em;">x<sub style="font-size: 0.7em;">2</sub></span>
                    </button>
                </div>
            </div>
        `,this.attachTextToolbarListeners())}renderMarkerOptions(){const t=this.optionsContainers.marker;t&&(t.innerHTML=`
            <div class="draw-toolbar-row">
                <button class="draw-toolbar-button" data-popup="marker-color" title="Marker Color">
                    <div style="width: 16px; height: 16px; border-radius: 50%; background-color: ${this.settings.marker.color}; border: 2px solid var(--c-border);"></div>
                </button>
                <button class="draw-toolbar-button" data-popup="marker-size" title="Marker Size">
                    <svg width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="${this.settings.marker.size==="small"?"1":this.settings.marker.size==="medium"?"3":"5"}">
                        <circle cx="12" cy="12" r="8"/>
                    </svg>
                </button>
            </div>
        `,this.attachCommonToolbarListeners("marker"))}renderHighlighterOptions(){const t=this.optionsContainers.highlighter;if(!t)return;const s=(i,A)=>{const r=parseInt(i.slice(1,3),16),a=parseInt(i.slice(3,5),16),l=parseInt(i.slice(5,7),16);return`rgba(${r}, ${a}, ${l}, ${A})`};t.innerHTML=`
            <div class="draw-toolbar-row">
                <button class="draw-toolbar-button" data-popup="highlighter-color" title="Highlighter Color">
                    <div style="width: 16px; height: 16px; border-radius: 50%; background-color: ${s(this.settings.highlighter.color,.4)}; border: 2px solid var(--c-border);"></div>
                </button>
                <button class="draw-toolbar-button" data-popup="highlighter-size" title="Highlighter Size">
                    <svg width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="${this.settings.highlighter.size==="small"?"2":this.settings.highlighter.size==="medium"?"4":"6"}">
                        <rect x="6" y="8" width="12" height="8" rx="1"/>
                    </svg>
                </button>
            </div>
        `,this.attachCommonToolbarListeners("highlighter")}renderLassoOptions(){const t=this.optionsContainers.lasso;t&&(t.innerHTML=`
            <div style="padding: var(--space-015); text-align: center; max-width: 120px;">
                <p style="color: var(--c-text-muted); font-size: 0.7em; margin: 0; line-height: 1.3; word-wrap: break-word;">
                    Draw around notes to select and drag them as a group.
                </p>
            </div>
        `)}attachCommonToolbarListeners(t){const s=this.optionsContainers[t];if(!s)return;s.querySelectorAll("[data-popup]").forEach(A=>{A.addEventListener("click",()=>{this.selectTool(t);const r=A.dataset.popup;this.showCommonPopupMenu(r,A)})})}attachTextToolbarListeners(){const t=this.optionsContainers.text;if(!t)return;const s=t.querySelector('[data-popup="text-color"]');s&&s.addEventListener("click",()=>{this.selectTool("text"),this.showCommonPopupMenu("text-color",s)});const i=t.querySelector('[data-action="decrease-size"]');i&&i.addEventListener("click",()=>{this.selectTool("text");const h=Math.max(8,this.settings.text.size-2);h!==this.settings.text.size&&(this.settings.text.size=h,this.renderTextOptions(),re.setTool(this.currentTool,this.settings),re.applyCurrentSettingsToSelected())});const A=t.querySelector('[data-action="increase-size"]');A&&A.addEventListener("click",()=>{this.selectTool("text");const h=Math.min(72,this.settings.text.size+2);h!==this.settings.text.size&&(this.settings.text.size=h,this.renderTextOptions(),re.setTool(this.currentTool,this.settings),re.applyCurrentSettingsToSelected())});const r=t.querySelector('[data-action="toggle-background"]');r&&r.addEventListener("click",()=>{this.selectTool("text"),this.settings.text.background=!this.settings.text.background,this.renderTextOptions(),re.setTool(this.currentTool,this.settings),re.applyCurrentSettingsToSelected()});const a=t.querySelector('[data-action="toggle-superscript"]');a&&(a.addEventListener("mousedown",h=>{h.preventDefault()}),a.addEventListener("click",()=>{this.selectTool("text"),re.applyInlineFormatting("superscript")}));const l=t.querySelector('[data-action="toggle-subscript"]');l&&(l.addEventListener("mousedown",h=>{h.preventDefault()}),l.addEventListener("click",()=>{this.selectTool("text"),re.applyInlineFormatting("subscript")}))}showCommonPopupMenu(t,s){const i=document.querySelector(".draw-popup-menu");i&&i.remove();const A=document.createElement("div");A.className="draw-popup-menu";let r="",a="",l="";if(t.startsWith("text-")?(a="text",l=t.replace("text-","")):t.startsWith("marker-")?(a="marker",l=t.replace("marker-","")):t.startsWith("highlighter-")&&(a="highlighter",l=t.replace("highlighter-","")),l==="color"){const m=a==="text"?["#4a90e2","#2d2d2d","#d66573","#68a03f"]:["#4a90e2","#2d2d2d","#d66573","#68a03f","#ffc107"],g=a==="highlighter";r=m.map(v=>{const y=g?this.hexToRgba(v,.4):v;return`
                    <button class="draw-popup-option ${this.settings[a].color===v?"active":""}" data-value="${v}">
                        <div style="width: 24px; height: 24px; border-radius: 50%; background-color: ${y};"></div>
                    </button>
                `}).join("")}else if(l==="size")if(a==="text")r=`
                    <button class="draw-popup-option ${this.settings.text.size===12?"active":""}" data-value="12">
                        <span style="font-size: 0.8em; font-weight: bold;">A</span>
                    </button>
                    <button class="draw-popup-option ${this.settings.text.size===16?"active":""}" data-value="16">
                        <span style="font-size: 1em; font-weight: bold;">A</span>
                    </button>
                    <button class="draw-popup-option ${this.settings.text.size===20?"active":""}" data-value="20">
                        <span style="font-size: 1.2em; font-weight: bold;">A</span>
                    </button>
                `;else{const m=a==="marker"?1:5,g=a==="marker"?15:30,v=this.settings[a].size,y=a==="marker"?3:8,C=a==="marker"?6:15,x=a==="marker"?10:22;r=`
                    <div style="padding: 8px; min-width: 180px;">
                        <input type="range"
                            class="draw-size-slider"
                            min="${m}"
                            max="${g}"
                            value="${v}"
                            style="width: 100%; margin-bottom: 8px;">
                        <div style="display: flex; gap: 4px; justify-content: center;">
                            <button class="draw-popup-option ${v===y?"active":""}" data-value="${y}">
                                <svg width="30" height="20" viewBox="0 0 30 20">
                                    <line x1="2" y1="10" x2="28" y2="10" stroke="currentColor" stroke-width="2"/>
                                </svg>
                            </button>
                            <button class="draw-popup-option ${v===C?"active":""}" data-value="${C}">
                                <svg width="30" height="20" viewBox="0 0 30 20">
                                    <line x1="2" y1="10" x2="28" y2="10" stroke="currentColor" stroke-width="4"/>
                                </svg>
                            </button>
                            <button class="draw-popup-option ${v===x?"active":""}" data-value="${x}">
                                <svg width="30" height="20" viewBox="0 0 30 20">
                                    <line x1="2" y1="10" x2="28" y2="10" stroke="currentColor" stroke-width="6"/>
                                </svg>
                            </button>
                        </div>
                    </div>
                `}A.innerHTML=r,document.body.appendChild(A);const h=s.getBoundingClientRect();A.style.position="absolute",A.style.top=`${h.bottom+5}px`,A.style.left=`${h.left}px`;const u=A.querySelector(".draw-size-slider");u&&u.addEventListener("input",m=>{const g=Number(m.target.value);this.settings[a].size=g,a==="marker"?this.renderMarkerOptions():a==="highlighter"&&this.renderHighlighterOptions(),re.setTool(this.currentTool,this.settings),re.applyCurrentSettingsToSelected()}),A.querySelectorAll(".draw-popup-option").forEach(m=>{m.addEventListener("click",()=>{const g=m.dataset.value;l==="color"?this.settings[a].color=g:l==="size"&&(this.settings[a].size=Number(g),u&&(u.value=g)),a==="text"?this.renderTextOptions():a==="marker"?this.renderMarkerOptions():a==="highlighter"&&this.renderHighlighterOptions(),re.setTool(this.currentTool,this.settings),re.applyCurrentSettingsToSelected(),A.remove()})}),setTimeout(()=>{const m=g=>{!A.contains(g.target)&&!s.contains(g.target)&&(A.remove(),document.removeEventListener("click",m))};document.addEventListener("click",m)},0)}hexToRgba(t,s){const i=parseInt(t.slice(1,3),16),A=parseInt(t.slice(3,5),16),r=parseInt(t.slice(5,7),16);return`rgba(${i}, ${A}, ${r}, ${s})`}getCurrentTool(){return this.currentTool}getCurrentSettings(){return this.currentTool?this.settings[this.currentTool]:null}initializePanelWidthSync(){const t=document.documentElement.style,s="--draw-panel-synced-width",i=()=>{const r=t.getPropertyValue(s);t.setProperty(s,"auto");let a=0;return this.toolPanels.forEach(l=>{l.offsetHeight;const h=l.getBoundingClientRect().width;l.dataset.drawTool,h>a&&(a=h)}),a>0?t.setProperty(s,`${a}px`):r&&t.setProperty(s,r),a},A=()=>{i()};if(requestAnimationFrame(()=>{A()}),window.addEventListener("resize",()=>{A()}),"ResizeObserver"in window){const r=new ResizeObserver(()=>{A()});this.toolPanels.forEach(a=>{r.observe(a)})}}}const aw=new XU;function YU(){_.initStart("Draw Tools"),re.initialize(),aw.initialize(),window.drawToolsController=aw,window.annotationService=re,_.initSuccess("Draw Tools"),_.initStart("Drum components"),Ri.initialize(),_.initSuccess("Drum components")}const jU=[{label:"Toolbar",selector:"#toolbar"},{label:"Toolbar Primary",selector:"#toolbar-primary"},{label:"Primary Actions Grid",selector:"#toolbar-primary .primary-toolbar-actions"},{label:"Primary Playback Row",selector:"#toolbar-primary .primary-toolbar-playback"},{label:"Toolbar Secondary",selector:"#toolbar-secondary"},{label:"Toolbar Preset Controls",selector:"#toolbar-secondary .preset-effects-controls"},{label:"Toolbar Tab Sidebar",selector:"#toolbar-secondary .tab-sidebar"},{label:"Sidebar",selector:"#sidebar"},{label:"Timbre Tab Panel",selector:"#timbre-panel"},{label:"Pitch Tab Panel",selector:"#pitch-panel"},{label:"Rhythm Tab Panel",selector:"#rhythm-panel"},{label:"Macrobeat Tools",selector:"#canvas-macrobeat-tools, #macrobeat-tools"},{label:"Waveform Card",selector:"#timbre-panel .waveform-content-box"},{label:"Preset Card",selector:"#timbre-panel .preset-content-box"},{label:"Echo Card",selector:"#timbre-panel #reverb-delay-panel .effects-content-box, #timbre-panel #echo-panel .effects-content-box"},{label:"Shake Card",selector:"#timbre-panel #vibrato-tremolo-panel .effects-content-box, #timbre-panel #shake-panel .effects-content-box"},{label:"Envelope Card",selector:"#adsr-envelope"},{label:"Harmonics Card",selector:".harmonic-bins-container"},{label:"Canvas Container",selector:"#canvas-container"},{label:"Pitch Grid Wrapper",selector:"#pitch-grid-wrapper"},{label:"Pitch Grid Container",selector:"#pitch-grid-container"},{label:"Drum Grid Wrapper",selector:"#drum-grid-wrapper"},{label:"Drum Grid",selector:"#drum-grid"}],lf=new Map;let cf,td,ed=null,vo="",dr=!1;function Sl(e){return Number.isFinite(e)?Number(e.toFixed(1)):e}function JU(e){const t=e.getBoundingClientRect(),s=window.getComputedStyle(e);return{tag:e.tagName.toLowerCase(),id:e.id||null,class:e.className||null,top:Sl(t.top),left:Sl(t.left),width:Sl(t.width),height:Sl(t.height),offsetWidth:e.offsetWidth,offsetHeight:e.offsetHeight,scrollWidth:e.scrollWidth,scrollHeight:e.scrollHeight,clientWidth:e.clientWidth,clientHeight:e.clientHeight,display:s.display,position:s.position,overflowX:s.overflowX,overflowY:s.overflowY,transform:s.transform!=="none"?s.transform:void 0}}function Z0(e="manual"){const t=window.__uiDiagnosticsTrackedElements;if(!t)return[];if(!dr&&e!=="manual")return[];$l();const s=[];return t.forEach(i=>{const A=Array.from(document.querySelectorAll(i.selector));if(!A.length){s.push({label:i.label,selector:i.selector,missing:!0});return}A.forEach((r,a)=>{const l=A.length>1?`${i.label} [${a}]`:i.label,h=JU(r);s.push({label:l,selector:i.selector,info:h})})}),window.__uiDiagnosticsLastSnapshot=s,s}function Ar(e){dr&&(vo=vo?`${vo}; ${e}`:e,ed===null&&(ed=requestAnimationFrame(()=>{const t=vo||"auto";ed=null,vo="",Z0(t)})))}function $l(){const e=window.__uiDiagnosticsTrackedElements;!e||!cf||e.forEach(t=>{document.querySelectorAll(t.selector).forEach(i=>{lf.has(i)||(lf.set(i,t.label),cf.observe(i),i.addEventListener("scroll",()=>Ar(`${t.label} scroll`),{passive:!0}))})})}function ZU(e={}){if(window.__uiDiagnosticsInitialized)return;window.__uiDiagnosticsInitialized=!0;const{elements:t,autoLog:s=!1}=e;dr=!!s,window.__uiDiagnosticsAutoLog=dr;const i=t||jU;window.__uiDiagnosticsTrackedElements=i,cf=new ResizeObserver(A=>{const r=A.map(a=>lf.get(a.target)||a.target.id||a.target.tagName.toLowerCase()).filter(Boolean);r.length&&Ar(`Resize: ${r.join(", ")}`)}),td=new MutationObserver(()=>$l()),document.body?td.observe(document.body,{childList:!0,subtree:!0}):document.addEventListener("DOMContentLoaded",()=>{td.observe(document.body,{childList:!0,subtree:!0}),$l(),Ar("init")},{once:!0}),window.addEventListener("resize",()=>Ar("window resize")),$l(),Ar("init"),window.logUIState=(A="manual")=>Z0(A),window.enableUIDiagnosticsAutoLog=()=>{dr=!0,window.__uiDiagnosticsAutoLog=!0,Ar("auto-log enabled")},window.disableUIDiagnosticsAutoLog=()=>{dr=!1,window.__uiDiagnosticsAutoLog=!1}}class t2{constructor(){this.element=null,this.isVisible=!1,this.hideTimeout=null}initialize(){this.element=document.createElement("div"),this.element.className="zoom-indicator",this.element.style.cssText=`
            position: fixed;
            top: 20px;
            right: 20px;
            background: rgba(0, 0, 0, 0.8);
            color: white;
            padding: 8px 12px;
            border-radius: 6px;
            font-family: monospace;
            font-size: 12px;
            z-index: 1000;
            opacity: 0;
            transition: opacity 0.3s ease;
            pointer-events: none;
        `,document.body.appendChild(this.element),d.on("zoomIn",()=>this.show()),d.on("zoomOut",()=>this.show())}show(){if(!this.element)return;let t=100,s="";if(yt.getViewportInfo){const i=yt.getViewportInfo();if(t=Math.round(i.zoomLevel*100),i.canSeeFullRange)s=" (Full Range)";else{const A=i.startRank||i.startRow,r=i.endRank||i.endRow;s=` (~${Math.floor(r-A+1)} semitones)`}}this.element.textContent=`Zoom: ${t}%${s}`,this.element.style.opacity="1",this.isVisible=!0,clearTimeout(this.hideTimeout),this.hideTimeout=setTimeout(()=>this.hide(),2e3)}hide(){!this.element||!this.isVisible||(this.element.style.opacity="0",this.isVisible=!1,clearTimeout(this.hideTimeout))}dispose(){this.element&&(document.body.removeChild(this.element),this.element=null),clearTimeout(this.hideTimeout)}}const e2=new t2;function s2(){BM(),n2(),i2(),ZU()}function n2(){e2.initialize(),document.addEventListener("keydown",e=>{const t=document.activeElement.tagName.toLowerCase();["input","textarea"].includes(t)||((e.ctrlKey||e.metaKey)&&(e.key==="+"||e.key==="=")&&(e.preventDefault(),d.emit("zoomIn")),(e.ctrlKey||e.metaKey)&&e.key==="-"&&(e.preventDefault(),d.emit("zoomOut")),(e.ctrlKey||e.metaKey)&&e.key==="0"&&(e.preventDefault(),yt.resetZoom&&yt.resetZoom()))})}function i2(){window.debugZoom={info:()=>yt.getViewportInfo?yt.getViewportInfo():"Viewport info not available",zoomTo:e=>{_.debug("Debug Tools",`Setting zoom to ${e}`,null,"zoom")},scrollTo:e=>{if(_.debug("Debug Tools",`Scrolling to position ${e}`,null,"scroll"),yt.scroll){const s=yt.getViewportInfo().scrollPosition*(d.state.fullRowData.length*d.state.cellHeight*.5),i=e*(d.state.fullRowData.length*d.state.cellHeight*.5);yt.scroll(i-s)}},scrollToNote:e=>{_.debug("Debug Tools",`Scrolling to note ${e}`,null,"scroll"),yt.scrollToNote&&yt.scrollToNote(e)}}}function A2(e,t){const s=()=>{t.uiComponents&&(ef.renderPitchGrid(),ef.renderDrumGrid())};return e.on("notesChanged",s),e.on("stampPlacementsChanged",s),e.on("tripletPlacementsChanged",s),e.on("modulationMarkersChanged",()=>{yt.recalculateLayout(),s(),iA.renderMacrobeatTools(),Pi.invalidateButtonGridSnapshot()}),e.on("rhythmStructureChanged",()=>{yt.recalculateLayout(),s(),iA.renderMacrobeatTools(),Pi.invalidateButtonGridSnapshot()}),e.on("layoutConfigChanged",()=>{s(),iA.renderMacrobeatTools(),Pi.invalidateButtonGridSnapshot()}),e.on("zoomIn",()=>yt.zoomIn()),e.on("zoomOut",()=>yt.zoomOut()),s(),iA.renderMacrobeatTools(),{renderAll:s}}let lw=!1,Bo=null;window.initAudio=async()=>lw?!0:Bo||(Bo=(async()=>{try{return $.context.state!=="running"&&(await $.start(),_.info("Main.js","AudioContext started successfully")),lw=!0,!0}catch(e){return _.error("Main.js","Could not start AudioContext",e),Bo=null,!1}})(),Bo);let cw=!1;const yr=()=>{cw||(cw=!0,window.initAudio().catch(e=>_.warn("Main.js","Failed to initialize audio after user interaction",e,"initialization")),document.removeEventListener("click",yr,!0),document.removeEventListener("keydown",yr,!0),document.removeEventListener("touchstart",yr,!0))};document.addEventListener("click",yr,!0);document.addEventListener("keydown",yr,!0);document.addEventListener("touchstart",yr,!0);window.addEventListener("beforeunload",()=>{typeof Kt.teardown=="function"&&Kt.teardown()});const la={domCache:!1,layoutService:!1,canvasContextService:!1,synthEngine:!1,transportService:!1,scrollSync:!1,uiComponents:!1,audioComponents:!1,initialized:!1},r2={top:"Ab5",bottom:"C4"};function o2(e){if(!(e!=null&&e.top)||!(e!=null&&e.bottom))return null;const t=pe.findIndex(i=>i.toneNote===e.top),s=pe.findIndex(i=>i.toneNote===e.bottom);return t===-1||s===-1?(_.warn("Main.js","Failed to resolve preset range from tone notes",e),null):{topIndex:Math.min(t,s),bottomIndex:Math.max(t,s)}}function a2(){return o2(r2)}function jn(e){la[e]=!0}function hw(e,t=5e3){return new Promise((s,i)=>{if(la[e]){s();return}const A=Date.now(),r=()=>{la[e]?s():Date.now()-A>t?i(new Error(`Component ${e} not ready within ${t}ms`)):setTimeout(r,50)};r()})}document.addEventListener("DOMContentLoaded",async()=>{window.initStartTime=Date.now(),_.info("Main.js","DOMContentLoaded event fired"),_.section("STARTING INITIALIZATION");const e=["dom-cache","core-services","ui-components","audio-components","initial-render","finalize"];try{await ms.init(),e.forEach(a=>ms.registerTask(a)),gQ(),(window.location.hostname==="localhost"||window.location.hostname==="127.0.0.1")&&S0(),ms.updateStatus("Initializing interface..."),uA.init(),jn("domCache"),ms.completeTask("dom-cache"),(()=>{const a=uA.get("appContainer")||document.getElementById("app-container");a&&["click","keydown","touchstart"].forEach(h=>{a.addEventListener(h,window.initAudio,{once:!0})})})(),ms.updateStatus("Preparing core systems..."),xQ(d.state);const s=d.state.pitchRange||{topIndex:0,bottomIndex:pe.length-1},i=Math.max(0,Math.min(pe.length-1,s.topIndex??0)),A=Math.max(i,Math.min(pe.length-1,s.bottomIndex??pe.length-1));d.state.pitchRange={topIndex:i,bottomIndex:A},d.state.fullRowData=pe.slice(i,A+1),await IU(),jn("layoutService"),jn("canvasContextService"),Kt.init(),jn("synthEngine"),Un.initialize().catch(a=>{_.warn("Main.js","RhythmPlaybackService initialization deferred (needs user interaction)",a,"initialization")}),jn("rhythmPlaybackService"),cr.init(),jn("transportService"),s2(),ms.completeTask("core-services"),ms.updateStatus("Loading interface components..."),await OM(),jn("uiComponents"),ms.completeTask("ui-components"),await hw("uiComponents"),ms.updateStatus("Preparing audio components..."),await xU(),jn("audioComponents"),ms.completeTask("audio-components"),EQ(d.state,"audio-components-initialization"),EU(),await $U(),YU(),await hw("audioComponents"),_.section("SETTING UP STATE SUBSCRIPTIONS");const{renderAll:r}=A2(d,la);if(_.section("PERFORMING INITIAL RENDER"),d.setSelectedTool("note"),d.setSelectedNote("circle","#4a90e2"),ms.updateStatus("Rendering workspace..."),r(),iA.renderMacrobeatTools(),ms.completeTask("initial-render"),Pi.prefetchButtonGridSnapshot(),jn("initialized"),_.section("INITIALIZATION COMPLETE"),ms.updateStatus("Finalizing..."),ms.completeTask("finalize"),d.isColdStart){const a=a2(),l=d.state.pitchRange,h=a&&l&&l.topIndex===a.topIndex&&l.bottomIndex===a.bottomIndex,u=d.state.isPitchRangeLocked!==!1;a&&!h?(_.info("Main.js",`Cold start detected, applying Treble Clef preset range (locked=${u})`),d.setSnapZoomToRange(u),d.setPitchRange(a,{trimOutsideRange:u,preserveContent:!u}),u&&yt.snapZoomToCurrentRange?yt.snapZoomToCurrentRange():yt.recalculateLayout&&yt.recalculateLayout()):a||_.warn("Main.js","Treble Clef preset range could not be resolved during cold start")}await ms.complete(),window.ModulationTest=I0}catch(t){_.error("Main.js","Initialization failed",t,"initialization"),_.error("Main.js","Component readiness snapshot at failure",{...la},"initialization"),ms.showError(t);const s=document.createElement("div");s.style.cssText=`
            position: fixed; top: 50%; left: 50%; transform: translate(-50%, -50%);
            background: #ff4444; color: white; padding: 20px; border-radius: 8px;
            z-index: 10000; font-family: monospace; max-width: 80vw;
        `,s.innerHTML=`
            <h3>Initialization Error</h3>
            <p>The application failed to initialize properly.</p>
            <details>
                <summary>Technical Details</summary>
                <pre>${t.message}</pre>
                <pre>Stack: ${t.stack}</pre>
            </details>
            <button onclick="location.reload()">Reload Page</button>
        `,document.body.appendChild(s)}});
