/* ==========================================================================
   Rhythm Controls Styles
   ========================================================================= */

:root {
  --rhythm-ui-button-size: 1.25rem;
  --rhythm-ui-button-font-size: var(--font-size-sm);
  --rhythm-boundary-color: #3a3a3a;
}

#canvas-macrobeat-tools {
  position: relative;
  display: flex;
  flex-direction: column;
  flex-shrink: 0;
  margin-block-end: var(--space-015);
  gap: var(--space-015);
}

#canvas-macrobeat-tools #accidental-controls-container-v2 {
  position: absolute;
  right: 100%;
  top: 50%;
  transform: translateY(-50%);
  z-index: 10;
  margin-right: var(--space-015);
}

#beat-line-ui {
  position: relative;
  display: flex;
  flex-direction: column;
  gap: var(--space-015);
  min-height: 2.25rem;
}

#beat-line-button-layer {
  position: relative;
  min-height: 2.25rem;
  width: 100%;
}

.rhythm-ui-button {
  --rhythm-ui-button-width: var(--rhythm-ui-button-size);
  --rhythm-ui-button-height: var(--rhythm-ui-button-size);
  --rhythm-ui-button-radius: 999px;
  background-color: var(--c-surface-overlay);
  color: var(--c-text);
  border: 1px solid var(--c-border);
  width: var(--rhythm-ui-button-width);
  height: var(--rhythm-ui-button-height);
  border-radius: var(--rhythm-ui-button-radius);
  font-size: var(--rhythm-ui-button-font-size);
  font-weight: 600;
  display: inline-flex;
  align-items: center;
  justify-content: center;
  padding: 0;
  line-height: 1;
  position: absolute;
  transform: translate(-50%, -50%);
  z-index: 10;
  backdrop-filter: blur(2px);
  transition: background-color 0.2s ease, border-color 0.2s ease, color 0.2s ease,
    transform 0.1s ease;
}

.rhythm-ui-button:not(.rhythm-ui-button--boundary):hover,
.rhythm-ui-button:not(.rhythm-ui-button--boundary):focus-visible {
  background-color: var(--c-surface);
  border-color: var(--c-text);
  color: var(--c-text);
  outline: none;
}

.rhythm-ui-button:active {
  transform: translateX(-50%) scale(0.95);
}

.rhythm-ui-button--boundary {
  background-color: transparent;
  border: none;
  padding: 0;
  width: var(--rhythm-ui-button-width);
  height: var(--rhythm-ui-button-height);
  align-items: center;
  justify-content: center;
  pointer-events: auto;
  backdrop-filter: none;
  position: absolute;
  bottom: 0;
  transform: translate(-50%, 0);
}

.rhythm-ui-button--boundary:hover,
.rhythm-ui-button--boundary:focus-visible {
  background-color: transparent;
  border: none;
  color: inherit;
}

.rhythm-ui-button--boundary:focus-visible {
  outline: 2px solid var(--c-accent);
  outline-offset: 2px;
}

.boundary-diamond {
  width: 80%;
  height: 80%; /* Explicit height for rendering/capture tools */
  aspect-ratio: 1;
  display: block;
  transform: rotate(45deg);
  border: 1.5px solid var(--rhythm-boundary-color);
  border-radius: 2px;
  box-sizing: border-box;
  background-color: transparent;
  transition: border-color 0.2s ease, background-color 0.2s ease;
}

.boundary-diamond[data-style='solid'] {
  background-color: var(--rhythm-boundary-color);
  border-color: var(--rhythm-boundary-color);
}

.boundary-diamond[data-style='dashed'] {
  background-color: transparent;
}

.boundary-diamond[data-style='anacrusis'] {
  border-color: var(--c-anacrusis-border);
  background-color: var(--c-anacrusis-bg);
}

.rhythm-ui-button--boundary:hover .boundary-diamond,
.rhythm-ui-button--boundary:focus-visible .boundary-diamond {
  border-color: var(--c-accent);
}

.grouping-segment {
  position: absolute;
  top: 0;
  bottom: 0;
  display: flex;
  align-items: center;
  justify-content: center;
  border: none;
  background-color: transparent;
  color: var(--c-text);
  font-weight: 600;
  line-height: 1;
  cursor: pointer;
  padding: 0;
  transition: background-color 0.2s ease, color 0.2s ease;
}

.grouping-segment:hover,
.grouping-segment:focus-visible {
  background-color: var(--c-surface-overlay);
  color: var(--c-text);
  outline: none;
}

.grouping-segment:focus-visible {
  box-shadow: 0 0 0 2px rgba(var(--c-accent-rgb), 0.35);
}

.grouping-segment[data-next-boundary-style='solid']::after,
.grouping-segment[data-next-boundary-style='dashed']::after {
  content: '';
  position: absolute;
  top: 0;
  bottom: 0;
  right: 0;
  border-right: 2px solid var(--rhythm-boundary-color);
}

.grouping-segment[data-next-boundary-style='dashed']::after {
  border-right-style: dashed;
}

.grouping-segment[data-next-boundary-style='anacrusis']::after {
  border-right: 2px dashed var(--c-anacrusis-border);
}

.grouping-segment[data-has-left-divider='true']::before {
  content: '';
  position: absolute;
  top: 0;
  bottom: 0;
  left: 0;
  border-left: 2px solid var(--rhythm-boundary-color);
}

.grouping-segment[data-prev-boundary-style='dashed'][data-has-left-divider='true']::before {
  border-left-style: dashed;
}

.grouping-segment[data-prev-boundary-style='anacrusis'][data-has-left-divider='true']::before {
  border-left: 2px dashed var(--c-anacrusis-border);
}

.macrobeat-adjust-group {
  display: flex;
  gap: var(--space-025);
  justify-content: center;
}

.time-signature-label {
  background: var(--c-surface-overlay);
  border-radius: 12px;
  font-weight: bold;
  font-size: var(--rhythm-ui-button-font-size);
  color: var(--c-text-muted);
  user-select: none;
  position: absolute;
  transform: translateX(-50%);
  top: var(--time-sig-vertical-offset, 0.25rem);
  backdrop-filter: blur(2px);
  border: 2px solid var(--c-border);
  padding: 0.125rem 0.375rem;
  cursor: pointer;
}

.time-signature-label.anacrusis-label {
  color: var(--c-anacrusis-accent);
  border-color: var(--c-anacrusis-border);
  background-color: var(--c-anacrusis-bg);
}

.time-signature-bracket {
  pointer-events: none;
  z-index: 5;
}

.bracket-label {
  font-weight: bold;
  font-size: 0.85em;
  color: var(--c-text-muted);
  user-select: none;
  pointer-events: none;
  white-space: nowrap;
}
